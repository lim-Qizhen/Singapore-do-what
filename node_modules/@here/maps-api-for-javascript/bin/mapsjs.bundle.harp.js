
/**
 * The code below uses open source software. Please visit the URL below for an overview of the licenses:
 * http://js.api.here.com/v3/3.1.30.6/HERE_NOTICE
 */

(function(){var n,aa=[];function ba(a){return function(){return aa[a].apply(this,arguments)}}function ca(a,b){return aa[a]=b}function da(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function ea(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:da(a)}}
var fa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ha="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ja(a,b){if(b){var c=ha;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&fa(c,a,{configurable:!0,writable:!0,value:b})}}
ja("Array.prototype.find",function(a){return a?a:function(b,c){a:{var d=this;d instanceof String&&(d=String(d));for(var e=d.length,f=0;f<e;f++){var g=d[f];if(b.call(c,g,f,d)){b=g;break a}}b=void 0}return b}});function ka(){ka=function(){};ha.Symbol||(ha.Symbol=la)}function ma(a,b){this.a=a;fa(this,"description",{configurable:!0,writable:!0,value:b})}ma.prototype.toString=function(){return this.a};
var la=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new ma("jscomp_symbol_"+(c||"")+"_"+b++,c)}var b=0;return a}();function na(){ka();var a=ha.Symbol.iterator;a||(a=ha.Symbol.iterator=ha.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&fa(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return oa(da(this))}});na=function(){}}
function oa(a){na();a={next:a};a[ha.Symbol.iterator]=function(){return this};return a}function pa(a,b){na();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}ja("Array.prototype.keys",function(a){return a?a:function(){return pa(this,function(b){return b})}});var qa;
if("function"==typeof Object.setPrototypeOf)qa=Object.setPrototypeOf;else{var ra;a:{var sa={Ug:!0},ta={};try{ta.__proto__=sa;ra=ta.Ug;break a}catch(a){}ra=!1}qa=ra?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ua=qa;ja("Object.setPrototypeOf",function(a){return a||ua});
ja("Promise",function(a){function b(g){this.A=0;this.b=void 0;this.a=[];var h=this.c();try{g(h.resolve,h.reject)}catch(k){h.reject(k)}}function c(){this.a=null}function d(g){return g instanceof b?g:new b(function(h){h(g)})}if(a)return a;c.prototype.b=function(g){if(null==this.a){this.a=[];var h=this;this.c(function(){h.g()})}this.a.push(g)};var e=ha.setTimeout;c.prototype.c=function(g){e(g,0)};c.prototype.g=function(){for(;this.a&&this.a.length;){var g=this.a;this.a=[];for(var h=0;h<g.length;++h){var k=
g[h];g[h]=null;try{k()}catch(l){this.f(l)}}}this.a=null};c.prototype.f=function(g){this.c(function(){throw g;})};b.prototype.c=function(){function g(l){return function(m){k||(k=!0,l.call(h,m))}}var h=this,k=!1;return{resolve:g(this.o),reject:g(this.f)}};b.prototype.o=function(g){if(g===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof b)this.aa(g);else{a:switch(typeof g){case "object":var h=null!=g;break a;case "function":h=!0;break a;default:h=!1}h?this.m(g):this.g(g)}};
b.prototype.m=function(g){var h=void 0;try{h=g.then}catch(k){this.f(k);return}"function"==typeof h?this.s(h,g):this.g(g)};b.prototype.f=function(g){this.i(2,g)};b.prototype.g=function(g){this.i(1,g)};b.prototype.i=function(g,h){if(0!=this.A)throw Error("Cannot settle("+g+", "+h+"): Promise already settled in state"+this.A);this.A=g;this.b=h;this.j()};b.prototype.j=function(){if(null!=this.a){for(var g=0;g<this.a.length;++g)f.b(this.a[g]);this.a=null}};var f=new c;b.prototype.aa=function(g){var h=
this.c();g.Kf(h.resolve,h.reject)};b.prototype.s=function(g,h){var k=this.c();try{g.call(h,k.resolve,k.reject)}catch(l){k.reject(l)}};b.prototype.then=function(g,h){function k(q,r){return"function"==typeof q?function(v){try{l(q(v))}catch(w){m(w)}}:r}var l,m,p=new b(function(q,r){l=q;m=r});this.Kf(k(g,l),k(h,m));return p};b.prototype.catch=function(g){return this.then(void 0,g)};b.prototype.Kf=function(g,h){function k(){switch(l.A){case 1:g(l.b);break;case 2:h(l.b);break;default:throw Error("Unexpected state: "+
l.A);}}var l=this;null==this.a?f.b(k):this.a.push(k)};b.resolve=d;b.reject=function(g){return new b(function(h,k){k(g)})};b.race=function(g){return new b(function(h,k){for(var l=ea(g),m=l.next();!m.done;m=l.next())d(m.value).Kf(h,k)})};b.all=function(g){var h=ea(g),k=h.next();return k.done?d([]):new b(function(l,m){function p(v){return function(w){q[v]=w;r--;0==r&&l(q)}}var q=[],r=0;do q.push(void 0),r++,d(k.value).Kf(p(q.length-1),m),k=h.next();while(!k.done)})};return b});
ja("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&c.push([d,b[d]]);return c}});ja("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}});
var va="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a};ja("Object.assign",function(a){return a||va});ja("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}});var wa=this||self;
function ya(a,b,c){a=a.split(".");c=c||wa;a[0]in c||"undefined"==typeof c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)a.length||void 0===b?c[d]&&c[d]!==Object.prototype[d]?c=c[d]:c=c[d]={}:c[d]=b}function za(){}
function Aa(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function Ba(a){var b=Aa(a);return"array"==b||"object"==b&&"number"==typeof a.length}function Ca(a){return"function"==Aa(a)}function Da(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var Ea="closure_uid_"+(1E9*Math.random()>>>0),Fa=0;function Ga(a,b,c){return a.call.apply(a.bind,arguments)}
function Ha(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function Ia(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ia=Ga:Ia=Ha;return Ia.apply(null,arguments)}
function Ja(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function t(a,b){ya(a,b,void 0)}function u(a,b){function c(){}c.prototype=b.prototype;a.l=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.yp=function(d,e,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[e].apply(d,g)}};function Ka(a){if(Error.captureStackTrace)Error.captureStackTrace(this,Ka);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}u(Ka,Error);Ka.prototype.name="CustomError";function La(a,b){this.c=a;this.f=b;this.b=0;this.a=null}La.prototype.get=function(){if(0<this.b){this.b--;var a=this.a;this.a=a.next;a.next=null}else a=this.c();return a};La.prototype.put=function(a){this.f(a);100>this.b&&(this.b++,a.next=this.a,this.a=a)};function Ma(){this.b=this.a=null}var Oa=new La(function(){return new Na},function(a){a.reset()});Ma.prototype.add=function(a,b){var c=Oa.get();c.set(a,b);this.b?this.b.next=c:this.a=c;this.b=c};Ma.prototype.remove=function(){var a=null;this.a&&(a=this.a,this.a=this.a.next,this.a||(this.b=null),a.next=null);return a};function Na(){this.next=this.b=this.a=null}Na.prototype.set=function(a,b){this.a=a;this.b=b;this.next=null};Na.prototype.reset=function(){this.next=this.b=this.a=null};var Pa=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function Qa(a,b){return-1!=a.indexOf(b)}function Ra(a,b){return a<b?-1:a>b?1:0};function Sa(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1}function Ta(a){for(var b in a)return!1;return!0}function Ua(a){var b={},c;for(c in a)b[c]=a[c];return b}var Va="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Wa(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Va.length;f++)c=Va[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var Xa;a:{var Ya=wa.navigator;if(Ya){var Za=Ya.userAgent;if(Za){Xa=Za;break a}}Xa=""}function $a(a){return Qa(Xa,a)};var ab=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};function bb(a,b){this.b=a===cb&&b||"";this.a=db}var db={},cb={},eb=new bb(cb,"");function fb(a,b){this.b=a===gb&&b||"";this.a=hb}fb.prototype.zc=function(){return 1};var hb={},gb={};function ib(){this.b="";this.c=jb;this.a=null}ib.prototype.zc=function(){return this.a};function kb(){var a=lb;if(a instanceof ib&&a.constructor===ib&&a.c===jb)return a.b;Aa(a);return"type_error:SafeHtml"}var jb={};function mb(a){var b=new ib;b.b=a;b.a=0;return b}mb("<!DOCTYPE html>");var lb=mb("");mb("<br>");function nb(a){var b=new fb(gb,eb instanceof bb&&eb.constructor===bb&&eb.a===db?eb.b:"type_error:Const");b instanceof fb&&b.constructor===fb&&b.a===hb?b=b.b:(Aa(b),b="type_error:TrustedResourceUrl");a.src=b.toString()};function ob(a){ob[" "](a);return a}ob[" "]=za;function pb(a,b){var c=qb;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)};var rb=$a("Opera"),sb=$a("Trident")||$a("MSIE"),tb=$a("Edge"),ub=$a("Gecko")&&!(Qa(Xa.toLowerCase(),"webkit")&&!$a("Edge"))&&!($a("Trident")||$a("MSIE"))&&!$a("Edge"),vb=Qa(Xa.toLowerCase(),"webkit")&&!$a("Edge");function xb(){var a=wa.document;return a?a.documentMode:void 0}var yb;
a:{var zb="",Ab=function(){var a=Xa;if(ub)return/rv:([^\);]+)(\)|;)/.exec(a);if(tb)return/Edge\/([\d\.]+)/.exec(a);if(sb)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(vb)return/WebKit\/(\S+)/.exec(a);if(rb)return/(?:Version)[ \/]?(\S+)/.exec(a)}();Ab&&(zb=Ab?Ab[1]:"");if(sb){var Bb=xb();if(null!=Bb&&Bb>parseFloat(zb)){yb=String(Bb);break a}}yb=zb}var qb={};
function Cb(a){return pb(a,function(){for(var b=0,c=Pa(String(yb)).split("."),d=Pa(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"";do{g=/(\d*)(\D*)(.*)/.exec(g)||["","","",""];h=/(\d*)(\D*)(.*)/.exec(h)||["","","",""];if(0==g[0].length&&0==h[0].length)break;b=0==g[1].length?0:parseInt(g[1],10);var k=0==h[1].length?0:parseInt(h[1],10);b=Ra(b,k)||Ra(0==g[2].length,0==h[2].length)||Ra(g[2],h[2]);g=g[3];h=h[3]}while(0==b)}return 0<=b})}var Db;
Db=wa.document&&sb?xb():void 0;!ub&&!sb||sb&&9<=Number(Db)||ub&&Cb("1.9.1");sb&&Cb("9");function Eb(a){var b=document;a=String(a);"application/xhtml+xml"===b.contentType&&(a=a.toLowerCase());return b.createElement(a)};function Fb(a){wa.setTimeout(function(){throw a;},0)}var Gb;
function Hb(){var a=wa.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!$a("Presto")&&(a=function(){var e=Eb("IFRAME");e.style.display="none";nb(e);document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.write(kb());e.close();var g="callImmediate"+Math.random(),h="file:"==f.location.protocol?"*":f.location.protocol+"//"+f.location.host;e=Ia(function(k){if(("*"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},
this);f.addEventListener("message",e,!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if("undefined"!==typeof a&&!$a("Trident")&&!$a("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.wj;c.wj=null;e()}};return function(e){d.next={wj:e};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in Eb("SCRIPT")?function(e){var f=Eb("SCRIPT");f.onreadystatechange=function(){f.onreadystatechange=null;
f.parentNode.removeChild(f);f=null;e();e=null};document.documentElement.appendChild(f)}:function(e){wa.setTimeout(e,0)}};function Ib(a,b){Jb||Kb();Lb||(Jb(),Lb=!0);Mb.add(a,b)}var Jb;function Kb(){if(wa.Promise&&wa.Promise.resolve){var a=wa.Promise.resolve(void 0);Jb=function(){a.then(Nb)}}else Jb=function(){var b=Nb;!Ca(wa.setImmediate)||wa.Window&&wa.Window.prototype&&!$a("Edge")&&wa.Window.prototype.setImmediate==wa.setImmediate?(Gb||(Gb=Hb()),Gb(b)):wa.setImmediate(b)}}var Lb=!1,Mb=new Ma;function Nb(){for(var a;a=Mb.remove();){try{a.a.call(a.b)}catch(b){Fb(b)}Oa.put(a)}Lb=!1};function Ob(a){this.A=Pb;this.i=void 0;this.c=this.a=this.b=null;this.f=this.g=!1;if(a!=za)try{var b=this;a.call(void 0,function(c){Qb(b,Rb,c)},function(c){Qb(b,Sb,c)})}catch(c){Qb(this,Sb,c)}}var Pb=0,Rb=2,Sb=3;function Tb(){this.next=this.c=this.b=this.f=this.a=null;this.g=!1}Tb.prototype.reset=function(){this.c=this.b=this.f=this.a=null;this.g=!1};var Ub=new La(function(){return new Tb},function(a){a.reset()});function Vb(a,b,c){var d=Ub.get();d.f=a;d.b=b;d.c=c;return d}
function Wb(a){if(a instanceof Ob)return a;var b=new Ob(za);Qb(b,Rb,a);return b}function Yb(a){return new Ob(function(b,c){c(a)})}function Zb(){var a,b,c=new Ob(function(d,e){a=d;b=e});return new $b(c,a,b)}Ob.prototype.then=function(a,b,c){return ac(this,Ca(a)?a:null,Ca(b)?b:null,c)};Ob.prototype.$goog_Thenable=!0;Ob.prototype.cancel=function(a){if(this.A==Pb){var b=new bc(a);Ib(function(){cc(this,b)},this)}};
function cc(a,b){if(a.A==Pb)if(a.b){var c=a.b;if(c.a){for(var d=0,e=null,f=null,g=c.a;g&&(g.g||(d++,g.a==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.A==Pb&&1==d?cc(c,b):(f?(d=f,d.next==c.c&&(c.c=d),d.next=d.next.next):dc(c),ec(c,e,Sb,b)))}a.b=null}else Qb(a,Sb,b)}function fc(a,b){a.a||a.A!=Rb&&a.A!=Sb||hc(a);a.c?a.c.next=b:a.a=b;a.c=b}
function ac(a,b,c,d){var e=Vb(null,null,null);e.a=new Ob(function(f,g){e.f=b?function(h){try{var k=b.call(d,h);f(k)}catch(l){g(l)}}:f;e.b=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof bc?g(h):f(k)}catch(l){g(l)}}:g});e.a.b=a;fc(a,e);return e.a}Ob.prototype.m=function(a){this.A=Pb;Qb(this,Rb,a)};Ob.prototype.o=function(a){this.A=Pb;Qb(this,Sb,a)};
function Qb(a,b,c){if(a.A==Pb){a===c&&(b=Sb,c=new TypeError("Promise cannot resolve to itself"));a.A=1;a:{var d=c,e=a.m,f=a.o;if(d instanceof Ob){fc(d,Vb(e||za,f||null,a));var g=!0}else{if(d)try{var h=!!d.$goog_Thenable}catch(l){h=!1}else h=!1;if(h)d.then(e,f,a),g=!0;else{if(Da(d))try{var k=d.then;if(Ca(k)){ic(d,k,e,f,a);g=!0;break a}}catch(l){f.call(a,l);g=!0;break a}g=!1}}}g||(a.i=c,a.A=b,a.b=null,hc(a),b!=Sb||c instanceof bc||jc(a,c))}}
function ic(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function hc(a){a.g||(a.g=!0,Ib(a.j,a))}function dc(a){var b=null;a.a&&(b=a.a,a.a=b.next,b.next=null);a.a||(a.c=null);return b}Ob.prototype.j=function(){for(var a;a=dc(this);)ec(this,a,this.A,this.i);this.g=!1};
function ec(a,b,c,d){if(c==Sb&&b.b&&!b.g)for(;a&&a.f;a=a.b)a.f=!1;if(b.a)b.a.b=null,kc(b,c,d);else try{b.g?b.f.call(b.c):kc(b,c,d)}catch(e){lc.call(null,e)}Ub.put(b)}function kc(a,b,c){b==Rb?a.f.call(a.c,c):a.b&&a.b.call(a.c,c)}function jc(a,b){a.f=!0;Ib(function(){a.f&&lc.call(null,b)})}var lc=Fb;function bc(a){Ka.call(this,a)}u(bc,Ka);bc.prototype.name="cancel";function $b(a,b,c){this.dl=a;this.resolve=b;this.reject=c};var x=this;function mc(){return Object.create(y,void 0)}var A=Ia,nc=String,oc=x.Object.freeze||function(a){return a};function pc(a){for(var b=Object.keys(a),c=b.length,d;c--;)d=a[b[c]],Da(d)&&pc(d);return oc(a)}function qc(a){var b=Aa(a);if("object"==b||"array"==b){if(Ca(a.clone))return a.clone();b="array"==b?[]:{};for(var c in a)a.hasOwnProperty(c)&&(b[c]=qc(a[c]));return b}return a}var B=self.eval("undefined"),y=self.eval("null");function rc(a,b){return nc(a).split(b!==B?b:" ")}var sc="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function C(a,b,c,d,e){if(!(b=a instanceof b)&&c)throw new D(c,d,tc(e)?e:a);return b}function uc(a,b){if(!0===(C(a,b)&&a.constructor===b))throw new TypeError("Illegal constructor "+vc(b));}function wc(a,b,c,d,e){if(!(b=xc(a)===b)&&c)throw new D(c,d,tc(e)?e:a);return b}function yc(a,b,c,d){return wc(a,"Array",b,c,d)}t("H.lang.isArray",yc);function tc(a){return a!==B}function zc(a){return"string"===typeof a}t("H.lang.isString",zc);var Ac=parseInt,Bc=parseFloat,E=isNaN;
function Cc(a){return a===+a}t("H.lang.isNumber",Cc);t("H.lang.isInteger",Number.isInteger?Number.isInteger:function(a){return"number"===typeof a&&0===a%1});function Dc(a){return!E(+a)}function xc(a){var b=Object[sc[0]][sc[6]].call(a).match(/^\[object (\w+)\]$/);return b?b[1]:typeof a}var Ec=[];function Fc(a){0>Ec.indexOf(a)&&Ec.push(a)}Fc(Ec);
function vc(a,b,c,d){var e="",f=2>arguments.length,g;f&&(b={H:x.H},c="",d=Ec.slice());Gc(b,!0,function(h,k){try{if(g=h[k],k=Hc(h,g),!(Da(g)&&g.window===g&&g.self===g||Da(g)&&0<g.nodeType&&Ca(g.cloneNode))&&Da(g)){if(g===a)return e=c+"."+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=vc(a,g,c+"."+k,d)))return!0}}catch(l){}});f&&(e=e?e.substr(1).replace("."+sc[0]+".","#"):"~"+(Ca(a)?Ic(a)+"()":xc(a)));return e}
function Hc(a,b){var c=[];Gc(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(Jc)[0]}function Jc(a,b){return b.length-a.length}var Kc=Object[sc[0]][sc[2]];function Gc(a,b,c){var d;if(a){for(e in a)if((!b||Kc.call(a,e))&&c(a,e,!0))return;for(d=sc.length;d--;){var e=sc[d];if((!b||Kc.call(a,e))&&c(a,e,!1))break}}}function Ic(a){return(a=/^\s*function ([^\( ]+)/.exec(a))?a[1]:"anonymous"}function Lc(a,b,c){c[b]="#"+b}var Mc=!!x.__karma__;function Nc(){throw Error("unimplemented method");};function Oc(a,b){b=b||{};"status"in b&&(this.status=+b.status);"statusText"in b&&(this.statusText=b.statusText);this.ok=200<=this.status&&300>this.status;this.bodyUsed=!1;a?"string"===typeof a?this.c=a:ArrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(a)||a.buffer)?this.a=a.buffer||a:Blob.prototype.isPrototypeOf(a)&&(this.b=a):this.c=""}t("H.net.Response",Oc);Oc.prototype.type="default";Oc.prototype.type=Oc.prototype.type;Oc.prototype.status=200;Oc.prototype.status=Oc.prototype.status;
Oc.prototype.statusText="OK";Oc.prototype.statusText=Oc.prototype.statusText;function Pc(a){if(a.bodyUsed)return Yb(new TypeError("Already read"));a.bodyUsed=!0}Oc.error=function(){Oc.a||(Oc.a=new Oc(null,{status:0,statusText:""}),Oc.a.type="error");return Oc.a};Oc.error=Oc.error;
Oc.prototype.text=function(){var a=Pc(this);if(!a)if(this.c)a=Wb(this.c);else if(this.a){a=new Uint8Array(this.a);var b=a.length,c=Array(b),d;for(d=0;d<b;d++)c[d]=String.fromCharCode(a[d]);a=Wb(c.join(""))}else this.b?a=Qc(this.b):a=Yb("Unsupported response body");return a};Oc.prototype.json=function(){return this.text().then(x.JSON.parse)};Oc.prototype.blob=function(){var a,b=Pc(this);b||(this.b?a=this.b:this.a&&(a=new Blob([this.a],{type:"application/octet-stream"})));return b||Wb(a)};
Oc.prototype.arrayBuffer=function(){return this.a?Pc(this)||Wb(this.a.slice(0)):this.blob().then(Oc.b)};Oc.b=function(a){var b=new FileReader;b.readAsArrayBuffer(a);return new Ob(function(c,d){b.onload=function(){c(b.result)};b.onerror=function(){d(b.error)}})};function Qc(a){var b=new FileReader;b.readAsText(a);return new Ob(function(c,d){b.onload=function(){c(b.result)};b.onerror=function(){d(b.error)}})}!Mc&&x.Response&&x.Response.error&&(Oc=x.Response,Fc(Oc.prototype));function Rc(a,b,c){function d(){var m=A(l.a,l),p=+k.timeout||0;Sc?(Tc(l,"timeout",m),e.timeout=p):p&&(l.c=setTimeout(function(){e.abort();l.a({type:"timeout"})},p));Tc(l,"error",m);Tc(l,"load",m);e.send(k.data)}var e,f,g,h=c&&c.headers||{},k={},l=this;if(!Ca(b))throw new D(Rc,1,"function required");Wa(h,Uc.headers,h);Wa(k,Uc,c||{});k.headers=h;this.b=b;this.T=e=new XMLHttpRequest;b=k.method;try{e.open(b,a,!0);for(f in h)h.hasOwnProperty(f)&&(g=h[f])&&e.setRequestHeader(f,g);e.withCredentials=!!k.withCredentials;
d()}catch(m){this.a({type:"cors"})}}t("H.net.Xhr",Rc);var Uc={method:"GET",headers:{},data:null},Vc="withCredentials"in new XMLHttpRequest,Sc="timeout"in new XMLHttpRequest;function Tc(a,b,c){Vc?a.T.addEventListener(b,c):a.T["on"+b]=c}function Wc(a,b,c){Vc?a.T.removeEventListener(b,c):a.T["on"+b]=null}Rc.prototype.abort=function(){this.T&&(this.T.abort(),this.T&&this.a({type:"abort"}))};Rc.prototype.abort=Rc.prototype.abort;
Rc.prototype.a=function(a){var b=a.type;a=this.T;var c,d;this.c&&clearTimeout(this.c);"load"===b?a instanceof XMLHttpRequest&&200!==a.status&&(c="network"):c=4===a.readyState&&0===a.status&&"error"==b?"cors":"error"!=b?b:"network";b=this.a;Wc(this,"timeout",b);Wc(this,"error",b);Wc(this,"load",b);0===a.status||c&&"network"!==c?d=Oc.error():d=new Oc(a.responseText||null,a);c=this.b;delete this.a;delete this.b;delete this.T;c(d)};function Xc(a,b){var c=[];a&&c.push(vc(a));1<arguments.length&&c.push(""+b);c=Error(c.join(" "));Object.setPrototypeOf(c,Xc.prototype);return c}u(Xc,Error);t("H.lang.IllegalOperationError",Xc);Xc.prototype.name="IllegalOperationError";var Yc,Zc,$c;function D(a,b,c){var d=arguments.length;b=b!==B?+b:b;if(b!==B){var e=(e=/^.*?\(([^\)]+)/.exec((""+a).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?rc(e[1].replace(/\s+/g,""),","):[];e.forEach(Lc);e=e[b]||"#"+b}var f=a?vc(a):"";d=2<d?nc(c):"";if(e||d)f+=" (Argument "+(e||"")+(d?" "+d:"")+")";d=Error(f);Object.setPrototypeOf(d,D.prototype);return d}u(D,Error);t("H.lang.InvalidArgumentError",D);D.prototype.name="InvalidArgumentError";function ad(){if(!zc("STATIC_DB"))throw new D(this.constructor,0);this.g=x.indexedDB||x.qp||x.Go||x.Ho;if(!this.g)throw new Xc(this.constructor,"This browser does not support IndexedDB");this.a=[];this.c=[];this.ri=A(this.ri,this)}var bd,dd;n=ad.prototype;n.put=function(a,b,c,d){if(!zc(a)&&!Cc(a))throw new D(this.put,0);if(!ed(b))throw new D(this.put,1);fd(this,function(e){gd(e.put(b,a),c,d)},d)};
n.get=function(a,b,c){var d;if(!zc(a)&&!Cc(a))throw new D(this.get,0);if(!Ca(b))throw new D(this.get,1);fd(this,function(e){d=e.get(a);gd(d,b,c)},c);return{cancel:function(){d&&(d.onsuccess=hd)}}};n.remove=function(a,b,c){if(!zc(a)&&!Cc(a))throw new D(this.remove,0);fd(this,function(d){gd(d["delete"](a),b,c)},c)};n.clear=function(a,b){fd(this,function(c){gd(c.clear(),a,b)},b)};n.ri=function(){var a=this.b.result;a.objectStoreNames.contains("data")||a.createObjectStore("data")};
function id(a,b,c){if(a.b)a.a?(a.a.push(b),c&&a.c.push(c)):a.f?c&&c(a.f):b(a.b.result);else{a.b=a.g.open(jd+"STATIC_DB",1);a.b.onupgradeneeded=a.ri;var d=a.b.onerror=function(){clearTimeout(a.i);a.f=this.error;a.c.forEach(function(e){e(a.f)});a.a=a.c=null};a.i=setTimeout(function(){d.call({error:Error("DbOpenTimeoutError")})},500);a.b.onsuccess=function(){clearTimeout(a.i);a.a?(a.a.forEach(function(e){e(this.result)},this),a.a=a.c=null):(a.b=a.f=null,a.a=[],a.c=[])};a.a.push(b);c&&a.c.push(c)}}
function fd(a,b,c){id(a,function(d){d=d.transaction(["data"],"readwrite");b(d.objectStore("data"))},c)}function gd(a,b,c){b&&(a.onsuccess=function(){b(this.result)});c&&(a.onerror=function(){c(this.error)})}function ed(a){var b=Object.prototype.toString.call(a);return"[object Blob]"===b||"[object ArrayBuffer]"===b||zc(a)||Da(a)}function kd(){bd||(bd=new ad);return bd}t("H.util.IndexedDBStorage.getInstance",kd);var jd="H_";
function ld(){if(!tc(dd))if("file:"===window.location.protocol&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&128<=window.location.href.length)dd=!1;else{var a=x.indexedDB||x.qp||x.Go||x.Ho;var b=jd+"TEST_DB";try{var c=a&&a.open(b,1)}catch(d){}dd=!!c&&null===c.onupgradeneeded;c&&a.deleteDatabase&&a.deleteDatabase(b)}return dd}t("H.util.IndexedDBStorage.isSupported",ld);function nd(){0!=od&&(pd[this[Ea]||(this[Ea]=++Fa)]=this);this.Nd=this.Nd;this.sb=this.sb}var od=0,pd={};nd.prototype.Nd=!1;nd.prototype.B=function(){if(!this.Nd&&(this.Nd=!0,this.u(),0!=od)){var a=this[Ea]||(this[Ea]=++Fa);if(0!=od&&this.sb&&0<this.sb.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete pd[a]}};
nd.prototype.zb=function(a,b){this.Nd?void 0!==b?a.call(b):a():(this.sb||(this.sb=[]),this.sb.push(void 0!==b?Ia(a,b):a))};nd.prototype.u=function(){if(this.sb)for(;this.sb.length;)this.sb.shift()()};function qd(a){a&&"function"==typeof a.B&&a.B()};function rd(a,b){this.type=a;this.currentTarget=this.target=b;this.f=this.a=!1;this.nl=!0}rd.prototype.stopPropagation=function(){this.a=!0};rd.prototype.preventDefault=function(){this.f=!0;this.nl=!1};t("H.util.Event",rd);rd.prototype.stopPropagation=rd.prototype.stopPropagation;rd.prototype.stopPropagation=rd.prototype.stopPropagation;rd.prototype.CAPTURING_PHASE=1;rd.prototype.CAPTURING_PHASE=rd.prototype.CAPTURING_PHASE;rd.prototype.AT_TARGET=2;rd.prototype.AT_TARGET=rd.prototype.AT_TARGET;rd.prototype.BUBBLING_PHASE=3;rd.prototype.BUBBLING_PHASE=rd.prototype.BUBBLING_PHASE;rd.prototype.eventPhase=0;rd.prototype.eventPhase=rd.prototype.eventPhase;function sd(a,b,c){sd.l.constructor.call(this,a,c);this.data=b}u(sd,rd);t("H.util.DataEvent",sd);function td(a,b,c){td.l.constructor.call(this,a,c);this.message=b}u(td,rd);t("H.util.ErrorEvent",td);var ud=Math,vd=ud.min,wd=ud.max,xd=ud.round,yd=ud.floor,zd=ud.ceil,Ad=ud.abs,Bd=ud.log,Cd=ud.sqrt,Dd=ud.pow,Ed=ud.exp,Fd=ud.sin,Gd=ud.asin,Hd=ud.cos,Id=ud.tan,Jd=ud.atan,Kd=ud.atan2,Ld=ud.LN2,Md=ud.PI,Nd=Md/2,Od=Md/4,Pd=2*Md,Qd=3*Md,Rd=Md/180,Sd=180/Md,Td=1/0,Ud=Dd(-2,53),Vd=Vd||function(a){return Bd(a)/Ld};function Wd(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}function Xd(a,b,c){b-=c=c||0;a-=c;return a-yd(a/b)*b+c}t("H.math.normalize",Xd);function Yd(a,b,c){return a>c?c:a<b?b:a}
t("H.math.clamp",Yd);function Zd(a,b,c,d){d||(d=0);return b<c?a>=b-d&&a<=c+d:a>=c-d&&a<=b+d}function $d(a,b,c,d,e,f){return Cd(Dd((a-e)*(d-f)-(b-f)*(c-e),2)/(Dd(c-e,2)+Dd(d-f,2)))}var ae={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};t("H.math.CoverType",ae);
function be(a,b,c,d,e,f){var g=c.length,h=g,k=c[0],l=0,m=0,p=0;d=d/2||0;var q=f||2;f=q*(e?0:1)+1;for(var r=q-2;1!=l&&h>f;){h-=r;var v=c[--h];q=c[--h];var w=c[h?h-r-1:(g+(h-r-1))%g];var z=c[h?h-r-2:(g+(h-r-2))%g];if(q>=a-d&&q<=a+d&&v>=b-d&&v<=b+d||z>=a-d&&z<=a+d&&w>=b-d&&w<=b+d)l=1;else if(!l&&q===a)z===a&&(v<b&&w>b||v>b&&w<b)||(k<=a&&z>a||k>=a&&z<a)&&(v>=b?++m:++p),l=Zd(b,v,w,d)&&$d(a,b,q,v,z,w)<=d?2:0;else if(!l&&Zd(a,q,z,d)){if(q<a&&z>a||q>a&&z<a)k=v+(a-q)/(z-q)*(w-v),m+=k>b,p+=k<b;l=Zd(b,v,w,d)&&
$d(a,b,q,v,z,w)<=d?2:0}k=q}!l&&e&&0!==p&&0!==m%2&&(l=3);return l}function ce(a,b){return be(a.x,a.y,b,0,!0)!==ae.NONE}t("H.math.isPointInsidePolygon",ce);function de(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&tc(a[0].x);b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}t("H.math.flatten",de);function ee(a,b,c){this.type=a;this.data=b;this.f=Zb();this.resolve=A(this.resolve,this);this.reject=A(this.reject,this);this.priority=fe;c!==B&&(this.priority=c);this.yh().add(this)}var fe=1,ge={up:0,xp:fe,tp:2};n=ee.prototype;n.then=function(a,b,c){return this.f.dl.then(a,b,c)};n.resolve=function(a){this.pe=3;this.f.resolve(a)};n.reject=function(a){this.pe=5;this.f.reject(a)};n.pe=0;n.cancel=function(){3>this.pe&&(this.Ie(),this.yh().remove(this),this.pe=4)};function he(a){var b;this.a={};for(b in ge)this.a[ge[b]]=[];this.vf=a;this.vf.addEventListener("allocatable",A(this.b,this))}t("H.util.JobManager",he);var ie=Object.keys(ge).map(function(a){return ge[a]}).sort().reverse();he.prototype.add=function(a){C(a,ee,this.add,0);this.a[a.priority].push(a);this.b()};he.prototype.contains=function(a){return-1<this.a[a.priority].indexOf(a)};
he.prototype.remove=function(a){var b=a.priority,c=this.a[b].indexOf(a);if(-1<c)return this.a[b].splice(c,1),!0;a.ej&&this.vf.Tf(a.ej);return!1};he.prototype.b=function(){ie.forEach(function(a){this.a[a]=this.a[a].filter(function(b){var c;if((c=this.vf.Zg(b))!==y){var d=A(this.vf.Tf,this.vf,c,b);b.ej=c;b.then(d,d);b.pe=b.Lj(c)?1:5}else return!0},this)},this)};function je(a,b,c){var d=[],e=arguments.length;a&&d.push(vc(a));1<e&&(e=2<e&&yc(c)?" out of ["+c[0]+"..."+c[1]+"]":"",d.push("("+b+e+")"));d=Error(d.join(" "));Object.setPrototypeOf(d,je.prototype);return d}u(je,Error);t("H.lang.OutOfRangeError",je);je.prototype.name="OutOfRangeError";var ke="closure_listenable_"+(1E6*Math.random()|0);function le(a){return!(!a||!a[ke])}var me=0;function ne(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.gg=e;this.key=++me;this.se=this.Jf=!1}function oe(a){a.se=!0;a.listener=null;a.proxy=null;a.src=null;a.gg=null};function pe(a){this.src=a;this.a={};this.b=0}pe.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.a[f];a||(a=this.a[f]=[],this.b++);var g=qe(a,b,d,e);-1<g?(b=a[g],c||(b.Jf=!1)):(b=new ne(b,this.src,f,!!d,e),b.Jf=c,a.push(b));return b};pe.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.a))return!1;var e=this.a[a];b=qe(e,b,c,d);return-1<b?(oe(e[b]),Array.prototype.splice.call(e,b,1),0==e.length&&(delete this.a[a],this.b--),!0):!1};
function re(a,b){var c=b.type;if(!(c in a.a))return!1;var d=a.a[c],e=ab(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(oe(b),0==a.a[c].length&&(delete a.a[c],a.b--));return f}pe.prototype.qa=function(a){a=a&&a.toString();var b=0,c;for(c in this.a)if(!a||c==a){for(var d=this.a[c],e=0;e<d.length;e++)++b,oe(d[e]);delete this.a[c];this.b--}return b};
function se(a,b){var c=void 0!==b,d=c?b.toString():"";return Sa(a.a,function(e){for(var f=0;f<e.length;++f)if(!c||e[f].type==d)return!0;return!1})}function qe(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.se&&f.listener==b&&f.capture==!!c&&f.gg==d)return e}return-1};var te=!sb||9<=Number(Db),ue=sb&&!Cb("9");!vb||Cb("528");ub&&Cb("1.9b")||sb&&Cb("8")||rb&&Cb("9.5")||vb&&Cb("528");ub&&!Cb("8")||sb&&Cb("9");var ve=function(){if(!wa.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{wa.addEventListener("test",za,b),wa.removeEventListener("test",za,b)}catch(c){}return a}();function we(a,b){rd.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType="";this.b=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(ub){a:{try{ob(b.nodeName);var e=!0;break a}catch(f){}e=
!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.key=a.key||"";this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=
a.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType="string"===typeof a.pointerType?a.pointerType:xe[a.pointerType]||"";this.b=a;a.defaultPrevented&&this.preventDefault()}}u(we,rd);var xe={2:"touch",3:"pen",4:"mouse"};we.prototype.stopPropagation=function(){we.l.stopPropagation.call(this);this.b.stopPropagation?this.b.stopPropagation():this.b.cancelBubble=!0};
we.prototype.preventDefault=function(){we.l.preventDefault.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,ue)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var ye="closure_lm_"+(1E6*Math.random()|0),ze={},Ae=0;function Be(a,b,c,d,e){if(d&&d.once)return Ce(a,b,c,d,e);if("array"==Aa(b)){for(var f=0;f<b.length;f++)Be(a,b[f],c,d,e);return null}c=De(c);return le(a)?a.aa.add(String(b),c,!1,Da(d)?!!d.capture:!!d,e):Ee(a,b,c,!1,d,e)}
function Ee(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=Da(e)?!!e.capture:!!e,h=Fe(a);h||(a[ye]=h=new pe(a));c=h.add(b,c,d,g,f);if(c.proxy)return c;d=Ge();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)ve||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(He(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");Ae++;return c}
function Ge(){var a=Ie,b=te?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function Ce(a,b,c,d,e){if("array"==Aa(b)){for(var f=0;f<b.length;f++)Ce(a,b[f],c,d,e);return null}c=De(c);return le(a)?a.aa.add(String(b),c,!0,Da(d)?!!d.capture:!!d,e):Ee(a,b,c,!0,d,e)}
function Je(a,b,c,d,e){if("array"==Aa(b)){for(var f=0;f<b.length;f++)Je(a,b[f],c,d,e);return null}d=Da(d)?!!d.capture:!!d;c=De(c);if(le(a))return a.aa.remove(String(b),c,d,e);if(!a)return!1;if(a=Fe(a))if(b=a.a[b.toString()],a=-1,b&&(a=qe(b,c,d,e)),c=-1<a?b[a]:null)return Ke(c);return!1}
function Ke(a){if("number"===typeof a||!a||a.se)return!1;var b=a.src;if(le(b))return re(b.aa,a);var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(He(c),d):b.addListener&&b.removeListener&&b.removeListener(d);Ae--;(c=Fe(b))?(re(c,a),0==c.b&&(c.src=null,b[ye]=null)):oe(a);return!0}function He(a){return a in ze?ze[a]:ze[a]="on"+a}
function Le(a,b,c,d){var e=!0;if(a=Fe(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.se&&(f=Me(f,d),e=e&&!1!==f)}return e}function Me(a,b){var c=a.listener,d=a.gg||a.src;a.Jf&&Ke(a);return c.call(d,b)}
function Ie(a,b){if(a.se)return!0;if(!te){if(!b)a:{b=["window","event"];for(var c=wa,d=0;d<b.length;d++)if(c=c[b[d]],null==c){b=null;break a}b=c}d=b;b=new we(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;!b.a&&0<=e;e--){b.currentTarget=d[e];var f=Le(d[e],a,!0,b);c=c&&f}for(e=0;!b.a&&e<d.length;e++)b.currentTarget=
d[e],f=Le(d[e],a,!1,b),c=c&&f}return c}return Me(a,new we(b,this))}function Fe(a){a=a[ye];return a instanceof pe?a:null}var Ne="__closure_events_fn_"+(1E9*Math.random()>>>0);function De(a){if(Ca(a))return a;a[Ne]||(a[Ne]=function(b){return a.handleEvent(b)});return a[Ne]};function F(){nd.call(this);this.aa=new pe(this);this.ao=this;this.jh=null}u(F,nd);F.prototype[ke]=!0;n=F.prototype;n.Qb=function(){return this.jh};n.ka=function(a){this.jh=a};n.addEventListener=function(a,b,c,d){Be(this,a,b,c,d)};n.removeEventListener=function(a,b,c,d){Je(this,a,b,c,d)};
n.dispatchEvent=function(a){var b,c=this.Qb();if(c)for(b=[];c;c=c.Qb())b.push(c);c=this.ao;var d=a.type||a;if("string"===typeof a)a=new rd(a,c);else if(a instanceof rd)a.target=a.target||c;else{var e=a;a=new rd(d,c);Wa(a,e)}e=!0;if(b)for(var f=b.length-1;!a.a&&0<=f;f--){var g=a.currentTarget=b[f];e=g.td(d,!0,a)&&e}a.a||(g=a.currentTarget=c,e=g.td(d,!0,a)&&e,a.a||(e=g.td(d,!1,a)&&e));if(b)for(f=0;!a.a&&f<b.length;f++)g=a.currentTarget=b[f],e=g.td(d,!1,a)&&e;return e};
n.u=function(){F.l.u.call(this);this.aa&&this.aa.qa(void 0);this.jh=null};n.td=function(a,b,c){a=this.aa.a[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.se&&f.capture==b){var g=f.listener,h=f.gg||f.src;f.Jf&&re(this.aa,f);d=!1!==g.call(h,c)&&d}}return d&&0!=c.nl};t("H.util.EventTarget",F);F.prototype.ka=F.prototype.ka;F.prototype.setParentEventTarget=F.prototype.ka;F.prototype.Qb=F.prototype.Qb;F.prototype.getParentEventTarget=F.prototype.Qb;F.prototype.addEventListener=F.prototype.addEventListener;F.prototype.addEventListener=F.prototype.addEventListener;F.prototype.removeEventListener=F.prototype.removeEventListener;F.prototype.removeEventListener=F.prototype.removeEventListener;F.prototype.dispatchEvent=F.prototype.dispatchEvent;
F.prototype.dispatchEvent=F.prototype.dispatchEvent;F.prototype.B=F.prototype.B;F.prototype.dispose=F.prototype.B;F.prototype.zb=F.prototype.zb;F.prototype.addOnDisposeCallback=F.prototype.zb;F.prototype.lo=F.prototype.td;
F.prototype.td=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?"AT_TARGET":b?"CAPTURING_PHASE":(d=!0,"BUBBLING_PHASE")];if(!d||"pointerenter"!==(e=c.type)&&"pointerleave"!==e)c.eventPhase=g,f=F.prototype.lo.apply(this,arguments),d&&this.Qb&&null===this.Qb()&&delete c.eventPhase;return f};function Oe(a){a=a||{};var b=a.callback;this.a=a.label;Ca(b)&&(this.callback=b);this.b=!!a.disabled;Oe.l.constructor.call(this)}u(Oe,F);t("H.util.ContextItem",Oe);Oe.prototype.Ye=function(){return this.a};Oe.prototype.getLabel=Oe.prototype.Ye;Oe.prototype.Qc=function(a){this.a!==a&&(this.a=a,this.dispatchEvent("update"));return this};Oe.prototype.setLabel=Oe.prototype.Qc;Oe.prototype.mc=function(){return this.b};Oe.prototype.isDisabled=Oe.prototype.mc;
Oe.prototype.Da=function(a){a^this.b&&(this.b=a,this.dispatchEvent("update"));return this};Oe.prototype.setDisabled=Oe.prototype.Da;var Pe=new Oe;Oe.SEPARATOR=Pe;function Re(){if(x.document){var a=document.createElement("canvas");a.width=a.height=1;return a.getContext("2d")}return null}function Se(){return window.devicePixelRatio||1}t("H.util.getPixelRatio",Se);var Te=/^rgba\(([^,]+),([^,]+),([^,]+),([^)]+)\)$/;
function Ue(a){var b=Ve[a],c=x.RegExp;b||(x.Uint8ClampedArray||(x.Uint8ClampedArray=function(d){return d instanceof Number?Array(d):d.map(function(e){return Yd(xd(e),0,255)})}),"none"===a?b=new Uint8ClampedArray([0,0,0,0]):(We.fillStyle="black",We.fillStyle=a,Te.test(We.fillStyle)?b=new Uint8ClampedArray([c.$1,c.$2,c.$3,255*c.$4]):(We.clearRect(0,0,1,1),We.fillRect(0,0,1,1),b=We.getImageData(0,0,1,1).data)),Ve[a]=b);return b}function Xe(a){return"none"!==a&&0<Ue(a)[3]}var Ve=mc(),Ye=!!x.VBArray;
t("H.util.eval",function(a){return eval(a)});function Ze(a,b){return a!==B?a:b}function $e(a){return/^<svg/.test(a)?"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a):a}t("H.util.provide",function(a){var b=wa.$jscomp;if(b&&("function"!=typeof b.Lm?0:b.Lm()))throw Error("goog.provide cannot be used within a module.");ya(a,void 0)});function af(a){this.oc=0<a?ud.round(a):0}af.prototype.next=function(a){if(9007199254740992===this.oc)throw new je(a,this.oc,[0,9007199254740991]);return this.oc++};
var bf=new af,cf=A(bf.next,bf);function df(){return!0}function ef(){return!1}function hd(){}var ff=oc([]),gf=oc({});function hf(a){return"CANVAS"===a.tagName?[a]:a.getElementsByTagName("CANVAS")}function jf(a,b,c){var d;b=a.ownerDocument===b?a.cloneNode(!0):b.importNode(a,!0);if(c)for(a=hf(a),c=hf(b),d=c.length;d--;)c[d].getContext("2d").drawImage(a[d],0,0);return b}var We=Re(),kf=Re();
function lf(a){var b=a.complete,c=0<a.naturalWidth;if(b&&!c&&Ye)try{kf.drawImage(a,0,0),c=!0}catch(d){}return b&&c}var mf=x.BlobBuilder||x.WebKitBlobBuilder||x.MozBlobBuilder;function nf(a,b){b=b||"";if(mf){var c=new mf;c.append(a);a=c.getBlob(b)}else a=new Blob([a],{type:b});return a}var of=x.navigator;Zc=/Edge\/\d+/.test(of.appVersion);$c=/(A|a)ndroid/.test(of.appVersion);function pf(){var a=pf.a;a||(a=this,pf.a=a,Fc(pf.a),F.call(a),qf(this));return a}u(pf,F);pf.prototype.u=function(){pf.l.u.call(this);qf(this)};function qf(a){a.g=10;a.i=6;a.a=mc();a.b=mc();a.c=0}pf.prototype.Zg=function(a){a=a.type;var b=this.a[a]||0;if(this.c<this.g&&b<this.i){var c=++this.f;this.c++;this.a[a]=b+1;this.b[c+""]=a;return c}return y};
pf.prototype.Tf=function(a){var b=this.b[a];if(!tc(b)||!this.a[b])throw new Xc(this.Tf,"Unknown requestId");this.c--;this.a[b]--;this.a[b]||delete this.a[b];delete this.b[a];this.dispatchEvent("allocatable")};pf.prototype.f=-1;function rf(a,b,c,d){if(!this.b[a])throw new D(rf,0,"Mime type is not supported");this.g=a;a=d?Ua(d):{};"crossOrigin"in a||(a.crossOrigin="anonymous");this.a=a;sf.href=b.toString();ee.call(this,sf.protocol+"//"+sf.hostname,b,c)}u(rf,ee);rf.prototype.Lj=function(){this.c=this.b[this.g].call(this);return!0};rf.prototype.Ie=function(){this.c&&(this.c.abort(),this.c=null)};
rf.prototype.b={"application/json":function(){var a=this,b=tf(this.a),c=b.headers;b.headers=c=c?Ua(c):{};c.Accept="application/json";return new Rc(this.data,function(d){200<=d.status&&300>d.status?a.resolve(d.json()):a.reject(d)},b)},"text/plain":function(){var a=this;return new Rc(this.data,function(b){200<=b.status&&300>b.status?a.resolve(b.text()):a.reject(b)},tf(this.a))},image:function(){var a=x.document.createElement("img"),b=this,c=this.data;a.onload=A(this.resolve,this,a);a.onerror=function(){b.reject(Oc.error())};
a.crossOrigin=this.a.crossOrigin;a.src=c;return{abort:function(){a.onerror=a.onload=null;Ye&&lf(a)||a.removeAttribute("src")}}}};
(function(){try{var a=new XMLHttpRequest;a.open("get","/",!0)}catch(b){a={}}"response"in a&&(rf.prototype.b.arraybuffer=function(){var b=new XMLHttpRequest,c=this,d=this.a,e=d.headers,f;b.open("GET",this.data);uf(b,d);b.responseType="arraybuffer";if(e)for(f in e)b.setRequestHeader(f,e[f]);b.onerror=b.ontimeout=function(){c.reject(Oc.error())};b.onload=function(){c.resolve(new Oc(b.response))};b.send();return b})})();var vf=new he(new pf);rf.prototype.yh=function(){return vf};var sf=x.document.createElement("a");
function tf(a){var b=Ua(a);delete b.crossOrigin;uf(b,a);return b}function uf(a,b){a.withCredentials="use-credentials"===b.crossOrigin};function I(a,b){this.x=+a;this.y=+b}t("H.math.Point",I);I.prototype.set=I;I.prototype.set=I.prototype.set;I.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new I(this.x,this.y);return a};I.prototype.clone=I.prototype.clone;I.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};I.prototype.add=I.prototype.add;I.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};I.prototype.sub=I.prototype.sub;I.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};
I.prototype.scale=I.prototype.scale;I.prototype.round=function(){this.x=xd(this.x);this.y=xd(this.y);return this};I.prototype.round=I.prototype.round;I.prototype.floor=function(){this.x=yd(this.x);this.y=yd(this.y);return this};I.prototype.floor=I.prototype.floor;I.prototype.ceil=function(){this.x=zd(this.x);this.y=zd(this.y);return this};I.prototype.ceil=I.prototype.ceil;I.prototype.oa=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};I.prototype.equals=I.prototype.oa;
I.prototype.Yj=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=a;if(c||d){var f=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d);0>=f?e=a:1<=f?e=b:e=new I(a.x+f*c,a.y+f*d)}return e};I.prototype.getNearest=I.prototype.Yj;I.prototype.Za=function(a){return Cd(Dd(this.x-a.x,2)+Dd(this.y-a.y,2))};I.prototype.distance=I.prototype.Za;function wf(a){if(!a)throw Error("invalid argument");return a instanceof I?a:new I(a.x,a.y)}I.fromIPoint=wf;function xf(a){var b=yf[a];if(!b)if(a in zf)b=yf[a]=a;else{b=Af.length;var c="",d=a.charAt(0).toUpperCase()+a.substr(1),e="",f=!1;Bf&&(e=Bf+d,f=e in zf);for(;b--&&!f;)c=Af[b],e=c+d,f=e in zf;f&&(Bf=c);if(b=f?e:null)yf[a]=b;else throw Error("Could not find any variant of CSS property ["+a+"]");}return b}t("H.dom.cssPrefixer.prefix",xf);var Af=["O","Ms","ms","Moz","Webkit"],yf={},Bf="",zf=document.createElement("span").style;function Cf(a,b,c,d){if(!a||!b||!c)throw new D(Cf,null,"Must specify name, version and revision parameter");this.name=a;this.version=b;this.revision=c;d&&Wa(this,d)}t("H.util.BuildInfo",Cf);Cf.prototype.toString=function(){var a,b=[];for(a in this)zc(this[a])&&b.push(this[a]);return b.join(";")};var Df={};function Ef(a,b,c,d){if(!a)throw new D(Ef,1,"Must specify a name parameter");return Df[a]||(Df[a]=new Cf(a,b,c,d))}Cf.get=Ef;function Ff(){Ff.l.constructor.call(this);this.a=Gf(this);this.f=mc();this.c=A(this.c,this);this.a.addEventListener("message",this.c);this.b={}}u(Ff,F);Ff.prototype.u=function(){this.a.terminate()};Ff.prototype.i=function(a){var b=a.type,c=!!this.f[b],d=a.data,e=Hf++,f=d&&d.np?d.np:B,g=!0;c?(this.b[e]=a,If(this,b,e,d&&d.message,f)):(a.reject(new D(this.i,0,"processor_not_found")),g=!1);return g};
Ff.prototype.c=function(a){a=a.data;var b=this.b[a.taskId],c=a.taskId,d=a.data,e=this;if(2===a.type)(new rf("arraybuffer",d)).then(function(f){return f.arrayBuffer()}).then(function(f){e.a.postMessage(["3",c,[f]],[f])},function(){e.a.postMessage(["3",c,[null,"ERROR"]])});else{if(b){switch(a.type){case 1:b.resolve(d);break;case 0:b.reject(d)}delete this.b[c]}this.dispatchEvent(new rd(this.g.IDLE))}};var Hf=0;function Jf(a,b,c){var d=Hf++,e;a.b[d]=e=Zb();If(a,b,d,c);return e.dl}
function If(a,b,c,d,e){d===B||Ba(d)||(d=[d]);try{a.a.postMessage([b,c,d],e)}catch(f){a=a.b[c],a.reject(f.message)}}Ff.prototype.g={IDLE:"idle",hj:"error"};Ff.prototype.j=function(a,b){var c=this.m||(this.m=new rd(this.g.hj));c.data=b;delete this.f[a];this.dispatchEvent(c)};
function Gf(a){var b=x.H.__bootstrap__;b=Ca(b)?(""+b).replace(/^[^{]+{((.|[\r\n])+?)}\s*$/,"$1"):""+b;if(x.Worker&&x.URL)try{var c=new x.Worker(x.URL.createObjectURL(nf(b,"application/javascript")))}catch(d){}c||(a=new Kf(a),function(){eval("var self = arguments[0];"+b)}(a),c=new Lf(a));return c}function Lf(a){F.call(this);this.a=a}u(Lf,F);Lf.prototype.postMessage=function(a){x.setTimeout(A(this.b,this,a),0)};Lf.prototype.b=function(a){var b=new rd("message");b.data=a;this.a.dispatchEvent(b)};
Lf.prototype.terminate=function(){this.a.B();this.B()};function Kf(a){F.call(this);this.a=a;this.addEventListener=A(this.addEventListener,this);this.removeEventListener=A(this.removeEventListener,this);this.postMessage=A(this.postMessage,this);this.eval=A(eval,this)}u(Kf,F);Kf.prototype.postMessage=function(a){var b=new rd("message");b.data=a;x.setTimeout(A(this.a.c,this.a,b),0)};function Mf(){var a=Nf;a||(a=Nf=this,F.call(a),Of(this));return a}var Nf;u(Mf,F);Mf.prototype.u=function(){Mf.l.u.call(this);Of(this)};function Of(a){var b=a.b,c;if(b)for(c=b.length;c--;)b[c].B();a.b=[];Fc(a.b);a.c=mc();a.f=mc()}
Mf.prototype.Zg=function(a){var b;a=a.type;if(b=this.f[a]){var c=this.b;var d=c[0];d||(d=c[0]=new Ff,this.zb(Ja(qd,d)),Ta(this.c)||(c=x.Object.keys(this.c),Jf(d,"0",c)));c=d;c.f[a]||(c.f[a]=b,Jf(c,"1",[a,Ca(b)?b+"":b]).then(hd,A(c.j,c,a)))}else throw new Xc(this.Zg,'Unknown type "'+a+'"');return d};Mf.prototype.Tf=function(){};Mf.prototype.a=function(a,b){var c=this.f,d=c[a];if(d){if(b!==d)throw new Xc(this.a,'Type "'+a+'" is already registered');}else c[a]=b};function Pf(a,b,c){ee.call(this,a,b,c)}var Qf;u(Pf,ee);Pf.prototype.yh=function(){Qf||(Qf=new he(new Mf));return Qf};Pf.prototype.Ie=function(){};Pf.prototype.Lj=function(a){return a.i(this)};function Rf(a,b,c){var d=Yd(+a,-90,90);if(b&&E(d))throw new D(b,c,a);return d}function Sf(a,b,c){var d=+a;if(-180>d||180<d)d=Wd(d+180,360)-180;if(b&&E(d))throw new D(b,c,a);return d}function Tf(a,b,c){var d;if(a!==B&&E(d=+a)&&b)throw new D(b,c,a);return d}function Uf(a,b){return 0!==(0>a^0>b)&&180<Ad(b-a)}t("H.geo.isDBC",Uf);function Vf(){uc(this,Vf)}t("H.geo.AbstractGeometry",Vf);Vf.prototype.getBoundingBox=Vf.prototype.G;Vf.prototype.equals=Vf.prototype.oa;Vf.prototype.rb="";Vf.prototype.Mb="";Vf.prototype.toString=function(){return this.Tc([this.rb.toUpperCase()," "]).join("")};Vf.prototype.toString=Vf.prototype.toString;Vf.prototype.Sc=function(){return{type:this.Mb,coordinates:this.md()}};Vf.prototype.toGeoJSON=Vf.prototype.Sc;Vf.prototype.X=function(){return{type:this.rb,coordinates:this.yc(),boundingBox:this.G().X()}};
Vf.prototype.forWorkerMessage=Vf.prototype.X;function Wf(a,b,c){this.lat=Rf(a,Wf,0);this.lng=Sf(b,Wf,1);c!==B&&(this.alt=Tf(c,Wf,2))}u(Wf,Vf);t("H.geo.Point",Wf);Wf.prototype.oa=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};Wf.prototype.equals=Wf.prototype.oa;Wf.prototype.Za=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*Rd;var c=a.lat*Rd;a=1.274200158E7*Gd(vd(1,Cd(Dd(Fd((b-c)/2),2)+Hd(b)*Hd(c)*Dd(Fd((this.lng*Rd-a.lng*Rd)/2),2))))}return a};
Wf.prototype.distance=Wf.prototype.Za;
Wf.prototype.Ng=function(a,b,c){if(c){if(b/=6371000.79){a*=Rd;var d=Rd*this.lat;var e=Fd(d);var f=Fd(b);var g=Hd(b);var h=Rd*this.lng;var k=Hd(d);d=Gd(k*Hd(a)*f+e*g);a=Kd(Fd(a)*k*f,g-e*Fd(d));a=(h+a+Md)%(2*Md)-Md;k=a*Sd}return b?new Wf(d*Sd,(k+540)%360-180):this}a=(a%360+360)%360;if(0===(a+90)%180)return d=this.lng+b/(6371000.79*Pd*Hd(this.lat*Rd))*(270===a?-360:360),new Wf(this.lat,(d+540)%360-180);if(b/=6371000.79){a*=Rd;h=this.lat*Rd;e=this.lng*Rd;f=h+b*Hd(a);g=f-h;d=Bd(Id(f/2+Od)/Id(h/2+Od));
d=E(g/d)?Hd(h):g/d;var l=b*Fd(a)/d;Ad(f)>Nd&&(f=0<f?Md-f:-(Md+f))}return b?new Wf(f*Sd,((e+l+Qd+(Ad(h+g)>Nd?Md:0))%Pd-Md)*Sd):this};Wf.prototype.walk=Wf.prototype.Ng;Wf.prototype.G=function(){return new K(this.lat,this.lng,this.lat,this.lng)};Wf.prototype.getBoundingBox=Wf.prototype.G;function Yf(a,b,c){var d=Da(a)&&!(E(a.lat=Rf(a.lat))||E(a.lng=Sf(a.lng))||a.alt!==B&&E(a.alt=Tf(a.alt)));if(!d&&b)throw new D(b,c,a);return d}Wf.validate=Yf;
function Zf(a){if(!a)throw new D(Zf,0,a);return new Wf(a.lat,a.lng,a.alt)}Wf.fromIPoint=Zf;n=Wf.prototype;n.rb="Point";n.Tc=function(a){a.push("(",this.lng," ",this.lat,")");return a};n.Mb="Point";n.md=function(){return[this.lng,this.lat,this.alt||0]};n.yc=function(){return[this.lat,this.lng,this.alt||0]};function K(a,b,c,d){$f(this,Rf(a,K,0),Sf(b,K,1),Rf(c,K,2),Sf(d,K,3))}u(K,Vf);t("H.geo.Rect",K);K.prototype.rb="Polygon";K.prototype.Tc=function(a){var b=this.la,c=this.ca,d=this.na,e=this.ia;a.push("(","(",c," ",b,",",e," ",b,",",e," ",d,",",c," ",d,",",c," ",b,")",")");return a};K.prototype.oa=function(a){return this===a||!!a&&this.la===a.la&&this.ca===a.ca&&this.na===a.na&&this.ia===a.ia};K.prototype.equals=K.prototype.oa;K.prototype.clone=function(){return new K(this.la,this.ca,this.na,this.ia)};
K.prototype.clone=K.prototype.clone;function $f(a,b,c,d,e){a.ca=c;a.ia=e;b<d&&(c=b,b=d,d=c);a.la=b;a.na=d;a.c=a.a=a.b=null;return a}K.prototype.Rb=function(){this.c||(this.c=new Wf(this.la,this.ca));return this.c};K.prototype.getTopLeft=K.prototype.Rb;K.prototype.Nb=function(){this.a||(this.a=new Wf(this.na,this.ia));return this.a};K.prototype.getBottomRight=K.prototype.Nb;K.prototype.On=function(){return this.la};K.prototype.getTop=K.prototype.On;K.prototype.Fm=function(){return this.na};
K.prototype.getBottom=K.prototype.Fm;K.prototype.kn=function(){return this.ca};K.prototype.getLeft=K.prototype.kn;K.prototype.En=function(){return this.ia};K.prototype.getRight=K.prototype.En;K.prototype.fb=function(){this.b||(this.b=new Wf(this.na+(this.la-this.na)/2,ag(this.ca,this.Fb())));return this.b};K.prototype.getCenter=K.prototype.fb;K.prototype.Fb=function(){return bg(this.ca,this.ia)};K.prototype.getWidth=K.prototype.Fb;K.prototype.ae=function(){return this.la-this.na};
K.prototype.getHeight=K.prototype.ae;K.prototype.Gb=function(){return this.ca>this.ia};K.prototype.isCDB=K.prototype.Gb;K.prototype.jg=function(){return!this.Fb()&&!this.ae()};K.prototype.isEmpty=K.prototype.jg;K.prototype.G=function(){return new K(this.la,this.ca,this.na,this.ia)};K.prototype.getBoundingBox=K.prototype.G;
K.prototype.Of=function(a,b,c){var d=this.fb();c||(a=Rf(a,this.Of,0),b=Sf(b,this.Of,1));b=this.gd(a,b,c);a=b.fb();return a.lat===d.lat&&a.lng===d.lng&&this.ae()===b.ae()&&this.Fb()===b.Fb()};K.prototype.containsLatLng=K.prototype.Of;K.prototype.pd=function(a,b){b||Yf(a,this.pd,0);return this.Of(a.lat,a.lng,b)};K.prototype.containsPoint=K.prototype.pd;
K.prototype.hh=function(a,b){var c=this.fb();if(!b&&!C(a,K))throw new D(this.hh,0,a);b=this.nc(a,b);a=b.fb();return a.lat===c.lat&&a.lng===c.lng&&this.ae()===b.ae()&&this.Fb()===b.Fb()};K.prototype.containsRect=K.prototype.hh;K.prototype.gd=function(a,b,c,d){if(!c){if(E(a=Rf(a)))throw new D(this.gd,0,a);if(E(b=Sf(b)))throw new D(this.gd,1,b);}return cg(this.la,this.ca,this.na,this.ia,a,b,a,b,d)};K.prototype.mergeLatLng=K.prototype.gd;
K.prototype.Nk=function(a,b,c){b||Yf(a,this.Nk,0);return this.gd(a.lat,a.lng,b,c)};K.prototype.mergePoint=K.prototype.Nk;K.prototype.nc=function(a,b,c){if(!b&&!C(a,K))throw new D(this.nc,0,a);return cg(this.la,this.ca,this.na,this.ia,a.la,a.ca,a.na,a.ia,c)};K.prototype.mergeRect=K.prototype.nc;K.prototype.Ic=function(a,b,c,d,e,f){e||(a=Rf(a,this.Ic,0),b=Sf(b,this.Ic,1),c=Rf(c,this.Ic,2),d=Sf(d,this.Ic,3));return cg(this.la,this.ca,this.na,this.ia,a,b,c,d,f)};K.prototype.mergeTopLeftBottomRight=K.prototype.Ic;
K.prototype.Ad=function(a,b){var c=this.ca<=this.ia,d=a.ca<=a.ia,e=this.ca<a.ia,f=a.ca<this.ia;if(!b&&!C(a,K))throw new D(this.Ad,0,a);return this.na<=a.la&&a.na<=this.la&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};K.prototype.intersects=K.prototype.Ad;function bg(a,b){a=b-a;return a+(0>a?360:0)}function ag(a,b){a+=b/2;return a-(180<a?360:0)}
function cg(a,b,c,d,e,f,g,h,k){c=vd(c,g);a=wd(a,e);e=bg(b,d);var l=ag(b,e);g=bg(f,h);var m=ag(f,g)-l;m+=0>m-1E-6?360:0;if(180>m-1E-6){l=b;var p=h}else m=360-m,l=f,p=d;m=m+e/2+g/2;360<=m+5E-7?(l=-180,p=180):m-5E-7<e?(l=b,p=d):m-5E-7<g&&(l=f,p=h);return k?$f(k,a,l,c,p):new K(a,l,c,p)}K.merge=cg;function dg(a,b,c){c||(Yf(a,dg,0),Yf(b,dg,1));return new K(a.lat,a.lng,b.lat,b.lng)}K.fromPoints=dg;
function eg(a,b){var c=1,d=a.length,e=null;if(!Ba(a))throw new D(eg,0,a);if(0<d){var f=a[0];for(e=dg(f,f,b);c<d;c++)f=a[c],e.gd(f.lat,f.lng,b,e)}return e}K.coverPoints=eg;function fg(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new D(fg,0,a);if(0<d)for(e=new K(a[0],a[1],a[0],a[1]);c<d;c+=3)e.gd(a[c],a[c+1],b,e);return e}K.coverLatLngAlts=fg;
function gg(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new D(gg,0,a);if(0<d)for(e=new K(a[0].la,a[0].ca,a[0].na,a[0].ia);c<d;c++)e.nc(a[c],b,e);return e}K.coverRects=gg;
K.prototype.ml=function(a,b){var c=this.ca,d=this.la,e=this.ia,f=this.na,g=this.fb().lng;Yf(a,this.ml,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?$f(b,d,a,f,e):new K(d,a,f,e)};K.prototype.resizeToCenter=K.prototype.ml;K.prototype.Mb="Polygon";
K.prototype.md=function(){return[[this.ca,this.la,0],[this.ia,this.la,0],[this.ia,this.na,0],[this.ca,this.na,0],[this.ca,this.la,0]]};K.prototype.X=function(){return this.yc()};K.prototype.yc=function(){return[this.la,this.ca,this.na,this.ia]};function hg(a,b,c,d,e,f){uc(this,hg);this.c=a||10;this.b=this.a=null;this.f=d||0;this.g=e||0;this.i=b||1;this.j=c||1;this.o=!!f;this.flush()}function ig(a){var b=a.b;if(a.o&&!b){var c=a.head;if(c.entries||c[0]||c[1]||c[2]||c[3])b=[c],b=jg([b,b,b,b],[c[6],c[7],c[4],c[5]]),a.b=b}return b}
function jg(a,b){var c,d,e,f,g=0;for(c=3;0<=c;c--){var h=c+4;var k=0<c%3;var l=[];var m=b[c];var p=a[c];for(d=p.length;d--;){var q=p[d];if(e=q.entries)for(f=e.length;f--;){var r=e[f].wd(c);if(k?r>m:r<m)m=r}for(f=4;f--;)(e=q[f])&&(k?e[h]>m:e[h]<m)&&l.push(e)}g+=l.length;b[c]=m;a[c]=l}g&&(b=jg(a,b));return b}function kg(a,b,c){var d,e;if(a.o&&(d=a.b))for(e=3;0<=e;e--){var f=b.wd(e);if(e%3?f>=d[e]:f<=d[e])if(c)d[e]=f;else{a.b=null;break}}}
hg.prototype.remove=function(a){var b,c,d,e=!1;a&&(b=a.node)&&b.b===this&&(c=b.entries)&&0<=(d=c.indexOf(a))&&(c.splice(d,1),this.m(b),kg(this,a,!1),e=!0);return e};hg.prototype.flush=function(){var a=new lg(null,NaN,this.f-this.i,this.g-this.j,this.f+this.i,this.g+this.j);a.b=this;this.head=this.a=a;this.b=null};function mg(a,b){var c=a.head,d;if(b){var e=b;if(e!==c)for(c=e;e=e.parent;)if(e.entries||1<e.a)c=e}else for(;!c.entries&&2>(d=c.a);)if(d)c=e;else break;a.head=c}
hg.prototype.ab=function(a,b,c,d,e,f){var g=[],h=this.head,k=this.a;a<=h[5]&&b<=h[6]&&(e?c>=h[7]:c>h[7])&&(f?d>=h[4]:d>h[4])&&ng(this,h,g,a,b,c,d,f||d>=k[6],e||c>=k[5]);return g};
function ng(a,b,c,d,e,f,g,h,k){var l=b.entries,m=b[7],p=b[4],q=b[5],r=b[6],v=b[8],w=b[9],z;if(l){var J=l.length;if(e>p||d>m||g<r||f<q)for(;J--;){m=l[J];p=m.wd(3);q=m.wd(0);r=m.wd(1);var G=m.wd(2);G>=e&&r>=d&&(q<g||h&&q==g)&&(p<f||k&&p==f)&&c.push(m)}else for(;J--;)c.push(l[J])}if(f>v||k&&f==v)e<w&&(z=b[1])&&ng(a,z,c,d,e,f,g,h,k),(g>w||h&&g==w)&&(z=b[3])&&ng(a,z,c,d,e,f,g,h,k);d<v&&(e<w&&(z=b[0])&&ng(a,z,c,d,e,f,g,h,k),(g>w||h&&g==w)&&(z=b[2])&&ng(a,z,c,d,e,f,g,h,k))}hg.prototype.Uc=ba(1);var og=0;
function lg(a,b,c,d,e,f){this.c=b;a&&(this.parent=a,this.b=a.b,b&1?(c=a[8],e=a[5]):(c=a[7],e=a[8]),b&2?(d=a[9],f=a[6]):(d=a[4],f=a[9]));this[7]=c;this[5]=e;this[8]=(c+e)/2;this[4]=d;this[6]=f;this[9]=(d+f)/2}lg.prototype.a=0;function pg(a,b){return a[b]||(++a.a,a[b]=new lg(a,b))}lg.prototype.removeChild=function(a){var b=a.c;this[b]===a&&(delete this[b],delete a.parent,--this.a)};lg.prototype.Uc=ba(0);function qg(a,b){(a.entries||(a.entries=[])).push(b);b.node=a}
function rg(a,b,c,d,e){var f=a[5],g=a[6];return a[7]<=b&&a[4]<=c&&(f>d||f===d&&f===a.b.a[5])&&(g>e||g===e&&g===a.b.a[6])};function sg(a,b,c,d,e,f){sg.l.constructor.apply(this,arguments)}u(sg,hg);sg.prototype.m=function(a){for(var b,c,d=this.head;a;){if(!(b=a.entries)||!b.length)if(b&&delete a.entries,!a.a&&(c=a.parent)){c.removeChild(a);d===a&&(d=c);a=c;continue}a=y}this.head!==d&&(this.head=d,mg(this))};function tg(a,b,c,d,e){if(rg(a.a,b,c,d,e))return ug(a,a.a,b,c,d,e,a.c);throw Error("Coordinates out of bounds");}sg.prototype.Fc=function(a,b){return tg(this,a,b,a,b)};
function ug(a,b,c,d,e,f,g){var h=b[8],k=b[9],l,m;g&&(e<h||(l=c>=h))&&(f<k||(m=d>=k))?c=ug(a,pg(b,l|m<<1),c,d,e,f,g-1):(qg(b,c=new vg(c,d,e,f)),kg(a,c,!0),mg(a,b));return c}function vg(a,b,c,d){this.id=og++;this[0]=b;this[1]=c;this[2]=d;this[3]=a}vg.prototype.wd=function(a){return this[a]};function wg(a){this.f=new sg(+a||10,180,90,0,0,!0);this.c=[];this.g=!1;this.a=this.b=this.R=null}t("H.geo.QuadTree",wg);n=wg.prototype;n.Xh=0;n.bd=function(){return this.Xh};n.Gb=function(){return this.g};
n.G=function(){var a,b;if(!this.R){var c=[];!this.b&&(a=ig(this.f))&&(this.b=new K(-a[0],a[3],-a[2],a[1]));(b=this.b)&&c.push(b);var d,e,f;if(!this.a&&(f=(e=this.c).length)){a=90;var g=360;var h=-90;for(d=0;f--;){var k=e[f];a=vd(a,k[0]);g=vd(g,k[3]);h=wd(h,k[2]);d=wd(d,k[1])}this.a=new K(-a,g,-h,d-360)}(b=this.a)&&c.push(b);if(b=c[0])c[1]&&(b=b.nc(c[1],!0)),this.R=b}return this.R};
function xg(a,b,c,d,e,f){f?(f=new vg(e,-b,c+360,-d),a.c.push(f),a.g=!0,a.a&&a.a.Ic(b,c,d,e,!0,a.a)):(f=tg(a.f,c,-b,e,-d),a.b&&a.b.Ic(b,c,d,e,!0,a.b));++a.Xh;a.R=null;return f}n.Fc=function(a){var b=a.lng;a=a.lat;return xg(this,a,b,a,b,!1)};n.mk=function(a){var b=a.Rb(),c=a.Nb();return(a=a.Gb())?xg(this,b.lat,c.lng,c.lat,b.lng,a):xg(this,b.lat,b.lng,c.lat,c.lng,a)};wg.prototype.insertBoundingBox=wg.prototype.mk;
wg.prototype.remove=function(a){var b;if(a.node){var c=this.f.remove(a);this.b=null}else if(a=(b=this.c).indexOf(a),c=0<=a)b.splice(a,1),this.g=0<b.length,this.a=null;c&&(--this.Xh,this.R=null);return c};wg.prototype.remove=wg.prototype.remove;function yg(a,b,c,d,e,f,g){a=a.c;var h=a.length,k=[],l;if(h){var m=c+360;for(l=e+360;h--;){var p=a[h];zg(p,b,c,d,e,f,g)?k.push(p):zg(p,b,m,d,l,f,g)&&k.push(p)}}return k}
function zg(a,b,c,d,e,f,g){var h=a[3],k=a[0],l=a[1];a=a[2];return(f?k<=d:k<d)&&(g?h<=e:h<e)&&a>=b&&l>=c}function Ag(a,b){var c,d,e;if(c=b.length){var f=a.length;for(d={};f--;)d[a[f].id]=1;for(;c--;)(e=b[c]).id in d||a.push(e)}}wg.prototype.ig=function(a,b,c){var d=this.f,e=a.Rb(),f=a.Nb(),g=-e.lat;e=e.lng;var h=-f.lat;f=f.lng;!b&&g===h||!c&&e===f?a=[]:a.Gb()?(a=d.ab(-180,g,f,h,c,b),Ag(a,d.ab(e,g,180,h,!1,b)),Ag(a,yg(this,g,f,h,e+360,b,c))):(a=d.ab(e,g,f,h,c,b),Ag(a,yg(this,g,e,h,f,b,c)));return a};
wg.prototype.intersectBoundingBox=wg.prototype.ig;function Bg(a){return x.H.gl.flexpolyline.encode(a)}t("H.util.flexiblePolyline.encode",Bg);function Cg(a){return x.H.gl.flexpolyline.decode(a)}t("H.util.flexiblePolyline.decode",Cg);function L(a){L.l.constructor.call(this);a&&Dg(a,L,0);this.Y=a||[];this.a=Eg(this,0,this.Y.length)}u(L,Vf);t("H.geo.LineString",L);function Eg(a,b,c){a=a.Y;var d=0;b=wd(b,0);c=vd(c,a.length);c-=2;for(b+=1;b<c;)d+=Uf(a[b],a[b+=3]);return d}L.prototype.zi=function(a,b,c){Fg(this,a,b,c,this.zi)};L.prototype.pushLatLngAlt=L.prototype.zi;function Fg(a,b,c,d,e){var f=a.Y.length;b=Rf(b,e);c=Sf(c,e);a.Y.push(Rf(b,e),Sf(c,e),d===B?0:Tf(d,e));f&&(a.a+=Uf(a.Y[f-2],c));delete a.R;delete a.b}
L.prototype.Bf=function(a,b,c){c&&Dg(c,this.Bf,2);void 0===b&&(b=this.Y.length);b&&(this.a-=Eg(this,a-3,a+b+3));var d=c?this.Y.splice.apply(this.Y,[a,b].concat(c)):this.Y.splice(a,b);c&&(this.a+=Eg(this,a-3,a+c.length+3));b&&!c&&(this.a+=Eg(this,a-3,a-3));delete this.R;delete this.b;return d};L.prototype.spliceLatLngAlts=L.prototype.Bf;L.prototype.nk=function(a,b,c,d){this.Bf(a,0,[b,c,d])};L.prototype.insertLatLngAlt=L.prototype.nk;L.prototype.il=function(a){this.Bf(a,3)};
L.prototype.removeLatLngAlt=L.prototype.il;L.prototype.Fd=function(a){Fg(this,a.lat,a.lng,a.alt,this.Fd)};L.prototype.pushPoint=L.prototype.Fd;L.prototype.Fc=function(a,b){this.nk(3*a,b.lat,b.lng,b.alt)};L.prototype.insertPoint=L.prototype.Fc;L.prototype.sf=function(a){this.il(3*a)};L.prototype.removePoint=L.prototype.sf;L.prototype.Qe=function(a,b){var c=this.Y,d=3*a;a=c[d];var e=c[d+1];c=c[d+2];b&&(b.lat=a,b.lng=e,b.alt=c);return b||new Wf(a,e,c)};L.prototype.extractPoint=L.prototype.Qe;
L.prototype.tm=function(a,b,c){var d=this.Y;b=b||0;c=Ze(c,d.length/3);for(var e=3*b;b<c;)a(d[e++],d[e++],d[e++],b++)};L.prototype.eachLatLngAlt=L.prototype.tm;L.isDBC=Uf;L.prototype.wh=function(a){var b=this.a;a&&(a=this.Y,b+=Uf(a[a.length-2],a[1]));return b};L.prototype.getDBCs=L.prototype.wh;L.prototype.Ze=function(){return this.Y.length/3};L.prototype.getPointCount=L.prototype.Ze;L.prototype.hn=function(){return this.Y};L.prototype.getLatLngAltArray=L.prototype.hn;L.prototype.R=y;
L.prototype.G=function(){var a;if(!(a=this.R)){a=this.Y;var b=a.length,c=3,d,e,f=y;if(3<=b){var g=d=a[0];var h=e=a[1];for(f=new K(g,h,d,e);c<b;c+=3){g=a[c-3];h=a[c-2];d=a[c];e=a[c+1];if(h>e&&180<e-h||h<e&&-180>h-e||e<h&&180>Ad(e-h)){var k=h;h=e;e=k}g<d&&(k=g,g=d,d=k);cg(f.la,f.ca,f.na,f.ia,g,h,d,e,f)}}a=this.R=f}return a};L.prototype.getBoundingBox=L.prototype.G;L.prototype.Zn=function(){return this.R!==y};L.prototype.hasBoundingBox=L.prototype.Zn;
function Dg(a,b,c){for(var d=a.length,e=!(d%3),f;e&&d;)e=!(E(a[--d]=Tf((f=a[d])===B?0:f))||E(a[--d]=Sf(a[d]))||E(a[--d]=Rf(a[d])));if(!e&&b)throw new D(b,c,a);}function Gg(a){var b=new L,c=0,d=a.length;if(d%2)throw new D(Gg,0,a);for(;c<d;)Fg(b,a[c++],a[c++],0,Gg);return b}L.fromLatLngArray=Gg;L.prototype.oa=function(a){var b=this===a,c;if(!b&&(b=C(a,L))){var d=this.Y;a=a.Y;for(b=(c=d.length)===a.length;b&&c--;)b=d[c]==a[c]}return b};L.prototype.equals=L.prototype.oa;
function Hg(a,b){return a.a-b.a}
function Ig(a,b){var c=a.Y,d=-2,e=[],f;var g=a.b;if(!g){g=a.b=new wg;var h=0;var k=a.Y;var l=k.length;for(f=0;f<l;f+=3){var m=k[f];var p=k[f+1];if(f){if(r<p){var q=r;var r=p}else q=p;if(w<m)var v=m;else{v=w;var w=m}q=xg(g,v,q,w,r,180<r-q);q.a=h++}w=m;r=p}}g=g.ig(b).sort(Hg);k=g.length;for(b=0;b<k;b++){h=g[b];h=h.a;l=3*h;if(h>d+1){var z=[c[l],c[l+1]];e.push(z)}d=h;z.push(c[l+3],c[l+4])}if(a.a){c=[];d=e.length;for(b=0;b<d;b++)if(z=e[b],g=z.length){k=[];for(a=0;a<g;a+=2)h=z[a],l=z[a+1],k.push(h,l),f=
z[a-1],a&&Uf(l,f)&&(c.push(k),k=[],f+=0>f?360:-360,k.push(z[a-2],f,h,l));c.push(k)}e=c}return e}n=L.prototype;n.rb="LineString";n.Tc=function(a,b){var c=this.Y,d=c.length,e;if(d){a.push("(");for(e=0;e<d;e+=3)e&&a.push(","),a.push(c[e+1]," ",c[e]);b&&(c[0]!==c[d-3]||c[1]!==c[d-2])&&a.push(",",c[1]," ",c[0]);a.push(")")}else a.push("EMPTY");return a};n.Mb="LineString";n.md=function(){var a=[],b=this.Y,c=b.length,d;for(d=0;d<c;d+=3)a.push([b[d+1],b[d],b[d+2]]);return a};
n.yc=function(){var a=this.Y,b;if(this.G().Gb()){a=a.slice();var c=1;for(b=a.length;c<b;c+=3)0>a[c]&&(a[c]+=360)}return a};n.lp=function(a){a=void 0===a?5:a;for(var b=this.Y,c=b.length,d=[],e=0;e<c;e+=3)d.push([b[e],b[e+1],b[e+2]]);return Bg({polyline:d,precision:a,thirdDim:2,thirdDimPrecision:a})};L.prototype.toFlexiblePolyline=L.prototype.lp;
function Jg(a){var b=Cg(a);a=b.polyline;var c=b.thirdDim;b=2===c||3===c;c=0===c;if(!a)throw new D(Jg,0,"data");if(b||c){c=a.length;var d=Array(3*c);for(var e=0,f=0;e<c;e++){var g=a[e];d[f++]=g[0];d[f++]=g[1];d[f++]=b?g[2]:0}}if(!d)throw new D(Jg,0,"only ABSENT, ALTITUDE or ELEVATION are supported as type of the 3rd dimension");return new L(d)}L.fromFlexiblePolyline=Jg;function Kg(a){Kg.l.constructor.call(this);void 0!==a&&(this.data=a)}u(Kg,F);t("H.map.Feature",Kg);Kg.prototype.getData=function(){return this.data};Kg.prototype.getData=Kg.prototype.getData;Kg.prototype.u=function(){Kg.l.u.call(this);delete this.data};function Lg(){}t("H.map.provider.Invalidations",Lg);Lg.MARK_INITIAL=Ud;Lg.prototype.update=function(a,b){b!==Mg.NONE&&(this.a=a,b&Mg.SPATIAL&&(this.f=a),b&Mg.VISUAL&&(this.g=a),b&Mg.ADD&&(this.b=a),b&Mg.REMOVE&&(this.c=a),b&Mg.Z_ORDER&&(this.j=a),b&Mg.VOLATILITY&&(this.i=a))};Lg.prototype.update=Lg.prototype.update;Lg.prototype.on=function(){return this.a};Lg.prototype.getMark=Lg.prototype.on;Lg.prototype.a=Ud;Lg.prototype.eo=function(a){return this.a>a};Lg.prototype.isAny=Lg.prototype.eo;
Lg.prototype.g=Ud;Lg.prototype.me=function(a){return this.g>a};Lg.prototype.isVisual=Lg.prototype.me;Lg.prototype.f=Ud;Lg.prototype.Qh=function(a){return this.f>a};Lg.prototype.isSpatial=Lg.prototype.Qh;Lg.prototype.b=Ud;Lg.prototype.pk=function(a){return this.b>a};Lg.prototype.isAdd=Lg.prototype.pk;Lg.prototype.c=Ud;Lg.prototype.kg=function(a){return this.c>a};Lg.prototype.isRemove=Lg.prototype.kg;Lg.prototype.j=Ud;Lg.prototype.Rh=function(a){return this.j>a};Lg.prototype.isZOrder=Lg.prototype.Rh;
Lg.prototype.i=Ud;Lg.prototype.ko=function(a){return this.i>a};Lg.prototype.isVolatility=Lg.prototype.ko;var Mg={NONE:0,VISUAL:1,SPATIAL:2,ADD:4,REMOVE:8,Z_ORDER:16,VOLATILITY:32};Lg.Flag=Mg;function Ng(a,b,c){Ng.l.constructor.call(this,a);this.oldValue=c;this.newValue=b}u(Ng,rd);t("H.util.ChangeEvent",Ng);function M(a){uc(this,M);M.l.constructor.call(this,a?a.data:B);this.N=Og.next();if(a){var b="min";Cc(a[b])&&(this.v=a[b]);b="max";Cc(a[b])&&(this.s=a[b]);b="visibility";b in a&&(this.c=!!a[b]);b="volatility";b in a&&(this.C=!!a[b]);b="zIndex";b in a&&(this.o=+a[b]||0);b="provider";b in a&&!C(a[b],N)&&(this.a=a[b],this.wa(Mg.ADD))}}u(M,Kg);t("H.map.Object",M);var Og=new af(1),Pg={ANY:31,OVERLAY:1,SPATIAL:2,MARKER:4,DOM_MARKER:8,GROUP:16};M.Type=Pg;M.prototype.gb=function(){return this.N};
M.prototype.getId=M.prototype.gb;M.prototype.Qi=function(a){if(!Cc(a)&&!zc(a))throw new D(this.Qi,0,"id must be a number or a string");this.m=a;return this};M.prototype.setRemoteId=M.prototype.Qi;M.prototype.Dn=function(){return this.m};M.prototype.getRemoteId=M.prototype.Dn;M.prototype.v=-1/0;M.prototype.s=1/0;M.prototype.Vj=function(a){var b=this.s;if(a)for(a=this;a=a.Ha;)b=vd(b,a.s);return b};M.prototype.getMax=M.prototype.Vj;
M.prototype.Xj=function(a){var b=this.v;if(a)for(a=this;a=a.Ha;)b=wd(b,a.v);return b};M.prototype.getMin=M.prototype.Xj;M.prototype.c=!0;M.prototype.wb=function(a){var b=this.c;(a=!!a)^b&&(this.c=a,this.invalidate(Mg.VISUAL));return this};M.prototype.setVisibility=M.prototype.wb;M.prototype.Dc=function(a){for(var b=this,c;(c=b.c)&&a&&(b=b.Ha););return c};M.prototype.getVisibility=M.prototype.Dc;M.prototype.C=!1;M.prototype.fg=function(a){for(var b=this,c;!(c=b.C)&&a&&(b=b.Ha););return c};
M.prototype.getVolatility=M.prototype.fg;M.prototype.El=function(a){var b=this.C;b^a&&(this.C=!b,this.invalidate(Mg.VOLATILITY));return this};M.prototype.setVolatility=M.prototype.El;M.prototype.o=B;M.prototype.fk=function(){return this.o};M.prototype.getZIndex=M.prototype.fk;M.prototype.ye=function(a){a!==this.o&&(this.uf(),this.o=a,this.invalidate(Mg.Z_ORDER));return this};M.prototype.setZIndex=M.prototype.ye;M.prototype.J=B;
M.prototype.ed=function(){var a=this.J,b,c;if(!a){var d=(b=this.o)!==B;(a=this.Ha)?(a=a.ed().slice(),a[0]|=d):a=[d|0];a.push(b||0,0>(c=this.Ti)?this.N:c);this.J=a}return a};M.prototype.getZInfo=M.prototype.ed;M.prototype.uf=function(){this.J=B};function Qg(a,b,c){var d,e;if(!c||a[0]|b[0]){var f=a.length;var g=b.length;var h=vd(f,g);var k=1;for(e=1+c;k<h;k+=e)if(d=a[k]-b[k])return d}return c?0:f-g}M.compareZInfo=Qg;function Rg(a,b){return a.xj(b)}M.compareZOrder=Rg;
M.prototype.xj=function(a){return this.Og-a.Og||Qg(this.ed(),a.ed(),!1)};M.prototype.compareZOrder=M.prototype.xj;n=M.prototype;n.previousSibling=y;n.nextSibling=y;n.Ti=-1;n.Ha=y;n.sn=function(){return this.Ha};M.prototype.getParentGroup=M.prototype.sn;M.prototype.kc=function(){for(var a=this,b;b=a.Ha;)a=b;return a};M.prototype.getRootGroup=M.prototype.kc;M.prototype.contains=function(a){return this===a};M.prototype.contains=M.prototype.contains;
M.prototype.ka=function(a){if(this.Ha)throw new Xc(this.ka,"Not allowed for a child of a group");M.l.ka.call(this,a)};M.prototype.setParentEventTarget=M.prototype.ka;M.prototype.a=y;M.prototype.ga=function(){return this.a};M.prototype.getProvider=M.prototype.ga;
M.prototype.xe=function(a,b){var c=this.a,d;if(d=c!==a){if(b&&(c&&!C(c,N)||a&&!C(a,N)))throw new Xc(b,"Only LocalObjectProvider allows an object transfers");b=this.type!==Pg.GROUP;c&&(this.invalidate(Mg.REMOVE),b&&c.Ia(this));if(this.a=a)b&&a.ea(this),this.za=y,this.invalidate(Mg.ADD)}return d};M.prototype.Pb=function(){return this.za||(this.za=new Lg)};M.prototype.getInvalidations=M.prototype.Pb;M.prototype.wa=function(a){var b=this.ga(),c;(c=!!b)&&b.invalidateObject(this,a);return c};
M.prototype.invalidate=M.prototype.wa;M.prototype.u=function(){this.Ha&&this.Ha.Ia(this);M.l.u.call(this)};M.prototype.setData=function(a){this.data=a;return this};M.prototype.setData=M.prototype.setData;M.prototype.Sc=function(a){if(a&&!Ca(a))throw new D(M.prototype.Sc,0,"opt_callback must be a function");a={type:"Feature",properties:Sg(this,a?a(this.data):this.data,!!a),geometry:this.ba().Sc()};this.m&&(a.id=this.m);return a};M.prototype.toGeoJSON=M.prototype.Sc;
function Sg(a,b,c){if(null===b||b===B)return null;if(0<=Object.keys(b).length&&"[object Object]"!==Object.prototype.toString.call(b))throw Error(Tg(a,c));try{return JSON.stringify(b),b}catch(d){throw Error(Tg(a,c));}}function Tg(a,b){return"Object Remote-Id: "+a.m+" - "+(b?"The value returned by the callback is not a valid JSON object and cannot be set as Feature properties.":"The given object data is not a valid JSON object and cannot be set as Feature properties.")}
M.prototype.X=function(){return{id:this.N,properties:{min:this.Xj(),max:this.Vj(),zIdx:this.o,sIdx:this.Ti,parent:this.Ha?this.Ha.gb():0,visible:this.Dc(),"volatile":this.fg()},type:"Feature"}};M.prototype.forWorkerMessage=M.prototype.X;function Ug(a){var b;if(a){var c=Vg;for(b=C(a,Ug);c--;){var d=Wg[c];if(a.hasOwnProperty(d)){var e=a[d];if(b)this[d]=e;else{if((e=Xg[c](e))===Yg)throw new D(Ug,0,d+": "+a[d]);e!==this[d]&&e!==B&&(this[d]=e)}}}c=b?a.cf:this.lineWidth&&Xe(this.strokeColor);c||(this.cf=c);c=b?a.Sb:Xe(this.fillColor);c||(this.Sb=c);c=b?a.bf:"none"!==this.strokeColor&&this.lineWidth;c||(this.bf=c)}oc(this)}t("H.map.SpatialStyle",Ug);Ug.prototype.Sb=!0;Ug.prototype.cf=!0;Ug.prototype.bf=!0;var Wg="strokeColor fillColor lineWidth lineCap lineJoin miterLimit lineDash lineDashOffset lineHeadCap lineTailCap".split(" ");
Ug.prototype.strokeColor="rgba(0,85,170,.6)";Ug.prototype.strokeColor=Ug.prototype.strokeColor;Ug.prototype.fillColor="rgba(0,85,170,.4)";Ug.prototype.fillColor=Ug.prototype.fillColor;Ug.prototype.lineWidth=2;Ug.prototype.lineWidth=Ug.prototype.lineWidth;Ug.prototype.lineCap="round";Ug.prototype.lineCap=Ug.prototype.lineCap;Ug.prototype.lineJoin="miter";Ug.prototype.lineJoin=Ug.prototype.lineJoin;Ug.prototype.miterLimit=1;Ug.prototype.miterLimit=Ug.prototype.miterLimit;Ug.prototype.po=ff;
Ug.prototype.lineDash=Ug.prototype.po;Ug.prototype.lineDashOffset=0;Ug.prototype.lineDashOffset=Ug.prototype.lineDashOffset;Ug.prototype.qo=B;Ug.prototype.lineHeadCap=Ug.prototype.qo;Ug.prototype.ro=B;Ug.prototype.lineTailCap=Ug.prototype.ro;var Vg=Wg.length;Ug.prototype.oa=function(a){var b=this===a;if(!b&&a){for(b=0;b<Vg;b++){var c=Wg[b];if(this[c]!==a[c])break}b=b===Vg}return b};Ug.prototype.equals=Ug.prototype.oa;Ug.prototype.Rj=function(a){if(a){var b={};Wa(b,this,a)}else b=this;return new Ug(b)};
Ug.prototype.getCopy=Ug.prototype.Rj;
var Yg=oc({}),Xg=[function(a){return a?nc(a):Yg},function(a){return a?nc(a):Yg},function(a){return 0<=a&&100>=a?+a:Yg},function(a){a=nc(a);return"butt"===a||"square"===a||"round"===a||"arrow-head"===a||"arrow-tail"===a?a:Yg},function(a){return"round"===a||"bevel"===a||"miter"===a?a:Yg},function(a){return 0<a&&100>=a?+a:Yg},function(a){return a&&a.every&&a.every(Dc)?a:Yg},function(a){return E(+a)?Yg:+a},function(a){return tc(a)?Xg[3](a):B},function(a){return tc(a)?Xg[3](a):B}];Ug.MAX_LINE_WIDTH=100;
var Zg=new Ug;Ug.DEFAULT_STYLE=Zg;var $g="fillColor strokeColor lineWidth lineCap lineJoin miterLimit lineDashOffset lineDash lineTailCap lineHeadCap".split(" ");Ug.prototype.X=function(){for(var a={},b=$g.length,c;b--;)c=$g[b],a[c]=this[c];return a};Ug.prototype.forWorkerMessage=Ug.prototype.X;function ah(a){var b;if(a){var c=C(a,ah);for(b in a)if(b in this){var d=a[b];d!==this[b]&&("fillColor"===b||0<(d=+d))&&(this[b]=d)}a=c?a.Sb:!!(Xe(this.fillColor)&&this.width&&this.width);a||(this.Sb=a)}oc(this)}t("H.map.ArrowStyle",ah);ah.prototype.Sb=!0;ah.prototype.fillColor="rgba(255,255,255,.75)";ah.prototype.width=1.2;ah.prototype.length=1.6;ah.prototype.frequency=5;ah.prototype.Qj=function(){return new ah(this)};
ah.prototype.oa=function(a){var b=this===a;!b&&a&&(b=a.width===this.width&&a.fillColor===this.fillColor&&a.length===this.length&&a.frequency===this.frequency);return b};ah.prototype.equals=ah.prototype.oa;function bh(a,b){var c;bh.l.constructor.call(this,b);b&&this.rc(b.style);a&&(this.j=!0);b&&(c=b.arrows)&&this.tl(c)}u(bh,M);t("H.map.Spatial",bh);bh.prototype.type=Pg.SPATIAL;bh.prototype.Og=0;bh.prototype.style=Zg;bh.prototype.ua=function(){return this.style};bh.prototype.getStyle=bh.prototype.ua;bh.prototype.rc=function(a){var b=!0;a?this.style=C(a,Ug)?a:new Ug(a):this.style?delete this.style:b=!1;b&&this.invalidate(Mg.VISUAL);return this};bh.prototype.setStyle=bh.prototype.rc;
bh.prototype.Cm=function(){return this.g};bh.prototype.getArrows=bh.prototype.Cm;bh.prototype.tl=function(a){var b=this.g,c=!1;!a&&b?(delete this.g,c=!0):!a||b&&b.oa(a)||(this.g=new ah(a),c=!0);c&&"none"!==this.style.strokeColor&&this.wa(1);return this};bh.prototype.setArrows=bh.prototype.tl;function ch(a,b){var c=!1,d=!1,e;if(b.length){for(c=0;c<b.length;c++)if(b[c]!==dh){d=!0;break}b=a.style;c=d?b.cf||b.Sb&&a.j||(e=a.g||!1)&&b.bf&&e.Sb:b.Sb}return c&&a.Dc(!0)}bh.prototype.j=!1;bh.prototype.ho=function(){return this.j};
bh.prototype.isClosed=bh.prototype.ho;bh.prototype.getGeometriesForTile=bh.prototype.$d;bh.prototype.zh=function(){return y};bh.prototype.getLabels=bh.prototype.zh;function eh(a,b){eh.l.constructor.call(this,a,b)}u(eh,bh);t("H.map.GeoShape",eh);eh.prototype.getBoundingBox=eh.prototype.G;function fh(a,b,c,d){var e=[],f=b.length,g;for(g=0;g<f;g++){var h=b[g];h.length&&e.push(gh(a,h,c,d))}return e}function gh(a,b,c,d){var e,f=[],g=b.length,h=0;a.W=0;for(e=e||0;h<g;)f.push(hh(a,b[h++],b[h++],e,d));c&&f.push(hh(a,b[0],b[1],e,d));return f}function hh(a,b,c,d,e){var f=a.W;f&&180<Ad(f-c)&&(c+=0>f?-360:360);a.W=c;return e.Sh(b,c+d)}
function ih(a,b,c){for(var d=b,e,f=a.length+b,g,h;d--;){b=a[d];g=b.length;for(e=Array(g);g--;)h=b[g],e[g]=new I(h.x+c,h.y);a[--f]=e}}var jh=new L([0,0,0,0,0,0,0,0,0]);function kh(a){uc(this,kh);kh.l.constructor.call(this);this.pa=lh(this,a,this.constructor,0)}u(kh,Vf);t("H.geo.MultiGeometry",kh);kh.prototype.splice=function(a,b,c){a=[a];b!==B&&a.push(b);c&&(b=lh(this,c,this.splice,2),a=a.concat(b));this.R=y;return this.pa.splice.apply(this.pa,a)};kh.prototype.splice=kh.prototype.splice;kh.prototype.pc=function(a){var b=this.pa.length;if(!(0<=a&&a<b))throw new je(this.pc,a,[0,b-1]);this.R=y;return this.pa.splice(a,1)[0]};kh.prototype.removeAt=kh.prototype.pc;
kh.prototype.remove=function(a){a=this.pa.indexOf(a);if(0<=a){var b=this.pa.splice(a,1)[0];this.R=y}return b||y};kh.prototype.remove=kh.prototype.remove;kh.prototype.$m=function(){return this.pa};kh.prototype.getGeometries=kh.prototype.$m;kh.prototype.push=function(a){var b=lh(this,[a],this.push,0)[0];this.R&&(this.R=this.R.nc(a.G()));this.pa.push(b)};kh.prototype.push=kh.prototype.push;
kh.prototype.G=function(){var a;if(!(a=this.R)){a=y;var b,c;if(this.pa.length)for(a=this.pa[0].G(),c=1;c<this.pa.length;c++)if(b=this.pa[c].G())a=a?a.nc(b):b}return this.R=a};kh.prototype.getBoundingBox=kh.prototype.G;kh.prototype.R=y;function lh(a,b,c,d){var e,f=[];if(!yc(b))throw new D(c,d);for(e=0;e<b.length;e++)if(a.a(b[e]))f.push(a.b(b[e]));else throw new D(c,d);return f}kh.prototype.b=function(a){return a};
kh.prototype.oa=function(a){var b=this===a,c;if(!b&&(b=C(a,this.constructor))){var d=this.pa;a=a.pa;for(b=(c=d.length)===a.length;b&&c--;)b=d[c].oa(a[c])}return b};kh.prototype.equals=kh.prototype.oa;n=kh.prototype;n.Tc=function(a){var b=this.pa,c=b.length,d,e,f=!1;if(c){a.push("(");for(d=0;d<c;d++)(e=0<d&&f)&&a.push(","),b[d].Tc(a),"EMPTY"===a[a.length-1]?a.splice(-1-e,1+e):f=!0;f?a.push(")"):a.splice(-1,1,"EMPTY")}else a.push("EMPTY");return a};
n.toString=function(){return this.Tc([this.rb.toUpperCase()," "]).join("")};n.yc=function(){for(var a=[],b=this.pa,c=b.length;c--;)a[c]=b[c].yc();return a};n.X=function(){var a=kh.l.X.call(this);a.type=this.rb;return a};n.md=function(){for(var a=[],b=this.pa,c=b.length;c--;)a[c]=b[c].md();return a};function mh(a){mh.l.constructor.call(this,a)}u(mh,kh);t("H.geo.MultiLineString",mh);mh.prototype.a=function(a){return C(a,L)};mh.prototype.rb="Multi"+L.prototype.rb;mh.prototype.Mb="Multi"+L.prototype.Mb;function nh(a,b){nh.l.constructor.call(this,!1,b);this.da(a)}u(nh,eh);t("H.map.Polyline",nh);nh.prototype.G=function(){return this.eb.G()};nh.prototype.getBoundingBox=nh.prototype.G;nh.prototype.eb=y;nh.prototype.da=function(a){var b=this.da,c,d;if(C(a,mh)){var e=a.pa;if(c=e.length)for(d=0;d<c;d++)oh(e[d],b);else throw new D(b,0);}else oh(a,b);this.zd=!!e;this.eb=a;this.wa(Mg.SPATIAL);return this};nh.prototype.setGeometry=nh.prototype.da;nh.prototype.ba=function(){return this.eb};
nh.prototype.getGeometry=nh.prototype.ba;nh.prototype.clip=function(a){var b=this.eb;return Ig(this.zd?b.pa[0]:b,a)};nh.prototype.clip=nh.prototype.clip;nh.prototype.$d=function(a){var b=this.eb;var c,d=[];if(this.zd)for(b=b.pa,c=b.length;c--;)ph(this,b[c],a,d);else ph(this,b,a,d);return d.length?d:B};nh.prototype.getGeometriesForTile=nh.prototype.$d;function oh(a,b){if(!C(a,L)||2>a.Ze())throw new D(b,0);}
function ph(a,b,c,d){var e=Ig(b,c.bg());if(e.length&&(b=c.dg(),a=fh(a,e,!1,b),e=a.length)){var f=c.af();b=b.w;c.x||ih(a,e,-b);c.x===(1<<c.z)-1&&ih(a,e,b);c=qh(a,f.left,f.top,f.right,f.bottom,!1);c.length&&d.push(new rh(c))}}nh.prototype.X=function(){var a=nh.l.X.call(this),b=a.properties;a.geometry=this.ba().X();b.style=this.ua().X();b.height=0;return a};nh.prototype.forWorkerMessage=nh.prototype.X;var sh;function th(a,b){if(x.URL)return(new x.URL(a,b)).toString();if(!a||!uh(a))return a;if(!b||uh(b))throw new TypeError("Failed to construct 'URL': Invalid base URL");sh||(sh=document.createElement("a"),Fc(sh));var c=sh;c.href=b;"/"!==a[0]?a=c.href.replace(/\/[^\/]*$/,"/")+a:((b=c.origin)||(b=c.protocol+"//"+c.host),a=b+a);return a}function uh(a){var b=!1;"string"===typeof a&&(b=!(-1<a.search(/^(http|https|data|blob):/)||"//"===a.substr(0,2)));return b};function vh(a,b){var c,d=arguments.length,e,f;for(c=1;c<d;c++)if((e=arguments[c])&&e!==a&&e!==g){var g=e;for(f in e){var h=e[f];a[f]!==h&&(wh(h)?wh(a[f])?a[f]=vh(a[f],h):a[f]=qc(h):void 0!==h&&(a[f]=qc(h)))}}return a}t("H.util.webgl.mergeObjects",vh);var xh=mc();function yh(a,b,c){var d=c[a];return b&&d in b&&0>sc.indexOf(d)?(b=b[d],++a<c.length?yh(a,b,c):b):xh}
var zh=yh.bind(null,0),Ah={polygons:1,lines:1,"pattern-lines":1,points:1,text:1,raster:1,custom_icons:1,overlays:1},Bh={data:1,draw:1,enabled:1,filter:1,properties:1},Ch=Object.keys(Bh);function Dh(a,b,c,d,e,f){var g=d[a],h=c[g];if(++a<d.length){var k=b[g]||{};for(c=Ch.length;c--;){var l=Ch[c];if("draw"!==l||!f){var m=h[l];m!==B&&(k[l]=qc(m))}}Dh(a,k,h,d,e,f)}else e?k=qc(h):(k=h,delete c[g]);b[g]=b[g]?vh(b[g],k):k}var Eh=Dh.bind(null,0);function Fh(a,b){a in Ah&&(b[a]=1)}
function Gh(a,b,c){var d,e,f;for(d in a)if(Bh[d]){if("draw"===d){var g=a[d];for(e in g){var h=g[e];(f=h.style)?(h.style=b+f,Fh(f,c)):(delete g[e],g[b+e]=h,Fh(e,c))}}}else Gh(a[d],b,c)}
function Hh(a,b){var c={},d,e,f,g;b+="_";a=vh({},a);if(d=a.styles)for(e in d){var h=d[e];delete d[e];d[b+e]=h;if(f=h.mix)for(zc(f)&&(f=[f]),g=f.length;g--;)Fh(f[g],c),f[g]=b+f[g];if(g=h.base)f||(f=h.mix=[]),f.unshift(b+g),delete h.base,Fh(g,c);Fh(e,c)}else d=a.styles={};if(h=a.layers)for(e in h)f=h[e],delete h[e],(g=f.data)&&!g.layer&&(g.layer=e),h[b+e]=f,Gh(f,b,c);for(e in c)d[b+e]={base:e};return a}
function Ih(a,b){var c=a.sources,d=Object.keys(c)[0],e=vh(c[d],{uid:b});c=a.layers;var f;a.sources={};a.sources[b]=e;for(f in c)a=c[f],a.data?a.data.source===d&&(a.data.source=b):a.data={source:b}}function Jh(a,b){var c;var d=a.textures;var e=a.fonts;for(c in d){var f=d[c];f.url&&(f.url=th(f.url,b))}for(c in e)if(d=e[c],yc(d))for(f=0;f<d.length;f++){var g=d[f];g.url=g.url&&th(g.url,b)}else g=a.fonts[c],g.url=g.url&&th(g.url,b)}
function Kh(a,b){return"function(){return "+("feature."+a+(b||""))+";}"}function Lh(a){return Kh("style."+a,void 0)}function Mh(a,b,c,d){a={base:a,blend:b,blend_order:c};d&&(a.clean_depth=!!d);return a}function Nh(a){var b={};b["translucent-"+(a?"extruded-":"")+"polygons"]={color:Lh("fillColor"),order:1,interactive:!0,extrude:a};return b}function Oh(a,b,c,d){a={data:{source:a,layer:b}};c&&(a.draw=c);d&&(a.filter=d);return a}function wh(a){return Da(a)&&!yc(a)};function Ph(a,b){Ph.l.constructor.call(this);if(b&&uh(b))throw new D(Ph,1,"Base URL must be absolute");this.A=Qh.INIT;this.a=null;this.c=b}u(Ph,F);t("H.map.render.Style",Ph);Ph.prototype.load=Ph.prototype.load;Ph.prototype.getState=function(){return this.A};Ph.prototype.getState=Ph.prototype.getState;Ph.prototype.P=function(a){this.A=a};Ph.prototype.setState=Ph.prototype.P;Ph.prototype.hc=function(){return this.c};Ph.prototype.getBaseUrl=Ph.prototype.hc;Ph.prototype.vd=function(){return qc(this.a)};
Ph.prototype.getConfig=Ph.prototype.vd;Ph.prototype.Jm=function(){return this.a};Ph.prototype.getConfigReference=Ph.prototype.Jm;Ph.prototype.Ld=function(a){this.a=a};Ph.prototype.setConfig=Ph.prototype.Ld;Ph.prototype.Lb=function(a){this.a=null;this.P(Qh.ERROR);var b=Rh;se(this.aa,void 0!==b?String(b):void 0)?this.dispatchEvent(new td(Rh,a,this)):console.error(a)};Ph.prototype.dispatchError=Ph.prototype.Lb;Ph.prototype.u=function(){Ph.l.u.call(this);this.a=null};
var Rh="error",Sh={nd:"change",hj:Rh},Qh={ERROR:-1,INIT:0,LOADING:1,READY:2};Ph.State=Qh;function Th(a,b){Th.l.constructor.call(this,a,b);if(zc(a))Uh.test(a)&&-1===a.indexOf("import:")?(this.f=a,b||(this.j=uh(this.f)?B:this.f)):this.g=a;else if(Da(a))this.Ld(qc(a));else throw new D(Th,0,Vh);}u(Th,Ph);t("H.map.render.webgl.Style",Th);
Th.prototype.load=function(){var a=this,b=this.hc();this.f?(this.P(Qh.LOADING),(new rf("text/plain",this.f)).then(function(c){var d={};return Wh(c,b,!1,(d[b]=!0,d))}).then(function(c){return a.Ld(c)},function(c){return a.Lb(c.message)}),this.f=null):this.g&&(this.P(Qh.LOADING),Wh(this.g,b).then(function(c){return a.Ld(c)},function(c){return a.Lb(c.message)}),this.g=null)};
Th.prototype.zl=function(a,b,c){var d;Xh(this);a=Yh(this,a,this.zl,c);for(c=0;c<a.length;c++){var e=a[c].hb.draw;for(d in e){var f=e[d];wh(f)&&(f.interactive=!!b)}}Zh(this)};Th.prototype.setInteractive=Th.prototype.zl;
Th.prototype.setProperty=function(a,b,c){var d,e=a.split("."),f=0,g=e.length;Xh(this);if(!tc(b))throw new D(this.setProperty,1,"value");if(d=$h(this.a,e)){if(!(d.parent instanceof Object)||d.parent instanceof Array)if(c)e.pop(),e=$h(this.a,e),d.parent=e.parent[e.wg]={};else throw new D(this.setProperty,0,a+" property is not primitive type");d.parent[d.wg]=b}else{for(d=this.a;f!==g-1;)d[e[f]]={},d=d[e[f++]];d[e[f]]=b}ai(this)&&Zh(this)};Th.prototype.setProperty=Th.prototype.setProperty;
Th.prototype.Eh=function(a){Xh(this);return(a=$h(this.a,a.split(".")))?qc(a.node):void 0};Th.prototype.getProperty=Th.prototype.Eh;Th.prototype.removeProperty=function(a){Xh(this);(a=$h(this.a,a.split(".")))&&a.parent&&a.parent.hasOwnProperty(a.wg)&&(delete a.parent[a.wg],ai(this)&&Zh(this))};Th.prototype.removeProperty=Th.prototype.removeProperty;
Th.prototype.Pe=function(a,b,c){var d;Xh(this);var e=this.a;var f=e.layers;var g=Yh(this,a,this.Pe,!1);a=g.length;for(d={};a--;)Eh(d,f,g[a].id,!!b,!!c);c={};g=Object.keys(e);for(a=g.length;a--;){var h=g[a];var k=e[h];c[h]=k===f?d:qc(k)}b||Zh(this);return c};Th.prototype.extractConfig=Th.prototype.Pe;Th.prototype.hf=function(a){Xh(this);if(!Da(a))throw new D(this.hf,0,"config");this.Ld(vh(this.a,a))};Th.prototype.mergeConfig=Th.prototype.hf;Th.prototype.b=ba(2);
Th.prototype.toString=function(){return this.getState()===Qh.READY?x.H.gl.yaml.safeDump(this.a,{lineWidth:120}):""};Th.prototype.u=function(){Th.l.u.call(this);this.g=this.f=null};function ai(a){var b=a.a,c;if(Da(b)){var d;if(d=a.i){b=b&&b.sources;d=!1;for(var e in b)if(b[e].type===a.i){d=!0;break}d=!(b?d:1)}d&&(c="invalid source, the only valid type is "+a.i)}else c=Vh;c&&a.Lb(c);return!c}function Zh(a){a.dispatchEvent(new rd("change",a))}
function Xh(a){if(a.getState()!==Qh.READY)throw new Xc(a.hf,"style is not ready yet");}function Yh(a,b,c,d){var e=[],f=yc(b)?b:[b],g,h;void 0===d&&(d=!0);for(f=f.sort().reverse();g=f.pop();){b=String(g).split(".");a:{var k=a.a;for(var l=b.length;l--&&!Bh[b[l]];);if(k&&0>l&&(k=zh(k.layers,b),wh(k)))break a;k=xh}if(k===xh)throw new D(c,0,'Unresolvable layer ID "'+g+'"');e.push({id:b,hb:k});if(d)for(h in k)!Bh[h]&&wh(k[h])&&f.push(g+"."+h)}return e}
function $h(a,b){var c=0,d;for(d=b.length;c!==d;){var e=b[c++];var f=a;a=f[e];if(!a)break}return c===d?{node:a,parent:f,wg:e}:void 0}var Uh=/^(http[s]?)?.*\.ya?ml/i,Vh="invalid style configuration";
function Wh(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?{}:d;try{var e=x.H.gl.yaml.safeLoad(a,{json:!0})}catch(f){return Promise.reject(f)}return e&&(a=e["import"],zc(a)&&(a=[a]),c&&b&&bi(e,b),delete e["import"],yc(a)&&a.length)?(c=a.reduce(function(f,g){var h=b?th(g,b):g;d[h]||(d[h]=!0,f.push((new rf("text/plain",h)).then(function(k){return Wh(k,h,!0,d)})));return f},[]),Promise.all(c).then(function(f){var g={};f.forEach(function(h){return h&&vh(g,h)});vh(g,e);return g})):Promise.resolve(e)}
function bi(a,b){function c(g){g.url&&(g.url=th(g.url,b))}var d=a&&a.fonts;if(d)for(var e in d)yc(d[e])?d[e].forEach(c):c(d[e]);if(a=a&&a.textures)for(var f in a)c(a[f])}Th.normalize=bi;Th.prototype.Ld=function(a){Th.l.Ld.call(this,a);ai(this)&&(this.P(Qh.READY),Zh(this))};Th.prototype.vd=function(){return Th.l.vd.call(this)};Th.prototype.hc=function(){return this.j||Th.l.hc.call(this)};t("H.map.Style",Th);Th.State=Qh;function qh(a,b,c,d,e,f){var g,h,k=a.length,l,m;if(k)for(g=[];k--;){var p=a[k];var q=p.length;var r=0;for(l=1;l<q;l++)if(m=ci(p[l-1],p[l],c,b,d,e)){var v=m[0];var w=m[1];r&&r.oa(v)?h.push(w):g.push(h=m);r=w;f&&(l=q,k=0)}}else g=a;return g}t("H.math.clipping.clipStrips",qh);
function ci(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var l=a;g=h;a=b;h=k;b=l;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var m=1;a=-a;b=-b;l=f;f=-c;c=-l}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);m&&(a=-a,b=-b);return k?[new I(h,-b),new I(g,-a)]:[new I(g,-a),new I(h,-b)]}
function di(a,b,c){a=ei(a,!0);b=ei(b,!1);var d,e;var f={};var g=d=1;switch(~~(c||0)){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.Qf=fi(b.x,b.y,null,gi(b));a.Qf=fi(a.x,a.y,null,gi(a));for(g=b;g.next;g=g.next)if(!g.ab)for(d=a;d.next;d=d.next)if(!d.ab){var k=hi(g.next);var l=hi(d.next);if(e=ii(g,k,d,l,f)){e=f.dm;var m=f.em;var p=f.rp;var q=f.sp;e=fi(p,q,null,null,null,null,!0,0,0,e);ji(e,g,k);k=fi(p,q,null,null,null,null,!0,0,0,m);ji(k,d,l);e.ki=k;k.ki=e}}f=ce(b,ki(a));
c&&(f=!f);for(g=b;g;g=g.next)g.ab&&(g.oh=f,f=!f);f=ce(a,ki(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.ab&&(d.oh=f,f=!f);li(b);for(li(a);(a=mi(b))!=b;){for(c=null;!a.Mg;a=a.ki){for(f=a.oh;;){c=fi(a.x,a.y,c);c.artificial=a.ab||a.fo;a.Mg=1;a=f?a.next:a.Ub;if(!a)break;if(a.ab){a.Mg=1;break}}if(!a)break}c.li=r;var r=c}return r}}t("H.math.clipping.clipPolygon",di);
function fi(a,b,c,d,e,f,g,h,k,l){a={x:a,y:b,next:c||null,Ub:d||null,li:e||null,ki:f||null,ab:!!g,oh:h||0,Mg:k||0,alpha:l||0};d&&(a.Ub.next=a);c&&(a.next.Ub=a);return a}function hi(a){for(;a&&a.ab;)a=a.next;return a}function gi(a){if(a)for(;a.next;)a=a.next;return a}function mi(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.ab||b.ab&&b.Mg))}return b}function li(a){var b=gi(a);b.Ub.next=a;a.Ub=b.Ub}
function ii(a,b,c,d,e,f){var g,h=b.x-a.x,k=b.y-a.y;var l=d.x-c.x;var m=d.y-c.y;var p=h*m-k*l;if(!p)return 0;l=((c.x-a.x)*m-(c.y-a.y)*l)/p;p=(k*(c.x-a.x)-h*(c.y-a.y))/p;if(0>l||1<l||0>p||1<p)return 0;0===l?g=a:1===l?g=b:0===p?g=c:1===p&&(g=d);if(g&&!f)return g.x+=2.480549651603763E-5,g.y+=7.321997314118067E-5,g.Qf&&(g.Qf.x=g.x,g.Qf.y=g.y),ii(a,b,c,d,e);e.rp=a.x+l*h;e.sp=a.y+l*k;e.dm=l;e.em=p;return 1}function ki(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}
function ji(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.Ub=b.Ub;a.next.Ub=a;a.Ub.next=a}function ei(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=fi(a[e].x,a[e].y,d);c.fo=b;if(c.next=d)d.Ub=c;d=c}return d};function O(a,b){var c;O.l.constructor.call(this);C(a,L,O,0);if(b!==B&&yc(b,O,1)){for(c=0;c<b.length;c++)C(b[c],L,O,1,"index "+c);this.Pa=b}else this.Pa=[];this.cb=a;this.a=[]}u(O,Vf);t("H.geo.Polygon",O);function ni(a){var b=O,c=L,d=a.la,e=a.ca,f=a.na,g=a.ia;e=[d,e,B,d,g,B,f,g,B,f,e,B];180<=a.Fb()&&(e.splice(9,0,f,a=a.fb().lng,B),e.splice(3,0,d,a,B));return new b(new c(e))}O.fromRect=ni;var oi={NORTH:90,SOUTH:-90};O.Direction=oi;O.prototype.Cd=oi.NORTH;
O.prototype.Al=function(a){this.Cd!==a&&(this.R=y,this.a.length=0,this.Cd=a);return this};O.prototype.setPoleCovering=O.prototype.Al;O.prototype.xn=function(){return this.Cd};O.prototype.getPoleCovering=O.prototype.xn;O.prototype.Um=function(){return this.cb};O.prototype.getExterior=O.prototype.Um;O.prototype.xl=function(a){if(!C(a,L))throw new D(this.xl,0,a);this.cb=a;this.R=y};O.prototype.setExterior=O.prototype.xl;O.prototype.en=function(){return this.Pa};O.prototype.getInteriors=O.prototype.en;
O.prototype.Lg=function(a,b,c){var d=arguments.length,e;for(e=2;e<d;e++)C(arguments[e],L,this.Lg,e);var f=this.Pa.splice.apply(this.Pa,arguments);for(e=2;e<d;e++)arguments[e]=B;this.a.splice.apply(this.a,arguments);return f};O.prototype.spliceInteriors=O.prototype.Lg;O.prototype.Vo=function(a){return this.Lg(a,1)[0]};O.prototype.removeInteriorAt=O.prototype.Vo;O.prototype.Uo=function(a){a=this.Pa.indexOf(a);return 0>a?B:this.Lg(a,1)[0]};O.prototype.removeInterior=O.prototype.Uo;
O.prototype.el=function(a){if(!C(a,L))throw new D(this.el,0,a);this.Pa.push(a)};O.prototype.pushInterior=O.prototype.el;O.prototype.G=function(){var a=this.R;a||(this.R=a=pi(this.cb,this.Cd));return a};O.prototype.getBoundingBox=O.prototype.G;n=O.prototype;n.Pj=function(a){var b=this.Pa.length;if(0>a||a>=b)throw new je(this.Pj,a,[0,b-1]);(b=this.a[a])||(this.a[a]=b=pi(this.Pa[a],this.Cd));return b};n.cb=y;n.Pa=[];
function pi(a,b){var c,d,e;if(e=a.G())(c=a.wh(!0))&&(d=a.Ze())&&(e=e.nc(eg([a.Qe(0),a.Qe(d-1)],!0),!0)),360===e.Fb()&&1===c%2&&(e=e.gd(b,0));return e}n.rb="Polygon";n.Tc=function(a){var b=this.Pa,c=b.length,d;if(this.cb.Ze()){a.push("(");this.cb.Tc(a,!0);for(d=0;d<c;d++)b[d].Ze()&&(a.push(","),b[d].Tc(a,!0));a.push(")")}else a.push("EMPTY");return a};n.Mb="Polygon";
n.md=function(){var a,b=[],c=this.Pa,d=this.cb.md();d[0].toString()!==d[d.length-1].toString()&&d.push(d[0]);b.push(d);for(a=0;a<c.length;a++)d=c[a].md(),d[0].toString()!==d[d.length-1].toString()&&d.push(d[0]),b.push(d);return b};n.X=function(){var a=O.l.X.call(this);this.G().Gb()&&(a.type="Multi"+a.type);return a};n.yc=function(){var a=[],b=this.Pa,c=b.length;for(a.push(this.cb.yc());c--;)a[c+1]=b[c].yc();return this.G().Gb()?[a]:a};
n.oa=function(a){var b=!1;if(C(a,O)){var c=a.Pa,d=this.Pa.length;b=c.length;var e=0;for(b=this.cb.oa(a.cb)&&d===b;b&&e<d;)b=b&&this.Pa[e].oa(c[e]),e++}return b};function qi(a,b,c,d){d=void 0===d?!0:d;var e=a.Pa,f=ri.bind(null,b,c);return be(b,c,a.cb.Y,0,!0,3)!==ae.NONE?d?!e.some(f):!0:!1}function ri(a,b,c){return be(a,b,c.Y,0,!0,3)===ae.SURFACE}
function si(a,b){b=b.Y;a=a.cb.Y;var c,d,e=b.length-3,f=a.length-3,g={};for(c=0;c<e;c+=3){var h=b[c];var k=b[c+1];var l=b[c+3];var m=b[c+4];for(d=0;d<f;d+=3){var p=a[d];var q=a[d+1];var r=a[d+3];var v=a[d+4];if(ii({x:k,y:h},{x:m,y:l},{x:q,y:p},{x:v,y:r},g,!0))return!0}}return!1}
function ti(a,b){var c=b.cb,d=b.Pa,e=d.length,f=c.Y,g=f.length,h=a.cb.Y,k=h.length;if(si(a,c))return!0;for(c=0;c<g;c+=3)if(qi(a,f[c],f[c+1]))return!0;for(c=0;c<k;c+=3)if(qi(b,h[c],h[c+1]))return!0;for(c=0;c<e;c++)if(si(a,d[c]))return!0;return!1};function ui(a){ui.l.constructor.call(this,a)}u(ui,kh);t("H.geo.MultiPolygon",ui);ui.prototype.a=function(a){return C(a,O)};ui.prototype.rb="Multi"+O.prototype.rb;ui.prototype.Mb="Multi"+O.prototype.Mb;function rh(a,b,c){this.paths=this.a=a;b!==B&&(this.interiorsIndex=this.b=b);c!==B&&(this.outlinesIndex=this.c=c)}rh.prototype.interiorsIndex=rh.prototype.b=Td;rh.prototype.outlinesIndex=rh.prototype.c=Td;var dh=pc(new rh([])),vi=oc([]);function xi(a,b){var c=b&&(+b.extrusion||+b.extrude),d=b&&+b.elevation,e=0;xi.l.constructor.call(this,!0,b);0<d&&(e+=d,this.f=d);0<c&&(e+=c,this.i=c);if(e>yi)throw new je(xi,e,[0,yi]);C(a,L)?this.da(new O(a)):this.da(a)}u(xi,eh);t("H.map.Polygon",xi);xi.prototype.i=0;xi.prototype.f=0;xi.prototype.eb=y;var yi=2047;xi.MAX_EXTRUDE_HEIGHT=yi;xi.prototype.Gi=function(a){var b=+a;if(b!==a)throw new D(this.Gi,0,a);if(0>b||this.f+b>yi)throw new je(this.Gi,this.f+b,[0,yi]);this.i=b;this.wa(Mg.SPATIAL)};
xi.prototype.setExtrusion=xi.prototype.Gi;xi.prototype.Vm=function(){return this.i};xi.prototype.getExtrusion=xi.prototype.Vm;xi.prototype.Fi=function(a){var b=+a;if(b!==a)throw new D(this.Fi,0,a);if(0>b||this.i+b>yi)throw new je(this.Fi,this.i+b,[0,yi]);this.f=b;this.wa(Mg.SPATIAL)};xi.prototype.setElevation=xi.prototype.Fi;xi.prototype.Sm=function(){return this.f};xi.prototype.getElevation=xi.prototype.Sm;xi.prototype.ba=function(){return this.eb};xi.prototype.getGeometry=xi.prototype.ba;
xi.prototype.da=function(a){if(a===y||C(a,O))var b=!1;else C(a,ui,this.da,0),b=!0;this.zd=b;b=this.eb;this.eb=a;b!==y&&this.wa(Mg.SPATIAL);return this};xi.prototype.setGeometry=xi.prototype.da;xi.prototype.G=function(){return this.ba().G()};xi.prototype.getBoundingBox=xi.prototype.G;
xi.prototype.$d=function(a){var b,c=this.ba(),d,e;if(this.zd){c=c.pa;var f=0;for(e=c.length;f<e;f++)if(d=zi(this,c[f],a,c[f].Cd))b||(b=[]),b.push(d)}else d=this.Xa,d===B&&(d=this.zd?oi.NORTH:this.ba().Cd),(d=zi(this,c,a,d))&&(b=[d]);return b};xi.prototype.getGeometriesForTile=xi.prototype.$d;
function zi(a,b,c,d){var e,f,g=0,h=!0;if(e=Ai(a,b.cb,c,d,b.G())){var k=new rh(e);var l=b.Pa;if(f=l.length)for(k.b=k.a.length;g<f;g++)if(e=Ai(a,l[g],c,d,b.Pj(g)))k.a=k.a.concat(e);f=k.a.length;for(g=0;g<f;g++)if(k.a[g]!==vi){h=!1;break}h&&(k=g%2?dh:B)}return k}
function Ai(a,b,c,d,e){var f=c.af(),g=e,h=g.Fb();var k=[[]];var l=b.Y;var m=[],p=l.length,q,r=!1;for(q=0;q<p;q+=3){var v=l[q];var w=l[q+1];r||180!=Ad(w)||(m.push(v),m.push(w),m.push(v),m.push(-w),r=!0);m.push(v);m.push(w)}l=m;360>h&&-180==g.ca&&(g=new K(g.la,180,g.na,g.ia));360>h&&180==g.ia&&(g=new K(g.la,g.ca,g.na,-180));if(g.Gb()){h=l;v=h.length;l=-1;for(m=0;m<v-2;m+=2)if(Uf(h[m+1],h[m+3])){l=m+2;break}-1===l&&Uf(h[v-1],h[1])&&(l=v);-1!==l&&(p=h[l-2],m=h[l-1],q=h[l%v],r=h[(l+1)%v],180!==Ad(p)&&
180!==Ad(q)&&(w=Ad(q-p),v=Ad(r-m),v+=180<v?-360:0,r=Ad(180-r),r+=180<r?-360:0,v&&r&&(w/=Ad(v)/Ad(r),p=q+(q>p?-w:w),m=0<m?180:-180,h.splice(l,0,p,m,p,-m))));l=h}k[0]=Bi([].concat(l),g.ca);360>g.Fb()&&g.pd(new Wf(g.la,180))&&(l=Bi([].concat(l),g.ia),k.push(l));g=c.dg();a=fh(a,k,!0,g);if(360===e.Fb()&&1===b.wh(!0)%2){b=a;a=c.af();b[0][1].x>b[0][b[0].length-1].x&&(b[0]=b[0].reverse());l=[];h=b[0].length-1;for(k=0;k<h;k++)m=b[0][k],l[k]=new I(m.x-2*g.w,m.y),l[k+h]=new I(m.x-g.w,m.y),l[k+2*h]=new I(m.x,
m.y),l[k+3*h]=new I(m.x+g.w,m.y),l[k+4*h]=new I(m.x+2*g.w,m.y);b[0]=l;k=g.Sh(d,0);k.y=2*a[d===oi.NORTH?"top":"bottom"];d=k.clone();k.x=b[0][b[0].length-1].x+1;d.x=b[0][0].x-1;b[0].push(k,d);a=b}d=f.left;b=f.top;k=f.right;f=f.bottom;if(qh(a,d,b,k,f,!0).length){if(!c.bg().hh(e)){c=a;e=[new I(d,b),new I(k,b),new I(k,f),new I(d,f)];f=[];for(a=c.length;a--;)if(d=di(e,c[a]))for(b=Ci(d),f.push(b);d.li;)d=d.li,b=Ci(d),f.push(b);a=f}}else c=Di(d,b,a[0]),a[1]&&(c^=Di(d,b,a[1])),a=c?[vi]:B;return a}
function Di(a,b,c){var d,e,f;var g=d=c[0].x;var h=e=c[0].y;var k=1;for(f=c.length;k<f;k++){var l=c[k].x;var m=c[k].y;l>d?d=l:l<g&&(g=l);m>e?e=m:m<h&&(h=m)}return g<=a&&a<=d&&h<=b&&b<=e&&ce({x:a,y:b},de(c.concat(c[0])))}function Ci(a){var b=[],c=a;do{var d=xd(100*(c.Mo?c.Mo:c.x))/100;var e=xd(100*(c.No?c.No:c.y))/100;if(!f||.01<Cd(Dd(f.x-d,2)+Dd(f.y-e,2))){var f=new I(d,e);b.push(f)}c=c.next}while(c&&c!==a);return b}xi.prototype.U=y;
function Bi(a,b){var c,d=Number.POSITIVE_INFINITY,e=-1,f=a.length;for(c=0;c<f;c+=2){var g=Ad(a[c+1]-b);g+=180<g?360-g:g;g<d&&(d=g,e=c)}return 0<c?(b=a.splice(e,a.length-e),b.concat(a)):a}
xi.prototype.X=function(){var a=xi.l.X.call(this),b=this.ba(),c=this.zd?b.pa:[b],d,e=a.properties;var f=a.geometry=b.X();e.style=this.ua().X();e.height=this.i+this.f;e.min_height=this.f;if(this.G().Gb()&&(f.type="MultiPolygon",this.zd)){var g=[];c.forEach(function(h,k){d=f.coordinates[k];h.G().Gb()?g=g.concat(d):g.push(d)});f.coordinates=g}return a};xi.prototype.forWorkerMessage=xi.prototype.X;function Ei(a,b,c){Ei.l.constructor.call(this,jh,c);this.Hg(a);this.Pi(b);c&&"precision"in c&&this.Ni(c.precision)}u(Ei,xi);t("H.map.Circle",Ei);Ei.prototype.Hg=function(a){(a=Zf(a)).oa(this.b)||(this.b=a,Fi(this))};Ei.prototype.setCenter=Ei.prototype.Hg;Ei.prototype.fb=function(){return this.b};Ei.prototype.getCenter=Ei.prototype.fb;Ei.prototype.Pi=function(a){if(E(a=Yd(a,0,6371000.79*Md/2)))throw new D(this.Pi,0,a);this.fa!==a&&(this.fa=a,Fi(this))};Ei.prototype.setRadius=Ei.prototype.Pi;
Ei.prototype.Cn=function(){return this.fa};Ei.prototype.getRadius=Ei.prototype.Cn;Ei.prototype.O=60;Ei.prototype.Ni=function(a){if(!Cc(a))throw new D(this.Ni,0,a);this.O!==(a=Yd(xd(a),4,360))&&(this.O=a,Fi(this))};Ei.prototype.setPrecision=Ei.prototype.Ni;Ei.prototype.zn=function(){return this.O};Ei.prototype.getPrecision=Ei.prototype.zn;Ei.prototype.da=function(){return this};Ei.prototype.setGeometry=Ei.prototype.da;Ei.prototype.ba=function(){this.eb||Ei.l.da.call(this,Gi(this));return this.eb};
Ei.prototype.getGeometry=Ei.prototype.ba;function Fi(a){a.eb!==y&&Ei.l.da.call(a,Gi(a))}function Gi(a){var b=a.b,c=b.lat,d=a.fa,e=0,f=new L;if(90===Ad(c))for(c=b.Ng(0,d,!0).lat;360>e;e+=120)f.zi(c,e-180,B);else for(a=a.O,a=360/a;360>e;e+=a)f.Fd(b.Ng(e,d,!0));b=new O(f);0>c&&b.Al(oi.SOUTH);return b};function Hi(a,b){if(!C(a,Element)){Ii.innerHTML=a;a=Ii.firstElementChild;if(!a)throw new D(Hi,0,"No element data");Ii.removeChild(a);var c=!0;Ii.innerHTML=""}this.a=0!==hf(a).length;this.c=c?a:jf(a,x.document,this.a);b&&(c="onAttach",c in b&&wc(a=b[c],"Function",Hi,1,c)&&(this.mi=a),c="onDetach",c in b&&wc(a=b[c],"Function",Hi,1,c)&&(this.b=a))}t("H.map.DomIcon",Hi);var Ii=document.createElement("DIV");Hi.prototype.mi=null;Hi.prototype.b=null;Hi.prototype.Qj=function(a){return jf(this.c,a,this.a)};
Hi.prototype.a=!1;function Ji(a){Ji.l.constructor.call(this,a)}u(Ji,kh);t("H.geo.MultiPoint",Ji);Ji.prototype.a=function(a){return Yf(a)};Ji.prototype.b=function(a){return C(a,Wf)?a:Zf(a)};Ji.prototype.rb="Multi"+Wf.prototype.rb;Ji.prototype.Mb="Multi"+Wf.prototype.Mb;function Ki(a,b){this.w=+a;this.h=+b}t("H.math.Size",Ki);function Li(a,b){var c;var d=a;var e=b||[];if(a!==Mi.NONE){b=c=e.length;if(-1===this.b.indexOf(d))throw new D(Li,0,a);if(!e)throw new D(Li,1,e);for(;c--;)if(E(e[c]))throw new D(Li,1,e);d===Mi.RECT&&3<b&&(e=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]],d=Mi.POLYGON);if(d===Mi.CIRCLE&&2<b&&(a=e[2],0<a)){d=e[0];var f=e[1];c=vd(2*zd(a),40);var g=360/c;for(e=[];c--;){var h=g*c*Rd;e.push(d+Fd(h)*a,f+Hd(h)*a)}d=Mi.POLYGON}if(d!==Mi.POLYGON||!b||e.length%2)throw new D(Li,1,e);this.a=e}}
t("H.map.HitArea",Li);var Mi={NONE:0,RECT:1,CIRCLE:2,POLYGON:3};Li.ShapeType=Mi;Li.prototype.b=[Mi.RECT,Mi.CIRCLE,Mi.POLYGON];Li.prototype.hg=function(a,b,c){return this.a?be(a,b,this.a,c,!0):ae.NONE};Li.prototype.hitTest=Li.prototype.hg;function Ni(a,b){var c;uc(this,Ni);Ni.l.constructor.call(this,b);this.da(a);b&&"icon"in b&&(c=b.icon);this.Pc(c||Oi(this))}u(Ni,M);t("H.map.AbstractMarker",Ni);Ni.prototype.ba=function(){return this.b};Ni.prototype.getGeometry=Ni.prototype.ba;Ni.prototype.da=function(a){var b=this.b;C(a,Wf)||C(a,Ji)?this.b=a:(Yf(a,this.da,0),this.b=Zf(a));b&&this.wa(Mg.SPATIAL);return this};Ni.prototype.setGeometry=Ni.prototype.da;Ni.prototype.G=function(){return this.b.G()};Ni.prototype.Cb=function(){return this.icon};
Ni.prototype.getIcon=Ni.prototype.Cb;Ni.prototype.Pc=function(a){var b=this.icon,c=!b;if(b!==a){if(!this.sk(a)){if(c)throw new D(this.constructor,1,a);throw new D(this.Pc,0,a);}this.icon=a;c||this.wa(Mg.VISUAL)}return this};Ni.prototype.setIcon=Ni.prototype.Pc;function Oi(a){var b=a.g;b||(b=a.constructor.prototype.g=a.f(Pi));return b}
var Pi={svg:'<svg xmlns="http://www.w3.org/2000/svg" width="38" height="47" viewBox="0 0 38 47"><g fill="none"><path fill="#0F1621" fill-opacity=".4" d="M15 46c0 .317 1.79.574 4 .574s4-.257 4-.574c0-.317-1.79-.574-4-.574s-4 .257-4 .574z"></path><path fill="#01b6b2" d="M33.25 31.652A19.015 19.015 0 0 0 38 19.06C38 8.549 29.478 0 19 0S0 8.55 0 19.059c0 4.823 1.795 9.233 4.75 12.593L18.975 46 33.25 31.652z"></path><path fill="#6A6D74" fill-opacity=".5" d="M26.862 37.5l4.714-4.77c3.822-3.576 5.924-8.411 5.924-13.62C37.5 8.847 29.2.5 19 .5S.5 8.848.5 19.11c0 5.209 2.102 10.044 5.919 13.614l4.719 4.776h15.724zM19 0c10.493 0 19 8.525 19 19.041 0 5.507-2.348 10.454-6.079 13.932L19 46 6.079 32.973C2.348 29.495 0 24.548 0 19.04 0 8.525 8.507 0 19 0z"></path></g></svg>',size:new Ki(38,
47),anchor:new I(19,45),hitArea:new Li(Mi.POLYGON,[19,46,2,27,0,18,5,6,19,0,32,5,38,15,36,27,19,47])};Ni.prototype.X=function(){var a=Ni.l.X.call(this),b=this.Cb(),c=b.Db(),d=b.ud();a.geometry=this.ba().X();c&&(b=a.properties.icon={id:b.uid},b.size={w:c.w,h:c.h},b.offset=[c.w/2-(d?d.x:0),c.h/2-(d?d.y:0)]);return a};Ni.prototype.forWorkerMessage=Ni.prototype.X;function Qi(a,b){Qi.l.constructor.call(this,a,b)}u(Qi,Ni);t("H.map.DomMarker",Qi);Qi.prototype.type=Pg.DOM_MARKER;Qi.prototype.Og=2;Qi.prototype.f=function(a){var b=new Hi(a.svg,a);a=a.anchor;b.c.style.margin=-a.y+"px 0 0 -"+a.x+"px";return b};Qi.prototype.sk=function(a){return C(a,Hi)};function Ri(a,b,c,d){Ri.l.constructor.call(this,a,b,c);this.modifiers=d}u(Ri,Ng);t("H.map.ChangeEvent",Ri);var Si={SIZE:1,POSITION:2,HEADING:4,TILT:8,INCLINE:16,ZOOM:32,BOUNDS:64};Ri.Type=Si;Ri.prototype.Zl=Si.SIZE;Ri.prototype.SIZE=Ri.prototype.Zl;Ri.prototype.oj=Si.POSITION;Ri.prototype.POSITION=Ri.prototype.oj;Ri.prototype.ij=Si.HEADING;Ri.prototype.HEADING=Ri.prototype.ij;Ri.prototype.qj=Si.TILT;Ri.prototype.TILT=Ri.prototype.qj;Ri.prototype.jj=Si.INCLINE;Ri.prototype.INCLINE=Ri.prototype.jj;
Ri.prototype.rj=Si.ZOOM;Ri.prototype.ZOOM=Ri.prototype.rj;Ri.prototype.fj=Si.BOUNDS;Ri.prototype.BOUNDS=Ri.prototype.fj;function Ti(){this.a=[];Ti.l.constructor.call(this)}u(Ti,F);t("H.util.OList",Ti);function Ui(a,b,c){a=a.a.length;if(c)var d=a;else if(E(d=0>(d=+b)?wd(0,a+d):vd(a,d)))throw new je(Ti,b,[0,a-1]);return d}Ti.prototype.add=function(a,b){b=Ui(this,b,E(b));this.a.splice(b,0,a);this.dispatchEvent(new Vi(this,this.b.Be,b,a,null,null))};Ti.prototype.add=Ti.prototype.add;function Wi(a,b){var c=a.a.splice(b,1)[0];a.dispatchEvent(new Vi(a,a.b.De,b,null,c,null));return c}
Ti.prototype.pc=function(a){this.get(a);return Wi(this,a)};Ti.prototype.removeAt=Ti.prototype.pc;Ti.prototype.remove=function(a){a=this.indexOf(a);return 0<=a?(Wi(this,a),!0):!1};Ti.prototype.remove=Ti.prototype.remove;Ti.prototype.set=function(a,b){if(0!==this.a.length||0!==a){this.get(a);a=Ui(this,a,!1);var c=this.a[a]}this.a[a]=b;this.dispatchEvent(new Vi(this,this.b.Ee,a,b,c,null));return c};Ti.prototype.set=Ti.prototype.set;Ti.prototype.indexOf=function(a){return this.a.indexOf(a)};
Ti.prototype.indexOf=Ti.prototype.indexOf;Ti.prototype.get=function(a){var b=Ui(this,a,!1),c=this.a;if(b>=c.length)throw new je(this.get,a,[0,c.length-1]);return c[b]};Ti.prototype.get=Ti.prototype.get;Ti.prototype.ln=function(){return this.a.length};Ti.prototype.getLength=Ti.prototype.ln;Ti.prototype.Na=function(){return[].concat(this.a)};Ti.prototype.asArray=Ti.prototype.Na;Ti.prototype.flush=function(){for(var a=this.a.length;a--;)Wi(this,a)};Ti.prototype.flush=Ti.prototype.flush;
Ti.prototype.u=function(){this.flush();Ti.l.u.call(this)};Ti.prototype.b={Be:"add",De:"remove",Ee:"set",wp:"move"};function Vi(a,b,c,d,e,f){Vi.l.constructor.call(this,b,a);this.idx=c;this.added=d;this.removed=e;this.moved=f}u(Vi,rd);var Xi={};t("H.geo.mercator",Xi);Xi.a=function(a){return vd(1,wd(0,.5-Bd(Id(Od+Nd*a/180))/Md/2))};Xi.b=function(a){return a/360+.5};Xi.mg=function(a,b,c){c?(c.x=Xi.b(b),c.y=Xi.a(a)):c=new I(Xi.b(b),Xi.a(a));return c};Xi.latLngToPoint=Xi.mg;Xi.$c=function(a,b){return Xi.mg(a.lat,a.lng,b)};Xi.geoToPoint=Xi.$c;Xi.f=function(a){return 0>=a?90:1<=a?-90:Sd*(2*Jd(Ed(Md*(1-2*a)))-Nd)};Xi.c=function(a){return 360*(1===a?1:Wd(a,1))-180};
Xi.Sa=function(a,b,c){c?(c.lat=Xi.f(b),c.lng=Xi.c(a)):c=new Wf(Xi.f(b),Xi.c(a));return c};Xi.xyToGeo=Xi.Sa;Xi.vg=function(a,b){return Xi.Sa(a.x,a.y,b)};Xi.pointToGeo=Xi.vg;t("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0);t("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);function Yi(a,b){this.projection=a||Xi;this.b=0;this.a=this.exp=Bd(b||256)/Ld;Zi(this);this.y=this.x=0}t("H.geo.PixelProjection",Yi);var $i=Ad(24)+Ad(-8);Yi.prototype.cl=Xi;Yi.prototype.projection=Yi.prototype.cl;Yi.prototype.x=0;Yi.prototype.x=Yi.prototype.x;Yi.prototype.y=0;Yi.prototype.y=Yi.prototype.y;Yi.prototype.pp=Dd(2,$i);Yi.prototype.w=Yi.prototype.pp;Yi.prototype.Xn=Dd(2,$i);Yi.prototype.h=Yi.prototype.Xn;
Yi.prototype.Qa=function(a){if(E(a))throw new D(this.Qa,0,a);var b=this.x/this.w;var c=this.y/this.h;this.b=a;this.a=this.exp+a;Zi(this);this.x=b*this.w;this.y=c*this.h};Yi.prototype.rescale=Yi.prototype.Qa;function Zi(a){a.a>$i&&(a.a=$i);a.w=Dd(2,a.a);a.h=Dd(2,a.a)}Yi.prototype.gk=function(){return this.b||0};Yi.prototype.getZoomScale=Yi.prototype.gk;Yi.prototype.lb=function(a,b){a=this.projection.mg(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Yi.prototype.geoToPixel=Yi.prototype.lb;
Yi.prototype.lf=function(a,b){return this.projection.Sa((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};Yi.prototype.pixelToGeo=Yi.prototype.lf;Yi.prototype.Sa=function(a,b,c){return this.projection.Sa((a+this.x)/this.w,(b+this.y)/this.h,c)};Yi.prototype.xyToGeo=Yi.prototype.Sa;Yi.prototype.Sh=function(a,b,c){a=this.projection.mg(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Yi.prototype.latLngToPixel=Yi.prototype.Sh;
Yi.prototype.qe=function(a){return new I(a.x*this.w-this.x,a.y*this.h-this.y)};Yi.prototype.pointToPixel=Yi.prototype.qe;function aj(a){a=a||{};aj.l.constructor.call(this);this.min=0;this.max=22;this.nm=this.dark=!!a.dark;a.min&&this.Ki(a.min);a.max&&this.Ii(a.max);this.pixelProjection=new Yi(a.projection,a.minWorldSize);a.provider&&(this.a=a.provider,this.g=A(this.g,this),this.a.addEventListener(P.prototype.i.Ea,this.g,!1,this),this.i=A(this.i,this),this.a.addEventListener(P.prototype.i.Ce,this.i,!1,this))}u(aj,F);t("H.map.layer.Layer",aj);aj.prototype.min=0;aj.prototype.min=aj.prototype.min;
aj.prototype.max=22;aj.prototype.max=aj.prototype.max;aj.prototype.ra=y;aj.prototype.pixelProjection=aj.prototype.ra;aj.prototype.b={Ea:"update",Ce:"configchange",nj:"minchange",mj:"maxchange"};aj.prototype.ga=function(){return this.a};aj.prototype.getProvider=aj.prototype.ga;aj.prototype.jo=function(a){return this.min<=a&&a<=this.max};aj.prototype.isValid=aj.prototype.jo;
function bj(a,b,c){var d=a[b],e="min"===b,f=e?a.Ki:a.Ii;if(c!==d)if(e?c<=a.max:c>=a.min)a[b]=c,a.g(),a.i(),a.dispatchEvent(new Ng(e?a.b.nj:a.b.mj,c,d));else throw new D(f,0,"Invalid condition min <= max");return a}aj.prototype.Ki=function(a){return bj(this,"min",+a)};aj.prototype.setMin=aj.prototype.Ki;aj.prototype.Ii=function(a){return bj(this,"max",+a)};aj.prototype.setMax=aj.prototype.Ii;aj.prototype.g=function(){this.dispatchEvent(this.b.Ea)};aj.prototype.i=function(){this.dispatchEvent(this.b.Ce)};
aj.prototype.u=function(){aj.l.u.call(this)};aj.prototype.ta=function(){return null};aj.prototype.getCopyrights=aj.prototype.ta;function cj(a){var b;cj.l.constructor.call(this);this.dispatchEvent=A(this.dispatchEvent,this);if(a){var c=a.length;for(b=0;b<c;b++)this.add(a[b])}}u(cj,Ti);t("H.map.DataModel",cj);function dj(a,b){var c=b.getProvider&&b.getProvider();c&&(ej[c.uid]=c);b.ka(a)}function fj(a){var b=a.getProvider&&a.getProvider();b&&delete ej[b.uid];a.ka(null)}cj.prototype.add=function(a,b){C(a,aj,this.add,0);dj(this,a);cj.l.add.call(this,a,b)};cj.prototype.add=cj.prototype.add;
cj.prototype.set=function(a,b){C(b,aj,this.set,0);dj(this,b);(a=cj.l.set.call(this,a,b))&&fj(a);return a};cj.prototype.set=cj.prototype.set;cj.prototype.pc=function(a){var b;(b=cj.l.pc.call(this,a))&&fj(b);return b};cj.prototype.removeAt=cj.prototype.pc;cj.prototype.remove=function(a){var b;(b=cj.l.remove.call(this,a))&&fj(a);return b};cj.prototype.remove=cj.prototype.remove;cj.prototype.flush=function(){for(var a=this.a.length;a--;)this.pc(a);cj.l.flush.call(this)};cj.prototype.flush=cj.prototype.flush;
var ej={};Fc(ej);function gj(a,b,c){if(a=ej[a])return C(a[b],Function,gj,1,"invalid method"),a[b].apply(a,c)}cj.invoke=gj;function hj(a,b){Ca(a)&&(this.i=a);Cc(b)&&(this.a=b)}t("H.util.Request",hj);hj.State={PENDING:0,PROCESSING:1,COMPLETE:2,CANCELLED:3,ERROR:4};var ij=[0,1,2,3,4];hj.prototype.A=0;hj.prototype.getState=function(){return this.A};hj.prototype.getState=hj.prototype.getState;hj.prototype.P=function(a){if(0>ij.indexOf(a))throw new D(this.P,0,a);if(this.A!==a||1===a&&1<this.a)this.A=a,this.i&&this.i(this)};hj.prototype.a=1;hj.prototype.Pn=function(){return this.a};hj.prototype.getTotal=hj.prototype.Pn;
hj.prototype.b=0;hj.prototype.An=function(){return this.b};hj.prototype.getProcessed=hj.prototype.An;hj.prototype.g=0;hj.prototype.Wm=function(){return this.g};hj.prototype.getFailed=hj.prototype.Wm;function jj(a,b){a.b<a.a&&(tc(b)||(b=2),0===b||1===b||0!==a.A&&1!==a.A||(a.b++,2!==b&&a.g++,a.P(a.b<a.a?1:2)))}hj.prototype.Ie=function(){};hj.prototype.cancel=function(){3!==this.A&&(this.Ie(),this.P(3))};hj.prototype.cancel=hj.prototype.cancel;function kj(){}t("H.util.ICapturable",kj);kj.prototype.capture=function(){};kj.prototype.capture=kj.prototype.capture;t("H.util.Disposable",nd);nd.prototype.zb=nd.prototype.zb;nd.prototype.addOnDisposeCallback=nd.prototype.zb;t("H.util.dispose",qd);nd.prototype.B=nd.prototype.B;nd.prototype.dispose=nd.prototype.B;nd.prototype.u=nd.prototype.u;function lj(a,b){var c=a.L(),d=c.ownerDocument;lj.l.constructor.call(this);this.a=a;this.S=c=c.appendChild(mj(d,"DIV","position:absolute;bottom:0;right:0;left:0px;z-index:1;direction:ltr;pointer-events:none;height:40px-webkit-touch-callout: none;-webkit-user-select:none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select:none;",null,"H_imprint"));this.If=mj(d,"DIV","margin: 0 0 "+nj+"px "+nj+"px;display:inline-block;",oj,"H_logo");c.appendChild(this.If);c=c.appendChild(mj(d,
"DIV","right:0;bottom:0;position:absolute;background-color:rgba(255,255,255,.8);color:#0F1621;padding:2px 16px",null,"H_copyright"));this.g=c.appendChild(mj(d,"A","color:inherit; margin:0px 8px; text-decoration:none; pointer-events:all;","Terms of use"));this.g.target="_blank";this.f=c.appendChild(mj(d,"SPAN","margin:0px 8px"));this.j=Ua(pj);this.Li(b);this.c=A(this.c,this);this.b=A(this.b,this);this.a.addEventListener(this.a.o.lj,this.c);this.a.a.addEventListener("add",this.b);this.a.a.addEventListener("remove",
this.b);this.a.a.addEventListener("set",this.b);this.b()}var qj;u(lj,nd);t("H.map.Imprint",lj);var nj=16,pj={font:'11px "Lucida Grande", Arial, Helvetica, sans-serif',href:"https://legal.here.com/{LN}/terms/serviceterms/{CN}",invert:!1,reportHref:"https://wego.here.com/",locale:"en-US"};
lj.prototype.Li=function(a){var b,c=this.If.firstChild.firstChild.childNodes;a||(this.j=Ua(pj));var d=this.j;for(b in d)a&&b in a&&(d[b]=a[b]);a=(this.Oh=a=d.invert)?rj:sj;c[0].style.fill=a.Fl;c[0].style.fillOpacity=a.Gl;c[1].style.fill=a.Kl;c[1].style.fillOpacity=a.Ll;a=d.locale;tj[a]||(a="en-US",d.locale=a);this.g.innerHTML=tj[a];a=a.split("-");this.g.href=d.href.replace("{LN}",a[0]).replace("{CN}",a[1].toLowerCase());this.S.style.font=d.font};lj.prototype.setOptions=lj.prototype.Li;
function mj(a,b,c,d,e){a=a.createElement(b);c&&(a.style.cssText=c);d&&(a.innerHTML=d);e&&(a.className=e);return a}lj.prototype.L=function(){return this.S};lj.prototype.c=function(){this.f.innerHTML=this.i+" "+this.ta()};lj.prototype.b=function(){this.c();setTimeout(this.c,5E3)};
var oj='<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>',sj=
{Kl:"#0F1621",Ll:.3,Fl:"#fff",Gl:.6},rj={Kl:"#fff",Ll:1,Fl:"#0F1621",Gl:.7},uj="1987&ndash;"+wd(2015,(new Date).getFullYear())+" HERE";lj.prototype.ta=function(){var a=this.a,b=a.vb(),c=a.b.mb().bounds;a=a.a;var d=a.a.length,e={},f=0,g,h,k,l=[uj];if(c)for(;f<d;f++)if(h=a.get(f).getCopyrights(c.G(),b))for(g=0;g<h.length;g++)e[k=h[g].label]||(l.push(k),e[k]=1);return l.join(", ")};lj.prototype.getCopyrights=lj.prototype.ta;lj.prototype.ua=function(){return this.S.style};lj.prototype.i=String.fromCharCode(169);
lj.prototype.u=function(){this.a.removeEventListener(this.a.o.lj,this.c);this.a.a.removeEventListener("add",this.b);this.a.a.removeEventListener("remove",this.b);this.a.a.removeEventListener("set",this.b);if(this.S.parentNode){var a=this.S;a.parentNode.removeChild(a)}};
lj.prototype.capture=function(a,b,c,d){var e=a.getContext("2d"),f=window.getComputedStyle(this.f.parentElement),g=2*Ac(f.paddingLeft,10),h=(this.f.offsetWidth+2*g)*b,k=this.f.offsetHeight*b,l=Bc(f.getPropertyValue("font-size")),m=this.S.ownerDocument,p=+a.width,q=+a.height,r=nj*b,v=this.If.childNodes[0].getBoundingClientRect(),w=v.width*b,z=v.height*b,J=hd;Ca(d)&&(J=function(){d("capture_error")});e.fillStyle=f.backgroundColor;e.fillRect(p-h,q-k,h,k);h=this.i+" "+function(G){G=mj(m,"div",null,G);
return G.textContent||G.innerText||""}(this.ta());e.font=l*b+"px "+f.getPropertyValue("font-family");e.fillStyle=f.getPropertyValue("color");e.textBaseline="bottom";e.textAlign="right";e.fillText(h,p-g*b,q);vj(this,e.font,function(G){(new rf("image",G)).then(function(U){e.drawImage(U,r,q-(z+r),w,z);c(a)},J)},J)};lj.prototype.capture=lj.prototype.capture;
function vj(a,b,c,d){wj(A(function(e){e?this.Oh?c("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAADNklEQVRYR82XW6hVVRSGv7+rmJfSMKSnSkMEfY7EogcJC7tilGRopBAiSaI+SBARQSCIIqgFISih2YW0oAgLCsKXojA0RB+81VugZEFZv/yHuWTt7d7Hfc4+6+h4OWefNfcc3xlj/v+YS1zjoab5bE8DZgGngB8keSg5GwO0PQ54F3i2BnQIWCLpx14hGwG0fT3wOfBwB5DzwOOSDvQC2RTgM8Ae4D/gaeA3YDdwN5AWvyxp+6gD2r4OmAq8AbwInAMmA/OAT4CbgBWStvYClzUjWkHbrwHLgF8LVHJ8DDxah7P9JHCil7M40oA/A7OBC8ANtSqlrQOVs30/8CWQat8r6cxg1RwRQNvPA88Bk4D7gJzBV4A5teSp5MlS4VuA/ZIeu1Kr+wa0/QTwIRDlRhT5eTswBvi2CKOd42AULilndNAYCcA7gK+BmbVMiyXtsh3Qt4FFBTgW8w6wXtLfV4LrSyS2FwAvAWOBX+JtwF0laUDmS/oun23fDNwJnJb0Ty9g1ZphVdB2qrK2LdFfBbb685/AIxXkUKDqa4cMaDs2kjalRe8Fola57J3qRQSJviGHA3gMuAdYI2lDUfDOArQLWAd8VTuTOW9vjUoFy6TIGYpS9wKfAjuK5wVuSfn91iKcvZJeHy5ci0hsZwzNk5Qh3xIFbLyks7aPAtPLgv+L4VZwDwLvA6uKz6XdfcVAi22PBz4q4+lVSRurXW2vKYKIZfwEHCmmXC35HngAyITYD0ys2t8XWflyBfhmvKm24QCk7aVFCPVc7WMszzKucknI+NoHPCUppt13VICZm2nNwjoksByY0SXL72Vi3FieZ97mgrpyqF432H9xScW2O0H+W6oSE/4D2FYuA9kzlUzVTwO3Ad9IOtx3ydo2aLGZLpABm5KW2Z4AfAbMLfsEcpGkKLqRuMwHu0CukrSpCCrvGlF6hBEVL5MUw24kOhp1B8gc+FTqgxpkFLuzSbjk6jpJOkC2tDPeKCkVbDRkO67fDTTC2VK7vgfyBUlfNEpV2zyAK4HNXRLmZfshScdHC6g9T+WDGU2XpkdZdNXhWs6g7dXAhmsJ7jKR2M77bG4kV7Wt9TZfBLgYEC7PSpcIAAAAAElFTkSuQmCC"):c("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIMSURBVFiFzdZPiE1RGADwXzPTTPIMQoodVpbKgpoUG5qExUi8DSVJQv4slJJsbNjYWFhNETWLUUosRDRLUVLCYhIiojFojHkW997uvefNGIuZc99Xp/fOO6/Or++c75xDi0d7hDlWYQNqeB9hvv+OGq6jUWjPsKZKVBbtuKOMy9p3bKqOlsROCWYc27AWr9PfJnCgKlgbluNqivmGDmzBrxR3sCocnMEw7sqXdEAzboeK9uLTFPVbed8VcesxglFJtqNEHbcxlIL68ChADuCSpEgauBULt11SDI3C5yJJdrLCCNsQumMBl+J5AKinY4slBfNTfsRcxJwYsK0YxD3J0r1RPut6Cv/twgp0xoDBBc3LNhr0RwJktNifAn7gsnLmsuxVinyVTn4i7dcLoH4sU96Tp2Pi2uSVehN75Gdev+QO7pIXztmZnLwTvf+AzU+/v5Rn50+A24gP2IW5M4mbJ7+ejgVjJ/EpHXuCa8p77nGK68FX5eWfsTgfTJoh92qu1vAaa+CtPJuDZuEh3CHZUyHyxSSYrL3DWKE/gStm8aybDDkmKYperJM/BrJMnsJuHMLq2YJNh/wsX7JuPAyQfTFg0yGPFMZreCCv4n2xgTQjxyXP+CxquK8iXBYhMlzOtliQBVg4RVuCG/iSto/YHAuWxWFTHyXDWBkbNFkc1cK4LI5rYVwW57QY7i/pZeJv8QQJRQAAAABJRU5ErkJggg=="):
(e=this.If.cloneNode(!0),e.firstChild.setAttribute("style","font:"+b),c($e(e.innerHTML)))},a),d)}lj.prototype.Oh=!1;function wj(a,b){var c="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(oj),d=qj;tc(d)?a(d):(new rf("image",c)).then(function(e){We.drawImage(e,0,0);try{We.getImageData(0,0,1,1),d=!1}catch(f){d=18===f.code}finally{qj=d,a(d)}},b)}lj.prototype.bm=function(a,b){tj[a]=b};lj.prototype.addL11NString=lj.prototype.bm;
var tj={"de-DE":"Nutzungsbedingungen","en-US":"Terms of use","en-GB":"Terms of use","es-ES":"Condiciones de uso","fi-FI":"Palveluehdot","fr-FR":"Conditions d'utilisation","it-IT":"Condizioni di utilizzo","nl-NL":"Dienstvoorwaarden","pl-PL":"Warunki \u015bwiadczenia us\u0142ugi","pt-BR":"Termos de servi\u00e7o","pt-PT":"Termos do servi\u00e7o","ru-RU":"\u0423\u0441\u043b\u043e\u0432\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f","tr-TR":"Servis Ko\u015fullar\u0131",
"zh-CN":"\u4f7f\u7528\u6761\u6b3e"};function Q(a){var b={};this.i=b.previousSibling=b.nextSibling=b;this.j=new af;Q.l.constructor.call(this,a);a&&"objects"in a&&this.fc(a.objects)}u(Q,M);t("H.map.Group",Q);Q.prototype.type=Pg.GROUP;Q.prototype.xe=function(a,b){this.f=!0;a=Q.l.xe.call(this,a,b);this.f=!1;a&&this.forEach(xj,!0);return a};Q.prototype.setProvider=Q.prototype.xe;function xj(a,b,c){a.xe(c.a)}Q.prototype.contains=function(a){var b=this===a;if(!b&&this.b&&C(a,M))for(;!b&&a;)a===this?b=!0:a=a.Ha;return b};
Q.prototype.contains=Q.prototype.contains;Q.prototype.uf=function(){this.J=B;this.forEach(yj,!0)};Q.prototype.resetZInfo=Q.prototype.uf;function yj(a){a.uf()}Q.prototype.f=!1;Q.prototype.wa=function(a){var b=Q.l.wa.call(this,a);b&&!this.f&&(this.g=a,this.forEach(zj,!0),delete this.g);return b};Q.prototype.invalidate=Q.prototype.wa;function zj(a,b,c){a.wa(c.g)}
Q.prototype.forEach=function(a,b,c){var d;if(this.b){var e=this.i;var f=e.nextSibling;for(d=0;f!==e;){var g=f.nextSibling;a.call(c,f,d++,this);b&&C(f,Q)&&f.forEach(a,b,c);f=g}}};Q.prototype.forEach=Q.prototype.forEach;Q.prototype.Va=function(a){var b=[];this.forEach(Aj,a,b);return b};Q.prototype.getObjects=Q.prototype.Va;Q.prototype.G=function(){var a=null;this.b&&this.forEach(function(b){(b=b.G())&&(a?a=a.nc(b):a=b)});return a};Q.prototype.getBoundingBox=Q.prototype.G;
function Aj(a){this.push(a)}Q.prototype.b=0;Q.prototype.Hm=function(){return this.b};Q.prototype.getChildCount=Q.prototype.Hm;
Q.prototype.ea=function(a){var b=this.i,c=b.previousSibling;C(a,M,this.ea,0);if(a.contains(this))throw new Xc(this.ea,"The new object contains the parent group");var d=a.fg(!0);var e=a.Ha;if(e!==this){if(e){e=a.previousSibling;var f=a.nextSibling;e.nextSibling=f;f.previousSibling=e}a.Ha=this;M.l.ka.call(a,this);c.nextSibling=a;a.previousSibling=c;a.nextSibling=b;b.previousSibling=a;this.b++}a.Ti=this.j.next();a.uf();b=a.xe(this.a,this.ea);a.fg(!0)^d&&a.wa(Mg.VOLATILITY);b||a.wa(Mg.Z_ORDER);return a};
Q.prototype.addObject=Q.prototype.ea;Q.prototype.fc=function(a){var b;yc(a,this.fc,0);var c=a.length;for(b=0;b<c;b++)this.ea(a[b])};Q.prototype.addObjects=Q.prototype.fc;Q.prototype.Ia=function(a){if(!a||a.Ha!==this)throw new Xc(this.Ia,"object not found");var b=a.previousSibling,c=a.nextSibling;b.nextSibling=c;c.previousSibling=b;a.Ha=null;M.l.ka.call(a,null);delete a.previousSibling;delete a.nextSibling;C(a.a,N)&&a.xe(null,this.Ia);this.b--;return a};Q.prototype.removeObject=Q.prototype.Ia;
Q.prototype.Gd=function(a){var b;yc(a,this.Gd,0);var c=a.length;for(b=0;b<c;b++)this.Ia(a[b])};Q.prototype.removeObjects=Q.prototype.Gd;Q.prototype.qa=function(){var a=this.Va();this.Gd(a)};Q.prototype.removeAll=Q.prototype.qa;
Q.prototype.Sc=function(a){for(var b=this.Va(),c=0,d=b.length,e=[],f,g,h;c<d;c++)h=b[c],h instanceof Q?(f=a?a(h.getData()):h.getData(),g=Sg(this,f,!!a),f={type:"Feature"},f.properties=g,h.m&&(f.id=h.m),f.geometry={},f.geometry.type="GeometryCollection",f.geometry.geometries=Bj(this,h.Va()),e.push(f)):e.push(h.Sc(a));return{type:"FeatureCollection",features:e}};Q.prototype.toGeoJSON=Q.prototype.Sc;
function Bj(a,b){for(var c=0,d=b.length,e,f,g=[];c<d;c++)e=b[c],f={},e instanceof Q?(f.type="GeometryCollection",f.geometries=Bj(a,e.Va())):f=e.ba().Sc(),g.push(f);return g}Q.prototype.X=function(){var a=Q.l.X.call(this);a.type="Group";return a};Q.prototype.forWorkerMessage=Q.prototype.X;var Cj={PROVIDES_BY_VIEWPORT:1,PROVIDES_RASTERS:2,PROVIDES_SPATIALS:4,PROVIDES_OVERLAYS:8,PROVIDES_MARKERS:16,PROVIDES_DOM_MARKERS:32,PROVIDES_GEOJSON:64,PROVIDES_OMV:128,CROP_LINES_BY_TILE:256,CROP_POLYGONS_BY_TILE:512,HAS_VOLATILE_DATA:1024};t("H.map.provider.Capabilities",Cj);Cj.PROVIDES_WEBGL_RENDERABLE_OBJECTS=Cj.PROVIDES_SPATIALS|Cj.PROVIDES_OVERLAYS|Cj.PROVIDES_MARKERS;function Dj(a,b,c,d,e){b&&(this.b=b);tc(c)&&(this.$g=!!c);this.$g&&d&&(this.ah=new Ki(d.w,d.h));tc(e)&&(this.c={crossOrigin:e});switch(Ej[xc(a)]){case 2:this.Dd=a;Fj(this,1);break;case 1:if(lf(a)){this.Dd=a;Gj(this);Fj(this,1);break}a=a.src;case 0:if(a){a=$e(a);this.a=new rf("image",a,B,this.c);this.a.then(A(this.Jo,this),A(this.Io,this));break}default:throw Fj(this,-1),new D(Dj,0,"No image data");}}n=Dj.prototype;n.A=0;n.getState=function(){return this.A};
function Fj(a,b){a.A=b;delete a.a;a.b&&a.b(b,a)}n.$g=!0;function Gj(a){if(a.$g){var b=a.Dd,c=Hj(a),d=c&&c.w||+b.width,e=c&&c.h||+b.height,f=Se();if(C(b,x.HTMLCanvasElement))c=b;else{c=b.ownerDocument.createElement("canvas");c.width=zd(d*f);c.height=zd(e*f);var g=c.getContext("2d");g.scale(f,f);g.drawImage(b,0,0,d,e);Zc&&(g.clearRect(0,0,d,e),g.drawImage(b,0,0,d,e))}a.Dd=c}}n.Dd=y;n.getData=function(){return this.Dd};var Ej={String:0,HTMLImageElement:1,HTMLCanvasElement:2};n=Dj.prototype;n.ah=y;
n.Db=function(){return 1===this.A?Hj(this):y};function Hj(a){var b=a.ah,c;if(!b){var d=a.Dd;b=d.naturalWidth||d.width;if(0===b&&Ye&&1===Ej[xc(d)]){var e=!0;if(c=d.parentNode)var f=d.nextSibling;document.body.appendChild(d)}a.ah=b=new Ki(d.naturalWidth||d.width,d.naturalHeight||d.height);e&&(c?c.insertBefore(d,f):document.body.removeChild(d))}return b}n.Jo=function(a){this.Dd=a;Gj(this);Fj(this,1)};n.Io=function(){Fj(this,-1)};n.cancel=function(){this.a&&this.a.cancel()};function Ij(a,b){var c,d="anonymous";this.uid=Jj.next();Ij.l.constructor.call(this);if(b){var e="size";if(e in b){var f=b[e];if(!f||isNaN(f.w)||isNaN(f.h))throw new D(Ij,1,e);this.c=new Ki(f.w,f.h)}e="anchor";if(e in b){f=b[e];if(!f||isNaN(f.x)||isNaN(f.y))throw new D(Ij,1,e);this.b=new I(f.x,f.y)}e="hitArea";e in b&&(f=b[e],C(f,Li,Ij,1),this.g=b[e]);e="asCanvas";e in b&&(c=b[e]);e="crossOrigin";e in b&&(d=b[e]);f=b.stickHeight;f===+f&&0<f&&(this.hp=f);e="stickColor";f=b[e];e in b&&zc(f)&&(this.gp=
f)}a=new Dj(a,A(this.i,this),c,this.c,d);b=this.A=a.getState();0!==b?this.i(b,a):this.f=a}u(Ij,F);t("H.map.Icon",Ij);var Jj=new af;Ij.State={ERROR:-1,LOADING:0,READY:1};Ij.prototype.getState=function(){return this.A};Ij.prototype.getState=Ij.prototype.getState;Ij.prototype.i=function(a,b){this.a=b.getData();if(1===a){var c=this.c;c||(c=this.c=b.Db());this.b||(this.b=new I(c.w/2|0,c.h))}this.f&&(this.A=a,delete this.f,this.dispatchEvent("statechange"))};Ij.prototype.a=y;Ij.prototype.ad=function(){return this.a};
Ij.prototype.getBitmap=Ij.prototype.ad;Ij.prototype.c=y;Ij.prototype.Db=function(){return this.c};Ij.prototype.getSize=Ij.prototype.Db;Ij.prototype.b=y;Ij.prototype.ud=function(){return this.b};Ij.prototype.getAnchor=Ij.prototype.ud;Ij.prototype.g=y;Ij.prototype.an=function(){return this.g};Ij.prototype.getHitArea=Ij.prototype.an;Ij.prototype.u=function(){Ij.l.u.call(this);this.a?(this.a.removeAttribute("src"),delete this.a):(this.f.cancel(),delete this.f)};function Kj(a,b,c,d,e,f){Kj.l.constructor.call(this,isNaN(a)?15:a,b,c,d,e,f)}u(Kj,hg);Kj.prototype.m=function(a){for(var b,c,d,e=this.head;a;){if(b=a.entries)if(c=b.length){if(2>c&&(d=a.parent)&&1===d.a){d.removeChild(a);e===a&&(e=d);d.entries=b;a=b[0].node=d;continue}}else if(delete a.entries,d=a.parent)if(d.removeChild(a),e===a&&(e=d),1===d.a){a=d.a?d[0]||d[1]||d[2]||d[3]:null;continue}a=y}this.head!==e&&(this.head=e,mg(this))};
Kj.prototype.Fc=function(a,b){if(rg(this.a,a,b,a,b))return Lj(this,this.a,a,b,this.c);throw Error("Coordinates out of bounds");};function Lj(a,b,c,d,e){var f=b.entries;if(e)if(b.a)f=Mj(a,b,c,d,e);else if(f){f=f[0];var g=pg(b,f[1]>=b[8]|(f[0]>=b[9])<<1);g.entries=b.entries;delete b.entries;f.node=g;mg(a,g);f=Mj(a,b,c,d,e)}else qg(b,f=new Nj(c,d)),mg(a,b),kg(a,f,!0);else f||mg(a,b),qg(b,f=new Nj(c,d)),kg(a,f,!0);return f}function Mj(a,b,c,d,e){return Lj(a,pg(b,c>=b[8]|(d>=b[9])<<1),c,d,e-1)}
function Nj(a,b){this.id=og++;this[0]=b;this[1]=a}Nj.prototype.wd=function(a){return this[a%2]};function Oj(){this.a=new Kj(10,180,90,0,0,!0)}n=Oj.prototype;n.Wh=0;n.bd=function(){return this.Wh};n.R=null;n.G=function(){var a=this.R,b;!a&&(b=ig(this.a))&&(this.R=a=new K(-b[0],b[3],-b[2],b[1]));return a};n.Fc=function(a){++this.Wh;this.R=null;return this.a.Fc(a.lng,-a.lat)};n.remove=function(a){if(a=this.a.remove(a))--this.Wh,this.R=null;return a};
n.ig=function(a,b,c){var d=this.a,e=a.Rb(),f=a.Nb(),g=-e.lat;e=e.lng;var h=-f.lat;f=f.lng;var k;a.Gb()?k=d.ab(-180,g,f,h,c,b).concat(d.ab(e,g,180,h,c,b)):k=d.ab(e,g,f,h,c,b);return k};function Pj(a,b,c){this.c=a;this.a=b;this.g=c;this.f=this.c&Cj.PROVIDES_BY_VIEWPORT?"function(){return sources[$source].isInMinMaxRange(feature, $zoom) && feature.ref.effectiveVisibility;}":B;this.b={}};function Qj(a,b,c,d){this.a=a;this.b=b;this.c=c;this.Df=d}function Rj(a,b,c,d){a={type:b,uid:a.b,tiled:c,max_zoom:a.c};d&&Wa(a,d);return a};function Sj(a){this.a=a};function Tj(a,b,c,d,e){this.a=a;this.b=b;this.c=c;this.f=d;this.Df=e}
function Uj(a){if(a.a&Cj.PROVIDES_DOM_MARKERS&&!(a.a&Cj.PROVIDES_MARKERS))return{};var b=new Qj(a.a,a.b,a.c,a.Df);var c=new Sj(a.a);a=new Pj(a.a,a.b,a.f);var d={},e=b.b;b=b.a&Cj.PROVIDES_BY_VIEWPORT?Rj(b,"ObjectSource",!1,{progressiveUpdate:!0,has_volatile_data:!!(b.a&Cj.HAS_VOLATILE_DATA)}):b.a&Cj.PROVIDES_RASTERS?Rj(b,"RemoteRasterTileSource",!0,{url:""}):Rj(b,"ObjectTileSource",!0,{tile_size:b.Df});d[e]=b;b={};c.a&Cj.PROVIDES_RASTERS&&(b={"translucent-raster":Mh("raster","inlay",1)});if(c.a&Cj.PROVIDES_WEBGL_RENDERABLE_OBJECTS){e=
!!(c.a&Cj.CROP_LINES_BY_TILE);var f={"translucent-polygons":Mh("polygons","inlay",2),"translucent-extruded-polygons":Mh("polygons","translucent",3),"translucent-pattern-lines":Mh("pattern-lines","translucent",4),"translucent-overlays":Mh("overlays","inlay",5),markers:Mh("custom_icons","overlay",6,!1)};f["translucent-polygons"].crop_by_tile=!!(c.a&Cj.CROP_POLYGONS_BY_TILE);f["translucent-pattern-lines"].crop_by_tile=e;f.markers.suppress_fade=!0;f.markers.stick=!0;Wa(b,f)}a.c&Cj.PROVIDES_RASTERS&&(a.b["tile_layer_"+
a.a]=Oh(a.a,"_default",{"translucent-raster":{color:[1,1,1,a.g],order:0}}));if(a.c&Cj.PROVIDES_SPATIALS){c={"translucent-pattern-lines":{color:Lh("strokeColor"),width:Lh("lineWidth * $meters_per_pixel"),join:Lh("lineJoin"),cap:Lh("lineCap"),tail_cap:Lh("lineTailCap"),head_cap:Lh("lineHeadCap"),miter_limit:Lh("miterLimit"),order:"function() { return 2 + feature.effectiveZIdx / 2; }",interactive:!0,dash:Lh("lineDash"),extrude:!0,dash_phase:Lh("lineDashOffset")}};e=a.b;f="polygon_layer_"+a.a;var g=Oh(a.a,
"polygons",void 0,a.f);g.flat={filter:"function(){return !feature.height && !feature.min_height;}",draw:Nh(!1)};g.extruded={filter:"function(){return feature.height || feature.min_height;}",draw:Nh(!0)};e[f]=g;a.b["outline_layer_"+a.a]=Oh(a.a,"outlines",c,a.f);a.b["polyline_layer_"+a.a]=Oh(a.a,"polylines",c,a.f)}a.c&Cj.PROVIDES_OVERLAYS&&(a.b["overlay_layer_"+a.a]=Oh(a.a,"overlays",{"translucent-overlays":{color:[1,1,1,a.g],order:8190,interactive:!0}}));a.c&Cj.PROVIDES_MARKERS&&(a.b["marker_layer_"+
a.a]=Oh(a.a,"markers",{markers:{sprite:Kh("icon.id"),offset:Kh("icon.offset"),collide:!1,priority:8191,elevate_by_altitude:!0,interactive:!0,stick:{color:Kh("icon.stick_color"),height:Kh("icon.stick_height")}}},a.f));return{sources:d,styles:b,layers:a.b}};function P(a){var b=""+cf(),c;P.l.constructor.call(this);a=a||{};this.min=a.min||0;this.max=a.max||22;if(c=a.uri){if(/_/.test(c))throw new D(P,0,"uri "+c);}else c=b;this.uri=c||b;this.uid=b;a.getCopyrights&&wc(a.getCopyrights,"Function",P)&&(this.getCopyrights=a.getCopyrights);this.g=this.g.bind(this);this.za=!0;this.f=a.engineType||Vj.WEBGL;if(this.f===Vj.HARP&&!H.map.render.harp)throw new D(P,0,"HARP engine is not supported, module not found");}u(P,F);t("H.map.provider.Provider",P);
P.prototype.i={Ce:"configchange",Ea:"update"};function Wj(a,b,c){a.dispatchEvent(new sd(a.i.Ea,c,b))}P.prototype.g=function(){this.dispatchEvent(this.i.Ce)};P.prototype.u=function(){F.prototype.u.call(this);this.b&&(this.b.removeEventListener("change",this.g),this.b=null)};P.prototype.ta=function(){return null};P.prototype.getCopyrights=P.prototype.ta;
P.prototype.getCapabilities=function(){var a=0;this.wi()&&(a|=Cj.PROVIDES_BY_VIEWPORT);this.providesRasters()&&(a|=Cj.PROVIDES_RASTERS);this.providesSpatials()&&(a|=Cj.PROVIDES_SPATIALS);this.providesOverlays()&&(a|=Cj.PROVIDES_OVERLAYS);this.providesMarkers()&&(a|=Cj.PROVIDES_MARKERS);this.providesDomMarkers()&&(a|=Cj.PROVIDES_DOM_MARKERS);this.providesGeoJSON()&&(a|=Cj.PROVIDES_GEOJSON);this.providesOMV()&&(a|=Cj.PROVIDES_OMV);return a};P.prototype.getCapabilities=P.prototype.getCapabilities;
P.prototype.wi=ef;P.prototype.pf=ef;P.prototype.providesRasters=P.prototype.pf;P.prototype.Jc=ef;P.prototype.providesSpatials=P.prototype.Jc;P.prototype.yi=ef;P.prototype.providesOverlays=P.prototype.yi;P.prototype.Wb=ef;P.prototype.providesMarkers=P.prototype.Wb;P.prototype.Vb=ef;P.prototype.providesDomMarkers=P.prototype.Vb;P.prototype.xi=ef;P.prototype.providesGeoJSON=P.prototype.xi;P.prototype.Ed=ef;P.prototype.providesOMV=P.prototype.Ed;P.prototype.Tm=function(){return this.f};
P.prototype.getEngineType=P.prototype.Tm;P.prototype.nf=hd;P.prototype.preprocessData=P.prototype.nf;P.prototype.j=1;function Xj(a,b){b=Yd(b,0,1);E(b)&&(b=1);a.j!==b&&(a.j=b,a.za&&Yj(a),a.g(),Wj(a))}P.prototype.rn=function(){return this.j};P.prototype.getOpacityInternal=P.prototype.rn;
P.prototype.ac=function(a,b){var c=this;if(this.f===Vj.WEBGL&&!C(a,Th)||this.f===Vj.HARP&&!C(a,H.map.render.harp.Style))throw a=Object.entries(Vj).find(function(d){return d[1]===c.f}),new D(this.ac,0,"Invalid style for engineType "+a);this.b&&(this.b.removeEventListener("change",this.g),this.b.removeEventListener(Rh,this.g));this.b=a;this.b.addEventListener("change",this.g);this.b.addEventListener(Rh,this.g);b||this.g();this.za=!1};P.prototype.setStyleInternal=P.prototype.ac;
P.prototype.ub=function(){this.b||Yj(this);return this.b};P.prototype.getStyleInternal=P.prototype.ub;function Yj(a){if(a.f===Vj.WEBGL){var b=new Tj(a.getCapabilities(),a.uid,a.max,a.j,a.tileSize);a.b=new Th(Uj(b))}else a.f===Vj.HARP&&H.map.render.harp&&(a.b=new H.map.render.harp.Style({}));a.za=!0}P.prototype.ak=function(){var a=this.getCapabilities(),b=Zj.FEATURE;a&Cj.PROVIDES_BY_VIEWPORT?b=Zj.SOURCE:a&Cj.PROVIDES_RASTERS?b=null:a&Cj.PROVIDES_WEBGL_RENDERABLE_OBJECTS&&(b=Zj.PROVIDER);return b};
P.prototype.getPickingMode=P.prototype.ak;P.prototype.Xm=function(){return!1};P.prototype.getFeatureProxy=P.prototype.Xm;function ak(a){var b;uc(this,ak);ak.l.constructor.call(this,a);this.Aa=a=[];for(b in Pg)a[Pg[b]]=new Lg}u(ak,P);t("H.map.provider.ObjectProvider",ak);ak.prototype.wi=df;ak.prototype.providesByViewport=ak.prototype.wi;ak.prototype.Pb=function(a){return this.Aa[a||Pg.ANY]};ak.prototype.getInvalidations=ak.prototype.Pb;ak.prototype.ke=function(a,b){if(b!==Mg.NONE){var c=this.Aa[Pg.ANY];var d=c.a+1;c.update(d,b);c=this.Aa[a.type];c.update(d,b);a.Pb().update(d,b);Wj(this,a)}};
ak.prototype.invalidateObject=ak.prototype.ke;ak.prototype.requestOverlays=ak.prototype.Hd;ak.prototype.requestSpatials=ak.prototype.Ag;ak.prototype.requestSpatialsByTile=ak.prototype.Bg;ak.prototype.yb=!1;ak.prototype.requestMarkers=ak.prototype.Lc;ak.prototype.requestDomMarkers=ak.prototype.Kc;function N(a){a=a||{};N.l.constructor.call(this,a);this.c=a=new Q({min:a.min,max:a.max});a.a=this;a.ka(this);a.wa(Mg.ADD);this.O=new wg;this.m=new wg;this.s=new Oj;this.v=new wg;this.J=new Oj;this.U=new wg}u(N,ak);t("H.map.provider.LocalObjectProvider",N);N.prototype.getCapabilities=function(){return Cj.PROVIDES_BY_VIEWPORT|Cj.PROVIDES_WEBGL_RENDERABLE_OBJECTS|Cj.PROVIDES_DOM_MARKERS|Cj.CROP_LINES_BY_TILE};
N.prototype.ub=function(){if(!this.fa){this.fa=N.l.ub.call(this);var a=new Tj(this.getCapabilities()|Cj.HAS_VOLATILE_DATA,this.uid+"_vol",this.max,this.j,this.tileSize);this.fa.hf(Uj(a))}return this.fa};N.prototype.kc=function(){return this.c};N.prototype.getRootGroup=N.prototype.kc;N.prototype.ke=function(a,b){b&Mg.SPATIAL&&this.ea(a);N.l.ke.call(this,a,b)};N.prototype.invalidateObject=N.prototype.ke;
N.prototype.ea=function(a){var b;C(a,M,this.ea,0);if(a.a!==this)throw new Xc(this.ea,"foreign object");this.Ia(a);var c=a.type;if(c===Pg.MARKER)if((b=a.ba())instanceof Wf){var d=!0;c=this.s}else c=this.v;else c===Pg.DOM_MARKER?(b=a.ba())instanceof Wf?(d=!0,c=this.J):c=this.U:c=c===Pg.OVERLAY?this.O:this.m;d=d?c.Fc(b):c.mk(a.G());d.dj=a;a.ma=d};
N.prototype.Ia=function(a){var b;if(a)if(a.a!==this){if(C(a,M))throw new Xc(this.Ia,"foreign object");}else if(b=a.ma){var c=a.type;c===Pg.MARKER?this.s.remove(b)||this.v.remove(b):c===Pg.DOM_MARKER?this.J.remove(b)||this.U.remove(b):c===Pg.OVERLAY?this.O.remove(b):this.m.remove(b);delete b.dj;delete a.ma}};N.prototype.removeObject=N.prototype.Ia;
function bk(a,b,c,d,e,f,g){g=g||[];if(b.bd())for(a=b!==a.s&&b!==a.v,e=!e,b=b.ig(c,f,f),c=b.length,f=0;f<c;f++){var h=b[f].dj;var k;if(k=void 0!==d){for(var l=yd(d),m=h;(k=m.v<=l&&m.s>=l)&&(m=m.Ha););k=!k}k||!e&&!h.Dc(!0)||(a||1===h.Cb().getState())&&g.push(h)}return g}N.prototype.yi=function(){return 0<this.O.bd()};N.prototype.providesOverlays=N.prototype.yi;N.prototype.Hd=function(a,b,c){return bk(this,this.O,a,b,c,!1).filter(function(d){return d.ad()})};N.prototype.requestOverlays=N.prototype.Hd;
N.prototype.Jc=function(){return 0<this.m.bd()};N.prototype.providesSpatials=N.prototype.Jc;N.prototype.Ag=function(a,b,c){return bk(this,this.m,a,b,c,!1)};N.prototype.requestSpatials=N.prototype.Ag;N.prototype.Bg=function(a,b){return bk(this,this.m,a.bg(),a.zL,b,!1)};N.prototype.requestSpatialsByTile=N.prototype.Bg;N.prototype.Wb=function(){return 0<this.s.bd()+this.v.bd()};N.prototype.providesMarkers=N.prototype.Wb;N.prototype.Lc=function(a,b,c){return ck(this,a,b,c,!1)};
N.prototype.requestMarkers=N.prototype.Lc;function ck(a,b,c,d,e){var f=bk(a,a.s,b,c,d,e);bk(a,a.v,b,c,d,e,f);return f}N.prototype.Vb=function(){return 0<this.J.bd()+this.U.bd()};N.prototype.providesDomMarkers=N.prototype.Vb;N.prototype.Kc=function(a,b,c){return dk(this,a,b,c,!1)};N.prototype.requestDomMarkers=N.prototype.Kc;function dk(a,b,c,d,e){var f=bk(a,a.J,b,c,d,e);bk(a,a.U,b,c,d,e,f);return f}
function ek(a,b,c){var d=c.ba(),e,f=fk.bind(null,a);a=gk.bind(null,a);C(c,nh)?e=C(d,L)?f(d):d.pa.some(f):C(c,xi)?e=C(d,O)?a(d):d.pa.some(a):C(c,hk)&&(e=a(ni(d)));e&&b.push(c)}function fk(a,b){a:{var c=b.Y;var d=si(a,b);if(!d){b=b.Y.length;for(var e=0;e<b;e+=3)if(qi(a,c[e],c[e+1])){a=!0;break a}}a=d}return a}function gk(a,b){return ti(a,b)}
function ik(a,b,c){for(var d=a.length;d--;){var e=a[d],f=e.ba();if(C(f,Ji)){f=f.pa;for(var g=f.length,h;g--;)if(h=f[g],qi(b,h.lat,h.lng)){c.push(e);break}}else qi(b,f.lat,f.lng)&&c.push(e)}}
N.prototype.Va=function(a,b,c,d,e){for(var f=this,g=a.G(),h=[],k=Wb(),l=1;l&Pg.ANY;){if(l&d)switch(l){case Pg.MARKER:k=k.then(function(){return ck(f,g,c,b,!0)}).then(function(m){return ik(m,a,h)});break;case Pg.DOM_MARKER:k=k.then(function(){return dk(f,g,c,b,!0)}).then(function(m){return ik(m,a,h)});break;case Pg.SPATIAL:k=k.then(function(){return bk(f,f.m,g,c,b,!0)}).then(function(m){m.forEach(ek.bind(null,a,h))});break;case Pg.OVERLAY:k=k.then(function(){return bk(f,f.O,g,c,b,!0)}).then(function(m){m.forEach(ek.bind(null,
a,h))})}l<<=1}k.then(function(){return e(h)})};N.prototype.u=function(){N.l.u.call(this);this.c.qa()};var jk={PENDING:0,ACTIVE:1,DONE:2};t("H.map.render.RenderState",jk);function kk(a,b){b=b||{};var c;if(!C(a,Element))throw new D(kk,0,a);var d=a.ownerDocument.createElement("div");this.S=a;kk.l.constructor.call(this);this.padding=new lk(0,0,0,0);this.center=new I(0,0);this.margin=0;this.element=d;d.style.zIndex=0;d.style.height=d.style.width="100%";d.style.direction="ltr";d.style.position="relative"===a.style.position?"absolute":"relative";this.resize();a.appendChild(d);(c=b.padding)!==B&&this.Mi(c.top,c.right,c.bottom,c.left);this.Hi((c=b.margin)!==B?c:0)}u(kk,F);
t("H.map.ViewPort",kk);kk.prototype.a={Ea:"update",Fe:"sync"};kk.prototype.Hi=function(a){if(this.margin!==+a){if(E(this.margin=+a))throw new D(this.Hi,0,a);mk(this);this.dispatchEvent(this.a.Ea)}};kk.prototype.setMargin=kk.prototype.Hi;kk.prototype.Mi=function(a,b,c,d){var e=this.padding;if(e.top!==a||e.right!==b||e.bottom!==c||e.left!==d){if(E(a+b+c+d))throw new D(this.Mi);e.top=a;e.right=b;e.bottom=c;e.left=d;mk(this);this.dispatchEvent(this.a.Ea)}};kk.prototype.setPadding=kk.prototype.Mi;
function mk(a){var b=a.padding;a.center.set((a.width+b.left-b.right)/2<<0,(a.height+b.top-b.bottom)/2<<0)}kk.prototype.resize=function(){var a=this.S.offsetWidth,b=this.S.offsetHeight;if(this.width!==a||this.height!==b)this.c=new Ki(this.width,this.height),this.width=a,this.height=b,mk(this),this.dispatchEvent(this.a.Ea)};kk.prototype.resize=kk.prototype.resize;kk.prototype.bb=function(a){this.dispatchEvent(new Ri(this.a.Fe,this.c,a,Si.SIZE))};kk.prototype.synchronize=kk.prototype.bb;
kk.prototype.u=function(){x.clearTimeout(this.b);this.b=null;this.S.removeChild(this.element);this.element=this.S=null;kk.l.u.call(this)};kk.prototype.uc=Nc;kk.prototype.startInteraction=kk.prototype.uc;kk.prototype.lc=Nc;kk.prototype.interaction=kk.prototype.lc;kk.prototype.Bb=Nc;kk.prototype.endInteraction=kk.prototype.Bb;function nk(a,b,c,d,e,f){var g;for(g=[];d<=e;d++)g=g.concat(ok(a,c,d));a=g.length;hj.call(this,f,a);this.j=c=[];this.f=A(this.f,this);this.c=A(this.c,this);for(this.P(1);a--;)f=g[a],c.push(pk(b,f[0],f[1],f[2],this.f,this.c))}u(nk,hj);nk.prototype.f=function(){jj(this,2)};nk.prototype.c=function(){jj(this,4)};nk.prototype.Ie=function(){for(var a=this.j,b=a.length;b--;)a[b].cancel();this.j=y};function qk(){}t("H.util.ICancelable",qk);qk.prototype.cancel=function(){};qk.prototype.cancel=qk.prototype.cancel;function rk(a,b){var c=this;if(!Ca(b))throw new D(sk,1,b);if(!Ca(a.next||Ca(a.cycle)))throw new D(rk,2,'Argument "mode" must implement H.util.AsyncQueue.Mode');this.b=[];this.c=[];this.g=a;this.i=b;this.j=function(){tk(c)};this.a=null;this.f=function(){c.a||(c.a=x.setTimeout(c.j,1))}}t("H.util.AsyncQueue",rk);rk.prototype.push=function(a,b){if(!Ca(b))throw new D(this.push,1,b);a=uk(new vk,a,this.f,b);this.b.push(a);this.f();return a};rk.prototype.push=rk.prototype.push;
function tk(a){var b=a.c,c=0,d=a.g;d.a();for(a.a=null;c<b.length;){var e=b[c];e.rk?b.splice(c,1):c++}for(;e=d.next(a.b,a.c);)e.cancelled?e.done(null,"cancelled"):(b.push(e),a.i(e,e.data))}function vk(){uk(this,null,null,null)}rk.Task=vk;function uk(a,b,c,d){a.data=b;a.cancelled=!1;a.rk=!1;a.b=c;a.c=d;a.a=null;return a}vk.prototype.done=function(a,b){this.rk=!0;this.b();this.c(this,a,b)};vk.prototype.done=vk.prototype.done;vk.prototype.cancel=function(){this.a&&this.a();this.cancelled=!0};
vk.prototype.cancel=vk.prototype.cancel;vk.prototype.$o=function(a){this.a=a;return this};vk.prototype.setCancelFn=vk.prototype.$o;function wk(){}rk.Mode=wk;wk.prototype.next=function(){};wk.prototype.a=function(){};function xk(a,b){xk.l.constructor.call(this,new yk(a),b)}u(xk,rk);t("H.util.SequentialQueue",xk);function yk(a){if(isNaN(a)||0>a)throw new D(xk,1,'Argument "maxTime" must be a positive number');this.b=a;this.Rc=zk()}yk.prototype.next=function(a){return a.length&&zk()-this.Rc<this.b?a=a.shift():null};yk.prototype.a=function(){this.Rc=zk()};function Ak(a){uc(this,Ak);Ak.l.constructor.call(this,a);if(a&&"tileSize"in a){var b=Bd(+a.tileSize)/Ld;if(isNaN(b)||b%1||0>b||30<b)throw new D(Ak,0,"tileSize: "+a.tileSize);this.tileSize=+a.tileSize}}u(Ak,P);t("H.map.provider.TileProvider",Ak);function Bk(a,b){return Vd(a)-8-xd(Vd(b))}Ak.getZoomLevelOffset=Bk;Ak.prototype.yd=function(a,b,c){return this.uri.concat("_",a,"_",b,"_",c)};Ak.prototype.getTileKey=Ak.prototype.yd;Ak.prototype.Df=256;Ak.prototype.tileSize=Ak.prototype.Df;function Ck(){}t("H.util.ICache",Ck);Ck.prototype.add=function(){};Ck.prototype.add=Ck.prototype.add;Ck.prototype.get=function(){};Ck.prototype.get=Ck.prototype.get;Ck.prototype.Uf=function(){};Ck.prototype.drop=Ck.prototype.Uf;Ck.prototype.forEach=function(){};Ck.prototype.forEach=Ck.prototype.forEach;Ck.prototype.qa=function(){};Ck.prototype.removeAll=Ck.prototype.qa;Ck.prototype.re=function(){};Ck.prototype.registerOnDrop=Ck.prototype.re;Ck.prototype.lh=function(){};
Ck.prototype.deRegisterOnDrop=Ck.prototype.lh;function Dk(a,b,c){this.g=[];b&&this.re(b);if(c&&!Ca(c))throw new D(Dk,2,c);this.b=0;this.filter=c;this.a={};this.f=this.c=null;this.Ji(a)}t("H.util.Cache",Dk);Dk.prototype.add=function(a,b,c){var d,e;c=+c;if(!Cc(c)||0>c)throw new D(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.a[a])?(d.data!==b&&Ek(this,d),this.b+=c-d.size,d.size=c,d.data=b,Fk(this,d)):this.a[a]=Gk(this,{id:a,data:b,size:c,oc:null,jd:null},this.c),Hk(this);return e};Dk.prototype.add=Dk.prototype.add;
Dk.prototype.re=function(a){if(!Ca(a))throw new D(this.re,0,a);this.g.push(a)};Dk.prototype.registerOnDrop=Dk.prototype.re;Dk.prototype.lh=function(a){this.g=this.g.filter(function(b){return b!==a})};Dk.prototype.deRegisterOnDrop=Dk.prototype.lh;Dk.prototype.get=function(a,b){return(a=b?this.a[a]:Fk(this,this.a[a]))&&a.data};Dk.prototype.get=Dk.prototype.get;Dk.prototype.Uf=function(a){var b;(b=this.a[a])&&Ik(this,b,!0)};Dk.prototype.drop=Dk.prototype.Uf;
Dk.prototype.forEach=function(a,b,c){var d;for(d in this.a){var e=this.a[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};Dk.prototype.forEach=Dk.prototype.forEach;Dk.prototype.qa=function(a){var b;for(b in this.a){var c=this.a[b];(a?a(b,c.data,c.size):1)&&Ik(this,this.a[b],!0)}};Dk.prototype.removeAll=Dk.prototype.qa;Dk.prototype.Ji=function(a){if(!(0<+a))throw new D(Dk.prototype.Ji,0,a);this.i=+a;Hk(this);return this};Dk.prototype.setMaxSize=Dk.prototype.Ji;Dk.prototype.pn=function(){return this.i};
Dk.prototype.getMaxSize=Dk.prototype.pn;Dk.prototype.Nm=function(){return this.b};Dk.prototype.getCurrentSize=Dk.prototype.Nm;function Fk(a,b){b&&(a.c=Gk(a,b,a.c));return b}function Hk(a){for(;a.b>a.i&&a.f;)Ik(a,a.f,!0)}function Gk(a,b,c){if(c!==b){(b.oc||b.jd)&&Ik(a,b,!1);if(b.oc=c)b.jd=c.jd,c.jd=b;b.jd||(a.c=b);b.oc||(a.f=b);a.b+=b.size}return b}function Ik(a,b,c){var d=b.jd,e=b.oc;if(d||e||b==a.c&&b==a.f)d?d.oc=e:a.c=e,e?e.jd=d:a.f=d,a.b-=b.size,c&&(delete a.a[b.id],Ek(a,b));b.oc=b.jd=null}
function Ek(a,b){for(var c=a.g.length;c--;)a.g[c].call(a,b.id,b.data,b.size)};var Jk,Kk=function(){function a(){}for(var b,c,d,e=rc("o ms moz webkit "),f=5;f--&&!b;)b=e[f],b=(c=x[b+(b?"R":"r")+"equestAnimationFrame"])&&!E(c.call(window,a))&&(d=x[b+(b?"C":"c")+"ancelAnimationFrame"]);Jk=b?function(g){return c.call(x,g)}:function(g){return x.setTimeout(g,25)};return b?function(g){return d.call(x,g)}:function(g){return x.clearTimeout(g)}}(),zk=x.performance&&x.performance.now?function(){return x.performance.now()}:function(){return x.Date.now()};function Lk(a,b,c,d){this.key="";this.x=a;this.y=b;this.z=c;this.data=d;this.valid=!0}t("H.map.provider.Tile",Lk);function Mk(a,b,c,d){a-=c;b-=d;return a*a+b*b}function Nk(a,b,c){return Ok(a,b*b,c||0,0,a.length-1)}t("H.math.simplifyDP",Nk);
function Ok(a,b,c,d,e){var f=0,g=d,h=a[d].x,k=a[d].y,l=a[e].x,m=a[e].y,p=d+1,q=Mk(h,k,l,m);if(q)for(;p<e;){var r=a[p++];var v=r.x;r=r.y;var w=((v-h)*(l-h)+(r-k)*(m-k))/q;v=0>w?Mk(v,r,h,k):1<w?Mk(v,r,l,m):Mk(v,r,h+w*(l-h),k+w*(m-k));v>f&&(f=v,g=p-1)}else for(;p<e;)r=a[p++],v=r.x,r=r.y,v=Mk(v,r,h,k),v>f&&(f=v,g=p-1);f>=b||0<c&&g-d?(--c,1<g-d?(d=Ok(a,b,c,d,g),d.splice(d.length-1,1)):d=[a[d]],d=1<e-g?d.concat(Ok(a,b,c,g,e)):d.concat(a.slice(g,e+1))):d=[a[d],a[e]];return d};function Pk(a,b,c,d,e,f,g,h){Pk.l.constructor.call(this,b,c,d,null);this.key=a;this.aa=h;this.a=e;this.g=f;this.i={};this.zL=g;this.o=zd(Ug.MAX_LINE_WIDTH/2*this.g+1)}u(Pk,Lk);t("H.map.provider.SpatialTile",Pk);Pk.prototype.c=Ud;Pk.prototype.s=Ud;Pk.prototype.b=Ud;function Qk(a){return a.aa.getInvalidations(Pg.SPATIAL)}
function Rk(a){var b=Qk(a),c=b.a,d=a.c,e=d===c,f;if(!(e||b.pk(d)||b.Qh(d))){e=a.f;var g=a.i;if(b.kg(d))for(f=e.length;f--;){var h=e[f];if(h.Pb().kg(d)){e.splice(f,1);var k=k||Sk(a,h.gb())}}if(b.Rh(d)){for(f=e.length;f--;)if(h=e[f],h.Pb().Rh(d)){var l=1;if((h=g[h.gb()])&&h.a){k=1;break}}l&&e.sort(Tk)}if(!k&&b.me(d))for(f=e.length;f--;)if(e[f].Pb().me(d)){var m=1;break}a.s!==d||m||(a.s=c,a.b!==d||k||(a.b=c));a.c=c;e=!0}return e}
Pk.prototype.le=function(){var a=Qk(this),b=a.a,c=this.b,d=c===b;d||(this.aa.yb&&!a.me(c)?d=!0:Rk(this)&&(d=this.b===b));return d};Pk.prototype.isCanvasValid=Pk.prototype.le;Object.defineProperty(Pk.prototype,"valid",{get:function(){return this.le()},set:hd,configurable:!0});function Uk(a,b){this.b=a;this.a=b}function Sk(a,b){a=a.i;var c=a[b];if(c)return delete a[b],c.a}Pk.prototype.f=ff;
function Vk(a){var b=Qk(a),c=a.c,d=a.f,e;if(!Rk(a)){for(e=d.length;e--;){var f=d[e];var g=f.Pb();(g.kg(c)||g.Qh(c))&&Sk(a,f.gb())}a.f=a.aa.requestSpatialsByTile(a,!1,!1).sort(Tk);a.c=b.a}}function Tk(a,b){return Qg(a.ed(),b.ed(),!1)}Pk.prototype.Va=function(){return this.f};Pk.prototype.getObjects=Pk.prototype.Va;Pk.prototype.Mn=function(){return this.a};Pk.prototype.getTileSize=Pk.prototype.Mn;var Wk={};
Pk.prototype.af=function(){var a=this.a+"_"+this.g,b=Wk[a];if(!b){b=-this.o;var c=this.a-b;b=Wk[a]=new lk(b,b,c,c)}return b};Pk.prototype.getPxClipRect=Pk.prototype.af;Pk.prototype.bg=function(){var a=this.sb;if(!a){var b=this.dg();a=0;var c=this.a;this.z&&(c-=a+=this.af().top);a=this.sb=dg(b.lf(new I(a,a)),b.lf(new I(c,c)))}return a};Pk.prototype.getGeoClipRect=Pk.prototype.bg;Pk.prototype.dg=function(){var a=this.v;if(!a){var b=this.a;a=this.v=new Yi(B,b);a.Qa(this.z);a.x=this.x*b;a.y=this.y*b}return a};
Pk.prototype.getPxProj=Pk.prototype.dg;Pk.prototype.$a=function(){return this.g};Pk.prototype.getPixelRatio=Pk.prototype.$a;Pk.prototype.xg=function(){var a=this.data;this.data=null;this.b=Ud;return a};Pk.prototype.releaseCanvas=Pk.prototype.xg;Pk.prototype.yg=function(){this.i={};delete this.f;this.c=Ud};Pk.prototype.releaseData=Pk.prototype.yg;
Pk.prototype.V=function(a){var b=a.getContext("2d"),c,d,e,f,g=0;Vk(this);if(this.b<this.c){var h=this.f;if(c=h.length){a.width=a.height=this.a;b.clearRect(0,0,this.a,this.a);var k=this.i;for(d=0;d<c;d++){var l=h[d];var m=l.gb();if(f=(e=k[m])?e.b:l.getGeometriesForTile(this)){if(e)l.Pb().me(this.b)&&(e.a=ch(l,f)),e=e.a;else{e=ch(l,f);var p;var q=f;for(var r=l.j?2:0,v=q.length;v--;){var w=q[v];if(w!==dh){var z=w.a;for(p=z.length;p--;)w=z[p],4<w.length&&(z[p]=Nk(w,.6,r))}}this.i[m]=new Uk(f,e)}if(e){b.save();
q=l.j?this.O:this.C;for(m=0;m<f.length;m++)q.call(this,l,f[m],l.ua(),b);if(f=l.getLabels(this))for(l=b,m=f.length;m--;)for(r=f[m],q=r.size,l.font=q+"px "+r.font,l.fillStyle=r.color,l.textAlign="center",l.translate(r.x,r.y),l.rotate(r.angle),q=r.lineHeight||1.375*q,v=r.lines,r=v.length;r--;)l.fillText(v[r],0,r*q);b.restore()}g|=e}}}this.data=g?a:null;this.s=this.b=this.c}else this.data&&(g=1);return 0<g};Pk.prototype.render=Pk.prototype.V;
Pk.prototype.C=function(a,b,c,d){var e;c.cf&&(Xk(d,c,this.g),Yk(b,d,!1,!0,!1,this.a,this.o));c.bf&&(e=a.g)&&e.Sb&&(Zk(d,e),$k(this,d,b,e,c.lineWidth))};
Pk.prototype.O=function(a,b,c,d){var e=c.Sb,f=c.cf,g,h=this.a,k=this.o;if(b===dh)e&&(Zk(d,c),d.fillRect(0,0,h,h));else{f&&Xk(d,c,this.g);if(c.bf&&(g=a.g)){var l=c.lineWidth;g.Sb||(g=null)}a=b.c;if(a===Td){if(f||e)Zk(d,c),Yk(b,d,!0,f,e,h,this.o);g&&(Zk(d,g),$k(this,d,b,g,l,0))}else e&&(Zk(d,c),Yk(b,d,!0,!1,e,h,k,0,a)),f&&Yk(b,d,!1,f,!1,h,k,a),g&&(Zk(d,g),$k(this,d,b,g,l,a))}};
function Yk(a,b,c,d,e,f,g,h,k){var l=a.a,m=-g;g=f+g;h=h||0;k===B&&(k=l.length);if(e&&a===dh)b.fillRect(0,0,f,f);else if(k>h){b.beginPath();for(f=h;f<k;f++){var p=l[f];var q=p.length;if(p===vi)b.moveTo(m,m),b.lineTo(m,g),b.lineTo(g,g),b.lineTo(g,m);else{var r=p[0];b.moveTo(r.x,r.y);for(h=1;h<q;h++)r=p[h],b.lineTo(r.x,r.y)}c&&b.closePath()}c&&e&&b.fill(a.b!==Td?"evenodd":"nonzero");d&&b.stroke()}}
function Xk(a,b,c){var d;a.strokeStyle=b.strokeColor;a.lineWidth=b.lineWidth*c;a.lineCap=b.lineCap;a.lineJoin=b.lineJoin;a.miterLimit=b.miterLimit;a.setLineDash&&(d=b.lineDash)!==ff&&(a.setLineDash(d),a.lineDashOffset=b.lineDashOffset)}function Zk(a,b){a.fillStyle=b.fillColor}
function $k(a,b,c,d,e,f){var g=e*d.width/2;e=e*d.length/2;var h=e/2;d=2*e*d.frequency;var k=Cd(Dd(e,2)+Dd(g,2));a=a.a-k;a=new lk(k,k,a,a);c=c.a;var l,m,p,q,r,v,w,z=Md/2;f=f||0;for(k=c.length;k-- >f;){var J=0;var G=c[k];if(m=l=G.length){var U=G;m=U.length;for(p=0;--m;)p+=U[m].Za(U[m-1]);m=(U=p)>=d}if(m)for(m=vd(yd(U/d),1E3),m=U/(m+1),p=m/2;--l;){for(q=(r=G[l]).Za(v=G[l-1]);p<=J+q;){var X=r.x+(v.x-r.x)*(w=(p-J)/q);w=r.y+(v.y-r.y)*w;a.Pf(X,w)&&(b.save(),b.translate(X,w),b.rotate(-Jd((v.y-r.y)/(r.x-v.x))+
(r.x<v.x?z:-z)),b.beginPath(),b.moveTo(-g,-e),b.lineTo(0,e),b.lineTo(g,-e),b.lineTo(0,-h),b.closePath(),b.fill(),b.restore());p+=m}J+=q}}}var al=[];
Pk.prototype.Ga=function(a,b,c){for(var d=this.f,e=d.length,f,g,h,k,l,m,p=ff,q,r=this.g;e--;)if(g=d[e],g.Dc(!0)&&(h=this.i[g.gb()])&&(k=h.b)){f=g.ua();m="none"!==f.fillColor&&g.j;q="none"===f.strokeColor?0:f.lineWidth*r;for(f=k.length;f--;){l=k[f];var v;if(!(v=m&&l===dh)&&(v=m||q)){var w;v=a;var z=b,J=m,G=q,U=l.b,X=l.c,xa=X!==Td,ia=l.a,gc=ia.length,wb=0,md=0,wi=!1;for(l=0;l<gc;l++){var Qe=ia[l];var Xb=l>=X;var Xf=!Xb&&l>=U;if(Qe===vi&&J)Xf?wb++:md++;else{var cd=Qe.length;al.length=2*cd;for(w=0;w<
cd;w++){var Up=Qe[w];al[2*w]=Up.x;al[2*w+1]=Up.y}w=J&&!Xb;Xb=xa&&!Xb?0:G;if(w||Xb)if(Xb=be(v,z,al,Xb,w),Xb===ae.EDGE||Xb===ae.VERTEX){wi=!0;break}else if(Xb===ae.SURFACE)if(Xf)wb++;else if(md++,U===Td)break}}v=wi||0<md&&!(wb%2)}if(v){p===ff&&(p=[]);p.push(g);break}}if(c&&p.length)break}return p};function bl(a,b){var c;bl.l.constructor.call(this,b);this.C=a;this.N=a=b.pixelRatio;this.tileSize=c=1<<xd(Vd((b.tileSize||256)*a));this.U=Bk(c,a);this.Zh=A(this.Zh,this);this.ni=A(this.ni,this);this.$h=A(this.$h,this);this.Yh=A(this.Yh,this);this.v=A(this.v,this);this.C.addEventListener(P.prototype.i.Ea,this.v,!1,this);this.c=[];this.m=new Dk(b.tileCacheSize||256,this.Zh);this.s=new Dk(b.dataCacheSize||512,this.ni);this.J=new xk(20,this.$h);this.a={};this.O=zk()}u(bl,Ak);
bl.prototype.v=function(a){a.target.type===Pg.SPATIAL&&Wj(this,a.target)};bl.prototype.jb=function(a,b,c,d){var e=this.getTileKey(a,b,c),f;if(f=this.m.get(e,d)){if(d||f.le())return f;d||this.m.Uf(e)}if((f=this.s.get(e,d))&&(d||Rk(f)))return a=this.c.pop()||document.createElement("canvas"),f.V(a)||this.c.push(a),this.m.add(e,f,1),f;d||((f=this.a[e])?f.count++:(f=this.J.push([e,a,b,c],this.Yh),f.count=1,this.a[e]=f))};bl.prototype.requestTile=bl.prototype.jb;bl.prototype.rd=function(){};
bl.prototype.Wc=function(a,b,c){this.Lf(this.getTileKey(a,b,c))};bl.prototype.cancelTile=bl.prototype.Wc;bl.prototype.Lf=function(a){var b;if(b=this.a[a])b.count--,b.count||(b.cancel(),delete this.a[a])};bl.prototype.cancelTileByKey=bl.prototype.Lf;n=bl.prototype;n.$h=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];c=this.m.get(c)||new Pk(c,d,e,f,this.tileSize,this.N,f+this.U,this.C);d=c.data||this.c.pop()||document.createElement("canvas");c.V(d)||this.c.push(d);b.push(c);a.done(c)};
n.Yh=function(a,b){a=a.data[0];b&&this.m.add(a,b,1);delete this.a[a];Wj(this)};n.Zh=function(a,b){b.data&&this.c.push(b.xg());this.s.add(a,b,1)};n.ni=function(a,b){b.yg()};n.u=function(){for(var a in this.a)this.a[a].cancel();this.m.qa();this.s.qa();this.c.length=0;bl.l.u.call(this)};function cl(a,b){b=b||{};if(!a)throw new D(cl,0,a);this.tileSize=a.tileSize;this.c={};aj.call(this,{min:void 0!==b.min?b.min:a.min,max:void 0!==b.max?b.max:a.max,minWorldSize:this.tileSize,projection:b.cl,dark:b.dark,provider:a})}u(cl,aj);t("H.map.layer.BaseTileLayer",cl);cl.prototype.Te=function(a,b){var c=this.pixelProjection;if(!C(a,K))throw new D(this.Te,0,a);if(!E(b)){var d=c.gk();c.Qa(b)}a=dl(c.lb(a.Rb()),c.lb(a.Nb()));!E(d)&&c.Qa(d);return a};cl.prototype.geoRectToRect=cl.prototype.Te;
cl.prototype.je=function(a,b){var c=Dd(2,yd(b)),d=this.tileSize;if(!C(a,lk))throw new D(this.je,0,a);if(E(b=+b))throw new D(this.je,1,b);b=yd(a.left/d);b===c&&--b;var e=yd(a.right/d);e===c&&--e;return new lk(b,Yd(yd(a.top/d),0,c-1),e,Yd(yd(a.bottom/d),0,c-1))};cl.prototype.getTileBounds=cl.prototype.je;cl.prototype.jb=function(a,b,c,d){return this.a.requestTile(a,b,c,d)};cl.prototype.Wc=function(a,b,c){this.a.cancelTile(a,b,c)};cl.prototype.cancelTile=cl.prototype.Wc;
cl.prototype.ta=function(a,b){return this.a.getCopyrights?this.a.getCopyrights(a,b):null};cl.prototype.getCopyrights=cl.prototype.ta;function el(a,b,c,d,e){d=yd(d);var f=Dd(2,d),g=b.left,h=b.top,k=b.right;c=k+(c?f+(k===b.left?0:1):1);var l=b.bottom,m=[];if(e){var p=g+(1+k-g)/2+e.x/a.tileSize-.5;var q=h+(1+l-h)/2+e.y/a.tileSize-.5}for(;g<c;){for(h=b.top;h<=l;)a=g%f,m.push([a,h,d,e?Ad(p-g)+Ad(q-h):0]),h++;g++}return m}
function ok(a,b,c){c=yd(c);a.pixelProjection.Qa(c);b=a.Te(b);var d=a.je(b,c);return el(a,d,b.left>b.right,c)}
cl.prototype.$e=function(a,b,c,d,e,f){var g,h=[],k,l=this.a;f=null!=f?f:"__default__";var m=l.requestTile;if(!C(a,lk))throw new D(this.$e,0,a);if(E(c=+c))throw new D(this.$e,1,c);d||(g={});b=el(this,a,b,c,e);if(a=b.length)for(d||b.sort(fl),c=a;c--;)e=b[c],d||(g[l.yd.apply(l,e)]=!0),e[3]=+d,(k=m.apply(l,e))&&h.push(k);if(!d){d=g;var p;g=this.c[f]||{};for(p in g)g.hasOwnProperty(p)&&g[p]&&!d[p]&&this.a.cancelTileByKey(p);this.c[f]=d}return{total:a,tiles:h}};cl.prototype.getProviderTiles=cl.prototype.$e;
function fl(a,b){return b[3]-a[3]};function R(a){uc(this,R);R.l.constructor.call(this,a);this.ec=new gl;this.gc=A(this.gc,this);this.U=hl;this.createTileInternal=this.rd.bind(this)}u(R,Ak);t("H.map.provider.RemoteTileProvider",R);R.prototype.Yd=function(){return 1};R.prototype.getEntryWeight=R.prototype.Yd;var hl=new Dk(65536);R.prototype.m={};R.prototype.fa={};R.prototype.Ob=function(){return this.U};R.prototype.getCache=R.prototype.Ob;R.prototype.O=ba(3);R.prototype.gc=function(a){var b=this.uri;return!a.indexOf(b)&&"_"===a.charAt(b.length)};
R.prototype.cacheFilter=R.prototype.gc;R.prototype.Xa=function(a,b){b.valid=!1};R.prototype.reload=function(a){var b=this.getCache();a?b.qa(this.gc):b.forEach(this.Xa,this,this.gc);il(this);Wj(this,this,{isReload:!0})};R.prototype.reload=R.prototype.reload;R.prototype.fh=function(){return!1};R.prototype.MAX_STORE_TIME=Infinity;R.prototype.ge=function(){return this.ec};R.prototype.ma=function(a,b){b(a)};
function pk(a,b,c,d,e,f){d=~~d;return a.requestInternal(b,c,d,function(g,h){a.ge().put(a.yd(b,c,d),{raw:h&&h.raw||g,timestamp:x.Date.now()},e,f)},f,0)}R.prototype.requestInternal=R.prototype.K;
R.prototype.jb=function(a,b,c,d){var e=this;var f=this.getCache();if(E(a=+a))throw new D(this.jb,0,a);if(E(b=+b))throw new D(this.jb,0,b);if(E(c=+c))throw new D(this.jb,0,c);c=~~c;var g=this.getTileKey(a,b,c);f=f.get(g);f&&f.valid||d||this.m[g]||(f=B,this.requestTileAsPromise(a,b,c,d).then(function(h){Wj(e,h)},hd));return f};R.prototype.requestTile=R.prototype.jb;
R.prototype.ll=function(a,b,c,d){var e=this,f=this.getCache(),g=this.getTileKey(a,b,c),h=this.m,k=this.fa,l,m=this.ge();if(k[g])return k[g];k[g]=k=new Ob(function(p,q){function r(v){var w,z;var J=function(G,U){z=e.createTileInternal(a,b,c,G,U);z.key=g;f.add(g,z,e.Yd(G));p(z);jl(e,g)};v&&(w=x.Date.now()-v.timestamp);v&&w<e.MAX_STORE_TIME?e.ma(v.raw,J):(w&&m.remove(g),(z=f.get(g))&&z.valid||d?p(z||null):h[g]=e.requestInternal(a,b,c,J,q))}l=m.get(g,r,r)});h[g]||(h[g]=l);k.then(function(){jl(e,g)},function(){jl(e,
g)});return k};R.prototype.requestTileAsPromise=R.prototype.ll;R.prototype.kl=function(a,b){var c=this,d=a.id,e=a.tile.coords;return new Ob(function(f,g){c.ll(e.x,e.y,e.z,b).then(function(h){var k=y;h=h.Va?h.Va():h.data;for(var l=h.length,m;l--;)if(m=h[l],m.gb()===d){k=m;break}f(k)},g)})};R.prototype.requestObjectAsPromise=R.prototype.kl;function jl(a,b){delete a.m[b];delete a.fa[b]}function il(a){for(var b in a.m)a.gc(b)&&a.cancelTileByKey(b)}var kl={cancel:function(){}};
R.prototype.rd=function(a,b,c,d){return new Lk(a,b,c,d)};R.prototype.Lf=function(a){var b=this.m[a];b&&(b.cancel(),jl(this,a))};R.prototype.cancelTileByKey=R.prototype.Lf;R.prototype.Wc=function(a,b,c){this.cancelTileByKey(this.getTileKey(a,b,c))};R.prototype.cancelTile=R.prototype.Wc;R.prototype.u=function(){R.l.u.call(this);this.getCache().qa(this.gc);il(this)};function gl(){}R.NullStorage=gl;gl.prototype.get=function(a,b){b();return kl};gl.prototype.get=gl.prototype.get;
gl.prototype.put=function(a,b,c){c&&c()};gl.prototype.put=gl.prototype.put;gl.prototype.clear=function(a){a&&a()};gl.prototype.clear=gl.prototype.clear;gl.prototype.remove=function(a,b){b&&b()};gl.prototype.remove=gl.prototype.remove;function sk(a){sk.l.constructor.call(this,a);a&&(this.C={crossOrigin:a.crossOrigin||"anonymous",headers:a.headers||{}},this.v=a.getURL);if(!Ca(this.v))throw new D(sk,0,"getURL");Xj(this,a.opacity);this.c=x.URL||x.webkitURL;a=this.C.crossOrigin;if(!(a="anonymous"===a||"use-credentials"===a)){a=this.v(0,0,0);var b=window.location,c=document.createElement("a");c.href=a;a=c.hostname===b.hostname&&c.port===b.port&&c.protocol===b.protocol}(this.N=a&&!!rf.prototype.b.arraybuffer&&!!this.c)&&this.Ob().re(A(this.Aa,
this))}u(sk,R);t("H.map.provider.ImageTileProvider",sk);sk.prototype.qc=function(a){Xj(this,a)};sk.prototype.setOpacity=sk.prototype.qc;sk.prototype.dd=function(){return this.j};sk.prototype.getOpacity=sk.prototype.dd;sk.prototype.pf=df;sk.prototype.providesRasters=sk.prototype.pf;sk.prototype.Yd=function(){return this.tileSize};sk.prototype.getEntryWeight=sk.prototype.Yd;
sk.prototype.K=function(a,b,c,d,e,f){var g=this,h=this.v(a,b,c),k;a=null;if(h){var l=x.setTimeout(function(){g.N?(k=new rf("arraybuffer",h,f,g.C),k.then(function(m){return m.blob()}).then(function(m){var p=new Image;p.onload=A(d,null,p,{raw:m});p.onerror=A(e,null,"bad url");try{p.src=g.c.createObjectURL(m)}catch(q){}},e)):(k=new rf("image",h,f,g.C),k.then(d,e))},150);a={cancel:function(){k?k.cancel():x.clearTimeout(l)}}}else d(null);return a};sk.prototype.requestInternal=sk.prototype.K;
sk.prototype.ma=function(a,b){var c=new Image;c.onload=function(){b(this)};c.src=this.c.createObjectURL(a)};sk.prototype.Aa=function(a,b){(a=b.data)&&a instanceof HTMLImageElement&&this.c.revokeObjectURL(a.src)};function lk(a,b,c,d){this.left=+a;this.top=+b;this.right=+c;this.bottom=+d}t("H.math.Rect",lk);lk.prototype.set=lk;lk.prototype.set=lk.prototype.set;lk.prototype.Rb=function(){return this.c||(this.c=new I(this.left,this.top))};lk.prototype.getTopLeft=lk.prototype.Rb;lk.prototype.Nb=function(){return this.a||(this.a=new I(this.right,this.bottom))};lk.prototype.getBottomRight=lk.prototype.Nb;lk.prototype.Pf=function(a,b){return this.left<=a&&this.right>=a&&this.top<=b&&this.bottom>=b};
lk.prototype.containsXY=lk.prototype.Pf;function dl(a,b){return new lk(a.x,a.y,b.x,b.y)}lk.fromPoints=dl;lk.prototype.clone=function(){return new lk(this.left,this.top,this.right,this.bottom)};lk.prototype.clone=lk.prototype.clone;function ll(a,b){cl.call(this,a,b)}u(ll,cl);t("H.map.layer.TileLayer",ll);ll.prototype.Id=function(a,b,c,d,e){if(!C(a,K))throw new D(this.Id,0,a);if(E(b=+b))throw new D(this.Id,1,b);b=yd(b);this.pixelProjection.Qa(b);a=this.Te(a);var f=this.je(a,b);return this.$e(f,a.left>a.right,b,c,d,e)};ll.prototype.requestTiles=ll.prototype.Id;function ml(a,b){b=b?Ua(b):{};b.tileSize=b.tileSize||256;b.pixelRatio=b.pixelRatio||Se();b.max=24;this.c=new bl(a,b);this.f=new ll(this.c);b.minWorldSize=this.c.tileSize;b.provider=a;ml.l.constructor.call(this,b);this.tileSize=this.f.tileSize;this.j=A(this.j,this);this.c.addEventListener(this.c.i.Ea,this.j);a.addEventListener(a.i.Ea,this.j)}u(ml,aj);t("H.map.layer.ObjectLayer",ml);ml.prototype.j=function(a){a.currentTarget!==this.c&&a.target.type===Pg.SPATIAL||this.g()};var nl={markers:ff,total:0};
ml.prototype.Lc=function(a,b,c){var d=this.a,e;return d.providesMarkers()&&(e=d.requestMarkers(a,b,!0,c)).length?{markers:e,total:e.length}:nl};ml.prototype.requestMarkers=ml.prototype.Lc;ml.prototype.Kc=function(a,b,c){var d=this.a,e;return d.providesDomMarkers()&&(e=d.requestDomMarkers(a,b,!0,c)).length?{markers:e,total:e.length}:nl};ml.prototype.requestDomMarkers=ml.prototype.Kc;var ol={tiles:ff,total:0};
ml.prototype.Id=function(a,b,c,d){if(this.a.providesSpatials()){var e=this.f.Id(a,b,c,d);c||(c=this.c,e=zk(),33<e-c.O&&(tk(c.J),c.O=e),e=this.f.Id(a,b,!0,d))}else e=ol;return e};ml.prototype.requestTiles=ml.prototype.Id;ml.prototype.jb=function(a,b,c,d){return this.f.jb(a,b,c,d)};ml.prototype.requestTile=ml.prototype.jb;ml.prototype.Wc=function(a,b,c){this.f.Wc(a,b,c)};ml.prototype.cancelTile=ml.prototype.Wc;var pl={overlays:ff,total:0};
ml.prototype.Hd=function(a,b,c){var d=this.a,e=pl;d.providesOverlays&&d.providesOverlays()&&(a=d.requestOverlays(a,b,!0,c),b=a.length)&&(e={overlays:a,total:b});return e};ml.prototype.requestOverlays=ml.prototype.Hd;ml.prototype.u=function(){this.c.B();this.f.B();this.a.dispose();ml.l.u.call(this)};function ql(a,b,c,d){var e=new lk(0,0,0,0);ql.l.constructor.call(this);if(!a)throw new D(ql,0,a);if(!b)throw new D(ql,1,b);if(!c)throw new D(ql,2,c);if("object"!==typeof d)throw new D(ql,3,d+" is not an object");if("number"!==typeof d.pixelRatio)throw new D(ql,3,d.pixelRatio+" is not a number");this.sa=d.pixelRatio;this.zoom=0;this.ib=Bd(this.sa)/Ld;this.ra=new Yi;this.yb={1:e.clone(),2:e.clone(),4:e.clone()};this.m=new I(.5,.5);this.g=a;rl(this,this.sa);this.uc=A(this.uc,this);this.lc=A(this.lc,
this);this.Bb=A(this.Bb,this);a.startInteraction=this.uc;a.interaction=this.lc;a.endInteraction=this.Bb;a.addEventListener(a.a.Ea,this.U,!1,this);this.getCapabilities=this.getCapabilities;this.capture=this.capture;this.zoomAt=this.Ae;this.relaunch=this.ha;this.dispose=this.B;this.screenToGeo=this.Wa;this.geoToScreen=this.Fa;this.screenToLookAtData=this.Eg;this.O=b;this.tc=A(this.tc,this);this.control=A(this.control,this);this.Ab=A(this.Ab,this);b.startControl=this.tc;b.control=this.control;b.endControl=
this.Ab;b.addEventListener(b.a.Ea,this.bh,!1,this);this.c=c;this.qg=A(this.qg,this);this.ef=A(this.ef,this);this.ff=A(this.ff,this);this.pg=A(this.pg,this);c.addEventListener(aj.prototype.b.Ea,this.qg,!1,this);c.addEventListener(c.b.Be,this.ef,!1,this);c.addEventListener(c.b.De,this.ff,!1,this);c.addEventListener(c.b.Ee,this.pg,!1,this)}u(ql,F);t("H.map.render.RenderEngine",ql);
function rl(a,b){var c=a.g,d=c.width,e=c.height,f=c.padding,g=f.top,h=f.left,k=f.bottom;f=f.right;c=c.margin;var l=-(d+h-f)/2<<0,m=-(e+g-k)/2<<0;d+=l;e+=m;a=a.yb;a[1].set((l-c)*b,(m-c)*b,(d+c)*b,(e+c)*b);a[2].set(l*b,m*b,d*b,e*b);a[4].set((l+h)*b,(m+g)*b,(d-f)*b,(e-k)*b)}ql.prototype.U=function(){rl(this,this.sa)};
ql.prototype.u=function(){var a=this.g,b=this.O,c=this.c;a.removeEventListener(a.a.Ea,this.U,!1,this);a.startInteraction===this.uc&&(a.startInteraction=kk.prototype.uc);a.interaction===this.lc&&(a.interaction=kk.prototype.lc);a.endInteraction===this.Bb&&(a.endInteraction=kk.prototype.Bb);b.removeEventListener(b.a.Ea,this.bh,!1,this);b.startControl===this.tc&&(b.startControl=sl.prototype.tc);b.control===this.control&&(b.control=sl.prototype.control);b.endControl===this.Ab&&(b.endControl=sl.prototype.Ab);
c.removeEventListener(aj.prototype.b.Ea,this.qg,!1,this);c.removeEventListener(c.b.Be,this.ef,!1,this);c.removeEventListener(c.b.De,this.ff,!1,this);c.removeEventListener(c.b.Ee,this.pg,!1,this)};ql.prototype.Di=function(a){this.Sg=a};ql.prototype.setAnimationCallback=ql.prototype.Di;ql.prototype.Ai=function(){this.Sg=void 0};ql.prototype.resetAnimationCallback=ql.prototype.Ai;ql.prototype.control=function(){};ql.prototype.capture=function(){return Yb(Error("not implemented"))};
function tl(a,b){a.style.transition="opacity 1.5s";Ce(a,"transitionend",b,!1);a.style.opacity=0}var ul={ZOOM:1,HEADING:2,TILT:4,INCLINE:8,COORD:16};ql.InteractionModifiers=ul;n=ql.prototype;n.zk={pj:"render"};n.qg=function(a){this.Rk(a);this.ha()};n.ef=function(a){this.jf(a.idx,a.added)};n.ff=function(a){this.oi(a.idx,a.removed,a.type===this.c.b.Ee)};n.pg=function(a){a.removed&&this.ff(a);this.ef(a)};n.Rk=hd;n.jf=function(a,b){this.Mh(a,b);0===a&&this.Jb();C(b,aj)&&vl(this,b,!0);this.te();this.ha()};
n.Jb=function(){var a=this.c.Na();if(0<a.length){var b=a[0].max;this.Pg=a[0].min;this.Tg=b}else a=this.getCapabilities().lookAt.zoom,b=a.max,this.Pg=a.min,this.Tg=b;a=wl(this,this.zoom);a!==this.zoom&&(this.zoom=a,this.ra.Qa(a),this.bb())};n.bb=function(a){this.J=this.mb();a&&(this.J.position=a);this.J.zoom=this.zoom-this.ib;this.J.position.alt=0};n.Nl=0;n.heading=180;n.mb=function(){return xl(this,{position:this.ra.projection.vg(this.m),zoom:this.zoom,tilt:this.Nl,heading:this.heading})};
function xl(a,b){b.tilt=yl(a,b.tilt);b.heading=zl(a,b.heading);b.incline=a.getCapabilities().lookAt.incline.min;return b}function wl(a,b){var c=a.getCapabilities().lookAt.zoom;return Yd(b,wd(c.min,a.Pg),vd(c.max,a.Tg))}function yl(a,b){a=a.getCapabilities().lookAt.tilt;return Yd(b,a.min,a.max)}function zl(a,b){a=a.getCapabilities().lookAt.heading;return Yd((b%360+360)%360,a.min,a.max)}
function vl(a,b,c){c=c?b.addEventListener:b.removeEventListener;c.call(b,b.b.nj,a.pi,!1,a);c.call(b,b.b.mj,a.pi,!1,a)}n.Mh=hd;n.oi=hd;n.ap=function(a,b){this.C={before:a,after:b}};ql.prototype.setOnRenderCallbacks=ql.prototype.ap;var Al={P2D:0,WEBGL:1,HARP:2};ql.EngineType=Al;var Bl={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:85},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:ul.ZOOM,COORD:ul.COORD},capture:!0};t("H.map.render.webgl.capabilities",Bl);function Cl(a){var b,c=this,d=x.H.gl;Cl.l.constructor.call(this);this.a=b=d.Scene.create(x.URL.createObjectURL(nf(JSON.stringify(Dl))),{viewport:a.viewport,container:a.vc,disableRenderLoop:!0,devicePixelRatio:a.devicePixelRatio,logLevel:"error"});a.Ko&&b.subscribe({load:a.Ko});b.subscribe({view_complete:function(){c.g=!0;a.Tk()}});var e=b.requestRedraw;b.requestRedraw=function(){e.apply(b);a.Tk()};this.i=A(this.i,this);this.f=A(this.f,this);this.j=0;this.c={};this.b={}}u(Cl,nd);Cl.prototype.g=!1;
function El(a){a=a.a.sources;var b;for(b in a){var c=a[b];if(c.hasPendingCommands&&c.hasPendingCommands())return!0}return x.H.gl.Task.hasPendingTasks()}Cl.prototype.V=function(){var a=x.H.gl.Task;this.a.immediateRedraw();a.setState({user_moving_view:this.a.view.user_input_active});a.processAll();return this.g&&!this.a.dirty&&!this.a.building&&!El(this)&&!Object.keys(this.b).length};function Fl(a){a.g=!1;a.a.resetViewComplete()}function Gl(a){return a.a.view}
function Hl(a,b){function c(){var e=b.Na(),f={},g={},h,k,l,m=++a.j,p,q;vh(g,Dl);for(k=0;k<e.length;k++){var r=e[k];if(h=r.ga()){var v=h.ub();if(v.getState()===Qh.READY){var w=v.vd();if(!Ta(w)){delete w.cameras;delete w.camera;f[k]=w=Hh(w,k);!C(r,ml)&&w.sources&&Ih(w,h.uid);for(l in w.sources){var z=w.sources[l];z.max_zoom=vd(h.max,Bl.lookAt.zoom.max);z.max_display_zoom=r.max;z.min_display_zoom=r.min;if(q=h.tileSize)2<=d&&256<q&&h instanceof sk&&(q/=2),z.tile_size=q}(p=v.hc())&&Jh(w,p);vh(g,w)}}}}vh(g.layers.skybox.draw.skybox.color,
g.scene.sky);a.a.config=g;return a.a.updateConfig().then(function(){var J={},G,U;if(m!==a.j)return!1;a.j=0;for(U in f){r=e[+U];var X=f[U].sources;for(G in X)if(X=a.a.sources[G])J[G]=X,X.initialize&&r.getProvider()&&X.initialize(r.getProvider(),a.i,a.a.getWorkers().length,X.tiled?B:a.a.tile_manager.getWorkerForTile(y,X))}for(G in a.c)!J[G]&&a.c[G].dispose&&a.c[G].dispose();a.c=J;return!0})}var d=a.a.pixelRatio();a.a.initialized?c():a.a.load(y,{blocking:!1}).then(c)}
Cl.prototype.i=function(a,b,c){var d=this,e=this.a.sources[a],f=c&&c.isReload;b?!0!==this.b[a]&&(this.b[a]||(this.b[a]={Ml:{},vj:[]}),C(b,Lk)?this.b[a].Ml[b.x+"/"+b.y+"/"+b.z]=!0:(b=b.boundingBox,this.b[a].vj.push(new K(b[0],b[1],b[2],b[3])))):this.b[a]=!0;e&&e.has_volatile_data?Il(this,f):(x.clearTimeout(this.m),this.m=x.setTimeout(function(){return Il(d,f)},Jl))};var Jl=100;
Cl.prototype.f=function(a){var b=!1,c=this.b[a.source.name],d=x.H.gl;if(c)if(!0===c)b=!0;else{var e=d.Tile.coord(d.Geo.wrapTile(a.coords));b=!!c.Ml[e.key];if(!b){var f=d.Geo.getTileBoundingBox(e,a.source.tile_size,Ug.MAX_LINE_WIDTH/2);f=dg(f.getTopLeft(),f.getBottomRight());b=c.vj.some(function(g){return g.Ad(f,!0)||f.pd(g.fb(),!0)})}}return b};function Il(a,b){var c=a.a.tile_manager;c.removeTiles(a.f);c.updateTilesForView();b&&c.removeCachedTiles(a.f);Fl(a);a.b={}}Cl.prototype.vd=function(){return this.a.config};
function Kl(a,b,c,d){a.a.getFeatureAt(b,c,d);a.a.update()}function Ll(a){return a.a.screenshot(void 0).then(function(b){return new Ob(function(c,d){new Dj(URL.createObjectURL(b.blob),function(e,f){1===e?c(f.getData()):d()},!1)})})}Cl.prototype.$a=function(){return this.a.pixelRatio()};Cl.prototype.u=function(){var a=this.c;Cl.l.u.call(this);this.a.destroy();this.b={};a&&Object.keys(a).forEach(function(b){a[b].dispose()});x.clearTimeout(this.m);this.c=this.a=null};
var Dl={scene:{background:{color:"#FFFFFF"},sky:{zenith:"#347BC0",horizon:"#EDF2F9",fog:"#FFFFFF"}},lights:{default_light:{type:"directional",name:"default_light",visible:!0}},camera:{type:"perspective"},styles:{},fonts:{},sources:{skybox:{type:"SkyBox"}},layers:{skybox:{data:{source:"skybox"},draw:{skybox:{color:{}}}}},global:{}};var Zj={FEATURE:1,SOURCE:2,PROVIDER:3};t("H.map.provider.PickingMode",Zj);function Ml(a){return a}t("H.util.animation.ease.LINEAR",Ml);t("H.util.animation.ease.EASE_IN_QUAD",function(a){return a*a});function Nl(a){return-a*(a-2)}t("H.util.animation.ease.EASE_OUT_QUAD",Nl);t("H.util.animation.ease.EASE_IN_OUT_QUINT",function(a){a*=2;return 1>a?Dd(a,5)/2:(a-=2,Dd(a,5)/2+1)});function Ol(a){return 1-Math.sqrt(1-a*a)}function Pl(a){return Cd(2*a-a*a)}t("H.util.animation.ease.EASE_OUT_CIRC",Pl);function Ql(a){return 1-Math.cos(a*Math.PI/2)}
function Rl(a){return Math.sin(a*Math.PI/2)};function Sl(a,b){this.a={tilt:Tl(a.tilt,b.tilt),heading:Tl(a.heading,b.heading),zoom:b.zoom-a.zoom};var c=this.b=Zf(a.position),d=b.position;a=d.lat*Rd;var e=c.lat*Rd;d=d.lng*Rd-c.lng*Rd;c=Fd(d)*Hd(a);a=Hd(e)*Fd(a)-Fd(e)*Hd(a)*Hd(d);a=Math.atan2(c,a);this.j=(0<=a?a:Pd+a)*Sd;this.c=this.b.Za(b.position);b=this.a.zoom;this.i=0===b?this.f:Object.assign({},this.f,{zoom:0>b?Pl:Ol,position:0>b?Ql:Rl});this.g=Object.assign({},{tilt:0,heading:0,zoom:0})}
function Tl(a,b){a=b-a;return-180<a&&180>=a?a:180<a?a-360:a+360}Sl.prototype.f={tilt:Ml,heading:Ml,zoom:Ml,position:Ml};function Ul(a,b){if(E(this.x=+a))throw new D(Ul,0,a);if(E(this.y=+b))throw new D(Ul,1,b);}Ul.prototype.add=function(a){return new Ul(this.x+a.x,this.y+a.y)};Ul.prototype.a=function(a){if(!C(a,Ul))throw new D(this.a,0,a);a=this.b(a);return a.x+a.y};Ul.prototype.b=function(a){if(!C(a,Ul))throw new D(this.b,0,a);return new Ul(this.x*a.x,this.y*a.y)};Ul.prototype.Qa=function(a){return new Ul(this.x*a,this.y*a)};function Vl(a){return Cd(a.a(a))};function Wl(a){a=a||gf;this.sb=tc(a.Fo)?a.Fo:3;this.aa=tc(a.Do)?a.Do:300;this.s=tc(a.op)?a.op:3;this.v=tc(a.kp)?a.kp:50;this.f=[];this.clear()}t("H.map.render.InteractionUtils",Wl);Wl.prototype.io=function(){return this.c};Wl.prototype.isGestureDetected=Wl.prototype.io;Wl.prototype.start=function(a,b){var c=ul.HEADING,d=ul.TILT;this.a&&this.clear();this.i=a;this.m=!!b;this.a=!0;this.c=!(a&(c|d))||a===c||a===d};Wl.prototype.start=Wl.prototype.start;
Wl.prototype.store=function(a,b,c,d,e){var f=!1;if(this.a){a=new Xl(a,b,c,d,e);f=a.c;this.o=this.b;this.b=a;if(this.g){if(this.j=!0,f){b=this.i;var g=this.c;if(!g&&this.j){e=ul.HEADING;var h=ul.TILT;c=ul.COORD;d=ul.ZOOM;var k=b&(c|h)?this.ce(!0):Yl;var l=b&d?this.Xf(!0):1;var m=b&e?Ad(this.uh(!0)):0;var p=Ad(k.x);var q=Ad(k.y);k=10<p||10<q;p=10<q&&q>3*p;l=.8>l||1.2<l;m=7<m;b&h&&(m||l||k&&!p?Zl(this,h):p&&(Zl(this,~h>>>0),g=!0));!g&&b&e&&b&(c|d)&&(l||k?(Zl(this,e),g=!0):m&&(Zl(this,h),g=!0));this.c=
g}}}else this.g=a,f||(this.c=!0);this.m&&this.f.push(a)}return f};Wl.prototype.store=Wl.prototype.store;Wl.prototype.clear=function(){this.f.length=0;this.a=this.m=this.j=this.c=!1;this.g=this.o=this.b=void 0};Wl.prototype.clear=Wl.prototype.clear;Wl.prototype.Hc=function(a){return 0<(this.i&a)};Wl.prototype.isModifierEnabled=Wl.prototype.Hc;function Zl(a,b){a.i^=a.i&b}Wl.prototype.va=function(){return this.a};Wl.prototype.isRunning=Wl.prototype.va;var Yl=oc(new Ul(0,0));
Wl.prototype.zc=function(){var a;if(this.m){var b=this.f;var c=b.length;var d=0;for(a=new Ul(0,0);--c&&d<this.s;)a=a.add($l(b[c-1],b[c])),d++}else a=this.ce();b=a;c=Vl(b);return 0!==c?new Ul(b.x/c,b.y/c):b};Wl.prototype.getDirection=Wl.prototype.zc;
Wl.prototype.Eb=function(a){a=a||zk();var b,c;if(this.m){var d=this.f;var e=this.f.length;var f=this.f[e-1];for(c=b=0;--e&&b<this.s;)c+=Vl($l(d[e],d[e-1])),b++;d=c/b}else f=this.b,d=Vl(this.ce());return d=d>=this.sb&&a-f.timestamp<=this.v?d>this.aa?this.aa:d:0};Wl.prototype.getSpeed=Wl.prototype.Eb;Wl.prototype.Wf=function(){return this.b?am(this.b):B};Wl.prototype.getBifocalCenter=Wl.prototype.Wf;Wl.prototype.ce=function(a){return(a=a?this.g:this.o)?$l(a,this.b):new Ul(0,0)};
Wl.prototype.getMoveVector=Wl.prototype.ce;Wl.prototype.Xf=function(a){var b=1;if(this.j){var c=this.b;a=a?this.g:this.o;if(a=bm(a))if(c=bm(c))b=c/a}return b};Wl.prototype.getBifocalScaling=Wl.prototype.Xf;Wl.prototype.uh=function(a){if(this.j){var b=a?this.g:this.o,c=this.b;a=b.b;var d=c.b,e=0;a&&d&&(b=b.a,c=c.a,e-=Kd(d.y-c.y,d.x-c.x)*Sd-Kd(a.y-b.y,a.x-b.x)*Sd);a=e}else a=0;return a};Wl.prototype.getBifocalRotation=Wl.prototype.uh;
function Xl(a,b,c,d,e){this.a=new I(a,b);c!==B&&(this.b=new I(c,d),this.c=!0);this.timestamp=e!==B?e:zk()}Xl.prototype.c=!1;function am(a){var b=a.a;return(a=a.b)?new I(b.x-(b.x-a.x)/2,b.y-(b.y-a.y)/2):B}function cm(a,b){var c=a.a;return(a=a.b)&&a.Za(b)<c.Za(b)?a:c}function $l(a,b){var c=a.b,d=b.b;d&&c?(b=am(b),a=am(a)):c?(b=b.a,a=cm(a,b)):d?(a=a.a,b=cm(b,a)):(b=b.a,a=a.a);return new Ul(b.x-a.x,b.y-a.y)}function bm(a){var b=a.b;return b?a.a.Za(b):0};function dm(){F.call(this);this.reset()}u(dm,F);dm.prototype.start=function(a,b){this.a&&this.reset();E(a-b)||(this.b=+a,this.c=+b);this.a=!0};dm.prototype.reset=function(){this.a=!1;this.b=this.c=null;this.f=new em(0,0,0,0,0,0)};dm.prototype.va=function(){return this.a};dm.prototype.g={Rg:"animationupdate"};function fm(a){fm.l.constructor.call(this,dm.prototype.g.Rg);this.c=a}u(fm,rd);
dm.prototype.set=function(a,b,c,d,e,f){var g=this.f;this.a&&(a=new em(a/1E3,b/1E3,c/1E3,d/1E3,e/1E3,f/1E3),g.oa(a)||(this.f=a,this.dispatchEvent(new fm(gm(this)))))};function gm(a){return x.Object.create(a.f)}dm.prototype.Eb=function(){return gm(this).Eb()};dm.prototype.zc=function(){var a=gm(this),b=this.Eb()||1;return new em(a.nb/b,a.ob/b,a.pb/b,a.ue,a.ve,a.wf)};dm.prototype.u=function(){this.reset();dm.l.u.call(this)};
function em(a,b,c,d,e,f){this.nb=a;this.ob=b;this.pb=c;this.ue=d;this.ve=e;this.wf=f}em.prototype.Eb=function(){return Cd(this.nb*this.nb+this.ob*this.ob+this.pb*this.pb)};em.prototype.zc=function(){var a=this.Eb()||1;return new em(this.nb/a,this.ob/a,this.pb/a,this.ue,this.ve,this.wf)};em.prototype.oa=function(a){return!!a&&this.nb===a.nb&&this.ob===a.ob&&this.pb===a.pb&&this.ue===a.ue&&this.ve===a.ve&&this.wf===a.wf};function hm(a,b,c,d){hm.l.constructor.call(this);this.vc=a;this.sa=d;this.a=a.appendChild(this.createElement(a.ownerDocument));this.yf(b,c)}u(hm,nd);hm.prototype.L=function(){return this.a};hm.prototype.yf=function(a,b){this.size?(this.size.w=a,this.size.h=b):this.size=new Ki(a,b);this.Dl(this.a,this.a.style,a,b,this.sa)};hm.prototype.setSize=hm.prototype.yf;n=hm.prototype;n.Db=function(){return this.size};n.$a=function(){return this.sa};n.tk=!0;
n.wb=function(a){a!==this.tk&&(this.a.style.display=a?"block":"none",this.tk=a)};n.ai=1;n.qc=function(a){this.ai!==a&&(this.Ak(a),this.ai=a)};n.dd=function(){return this.ai};n.ye=function(a){this.a.style.zIndex=a};hm.prototype.setZIndex=hm.prototype.ye;n=hm.prototype;n.fk=function(){return+this.a.style.zIndex};n.Zc=function(){};n.clear=function(){};n.u=function(){this.clear();this.vc.removeChild(this.a);this.yf(0,0);this.a=this.vc=null;hm.l.u.call(this)};n.hl=0;n.Dg=function(){++this.hl};
n.release=function(){--this.hl||this.B()};function im(a,b,c,d){im.l.constructor.apply(this,arguments)}u(im,hm);t("H.map.render.dom.Surface",im);n=im.prototype;n.Xd=function(){return"dom"};n.createElement=function(a){a=a.createElement("DIV");a.style.position="absolute";a.style.pointerEvents="none";return a};n.Dl=function(a,b,c,d){b.width=c+"px";b.height=d+"px"};n.Ak=function(a){this.a.style.opacity=a};
n.Zc=function(a,b,c){var d=this.sa,e=a.style;e[xf("transform")]="matrix(1,0,0,1,"+b/d+","+c/d+")";a.parentNode!==this.a&&(e.position="absolute",this.a.appendChild(a),this.a.style.pointerEvents="auto","auto"===getComputedStyle(a).pointerEvents&&(a.style.pointerEvents="all"),this.a.style.pointerEvents="none")};n.clear=function(a){a?this.a.removeChild(a):this.a.innerHTML=""};function jm(a,b,c,d,e,f){var g=e||"2d";jm.l.constructor.apply(this,arguments);this.b=this.a.getContext(g,f);this.c="2d"===g;this.f=g;this.uo=f}u(jm,hm);n=jm.prototype;n.createElement=function(a){a=a.createElement("canvas");var b=a.style;b.position="absolute";b.top=b.left="0";return a};n.Dl=function(a,b,c,d,e){a.width=wd(c,1);a.height=wd(d,1);b.width=xd(c/e)+"px";b.height=xd(d/e)+"px"};n.Ak=function(a){this.b.globalAlpha=a};n.Zc=function(a,b,c,d,e){this.c&&this.b.drawImage(a,b,c,d,e)};n.Xd=function(){return this.f};
n.clear=function(a){var b,c;this.c&&(a?this.b.clearRect(b=a.left,c=a.top,a.right-b,a.bottom-c):this.a.width=this.size.w)};n.u=function(){this.a.width=this.a.height=0;this.b=y;jm.l.u.call(this)};function km(a){this.hb=a}u(km,nd);km.prototype.tb=function(){return this.hb};km.prototype.getLayer=km.prototype.tb;km.prototype.Kn=function(){return this.xb};km.prototype.getSurface=km.prototype.Kn;km.prototype.ld=function(a){var b=this.xb;a!==b&&(this.xb=a,a.Dg(),b&&b.release())};km.prototype.setSurface=km.prototype.ld;km.prototype.u=function(){this.xb.release()};km.prototype.ie=function(){};km.prototype.render=km.prototype.V;function lm(a){var b="dom";lm.l.constructor.call(this,a);C(this.hb,mm)&&(b="2d"===a.Xd()?"2d":"webgl");this.a=b}u(lm,km);lm.prototype.V=function(a,b,c,d,e,f,g,h){g=this.hb;var k=this.xb,l=!(C(k,jm)&&"2d"===k.Xd());if(d>=g.min&&d<=g.max)return l&&k.wb(!0),g.V(k.L(),{boundingBox:a,zoom:d,screenCenter:b,priorityCenter:f,projection:c,cacheOnly:e,size:k.Db(),pixelRatio:k.$a(),cameraMatrix:h});l&&k.wb(!1);return jk.DONE};lm.prototype.ie=function(){return this.a};function nm(a,b,c,d,e){if(!Ca(a.Di)||!Ca(a.Ai))throw new D(nm,0,a);this.b=a;if(!Ca(this.i=b))throw new D(nm,1,b);if(E(this.g=+c))throw new D(nm,2,c);if(!Ca(this.f=d)&&null!=d)throw new D(nm,3,d);if(!Ca(this.c=e)&&null!=e)throw new D(nm,4,e);this.id=(new af).next();this.a=!1}t("H.util.animation.Animation",nm);
nm.prototype.start=function(){var a=this;this.Rc=zk();this.a=!0;var b=this.Rc;this.b.Di(function(){if(a.a){var c=zk(),d=c-a.Rc,e=d/a.g,f=!1;1<=e&&(e=1,f=!0);a.i(a.c?a.c(e):e,d,c-b,c);b=c;f&&a.stop()}else a.stop()})};nm.prototype.start=nm.prototype.start;nm.prototype.stop=function(a){this.a=!1;this.b.Ai();a||this.f&&this.f(this)};nm.prototype.stop=nm.prototype.stop;nm.prototype.va=function(){return this.a};nm.prototype.isRunning=nm.prototype.va;function om(a,b){om.l.constructor.call(this,a);this.xc=!(!b||!b.xc);this.f={}}u(om,km);om.prototype.ld=function(a){om.l.ld.call(this,a);this.g=a.vc.ownerDocument};om.prototype.setSurface=om.prototype.ld;var pm=function(a,b){b=b.ba();return C(b,kh)?b.pa:(a[0]=b,a)}.bind(null,[]);
om.prototype.V=function(a,b,c,d,e,f,g){var h=this.hb,k,l,m,p;this.m=b=this.f;this.f=c={};if(d>=h.min&&d<=h.max){var q=this.Nj(a,d,e,f);var r=q.markers;if(a=r.length){d=[];e=this.xb;for(f=0;f<a;f++){h=r[f];var v=pm(h);for(k=v.length;k--;)if(l=g(v[k]))(p=b[m=h.gb()+"_"+k])?delete b[m]:p={Mk:h},c[m]=p,d.push([p,h,h.Cb(),e,l.x,l.y])}d.sort(qm);a=d.length;for(f=0;f<a;f++)this.jl.apply(this,d[f])}}return!q||q.requested&&q.requested===q.total||!q.requested&&r.length===q.total?jk.DONE:jk.PENDING};
om.prototype.render=om.prototype.V;function qm(a,b){var c=a[1].ed(),d=b[1].ed();return Qg(c,d,!0)||a[5]-b[5]||Qg(c,d,!1)}om.prototype.Ga=function(){};om.prototype.getObjectsAt=om.prototype.Ga;function rm(a,b){rm.l.constructor.apply(this,arguments);this.c=0;this.a=[];this.b=A(this.b,this)}u(rm,om);t("H.map.render.dom.MarkerRenderer",rm);rm.prototype.Nj=function(){return this.hb.Kc.apply(this.hb,arguments)};rm.prototype.V=function(a,b,c,d,e,f,g){this.b();this.j=0;var h=rm.l.V.apply(this,arguments);var k=this.xb,l=this.m,m;for(m in l)sm(this,k,l[m]);return 0===this.a.length&&h?jk.DONE:jk.PENDING};rm.prototype.render=rm.prototype.V;
rm.prototype.ld=function(a){rm.l.ld.call(this,a);this.i=a.$a()};rm.prototype.setSurface=rm.prototype.ld;rm.prototype.b=function(){for(var a=this.a.length,b,c,d;a--;)d=this.a[a],b=d.Ef,c=d.Ef.Cb(),c.mi(d,c,b);this.a.length=0};rm.prototype.jl=function(a,b,c,d,e,f){var g;var h=d.$a();var k=b.Pb();e*=h;f*=h;this.xc||(e=xd(e),f=xd(f));a.detail&&(k.me(a.co)?sm(this,d,a):g=a.detail);g||(a.detail=g=c.Qj(this.g),this.c++,Ca(c.mi)&&this.a.push(g));a.co=k.a;g.style.zIndex=this.j++;g.Ef=b;d.Zc(g,e,f,0,0)};
var tm,um="pointer-events",vm;if(Ye){var wm;Ye&&Yc!==y&&(Yc=(wm=/(MSIE\s+|rv:)([^\);]+)(\)|;)/.exec(navigator.userAgent))?+wm[2]:y);vm=Yc;9===vm?um="display":10===vm&&(um="visibility")}tm=um;
rm.prototype.Ga=function(a,b,c){var d=this.i,e=ff,f,g,h,k,l;if(this.c){a/=d;b/=d;d=this.g;var m=d.documentElement;var p=this.xb.L();var q=p.getBoundingClientRect();a+=q.left;for(b+=q.top;(g=h=d.elementFromPoint(a,b))&&g!==p&&g!==m&&h!==r;){for(;(k=g.parentNode)&&(!Ca(k.contains)||!k.contains(p));)g=k;if(k===p&&(g!==h||"svg"!==g.nodeName)&&0>e.indexOf(l=g.Ef)&&(e===ff&&(e=[]),e.push(l),c))break;f||(f=[]);var r=g.style;f.push({Aj:r.getPropertyValue(tm),bo:r.getPropertyPriority(tm),style:r});r.setProperty(tm,
"visibility"===tm?"hidden":"none","important");r=h}if(f)for(b=f.length;b--;)a=f[b],a.style.removeProperty(tm),zc(a.Aj)&&a.style.setProperty(tm,a.Aj,a.bo)}return e};rm.prototype.getObjectsAt=rm.prototype.Ga;rm.prototype.ie=function(){return"dom"};function sm(a,b,c){b.clear(b=c.detail);delete b.Ef;a.c--;c=(a=c.Mk).Cb();c.b&&c.b(b,c,a)}rm.prototype.u=function(){this.a.length=0;var a=this.xb,b=this.f,c;for(c in b)sm(this,a,b[c]);this.xb.B();rm.l.u.call(this)};function mm(a,b){var c=b||{},d=c.contextType;c=c.contextAttributes;mm.l.constructor.call(this,b);wc(a,"Function",mm,0,"invalid render callback");if(d){if(-1===xm.indexOf(d))throw new D(mm,1,"invalid context type");this.f=d}c&&(this.m=c);this.j=a}u(mm,aj);t("H.map.layer.CanvasLayer",mm);var xm=["2d","webgl","webgl2","experimental-webgl"];mm.prototype.f="2d";mm.prototype.Xd=function(){return this.f};
mm.prototype.V=function(a,b){this.c&&this.c.canvas===a||(this.c=a.getContext(this.f,this.m));return this.j(this.c,b)};mm.prototype.u=function(){mm.l.u.call(this);this.c=B};function ym(a,b){ym.l.constructor.call(this,b);wc(a,"Function",ym,0,"invalid render callback");this.c=a}u(ym,aj);t("H.map.layer.DomLayer",ym);ym.prototype.V=function(a,b){return this.c(a,b)};function zm(a,b){if(E(this.b=+a))throw new D(zm,0,a);this.a=0;b&&this.yl(b)}t("H.util.kinetics.KineticMove",zm);zm.prototype.yl=function(a){this.a=a;return this};zm.prototype.setInitialSpeed=zm.prototype.yl;zm.prototype.Rm=function(){return Math.abs(this.a/this.b)};zm.prototype.getDuration=zm.prototype.Rm;zm.prototype.We=function(a){return this.a+this.b*a};zm.prototype.getCurrentSpeed=zm.prototype.We;zm.prototype.Mm=function(a){return this.a*a+this.b*a*a/2};zm.prototype.getCurrentPath=zm.prototype.Mm;function Am(a,b){this.a=a;this.b=b}
function Bm(a,b,c){var d=[],e={vc:a.a,width:b.w,height:b.h,sa:a.b};for(a=0;a<c.length;a++){b=c[a];var f=b.ie();var g={};Wa(g,e);var h=b.xb;switch(f){case "2d":C(b.tb(),mm)&&(g.ih=b.tb().m);if(f=m&&"2d"===m.Xd()){f=g.ih;var k=m.uo;f=k===f?!0:k&&!f?!k.alpha&&!k.willReadFrequently:f&&!k?!f.alpha&&!f.willReadFrequently:!f.alpha===!f.alpha&&!k.willReadFrequently===!f.willReadFrequently}if(f)var l=!1;else if(h&&!l){var m=h;l=!1}else m=new jm(g.vc,g.width,g.height,g.sa,"2d",g.ih),l=!0;break;case "dom":m=
h||new im(g.vc,g.width,g.height,g.sa);l=!h;break;default:m=h||new jm(g.vc,g.width,g.height,g.sa,b.tb().Xd(),g.ih),l=!h}d[d.length-1]!==m&&(m.ye(d.length),d.push(m));b.ld(m)}return d};t("H.util.events.listenOnce",Ce);t("H.util.events.dispatchEvent",function(a,b){return a.dispatchEvent(b)});t("H.util.events.fireListeners",function(a,b,c,d){return le(a)?a.td(b,c,d):Le(a,b,c,d)});t("H.util.events.listen",Be);t("H.util.events.unlisten",Je);var Cm=Me;
Me=function(a,b){var c,d,e=!0;var f=b[b.currentTarget===b.target?"AT_TARGET":a.capture?"CAPTURING_PHASE":(c=!0,"BUBBLING_PHASE")];if(!c||"pointerenter"!==(d=b.type)&&"pointerleave"!==d)b.eventPhase=f,e=Cm(a,b),c&&a.src&&a.src.Qb&&null===a.src.Qb()&&delete b.eventPhase;return e};function sl(){sl.l.constructor.call(this);this.c={};this.b={position:new Wf(0,0),zoom:0,heading:180,incline:0,tilt:0,bounds:new O(Gg([90,-180,90,0,90,180,-90,180,-90,-180]))}}u(sl,F);t("H.map.ViewModel",sl);sl.prototype.a={Ea:"update",Fe:"sync"};
sl.prototype.$b=function(a,b){if(!a)throw new D(this.$b,0,a);var c=a[Dm];if(tc(c)&&!Yf(c))throw new D(this.$b,0,Dm);c=a[Em];if(tc(c)&&E(+c))throw new D(this.$b,0,Em);c=a[Fm];if(tc(c)&&!C(c,Vf))throw new D(this.$b,0,Fm);a=x.Object.assign({},a);c=Gm(a,this.c,this.b);Hm(this,this.c,a);this.dispatchEvent(new Im(this.c,c,b));return this};sl.prototype.setLookAtData=sl.prototype.$b;sl.prototype.mb=function(){var a={};a[Dm]=Zf(this.b[Dm]);Hm(this,a,this.b,!0);return a};sl.prototype.getLookAtData=sl.prototype.mb;
var Dm="position",Em="zoom",Fm="bounds",Jm={oj:Dm,rj:Em,ij:"heading",qj:"tilt",jj:"incline",fj:Fm},Km=Object.keys(Jm).map(function(a){return Jm[a]});
function Hm(a,b,c,d){a.i={};a.g={};a.f=[];for(var e=a.m,f=a.j,g=Km.length,h,k,l;g--;)if(h=Km[g],l=c[h],k=b[h],null==k||!d)if(null!=l){tc(e)&&e.call(a,h,k,l);var m=h,p;(p="position"!==h)||(p=l,p=!p||E(p.lat)||E(p.lng)?!1:!0);b[m]=p?l:Zf(l);if(tc(f)){switch(h){case "position":k=l&&k&&(l.lat!==k.lat||l.lng!==k.lng);break;case "bounds":k=l&&k&&!l.oa(k);break;default:k=l!==k}k&&f.call(a,h)}}else delete b[h]}sl.prototype.m=function(a,b,c){this.i[a]=b;this.g[a]=c};sl.prototype.j=function(a){this.f.push(Lm[a])};
var Lm=Km.reduce(function(a,b){a[b]=Si[b.toUpperCase()];return a},{});function Gm(a,b,c){var d=0;["tilt","incline","heading",Em].forEach(function(e){if(E(a[e])){var f=E(b[e])?c[e]:b[e];a[e]=f}else d|=Lm[e]});[Dm,Fm].forEach(function(e){a[e]?d|=Lm[e]:a[e]=b[e]||c[e]});return d}sl.prototype.bb=function(a){var b={},c={};Hm(this,this.b,a);this.c={};b.lookAt=this.g;c.lookAt=this.i;a=this.f;a=a.length?a.reduce(Mm):0;this.dispatchEvent(new Ri(this.a.Fe,b,c,a))};sl.prototype.synchronize=sl.prototype.bb;
function Mm(a,b){return a|b}sl.prototype.zf=function(a,b){if(E(a=+a))throw new D(this.zf,0,Em);this.$b({zoom:a},b)};sl.prototype.vb=function(){return this.b.zoom};sl.prototype.tc=Nc;sl.prototype.startControl=sl.prototype.tc;sl.prototype.control=Nc;sl.prototype.control=sl.prototype.control;sl.prototype.Ab=Nc;sl.prototype.endControl=sl.prototype.Ab;function Im(a,b,c){Im.l.constructor.call(this,sl.prototype.a.Ea,a,null,b);this.b=this.animate=!!c}u(Im,Ri);function S(a,b,c,d){S.l.constructor.call(this,a,b,c,d);this.Aa=new Dk(100);this.fa=new I(0,0);this.Ne=!!d.enableSubpixelRendering;this.kb=Nm;this.o=new Wl;this.i=d=new dm;this.dc=A(this.dc,this);d.addEventListener(d.g.Rg,this.dc);d=a.element;this.N=a=d.ownerDocument.createElement("div");a.style.position="absolute";a.style.width=a.style.height="100%";a.style.zIndex=0;d.insertBefore(a,d.firstChild);this.Pd=new Am(this.N,this.sa);this.ma=b.mb().position;b=x.H.gl;if(!b)throw new Xc(S,'"H-webgl" module is missing');
this.a=new Cl({viewport:this.g,vc:this.N,devicePixelRatio:this.sa,Tk:A(this.ha,this)});b.WorkerBroker.addTarget("model",cj);b=this.c.Na();a=0;d=b.length;this.j={Yc:[],ja:[]};for(this.f=b;a<d;a++){var e=b[a];this.jf(a,e);vl(this,e,!0)}this.Jb();this.ec=A(this.ec,this);this.ci=A(this.ci,this);this.Fa=A(this.Fa,this);c.addEventListener(aj.prototype.b.Ce,this.ec);this.A=Om;this.zoom=wl(this,this.O.vb());this.Jb();this.U()}u(S,ql);t("H.map.render.webgl.RenderEngine",S);
S.prototype.mb=function(){var a=this.ma;return xl(this,{position:{vk:a.vk,xk:a.xk},zoom:this.zoom,tilt:this.Nl,heading:this.heading})};S.prototype.ec=function(a){a=(a=a.target.ga())&&a.ub();(a&&a.getState())===Qh.INIT?a.load():(Fl(this.a),Hl(this.a,this.c),this.ha())};S.prototype.type=Al.WEBGL;S.prototype.type=S.prototype.type;var Om=2;S.prototype.getState=function(){return this.A};S.prototype.getState=S.prototype.getState;function Pm(a,b,c){b=c-b;a=Dd(2,8+a.zoom);return b<a/2?b:b-a*c/Ad(c)}
function Qm(a,b,c){function d(h){return e[h]+Tl(e[h],b[h])/2}if(!(c&Si.POSITION||c&Si.BOUNDS))return null;var e=Gl(a.a).getLookAtData();c=e.position;var f=b.position,g=b.bounds;if(qi(e.bounds,f.lat,f.lng,!1)||g&&qi(g,c.lat,c.lng,!1))return null;c=Rm(a,{tilt:d("tilt"),heading:d("heading"),incline:0,bounds:eg([c,f])});c.zoom=wl(a,c.zoom-.5);delete c.bounds;return c}S.prototype.od=!1;
function Sm(a,b,c,d){a=a.getCapabilities().lookAt[d];a=a.max-a.min;return Ad("zoom"===d?c[d]-b[d]:Tl(b[d],c[d]))/a||0}function Tm(a,b,c){a=wd(8*Sm(a,b,c,"zoom"),Sm(a,b,c,"heading"),Sm(a,b,c,"tilt")/2);return Yd(3E3*a,300,4E3)}
S.prototype.bh=function(a){var b=this,c=a.newValue,d=a.modifiers,e=Gl(this.a);Um(this);this.fa.set(0,0);var f=Vm(this,c);Km.forEach(function(l){d&a[l.toUpperCase()]||delete f[l]});if(a.b){e=Gl(this.a).getLookAtData();var g=Rm(this,f);c=Qm(this,g,d);var h=function(){return b.od=!1};delete g.bounds;this.od=!0;if(c){e=Tm(this,e,c);var k=Tm(this,c,g);Wm(this,c,e,function(){return Wm(b,g,k,h)})}else c=Tm(this,e,g),Wm(this,g,c,h)}else Xm(f),e.setLookAtData(f);Ym(this);Fl(this.a);this.ha()};
function Rm(a,b){Xm(b);return Gl(a.a).getBestLookAtData(b)}function Xm(a){var b=a.bounds;!b||b instanceof O||(a.bounds=ni(b.G()))}function Zm(a,b,c){Gl(a.a).setLookAtData(b);Fl(a.a);Ym(a);a.ha();c&&setTimeout(c,0)}
function Wm(a,b,c,d){var e=Gl(a.a).getLookAtData(),f=new Sl(e,b);0!==f.a.tilt+f.a.heading+f.a.zoom+f.c?$m(a,function(g){for(var h in f.a)if(0!==f.a[h]){var k=f.i[h](g);e[h]+=f.a[h]*(k-f.g[h]);f.g[h]=k}0!==f.c&&(e.position=f.b.Ng(f.j,f.c*f.i.position(g),!0));return Zm(a,e)},c,function(){return Zm(a,b,d)}):Zm(a,b,d)}S.prototype.Fg=function(){};S.prototype.setAnimationDuration=S.prototype.Fg;S.prototype.sh=function(){};S.prototype.getAnimationDuration=S.prototype.sh;S.prototype.Gg=function(){};
S.prototype.setAnimationEase=S.prototype.Gg;S.prototype.th=function(){};S.prototype.getAnimationEase=S.prototype.th;S.prototype.Cg=function(){};S.prototype.resetAnimationDefaults=S.prototype.Cg;function an(a,b){a.Aa.qa(function(c,d){return d.Qb()===b})}n=S.prototype;n.Rk=function(a){an(this,a.target.ga());Fl(this.a);this.ha()};n.jf=function(a,b){S.l.jf.call(this,a,b);bn(b)&&(Fl(this.a),(a=(a=b.ga())&&a.ub())&&a.getState()===Qh.INIT&&a.load())};
n.oi=function(a,b,c){var d;this.Xa=zk();an(this,b.ga());if(b.requestDomMarkers||C(b,mm)||C(b,ym)){var e=this.j.ja;for(d=e.length;d--;){var f=e[d];if(f.tb()===b){e.splice(d,1);f.B();break}}}bn(b)&&Hl(this.a,this.c);this.f=this.c.Na();0===a&&(vl(this,b,!1),this.Jb());Bm(this.Pd,cn(this),this.j.ja.filter(tc));this.te();c||this.ha()};function bn(a){return!(C(a,ym)||C(a,mm))}n.pi=function(){this.Jb()};
n.Jb=function(){S.l.Jb.call(this);var a=this.getCapabilities().lookAt.zoom;Gl(this.a).setZoomConstraints(wd(a.min,this.Pg),vd(a.max,this.Tg))};n.Mh=function(a,b){var c;if(b){a={xc:this.Ne,ib:this.ib};b.V?C(b,mm)?c=new lm(b):C(b,ym)&&(c=new lm(b)):b.requestDomMarkers&&(c=new rm(b,a));if(c){this.j.ja.push(c);var d=this.c.Na();this.j.ja.sort(function(e,f){return d.indexOf(e.hb)-d.indexOf(f.hb)});Bm(this.Pd,cn(this),this.j.ja.filter(tc))}bn(b)&&Hl(this.a,this.c)}this.f=this.c.Na()};
function Vm(a,b){var c=b.position;return xl(a,{zoom:wl(a,b.zoom),position:new Wf(c.lat,c.lng),tilt:b.tilt,heading:b.heading,bounds:b.bounds})}function Ym(a){var b=Gl(a.a).getLookAtData();a.zoom=b.zoom;a.ma=b.position}function dn(a,b){a=Gl(a.a).geoToMeters(b);return new I(a.x/4.007501668557849E7+.5,1-(a.y/4.007501668557849E7+.5))}function en(a,b){return b.sub(dn(a,a.ma)).scale(Dd(2,8+a.zoom))}n.Fa=function(a){return Gl(this.a).geoToPixel(a)};S.prototype.geoToScreen=S.prototype.Fa;
S.prototype.Wa=function(a,b){return Gl(this.a).xyToGeo(a,b)};S.prototype.screenToGeo=S.prototype.Wa;S.prototype.Eg=function(a,b){a=this.Wa(a,b);b=this.O.mb();b.position=a;return b};
function fn(a,b,c,d,e,f,g,h){var k,l,m=0,p;var q=function(){0===--m&&f(e)};if(h&&h.features)for(m=l=h.features.length,p=0;p<l;p++){var r=h.features[p];var v=r.id;if(k=a.a.a.sources[r.source_name]){var w=k.provider;var z=w.ak();if(z===Zj.SOURCE){var J=r.source_layer;if("overlays"===J)gn(a,b,c,d,e,k,r.properties.overlays_config);else if(k=k.getMapObjectById(v))if("markers"!==J)e.push(k);else if(hn(a,b,c,k))e.push(k);else if(d&&!g){var G=!0;Kl(a.a,{x:b,y:c},{radius:jn,top_most_only:!1},function(U){fn(a,
b,c,d,e,f,!0,U)})}m--}else z===Zj.FEATURE?(J=r.tile.coords,G=w.getFeatureProxy(r.properties,J,function(U){if(U){for(var X=U,xa;X&&(xa=X.Qb())&&xa!==w;)X=xa;xa||X.ka(w);e.push(U)}q()}),G||(k=a.Aa.get(v),k||(k=new Kg(r),k.ka(w),a.Aa.add(v,k,1)),e.push(k),m--)):z===Zj.PROVIDER&&(G=!0,w.kl(r,!1).then(function(U){U&&(U instanceof Ni?hn(this,b,c,U):1)&&e.push(U);q()},function(){q()},a))}}z&&(G||0!==m)||f(e)}
function gn(a,b,c,d,e,f,g){var h;a=a.Wa(b,c);for(b=g.length;b--&&(!(h=f.getMapObjectById(g[b].id))||0<=e.indexOf(h)||!h.ba().pd(a)||(e.push(h),!d)););}function hn(a,b,c,d){var e=d.Cb(),f=e.g,g,h=!f;if(f)if(e=e.ud(),b+=e.x,c+=e.y,e=d.ba(),C(e,Ji))for(d=e.pa,g=d.length;g--&&!h;)e=a.Fa(d[g]),h=f.hg(b-e.x,c-e.y,0)!==ae.NONE;else e=a.Fa(e),h=f.hg(b-e.x,c-e.y,0)!==ae.NONE;return h}
S.prototype.Ga=function(a,b,c,d){var e=this,f=[];f=kn(f,this.j.ja,a*this.sa,b*this.sa,c);c&&f.length?d(f):this.a.a.initialized?Kl(this.a,{x:a,y:b},{radius:jn,top_most_only:c},function(g){fn(e,a,b,c,f,d,!1,g)}):d(f)};S.prototype.getObjectsAt=S.prototype.Ga;function kn(a,b,c,d,e){for(var f=b.length,g;f--&&!((g=b[f])&&g.Ga&&(a=a.concat(g.Ga(c,d,e)),a.length&&e)););return a}S.prototype.W=y;function cn(a){a=a.yb[2];return{w:a.right-a.left,h:a.bottom-a.top}}
S.prototype.U=function(){var a=this.j.ja.length;rl(this,this.sa);this.fa.set(0,0);var b=cn(this);var c=b.w;var d=b.h;for(this.a.a.handleViewportUpdate();a--;){b=this.j.ja[a].xb;var e=b.Db();e.w===c&&e.h===d||b.yf(c,d)}this.W=new Ki(c,d);Fl(this.a);this.ha()};S.prototype.getCapabilities=function(){return Bl};S.prototype.getCapabilities=S.prototype.getCapabilities;function ln(a){a.b&&a.b.va()||(El(a.a)||zk()-a.Xa<a.kb)&&!a.v?a.Vd||(a.Vd=Jk(a.ci)):(a.v&&(a.te(),mn(a)),a.A=Om)}n=S.prototype;n.Vd=0;
n.te=function(){this.j.Yc.length=0};
n.ci=function(){this.Vd=0;this.C&&this.C.before();var a=Gl(this.a);var b=a.getLookAtData(!1);var c=a.getLookAtData(!0);a=this.g.center.clone();c=c.bounds.G();var d=this.zoom;var e=this.fa;var f=this.f;var g=f.length;for(this.kb=Nm;g--;){var h=f[g];C(h,aj)&&h.ga()&&h.ga().nf(c,d)}this.v=this.a.V();this.O.bb(b);b=this.v;f=this.j;g=f.ja.length;var k=!0,l;for(l=0;l<g;l++){h=f.ja[l];var m=f.Yc;if(h){var p=h.V(c,a,void 0,d,!1,e,this.Fa,this.a.a.getCameraMatrix());p===jk.ACTIVE&&(this.kb=Infinity);p!==jk.DONE||
m[l]||(mn(this,h.tb()),m[l]=!0);m[l]||(k=!1)}}this.v=b&k;this.W&&(this.g.bb(this.W),this.W=y);this.b&&this.b.va()&&this.Sg();this.C&&this.C.after();ln(this)};function mn(a,b){a.od||setTimeout(A(a.dispatchEvent,a,{type:a.zk.pj,target:b||a}),1)}n.u=function(){var a=this.c.Na()[0],b=this.g;Kk(this.Vd);nn(this);a&&vl(this,a,!1);this.j.ja.filter(tc).forEach(function(c){c.B()});b.element&&b.element.removeChild(this.N);this.N=null;this.A=3;this.a.B();S.l.u.call(this)};
n.ha=function(){this.Xa=zk();this.A===Om&&(this.v=!1,this.A=1,ln(this))};function on(a,b,c){Gl(a.a).applyPxOffset([b,c]);Ym(a);a.fa.set(0,0);Fl(a.a);a.ha()}n.Ae=function(a,b,c){a=wl(this,wl(this,a));pn(this,a,b,c)};S.prototype.zoomAt=S.prototype.Ae;function pn(a,b,c,d){Gl(a.a).setLookAtData({zoom:b},Cc(c)&&Cc(c)?[c,d]:B);Ym(a);Fl(a.a);a.ha()}function Um(a){nn(a);a.i.va()&&a.Ab(!0);a.o.va()&&a.Bb(!0)}function qn(a,b){if(b){var c={};c.mf=b.power;c.Oe=b.ease;c.duration=b.duration;a.s=c}}
S.prototype.uc=function(a,b){var c=!!(b||a&(ul.HEADING|ul.TILT));Um(this);qn(this,b);this.o.start(a,c);Gl(this.a).setPanning(!0)};S.prototype.startInteraction=S.prototype.uc;
S.prototype.lc=function(a,b,c,d,e){var f=this.o;var g=!1;if(f.va()){var h=Gl(this.a);var k=h.getLookAtData();var l=this.g.center;l=[l.x,l.y];b=f.store(a,b,c,d,e);c=f.Wf();a=f.ce();e=this.o.Xf();d=this.o.uh();f.c&&(f.Hc(ul.TILT)&&(h.setLookAtData({tilt:yl(this,k.tilt+a.y/this.g.height*-180)},l),g=!0),b&&1!==e&&f.Hc(ul.ZOOM)&&(g=f.Wf(),e=Bd(Dd(2,this.zoom)*e)/Ld,pn(this,wl(this,e),g.x,g.y),g=!0),f.Hc(ul.COORD)&&0<Vl(a)&&(on(this,-a.x,-a.y),g=!0),f.Hc(ul.HEADING)&&(b?h.setLookAtData({heading:k.heading+
zl(this,d)},[c.x,c.y]):a.x&&h.setLookAtData({heading:zl(this,k.heading+a.x/this.g.width*360)},l),g=!0),g&&(Fl(this.a),this.ha()))}};S.prototype.interaction=S.prototype.lc;
S.prototype.Bb=function(a){var b=this;if(this.o.va()&&!a){if(this.s){a=this.o.Eb();var c=this.o.zc();var d=this.s.duration;var e=(this.s.mf||1)*a;var f=new zm(-e/(0<d?d:1),e);!E(c.x)&&!E(c.y)&&0<e&&b.o.Hc(ul.COORD)&&$m(this,function(g){e=f.We(g*d);E(e)||on(b,xd(-c.x*e),xd(-c.y*e))},d,void 0,this.s.Oe)}this.s=null;this.o.clear()}Gl(this.a).setPanning(!1);this.ha()};S.prototype.endInteraction=S.prototype.Bb;S.prototype.tc=function(a,b,c){Um(this);this.i.start(b,c);qn(this,a);Gl(this.a).setPanning(!0)};
S.prototype.startControl=S.prototype.tc;S.prototype.control=function(a,b,c,d,e,f){for(var g=0,h;g<arguments.length;g++)if(h=+arguments[g],h!==h)throw new D(this.control,g,h);this.i.va()&&this.i.set(a,b,c,d,e,f)};S.prototype.control=S.prototype.control;
S.prototype.Ab=function(a,b){var c=this,d;if(this.i.va()){nn(this);var e=zk();var f=e-this.za;if(1<=f){var g=gm(this.i);rn(this,g,f)}if(!this.s||a||b)"function"===typeof b&&(a=Gl(this.a),a=a.getLookAtData(),b(a),sn(this,a));else{b=this.i.Eb();var h=this.i.zc();var k=this.s.duration;var l=(this.s.mf||1)*b;var m=new zm(-l/(0<k?k:1),l);!E(h.nb)&&!E(h.ob)&&0<l&&$m(this,function(p,q,r,v){e&&(r=v-e,e=0);l=m.We(p*k)*r;E(l)||((d=h.pb*l)&&pn(c,wl(c,c.zoom+d),c.i.b,c.i.c),on(c,xd(h.nb*l),xd(h.ob*l)))},k,void 0,
this.s.Oe)}this.i.reset();Gl(this.a).setPanning(!1);this.ha()}};S.prototype.endControl=S.prototype.Ab;
function sn(a,b){var c=en(a,dn(a,b.position)),d=c.y;c=c.x;var e=b.zoom,f=en(a,dn(a,a.ma));b=f.y;var g=f.x;f=a.zoom;var h=a.i.Eb(),k=a.i.b,l=a.i.c,m=0;c=Pm(a,g,c);c-=g;d-=b;f=e-f;b=Cd(c*c+d*d+f*f);if(0!==h&&0!==b){var p=c/b;var q=d/b;var r=f/b;var v=h*h/(2*b);$m(a,function(w,z){var J;if(1!==w){w=h*z-v*z*z/2;z=w-m;if(J=r*z)J=wl(a,a.zoom+J),pn(a,J,k,l);on(a,xd(p*z),xd(q*z));m=w}else pn(a,wl(a,e),k,l),a.ha()},2*b/h)}}
S.prototype.dc=function(a){var b=this,c=a.c;this.fa.set(0,0);c.nb||c.ob||c.pb||c.ue||c.ve||c.wf?(this.za=zk(),$m(this,function(d,e,f,g){b.za=g;rn(b,c,f)},Td),this.ha()):nn(this)};function rn(a,b,c){c=c||0;var d=a.i,e=Gl(a.a),f=e.getLookAtData();b.pb&&pn(a,wl(a,f.zoom+b.pb*c),d.b,d.c);e.setLookAtData({heading:zl(a,f.heading+b.ve*c),tilt:yl(a,f.tilt+b.ue*c)});Ym(a);on(a,b.nb*c,b.ob*c)}function $m(a,b,c,d,e){a.b&&a.b.va()&&a.b.stop(!0);a.b=new nm(a,b,c,d,e);a.b.start()}
function nn(a){a.b&&a.b.va()&&a.b.stop(!0)}S.prototype.nh=function(){};S.prototype.enter=S.prototype.nh;S.prototype.Vf=function(a){tl(this.N,a)};S.prototype.exit=S.prototype.Vf;S.prototype.capture=function(a,b,c,d){var e=this;return Ll(e.a).then(function(f){var g=e.N.ownerDocument.createElement("canvas"),h=e.sa,k=g.getContext("2d"),l=e.a.$a()/h,m=(c-a)*h;h*=d-b;g.width=m;g.height=h;k.drawImage(f,a*l,b*l,m*l,h*l,0,0,m,h);return g})};S.prototype.ym=function(a){return Gl(this.a).geoToMeters(a)};
S.prototype.geoToMeters=S.prototype.ym;S.prototype.Eo=function(a){return Gl(this.a).metersToGeo(a)};S.prototype.metersToGeo=S.prototype.Eo;var Nm=5E3,jn=3.5;function T(a,b,c){var d={};T.l.constructor.call(this);this.J=A(T.prototype.J,this);this.i=tn(c,T);this.b=c=new sl;this.N=!1;c.addEventListener(c.a.Fe,this.za,!1,this);if(!C(a,Element))throw new D(T,0,a);c=this.S=a.ownerDocument.createElement("div");var e=c.style;e.position="relative";e.height=c.style.width="100%";e.overflow="hidden";e.webkitTapHighlightColor="transparent";"transparent"!==e.webkitTapHighlightColor&&(e.webkitTapHighlightColor="rgba(0,0,0,0)");a.appendChild(c);this.ya=new kk(this.S,
this.i);this.ya.addEventListener(this.ya.a.Fe,this.za,!1,this);a=this.a=new cj(this.i.layers);a.addEventListener(a.b.Ee,this.U,!1,this);a.addEventListener(a.b.Be,this.U,!1,this);a.addEventListener(a.b.De,this.U,!1,this);!this.f&&un(this);this.c=null;this.a.add(b,0);this.g=this.O(null!=this.i.engineType?this.i.engineType:Vj.WEBGL,this.i);this.v=A(this.v,this);this.C=A(this.C,this);b=this.i.imprint;if(b!==B&&"object"!==typeof b)throw new D(T,1,"imprint");this.m=null===b?b:new lj(this,b);b=this.i.autoColor;
this.fa=b===B||!!b;vn(this);(b=this.i.zoom)&&(d.zoom=b);(b=this.i.bounds)&&(d.bounds=b);(b=this.i.center)&&(d.position=b);this.b.$b(d)}u(T,F);t("H.Map",T);function tn(a,b){if(a){var c=a.pixelRatio;if(c===B)a.pixelRatio=Se();else if(!(0<c))throw new D(b,0,"pixelRatio: "+c);}else a={},a.pixelRatio=Se();a.renderBaseBackground||(a.renderBaseBackground={lower:3,higher:2});return a}
T.prototype.u=function(){this.fa=!1;this.m&&this.m.B();this.g.dispose();this.b.B();this.ya.B();this.f.B();this.j.B();this.a.B();var a=this.S;a.parentNode.removeChild(a);this.S=null;F.prototype.u.call(this)};T.prototype.L=function(){return this.S};T.prototype.getElement=T.prototype.L;T.prototype.$a=function(){return this.i.pixelRatio};T.prototype.getPixelRatio=T.prototype.$a;function vn(a){a.m&&a.fa&&a.m.Li({invert:a.c&&a.c.nm})}
T.prototype.U=function(a){var b=a.added,c=a.removed;b&&b.ga()&&b.ga().ka(this);c&&c.ga()&&c.ga().ka(null);c===this.f&&(this.j=this.f=null);c===this.c&&(this.c=null);0===a.idx&&(this.dispatchEvent(new Ng(this.o.Ff,this.c=a.type!==this.a.b.De?b:0<this.a.a.length?this.a.get(0):y,a.type!==this.a.b.Be?c:1<this.a.a.length?this.a.get(1):y)),vn(this))};T.prototype.za=function(a){a.modifiers&&(this.N||(wn(this,"start"),this.N=!0),wn(this,"",a),this.W&&x.clearTimeout(this.W),this.W=x.setTimeout(this.C,333))};
function wn(a,b,c){a.dispatchEvent(c?new Ri(a.o.kj,c.newValue,c.oldValue,c.modifiers):a.o.kj+b)}T.prototype.C=function(){wn(this,"end");this.N=!1};T.prototype.Hg=function(a,b){this.g.getCapabilities().lookAt&&this.b.$b({position:a},!!b);return this};T.prototype.setCenter=T.prototype.Hg;T.prototype.fb=function(){var a=this.b.mb();return a?a.position:y};T.prototype.getCenter=T.prototype.fb;T.prototype.zf=function(a,b){this.b.zf(a,!!b);return this};T.prototype.setZoom=T.prototype.zf;T.prototype.vb=function(){return this.b.vb()};
T.prototype.getZoom=T.prototype.vb;T.prototype.Ae=function(a,b,c){this.g.zoomAt(a,b,c)};T.prototype.zoomAt=T.prototype.Ae;T.prototype.Un=function(){return this.ya};T.prototype.getViewPort=T.prototype.Un;T.prototype.Tn=function(){return this.b};T.prototype.getViewModel=T.prototype.Tn;T.prototype.jn=function(){return this.a};T.prototype.getLayers=T.prototype.jn;T.prototype.dn=function(){return this.m};T.prototype.getImprint=T.prototype.dn;
T.prototype.capture=function(a,b,c,d,e,f){function g(G,U){q?G.cancel():(w.save(),U.capture(v,m,function(X){w.restore();G.done(X)},function(X){G.done(null,X);h(null)}))}function h(G){q||(q=!0,a(G))}var k=this.ic(),l=k.getCapabilities(),m=this.i.pixelRatio,p=this.ya,q=!1,r=this,v,w;if(!Ca(a))throw new D(this.capture,0,a);c=c||0;d=d||0;e=e||p.width;f=f||p.height;var z=wd(0,vd(c,e));var J=wd(0,vd(d,f));c=vd(p.width,wd(c,e));d=vd(p.height,wd(d,f));l.capture?k.capture(z,J,c,d).then(function(G){var U=r.m,
X=b||[];v=G;w=v.getContext("2d");v.style.width=v.width/m+"px";v.style.height=v.height/m+"px";var xa=new xk(10,g);X=X.concat(U).filter(function(ia){return Ca(ia&&ia.capture)});X.length?(G=X.pop(),X.forEach(function(ia){xa.push(ia,hd)}),xa.push(G,A(h,r,v)),tk(xa)):h(v)},function(){h(y)}):a(null)};T.prototype.capture=T.prototype.capture;T.prototype.ic=function(){return this.s||this.g};T.prototype.getEngine=T.prototype.ic;
T.prototype.wl=function(a){this.g.type===a||this.ma||(this.ma=!0,this.s=this.O(a),this.s.addEventListener("render",this.v));return this};T.prototype.setEngineType=T.prototype.wl;T.prototype.v=function(a){a.target===this.s&&(this.s.removeEventListener("render",this.v),this.g.Vf(this.J))};T.prototype.J=function(){var a=this.g.type;this.g.B();this.g=this.s;this.s=B;this.ma=!1;this.dispatchEvent(new Ng(this.o.Vl,this.g.type,a))};
T.prototype.O=function(a,b){b=b?tn(b,this.O):this.i;vn(this);if(a===Vj.P2D)return new x.H.map.render.p2d.RenderEngine(this.ya,this.b,this.a,b);if(a===Vj.WEBGL)return new S(this.ya,this.b,this.a,b);if(a===Vj.HARP)return new x.H.map.render.harp.RenderEngine(this.ya,this.b,this.a,b);throw new D(this.wl,0,a);};
T.prototype.Cf=function(a,b,c,d,e){b=tc(b)?C(b,K,this.Cf,1,b)&&b:this.b.mb().bounds.G();e=e||this.c;if(!C(e,cl))throw new D(this.Cf,4);var f=e.ga(),g=this.$a(),h=e.tileSize;2<=g&&256<h&&f instanceof sk&&(h/=2);g=this.vb();h=Math.log2(h)-8;c=tc(c)?+c:g;d=tc(d)?+d:g;if(!(c<=d))throw new D(this.Cf,B,"!(min <= max)");g=f.min;var k=f.max,l=this.ic().type===Vj.WEBGL?yd:xd;c=Yd(l(c)-h,g,k);d=Yd(l(d)-h,g,k);if(!(f&&C(f,R)&&ld()&&f.fh()))throw new Xc(this.Cf,"Storing is not supported");return new nk(e,f,b,
c,d,a)};T.prototype.storeContent=T.prototype.Cf;function xn(a){hj.call(this,a)}u(xn,hj);xn.prototype.f=function(){jj(this,2)};xn.prototype.c=function(){jj(this,4)};T.prototype.mm=function(a){a=new xn(a);kd().clear(A(a.f,a),A(a.c,a));return a};T.prototype.clearContent=T.prototype.mm;T.prototype.Xg=function(a,b){var c=this.a,d=c.indexOf(a),e=b!==+b;b=e?c.a.length-1:b;0>d?c.add(a,b):d-b&&(c.pc(d),c.add(a,e?b-1:b));return this};T.prototype.addLayer=T.prototype.Xg;
T.prototype.rf=function(a){var b=this.a.indexOf(a);a!==this.c&&a!==this.f&&-1!==b&&this.a.pc(b);return this};T.prototype.removeLayer=T.prototype.rf;T.prototype.Kd=function(a){this.c!==a&&(this.a.a.length&&this.a.get(0)!==this.f?this.a.set(0,a):this.a.add(a,0),this.c=a);return this};T.prototype.setBaseLayer=T.prototype.Kd;T.prototype.Em=function(){return this.c};T.prototype.getBaseLayer=T.prototype.Em;
T.prototype.Fa=function(a){if(!Yf(a))throw new D(this.Fa,0,a);return(a=this.g.geoToScreen(a))?wf(a):y};T.prototype.geoToScreen=T.prototype.Fa;T.prototype.Wa=function(a,b){var c;if(c=+E(a)||2*E(b))throw new D(this.Wa,c-1,arguments[c-1]);return(c=this.g.screenToGeo(a,b))?Zf(c):y};T.prototype.screenToGeo=T.prototype.Wa;T.prototype.Eg=function(a,b){return this.g.screenToLookAtData(a,b)};T.prototype.screenToLookAtData=T.prototype.Eg;
T.prototype.ea=function(a){if(!C(a,M))throw new D(this.ea,0,a);!this.f&&un(this);this.j.kc().ea(a);return a};T.prototype.addObject=T.prototype.ea;T.prototype.Ia=function(a){if(!C(a,M))throw new D(this.Ia,0,a);!this.f&&un(this);this.j.kc().Ia(a);return a};T.prototype.removeObject=T.prototype.Ia;T.prototype.Va=function(a){!this.f&&un(this);return this.j.kc().Va(a)};T.prototype.getObjects=T.prototype.Va;
T.prototype.fc=function(a){var b;yc(a,this.fc,0,a);!this.f&&un(this);var c=a.length;for(b=0;b<c;b++)this.ea(a[b]);return this};T.prototype.addObjects=T.prototype.fc;T.prototype.Gd=function(a){var b;yc(a,this.Gd,0,a);!this.f&&un(this);var c=a.length;for(b=0;b<c;b++)this.Ia(a[b]);return this};T.prototype.removeObjects=T.prototype.Gd;T.prototype.de=function(a,b,c){var d;if(d=+E(a)||2*E(b))throw new D(this.de,d-1,arguments[d-1]);this.g.getObjectsAt(a,b,!0,function(e){c(e[0])})};
T.prototype.getObjectAt=T.prototype.de;T.prototype.Ga=function(a,b,c){var d;if(d=+E(a)||2*E(b))throw new D(this.de,d-1,arguments[d-1]);this.g.getObjectsAt(a,b,!1,c)};T.prototype.getObjectsAt=T.prototype.Ga;T.prototype.Bh=function(a,b,c){var d=c||gf;c=d.visiblesOnly;var e=d.zoom;d=d.types;var f=Pg.ANY;C(a,O,this.Bh,0,"area");wc(b,"Function",this.Bh,1,"callback");this.j.Va(a,tc(c)?!!c:!0,tc(e)?+e:this.b.vb(),tc(d)?d&f:f,b)};T.prototype.getObjectsWithin=T.prototype.Bh;
function un(a){a.j=new N({max:24});a.f=new ml(a.j,a.i);a.a.add(a.f)}var Vj={P2D:Al.P2D,WEBGL:Al.WEBGL};T.EngineType=Vj;Vj.HARP=Al.HARP;T.prototype.o={vp:"mapviewchangestart",kj:"mapviewchange",lj:"mapviewchangeend",Ff:"baselayerchange",Vl:"enginechange"};function yn(a,b){yn.l.constructor.call(this,a,b)}u(yn,Ni);t("H.map.Marker",yn);n=yn.prototype;n.type=Pg.MARKER;n.Og=1;n.wa=function(a){if(a!==Mg.VISUAL||1===this.bl||1===this.icon.getState())var b=yn.l.wa.call(this,a);return b||!1};n.bl=0;n.sk=function(a){return C(a,Ij)};n.Ph=!1;n.Qk=function(){this.wa(Mg.VISUAL)};
n.Pc=function(a){var b=this.icon;this.Ph&&(b.removeEventListener("statechange",this.Qk,!1,this),delete this.Ph);b&&(this.bl=b.getState());yn.l.Pc.call(this,a);0===a.getState()&&(this.Ph=!0,Ce(a,"statechange",this.Qk,!1,this));return this};yn.prototype.setIcon=yn.prototype.Pc;yn.prototype.f=function(a){return new Ij(a.svg,a)};yn.prototype.X=function(){var a=this.getIcon(),b=a.hp||0,c=yn.l.forWorkerMessage.call(this),d=c.properties.icon;d&&0<b&&Wa(d,{stick_color:a.gp,stick_height:b});return c};
yn.prototype.forWorkerMessage=yn.prototype.X;function zn(a,b){zn.l.constructor.call(this,jh,b);this.we(a)}u(zn,xi);t("H.map.Rect",zn);zn.prototype.we=function(a){if(!C(a,K))throw new D(this.we,0,a);a.oa(this.U)||(this.U=this.R=a,this.eb!==y&&zn.l.da.call(this,ni(a)))};zn.prototype.setBoundingBox=zn.prototype.we;zn.prototype.G=function(){return this.R};zn.prototype.getBoundingBox=zn.prototype.G;zn.prototype.da=function(){return this};zn.prototype.setGeometry=zn.prototype.da;
zn.prototype.ba=function(){this.eb||zn.l.da.call(this,ni(this.U));return this.eb};zn.prototype.getGeometry=zn.prototype.ba;function hk(a,b,c){var d="anonymous",e=1;this.f=A(this.f,this);M.call(this,c);this.da(a);c&&(a="crossOrigin",a in c&&(d=c[a]),a="opacity",a in c&&(e=c[a]));this.vl(b,d);this.qc(e)}u(hk,M);t("H.map.Overlay",hk);hk.prototype.type=Pg.OVERLAY;hk.prototype.G=function(){return this.R};hk.prototype.getBoundingBox=hk.prototype.G;hk.prototype.we=function(a){C(a,K,this.we,0,a);return this.da(a)};hk.prototype.setBoundingBox=hk.prototype.we;hk.prototype.ba=function(){return this.R};
hk.prototype.getGeometry=hk.prototype.ba;hk.prototype.da=function(a){var b=this.R,c=!b;C(a,K,this.da,0,a);if(c||!b.oa(a))this.R=a,c||this.wa(Mg.SPATIAL);return this};hk.prototype.setGeometry=hk.prototype.da;hk.prototype.ad=function(){return this.b.getData()};hk.prototype.getBitmap=hk.prototype.ad;hk.prototype.vl=function(a,b){var c=this.b;c&&1!==c.getState()&&c.cancel();this.b=new Dj(a,this.f,!0,B,b);return this};hk.prototype.setBitmap=hk.prototype.vl;
hk.prototype.f=function(a,b){this.b=b;1===a&&this.wa(Mg.VISUAL)};hk.prototype.dd=function(){return this.g};hk.prototype.getOpacity=hk.prototype.dd;hk.prototype.qc=function(a){var b=this.g,c=2>b;if(0<=a&&1>=a)a!==b&&(this.g=a,c&&this.wa(Mg.VISUAL));else throw new D(this.qc,0);return this};hk.prototype.setOpacity=hk.prototype.qc;hk.prototype.X=function(){var a=hk.l.X.call(this);a.geometry=ni(this.R).X();a.properties.overlay=!0;return a};hk.prototype.forWorkerMessage=hk.prototype.X;function An(a){if(!a||!Ca(a.requestData))throw new D(An,0,"options.requestData");An.l.constructor.call(this,a);this.N=a.requestData;this.J=!!a.providesDomMarkers}u(An,R);t("H.map.provider.MarkerTileProvider",An);An.prototype.Yd=function(a){return a?a.length+1:1};An.prototype.getEntryWeight=An.prototype.Yd;
An.prototype.K=function(a,b,c,d,e){var f=this;return this.N(a,b,c,function(g){for(var h=[],k,l,m=g.length;m--;)l=g[m],l.jp=f.getTileKey(a,b,c),l.ka(f),k=l.Cb(),(C(l,Qi)||1===k.getState())&&h.push(g[m]);d(h)},e)};An.prototype.requestInternal=An.prototype.K;An.prototype.ke=function(a,b){b===Mg.VISUAL&&(a=this.Ob().get(a.jp))&&(a.valid=!1,Wj(this,a))};An.prototype.invalidateObject=An.prototype.ke;An.prototype.Vb=function(){return this.J};An.prototype.providesDomMarkers=An.prototype.Vb;
An.prototype.Wb=df;An.prototype.providesMarkers=An.prototype.Wb;function Bn(a,b){Bn.l.constructor.call(this,a,b)}u(Bn,cl);t("H.map.layer.MarkerTileLayer",Bn);var Cn={markers:[],total:0,requested:0};function Dn(a,b,c,d,e){var f=yd(c);a.pixelProjection.Qa(f);b=a.je(a.Te(b),f);c=a.$e(b,b.left>b.right,~~c,d,e);a=c.tiles;c=c.total;d=a.length;e=[];var g;for(g=0;g<d;g++)for(b=a[g],f=b.data.length;f--;)e.push(b.data[f]);return{markers:e,total:a.length,requested:c}}Bn.prototype.Lc=function(a,b,c,d){return this.a.providesDomMarkers()?Cn:Dn(this,a,b,c,d)};
Bn.prototype.requestMarkers=Bn.prototype.Lc;Bn.prototype.Kc=function(a,b,c,d){return this.a.providesDomMarkers()?Dn(this,a,b,c,d):Cn};Bn.prototype.requestDomMarkers=Bn.prototype.Kc;function En(a,b,c){var d,e=6;if(b){for(d=' expected close to: "'+b;e--;)b=a.a.next(),-1!==b&&(d+=String.fromCharCode(b));d+='"'}throw new D(Fn,0,"- Malformed WKT: "+(d?c+d:"unexpected end of stream"));}var Gn={$l:" ",Xl:"(",Yl:")",Ul:",",Wl:""};Object.keys(Gn).reduce(function(a,b){a[Gn[b]]=!0;return a},mc());function Hn(a,b){var c=a.next();b=b?")":"(";c!==b&&En(a,c,'"'+b+'"')}function In(a){return","===Jn(a)?(a.next(),!0):!1}
function Kn(a,b,c,d,e){var f,g,h=2+b+c;for(g=1;g<=h;g++)(c=a.next())?(f=+c)!==f?En(a,c,"number"):1===g?d[e+1]=f:2===g?d[e]=f:3===g&&(d[e+2]=f):En(a,c);b||(d[e+2]=0)}var Ln=[];function Mn(a,b,c,d){d||Hn(a,0);Kn(a,b,c,Ln,0);d||Hn(a,1);return new Wf(Ln[0],Ln[1],b?Ln[2]:B)}function Nn(a,b,c){var d=[];Hn(a,0);do Kn(a,b,c,d,d.length);while(In(a));Hn(a,1);return new L(d)}function On(a,b,c){Hn(a,0);var d=Nn(a,b,c);if(In(a)){var e=[];do e.push(Nn(a,b,c));while(In(a))}Hn(a,1);return new O(d,e)}
var Pn=[],Qn=[On],Rn=[Mn],Sn={POINT:Rn,LINESTRING:[Nn],POLYGON:Qn,MULTIPOINT:[Mn,Ji],MULTILINESTRING:[Nn,mh],MULTIPOLYGON:[On,ui],GEOMETRY:Pn,GEOMETRYCOLLECTION:Pn,CIRCULARSTRING:Pn,COMPOUNDCURVE:Pn,CURVEPOLYGON:Pn,MULTICURVE:Pn,MULTISURFACE:Pn,CURVE:Pn,SURFACE:Pn,POLYHEDRALSURFACE:Pn,TIN:Pn,TRIANGLE:Pn},Tn={Z:1,M:2,ZM:3};
function Fn(a){a=new Un(a);var b;var c=a.next();(b=Sn[c.toUpperCase()])||En(a,c,"type name");if(b!==Pn){c=Jn(a);c=Tn[c.toUpperCase()];var d=c&1;var e=c>>1;d|e&&a.next();c=Jn(a);if("EMPTY"===c)if(a.next(),d=b[1])var f=new d([]);else b!==Rn&&(f=new L([]),b===Qn&&(f=new O(f)));else if("("===c){f=b[0];b=b[1];if(b){var g=[];Hn(a,0);if(f===Mn){var h="("!==Jn(a);do g.push(f(a,d,e,h));while(In(a))}else{do g.push(f(a,d,e));while(In(a))}Hn(a,1);d=new b(g)}else d=f(a,d,e);f=d}else En(a,c,'"Z", "M", "ZM", "(" or "EMPTY"');
a.next()&&En(a,c,"end of stream")}return f||y}function Un(a){this.a=a}function Jn(a){var b=a.b;if(b===B){for(b=a.a;b.Tb()===Vn;)b.next();if(Wn[b.Tb()])b=b.next(),b=b===Xn?"":String.fromCharCode(b);else{b.ze();do b.next();while(!Wn[b.Tb()]);b=String.fromCharCode.apply(null,b.Ud())}a.b=b}return b}Un.prototype.next=function(){var a=Jn(this);""!==a&&delete this.b;return a};var Vn=32,Xn=-1,Yn={$l:Vn,Xl:40,Yl:41,Ul:44,Wl:Xn},Wn=Object.keys(Yn).reduce(function(a,b){a[Yn[b]]=!0;return a},mc());function Zn(){}t("H.util.ICharStream",Zn);Zn.prototype.next=function(){};Zn.prototype.ze=function(){};Zn.prototype.Ud=function(){};Zn.prototype.Tb=function(){};function $n(a){this.c=String(a);this.f=0;this.a=[];this.b=!1}t("H.util.CharStream",$n);$n.prototype.next=function(){var a=this.c.charCodeAt(this.f++);a=isNaN(a)?-1:a;this.b&&this.a.push(a);return a};$n.prototype.ze=function(){this.b=!0;this.a=[]};$n.prototype.Ud=function(){var a=this.a.slice();this.b=!1;this.a=[];return a};$n.prototype.Tb=function(){var a=this.c.charCodeAt(this.f);return isNaN(a)?-1:a};t("H.util.wkt.toGeometry",function(a){return Fn(new $n(a))});t("H.buildInfo",function(){return Ef("H-core","1.30.6","757f3c65")});var ao=function(){var a="maps"+eval('"js-"');var b=x.document.querySelector('script[src*="'+a+'"]');if(!b){var c=x.document.getElementsByTagName("script");var d=new RegExp("^.*"+a);var e=0;for(a=c.length;e<a;e++)if(d.test(c[e].src)){b=c[e];break}}return b?b.src.replace(/\/[^\/]*$/,"/"):""}();t("H.getScriptPath",function(){return ao});

function bo(a,b){if(!a)throw new D(bo,0,a);bo.l.constructor.call(this,a);this.b={};this.c=b&&b.xc;this.f=co++}u(bo,km);var co=0;
bo.prototype.V=function(a,b,c,d,e,f){var g=xd(d),h=this.hb,k=g+(c.exp-h.pixelProjection.exp),l=h.min,m=h.max;d=h.tileSize;var p=h.ga().j,q=this.xb,r=q.dd();var v=q.Db().w;var w=c.w,z=c.x,J=c.y,G={};if(g<l||g>m)return jk.DONE;e=h.requestTiles(a,k,e,f,this.f);a=e.total;e=e.tiles;f=e.length;this.g=c;this.j=b;this.a=k;r!==p&&q.qc(p);c=d=d*w/(Dd(2,k)*d);this.c||(d%1&&(d=yd(d),w=c/d,z/=w,J/=w,w=Dd(2,k)*d),z=yd(z),J=yd(J));this.i=c;k=-d;g=v+d;for(h=0;h<f;h++){v=e[h];if((l=v.data)&&l.tagName){c=b.x-(z-v.x*
d);p=b.y-(J-v.y*d);q.Zc(l,c,p,d,d);for(r=c;(r-=w)>k;)q.Zc(l,r,p,d,d);for(r=c;(r+=w)<g;)q.Zc(l,r,p,d,d)}G[this.a+"_"+v.x+"_"+v.y]=v}this.b=G;return f===a?jk.DONE:jk.PENDING};bo.prototype.Ga=function(a,b,c){var d=this.i,e=d/this.hb.tileSize,f=this.g,g=this.j,h;if(tc(this.a)&&f){a=f.x+(a-g.x);b=f.y+(b-g.y);var k=yd(f.w/d);var l=f=yd(a/d);g=yd(b/d);Ad(l)>=k&&(l%=k);0>l&&(l=k+l);(k=this.b[this.a+"_"+l+"_"+g])&&k.Ga&&(h=k.Ga((a-d*f)/e,(b-d*g)/e,c))}return h||ff};bo.prototype.ie=function(){return"2d"};function eo(a,b){b=b||{};C(a,ml,eo,0);eo.l.constructor.call(this,a);this.xc=!!b.xc;this.c=b.ib||0;this.a=[];this.b={}}u(eo,km);
eo.prototype.V=function(a,b,c,d,e,f){var g,h=this.hb,k;d-=this.c;this.a.length=0;var l=this.b;this.b=g={};if(d>=h.min&&d<=h.max){var m=h.Hd(a,d,e,f);var p=m.overlays;if(a=p.length)for(p.sort(Rg),d=this.xb,e=this.xc,f=0;f<a;f++){h=p[f];var q=h.G();var r=c.lb(q.Rb());var v=c.lb(q.Nb());q=c.w;r.x>=v.x&&(r.x-=q);q=-((r.x+v.x)/q>>1)*q;r.x+=q;r.add(b);v.x+=q;v.add(b);e||(r.round(),v.round());(q=l[k=h.gb()])?delete l[k]:q={Oo:h};g[k]=q;var w=r.x;r=r.y;var z=v.x;v=v.y;var J=z-w;var G=v-r;d.qc(h.dd());d.Zc(h.ad(),
w,r,J,G);q.mh?q.mh.set(w,r,z,v):q.mh=new lk(w,r,z,v);this.a.push(q)}}return!m||m.requested&&m.requested===m.total||!m.requested&&p.length===m.total?jk.DONE:jk.PENDING};eo.prototype.Ga=function(a,b,c){for(var d=this.a,e=d.length,f,g,h;e--;)if(f=d[e],g=f.mh,g.Pf(a,b))if(f=f.Oo,h)h.push(f);else if(h=[f],c)break;return h||ff};eo.prototype.ie=function(){return"2d"};eo.prototype.u=function(){this.a=null;eo.l.u.call(this)};var fo={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:0},incline:{min:0,max:0},heading:{min:180,max:180}},interaction:{ZOOM:ul.ZOOM,COORD:ul.COORD},capture:!0};t("H.map.render.p2d.capabilities",fo);function go(a,b){this.a=[];go.l.constructor.apply(this,arguments)}u(go,om);n=go.prototype;n.Nj=function(){return this.hb.Lc.apply(this.hb,arguments)};n.V=function(a,b,c,d,e,f,g){this.a=[];return go.l.V.apply(this,arguments)};n.Ck=1;n.jl=function(a,b,c,d,e,f){var g=this.Ck=d.$a();e*=g;f*=g;var h=c.Db();b=h.w*g;h=h.h*g;var k=c.ud();this.xc?(e-=k.x*g,f-=k.y*g):(e=xd(e-k.x*g),f=xd(f-k.y*g));d.Zc(c.ad(),e,f,b,h);a.detail?a.detail.set(e,f,e+b,f+h):a.detail=new lk(e,f,e+b,f+h);this.a.push(a)};
n.Ga=function(a,b,c){for(var d=this.a,e=d.length,f,g,h,k=ff,l=this.Ck;e--&&!(f=d[e],g=f.detail,g.Pf(a,b)&&(f=f.Mk,(!(h=f.Cb().g)||h.hg((a-g.left)/l,(b-g.top)/l,0))&&0>k.indexOf(f)&&(k===ff&&(k=[]),k.push(f),c))););return k};n.ie=function(){return"2d"};n.u=function(){this.a=null;go.l.u.call(this)};function V(a,b,c,d){V.l.constructor.call(this,a,b,c,d);this.N=new I(0,0);if(c=d.renderBaseBackground)this.to=c.lower,this.no=c.higher;this.mo=!!d.enableSubpixelRendering;this.od=ho;this.Oj=0;this.Ne=this.Mj=!1;this.i=new Wl;this.a=d=new dm;this.Pd=A(this.Pd,this);d.addEventListener(d.g.Rg,this.Pd);this.Fa=A(this.Fa,this);d=a.element;this.Aa=a=d.ownerDocument.createElement("div");a.style.position="absolute";a.style.width=a.style.height="100%";a.style.zIndex=0;d.insertBefore(a,d.firstChild);this.ik=
new Am(this.Aa,this.sa);this.o=[];io(this);this.bi=A(V.prototype.bi,this);this.A=jo;this.Cg();this.zoom=ko(this,this.O.vb()+this.ib);this.Jb();lo(this,b.mb().position,this.zoom);this.bb();this.U()}u(V,ql);t("H.map.render.p2d.RenderEngine",V);V.prototype.type=Al.P2D;V.prototype.type=V.prototype.type;var jo=2;V.prototype.getState=function(){return this.A};V.prototype.getState=V.prototype.getState;function mo(a,b,c){b=c-b;return Ad(b)<a.ra.w/2?b:b-a.ra.w*c/Ad(c)}
V.prototype.bh=function(a){var b=this,c=a.b,d=a.newValue,e=a.modifiers;a=d.position;var f=d.bounds,g,h=this.zoom,k=this.m,l=0;e&Si.POSITION&&(g=b.ra.lb(a));if(e&Si.BOUNDS)d=no(this,f.G(),e&Si.ZOOM?d.zoom:B,e&Si.POSITION?a:B),this.O.$b(d,c);else{e&Si.POSITION||(g=b.ra.lb(d.position));var m=g.x;var p=g.y;oo(this);this.N.set(0,0);d=po(this,d);var q=d.zoom;var r=d.position;if(c){var v=q-h;var w={x:k.x,y:k.y};c=this.ra.qe(w).x;var z=this.ra.projection.$c(a);if(z.x!==this.m.x||z.y!==this.m.y||q!==this.zoom)m=
mo(this,c,m),qo(this,function(J){var G=J-l;if(q!==h){g=b.ra.qe(z);var U=b.ra.qe(w);m=mo(b,U.x,g.x);p=g.y-U.y}l=J;ro(b,m*G,p*G);h+=v*G;so(b,h);b.bb();b.ha()},this.kb,function(){lo(b,r,q);so(b,q);b.bb(r);b.ha()},this.dc)}else to(this),lo(this,r,q),so(this,q),this.bb(r);this.ha()}};V.prototype.kb=300;V.prototype.Fg=function(a){var b=Cc(a);if(!b||b&&0>a)throw new D(this.Fg,1,"positive number required");this.kb=a};V.prototype.setAnimationDuration=V.prototype.Fg;V.prototype.sh=function(){return this.kb};
V.prototype.getAnimationDuration=V.prototype.sh;V.prototype.dc=Nl;V.prototype.Gg=function(a){if(!Ca(a))throw new D(this.Gg,1,"function required");this.dc=a};V.prototype.setAnimationEase=V.prototype.Gg;V.prototype.th=function(){return this.dc};V.prototype.getAnimationEase=V.prototype.th;V.prototype.Cg=function(){this.dc=Nl;this.kb=300};V.prototype.resetAnimationDefaults=V.prototype.Cg;
V.prototype.oi=function(a,b,c){var d;this.Xa=zk();(d=this.fa.ja.splice(a,1)[0])&&d.B&&d.B();(d=this.s.ja.splice(a,1)[0])&&d.B&&d.B();(d=this.W.ja.splice(a,1)[0])&&d.B&&d.B();(d=this.ma.ja.splice(a,1)[0])&&d.B&&d.B();this.f=this.c.Na();0===a&&(vl(this,b,!1),this.Jb());this.o=Bm(this.ik,uo(this),vo(this));this.te();c||this.ha()};function io(a){var b=a.c.Na(),c=0,d=b.length;[a.fa={},a.s={},a.W={},a.ma={}].forEach(function(e){e.Yc=[];e.ja=[]});for(a.f=a.c.Na();c<d;c++)a.jf(c,b[c]);a.Jb()}
V.prototype.pi=function(){this.Jb();this.ha()};V.prototype.Mh=function(a,b,c){var d,e,f,g;if(b){var h={xc:this.mo,ib:this.ib};b.V?C(b,mm)?e=new lm(b):C(b,ym)&&(g=new lm(b)):(b.requestOverlays&&(d=new eo(b,h)),b.requestTiles&&(e=new bo(b,h)),b.requestMarkers&&(f=new go(b,h)),b.requestDomMarkers&&(g=new rm(b,h)))}c=c||0;this.fa.ja.splice(a,c,d);this.s.ja.splice(a,c,e);this.W.ja.splice(a,c,f);this.ma.ja.splice(a,c,g);this.f=this.c.Na();this.o=Bm(this.ik,uo(this),vo(this))};
function vo(a){var b=[];b=b.concat(a.s.ja);b=b.concat(a.fa.ja);b=b.concat(a.W.ja);b=b.concat(a.ma.ja);return b=b.filter(tc)}function po(a,b){var c=wl(a,wl(a,b.zoom)+a.ib);a=xl(a,b);a.zoom=c;return a}function lo(a,b,c){var d=a.ra;d.Qa(c);a.m=d.projection.$c(b);d.x=d.w*a.m.x;d.y=d.h*a.m.y}V.prototype.Wa=function(a,b){var c=this.g.center,d=this.sa;return this.ra.Sa((a-c.x)*d,(b-c.y)*d)};V.prototype.screenToGeo=V.prototype.Wa;V.prototype.Eg=function(a,b){a=this.Wa(a,b);b=this.O.mb();b.position=a;return b};
V.prototype.Fa=function(a){var b=this.sa,c=this.g.center,d=c.x*b;c=c.y*b;a=this.ra.lb(a);var e=this.ra.w;return new I(xd((a.x-xd(a.x/e)*e+d)/b),xd((a.y+c)/b))};V.prototype.geoToScreen=V.prototype.Fa;V.prototype.G=function(a,b){var c=this.yb[a||4];a=this.ra;var d=c.left-b,e=a.Sa(d,c.top-b),f=c.right+b;b=a.Sa(f,c.bottom+b);f-d>=a.w&&(e.lng=-(b.lng=180));return dg(e,b)};
V.prototype.Ga=function(a,b,c,d){var e=[],f=this.sa,g;a*=f;b*=f;f=[this.fa,this.s,this.W,this.ma];for(g=f.length;g--&&(!c||!e.length);){for(var h=e,k=f[g].ja,l=a,m=b,p=c,q=k.length;q--&&!((e=k[q])&&e.Ga&&(h=h.concat(e.Ga(l,m,p)),h.length&&p)););e=h}d(e)};V.prototype.getObjectsAt=V.prototype.Ga;V.prototype.ec=y;function uo(a){a=a.yb[2];return{w:a.right-a.left,h:a.bottom-a.top}}
V.prototype.U=function(){var a=this.o.length,b;V.l.U.call(this);var c=uo(this);this.N.set(0,0);var d=c.w;for(b=c.h;a--;){c=this.o[a];var e=c.Db();e.w===d&&e.h===b||c.yf(d,b)}this.ec=new Ki(d,b);this.ha()};V.prototype.getCapabilities=function(){return fo};V.prototype.getCapabilities=V.prototype.getCapabilities;function wo(a){a.b&&a.b.va()||zk()-a.Xa<a.od&&!a.v?a.Vd=Jk(a.bi):(a.v&&(a.te(),xo(a)),a.A=jo)}n=V.prototype;
n.te=function(){this.fa.Yc.length=0;this.s.Yc.length=0;this.W.Yc.length=0;this.ma.Yc.length=0};
n.bi=function(){var a;this.C&&this.C.before();var b=this.s.ja;var c=this.g.center.clone().scale(this.sa).round();var d=this.G(1,0);var e=this.G(1,yo);var f=this.zoom;var g=f-this.ib;var h=this.ra;var k=this.to;var l=this.no;var m=b[0];b=this.N;var p=this.o.length;var q=this.f;for(a=q.length;p--;){var r=this.o[p];C(r,jm)&&r.clear()}if(m){if(k)for(;k;)p=f-k,m.V(d,c,h,p,!0,b),--k;if(l&&this.Ne)for(r=1;r<=l&&(p=f+r,h.Qa(p),k=this.G(2,0),h.Qa(f),!m.V(k,c,h,p,!0,b));r++);}for(this.od=ho;a--;)h=q[a],C(h,
aj)&&h.ga()&&h.ga().nf(e,g);d=this.Bk(d,c,f,!1,b,zo,this.s,this.fa);c=this.Bk(e,c,g,!1,b,Ao,this.W,this.ma);this.v=d&&c;this.b&&this.b.va()&&this.Sg();this.J||(this.J=this.O.mb());this.J.bounds=this.G(4,0);this.O.bb(this.J);this.J=null;this.ec&&(this.g.bb(this.ec),this.ec=y);f<this.Oj?this.Ne=!0:this.Mj&&(this.Ne=!1);this.Oj=f;this.Mj=d;this.C&&this.C.after();wo(this)};
n.Bk=function(a,b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments,6),k=h.length,l=h[0].ja.length,m=k*l,p=!!m,q;for(q=0;q<m;q++){if(f===zo){var r=q%k;var v=Math.floor(q/k)}else r=Math.floor(q/l),v=q%l;var w=h[r].ja[v];r=h[r].Yc;w&&(w=w.V(a,b,this.ra,c,d,e,this.Fa),w===jk.ACTIVE&&(this.od=Infinity),w!==jk.DONE||r[v]||(xo(this,this.f[v]),r[v]=!0),r[v]||(p=!1))}return p};function xo(a,b){a.dispatchEvent({type:a.zk.pj,target:b||a})}
n.u=function(){var a=this.c.Na()[0],b=this.g;Kk(this.Vd);to(this,!0);a&&vl(this,a,!1);vo(this).forEach(function(c){c.B()});b.element&&b.element.removeChild(this.Aa);this.Aa=null;this.A=3;V.l.u.call(this)};n.ha=function(){this.Xa=zk();this.A===jo&&(this.v=!1,this.A=1,wo(this))};function Bo(a,b,c){ro(a,b*a.sa,c*a.sa);a.N.set(0,0);a.bb();a.ha()}function ro(a,b,c){var d=a.ra;a=a.m;d.x=Wd(d.x+b,d.w);d.y=wd(0,vd(d.w,d.y+c));a.x=d.x/d.w;a.y=d.y/d.h}
n.Ae=function(a,b,c){a=wl(this,wl(this,a)+this.ib);so(this,a,b,c)};V.prototype.zoomAt=V.prototype.Ae;function so(a,b,c,d){var e=a.sa,f=a.g.center;c===+c&&d===+d?(c=(c-f.x)*e,d=(d-f.y)*e,a.N.set(c,d),ro(a,c,d),a.ra.Qa(b),ro(a,-c,-d)):(a.N.set(0,0),a.ra.Qa(b));a.zoom=b;a.bb();a.ha()}
function no(a,b,c,d){var e=a.getCapabilities().lookAt.zoom.max,f=b.fb(),g=d||f;if(b.jg()||c&&d)c=c===B?e:c;else{var h=new Yi(a.ra.projection);h.Qa(e);var k=h.lb(b.Rb()).round();var l=h.lb(b.Nb()).round();e=h.w;b.Gb()&&(k.x-=e);d?(f=h.lb(g),b=2*wd(f.x-k.x,l.x-f.x),k=2*wd(f.y-k.y,l.y-f.y)):(b=l.x-k.x,k=l.y-k.y,g=f);c===B&&(f=a.yb[4],c=f.right-f.left,f=f.bottom-f.top,c=-8+vd(Bd(c/b*e)/Ld,Bd(f/k*e)/Ld)-a.ib,c=wl(a,c))}return{zoom:yd(c),position:g}}
function oo(a){to(a,!0);a.a.va()&&a.Ab(!0);a.i.va()&&a.Bb(!0);to(a,!0)}V.prototype.uc=function(a,b){oo(this);Co(this,b);this.i.start(a,!!b)};V.prototype.startInteraction=V.prototype.uc;function Co(a,b){if(b){var c={};c.mf=b.power;c.Oe=b.ease;c.duration=b.duration;a.j=c}}function ko(a,b){return wl(a,wl(a,b-a.ib)+a.ib)}
V.prototype.lc=function(a,b,c,d,e){var f=!1;this.i.va()&&(b=this.i.store(a,b,c,d,e),this.i.Hc(ul.COORD)&&(a=this.i.ce(),0<Vl(a)&&(Bo(this,-a.x,-a.y),f=!0)),b&&this.i.Hc(ul.ZOOM)&&(a=this.i.Wf(),b=this.i.Xf(),b=Bd(Dd(2,this.zoom)*b)/Ld,b!==this.zoom&&(b=ko(this,b),so(this,b,a.x,a.y),f=!0)),f&&this.ha())};V.prototype.interaction=V.prototype.lc;
V.prototype.Bb=function(a){var b=this;if(this.i.va()&&!a){if(this.j){a=this.i.Eb();var c=this.i.zc();var d=this.j.duration;var e=(this.j.mf||1)*a;var f=new zm(-e/(0<d?d:1),e);!E(c.x)&&!E(c.y)&&0<e&&b.i.Hc(ul.COORD)&&qo(this,function(g){e=f.We(g*d);E(e)||Bo(b,xd(-c.x*e),xd(-c.y*e))},d,void 0,this.j.Oe)}this.j=null;this.i.clear()}};V.prototype.endInteraction=V.prototype.Bb;V.prototype.tc=function(a,b,c){oo(this);this.a.start(b,c);Co(this,a)};V.prototype.startControl=V.prototype.tc;
V.prototype.control=function(a,b,c){if(E(+c))throw new D(this.control,2,c);if(E(a))throw new D(this.control,0,a);if(E(b))throw new D(this.control,1,b);this.a.va()&&this.a.set(a,b,c,0,0,0)};V.prototype.control=V.prototype.control;
V.prototype.Ab=function(a,b){var c=this,d;if(this.a.va()){to(this,!0);var e=zk();var f=e-this.za;if(1<=f){var g=gm(this.a);Do(this,g,f)}if(!this.j||a||b)"function"===typeof b&&(a=this.mb(),a.zoom=this.zoom-this.ib,b(a),a.zoom+=this.ib,Eo(this,a));else{b=this.a.Eb();var h=this.a.zc();var k=this.j.duration;var l=(this.j.mf||1)*b;var m=new zm(-l/(0<k?k:1),l);!E(h.nb)&&!E(h.ob)&&0<l&&qo(this,function(p,q,r,v){e&&(r=v-e,e=0);l=m.We(p*k)*r;E(l)||((d=h.pb*l)&&so(c,ko(c,c.zoom+d),c.a.b,c.a.c),Bo(c,xd(h.nb*
l),xd(h.ob*l)))},k,void 0,this.j.Oe)}this.a.reset()}};V.prototype.endControl=V.prototype.Ab;
function Eo(a,b){var c=a.m,d=a.ra.projection.$c(b.position),e=a.ra.qe(d),f=e.y;e=e.x;var g=b.zoom;c=a.ra.qe(c);b=c.y;var h=c.x;c=a.zoom;var k=a.a.Eb(),l=a.a.b,m=a.a.c,p=0;e=mo(a,h,e);e-=h;f-=b;c=g-c;b=Cd(e*e+f*f+c*c);if(0!==k&&0!==b){var q=e/b;var r=f/b;var v=c/b;var w=k*k/(2*b);qo(a,function(z,J){var G;if(1!==z){z=k*J-w*J*J/2;J=z-p;if(G=v*J)G=ko(a,a.zoom+G),so(a,ko(a,G),l,m);Bo(a,xd(q*J),xd(r*J));p=z}else a.m=d,so(a,ko(a,g),l,m),a.bb(),a.ha()},2*b/k)}}
V.prototype.Pd=function(a){var b=this,c=a.c;this.N.set(0,0);c.nb||c.ob||c.pb?(this.za=zk(),qo(this,function(d,e,f,g){b.za=g;Do(b,c,f)},Number.POSITIVE_INFINITY),this.ha()):to(this,!0)};function Do(a,b,c){c=c||0;b.pb&&so(a,ko(a,a.zoom+b.pb*c),a.a.atX,a.a.atY);Bo(a,b.nb*c,b.ob*c)}function qo(a,b,c,d,e){a.b&&a.b.va()&&a.b.stop(!0);a.b=new nm(a,b,c,d,e);a.b.start()}function to(a,b){a.b&&a.b.va()&&a.b.stop(b)}V.prototype.nh=function(){};V.prototype.enter=V.prototype.nh;
V.prototype.Vf=function(a){tl(this.Aa,a)};V.prototype.exit=V.prototype.Vf;V.prototype.capture=function(a,b,c,d){var e=this.Aa.ownerDocument.createElement("canvas"),f=e.getContext("2d"),g=this.sa;e.width=(c-a)*g;e.height=(d-b)*g;for(c=0;c<this.o.length;c++)d=this.o[c],C(d,jm)&&f.drawImage(d.L(),-a*g,-b*g);return Wb(e)};var Ao=0,zo=1,ho=1E3,yo=256;

function Fo(a){var b=a.ownerDocument;b=b.documentElement||b.body.parentNode||b.body;try{var c=a.getBoundingClientRect()}catch(d){c={top:0,right:0,bottom:0,left:0,height:0,width:0}}return{x:c.left+("number"===typeof window.pageXOffset?window.pageXOffset:b.scrollLeft),y:c.top+("number"===typeof window.pageYOffset?window.pageYOffset:b.scrollTop)}}var Go=Function("return this")();function Ho(a,b,c,d,e,f,g){Ho.l.constructor.call(this,a);this.pointers=b;this.changedPointers=c;this.targetPointers=d;this.currentPointer=e;this.originalEvent=g;this.target=f}u(Ho,rd);t("H.mapevents.Event",Ho);function Io(a,b,c,d,e,f){if(isNaN(a))throw Error("x needs to be a number");if(isNaN(b))throw Error("y needs to be a number");if(isNaN(c))throw Error("pointer must have an id");this.viewportX=a;this.viewportY=b;this.target=null;this.id=c;this.type=d;this.dragTarget=null;this.button=tc(e)?e:-1;this.buttons=tc(f)?f:0;this.a=this.button}t("H.mapevents.Pointer",Io);
function Jo(a,b,c){if(isNaN(b))throw Error("x needs to be a number");if(isNaN(c))throw Error("y needs to be a number");a.viewportX=b;a.viewportY=c}Io.prototype.gn=function(){return this.a};Io.prototype.getLastChangedButton=Io.prototype.gn;function Ko(a,b){a.a=b;a.buttons|=Io.prototype.b[+b]||0}function Lo(a,b){a.a=b;a.buttons&=~(Io.prototype.b[+b]||0)}Io.prototype.b=[1,4,2];var Mo={NONE:-1,LEFT:0,MIDDLE:1,RIGHT:2};Io.Button=Mo;function No(a){this.a=a instanceof Array?a.slice(0):[]}n=No.prototype;n.clear=function(){this.a.splice(0,this.a.length)};n.length=function(){return this.a.length};n.indexOf=function(a){for(var b=this.a.length;b--;)if(this.a[b].id===a)return b;return-1};function Oo(a,b){b=a.indexOf(b);return-1!==b?a.a[b]:null}n.remove=function(a){a=this.indexOf(a);return-1!==a?this.a.splice(a,1)[0]:null};function Po(a,b){for(var c=a.a.length,d=[];c--;)a.a[c].type!==b&&d.push(a.a[c]);a.a=d}
function Qo(a,b){for(var c=a.a.length;c--;)if(a.a[c].dragTarget===b)return!0;return!1}n.push=function(a){if(a instanceof Io)return this.a.push(a);throw Error("list needs a pointer");};n.Na=function(){return this.a};n.clone=function(){return new No(this.a)};function Ro(a,b,c){c=c||{};if(!(a instanceof T))throw Error("events: map instance required");if(!(b instanceof Array))throw Error("events: map array required");nd.call(this);this.kh=c.kh||300;this.Bj=c.Bj||50;this.Il=c.Il||50;this.Jl=c.Jl||500;this.Vh=c.Vh||900;this.Uh=c.Uh||8;this.map=a;this.o=this.map.ya;this.j=this.o.element;this.O=b;this.a=new No;this.b=new No;this.i={};this.c=null;this.s=!0;this.aa={};this.f={};this.m=null;this.Le=A(this.Le,this);this.C={pointerdown:this.qm,pointermove:this.rm,
pointerup:this.sm,pointercancel:this.pm};So(this)}u(Ro,nd);function So(a,b){var c,d=a.O.length;for(c=0;c<d;c++){var e=a.O[c];var f=e.listener;"function"===typeof f&&(b?(e.target||a.j).removeEventListener(e.Ta,f):(e.target||a.j).addEventListener(e.Ta,f))}}function To(a,b,c){var d;if("function"===typeof a.C[b]){"pointermove"!==b&&(a.s=!0);var e=0;for(d=a.b.length();e<d;e++){var f=a.b.a[e];a.j.contains(c.composedPath()[0])?Uo(a,f,a.Ij.bind(a,c,b,f)):a.Ij(c,b,f,null)}}a.b.clear()}n=Ro.prototype;
n.Ij=function(a,b,c,d){Vo(c.id,this.aa);this.C[b].call(this,c,d,a)};function Uo(a,b,c){if(a.c===b)c(b.target);else{var d=a.o;var e=b.viewportX;b=b.viewportY;if(0>e||0>b||e>=d.width||b>=d.height)c(y);else{var f=a.map;f.de(e,b,function(g){c(g||f)})}}}
n.sm=function(a,b,c){var d=a.id;a.target=b;Wo(this,a,c);Xo(this,b,"pointerup",c,a);"mouse"!==a.type&&Xo(this,b,"pointerleave",c,a);b=this.i[a.id];var e={x:a.viewportX,y:a.viewportY},f=c.timeStamp,g=a.target,h=this.m;b&&b.target===g&&b.He.Za(e)<this.Il&&f-b.Yi<this.Jl?(Xo(this,g,"tap",c,a),h&&h.target===g&&f-h.Yi<this.kh?h.He.Za({x:a.viewportX,y:a.viewportY})<this.Bj&&(Xo(this,g,"dbltap",c,a),this.m=null):this.m={target:g,He:new I(a.viewportX,a.viewportY),Yi:c.timeStamp}):this.m=null;this.i={};Vo(d,
this.f)};function Wo(a,b,c){b===a.c&&(Xo(a,b.dragTarget,"dragend",c,b),a.c=null,Vo(b.id,a.aa));b.dragTarget=null}n.Le=function(a,b){var c=this;Xo(this,a.dragTarget,"drag",b,a);Vo(a.id,this.aa);this.aa[a.id]=setTimeout(function(){c.Le(a,b)},150)};function Vo(a,b){b[a]&&(b[a].timeout?clearTimeout(b[a].timeout):clearTimeout(b[a]),delete b[a])}
function Yo(a,b,c){var d=b.target,e=new I(b.viewportX,b.viewportY),f=b.id;Vo(f,a.f);var g=setTimeout(function(){d&&d===b.target&&e.Za({x:b.viewportX,y:b.viewportY})<a.Uh&&(Xo(a,d,"longpress",c,b),delete a.i[b.id])},a.Vh);a.f[f]={timeout:g,He:e}}
n.rm=function(a,b,c){var d=a.dragTarget,e=a.id;var f=a.target;a.target=b;f!==b&&(Xo(this,f,"pointerleave",c,a),Xo(this,b,"pointerenter",c,a));d?this.c?(this.Le(a,c),this.f[e]&&this.f[e].He.Za({x:a.viewportX,y:a.viewportY})>this.Uh&&Vo(e,this.f)):this.s?this.s=!1:(this.c=a,Xo(this,d,"dragstart",c,a),this.Le(a,c),delete this.i[e],this.s=!0):(!this.c||this.c&&this.c.dragTarget!==b&&this.c.dragTarget!==this.map)&&Xo(this,b,"pointermove",c,a)};
n.qm=function(a,b,c){var d=!(/^(?:mouse|pen)$/.test(a.type)&&0!==c.button);if(b){a.target=b;this.i[a.id]={He:new I(a.viewportX,a.viewportY),target:a.target,Yi:c.timeStamp};"mouse"!==a.type&&Xo(this,b,"pointerenter",c,a);var e=Xo(this,b,"pointerdown",c,a);!this.c&&d&&(b.draggable&&!Qo(this.a,b)?a.dragTarget=b:!this.map.draggable||e.defaultPrevented||Qo(this.a,this.map)||(a.dragTarget=this.map));Yo(this,a,c)}};
n.pm=function(a,b,c){var d=a.id;a.target=null;b?(Xo(this,b,"pointerleave",c,a),Xo(this,b,"pointercancel",c,a)):Xo(this,this.map,"pointercancel",c,a);Wo(this,a,c);this.i={};Vo(d,this.f)};function Xo(a,b,c,d,e){if(b&&"function"===typeof b.dispatchEvent){var f=Ho;var g=a.a.Na(),h=a.b.Na();a=a.a;var k,l=a.a.length,m=[];for(k=0;k<l;k++)a.a[k].target===b&&m.push(a.a[k]);f=new f(c,g,h,m,e,b,d);e.button=/^(?:longpress|(?:dbl)?tap|pointer(?:down|up))$/.test(c)?e.a:Mo.NONE;b.dispatchEvent(f)}return f}
n.u=function(){So(this,!0);this.a.clear();this.b.clear();var a=this.aa,b;for(b in a)Vo(b,a);a=this.f;for(var c in a)Vo(c,a);this.c=this.i=this.m=this.map=this.b=this.a=this.O=this.S=null;nd.prototype.u.call(this)};function Zo(a){this.g=A(this.g,this);Ro.call(this,a,[{Ta:"touchstart",listener:this.g},{Ta:"touchmove",listener:this.g},{Ta:"touchend",listener:this.g},{Ta:"touchcancel",listener:this.g}]);this.J={touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",touchcancel:"pointercancel"};this.v=(a=(a=a.m)?a.L():null)?Array.prototype.slice.call(a.querySelectorAll("a"),0):[]}u(Zo,Ro);
Zo.prototype.g=function(a){var b=a.touches,c=this.a.length(),d;if("touchstart"===a.type&&c>=b.length){c=this.a.clone();for(d=b.length;d--;)c.remove(b[d].identifier);for(d=c.length();d--;)this.a.remove(c.a[d].id);this.b=c;To(this,"pointercancel",a);this.b.clear()}if(this.J[a.type]){b=Fo(this.o.element);c=a.type;d=a.changedTouches;var e=d.length,f;this.b.clear();for(f=0;f<e;f++){var g=d[f];var h=Oo(this.a,g.identifier);var k=g.pageX-b.x;var l=g.pageY-b.y;if(h)if("touchmove"===c){g=Math.abs(h.viewportX-
k);var m=Math.abs(h.viewportY-l);if(1<g||1<m||1===g&&1===m)Jo(h,k,l),this.b.push(h)}else"touchend"===c&&(this.a.remove(h.id),this.b.push(h),Lo(h,Mo.LEFT));else h=new Io(k,l,g.identifier,"touch",Mo.LEFT,1),this.a.push(h),this.b.push(h)}To(this,this.J[a.type],a);-1===this.v.indexOf(a.target)&&a.preventDefault()}};Zo.prototype.u=function(){this.v=null;Ro.prototype.u.call(this)};function $o(a){var b=ap(this);(window.PointerEvent||window.MSPointerEvent)&&b.push({Ta:"MSHoldVisual",listener:"prevent"});Ro.call(this,a,b)}u($o,Ro);function ap(a){var b=!!window.PointerEvent,c,d,e=[];a.g=A(a.g,a);"MSPointerDown MSPointerMove MSPointerUp MSPointerCancel MSPointerOut MSPointerOver".split(" ").forEach(function(f){c=f.toLowerCase().replace(/ms/g,"");d=b?c:f;e.push({Ta:d,listener:a.g,target:/^pointer(up|move)$/.test(c)?window:null})});return e}var bp={2:"touch",3:"pen",4:"mouse"};
$o.prototype.g=function(a){var b=window.PointerEvent?a.type:a.type.toLowerCase().replace(/ms/g,""),c=Fo(this.j),d=Oo(this.a,a.pointerId),e=a.pageX-c.x;c=a.pageY-c.y;var f=bp[a.pointerType]||a.pointerType;Zc&&"rtl"===x.getComputedStyle(this.o.element).direction&&(e-=(x.devicePixelRatio-1)*this.o.width);if(!(d||/^pointer(up|out|cancel)$/.test(b)||"touch"===f&&"pointerdown"!==b)){d={x:e,y:c};var g=a.pointerType;"number"===typeof g&&(g=bp[g]);d=new Io(d.x,d.y,a.pointerId,g,a.button,a.buttons);this.a.push(d)}if(d)if(/^pointer(up|cancel)$/.test(b)?
("touch"===f&&this.a.remove(d.id),Lo(d,a.button)):"pointerdown"===b&&("touch"===a.pointerType&&(Po(this.a,"mouse"),Po(this.a,"pen")),Ko(d,a.button)),this.b.push(d),"pointermove"!==b)Jo(d,e,c),To(this,/^pointer(over|out)$/.test(b)?"pointermove":b,a);else if(d.viewportX!==e||d.viewportY!==c)Jo(d,e,c),To(this,b,a);this.b.clear()};function cp(a,b,c,d){cp.l.constructor.call(this,"contextmenu");this.items=[];this.viewportX=a;this.viewportY=b;this.target=c;this.originalEvent=d}u(cp,rd);t("H.mapevents.ContextMenuEvent",cp);function dp(a){this.Hh=A(this.Hh,this);this.Jh=A(this.Jh,this);this.Ih=A(this.Ih,this);this.v=!1;this.g=-1;this.J=0;dp.l.constructor.call(this,a,[{Ta:"contextmenu",listener:this.Hh},{target:a,Ta:"longpress",listener:this.Jh},{target:a,Ta:"dbltap",listener:this.Ih}])}u(dp,Ro);n=dp.prototype;n.Jh=function(a){var b=a.currentPointer;"touch"===b.type&&1===a.pointers.length&&ep(this,b.viewportX,b.viewportY,a.originalEvent,a.target)};n.Ih=function(a){"touch"===a.currentPointer.type&&(this.J=Date.now())};
n.Hh=function(a){var b=this;-1===this.g?this.g=setTimeout(function(){var c=Fo(b.j),d=a.pageX-c.x;c=a.pageY-c.y;b.g=-1;ep(b,d,c,a)},this.kh):(clearInterval(this.g),this.g=-1);a.preventDefault()};function ep(a,b,c,d,e){var f=a.map,g=Date.now()-a.J;e?!a.v&&g>a.Vh&&(a.v=!0,e.dispatchEvent(new cp(b,c,e,d)),Ce(f.L(),a.gj,a.Hj,!1,a)):f.de(b,c,a.vo.bind(a,b,c,d))}n.vo=function(a,b,c,d){d=d&&Ca(d.dispatchEvent)?d:this.map;ep(this,a,b,c,d)};n.gj=["mousedown","touchstart","pointerdown","wheel"];
n.Hj=function(){this.v&&(this.v=!1,this.map.dispatchEvent(new rd("contextmenuclose",this.map)))};n.u=function(){var a=this.map.L();clearInterval(this.g);a&&Je(a,this.gj,this.Hj,!1,this);Ro.prototype.u.call(this)};function fp(a,b,c,d,e){fp.l.constructor.call(this,"wheel");this.delta=a;this.viewportX=b;this.viewportY=c;this.target=d;this.originalEvent=e}u(fp,rd);t("H.mapevents.WheelEvent",fp);function gp(a){var b="onwheel"in document;this.N=b;this.J=(b?"d":"wheelD")+"elta";this.g=A(this.g,this);gp.l.constructor.call(this,a,[{Ta:(b?"":"mouse")+"wheel",listener:this.g}]);this.v=this.map.ya}u(gp,Ro);
gp.prototype.g=function(a){if(!a.Tl){var b=Fo(this.j);var c=a.pageX-b.x;b=a.pageY-b.y;var d=this.J,e=a[d+(d+"Y"in a?"Y":"")],f;Zc&&"rtl"===x.getComputedStyle(this.v.element).direction&&(c-=(x.devicePixelRatio-1)*this.v.width);if(e){var g=Math.abs;var h=g(e);e=(!(f=a[d+"X"])||3<=h/g(f))&&(!(f=a[d+"Z"])||3<=h/g(f))?((0<e)-(0>e))*(this.N?1:-1):0}c=new fp(e,c,b,null,a);c.delta&&(a.stopImmediatePropagation(),a.preventDefault(),this.map.de(c.viewportX,c.viewportY,this.U.bind(this,c)))}};
gp.prototype.U=function(a,b){var c=a.target=b||this.map,d,e;setTimeout(function(){c.dispatchEvent(a);a.f||(d=a.originalEvent,e=new x.WheelEvent("wheel",d),e.Tl=1,d.target.dispatchEvent(e))},0)};function hp(a){this.g=A(this.g,this);Ro.call(this,a,[{Ta:"mousedown",listener:this.g},{Ta:"mousemove",listener:this.g,target:window},{Ta:"mouseup",listener:this.g,target:window},{Ta:"mouseover",listener:this.g},{Ta:"mouseout",listener:this.g},{Ta:"dragstart",listener:this.v}])}u(hp,Ro);
hp.prototype.g=function(a){var b=a.type,c=Fo(this.j);c={x:a.pageX-c.x,y:a.pageY-c.y};var d;(d=this.a.a[0])||(d=new Io(c.x,c.y,1,"mouse"),this.a.push(d));this.b.push(d);Jo(d,c.x,c.y);/^mouse(?:move|over|out)$/.test(b)?To(this,"pointermove",a):(/^mouse(down|up)$/.test(b)&&(c=a.which-1,"up"===Go.RegExp.$1?Lo(d,c):Ko(d,c)),To(this,b.replace("mouse","pointer"),a));this.b.clear()};hp.prototype.v=function(a){a.preventDefault()};function ip(a){var b=a.ya.element.style;if(-1!==jp.indexOf(a))throw Error("InvalidArgument: map is already in use");this.a=a;jp.push(a);b.msTouchAction=b.touchAction="none";$c||!window.PointerEvent&&!window.MSPointerEvent?(this.c=new Zo(this.a),this.b=new hp(this.a)):this.c=new $o(this.a);this.g=new gp(this.a);this.f=new dp(this.a);this.a.zb(this.B,this);nd.call(this)}u(ip,nd);t("H.mapevents.MapEvents",ip);ip.prototype.c=null;ip.prototype.b=null;ip.prototype.g=null;ip.prototype.f=null;
var jp=[];Fc(jp);ip.prototype.B=function(){this.a=null;this.c.B();this.g.B();this.f.B();this.b&&this.b.B();jp.splice(jp.indexOf(this.a),1);nd.prototype.B.call(this)};ip.prototype.dispose=ip.prototype.B;ip.prototype.Dm=function(){return this.a};ip.prototype.getAttachedMap=ip.prototype.Dm;function kp(a,b){b=void 0===b?{}:b;var c;kp.l.constructor.call(this);if(-1!==lp.indexOf(a))throw new D(kp,0,"events are already used");this.a=c=a.a;this.j=a;lp.push(a);c.draggable=!0;this.i=b.kinetics||{duration:600,ease:Nl};this.m=b.modifierKey||"Alt";this.enable(b.enabled);this.c=c.ya;this.f=this.c.element;this.g=0;c.addEventListener("dragstart",this.ei,!1,this);c.addEventListener("drag",this.Ek,!1,this);c.addEventListener("dragend",this.di,!0,this);c.addEventListener("wheel",this.Uk,!1,this);c.addEventListener("dbltap",
this.Pk,!1,this);c.addEventListener("pointermove",this.Fk,!1,this);Be(this.f,"contextmenu",this.Dk,!1,this);a.zb(this.B,this)}u(kp,nd);t("H.mapevents.Behavior",kp);var lp=[];Fc(lp);kp.prototype.b=0;var mp={PANNING:1,PINCH_ZOOM:2,WHEEL_ZOOM:4,DBL_TAP_ZOOM:8,FRACTIONAL_ZOOM:16,TILT:32,HEADING:64};kp.Feature=mp;var np=mp.PANNING,op=mp.PINCH_ZOOM,pp=mp.WHEEL_ZOOM,qp=mp.DBL_TAP_ZOOM,rp=mp.FRACTIONAL_ZOOM,sp=mp.TILT,tp=mp.HEADING,up=np|op|pp|qp|rp|sp|tp;kp.DRAGGING=np;kp.WHEELZOOM=pp;
kp.DBLTAPZOOM=qp;kp.FRACTIONALZOOM=rp;function vp(a,b){if(a!==+a||a%1||0>a||2147483647<a)throw new D(b,0,"integer in range [0...0x7FFFFFFF] required");}kp.prototype.disable=function(a){var b=this.b;a!==B?(vp(a,this.disable),b^=b&a):b=0;this.c.endInteraction(!0);this.b=b;this.a.draggable=0<(b&(np|sp|tp|op))};kp.prototype.disable=kp.prototype.disable;kp.prototype.enable=function(a){var b=this.b;a!==B?(vp(a,this.enable),b|=a&up):b=up;this.b=b;this.a.draggable=0<(b&(np|sp|tp|op))};
kp.prototype.enable=kp.prototype.enable;kp.prototype.isEnabled=function(a){vp(a,this.isEnabled);return a===(this.b&a)};kp.prototype.isEnabled=kp.prototype.isEnabled;
function wp(a,b,c){var d="touch"===b.currentPointer.type,e=0,f;if(f=!d){f=a.m;var g,h=b.originalEvent;h.getModifierState?g=h.getModifierState(f):g=!!h[f.replace(/^Control$/,"ctrl").toLowerCase()+"Key"];f=g}f?e|=sp|tp:(e|=np,d&&(b=b.pointers,2===b.length&&(e|=op|tp,c?55>Ad(b[0].viewportY-b[1].viewportY)&&(e|=sp):a.Nh&ul.TILT&&(e|=sp))));e&=a.b;return(e&sp?ul.TILT:0)|(e&tp?ul.HEADING:0)|(e&op?ul.ZOOM:0)|(e&np?ul.COORD:0)}
function xp(a){var b=a.pointers;a=b[0];b=b[1];a=[a.viewportX,a.viewportY];b&&a.push(b.viewportX,b.viewportY);return a}n=kp.prototype;n.Nh=0;n.ei=function(a){var b=wp(this,a,!0);if(this.Nh=b){var c=this.c;a=xp(a);c.startInteraction(b,this.i);c.interaction.apply(c,a);if(this.b&pp&&!(this.b&rp)&&(b=a[0],c=a[1],this.g)){a=this.a.vb();var d=(0>this.g?zd:yd)(a);a!==d&&(this.g=0,yp(this,a,d,b,c))}}};
n.Ek=function(a){var b=wp(this,a,!1);if(b!==this.Nh)"pointerout"!==a.originalEvent.type&&"pointerover"!==a.originalEvent.type&&(this.di(a),this.ei(a));else if(b){b=this.c;var c=xp(a);b.interaction.apply(b,c);a.originalEvent.preventDefault()}};n.di=function(a){wp(this,a,!1)&&this.c.endInteraction(!this.i)};
function yp(a,b,c,d,e){var f=+c-+b;a=a.a.b;if(isNaN(+b))throw Error("start zoom needs to be a number");if(isNaN(+c))throw Error("to zoom needs to be a number");0!==f&&(a.startControl(null,d,e),a.control(0,0,6,0,0,0),a.endControl(!0,function(g){g.zoom=c}))}n.Uk=function(a){if(!a.defaultPrevented&&this.b&pp){var b=a.delta;var c=this.a.vb();var d=this.a;var e=d.ic().type;d=this.b&rp?c-b:(0>-b?zd:yd)(c)-b;if(e===Vj.P2D||e===Vj.WEBGL||e===Vj.HARP)yp(this,c,d,a.viewportX,a.viewportY),this.g=b;a.preventDefault()}};
n.Fk=function(){};n.Pk=function(a){var b=a.currentPointer,c=this.a.vb(),d=a.currentPointer.type,e=this.a.ic().type;(e===Vj.P2D||e===Vj.WEBGL||e===Vj.HARP)&&this.b&qp&&(a="mouse"===d?0===a.originalEvent.button?-1:1:0<a.pointers.length?1:-1,a=this.b&rp?c-a:(0>-a?zd:yd)(c)-a,yp(this,c,a,b.viewportX,b.viewportY))};n.Dk=function(a){return this.b&qp?(a.preventDefault(),!1):!0};
n.B=function(){var a=this.a;a&&(a.draggable=!1,a.removeEventListener("dragstart",this.ei,!1,this),a.removeEventListener("drag",this.Ek,!1,this),a.removeEventListener("dragend",this.di,!0,this),a.removeEventListener("wheel",this.Uk,!1,this),a.removeEventListener("dbltap",this.Pk,!1,this),a.removeEventListener("pointermove",this.Fk,!1,this),this.a=null);this.f&&(this.f.style.msTouchAction="",Je(this.f,"contextmenu",this.Dk,!1,this),this.f=null);this.i=this.c=null;lp.splice(lp.indexOf(this.j),1);nd.prototype.B.call(this)};
kp.prototype.dispose=kp.prototype.B;t("H.mapevents.buildInfo",function(){return Ef("H-mapevents","1.30.6","a2dc7f9")});

R.prototype.O=ca(3,function(a){var b=this.getCache(),c=this;if(a!==y){C(a,Dk,R.prototype.O,0);var d=a}else d=hl;d!==b&&b.qa(function(e,f,g){return c.gc(e)?(d.add(e,f,g),!0):!1});this.U=d});Th.prototype.b=ca(2,function(a){this.i=a;a=this.getState();a!==Qh.INIT&&a!==Qh.LOADING&&ai(this)});function zp(a,b){Wa.apply(null,arguments);return a}function Ap(){this.a={}}
function Bp(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d,e=b[c],f=a.a[c]||(a.a[c]=[]),g=e.length;for(d=0;d<g;d++)f.push(new Cp(e[d]))}}function Dp(a,b,c,d){var e=(a=a.a[b])?a.length:0,f=[];for(b=0;b<e;b++)a[b].Ad(c,d)&&f.push(a[b]);return f}
function Cp(a){var b,c=a.boxes;this.label=a.label;this.min=a.minLevel;this.max=a.maxLevel;this.b=[];if(c&&(b=c.length)){var d=c[0];var e=new K(d[0],d[1],d[2],d[3]);this.b.push(e);this.a=new K(d[0],d[1],d[2],d[3]);for(a=1;a<b;a++)d=c[a],e=new K(d[0],d[1],d[2],d[3]),this.b.push(e),this.a.nc(e,!1,this.a)}}Cp.prototype.Ad=function(a,b){if(a>=this.min&&a<=this.max)if((a=this.b.length)&&this.a){if(this.a.Ad(b))for(;a--;)if(this.b[a].Ad(b))return!0}else return!0;return!1};function W(a,b,c,d,e,f){if(a&&b)this.Cl(a),this.Ig(b),this.Md(c),this.Bl(e),this.rl(f),this.Oi(d);else throw Error('Parameters "scheme" and "host" must be specified');}t("H.service.Url",W);
function Ep(a,b){var c=x.document,d,e=c&&c.createElement("a"),f="";if(c){if(b){var g=(d=c.getElementsByTagName("base")[0])&&d.href;var h=c.head;var k=d||h.appendChild(c.createElement("base"));k.href=b}e.href=a;f=e.href;b&&(d?d.href=g:h.removeChild(k))}else/[\w]+:\/\//.test(a)&&(f=a);g=/(?:(\w+):\/\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\/[^?#]*)?(\?[^#]+)?(#.*)?/.exec(f);a=g[1];k=g[4];b=g[5];h=g[6];c=g[7];d=g[8];!g[2]&&k&&/@/.test(k)&&(k=k.split("@")[1]);g=k;h=h&&0<h.length?h.substr(1):
"";k={};if(c)for(e=/([?&]?([^=&+]+))(=([^&]+))?/g;f=e.exec(c);)k[decodeURIComponent(f[2])]=f[4]?decodeURIComponent(f[4]):void 0;return new W(a,g,h,k,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):"")}W.parse=Ep;var Fp=0;W.prototype.clone=function(){Fp++;var a={},b;for(b in this.a)a[b]=this.a[b];return new W(this.s,this.f,this.c,a,this.g,this.b)};W.prototype.clone=W.prototype.clone;
W.prototype.Cl=function(a){if(!a||"string"!==typeof a)throw Error('The "scheme" parameter must be a non-empty string.');this.s=a;return this};W.prototype.setScheme=W.prototype.Cl;W.prototype.Hn=function(){return this.s};W.prototype.getScheme=W.prototype.Hn;W.prototype.Ig=function(a){if(!a||"string"!==typeof a||"-"===a.charAt(0)||"."===a.charAt(0)||"."===a.charAt(a.length-1))throw Error('The "host" parameter is not a valid host name.');this.f=a;return this};W.prototype.setHost=W.prototype.Ig;
W.prototype.bn=function(){return this.f};W.prototype.getHost=W.prototype.bn;W.prototype.Md=function(a){this.c=a||void 0;return this};W.prototype.setPath=W.prototype.Md;W.prototype.un=function(){return this.c};W.prototype.getPath=W.prototype.un;W.prototype.Oi=function(a){if(a)if("object"==typeof a)this.a=a;else throw Error('Parameter "params" must be an object.');else this.a={};return this};W.prototype.setQuery=W.prototype.Oi;W.prototype.jk=function(){return!Gp(this)};W.prototype.hasQuery=W.prototype.jk;
W.prototype.getQuery=function(){return this.a};W.prototype.getQuery=W.prototype.getQuery;W.prototype.Bl=function(a){if(a&&isNaN(parseInt(a,10)))throw Error('Parameter "port" must be a number or undefined');this.g=+a||void 0;return this};W.prototype.setPort=W.prototype.Bl;W.prototype.yn=function(){return this.g};W.prototype.getPort=W.prototype.yn;W.prototype.rl=function(a){this.b=a||void 0;return this};W.prototype.setAnchor=W.prototype.rl;W.prototype.ud=function(){return this.b};
W.prototype.getAnchor=W.prototype.ud;W.prototype.I=function(a){if("object"!==typeof a)throw Error('Parameter "other" must be an object.');var b=this.a,c;for(c in a)a.hasOwnProperty(c)&&"function"!==typeof a[c]&&(b[c]=a[c]);return this};W.prototype.mergeQuery=W.prototype.I;W.prototype.Ma=function(a){if(!a||"string"!==typeof a)throw Error('Parameter "subDomain" must be a non-empty string');"."===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Ig(a+"."+this.f)};
W.prototype.addSubDomain=W.prototype.Ma;W.prototype.F=function(a){if(!a||"string"!==typeof a)throw Error('Parameter "subPath" must be a non-empty string');return this.Md((this.c?this.c+"/":"")+a)};W.prototype.addSubPath=W.prototype.F;W.prototype.toString=function(){return[this.s+"://",this.f,this.g?":"+this.g:"",this.c||!Gp(this)||this.b?"/":"",this.c?encodeURI(this.c):"",Hp(this),this.b?"#"+encodeURIComponent(this.b):""].join("")};W.prototype.toString=W.prototype.toString;
function Hp(a){function b(g,h){return encodeURIComponent(g)+(void 0===h?"":"="+encodeURIComponent(h).replace(/[!'()*]/g,function(k){return"%"+k.charCodeAt(0).toString(16)}))}var c=[],d,e=a.a;for(d in e)if(e.hasOwnProperty(d)&&"function"!==typeof e[d]){var f=a.a[d];C(f,Ip)?f.Rl.forEach(function(g){c.push(b(d,g))}):c.push(b(d,f))}return 0<c.length?"?"+c.join("&"):""}function Jp(a){var b=Ef("H-service","1.30.6","2978c8b");a.a.xnlp="CL_JSMv3."+b.version;return a}
function Gp(a){var b,c=0;for(b in a.a)if(a.a.hasOwnProperty(b)&&"function"!==typeof a.a[b]&&(c++,0<c))break;return!c}function Ip(a){var b;if(!yc(a))throw new D(Ip,0,a);for(b=0;b<a.length;b++){var c=a[b];if(!zc(c)&&!Cc(c))throw new D(Ip,0,"The array can only contain strings and numbers");}this.Rl=a}W.MultiValueQueryParameter=Ip;Ip.prototype.Sn=function(){return this.Rl};Ip.prototype.getValues=Ip.prototype.Sn;var Kp=Function("return this")();rc("monospace serif");function Lp(){}Lp.prototype.pop=function(a){this[a]||(this[a]=[]);return this[a].pop()||Kp.document.createElement("canvas")};Lp.prototype.push=function(a,b){this[b]||(this[b]=[]);this[b].push(a)};var Mp=new Lp;t("H.service.util.eval",function(a){return eval(a)});function Np(){var a=decodeURIComponent(x.H.getScriptPath());a=a?"/"===a[a.length-1]?a.substring(0,a.length-1):a:"https://js.api.here.com/v3/3.1.30.6";return Ep(a).F("styles")};function Op(a,b,c,d,e,f,g){var h=this;g=g||{};f=f?f:{};var k=a.D().clone().F(b+"/"+a.Cc()+"/"+c).I(f),l=a.Fh();this.J=a;this.W=k;sk.call(this,{tileSize:d,max:512===d?19:20,min:512===d?2:0,getURL:function(m,p,q){var r=h.W.clone();l&&r.Ma(l[(q+p+m)%l.length]);r.F(q+"/"+m+"/"+p+"/"+d+"/"+e);return r.toString()},crossOrigin:g.crossOrigin,headers:g.headers,uri:k.toString().replace(/_/g,"")+d,engineType:g.engineType});this.kb=b;this.s=c;this.a=f;this.yb=c.split(".")[0];this.ng=A(this.ng,this);this.getCopyrights=
this.ta;a.addEventListener("versionupdate",this.ng)}u(Op,sk);Op.prototype.MAX_STORE_TIME=2592E6;n=Op.prototype;n.u=function(){sk.prototype.u.call(this);this.J.removeEventListener("versionupdate",this.ng)};n.ta=function(a,b){return Dp(this.J.ta(),this.yb,b,a)};n.ng=function(){var a=this.J;this.W=a.D().clone().F(this.kb+"/"+a.Cc()+"/"+this.s).I(this.a);this.reload(!1)};n.fh=function(){return ld()};n.ge=function(){return ld()?kd():Op.l.ge.call(this)};function Pp(a,b){b=void 0===b?{}:b;if(!a.qk)throw new Xc(a);Pp.l.constructor.call(this);var c=Qp(this,b);if(!c.baseUrl&&!c.platformBaseUrl)throw new D(a,0,'either "baseUrl" or "platformBaseUrl" must be specified');this.c=(c.baseUrl?c.baseUrl:c.platformBaseUrl).clone();a=c.baseUrl?b:c;a.host&&this.c.Ig(a.host);a.subDomain&&this.c.Ma(a.subDomain);a.path&&this.c.Md(a.path);Jp(this.c);this.gf=c.headers||{}}u(Pp,F);t("H.service.Service",Pp);function Qp(a,b){a=a.a();return b?zp({},a,b):a}
Pp.prototype.a=function(){return{}};Pp.prototype.D=function(){return this.c};Pp.prototype.getUrl=Pp.prototype.D;Pp.prototype.K=function(a,b,c,d){d=new rf(void 0===d?"application/json":d,a.toString(),fe,{headers:this.gf});d.then(b,Rp(this,a,c));return d};function Rp(a,b,c){return function(d){return"function"!==typeof d.json?Promise.reject(c(Sp(b,d))):d.json().then(function(e){return c(a.b(e))},function(){return c(Sp(b,d))})}}Pp.prototype.b=function(a){return Error(a.message)};
function Sp(a,b){return Error((b.statusText?"["+b.statusText+"] ":"")+a+" request failed")};function Y(a){a=zp({},this.b,a);var b=a.apikey||a.apiKey,c=a.baseUrl;if(c=b?c?0:"baseUrl":"apikey")throw new D(Y,0,'"'+c+'" must be specified');this.ul(a.baseUrl);this.a=b;this.c.I({apikey:b});this.f=a.headers||{};this.g=Ua(a.servicesConfig||{})}t("H.service.Platform",Y);Y.prototype.b={apikey:null,baseUrl:new W("https","hereapi.com")};Y.prototype.ul=function(a){this.c=Jp(a.clone());this.a=a=this.a;this.c.I({apikey:a})};Y.prototype.setBaseUrl=Y.prototype.ul;Y.prototype.hc=function(){return this.c};
Y.prototype.getBaseUrl=Y.prototype.hc;Y.prototype.Ya=function(a,b){try{return a.qk=!0,new a(zp({platformBaseUrl:this.hc(),headers:this.f},this.g[a.CONFIG_KEY]||{},b||{}))}finally{delete a.qk}};Y.prototype.createService=Y.prototype.Ya;function Tp(a){Tp.l.constructor.call(this,Tp,a);a=Qp(this,a);this.bc=a.shards;(this.Ra=a.ignoreTypes?null:a.type)&&this.D().Ma(this.Ra);this.cc=a.version;this.Xc=new Ap;this.vi={};this.Rf=0;"newest"===this.cc&&this.ph()}u(Tp,Pp);t("H.service.MapTileService",Tp);Tp.prototype.a=function(){return{subDomain:"maps.ls",path:"maptile/2.1",type:"base",version:"newest",shards:["1","2","3","4"]}};Tp.CONFIG_KEY="maptile";
function Vp(a,b){for(var c={},d=a[b+"s"][b],e=d.length;e--;)c[d[e].id]=d[e];a[b+"s"]=c}Tp.prototype.Fh=function(){return this.bc};Tp.prototype.ek=function(){return this.Ra};Tp.prototype.getType=Tp.prototype.ek;Tp.prototype.Cc=function(){return this.cc};Tp.prototype.getVersion=Tp.prototype.Cc;Tp.prototype.Si=function(a){this.cc=a};Tp.prototype.ta=function(){this.Rf||(this.cc&&"newest"!==this.cc||"traffic"===this.Ra)&&this.Re();return this.Xc};Tp.prototype.getCopyrights=Tp.prototype.ta;n=Tp.prototype;
n.$i=function(a){a=a.response;var b;Vp(a,"map");Vp(a,"scheme");Vp(a,"tiletype");Vp(a,"format");Vp(a,"resolution");Vp(a,"language");if("newest"===this.cc&&"traffic"!==this.Ra)for(b in a.maps)a.maps[b].hash&&a.maps[b].newest&&(this.Si(a.maps[b].hash),this.dispatchEvent("versionupdate"));this.Lh=a;this.dispatchEvent("infoupdate")};n.Zi=function(a){Bp(this.Xc,a);this.dispatchEvent("copyrightupdate")};
n.ph=function(){var a=this;var b=this.D().clone().F("info").I({output:"json"});this.bc&&b.Ma(this.bc[0]);this.K(b,function(c){a.$i(c)},function(c){throw c;})};n.Re=function(){var a=this;var b=this.D().clone().F("copyright").F(a.Cc()).I({output:"json"});this.bc&&b.Ma(this.bc[0]);this.Rf=1;this.K(b,function(c){a.Rf=2;a.Zi(c)},function(c){a.Rf=-1;throw c;})};n.xh=function(){return this.Lh};Tp.prototype.getInfo=Tp.prototype.xh;
Tp.prototype.Me=function(a,b,c,d,e,f){var g=this.D().clone().F(a+"/"+this.Cc()+"/"+b+"/"+c+"/"+d).I(e?e:{}).toString();var h=0,k,l=g.length;if(0!==l)for(k=0;k<l;k++){var m=g.charCodeAt(k);h=(h<<5)-h+m;h|=0}g=h;h=this.vi[g];h||(h=new Op(this,a,b,c,d,e,zp({headers:this.gf},f||{})),this.vi[g]=h);return h};Tp.prototype.createTileProvider=Tp.prototype.Me;Tp.prototype.wc=function(a,b,c,d,e,f,g,h){a=this.Me(a,b,c,d,e,h);return new ll(a,{opacity:f,dark:!!g})};Tp.prototype.createTileLayer=Tp.prototype.wc;
Y.prototype.Ah=function(a){return this.Ya(Tp,a)};Y.prototype.getMapTileService=Y.prototype.Ah;function Wp(a,b,c){var d=this;c=c||{};var e=+c.min,f=+c.max;c.tileSize=c.tileSize||512;c.min=e?Yd(e,1,17):1;c.min+=Bk(c.tileSize,1);c.max=f?Yd(f,1,17):17;Wp.l.constructor.call(this,c);C(a,Xp,Wp,0);C(b,Ph,Wp,1);this.o=a;b.b&&b.b("OMV");this.ac(b,!0);this.s=function(){Yp(d);d.reload(!1)};a.addEventListener("versionupdate",this.s);Yp(this);Wp.prototype.J=function(){var g=/^v2\/vectortiles\/(.+)\/mc$/.exec(a.D().c);return g?g[1]:B+""}()}u(Wp,R);t("H.service.omv.Provider",Wp);Wp.prototype.Ed=df;
Wp.prototype.providesOMV=Wp.prototype.Ed;function Yp(a){var b=a.yd("_#-;,:","_#-;,:","_#-;,:");a.v=new RegExp("^"+b.replace(/[.*+?^${}()|[\]\\\/]/g,"\\$&").replace(/_#-;,:/g,"\\d+")+"$")}Wp.prototype.gc=function(a){return this.v.test(a)};Wp.prototype.cacheFilter=Wp.prototype.gc;Wp.prototype.yd=function(a,b,c){return Zp(this.o,a,b,c).toString()};Wp.prototype.getTileKey=Wp.prototype.yd;Wp.prototype.Ob=function(){return this.N};Wp.prototype.getCache=Wp.prototype.Ob;Wp.prototype.MAX_STORE_TIME=2592E6;
Wp.prototype.fh=function(){return ld()};Wp.prototype.ge=function(){return ld()?kd():Wp.l.ge.call(this)};Wp.prototype.K=function(a,b,c,d,e){return this.o.jb(a,b,c,d,e)};Wp.prototype.requestInternal=Wp.prototype.K;Wp.prototype.rc=function(a){a.b&&a.b("OMV");this.ac(a)};Wp.prototype.setStyle=Wp.prototype.rc;Wp.prototype.ua=function(){return Wp.l.ub.apply(this)};Wp.prototype.getStyle=Wp.prototype.ua;
Wp.prototype.ub=function(){var a=Wp.l.ub.apply(this),b;this.C&&(a.getState()===Qh.READY?(b=a.vd())&&b.global&&(this.c&&(b.global.ux_language=this.c),this.a&&(b.global.ux_language_fallback=this.a),a=new Th(b,a.hc())):a.load());return a};function $p(a,b,c){var d=a.ub().getState()===Qh.READY,e=zc(b),f=zc(c);e&&(a.c=b);f&&(a.a=c);if(e||f)a.C=!0,d&&a.g()}Wp.prototype.u=function(){Wp.l.u.call(this);this.o.removeEventListener("versionupdate",this.s)};Wp.prototype.N=new Dk(256);
Wp.prototype.ta=function(a,b){return Dp(this.o.ta(),this.J,b,a)};Wp.prototype.getCopyrights=Wp.prototype.ta;function Xp(a){Xp.l.constructor.call(this,Xp,a);a=Qp(this,a).mapVersion;this.df=tc(a)?a:aq[this.D().toString()];tc(this.df)||bq(this)}u(Xp,Pp);t("H.service.omv.Service",Xp);Xp.prototype.a=function(){return{subDomain:"vector",path:"v2/vectortiles/base/mc"}};Xp.CONFIG_KEY="omv";var aq={};Fc(aq);Xp.prototype.nn=function(){return this.df};Xp.prototype.getMapVersion=Xp.prototype.nn;
function bq(a){a.K(a.D().clone().F("../../info"),function(b){b=b.mapVersion;var c=a.D().toString();a.df=b;b!==aq[c]&&(aq[c]=b,a.dispatchEvent("versionupdate"))},function(){})}Xp.prototype.qd=function(a,b){return new ll(new Wp(this,a,b),{max:22})};Xp.prototype.createLayer=Xp.prototype.qd;Xp.prototype.jb=function(a,b,c,d,e){return this.K(Zp(this,a,b,c),function(f){return f.arrayBuffer().then(d,e)},e,"arraybuffer")};
function Zp(a,b,c,d){b=a.D().clone().F(d+"/"+b+"/"+c+"/omv");tc(a.df)&&b.I({mv:a.df});return b}Xp.prototype.he=function(a){return Np().F(a)};Xp.prototype.Ch=function(a,b){if(!Ca(a))throw new D(this.Ch,0,'"onResult" must be a function');if(!Ca(b))throw new D(this.Ch,1,'"onError" must be a function');return this.K(this.D().clone().Md("v2/vectortiles/pviews"),a,b)};Xp.prototype.getPoliticalViews=Xp.prototype.Ch;Y.prototype.$j=function(a){return this.Ya(Xp,a)};Y.prototype.getOMVService=Y.prototype.$j;
Xp.prototype.Re=function(){this.Xc=new Ap;this.K(this.D().clone().F("../../copyrights"),A(this.Zi,this),hd)};Xp.prototype.Zi=function(a){Bp(this.Xc,a);this.dispatchEvent("copyrightupdate")};Xp.prototype.ta=function(){this.Xc||this.Re();return this.Xc};Xp.prototype.getCopyrights=Xp.prototype.ta;Y.prototype.Sf=function(a,b,c,d,e,f){var g=this.Ah(),h=this.Ah({type:"aerial"}),k=this.dk(),l=this.$j(),m=Vj.WEBGL,p={},q={crossOrigin:"anonymous"};if(Da(a)){var r=a;"crossOrigin"in r&&(q.crossOrigin=r.crossOrigin);a=r.tileSize;b=r.ppi;c=r.lg;d=r.lg2;e=r.style;f=r.pois;r.engineType&&(m=r.engineType,q.engineType=m)}var v=a||512;if(0>[72,250,320,500].indexOf(+b)){if(b!==B)throw new D(this.Sf,1,b);}else p.ppi=+b;c&&(p.lg=c);d&&(p.lg2=d);e&&(p.style=e);f&&(p.pois=f);a=function(w,z,J,G,U){return w.wc(z,
J,v,G,p,1,U,q)};if(m===Vj.HARP&&!H.map.render.harp)throw new D(this.Sf,0,"HARP engine is not supported, module not found");b=m===Vj.WEBGL?new Th(l.he("omv/miami/normal.day.yaml").toString()):new H.map.render.harp.Style(l.he("harp/miami/normal.day.json").toString());c=m===Vj.WEBGL?new Th(l.he("omv/miami/truck.day.yaml").toString()):new H.map.render.harp.Style(l.he("harp/miami/normal.day.json").toString());d={engineType:m};b=l.qd(b,d);$p(b.ga(),p.lg,p.lg2);c=l.qd(c,d);$p(c.ga(),p.lg,p.lg2);l=k.zj(p.lg?
{lg:p.lg,i18n:!0,engineType:m}:{engineType:m});return{vector:{normal:{map:b,truck:c,traffic:k.yj(void 0,m),trafficincidents:l}},raster:{normal:{xbase:a(g,"xbasetile","normal.day","png8",!1),xbasenight:a(g,"xbasetile","normal.night","png8",!0),base:a(g,"basetile","normal.day","png8",!1),basenight:a(g,"basetile","normal.night","png8",!0),map:a(g,"maptile","normal.day","png8",!1),mapnight:a(g,"maptile","normal.night","png8",!0),trafficincidents:l,transit:a(g,"maptile","normal.day.transit","png8",!1),
labels:a(g,"labeltile","normal.day","png",!1)},satellite:{xbase:a(h,"xbasetile","hybrid.day","jpg",!0),base:a(h,"basetile","hybrid.day","jpg",!0),map:a(h,"maptile","hybrid.day","jpg",!0),labels:a(h,"labeltile","hybrid.day","png",!0)},terrain:{xbase:a(h,"xbasetile","terrain.day","jpg",!1),base:a(h,"basetile","terrain.day","jpg",!1),map:a(h,"maptile","terrain.day","jpg",!1),labels:a(h,"labeltile","terrain.day","png",!1)}}}};Y.prototype.createDefaultLayers=Y.prototype.Sf;function cq(){this.a={}}cq.prototype.Cb=function(a,b){var c=a+b,d;if(d=this.a[c])return d;a=dq.MARKER.replace("{{icon}}",eq[a]||eq.OTHER);a=a.replace("{{color}}",fq[b]||fq.BLOCKING);b={size:{w:26,h:33},anchor:{x:13,y:30},hitArea:new Li(Mi.POLYGON,gq.MARKER)};return this.a[c]=d=new Ij(a,b)};
var dq={MARKER:'<svg width="26" height="33" enable-background="new 0 0 26 33" viewBox="0 0 26 33" xmlns="http://www.w3.org/2000/svg"><path d="m26 33h-26v-33h26z" fill="#8c8c8c" opacity="0"/><path d="m17 29.566c0 1.116-1.791 2.022-4 2.022s-4-.906-4-2.022c0-1.118 1.791-2.026 4-2.026s4 .908 4 2.026" fill="#878787" opacity=".6"/><path d="m1.795 17.971c-1.562-1.555-1.574-3.828-.028-5.655l8.343-10.021c.769-.895 1.795-1.384 2.894-1.384 1.117 0 2.197.521 2.889 1.394l8.338 10.014c1.588 1.854 1.578 4.022-.029 5.65l-11.202 11.202z" fill="{{color}}"/>{{icon}}</svg>'},eq=
{CONGESTION:'<path style="fill:#FFFFFF;" d="M12.966,1.177c0.965,0,1.894,0.442,2.496,1.204l8.378,10.258c1.362,1.592,1.482,3.477,0,4.979L12.994,28.464L2.143,17.618c-1.381-1.375-1.38-3.348,0-4.979l8.314-10.258C11.174,1.547,12.085,1.177,12.966,1.177 M12.967,0.177L12.967,0.177c-1.247,0-2.408,0.551-3.269,1.552l-8.332,10.28c-1.711,2.022-1.688,4.567,0.07,6.317l10.85,10.845l0.707,0.707l0.707-0.707l10.847-10.846c1.784-1.807,1.803-4.292,0.053-6.337L16.237,1.748C15.462,0.769,14.236,0.177,12.967,0.177L12.967,0.177z M16.645,10.405l-2.025-2.22c-0.48-0.51-1.15-0.8-1.84-0.8H9.53c-0.69,0-1.36,0.29-1.84,0.8l-1.94,2.22c-0.39,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.44l0.255-0.539c0.204-0.431,0.456-0.837,0.753-1.21l0.962-1.211l0.83-0.9c0.32-0.35,0.72-0.63,1.15-0.82H8.23c-0.28,0-0.55-0.07-0.79-0.22l-0.28-0.17l1.27-1.45c0.28-0.31,0.68-0.48,1.1-0.48h3.25c0.42,0,0.82,0.17,1.1,0.48l1.354,1.54H16.645z M18.31,12.205c-0.35-0.37-0.81-0.63-1.3-0.74c-0.18-0.04-0.36-0.06-0.54-0.06h-3.24c-0.7,0-1.37,0.29-1.84,0.8l-1.13,1.22l-0.82,1c-0.38,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.75v-1h5.99v1h1.75c0.69,0,1.25-0.56,1.25-1.25v-1.64c0-0.74-0.2-1.46-0.59-2.09L18.31,12.205z M12.1,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C12.35,16.993,12.238,17.105,12.1,17.105z M18.59,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C18.84,16.993,18.728,17.105,18.59,17.105z M18.56,14.505c-0.24,0.15-0.51,0.22-0.79,0.22h-5.85c-0.28,0-0.55-0.07-0.78-0.22l-0.29-0.17l1.27-1.45c0.15-0.16,0.33-0.28,0.53-0.37c0.18-0.07,0.38-0.11,0.58-0.11h3.24c0.24,0,0.48,0.06,0.68,0.16c0.16,0.08,0.3,0.19,0.42,0.32l1.27,1.45L18.56,14.505z M8.42,13.03h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C8.67,12.918,8.559,13.03,8.42,13.03z"/>',
ROADWORKS:'<path d="m13.004 1.411c.964 0 1.894.441 2.496 1.204l8.346 10.023c1.363 1.592 1.482 3.477 0 4.979l-10.846 10.847-10.852-10.846c-1.381-1.375-1.379-3.348 0-4.979l8.346-10.023c.717-.835 1.628-1.205 2.51-1.205m0-1c-1.248 0-2.408.551-3.268 1.552l-8.356 10.035c-1.718 2.033-1.695 4.578.064 6.328l10.85 10.845.706.707.707-.707 10.846-10.846c1.784-1.808 1.803-4.293.053-6.337l-8.337-10.012c-.769-.973-1.996-1.565-3.265-1.565zm-.575 15.264c.018-.332-.13-.651-.394-.851l-2.945-2.235-.21.36c-.22.39-.41.78-.58 1.19l-.677 2.129-1.364 3.051h1.314l2.109-4.672 1.317 1.212.138 3.46h1.092zm6.16-1.327c-.401-.54-1.209-.539-1.609.001l-1.17 1.58-2.29-1.74-.139-4.054c-.011-.276-.134-.535-.342-.716l-.7-.61c-.185-.161-.422-.25-.667-.25h-1.885c-.335 0-.648.168-.833.447l-1.144 1.723 7.58 5.76-1.86 2.51c-.098.132-.004.32.161.32h6.648l1.142-1.077zm-8.79-2.989-.876-.665.841-1.018.965.043zm1.63 1.24.969-1.781.118 2.61zm2.76-5.79c-.64 0-1.16.52-1.16 1.16 0 .65.52 1.17 1.16 1.17s1.16-.52 1.16-1.17c0-.64-.52-1.16-1.16-1.16z" fill="#fff"/>',
ACCIDENT:'<path style="fill:#FFFFFF;" d="M12.998,1.091c0.964,0,1.894,0.442,2.496,1.204l8.346,10.344c1.363,1.592,1.482,3.477,0,4.979L12.994,28.465L2.143,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.344C11.205,1.462,12.115,1.091,12.998,1.091 M12.998,0.091L12.998,0.091c-1.248,0-2.408,0.551-3.269,1.552L1.364,12.011c-1.708,2.021-1.685,4.566,0.073,6.316l10.85,10.845l0.707,0.707l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337l-8.327-10.32C15.494,0.684,14.268,0.091,12.998,0.091L12.998,0.091z M7.83,18.982l-3.309-1.855l0.945,1.855H7.83z M16.111,19h3.942l1.596-2L16.111,19z M10.512,20.064l1.021-1.021l1.632,0.076c0.329,0.018,0.651-0.022,0.963-0.123c0.626-0.206,1.122-0.76,1.288-1.44l0.264-1.089l2.066-0.93c0.373-0.17,0.673-0.42,0.861-0.731c0.275-0.449,0.405-0.97,0.369-1.498L18.9,11.676l1.021-1.021l-0.724-0.724l-0.427,0.427l-0.121-0.364c-0.201-0.603-0.54-1.151-0.989-1.6l-1.159-1.159c-0.5-0.5-1.31-0.5-1.809,0l-1.267,1.267l0.724,0.724l-5.066,5.066l-0.724-0.724l-1.267,1.267c-0.5,0.5-0.5,1.31,0,1.809l1.159,1.159c0.449,0.449,0.997,0.788,1.6,0.989l0.364,0.121l-0.427,0.427L10.512,20.064z M14.901,10.349l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0l-0.732-0.732C14.803,10.604,14.803,10.446,14.901,10.349z M9.472,15.777l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0L9.472,16.13C9.375,16.033,9.375,15.874,9.472,15.777z M11.391,17.615c0.069-0.271,0.206-0.518,0.405-0.717l4.961-4.961c0.195-0.195,0.445-0.337,0.717-0.405l0.344-0.083l0.137,1.925c0.022,0.318-0.058,0.63-0.221,0.901c-0.101,0.166-0.279,0.271-0.409,0.329L14.8,15.74l-0.38,1.574c-0.083,0.344-0.318,0.615-0.612,0.713c-0.188,0.058-0.38,0.083-0.579,0.072l-1.925-0.138L11.391,17.615z"/>',
OTHER:'<path style="fill:#FFFFFF;" d="M13.004,1.411c0.964,0,1.894,0.441,2.496,1.204l8.346,10.023c1.363,1.592,1.482,3.477,0,4.979L13,28.465L2.148,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.023C11.211,1.781,12.122,1.411,13.004,1.411 M13.004,0.411L13.004,0.411c-1.248,0-2.408,0.551-3.268,1.552L1.38,11.998c-1.718,2.033-1.694,4.579,0.064,6.328l10.85,10.845L13,29.878l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337L16.269,1.976C15.5,1.003,14.273,0.411,13.004,0.411L13.004,0.411z M14.716,20.139c0,0.947-0.758,1.724-1.724,1.724c-0.947,0-1.704-0.777-1.704-1.724c0-0.928,0.757-1.704,1.704-1.704C13.958,18.435,14.716,19.211,14.716,20.139z M14.204,16.33H11.78l-0.537-8.533h3.5L14.204,16.33z"/>'},
fq={BLOCKING:"#323232",VERYHIGH:"#d5232f",HIGH:"#ffa100"},gq={MARKER:[24.1,17.8,14.2,28.42,16.8,29.4,12.8,31.4,8.79,29.4,11.23,28.42,1.7,17.8,1.7,12.1,10,1.9,12.9,.498,15.8,1.9,24.1,12.1,24.1,17.8]};function hq(a,b,c){c=c?c:{};c.criticality||(c.criticality="major,critical");C(a,iq,hq,0);An.call(this,{max:20,min:8,requestData:A(this.W,this),engineType:c.engineType});this.s=new cq;this.C=a;this.a=c;this.reload=A(this.reload,this);this.v=setInterval(this.reload,b||18E4)}u(hq,An);t("H.service.traffic.incidents.Provider",hq);hq.prototype.c={minor:"HIGH","low impact":"HIGH",major:"VERYHIGH",critical:"BLOCKING"};
hq.prototype.W=function(a,b,c,d,e){var f=this,g=this.c,h=this.s;return this.C.requestIncidentsByTile(a,b,c,function(k){var l=[];k=k.TRAFFIC_ITEMS;var m;if(k)for(k=k.TRAFFIC_ITEM,m=k.length;m--;){var p=k[m];var q=p.TRAFFIC_ITEM_TYPE_DESC;switch(q){case "ACCIDENT":case "CONGESTION":var r=q;break;case "CONSTRUCTION":r="ROADWORKS";break;default:r="OTHER"}r=h.Cb(r,g[p.CRITICALITY.DESCRIPTION]);q=p.LOCATION.GEOLOC.ORIGIN;q=new yn({lat:q.LATITUDE,lng:q.LONGITUDE},{provider:f,icon:r});q.setData(p);l.push(q)}d(l)},
e,this.a)};hq.prototype.B=function(){An.prototype.B.call(this);clearInterval(this.v)};var jq="A21 A22 F01 F02 F08 F04 F05 F07 F03 F06 A2F F13 A25 A2C F12 D1B F1B A27 E12 A3A A24 A3D A3F F1F F25 F2C E32 A33 F29 D26 D36 F26 D0F F0F F2B E0C D3A A45 D23 D11 F2E F19 F14 F39 A4A A4B A5C D38 F2A F1A D0A F1C A48 D25 D1D F32 A46 A3E D24 E1C E32 A5F D2E D22 D0A".split(" ");function kq(a,b){var c={};this.a=a;Wa(c,b||c);ak.call(this,c);this.zg={};a=this.Pb(Pg.SPATIAL);a.update(a.a+1,Mg.ADD)}u(kq,ak);t("H.service.remote.ObjectProvider",kq);kq.prototype.B=function(){ak.prototype.B.call(this)};kq.prototype.Lc=function(){return ff};kq.prototype.requestMarkers=kq.prototype.Lc;kq.prototype.Kc=function(){return ff};kq.prototype.requestDomMarkers=kq.prototype.Kc;kq.prototype.Hd=function(){return ff};kq.prototype.requestOverlays=kq.prototype.Hd;kq.prototype.Wb=df;
kq.prototype.providesMarkers=kq.prototype.Wb;kq.prototype.Vb=df;kq.prototype.providesDomMarkers=kq.prototype.Vb;kq.prototype.Jc=df;kq.prototype.providesSpatials=kq.prototype.Jc;kq.prototype.Ag=function(){return ff};kq.prototype.requestSpatials=kq.prototype.Ag;function lq(a){return a.Dc(!0)}kq.prototype.Bg=function(a,b){a=mq(this,a,nq);b&&(a=a.filter(lq));return a};kq.prototype.requestSpatialsByTile=kq.prototype.Bg;
function mq(a,b,c){var d=b.j&&b.j[c],e;!d&&(e=b.m)&&(delete b.m,(b.j=a=a.a.parse(a,b,e))&&(d=a[c]));return d||ff}kq.prototype.ea=function(a){var b=a.gb();if(this.zg[b])throw new Xc(this.ea,"Remote object "+b+" already added");return this.zg[b]=a};kq.prototype.Ia=function(a){delete this.zg[a.gb()]};var nq="spatials";function oq(a,b,c,d){oq.l.constructor.call(this,{min:pq,max:qq,engineType:d});C(a,iq,oq,0);this.s=a;this.a=c||rq;this.a.responseattributes="sh,fc";this.c=setInterval(A(this.reload,this),b||18E4);this.f===Vj.WEBGL?this.ac(new Th(a.he("traffic/flow.yaml").toString()),!0):this.ac(new H.map.render.harp.Style({styles:[{when:["==",["geometry-type"],"LineString"],technique:"solid-line",renderOrder:10002,attr:{color:["case",[">=",["get","JF"],10],"black",[">=",["get","JF"],8],"red",[">=",["get","JF"],4],
"yellow","green"],lineWidth:3,metricUnit:"Pixel"}}]}))}u(oq,R);t("H.service.traffic.flow.Provider",oq);oq.prototype.xi=df;oq.prototype.providesGeoJSON=oq.prototype.xi;oq.prototype.ua=function(){return this.ub()};oq.prototype.getStyle=oq.prototype.ua;oq.prototype.rc=function(a){a.b&&a.b("GeoJSONTileSource");this.ac(a)};oq.prototype.setStyle=oq.prototype.rc;var rq={locationreferences:"tmc,shp"};oq.prototype.u=function(){oq.l.u.call(this);clearInterval(this.c)};
oq.prototype.K=function(a,b,c,d,e){return this.s.requestFlowByTile(a,b,c,function(f){f.type&&-1!==f.type.indexOf("Error")?e(f.Details):d(f)},e,this.a)};oq.prototype.requestInternal=oq.prototype.K;
oq.prototype.rd=function(a,b,c,d,e){var f,g,h,k,l={type:"FeatureCollection",features:[]},m;var p=d.RWS.length;for(f=0;f<p;f++){var q=d.RWS[f];var r=q.RW;var v=r.length;var w=-1!==jq.indexOf(q.EXTENDED_COUNTRY_CODE+q.EBU_COUNTRY_CODE);for(q=0;q<v;q++){var z=r[q].FIS;var J=z.length;for(z=0;z<J;z++){var G=r[q].FIS[z].FI;var U=G.length;for(g=0;g<U;g++){var X=G[g];var xa=[];var ia=X.CF[0];var gc=!!ia.SSS;var wb={type:"Feature",properties:ia,geometry:{type:"MultiLineString",coordinates:xa}};wb.properties.LHT=
w;X.SHP.length&&(wb.properties.FC=X.SHP[0].FC);gc&&(m=[]);for(ia=0;ia<X.SHP.length;ia++){var md=X.SHP[ia].value;var wi=md.length;for(h=0;h<wi;h++){var Qe=gc?m:void 0,Xb=new $n(md[h].trim()),Xf=[],cd={};for(Xb.ze();-1!==(k=Xb.Tb());)k===sq?(cd.lat=+String.fromCharCode.apply(oq,Xb.Ud()),Xb.next(),Xb.ze()):k===tq?(cd.lng=+String.fromCharCode.apply(oq,Xb.Ud()),Xf.push([cd.lng,cd.lat]),Qe&&Qe.push(Zf(cd)),cd=[],Xb.next(),Xb.ze()):Xb.next();cd.lng=+String.fromCharCode.apply(oq,Xb.Ud());Xf.push([cd.lng,
cd.lat]);Qe&&Qe.push(Zf(cd));k=Xf;xa.push(k)}}l.features.push(wb)}}}}return oq.l.rd.call(this,a,b,c,l,e)};oq.prototype.createTileInternal=oq.prototype.rd;var qq=21,pq=10,tq=32,sq=44;function uq(a){function b(m){d.contains(e)&&d.removeChild(e);l&&clearTimeout(l);delete uq.a[f];m&&a.Kj&&a.Kj.call(k,m)}if(!a.url||!a.eh)throw Error('Parameter "options" must specify at least a URL and a callback.');if("function"!==typeof a.eh)throw Error("Parameters options.callback must be a function");var c=a.Ap||document;var d=c.getElementsByTagName("head")[0];var e=c.createElement("script");c=a.url instanceof W?a.url:Ep(a.url,a.zp);var f=uq.b++;var g=a.jm||"callback";var h=a.eh;var k={};var l=
null;k.id=f;k.cancel=function(){b("cancelled")};0!==a.timeout&&(l=x.setTimeout(function(){b("timeout")},a.timeout||3E4));uq.a[f]=function(m){b();h.call(k,m)};e.type="text/javascript";e.src=c.toString()+(c.jk()?"&":"?")+g+"="+(a.Bp?"H.service.jsonp.handleResponse("+f+")":encodeURI("H.service.jsonp.handleResponse("+f+")"));d.appendChild(e);return k}t("H.service.jsonp",uq);uq.Yn=function(a){return(a=uq.a[a])?a:function(){}};uq.handleResponse=uq.Yn;uq.b=0;uq.a={};function iq(a){iq.l.constructor.call(this,iq,a);this.km=Qp(this,a).callbackKey}u(iq,Pp);t("H.service.traffic.Service",iq);iq.prototype.a=function(){return{subDomain:"traffic.ls",path:"traffic/6.1",callbackKey:"jsoncallback"}};iq.CONFIG_KEY="traffic";iq.prototype.yj=function(a,b){return new ll(new oq(this,void 0,a,b),{max:22})};iq.prototype.createFlowLayer=iq.prototype.yj;iq.prototype.zj=function(a){return new Bn(new hq(this,void 0,a))};iq.prototype.createIncidentsLayer=iq.prototype.zj;
function vq(a,b,c,d){return uq({url:b,eh:c,Kj:function(e){d(Error("["+e+"] "+b+" request failed"))},jm:a.km})}iq.prototype.Xo=function(a,b,c){a=this.D().clone().F("incidents.json").I(a);return vq(this,a,b,c)};iq.prototype.requestIncidents=iq.prototype.Xo;iq.prototype.Wo=function(a,b,c,d,e,f){a=this.D().clone().F(["flow/json",c,a,b].join("/")).I(f||{});return vq(this,a,d,e)};iq.prototype.requestFlowByTile=iq.prototype.Wo;
iq.prototype.Yo=function(a,b,c,d,e,f){a=this.D().clone().F(["incidents/json",c,a,b].join("/")).I(f||{});return vq(this,a,d,e)};iq.prototype.requestIncidentsByTile=iq.prototype.Yo;iq.prototype.he=function(a){return Np().F(a)};Y.prototype.dk=function(a){return this.Ya(iq,a)};Y.prototype.getTrafficService=Y.prototype.dk;function wq(a){wq.l.constructor.call(this,wq,a);this.ol=Qp(this,a).reverseSubDomain}u(wq,Pp);t("H.service.GeocodingService",wq);wq.prototype.a=function(){return{subDomain:"geocoder.ls",reverseSubDomain:"reverse",path:"6.2"}};wq.CONFIG_KEY="geocoding";wq.prototype.b=function(a){return Error(a.Details||a.message||a.error)};wq.prototype.rh=function(a,b,c){a=this.D().clone().F("geocode.json").I(a);return this.K(a,b,c)};wq.prototype.geocode=wq.prototype.rh;
wq.prototype.Bi=function(a,b,c){a=this.D().clone().F("reversegeocode.json").I(a);this.ol&&a.Ma(this.ol);return this.K(a,b,c)};wq.prototype.reverseGeocode=wq.prototype.Bi;wq.prototype.search=function(a,b,c){a=this.D().clone().F("search.json").I(a);return this.K(a,b,c)};wq.prototype.search=wq.prototype.search;Y.prototype.Ym=function(a){return this.Ya(wq,a)};Y.prototype.getGeocodingService=Y.prototype.Ym;function xq(a){xq.l.constructor.call(this,xq,a)}u(xq,Pp);t("H.service.PlacesService",xq);xq.prototype.a=function(){return{subDomain:"places.ls",path:"places/v1"}};xq.CONFIG_KEY="places";xq.EntryPoint={SEARCH:"discover/search",SUGGEST:"suggest",EXPLORE:"discover/explore",AROUND:"discover/around",HERE:"discover/here",CATEGORIES:"categories/places"};xq.prototype.request=function(a,b,c,d){return this.T(a,b,c,d)};
xq.prototype.T=function(a,b,c,d){a=this.D().clone().F(a).I(b||{});return this.K(a,c,d)};xq.prototype.search=function(a,b,c){return this.T("discover/search",a,b,c)};xq.prototype.search=xq.prototype.search;xq.prototype.ip=function(a,b,c){return this.T("suggest",a,b,c)};xq.prototype.suggest=xq.prototype.ip;xq.prototype.um=function(a,b,c){return this.T("discover/explore",a,b,c)};xq.prototype.explore=xq.prototype.um;xq.prototype.fm=function(a,b,c){return this.T("discover/around",a,b,c)};
xq.prototype.around=xq.prototype.fm;xq.prototype.$n=function(a,b,c){return this.T("discover/here",a,b,c)};xq.prototype.here=xq.prototype.$n;xq.prototype.lm=function(a,b,c){return this.T("categories/places",a,b,c)};xq.prototype.categories=xq.prototype.lm;xq.prototype.wm=function(a,b,c,d){a=Ep(a).I(this.D().getQuery()).I(d||{});return this.K(a,b,c)};xq.prototype.follow=xq.prototype.wm;Y.prototype.vn=function(a){return this.Ya(xq,a)};Y.prototype.getPlacesService=Y.prototype.vn;function yq(a){yq.l.constructor.call(this,yq,a);this.f=a.getToken}u(yq,Pp);t("H.service.iml.Service",yq);yq.prototype.a=function(){return{host:"interactive.data.api.platform.here.com",path:"interactive/v1/catalogs"}};
yq.prototype.b=function(a){function b(){for(var d=ea(c),e=d.next();!e.done;e=d.next()){e=e.value;var f=e.format;if(e.keys.every(function(g){return a[g]}))return f()}return JSON.stringify(a)}var c=[{keys:["code","title","cause","action"],format:function(){return a.code+": "+a.title+"; cause: "+a.cause+"; action: "+a.action}},{keys:["error","error_description"],format:function(){return a.error+": "+a.error_description}},{keys:["error","errorMessage"],format:function(){return a.error+": "+a.errorMessage}}];
return Error(Da(a)?b():a)};yq.prototype.fe=function(a,b,c,d,e){var f=this.fe;zq(f,0,a,b);Aq(f,2,c,d);a=this.D().clone().F(a+"/layers/"+b+"/statistics").I(e||{});return this.T(a,"GET",c,d)};yq.prototype.getStatistics=yq.prototype.fe;yq.prototype.$f=function(a,b,c,d,e,f,g,h,k){var l=k?"":".mvtf";a=this.D().clone().F(d+"/layers/"+e+"/tile/web/"+c+"_"+a+"_"+b+l).I(Object.assign({clip:!0},h));return this.T(a,"GET",k?f:function(m){return m.arrayBuffer().then(f)},g,void 0,k?"application/json":"arraybuffer")};
yq.prototype.getFeaturesByTile=yq.prototype.$f;yq.prototype.Sj=function(a,b,c,d,e,f){var g=this.Sj;Bq(g,a);zq(g,1,b,c);Aq(g,3,d,e);a=Cq(this,a,b,c,f);return this.T(a,"GET",d,e)};yq.prototype.getFeatureById=yq.prototype.Sj;yq.prototype.cd=function(a,b,c,d,e,f){var g=this.cd;Dq(g,a);zq(g,1,b,c);Aq(g,3,d,e);a=Eq(this,a,b,c,f);return this.T(a,"GET",d,e)};yq.prototype.getFeaturesById=yq.prototype.cd;
yq.prototype.Zd=function(a,b,c,d,e){var f=this.Zd;if(!Da(a)||!(a.bbox||a.north&&a.east&&a.south&&a.west))throw new D(f,0,'must be an object with either "bbox" or a full set of "north", "east", "south" and "west"');zq(f,1,b,c);Aq(f,3,d,e);a=this.D().clone().F(b+"/layers/"+c+"/bbox").I(a);return this.T(a,"GET",d,e)};yq.prototype.getFeaturesByBoundingBox=yq.prototype.Zd;
yq.prototype.Uj=function(a,b,c,d,e){var f=this.Uj;if(!(Da(a)&&a.radius&&(a.lat&&(a.lng||a.lon)||a.refCatalogHrn&&a.refLayerId&&a.refFeatureId)))throw new D(f,0,'must be an object with "radius" and a combination of either "lat"+"lng" or "refCatalogHrn"+"refLayerId"+"refFeatureId"');zq(f,1,b,c);Aq(f,3,d,e);a=this.D().clone().F(b+"/layers/"+c+"/spatial").I(a);return this.T(a,"GET",d,e)};yq.prototype.getFeaturesByPointAndRadius=yq.prototype.Uj;
yq.prototype.Tj=function(a,b,c,d,e,f){var g=this.Tj;if(!Da(a)||!a.radius)throw new D(g,0,'must be an object with "radius"');Fq(g,1,b);zq(g,2,c,d);Aq(g,4,e,f);a=this.D().clone().F(c+"/layers/"+d+"/spatial").I(a);return this.T(a,"POST",e,f,b)};yq.prototype.getFeaturesByGeometryAndRadius=yq.prototype.Tj;yq.prototype.pl=function(a,b,c,d,e){var f=this.pl;zq(f,0,a,b);Aq(f,2,c,d);a=this.D().clone().F(a+"/layers/"+b+"/search").I(e||{});return this.T(a,"GET",c,d)};yq.prototype.searchFeatures=yq.prototype.pl;
yq.prototype.uk=function(a,b,c,d,e){var f=this.uk;zq(f,0,a,b);Aq(f,2,c,d);a=this.D().clone().F(a+"/layers/"+b+"/iterate").I(e||{});return this.T(a,"GET",c,d)};yq.prototype.iterateFeatures=yq.prototype.uk;yq.prototype.kd=function(a,b,c,d,e,f){var g=this.kd;Fq(g,0,a);zq(g,1,b,c);Aq(g,3,d,e);b=Gq(this,b,c,f);return this.T(b,"PUT",d,e,a)};yq.prototype.putFeatures=yq.prototype.kd;
yq.prototype.hd=function(a,b,c,d,e,f){var g=this.hd;Fq(g,0,a);zq(g,1,b,c);Aq(g,3,d,e);b=Gq(this,b,c,f);return this.T(b,"POST",d,e,a)};yq.prototype.postFeatures=yq.prototype.hd;yq.prototype.sd=function(a,b,c,d,e){var f=this.sd;Dq(f,a);zq(f,1,b,c);Aq(f,3,d,e);a=Eq(this,a,b,c);return this.T(a,"DELETE",d,e)};yq.prototype.deleteFeatures=yq.prototype.sd;yq.prototype.fl=function(a,b,c,d,e,f,g){var h=this.fl;Bq(h,a);Fq(h,1,b);zq(h,2,c,d);Aq(h,4,e,f);a=Cq(this,a,c,d,g);return this.T(a,"PUT",e,f,b)};
yq.prototype.putFeature=yq.prototype.fl;yq.prototype.Zk=function(a,b,c,d,e,f,g){var h=this.Zk;Bq(h,a);Fq(h,1,b);zq(h,2,c,d);Aq(h,4,e,f);a=Cq(this,a,c,d,g);return this.T(a,"PATCH",e,f,b)};yq.prototype.patchFeature=yq.prototype.Zk;yq.prototype.Dj=function(a,b,c,d,e){var f=this.Dj;Bq(f,a);zq(f,1,b,c);Aq(f,3,d,e);a=Cq(this,a,b,c);return this.T(a,"DELETE",d,e,void 0,"text/plain")};yq.prototype.deleteFeature=yq.prototype.Dj;
function Gq(a,b,c,d){return a.D().clone().F(b+"/layers/"+c+"/features").I(d||{})}function Eq(a,b,c,d,e){b=Object.assign({},e,{id:new Ip(b)});return Gq(a,c,d,b)}function Cq(a,b,c,d,e){return a.D().clone().F(c+"/layers/"+d+"/features/"+b).I(e||{})}
yq.prototype.T=function(a,b,c,d,e,f){f=void 0===f?"application/json":f;b={method:b,headers:Object.assign({},e?{"Content-Type":"application/geo+json"}:void 0,"function"===typeof this.f?{Authorization:"Bearer "+this.f()}:void 0,this.gf)};e&&(b.data=JSON.stringify(e));e=new rf(f,a.toString(),fe,b);e.then(c,Rp(this,a,d));return e};yq.CONFIG_KEY="iml";function zq(a,b,c,d){wc(c,"String",a,b,"must be a string");wc(d,"String",a,b+1,"must be a string")}
function Bq(a,b){wc(b,"String",a,0,"must be a string")}function Dq(a,b){if(!Array.isArray(b)||0===b.length||b.some(function(c){return"string"!==typeof c}))throw new D(a,0,"must be a non-empty array of strings");}function Fq(a,b,c){if(!Da(c))throw new D(a,b,"must be a GeoJSON object");}function Aq(a,b,c,d){if(!Ca(c))throw new D(a,b,"must be a function");if(!Ca(d))throw new D(a,b+1,"must be a function");}Y.prototype.cn=function(a){return this.Ya(yq,a)};Y.prototype.getIMLService=Y.prototype.cn;function Hq(a,b,c,d){Hq.l.constructor.call(this,d?{min:d.min,max:d.max,engineType:d.engineType}:void 0);C(a,yq,Hq,0);if(!zc(b))throw new D(Hq,1,'"catalogHrn" must be a string');if(!zc(c))throw new D(Hq,2,'"layerId" must be a string');this.v=a;this.a=b;this.c=c;this.s=Da(d)&&Da(d.parameters)?d.parameters:{};this.ac(this.f===Vj.WEBGL?new Th({sources:{iml:{type:"MVT"}},layers:{iml:{data:{source:"iml",layer:this.a+":"+this.c},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",
size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#0258AE",width:"2px",join:"round",cap:"round"}}}}}}):new H.map.render.harp.Style({styles:[{layer:this.a+":"+this.c,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},
{layer:this.a+":"+this.c,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:"#E39E3C",renderOrder:201},{layer:this.a+":"+this.c,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",lineWidth:"1px",renderOrder:202},{layer:this.a+":"+this.c,when:["==",["geometry-type"],"LineString"],technique:"solid-line",color:"#0258AE",lineWidth:"2px",renderOrder:203}]}))}u(Hq,R);t("H.service.iml.Provider",Hq);
Hq.prototype.K=function(a,b,c,d,e){return this.v.$f(a,b,c,this.a,this.c,d,e,this.s)};Hq.prototype.requestInternal=Hq.prototype.K;Hq.prototype.Ed=df;Hq.prototype.providesOMV=Hq.prototype.Ed;Hq.prototype.ua=function(){return this.ub()};Hq.prototype.getStyle=Hq.prototype.ua;Hq.prototype.rc=function(a){C(a,Th)&&a.b("MVT");this.ac(a)};Hq.prototype.setStyle=Hq.prototype.rc;function Iq(a){Iq.l.constructor.call(this,Iq,a)}u(Iq,Pp);t("H.service.publicTransit.Service",Iq);Iq.prototype.a=function(){return{subDomain:"transit.router",path:"v8"}};Iq.CONFIG_KEY="publicTransit";Iq.prototype.Fn=function(a,b,c){a=this.D().clone().F("routes").I(a);return this.K(a,b,c)};Iq.prototype.getRoutes=Iq.prototype.Fn;Iq.prototype.Qm=function(a,b,c){a=this.D().clone().F("departures").I(a);return this.K(a,b,c)};Iq.prototype.getDepartures=Iq.prototype.Qm;
Iq.prototype.Jn=function(a,b,c){a=this.D().clone().F("stations").I(a);return this.K(a,b,c)};Iq.prototype.getStations=Iq.prototype.Jn;Iq.prototype.b=function(a){return Error(JSON.stringify(a))};Y.prototype.Bn=function(a){return this.Ya(Iq,a)};Y.prototype.getPublicTransitService=Y.prototype.Bn;function Jq(a){Jq.l.constructor.call(this,Jq,a)}u(Jq,Pp);t("H.service.RoutingService",Jq);Jq.prototype.a=function(){return{subDomain:"route.ls",path:"routing/7.2"}};Jq.prototype.b=function(a){return Error(a.details)};Jq.CONFIG_KEY="routing";Jq.prototype.Qd=function(a,b,c){a=this.D().clone().F("calculateroute.json").I(a);return this.K(a,b,c)};Jq.prototype.calculateRoute=Jq.prototype.Qd;
Jq.prototype.dh=function(a,b,c){a=this.D().clone().Ma("isoline").F("calculateisoline.json").I(a);return this.K(a,b,c)};Jq.prototype.calculateIsoline=Jq.prototype.dh;function Kq(a){Kq.l.constructor.call(this,Kq,a)}u(Kq,Pp);t("H.service.RoutingService8",Kq);Kq.CONFIG_KEY="routing_v8";Kq.prototype.a=function(){return{subDomain:"router",path:"v8/routes"}};Kq.prototype.b=function(a){return Error(a.error)};Kq.prototype.Qd=function(a,b,c){a=this.D().clone().I(a);return this.K(a,b,c)};Kq.prototype.calculateRoute=Kq.prototype.Qd;Kq.prototype.dh=function(a,b,c){a=this.D().clone().Ma("isoline").Md("v8/isolines").I(a);return this.K(a,b,c)};
Kq.prototype.calculateIsoline=Kq.prototype.dh;Y.prototype.bk=function(a,b){b=+b||7;if(7===b)b=Jq;else if(8===b)b=Kq;else throw new D(this.bk,1,"allowed values are 7 and 8");return this.Ya(b,a)};Y.prototype.getRoutingService=Y.prototype.bk;function Lq(){}t("H.service.extension.dataView.ITable",Lq);Lq.prototype.be=function(){};Lq.prototype.getMeta=Lq.prototype.be;Lq.prototype.ee=function(){};Lq.prototype.getRowCount=Lq.prototype.ee;Lq.prototype.Bc=function(){};Lq.prototype.getRow=Lq.prototype.Bc;Lq.prototype.Ua=function(){};Lq.prototype.getColumnNames=Lq.prototype.Ua;Lq.prototype.Ue=function(){};Lq.prototype.getColumn=Lq.prototype.Ue;Lq.prototype.xa=function(){};Lq.prototype.getCell=Lq.prototype.xa;Lq.prototype.concat=function(){};
Lq.prototype.concat=Lq.prototype.concat;function Mq(){}t("H.service.extension.dataView.IRow",Mq);Mq.prototype.Ua=function(){};Mq.prototype.getColumnNames=Mq.prototype.Ua;Mq.prototype.xa=function(){};Mq.prototype.getCell=Mq.prototype.xa;Mq.prototype.xd=function(){};Mq.prototype.getTable=Mq.prototype.xd;function Nq(a,b){this.a=a;this.b=b}t("H.service.extension.dataView.ObjRow",Nq);Nq.prototype.Ua=function(){return this.a.Ua()};Nq.prototype.getColumnNames=Nq.prototype.Ua;Nq.prototype.xa=function(a){return this.a.xa(this.b,a)};Nq.prototype.getCell=Nq.prototype.xa;Nq.prototype.xd=function(){return this.a};Nq.prototype.getTable=Nq.prototype.xd;function Oq(){}t("H.service.extension.dataView.IColumn",Oq);Oq.prototype.xa=function(){};Oq.prototype.getCell=Oq.prototype.xa;function Pq(a,b){this.b=a;this.a=b}t("H.service.extension.dataView.ObjColumn",Pq);Pq.prototype.xa=function(a){return this.b.xa(a,this.a)};Pq.prototype.getCell=Pq.prototype.xa;function Qq(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):B);this.Hb=a;if(b)for(this.Rd=b,this.gh=a=mc(),d=b.length;d--;)a[b[d]]=!0;c!==B&&(this.ji=c)}t("H.service.extension.dataView.ObjTable",Qq);n=Qq.prototype;n.ji=B;n.Hb=B;n.Rd=B;n.gh=B;n.be=function(){return this.ji};Qq.prototype.getMeta=Qq.prototype.be;Qq.prototype.ee=function(){return this.Hb?this.Hb.length:0};Qq.prototype.getRowCount=Qq.prototype.ee;Qq.prototype.Bc=function(a){var b=this.Hb;return b&&b[a]?new Nq(this,a):B};
Qq.prototype.getRow=Qq.prototype.Bc;Qq.prototype.Ua=function(){return this.Rd||ff};Qq.prototype.getColumnNames=Qq.prototype.Ua;Qq.prototype.Ue=function(a){return this.gh[a]?new Pq(this,a):B};Qq.prototype.getColumn=Qq.prototype.Ue;Qq.prototype.xa=function(a,b){var c=this.Hb;return(a=c&&this.gh[b]&&c[a])&&a[b]};Qq.prototype.getCell=Qq.prototype.xa;
Qq.prototype.concat=function(){var a=arguments.length,b,c=this.Rd,d=""+this.Rd,e=(this.Hb||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof Qq))throw new D(this.concat,b);if(f.Hb){if(c&&""+f.Rd!==d)throw new D(this.concat,b,"Incompatible columns!");e=e.concat(f.Hb)}}return new Qq(e,this.Rd,this.ji)};Qq.prototype.concat=Qq.prototype.concat;function Rq(a,b){a.Hb?a.Hb.push(b):a.Hb=[b];return a.Hb.length-1};function Sq(a){var b=Tq;if(!a||!zc(Ze(a.layerId,a.layer))||!Cc(a.level)||tc(a.rowFilter)&&!Ca(a.rowFilter)||tc(a.rowFilterContext)&&!Da(a.rowFilterContext))throw new D(b,1,tc("invalid layer config")?"invalid layer config":a);};function Uq(a,b,c,d){d=d||Vq;this.tf={};d.provider=a;this.invalidate=ef;Uq.l.constructor.call(this,b,d);delete this.invalidate;c&&(this.b=c);this.wa(Mg.ADD)}u(Uq,bh);t("H.service.remote.Spatial",Uq);var Vq={};Uq.prototype.gb=function(){return this.b||bh.prototype.gb.call(this)};Uq.prototype.getId=Uq.prototype.gb;Uq.prototype.Dg=Function();Uq.prototype.retain=Uq.prototype.Dg;Uq.prototype.release=Function();Uq.prototype.release=Uq.prototype.release;function Wq(a,b){this.a=a;b&&(this.b=b)}
var Xq=new Wq([]);Uq.prototype.$d=function(a){return(this.tf[a.key]||Xq).a};Uq.prototype.getGeometriesForTile=Uq.prototype.$d;Uq.prototype.zh=function(a){return(this.tf[a.key]||Xq).b};Uq.prototype.getLabels=Uq.prototype.zh;function Yq(a,b,c){a.tf[b.key]=new Wq(c,void 0)};function Zq(a,b,c,d,e,f){$q(Zq,1,b,c);$q(Zq,2,d,e);(this.f=a.length)?(this.s=a,this.aa=b,this.i=c,this.b=0,this.c=A(this.c,this),this.o=d,this.j=e,this.a=mc(),Wa(this.a,ar,f||{}),this.g={},x.setTimeout(this.c,0)):b(ff,!0)}var ar={duration:100,Am:"geometry",zm:"WKT",Zo:"searchAttributes",Cj:B};
Zq.prototype.c=function(){var a=[];var b=!1;for(var c=zk(),d;this.b<this.f;){var e=this.s[this.b];b=e.attributes;d=e.layerId||this.a.Cj;e.distance&&(b[this.a.Zo]={nearest:new Wf(e.nearestLat,e.nearestLon),distance:e.distance});if(e=e[this.a.Am]){try{var f=Fn(new $n(e))}catch(g){this.i(new x.Error(g.message));b=!0;break}b[this.a.zm]=f}(e=this.g[d])||(e=this.g[d]=this.o({layerId:d,columnNames:Object.keys(b)}));b=this.j(e,b);a.push(b);this.b++;if((b=this.b===this.f)||zk()-c>=this.a.duration){this.aa(a,
b);break}}b?this.g=y:this.m=x.setTimeout(this.c,0)};Zq.prototype.cancel=function(){x.clearTimeout(this.m);this.b<this.f&&this.i(new x.Error("parsing canceled"))};Zq.prototype.cancel=Zq.prototype.cancel;function $q(a,b,c,d){if(!Ca(c))throw new D(a,b,"has invalid type");if(!Ca(d))throw new D(a,b+1,"has invalid type");};function br(a,b,c){var d=8===a;this.b=b;this.c=c||hd;(this.a=4===a||d)?this.j=d:this.g=1===a;this.f=this.a?"$HProjGeometry":"geometry"}
br.prototype.parse=function(a,b,c){var d,e,f={},g=[],h,k;var l=0;for(h=c.length;l<h;l++){var m=c[l];var p=m.Rows;if(m=p.length){var q=Object.keys(p[0]).filter(function(v){return"geometry"!==v&&"$HProjGeometry"!==v});q=new Qq(p,q);for(k=0;k<m;k++){var r=p[k];if(e=r[this.f]){if(delete r[this.f],r=q.Bc(k))try{this.a?d=cr(this,a,b,r,e):d=dr(this,a,r,e.path),d.ka(a),g.push(d)}catch(v){this.c(v.message)}}else this.c("Layer must contain geometries")}}}f[this.a?"spatials":this.g?"markers":"domMarkers"]=
g;return f};function cr(a,b,c,d,e){var f=[],g=e.paths,h=g.length,k=0,l=a.b&&a.b(d);for(a=new Uq(b,a.j,B,{style:l||a.i,data:d});k!==h;)f.push(er(g[k++]));Yq(a,c,[new rh(f,e.interiorsIndex,e.outlinesIndex)]);return a}function dr(a,b,c,d){d=new Wf(d[0],d[1]);var e=a.b&&a.b(c);a.g?(a={icon:e,data:c,provider:b},a=new yn(d,a)):(a={icon:e,data:c,provider:b},a=new Qi(d,a));return a}function er(a){for(var b=0,c=a.length,d=[];b<c;)d.push(new I(a[b++],a[b++]));return d};function fr(a){a=a||{};var b=a.tileCacheSize||1024,c=a.resultType,d=a.styleCallback;tc(a.min)||(a.min=12);fr.l.constructor.call(this,a);if(-1===gr.indexOf(c))throw new D(fr,2,"invalid resultType");this.a=c;if(d&&!Ca(d))throw new D(fr,2,"invalid style callback");this.Aa=d;this.W=a.pixelRatio||Se();this.Lb=A(this.Lb,this);this.O(new Dk(b,A(this.dc,this)));this.createTileInternal=4===c||8===c?A(this.N,this):A(this.J,this)}u(fr,R);t("H.service.extension.TileProvider",fr);fr.prototype.c=!1;
fr.prototype.getCapabilities=function(){return fr.l.getCapabilities.call(this)|Cj.CROP_LINES_BY_TILE|Cj.CROP_POLYGONS_BY_TILE};fr.prototype.jb=function(a,b,c,d){return this.c?fr.l.jb.call(this,a,b,c,d):B};fr.prototype.requestTile=fr.prototype.jb;fr.prototype.Lb=function(a){this.dispatchEvent(new td("error",zc(a)?a:a+"",this))};fr.prototype.Wb=function(){return 1===this.a};fr.prototype.providesMarkers=fr.prototype.Wb;fr.prototype.Vb=function(){return 2===this.a};fr.prototype.providesDomMarkers=fr.prototype.Vb;
fr.prototype.Jc=function(){return 4===this.a||8===this.a};fr.prototype.providesSpatials=fr.prototype.Jc;function hr(a){var b=a.yb;b||(a.v||(a.v=a.s(a.a,a.Aa,a.Lb)),b=a.yb=new kq(a.v),b.ka(a),b.addEventListener(a.i.Ea,A(a.kb,a)),b.yb=!0);return b}
fr.prototype.J=function(a,b,c,d){var e=this.getTileKey(a,b,c);e=this.Ob().get(e);var f=2==this.a,g=[],h=hr(this);e?e.valid=!0:(a=e=new Lk(a,b,c,y),delete a.j,a.m=d);d=f?mq(h,e,"domMarkers"):mq(h,e,"markers");for(b=d.length;b--;)a=d[b],a.aj=e,(f||1===a.Cb().getState())&&g.push(a);e.data=g;return e};fr.prototype.kb=function(a){if(a=a.target.aj)a.valid=!1};fr.prototype.cp=function(a){this.C=!!a};fr.prototype.setTileCanvasRendering=fr.prototype.cp;fr.prototype.C=!0;
fr.prototype.N=function(a,b,c,d){var e=hr(this),f=this.getTileKey(a,b,c),g=this.tileSize,h=this.Ob().get(f);h||(a=h=new Pk(f,a,b,c,g,this.W,c,e),delete a.j,a.m=d);this.C?(d=Mp.pop(g),h.V(d)||Mp.push(d,g)):Vk(h);return h};fr.prototype.dc=function(a,b){var c;if(4===this.a||8===this.a){a=b.Va();for(c=a.length;c--;)delete a[c].tf[b.key];b.data&&(Mp.push(b.xg(),this.tileSize),b.yg())}else for(a=b.data,c=a.length;c--;)delete a[c].aj};fr.prototype.u=function(){fr.l.u.call(this);hr(this).B()};
var ir={MARKER:1,DOM_MARKER:2,POLYLINE:4,POLYGON:8};fr.ResultType=ir;var gr=[1,2,4,8];function Tq(a,b,c){var d=this,e=b&&b.rowFilter,f=c.resultType;Tq.l.constructor.call(this,c);C(a,jr,Tq,0);Sq(b);e?(c=Ua(b),c.rowFilter=e.toString()):c=Ua(b);delete c.layer;c.layerId=Ze(b.layerId,b.layer);(new Mf).a("pde","H.service.extension.worker.processor");a=a.D().clone().F(kr+"."+lr).I({meta:1});(new Pf("pde",{message:[this.uid,0,{tileSize:this.tileSize,projected:!0,onlyOutline:4===f,serverUrl:a.toString(),layerConfigs:[c],horizontalMargin:1}]})).then(function(){d.c=!0;Wj(d)},this.Lb)}
u(Tq,fr);t("H.service.extension.platformData.TileProvider",Tq);Tq.prototype.s=function(a,b,c){a=new br(a,b,c);a.i=mr;return a};var mr=new Ug({strokeColor:"transparent",fillColor:"transparent",lineWidth:0,lineJoin:"round",lineCap:"round"});
Tq.prototype.K=function(a,b,c,d,e){var f=this,g=this.getTileKey(a,b,c),h;g=this.Ob().get(g);var k={cancel:hd},l=!0,m=this.a;g&&(4===m||8===m?g.le()||(d(Mp.pop(this.tileSize),null),l=!1):(d(y),l=!1));if(l){var p=Kp.setTimeout(function(){h=new Pf("pde",{message:[f.uid,1,[a,b,c]]});h.then(d,e)},500);k.cancel=function(){h?h.cancel():Kp.clearTimeout(p)}}return k};Tq.prototype.requestInternal=Tq.prototype.K;Tq.prototype.u=function(){Tq.l.u.call(this);new Pf("pde",{message:[this.uid,3]})};
Tq.ResultType=ir;function nr(a){this.a=a}nr.prototype.cancel=function(){for(var a=this.a,b=a.length;b--;)a[b].cancel();a.length=0};function jr(a){jr.l.constructor.call(this,jr,a)}u(jr,Pp);t("H.service.extension.platformData.Service",jr);jr.prototype.a=function(){return{subDomain:"s.fleet.ls",path:"1"}};jr.CONFIG_KEY="platformData";jr.prototype.request=function(a,b,c,d,e){return this.T(a,b,c,d,e)};
jr.prototype.T=function(a,b,c,d,e){var f="text/plain";if(!a)throw new D(this.request,0,a);if(!b)throw new D(this.request,1,b);if(!d)throw new D(this.request,3,d);if(!e)throw new D(this.request,4,e);a=this.D().clone().F(a+"."+b).I(c);b===or.JSON&&(f="application/json");return this.K(a,d,e,f)};var kr="tiles";
jr.EntryPoint={DOC_ATTRIBUTES:"doc/attributes",DOC_LAYER:"doc/layer",DOC_LAYERS:"doc/layers",DOC_MAPS:"doc/maps",DOC_INDEXES:"doc/indexes",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SERVICE_CONFIGURATION:"serviceconfiguration",STATIC:"static",TILE:"tile",TILES:kr,FILE:"file",INDEX:"index"};var lr="json",or={TXT:"txt",JSON:lr,HTML:"html",BIN:"bin"};jr.EntryPointType=or;
jr.prototype.wc=function(a,b){var c=b&&b.resultType;a=new Tq(this,a,b);var d;1==c||2===c?d=new Bn(a):d=new ll(a);return d};jr.prototype.createTileLayer=jr.prototype.wc;jr.prototype.Jd=function(a,b,c,d){var e=[],f,g=b.layer_id||b.layer_ids;a=this.request(a,lr,b,function(h){f=new Zq(h.geometries,c,d,function(k){return new Qq([],k.columnNames,k)},function(k,l){return k.Bc(Rq(k,l))},{Cj:g});e.push(f)},function(h){d(new x.Error(h))});e.push(a);return new nr(e)};
function pr(a,b,c){if(!yc(a))throw new D(c,0,"has invalid type");if(!yc(b))throw new D(c,1,"has invalid type");if(a.length!==b.length||!a.length)throw new D(c,1,"specify one key attribute for each given layer id in the same order");}
jr.prototype.Mc=function(a,b,c,d,e,f){function g(l,m){m&&h--;d(l,!h)}var h,k=[];pr(a,b,this.Mc);$q(this.Mc,3,d,e);C(c,K,this.Mc,2);c={bbox:c.la+","+c.ca+";"+c.na+","+c.ia};f&&Wa(c,f);a=c.layer_id?[c.layer_id]:a;f=0;for(h=a.length;f<h;f++)c.layer_id=a[f],c.key_attribute=b[f],k.push(this.Jd("search/bbox",c,g,e));return new nr(k)};jr.prototype.searchByBoundingBox=jr.prototype.Mc;
jr.prototype.Yb=function(a,b,c,d,e,f,g){pr(a,b,this.Yb);C(c,Wf,this.Yb,2,"has invalid type");if(!Cc(d))throw new D(this.Yb,3,"has invalid type");$q(this.Yb,4,e,f);a={layer_ids:a.join(","),key_attributes:b.join(","),proximity:c.lat+","+c.lng+","+d};g&&Wa(a,g);return this.Jd("search/proximity",a,e,f)};jr.prototype.searchByProximity=jr.prototype.Yb;
jr.prototype.Xb=function(a,b,c,d,e,f,g){var h="";pr(a,b,this.Xb);if(!zc(c)&&!C(c,L))throw new D(this.Xb,1,"has invalid type");if(!Cc(d))throw new D(this.Xb,2,"has invalid type");$q(this.Xb,4,e,f);a={layer_ids:a.join(","),key_attributes:b.join(","),radius:d};if(zc(c))a.route_id=c;else{d=c.Y;c=0;for(b=d.length;c<b;c+=3)h+=d[c]+","+d[c+1],c<b-3&&(h+=";");a.corridor=h}g&&Wa(a,g);return this.Jd("search/corridor",a,e,f)};jr.prototype.searchByCorridor=jr.prototype.Xb;
Y.prototype.wn=function(a){return this.Ya(jr,a)};Y.prototype.getPlatformDataService=Y.prototype.wn;function qr(a){qr.l.constructor.call(this,qr,a)}u(qr,Pp);t("H.service.extension.geofencing.Service",qr);qr.prototype.a=function(){return{subDomain:"fleet.ls",path:"2"}};qr.CONFIG_KEY="geofencing";qr.prototype.request=function(a,b,c,d){return this.T(a,b,c,d)};qr.prototype.b=function(a){return Error(a.issues&&a.issues.length?a.issues.map(function(b){return b.message}).join(". "):a.message||a.response_code)};
qr.prototype.T=function(a,b,c,d){if(!a)throw new D(this.request,0,a);if(!Ca(c))throw new TypeError("onResult must be a function");if(!Ca(d))throw new TypeError("onError must be a function");a=this.D().clone().F(a+".json").I(b);return this.K(a,c,d)};qr.EntryPoint={SEARCH_PROXIMITY:"search/proximity"};Y.prototype.Zm=function(a){return this.Ya(qr,a)};Y.prototype.getGeofencingService=Y.prototype.Zm;t("H.service.extension.customLocation.Permission",{READ:"read",WRITE:"write",EXPORT:"export"});t("H.service.extension.customLocation.Storage",{READONLY:"readonly",UPDATABLE:"updatable"});function rr(a){var b=sr;if(!a||!zc(a.layerId)||tc(a.rowFilter)&&!Ca(a.rowFilter)||tc(a.rowFilterContext)&&!Da(a.rowFilterContext))throw new D(b,1,tc("invalid layer config")?"invalid layer config":a);}function tr(a){return zc(a)&&/^[A-Z][A-Z0-9_]*$/.test(a)}function ur(a){for(var b=a&&a.length,c=2<=b&&"WKT"===a[--b]&&"GEOMETRY_ID"===a[--b];c&&b--;)c=tr(a[b]);return c}
function vr(a,b){var c="",d,e,f=[];if(!b){var g={};f=[];if(a.geometries)for(e=0;e<a.geometries.length;e++)b=a.geometries[e],g[b.layerId]||(g[b.layerId]=[]),g[b.layerId].push(b);for(d in g)f.push({layerId:d,geometries:g[d]});for(d=0;d<f.length;d++)c+=vr(f[d],f[d].layerId)}else if(a.geometries&&a.geometries.length)for(e=Object.keys(a.geometries[0].attributes),c=c+("Meta:\t"+b+"\n")+e.join("\t"),c+="\tWKT\n",d=0;d<a.geometries.length;d++){var h=a.geometries[d].attributes;g=a.geometries[d].geometry;for(b=
0;b<e.length;b++)f.push(h[e[b]]);c+=f.join("\t");c+="\t"+g+"\n";f=[]}return c};function sr(a,b,c){var d=this,e=b&&b.rowFilter,f;sr.l.constructor.call(this,c);C(a,wr,sr,0);var g=c.resultType;rr(b);if(e){var h=Ua(b);h.rowFilter=e.toString()}else h=b;(new Mf).a("cle","H.service.extension.worker.processor");var k=b.layerId;a.request(xr,yr,{detail_level:"all",layer_id:k},function(l){l=l.layers;var m;for(m=0;m<l.length;m++)if(l[m].layerId===k){h.level=l[m].level;break}f=a.D().clone().F(zr+"."+yr).I({meta:1});(new Pf("cle",{message:[d.uid,0,{tileSize:d.tileSize,projected:!0,onlyOutline:4===
g,serverUrl:f.toString(),layerConfigs:[h],batchTiles:!1,horizontalMargin:1}]})).then(function(){d.c=!0;Wj(d)},d.Lb)},function(l){d.Lb(l.message)})}u(sr,fr);t("H.service.extension.customLocation.TileProvider",sr);sr.prototype.s=function(a,b,c){return new br(a,b,c)};
sr.prototype.K=function(a,b,c,d,e){var f=this,g=this.getTileKey(a,b,c),h;g=this.Ob().get(g);var k={cancel:hd},l=!0,m=this.a;g&&(4===m||8===m?g.le()||(d(Mp.pop(this.tileSize),null),l=!1):(d(y),l=!1));if(l){var p=Kp.setTimeout(function(){h=new Pf("cle",{message:[f.uid,1,[a,b,c]]});h.then(d,e)},500);k.cancel=function(){h?h.cancel():Kp.clearTimeout(p)}}return k};sr.prototype.requestInternal=sr.prototype.K;sr.prototype.u=function(){sr.l.u.call(this);new Pf("cle",{message:[this.uid,3]})};function Ar(){if(Br)throw new Xc(Ar);}t("H.service.extension.customLocation.Table",Ar);var Br=!0;function Cr(a,b){var c;Br=!1;var d=new Ar;Br=!0;d.c=pc(x.JSON.parse(x.JSON.stringify(a)));a=a.columnNames;var e=mc();for(c=a.length;c--;)e[a[c]]=c;d.f=e;d.b=a.length;if(b){if(b.length%a.length)throw new D(Cr,1,"Invalid number of cells");}else b=[];d.a=b;return d}Ar.prototype.be=function(){return this.c};Ar.prototype.getMeta=Ar.prototype.be;Ar.prototype.ee=function(){return this.a.length/this.b};
Ar.prototype.getRowCount=Ar.prototype.ee;Ar.prototype.Bc=function(a){return a<this.a.length/this.b?new Dr(this,a):B};Ar.prototype.getRow=Ar.prototype.Bc;Ar.prototype.Gn=function(){var a=this.a.length/this.b,b,c=new x.Array(a);for(b=0;b<a;b++)c[b]=new Dr(this,b);return c};Ar.prototype.getRows=Ar.prototype.Gn;Ar.prototype.Wg=function(a){var b=this.b,c=this.a,d=c.length/this.b;if(!a||a.length%b)throw new D(this.Wg,0,"Invalid number of cells");this.a=c.concat(a);return d};Ar.prototype.addCells=Ar.prototype.Wg;
Ar.prototype.cm=function(){for(var a=this.b,b=this.a,c=this.a.length/this.b;a--;)b.push(y);return this.Bc(c)};Ar.prototype.addRow=Ar.prototype.cm;Ar.prototype.Ua=function(){return this.c.columnNames};Ar.prototype.getColumnNames=Ar.prototype.Ua;Ar.prototype.Ue=function(a){return this.f[a]===B?B:new Er(this,a)};Ar.prototype.getColumn=Ar.prototype.Ue;Ar.prototype.xa=function(a,b){return this.a[a*this.b+this.f[b]]};Ar.prototype.getCell=Ar.prototype.xa;
Ar.prototype.Nc=function(a,b,c){b=this.f[b];if(a>=this.a.length/this.b)throw new D(this.Nc,0,"Row index out of bounds");if(b===B)throw new D(this.Nc,0,"Column unknown");this.a[a*this.b+b]=c};Ar.prototype.setCell=Ar.prototype.Nc;
Ar.prototype.concat=function(a){var b=arguments.length,c,d=""+this.Ua(),e=this.a?this.a.slice():[];for(c=0;c<b;c++){var f=arguments[c];if(!(f instanceof Ar))throw new D(this.concat,c);if(""+f.Ua()!==d)throw new D(this.concat,c,"Incompatible columns!");f.a&&(e=e.concat(f.a))}return Cr(this.c,e)};Ar.prototype.concat=Ar.prototype.concat;var Fr=/(\n|\t|\r|")/;
Ar.prototype.Xi=function(a,b){var c,d=this.b,e=this.Ua(),f=[],g=[],h=this.a,k=-1;for(c=0;c<d;c++)if(!a||a.test(e[c]))"WKT"===e[c]&&(k=f.length),f.push(c);if(!(a=f.length))throw new D(this.Xi,1,"No columns filtered");Gr(this,g,e,0,d,f,a,k);if(b){var l=b.length;for(c=0;c<l;c++)g.push("\n"),e=b[c],Gr(this,g,h,e,d,f,a,k)}else for(l=this.ee(),e=0;e<l;e++)g.push("\n"),Gr(this,g,h,e,d,f,a,k);return g.join("")};
function Gr(a,b,c,d,e,f,g,h){var k;for(k=0;k<g;k++){k&&b.push("\t");var l=c[d*e+f[k]];if(k!==h){if(l!==y){l=String(l);if(Fr.test(l))throw new D(a.Xi,0,'Invalid character (\\n, \\r, \\t, or ") in row '+d+" column "+a.c.columnNames[f[k]]);b.push(l)}}else b.push(l)}}function Er(a,b){this.b=a;this.a=b}Ar.Column=Er;Er.prototype.xa=function(a){return this.b.xa(a,this.a)};Er.prototype.getCell=Er.prototype.xa;Er.prototype.Nc=function(a,b){this.b.Nc(a,this.a,b)};Er.prototype.setCell=Er.prototype.Nc;
function Dr(a,b){this.a=a;this.gi=b}Ar.Row=Dr;Dr.prototype.Ua=function(){return this.a.Ua()};Dr.prototype.getColumnNames=Dr.prototype.Ua;Dr.prototype.xa=function(a){return this.a.xa(this.gi,a)};Dr.prototype.getCell=Dr.prototype.xa;Dr.prototype.Nc=function(a,b){this.a.Nc(this.gi,a,b)};Dr.prototype.setCell=Dr.prototype.Nc;Dr.prototype.xd=function(){return this.a};Dr.prototype.getTable=Dr.prototype.xd;function Hr(a){if(a===B)a="\t";else if(!/^[^"\r\n]$/.test(a))throw new D(Hr,0);this.b=String(a).charCodeAt(0);this.hi=A(this.hi,this);this.A=Ir}var Ir=0;n=Hr.prototype;n.getState=function(){return this.A};function Jr(a,b,c){var d=a.A;if(d!==b)throw 1===d&&(a.A=Ir),new Xc(c,"Requires state: "+["READY","PARSE","PAUSE"][b]+" but found "+["READY","PARSE","PAUSE"][d]);}n.abort=function(){Jr(this,2,Hr.prototype.abort);this.A=Ir};
n.hi=function(a){this.A=Ir;throw new D(Hr.prototype.parse,0,"Malformed DSV at row "+this.a.j+" column "+this.a.b+": "+a);};function Kr(a,b){var c=[];a.parse(b,function(d,e,f){1>d&&(c[e]=f);return 0<d});a.A=Ir;return c}n.parse=function(a,b,c){Jr(this,Ir,Hr.prototype.parse);a=a.trim();this.a=new Lr(a,this.b,this.hi);this.c=b;this.Ok=c||ef;this.A=2;this.resume()};n.Ok=ef;
n.resume=function(){var a=this.a,b=[];Jr(this,2,Hr.prototype.resume);this.A=1;do{if(!a.g){this.A=Ir;break}if(e>a.b){if(void 0!==c&&c!==e){this.a.a("The number of columns must be the same for all rows");return}var c=e}var d=a.j;var e=a.b;var f=a.Nf;var g=this.Ok(d,e,a);if(a.Nf>f)for(;-1!==a.next(););else{for(;-1!==(f=a.next());)b.push(f);g=String.fromCharCode.apply(y,b);b.length=0}Mr(a);this.c(d,e,g)&&(this.A=a.g?2:Ir)}while(1===this.A);2!=this.A&&void 0!==c&&0<e&&c!==e&&this.a.a("The number of columns must be the same for all rows")};
function Lr(a,b,c){this.c=new $n(a);this.m=b;this.g=!0;this.Nf=this.j=this.b=0;Mr(this);this.a=c;this.f=[];this.i=!1}n=Lr.prototype;n.Nf=0;function Mr(a){var b=a.c.Tb();a.o=!1;(a.aa=34===b)&&a.c.next()}function Nr(a,b){var c=a.c;a.o=!0;switch(b){case a.m:a.b++;break;case 13:c.next(),10!==c.Tb()&&a.a("CR without LF");case 10:a.b=0;a.j++;break;case -1:a.g=!1;break;default:a.a("End of field expected")}c.next();return-1}
n.Tb=function(){if(this.o)var a=-1;else{var b=this.c;a=b.Tb();if(this.aa)switch(a){case 34:b.next();a=b.Tb();34!==a&&(a=Nr(this,a));break;case -1:this.a("Closing quotation mark expected")}else switch(a){case 34:this.a("Unexpected quotation mark");case this.m:case 13:case 10:case -1:a=Nr(this,a)}}return a};n.ze=function(){this.i=!0;this.f=[]};n.Ud=function(){var a=this.f.slice();this.i=!1;this.f=[];return a};n.next=function(){var a=this.Tb();-1!==a&&this.c.next();this.i&&this.f.push(a);this.Nf++;return a};function Or(a,b,c,d){d=d||{};if(!b)throw new D(Or,1,"has to be a function");if(!c)throw new D(Or,2,"has to be a function");this.c=b;this.g=c;this.a=[];this.i=d.duration||Pr;this.b=A(this.b,this);this.f={};a=a.split("Meta:\t").slice(1);for(b=0;b<a.length;b++){d=a[b].split("\n");c=d[0].split("\t")[0];d=d.slice(1).join("\n");this.Td[c]=new Hr;this.fi[c]=Kr(this.Td[c],d);var e={layerId:c,columnNames:this.fi[c]};this.Th.push(c);this.f[c]=Cr(e);this.Rc[c]=zk();Qr(this,d,c);this.b(c)}}var Pr=100;n=Or.prototype;
n.fi={};n.Th=[];n.Td={};n.Rc={};n.Wi={};function Qr(a,b,c){var d=[],e=a.fi[c].length-1,f=a.f[c];try{a.Td[c].parse(b,function(g,h,k){var l=!1;0<g&&(d[h]=k,h===e&&(a.a.push(f.Bc(f.Wg(d))),zk()-a.Rc[c]>a.i&&(l=!0)));return l},function(g,h,k){if(0<g&&h===e)return Fn(k)})}catch(g){a.g(g)}}n.cancel=function(){for(var a in this.Wi)x.clearTimeout(this.Wi[a])};Or.prototype.cancel=Or.prototype.cancel;
Or.prototype.b=function(a){var b=this,c,d;this.Wi[a]=x.setTimeout(function(){if(2===b.Td[a].getState())b.Rc[a]=zk(),b.c(b.a,!1),b.a=[],b.Td[a].resume(),b.b(a);else{c=!0;for(d=0;d<b.Th.length;d++)if(b.Td[b.Th[d]].getState()!==Ir){c=!1;break}c&&(0<b.a.length&&b.c(b.a,!0),b.a=[])}},0)};function wr(a){wr.l.constructor.call(this,wr,a)}u(wr,Pp);t("H.service.extension.customLocation.Service",wr);wr.prototype.a=function(){return{subDomain:"fleet.ls",path:"2"}};wr.CONFIG_KEY="customLocation";wr.prototype.wc=function(a,b){var c=b&&b.resultType;a=new sr(this,a,b);var d;1===c||2===c?d=new Bn(a):d=new ll(a);return d};wr.prototype.createTileLayer=wr.prototype.wc;
function Rr(a,b,c,d){var e;a=a===Sr?"changes":"file";var f=b[a],g=zc(f),h=!g&&C(f,Blob);if(!g&&!h)throw new D(d,0,"Invalid "+a+" parameter");if(Tr)h?e=f:e=nf(f,"text/plain"),d=new x.FormData,d.append(a,e,e.name||a+".wkt"),c.method="POST",c.data=d,delete b[a];else if(h)throw new D(d,0,"Sending Blob data is not supported by the browser");}var Tr=x.FormData&&!!x.FormData.prototype.append;wr.prototype.request=function(a,b,c,d,e){return this.T(a,b,c,d,e)};
wr.prototype.T=function(a,b,c,d,e){var f="text/plain",g=a===Ur.LAYERS_UPLOAD||a===Ur.LAYERS_MODIFY||a===Ur.LAYERS_IMPORT,h=c,k={data:B,method:"GET",headers:this.gf};if(!a)throw new D(this.request,0,a);if(!b)throw new D(this.request,1,b);$q(this.request,3,d,e);g&&(C(c,Object,this.request,2,"Invalid request parameters"),h=Ua(c),Rr(a,h,k,this.request));var l=this.D().clone().F(a+"."+b).I(h);b===Vr.JSON&&(f="application/json");a=new rf(f,l.toString(),fe,k);a.then(function(m){var p=m.issues;p&&m.error_id&&
m.response_code?e(Error(p[0].message)):d(m)},function(m){"error"===m.type||404===m.status?e(Error(m.statusText||"Unable to load data")):m.json().then(function(p){e(Error("["+p.issues[0].message+"] "+l+" request failed"))},function(){e(Error("["+m.statusText+"] "+l+" request failed"))})});return a};
var xr="layers/list",Sr="layers/modify",zr="tiled/tile",Ur={LAYERS_DELETE:"layers/delete",LAYERS_GRANT:"layers/access/grant",LAYERS_LIST:xr,LAYERS_MODIFY:Sr,LAYERS_UPLOAD:"layers/upload",LAYERS_IMPORT:"layers/import",SEARCH_ALL:"search/all",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SEARCH_TILE:zr};wr.EntryPoint=Ur;var yr="json",Vr={TXT:"txt",JSON:yr};wr.EntryPointType=Vr;
wr.prototype.tb=function(a,b,c){var d=this;return this.request("search/all","txt",{filter:'WKT==""',layer_id:a},function(e){var f=e.replace(/[\r\n]+$/g,"").split("\t");d.request(xr,yr,{layer_id:a,detail_level:"all"},function(g){g=g.layers[0];g.columnNames=f;b(Cr(g))},c)},c)};wr.prototype.getLayer=wr.prototype.tb;
wr.prototype.hk=function(a,b,c,d){function e(){return++g<f?h.request("layers/access/grant",yr,{layer_id:a,granted_app_id:b[g].grantedAppId,permissions:b[g].permissions.join(",")},e,d):h.tb(a,c,d)}var f=b&&b.length,g=-1,h=this;return e()};wr.prototype.grantAccess=wr.prototype.hk;wr.prototype.Ej=function(a,b,c){return this.request("layers/delete",yr,{layer_ids:a},b,c)};wr.prototype.deleteLayer=wr.prototype.Ej;
wr.prototype.qd=function(a,b,c){function d(){setTimeout(function(){k.tb(g,function(q){setTimeout(e.bind(null,q),m)},function(){64E3>l?(l+=m,d()):c(x.Error("Timeout"))})},m);m*=2}function e(q){var r=JSON.stringify(q.Ua()),v=a.grants;if(r!==JSON.stringify(h)){var w="Results into different column names on the backend: "+r;setTimeout(function(){k.Ej(g,function(){c(x.Error(w))},function(z){c(x.Error(w+". "+z.message))})},m)}else v&&v.length?k.hk(g,v,b,c):b(q)}var f,g,h,k=this,l=0,m=1E3;var p=!a||!tr(g=
a.layerId)&&(f="layerId")||!ur(h=a.columnNames)&&(f="columnNames")?0:Ca(b)?Ca(c)?-1:2:1;if(0<=p)throw new D(k.qd,p,f||arguments[p]);return k.tb(g,function(){c(x.Error("Layer exists already"))},function(){var q={layer_id:g,file:h.join("\t")},r=a.level,v=a.storage;r!==B&&(q.level=r);v!==B&&(q.storage=v);k.request("layers/upload",yr,q,d,c)})};wr.prototype.createLayer=wr.prototype.qd;
wr.prototype.Jd=function(a,b,c,d){var e=[],f;a=this.request(a,yr,b,function(g){g.geometries.length?(g=vr(g,b.layer_id),f=new Or(g,c,d),e.push(f)):c(ff,!0)},d);e.push(a);return new nr(e)};wr.prototype.Yb=function(a,b,c,d,e,f){if(!yc(a))throw new D(this.Yb,0,"has invalid type");C(b,Wf,this.Yb,1,"has invalid type");if(!Cc(c))throw new D(this.Yb,2,"has invalid type");$q(this.Yb,3,d,e);a={layer_ids:a.join(","),proximity:b.lat+","+b.lng+","+c};f&&Wa(a,f);return this.Jd("search/proximity",a,d,e)};
wr.prototype.searchByProximity=wr.prototype.Yb;wr.prototype.Xb=function(a,b,c,d,e,f){var g="";if(!yc(a))throw new D(this.Xb,0,"has invalid type");if(!zc(b)&&!C(b,L))throw new D(this.Xb,1,"has invalid type");if(!Cc(c))throw new D(this.Xb,2,"has invalid type");$q(this.Xb,3,d,e);a={layer_ids:a.join(","),radius:c};if(zc(b))a.route_id=b;else{var h=b.Y;b=0;for(c=h.length;b<c;b+=3)g+=h[b]+","+h[b+1],b<c-3&&(g+=",");a.corridor=g}f&&Wa(a,f);return this.Jd("search/corridor",a,d,e)};
wr.prototype.searchByCorridor=wr.prototype.Xb;wr.prototype.Mc=function(a,b,c,d,e){function f(k,l){l&&h--;c(k,!h)}var g=[],h;if(!yc(a))throw new D(this.Mc,0,"has invalid type");C(b,K,this.Mc,1,"has invalid type");$q(this.Mc,2,c,d);b={bbox:b.la+","+b.ca+";"+b.na+","+b.ia};e&&Wa(b,e);a=b.layer_id?[b.layer_id]:a;e=0;for(h=a.length;e<h;e++)b.layer_id=a[e],g.push(this.Jd("search/bbox",b,f,d));return new nr(g)};wr.prototype.searchByBoundingBox=wr.prototype.Mc;
wr.prototype.Ci=function(a,b,c,d){var e,f=[];if(!zc(a))throw new D(this.Ci,0,"has invalid type");$q(this.Ci,1,b,c);var g={layer_id:a};d&&Wa(g,d);d=this.request("search/all",yr,g,function(h){h.geometries.length?(h=vr(h,a),e=new Or(h,b,c),f.push(e)):b(ff,!0)},c);f.push(d);return new nr(f)};wr.prototype.searchAll=wr.prototype.Ci;var Wr={"delete":/^GEOMETRY_ID$/,append:/^(?!GEOMETRY_ID$)/};
function Xr(a,b,c,d,e,f){function g(){v++;d(this,v===q)}function h(U){v++;e(U,this,v===q)}var k="append"!==b,l,m={},p=mc(),q=0,r=[],v=0;if(!yc(c))throw new D(f,0,c);$q(f,1,d,e);for(l=c.length;l--;){var w=c[l];if(C(w,Dr)){var z=w.xd().be().layerId;var J=w.xa("GEOMETRY_ID");if(k){if(J===y||""===String(J))var G='GEOMETRY_ID must not be null or ""';m[J=z+"_"+J]&&(G="same GEOMETRY_ID for multiple rows");m[J]=w}else J!==y&&""!==String(J)&&(G='GEOMETRY_ID must be null or ""')}else G="Invalid type";if(G)throw new D(f,
0,"- Invalid row at index "+l+", "+G);J=p[z];J||(J=p[z]=[],q++);J.push(w)}for(z in p){J=p[z];c=[];for(l=J.length;l--;)c.push(J[l].gi);r.push(a.request(Sr,yr,{layer_id:z,action:b,changes:J[0].xd().Xi(Wr[b]||null,c)},A(g,J),A(h,J)))}return new nr(r)}wr.prototype.uj=function(a,b,c){return Xr(this,"append",a,b,c,this.uj)};wr.prototype.appendRows=wr.prototype.uj;wr.prototype.Ql=function(a,b,c){return Xr(this,"update",a,b,c,this.Ql)};wr.prototype.updateRows=wr.prototype.Ql;
wr.prototype.Fj=function(a,b,c){return Xr(this,"delete",a,b,c,this.Fj)};wr.prototype.deleteRows=wr.prototype.Fj;Y.prototype.Om=function(a){return this.Ya(wr,a)};Y.prototype.getCustomLocationService=Y.prototype.Om;function Yr(a){xq.l.constructor.call(this,Yr,a)}u(Yr,Pp);t("H.service.extension.customRoute.Service",Yr);Yr.prototype.a=function(){return{subDomain:"s.fleet.ls",path:"2"}};Yr.CONFIG_KEY="customRoute";Yr.prototype.b=function(a){return Error(a.issues&&a.issues.length?a.issues.map(function(b){return b.message}).join(". "):a)};Yr.prototype.Qd=function(a,b,c){$q(this.Qd,1,b,c);a=this.D().clone().F("calculateroute.json").I(a);return this.K(a,b,c)};Yr.prototype.calculateRoute=Yr.prototype.Qd;
Y.prototype.Pm=function(a){return this.Ya(Yr,a)};Y.prototype.getCustomRoutingService=Y.prototype.Pm;function Zr(a){Zr.l.constructor.call(this,Zr,a)}u(Zr,Pp);t("H.service.SearchService",Zr);Zr.CONFIG_KEY="search";Zr.prototype.a=function(){return{subDomain:"search",path:"v1"}};Zr.prototype.b=function(a){a=[a.title,a.action,a.cause].filter(function(b){return b});return Error(a.join(". "))};Zr.prototype.rh=function(a,b,c){a=this.D().clone().Ma("geocode").F("geocode").I(a);return this.K(a,b,c)};Zr.prototype.geocode=Zr.prototype.rh;
Zr.prototype.Bi=function(a,b,c){a=this.D().clone().Ma("revgeocode").F("revgeocode").I(a);return this.K(a,b,c)};Zr.prototype.reverseGeocode=Zr.prototype.Bi;Zr.prototype.gm=function(a,b,c){a=this.D().clone().Ma("autosuggest").F("autosuggest").I(a);return this.K(a,b,c)};Zr.prototype.autosuggest=Zr.prototype.gm;Zr.prototype.om=function(a,b,c){a=this.D().clone().Ma("discover").F("discover").I(a);return this.K(a,b,c)};Zr.prototype.discover=Zr.prototype.om;
Zr.prototype.so=function(a,b,c){a=this.D().clone().Ma("lookup").F("lookup").I(a);return this.K(a,b,c)};Zr.prototype.lookup=Zr.prototype.so;Zr.prototype.im=function(a,b,c){a=this.D().clone().Ma("browse").F("browse").I(a);return this.K(a,b,c)};Zr.prototype.browse=Zr.prototype.im;Y.prototype.In=function(a){return this.Ya(Zr,a)};Y.prototype.getSearchService=Y.prototype.In;function $r(a){this.g=!!a.toBypassToken;if(!this.g&&!a.token)throw new D($r,0,'"token" must be specified');$r.l.constructor.call(this,$r,a);this.j=a.token;this.i={};this.f={}}u($r,Pp);t("H.service.xyz.Service",$r);$r.prototype.a=function(){return{host:"xyz.api.here.com",path:"hub/spaces"}};$r.prototype.b=function(a){return Error(a.errorMessage||a.message)};
$r.prototype.Dh=function(a,b,c){wc(a,"String",this.Dh,0,'"projectId" must be a string');as(this.Dh,1,b,c);a=bs(this.D().clone().Md("project-api/projects/"+a));return this.K(a,b,c)};$r.prototype.getProject=$r.prototype.Dh;$r.prototype.ck=function(a,b,c){as(this.ck,0,a,b);c=cs(this,this.D().clone().I(c||{}));return this.K(c,a,b)};$r.prototype.getSpaces=$r.prototype.ck;
$r.prototype.eg=function(a,b,c){wc(a,"String",this.eg,0,'"spaceId" must be a string');as(this.eg,1,b,c);a=cs(this,this.D().clone().F(a));return this.K(a,b,c)};$r.prototype.getSpace=$r.prototype.eg;$r.prototype.fe=function(a,b,c){wc(a,"String",this.fe,0,'"spaceId" must be a string');as(this.fe,1,b,c);a=cs(this,this.D().clone().F(a+"/statistics"));return this.K(a,b,c)};$r.prototype.getStatistics=$r.prototype.fe;
$r.prototype.$f=function(a,b,c,d,e,f,g){a=cs(this,this.D().clone().F(d+"/tile/web/"+c+"_"+a+"_"+b+".mvtf").I(Object.assign({clip:!0},g)));return this.K(a,function(h){return h.arrayBuffer().then(e)},f,"arraybuffer")};$r.prototype.search=function(a,b,c,d){wc(a,"String",this.search,0,'"spaceId" must be a string');as(this.search,1,b,c);a=cs(this,this.D().clone().F(a+"/search").I(d||{}));return this.K(a,b,c)};$r.prototype.search=$r.prototype.search;
$r.prototype.cd=function(a,b,c,d){wc(a,"String",this.cd,0,'"spaceId" must be a string');if(!Da(b))throw new D(this.cd,1,'"params" must be an object');as(this.cd,2,c,d);a=cs(this,this.D().clone().F(a+"/features").I(b));return this.K(a,c,d)};$r.prototype.getFeaturesById=$r.prototype.cd;
$r.prototype.Zd=function(a,b,c,d){wc(a,"String",this.Zd,0,'"spaceId" must be a string');if(!Da(b))throw new D(this.cd,1,'"params" must be an object');as(this.Zd,2,c,d);a=cs(this,this.D().clone().F(a+"/bbox").I(b));return this.K(a,c,d)};$r.prototype.getFeaturesByBoundingBox=$r.prototype.Zd;$r.prototype.ta=function(a){var b=this.i[a];if(b)return b;this.f[a]||this.Re(a);return null};
$r.prototype.kd=function(a,b,c,d,e){wc(a,"String",this.kd,0,'"spaceId" must be a string');if(!Da(b))throw new D(this.kd,1,'"geojsonObject" must be an object');as(this.kd,2,c,d);if(e&&!Da(e))throw new D(this.kd,4,'"opt_params" must be an object');return ds(this,a,c,d,"PUT",b,e)};$r.prototype.putFeatures=$r.prototype.kd;
$r.prototype.hd=function(a,b,c,d,e){wc(a,"String",this.hd,0,'"spaceId" must be a string');if(!Da(b))throw new D(this.hd,1,'"featureCollection" must be an object');as(this.hd,2,c,d);if(e&&!Da(e))throw new D(this.hd,4,'"opt_params" must be an object');return ds(this,a,c,d,"POST",b,e)};$r.prototype.postFeatures=$r.prototype.hd;
$r.prototype.sd=function(a,b,c,d){wc(a,"String",this.sd,0,'"spaceId" must be a string');if(!Da(b))throw new D(this.sd,1,'"params" must be an object');as(this.sd,2,c,d);return ds(this,a,c,d,"DELETE",B,b)};$r.prototype.deleteFeatures=$r.prototype.sd;
function ds(a,b,c,d,e,f,g){var h=Object.assign(a.g?{}:{authorization:"Bearer "+a.j},{"Content-Type":"application/geo+json"},a.gf);e={method:e,headers:h};f&&(e.data=JSON.stringify(f));b=bs(a.D().clone().F(b+"/features").I(g||{}));f=new rf("application/json",b.toString(),fe,e);f.then(c,Rp(a,b,d));return f}$r.prototype.Re=function(a){var b=this;this.f[a]=es;this.eg(a,function(c){b.f[a]=fs;b.i[a]=c.copyright;b.dispatchEvent("copyrightupdate")},function(c){b.f[a]=gs;throw c;})};
function cs(a,b){return a.g?b:bs(b).I({access_token:a.j})}function bs(a){var b=Object.assign({},a.getQuery());delete b.apikey;return a.Oi(b)}$r.CONFIG_KEY="xyz";var es=1,fs=2,gs=-1;function as(a,b,c,d){if(!Ca(c))throw new D(a,b,'"onResult" must be a function');if(!Ca(d))throw new D(a,b+1,'"onError" must be a function');}Y.prototype.Vn=function(a){return this.Ya($r,a)};Y.prototype.getXYZService=Y.prototype.Vn;function hs(a,b,c){var d;hs.l.constructor.call(this,c?{min:c.min,max:c.max,engineType:c.engineType}:void 0);C(a,$r,hs,0);if(!zc(b))throw new D(hs,1,'"spaceId" must be a string');this.s=a;this.a=b;this.c={};if(c&&(["limit","simplificationLevel","tags"].forEach(function(e){e in c&&(this.c[e]=c[e])},this),a=c.parameters))for(d in a)this.c[d]=a[d];this.ac(this.f===Vj.WEBGL?new Th({sources:{xyz:{type:"MVT"}},layers:{xyz:{data:{source:"xyz",layer:this.a},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,
order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#000000",width:"2px",join:"round",cap:"round"}}}}}}):new H.map.render.harp.Style({styles:[{layer:this.a,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,
8,14,12,18,16]},{layer:this.a,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:"#E39E3C",renderOrder:201},{layer:this.a,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",lineWidth:"1px",renderOrder:202},{layer:this.a,when:["==",["geometry-type"],"LineString"],technique:"solid-line",color:"#000000",lineWidth:"2px",renderOrder:203}]}))}u(hs,R);t("H.service.xyz.Provider",hs);hs.prototype.K=function(a,b,c,d,e){return this.s.$f(a,b,c,this.a,d,e,this.c)};
hs.prototype.requestInternal=hs.prototype.K;hs.prototype.ta=function(){return this.s.ta(this.a)};hs.prototype.getCopyrights=hs.prototype.ta;hs.prototype.Ed=df;hs.prototype.providesOMV=hs.prototype.Ed;hs.prototype.ua=function(){return this.ub()};hs.prototype.getStyle=hs.prototype.ua;hs.prototype.rc=function(a){C(a,Th)&&a.b("MVT");this.ac(a)};hs.prototype.setStyle=hs.prototype.rc;t("H.service.buildInfo",function(){return Ef("H-service","1.30.6","2978c8b")});

function is(a){var b;if(a)for(this.a={},b=a.length;b--;)this.a[a[b]]=!0;this.Hl={}}var js;is.prototype.a={};is.prototype.parse=function(a,b,c){var d,e,f,g,h;js=!1;try{c=Kp.JSON.parse(c)}catch(m){js=!0}if(c&&(d=c.metadata)){var k={spatials:[]};for(e in d){if(c=!this.a[e]&&(f=ks[e]))(g=d[e])||(js=!0,g=void 0),c=g;if(c)for(c=g.length;c--;){var l;(l=g[c])||(js=!0,l=void 0);(h=l)&&f(b,a,this,e,h,k)}}}else js=!0;return js?void 0:k};is.prototype.parse=is.prototype.parse;
var ks={"street labels":function(a,b,c,d,e,f){var g;(g=e.vertices)||(js=!0,g=void 0);if(g){var h,k=g.length,l;(l=0<k)||(js=!0,l=void 0);if(l)for(h=Array(k/2);k;){var m=g[--k];l=g[--k];h[k/2]=new I(l,m)}h=h?{a:[h]}:B;k=+e["font size"]/a.$a();g=c.Hl[k];g||(ls.lineWidth=k,g=c.Hl[k]=c.Sd.Rj(ls));ms(a,b,h,!1,g,e,d,f)}delete e.vertices},"city center labels":function(a,b,c,d,e,f){ms(a,b,ns(e,new rh([])),!0,c.Sd,e,d,f)},labels:function(a,b,c,d,e,f){var g;(g=e["bounding boxes"])||(js=!0,g=void 0);if(g){for(var h=
g.length,k=new rh([]),l;h--;){var m;(m=g[h])||(js=!0,m=void 0);(l=m)&&ns(l,k)}ms(a,b,k,!0,c.Sd,e,d,f)}delete e["bounding boxes"]},buildings:function(a,b,c,d,e,f){var g=e.id,h=b.zg[g],k,l,m,p=[],q=[];(k=e)||(js=!0,k=void 0);if(k&&((l=k.vertices)||(js=!0,l=void 0),l)){var r;(r=k.polygons)||(js=!0,r=void 0);(m=r)&&p.push.apply(p,os(l,m));(k=k.outlines)||(js=!0,k=void 0);(m=k)&&q.push.apply(q,os(l,m))}m=p.length;p.push.apply(p,q);q=new rh(p,Td,m);(p=p.length)||(js=!0,p=void 0);p&&(h?(Yq(h,a,[q]),f.spatials.push(h)):
(h=ms(a,b,q,!0,c.Sd,e,d,f,g),b.ea(h)))}};ks["transit stops"]=ks.POIs=ks.labels;var ps=["box 2","box 1","annotation box","icon box"];function ns(a,b){for(var c=ps.length,d,e;c--;)if(d=ps[c],e=a[d]){var f=e[0],g=e[1],h=e[2];e=e[3];b.a.push([new I(f,g),new I(f+h,g),new I(f+h,g+e),new I(f,g+e)]);delete a[d]}return b}
function os(a,b){var c=b.length,d,e,f;if(0<c)for(e=Array(c);c--;)if((d=b[c])||(js=!0,d=void 0),d){var g=d.length;if(0<g)for(e[c]=f=Array(g);g--;){var h=2*d[g];f[g]=new I(a[h],a[h+1])}}return e||[]}var qs={};function ms(a,b,c,d,e,f,g,h,k){qs.style=e;d=new Uq(b,d,k,qs);c&&Yq(d,a,[c]);rs(f);f.category=g;d.setData(f);h.spatials.push(d);d.ka(b);return d}is.prototype.Sd=new Ug({strokeColor:"transparent",fillColor:"transparent",lineWidth:0});var ls={};
function rs(a){var b,c=!1;switch(typeof a){case "object":if(a instanceof Array)for(b=a.length;b--;)rs(a[b])?c=!0:delete a[b];else if(a)for(b in a)rs(a[b])?c=!0:delete a[b];break;case "number":c=!0;break;default:c=!!a}return c};function ss(a,b,c){c=c||{};b=b||{};var d=c.tileType||"maptile",e=c.scheme||"normal.day";R.call(this,{min:0,max:20});!0===b.pois&&(b.pois="!F");this.a=b;if(!(a&&a instanceof ts))throw Error("InvalidArgument: service required");this.C=a;this.v=A(this.v,this);this.C.addEventListener("versionupdate",this.v);this.c=a.D().clone().F(d+"/"+a.Cc()+"/"+e).I(this.N).I(b);this.bc=a.Fh()||null;this.W=c.pixelRatio||c.pixelratio||Se();this.tileSize=c.tileSize||256;this.tileType=d;this.scheme=e;this.s=new kq(new is(c.categoryFilter));
this.s.ka(this);this.J=A(this.J,this);this.s.addEventListener("update",this.J);R.call(this,{min:0,max:20});this.O(new Dk(c.tileCacheSize||256,A(this.Aa,this)))}u(ss,R);t("H.service.metaInfo.TileProvider",ss);ss.prototype.Aa=function(a,b){a=b.Va();for(var c=a.length,d;c--;)d=a[c],delete d.tf[b.key],d.release();b.data&&(Mp.push(b.xg(),this.tileSize),b.yg())};ss.prototype.J=function(){this.dispatchEvent("update")};
ss.prototype.K=function(a,b,c,d,e){var f=this.c.clone(),g=this.bc,h=this.tileSize,k=this.getTileKey(a,b,c);k=this.Ob().get(k);var l;if(k&&!k.le()){d(Mp.pop(this.tileSize),null);var m={cancel:function(){}}}else{g&&f.Ma(g[(c+b+a)%g.length]);f.F(c+"/"+a+"/"+b+"/"+h+"/png8");var p=Kp.setTimeout(function(){l=new rf("text/plain",f.toString());l.then(function(q){d(null,q)},e)},500)}return m||{cancel:function(){l?l.cancel():Kp.clearTimeout(p)}}};ss.prototype.requestInternal=ss.prototype.K;
ss.prototype.rd=function(a,b,c,d,e){var f=this.s;var g=d||Mp.pop(this.tileSize);if(d)a=this.Ob().get(this.getTileKey(a,b,c)),a.V(d);else if(d=a=new Pk(this.yd(a,b,c),a,b,c,this.tileSize,this.W,c,f),delete d.j,d.m=e,a.V(g))for(e=a.Va(),g=e.length;g--;)e[g].Dg();else Mp.push(g,this.tileSize);return a};ss.prototype.createTileInternal=ss.prototype.rd;ss.prototype.B=function(){this.s.B();this.C.removeEventListener("versionupdate",this.v);R.prototype.B.call(this)};
ss.prototype.v=function(){var a=this.C;this.c=a.D().clone().F(this.tileType+"/"+a.Cc()+"/"+this.scheme).I(this.N).I(this.a);this.reload(!1)};ss.prototype.N={metadata:"metaonly",mgen:"2"};function ts(a){ts.l.constructor.call(this,ts,a);a=Qp(this,a);this.bc=a.shards;(this.Ra=a.ignoreTypes?null:a.type)&&this.D().Ma(this.Ra);this.cc=a.version;this.vi={};this.Xc=new Ap;"newest"===this.cc&&this.ph()}u(ts,Pp);t("H.service.metaInfo.Service",ts);ts.prototype.a=function(){return{type:"base",version:"newest",subDomain:"maps.ls",path:"maptile/2.1",shards:["1","2","3","4"]}};ts.CONFIG_KEY="metaInfo";function us(a,b){for(var c={},d=a[b+"s"][b],e=d.length;e--;)c[d[e].id]=d[e];a[b+"s"]=c}
ts.prototype.Fh=function(){return this.bc};ts.prototype.ek=function(){return this.Ra};ts.prototype.Cc=function(){return this.cc};ts.prototype.getVersion=ts.prototype.Cc;ts.prototype.Si=function(a){this.cc=a};ts.prototype.ta=function(){return this.Xc};ts.prototype.getCopyrights=ts.prototype.ta;
ts.prototype.$i=function(a){a=a.response;var b;us(a,"map");us(a,"scheme");us(a,"tiletype");us(a,"format");us(a,"resolution");us(a,"language");if("newest"===this.cc&&"traffic"!==this.Ra)for(b in a.maps)a.maps[b].hash&&a.maps[b].newest&&(this.Si(a.maps[b].hash),this.dispatchEvent("versionupdate"));this.Lh=a;this.dispatchEvent("infoupdate")};
ts.prototype.ph=function(){var a=this;var b=this.D().clone().F("info").I({output:"json"});this.bc&&b.Ma(this.bc[0]);this.K(b,function(c){a.$i(c)},function(c){throw c;})};ts.prototype.xh=function(){return this.Lh};ts.prototype.getInfo=ts.prototype.xh;ts.prototype.Me=function(a,b,c,d,e,f){return new ss(this,d,{tileSize:a,pixelRatio:b,categoryFilter:c,tileType:e,scheme:f})};ts.prototype.createTileProvider=ts.prototype.Me;ts.prototype.wc=function(a,b,c,d,e,f){return new ll(this.Me(a,b,c,d,e,f))};
ts.prototype.createTileLayer=ts.prototype.wc;Y.prototype.Wj=function(a){return this.Ya(ts,a)};Y.prototype.getMetaInfoService=Y.prototype.Wj;(function(){var a=Y.prototype.createDefaultLayers;Y.prototype.createDefaultLayers=function(b,c,d,e,f,g){var h=a.call(this,b,c,d,e,f,g),k={},l=this.Wj();"object"===typeof b&&(g=b,b=g.tileSize,c=g.ppi,d=g.lg,e=g.lg2,f=g.style,g=g.pois);b=b||256;var m=320===c?2:1;if(0>[72,250,320,500].indexOf(+c)){if(c!==B)throw new D(this.Sf,1,c);}else k.ppi=+c;d&&(k.lg=d);e&&(k.lg2=e);f&&(k.style=f);g&&(k.pois=g);h.raster.normal.metaInfo=l.wc(b,m,["buildings"],k);return h}})();

function vs(a,b,c,d,e){e&1&&ws(a,a,b,c,d,0);e&2&&ws(a,a,b,c,d,1);e&4&&ws(a,a,b,c,d,2);e&8&&ws(a,a,b,c,d,3)}
function ws(a,b,c,d,e,f){var g=(c+1)*(c+1),h,k=4*d,l=c+1,m,p=[{r:0,xm:0,hm:0,Ug:0,next:null}];var q=1;var r=["r","g","b","a"][f];var v=2*c+1;for(var w,z;q<v;q++)p[q]={r:0,xm:0,hm:0,Ug:0,next:null},p[q-1].next=p[q];p[2*c].next=p[0];var J=4*(d-1);for(h=0;h<e;h++){var G=h*k;var U=a[G+f];var X=U*l*(c+2)/2;v=U*l;for(q=0;q<=c;q++)p[q][r]=U;var xa=0;for(q=1;q<=c;q++){var ia=q<d?G+4*q:G+J;ia=a[ia+f];X+=ia*(l-q);xa+=ia;p[c+q][r]=ia}ia=p[0];w=p[l];q=G;z=4*l;var gc=G+J;for(U=0;U<d;U++){b[q+f]=X/g;X-=v;var wb=
U+l<d?q+z:gc;wb=a[wb+f];xa+=wb;X+=xa;v-=ia[r];v+=w[r];xa-=w[r];ia[r]=wb;ia=ia.next;w=w.next;q+=4;if(!X)for(;(m=4*(U+l))<k&&0===a[G+f+m];)U++,q+=4}}G=(e-1)*k;for(U=0;U<d;U++){a=4*U;h=b[a+f];X=h*l*(c+2)/2;v=h*l;for(q=0;q<=c;q++)p[q][r]=h;xa=0;for(q=1;q<=c;q++)ia=q<e?a+q*k:a+G,ia=b[ia+f],X+=ia*(c-q+1),xa+=ia,p[c+q][r]=ia;ia=p[0];w=p[l];q=a;gc=l*k;J=a+G;for(h=0;h<e;h++)if(b[q+f]=X/g,X-=v,wb=h+l<e?q+gc:J,wb=b[wb+f],xa+=wb,X+=xa,v-=ia[r],v+=w[r],xa-=w[r],ia[r]=wb,ia=ia.next,w=w.next,q+=k,!X)for(;(m=h+l)<
e&&0===b[m*k+f+a];)h++,q+=k}};function xs(a,b,c){this.f=b=a>>b;this.j=Math.log(b)*Math.LOG2E;this.i=a=document.createElement("CANVAS");this.a=a.getContext("2d");this.b=a.width=a.height=3*b;var d=document.createElement("canvas");a=c.a;var e=c.b;b=[];var f;d.width=256;d.height=1;d=d.getContext("2d");for(g in e)e.hasOwnProperty(g)&&b.push({stop:parseFloat(g),value:e[g]});e=b.length;b.sort(this.m);0<b[0].stop&&b.unshift({stop:0,value:b[0].value});1>b[e-1].stop&&b.push({stop:1,value:b[e-1].value});e=b.length;var g=d.createLinearGradient(0,
0,256,0);for(f=0;f<e;f++){if(!a&&k){var h=k.stop+(b[f].stop-k.stop)/2;g.addColorStop(h,k.value);g.addColorStop(h,b[f].value)}g.addColorStop(b[f].stop,b[f].value);var k=b[f]}d.fillStyle=g;d.fillRect(0,0,256,1);this.c=d.getImageData(0,0,256,1).data;this.g=c.a}xs.prototype.m=function(a,b){return a.stop-b.stop};function ys(a,b){this.canvas=a;this.size=b};function zs(a,b,c){this.a=a=Yd(a,0,30);this.Ra=b;this.i=c;this.m=[];this.b=[];do this.b[a]=[],this.m[a]=new As;while(a--);b===Bs?(this.o=Cs,this.j=Ds):(this.o=Es,this.j=Fs);this.c=1/0;this.f=-1/0}var Gs=Math.log(.5);function Ds(a){return this.g?Math.round((a-this.c)/this.g*255):127}function Fs(a){return void 0===this.aa?127:Math.round(255*Math.pow(a,this.aa))}
zs.prototype.Ib=function(a){var b,c;var d=a.value;void 0===d&&(d=1);d>this.f&&(this.f=d,this.g=this.f-this.c);d<this.c&&(this.c=d,this.g=this.f-this.c);var e=Xi.$c(a).scale(1073741823).floor();d=this.a;var f=e.x>>30-d;e=e.y>>30-d;for(c=this.o;-1<d;){this.b[d][e]||(this.b[d][e]=[]);(b=this.b[d][e][f])||(b=this.b[d][e][f]=new c);b.Ib(a,d);var g=this.m[d];g.f>b.b&&(g.f=b.b);g.a<b.b&&(g.a=b.b);g.c>b.a&&(g.c=b.a);g.b<b.a&&(g.b=b.a);d--;f>>=1;e>>=1}};
function Hs(a,b,c,d,e){var f=1<<b,g,h;d=Xd(d,f);f=0<=c&&c<f&&(g=a.b[b])&&(h=g[c])&&(f=h[d])||null;!f&&e&&0<=b&&(f=Hs(a,b-1,c>>1,d>>1,e));return f}function Is(a,b,c,d,e,f){for(var g,h=[];c<=d;c++)for(g=e;g<=f;g++)h.push(Hs(a,b,c,g,!1));return h}function Js(a,b){var c=0,d=0,e=Hs(a,0,0,0,!1),f;if(!0===b.c)return b.f;b.z===a.a?b.f=b.a:(Ks(a,b,function(g){var h=Ls(a,g),k=4-h.length;if(g.z!==a.a){for(f=0;f<h.length;f++)c+=h[f].a,d++;c+=k*e.a;d+=k}}),b.f=c/d);b.c=!0;return b.f}
function Ks(a,b,c){b=[b];for(var d,e;0<b.length;)e=b.shift(),d=Ls(a,e),c(e),b.push.apply(b,d)}function Ls(a,b){var c=[],d,e,f;for(e=0;1>=e;e++)for(f=0;1>=f;f++)(d=Hs(a,b.z+1,2*b.x+e,2*b.y+f,!1))&&c.push(d);return c}zs.prototype.clear=function(){zs.call(this,this.a,this.Ra,this.i)};function Es(){this.a=this.b=this.g=0}Es.prototype.Ib=function(a,b){this.g++;this.b+=a.value||1;this.a=this.b/Math.pow(2,2*(30-b))};function Cs(){this.a=this.b=this.g=0;this.c=!1}
Cs.prototype.Ib=function(a){a=a.value;this.b+=void 0!==a?a:1;this.a=this.b/++this.g;this.c=!1};function As(){this.f=this.c=1/0;this.a=this.b=-1/0};function Ms(a,b){var c,d=0;if(!Da(a)||Ta(a))throw new D(Ms,0,a);for(c in a){var e=+c;d++;if(!(Cc(e)&&0<=e&&1>=e&&zc(a[c])))throw new D(Ms,0,a);}if(2>d)throw new D(Ms,0,"Specify at least 2 stops");this.b=a;this.a=!!b}t("H.data.heatmap.Colors",Ms);var Ns=new Ms({0:"#008","0.2":"#0b0","0.5":"#ff0","0.7":"#f00"},!0);Ms.DEFAULT=Ns;function Os(a){var b=a||{},c=+b.sampleDepth;a=+b.coarseness;var d=b.colors,e={min:b.min,max:b.max},f=b.tileSize,g=+b.dataMax;b.tileSize&&(e.tileSize=f);R.call(this,e);Xj(this,b.opacity);this.Ra="value"===b.type?Bs:Ps;this.sampleDepth_=Cc(c)?Yd(Math.round(c),1,8):4;this.v=!!b.assumeValues;b=this.max;this.C=Cc(g)?Yd(Math.round(g),this.min,b+this.sampleDepth_):b;a=Cc(a)?Yd(Math.round(a),0,3):1;if(d&&!C(d,Ms))throw new D(Os,0,"colors");this.a=new zs(b+this.sampleDepth_,this.Ra,this.C);this.N=new xs(this.tileSize,
a,d||Ns);this.s=A(this.s,this);this.c=A(this.c,this);this.J=new xk(20,this.s)}u(Os,R);t("H.data.heatmap.Provider",Os);Os.prototype.qc=function(a){Xj(this,a)};Os.prototype.setOpacity=Os.prototype.qc;Os.prototype.dd=function(){return this.j};Os.prototype.getOpacity=Os.prototype.dd;Os.prototype.pf=df;Os.prototype.providesRasters=Os.prototype.pf;
Os.prototype.K=function(a,b,c,d,e){var f=this.v,g,h;if(Hs(this.a,0,0,0,!1)){if(!f){var k=Is(this.a,c,b-1,b+1,a-1,a+1);for(g=k.length;g--&&!f;)if(null!==k[g]){f=!0;break}}f&&(h=this.J.push([a,b,c,d,e],this.c))}f||d(null);return h};Os.prototype.requestInternal=Os.prototype.K;
function Qs(a,b,c,d){var e=document.createElement("canvas"),f=a.tileSize,g=e.getContext("2d");e.width=e.height=f;var h=a.N;var k=a.a,l=a.v,m=a.Ra;var p=h.f;var q=h.a,r,v,w=m===Ps?2:1,z=w;a=Math.min(a.sampleDepth_+w,h.j);w=h.b;var J=k.a;if(l&&m===Bs){for(v=-1;1>=v;v++)for(l=-1;1>=l;l++){var G=(G=Hs(k,d,c+v,b+l,!0))?k.j(Js(k,G)):128;q.fillStyle="rgba("+G+",128,0,1)";q.fillRect((l+1)*p,(v+1)*p,p,p)}l=p-Math.floor(p/10);v=3;G=q.getImageData(0,0,w,w);vs(G.data,l,w,w,v);q.putImageData(G,0,0)}else q.fillStyle=
l?"#080":"#000",q.fillRect(0,0,w,w);for(;z<=a&&d+z<=J;z++){l=p>>z;v=p-l;var U=m===Ps?127+Math.floor(128/(1<<a-z)):255;G=(1<<z)+2;var X=1<<z;var xa=b<<z;var ia=c<<z;X=Is(k,d+z,ia-1,ia+X,xa-1,xa+X);for(xa=X.length;xa--;){ia=xa%G;var gc=xa/G<<0;if(r=X[xa])r=k.j(r.a),q.fillStyle="rgba("+r+","+U+",0,1)",q.fillRect(ia*l+v,gc*l+v,l,l)}G=q;U=l;X=v;xa=p+2*l;l=p+2*l;ia=ia=3;gc=q.getImageData(X,v,xa,l);vs(gc.data,U,xa,l,ia);G.putImageData(gc,X,v)}b=q.getImageData(0,0,w,w);c=h.c;d=h.g;k=b.data;a=0;for(w=k.length;a<
w;a+=4)m=k[a],z=k[a+1],4===c.length&&(m=0),k[a]=c[4*m],k[a+1]=c[4*m+1],k[a+2]=c[4*m+2],k[a+3]=c[4*m+3]*(d?z/255:10>z?0:1);q.putImageData(b,0,0);h=new ys(h.i,p);p=h.size;g.drawImage(h.canvas,p,p,p,p,0,0,f,f);return e}Os.prototype.s=function(a,b){a.done(Qs(this,b[0],b[1],b[2]))};Os.prototype.c=function(a,b,c){var d=a.data;a=d[3];d=d[4];c?d():a(b)};
Os.prototype.tj=function(a,b){var c;if(!yc(a))throw new D(this.tj,0,a);if(c=a.length){for(;c--;)this.a.Ib(a[c]);a=this.a;var d;c=a.m;var e=a.a,f=0;if(a.Ra===Ps){var g=c[a.a].a;for(d=a.a;0<=d;d--)if(c[d].a===g)f=d;else break;g=c[0].a;for(d=0;d<=f;d++)if(g===c[d].a)e=d;else break;f>a.i&&(f=a.i);g=Math.round(e+(f-e)/2);a.aa=Gs/Math.log(c[g].b)}this.reload(!!b)}};Os.prototype.addData=Os.prototype.tj;Os.prototype.clear=function(){this.a.clear();this.reload(!0)};Os.prototype.clear=Os.prototype.clear;var Ps=0,Bs=1;function Rs(){}t("H.data.utils.Dom",Rs);Rs.prototype.Wd=function(a){return!!a&&/^\s*(1|true)\s*$/i.test(this.Oa(a))};Rs.prototype.getBoolean=Rs.prototype.Wd;Rs.prototype.Oa=function(a){var b;try{if(a.nodeType===Node.ATTRIBUTE_NODE)return a.value;var c="";var d=0;var e=a.childNodes;for(b=e.length;d<b;d++)e[d].nodeType!==Node.COMMENT_NODE&&(c+=e[d].nodeValue.replace(/^\s+|\s+$/g,""))}catch(f){}return c||""};Rs.prototype.getString=Rs.prototype.Oa;
Rs.prototype.ag=function(a){return parseFloat(this.Oa(a))||0};Rs.prototype.getFloat=Rs.prototype.ag;Rs.prototype.Yk=function(a){var b=a.split(/\s+/),c=b.length,d=!(b&&1==c),e=d?1:3,f=[],g;d||(b=a.split(","),c=b.length);for(g=0;g<c;g+=e)if(a=this.si(d?b[g]:g+3>b.length?null:b.slice(g,g+3)))f.push(a);else return[];return f};Rs.prototype.parseCoords=Rs.prototype.Yk;
Rs.prototype.si=function(a){if(!a)return null;var b=a instanceof Array&&0<a.length&&4>a.length?a:a.split(",");a=parseFloat(b[0]);var c=parseFloat(b[1]);b=parseFloat(b[2]);return isNaN(c)||isNaN(a)?null:new Wf(c,a,isNaN(b)?void 0:b)};Rs.prototype.parseCoord=Rs.prototype.si;Rs.prototype.Zf=function(a){a=this.Oa(a);return/^[0-9a-fA-F]{8}$/.test(a)?"#"+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2):"#000000ff"};Rs.prototype.getColor=Rs.prototype.Zf;function Ss(){this.a={4:function(a){return["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3),"ff"].join("")},5:function(a){return["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3),a.charAt(4),a.charAt(4)].join("")},7:function(a){return a+"ff"},9:function(a){return a}};this.b={4:function(a){return[Ts(a.charAt(1)),Ts(a.charAt(2)),Ts(a.charAt(3)),255]},5:function(a){return[Ts(a.charAt(1)),Ts(a.charAt(2)),Ts(a.charAt(3)),Ts(a.charAt(4))]},7:function(a){a=
parseInt(a.substring(1),16);return[a>>16&255,a>>8&255,a&255,255]},9:function(a){a=parseInt(a.substring(1),16);return[a>>24&255,a>>16&255,a>>8&255,a&255]}}}t("H.data.utils.ColorHelper",Ss);function Ts(a){a=parseInt(a,16);return(a<<4)+a}function Us(a){return 16>a?"0"+Math.round(a).toString(16):Math.round(a).toString(16)}
function Vs(a,b,c){if(!/^(#|rgb).*/.test(b))return[0,0,0,255];c||(c="","#"===b.charAt(0)?c=a.a[b.length]?b:"":"rgb"===b.substr(0,3)&&(b=b.match(/\d+(\.\d+)?/g),c=b.length,c=2<c&&5>c?["#",Us(+b[0]),Us(+b[1]),Us(+b[2]),3<c?Us(255*+b[3]):"ff"].join(""):""),b=c);a=a.b[b.length](b);a[3]=Math.round(a[3]/255*100)/100;return a}
Ss.prototype.Ol=function(a,b){var c="";if(!/^(#|rgb).*/.test(a)){c="";var d;for(d=0;6>d;d++)c+="ABCDEF0123456789".charAt(Math.floor(16*Math.random()));return c+"ff"}a=Vs(this,a,b);for(b=0;4>b;b++)3>b?d=Math.floor(Math.random()*(a[b]+1)):d=255*a[b],c+=Us(d);return c};Ss.prototype.toRandomRGBA=Ss.prototype.Ol;function Ws(a){a=a.attributes;for(var b,c=a.length;c--;)switch(b=a[c],b.name){case "x":this.x=parseFloat(b.value);break;case "y":this.y=parseFloat(b.value);break;case "xunits":this.fd="fraction"===Rs.prototype.Oa(b);break;case "yunits":this.Gc="fraction"===Rs.prototype.Oa(b)}}t("H.data.kml.HotSpot",Ws);function Xs(a){var b=a.childNodes,c=new Rs;for(a=b.length;a--;){var d=b[a];switch(d.nodeName){case "href":this.href=c.Oa(d)}}}t("H.data.kml.Icon",Xs);function Ys(a){var b;if(a){a=a.childNodes;var c=a.length;for(b=new Rs;c--;){var d=a[c];switch(d.nodeName){case "scale":this.scale=b.ag(d);break;case "Icon":this.icon=d=new Xs(d);break;case "hotSpot":this.kk=d=new Ws(d)}}}}t("H.data.kml.IconStyle",Ys);function Zs(a){a=a.childNodes;for(var b,c=a.length,d=new Rs,e=new Ss;c--;)switch(b=a[c],b.nodeName){case "color":this.color=d.Zf(b);break;case "colorMode":this.a=d.Oa(b)}"random"===this.a&&(this.color="#"+e.Ol(this.color,!1))}t("H.data.kml.ColorStyle",Zs);function $s(a){var b=a.childNodes,c=b.length,d=new Rs;this.outline=this.fill=!0;for(this.Mf=new Zs(a);c--;)switch(a=b[c],a.nodeName){case "fill":this.fill=d.Wd(a);break;case "outline":this.outline=d.Wd(a)}}t("H.data.kml.PolyStyle",$s);function at(a){var b=a.childNodes,c=b.length,d=new Rs;for(this.Mf=new Zs(a);c--;)a=b[c],"width"===a.nodeName&&(this.width=d.ag(a))}t("H.data.kml.LineStyle",at);function bt(a){a=a.childNodes;for(var b,c=a.length,d=new Rs;c--;)switch(b=a[c],b.nodeName){case "bgColor":this.bgColor=d.Zf(b);break;case "textColor":this.textColor=d.Zf(b);break;case "text":this.text=d.Oa(b);break;case "displayMode":this.displayMode=d.Oa(b)}}t("H.data.kml.BalloonStyle",bt);function ct(a){var b=a.childNodes,c=b.length;for(this.id=a.getAttribute("id");c--;)switch(a=b[c],a.nodeName){case "IconStyle":this.lk=a=new Ys(a);break;case "LineStyle":this.ne=a=new at(a);break;case "PolyStyle":this.al=a=new $s(a);break;case "BalloonStyle":this.Hf=a=new bt(a)}}t("H.data.kml.Style",ct);function dt(a,b){a=a.childNodes;var c=a.length,d=new Rs;for(this.b=b;c--;)switch(b=a[c],b.nodeName){case "key":this.key=d.Oa(b);break;case "styleUrl":this.a=d.Oa(b)}}t("H.data.kml.Pair",dt);dt.prototype.ua=function(){if(this.a){var a="highlight"===this.key?!0:!1;a=this.b.Gh(this.a.substr(1),a)}return a};dt.prototype.getStyle=dt.prototype.ua;function et(a,b){var c=a.childNodes,d=c.length;this.b=b;this.id=a.getAttribute("id");for(this.a=[];d--;)a=c[d],"Pair"===a.nodeName&&(a=new dt(a,this.b),this.a.push(a))}t("H.data.kml.StyleMap",et);et.prototype.ua=function(a){var b=null;a=a?"highlight":"normal";for(var c=this.a.length;c--;)this.a[c].key===a&&(b=this.a[c].ua());return b};et.prototype.getStyle=et.prototype.ua;function ft(){this.a={}}t("H.data.kml.StyleContainer",ft);ft.prototype.Yg=function(a){a&&a.id&&(this.a["style_"+a.id]=a)};ft.prototype.addStyle=ft.prototype.Yg;ft.prototype.Gh=function(a,b){a=this.a["style_"+a];a instanceof et&&(a=a.ua(b));return a};ft.prototype.getStyleById=ft.prototype.Gh;function gt(a,b){var c=a&&a.childNodes||[],d=new Rs;if(!a||!b)throw Error("Node or stylesContainer is not defined");this.visibility=!0;this.Qo=a;for(a=c.length;a--;){var e=c[a];switch(e.nodeName){case "name":this.name=d.Oa(e);break;case "description":this.description=d.Oa(e);break;case "visibility":this.visibility=d.Wd(e);break;case "open":this.open=d.Wd(e);break;case "styleUrl":if(this.a=d.Oa(e))e=this.a.substr(1),this.vm=b.Gh(e,!1);break;case "Style":this.yk=e=new ct(e)}}}
t("H.data.kml.Feature",gt);function ht(a){a=a.childNodes;for(var b,c=a.length,d=null,e=new Rs;c--;)b=a[c],"coordinates"===b.nodeName&&(d=e.Oa(b));this.a=null;d&&(this.a=e.si(d)||null)}t("H.data.kml.Point",ht);function it(a){a=a.childNodes;for(var b,c=a.length,d=new Rs;c--;)if(b=a[c],"coordinates"===b.nodeName){b=d.Oa(b);var e=[],f=new Rs;try{e=f.Yk(b)}catch(g){e=[]}this.a=2>e.length?[]:e}}t("H.data.kml.Line",it);function jt(a){for(var b=new L,c=a.a?a.a.length:0;c--;)b.Fd(a.a[c]);return b};function kt(){}kt.prototype.f=0;kt.prototype.b=0;function lt(a){var b=a.childNodes,c=b.length;this.a=new L;for(this.c=[];c--;){var d=b[c];var e=d.nodeName;if("outerBoundaryIs"===e||"innerBoundaryIs"===e){var f=d.childNodes;for(d=f.length;d--;){var g=f[d];if("LinearRing"===g.nodeName){var h=new it(g);if("outerBoundaryIs"===e){this.a=jt(h);var k=void 0,l=a,m=h.a;h=new Rs;var p=l.querySelector("altitudeMode");if(p&&p.parentNode===l&&!/^\s*clampTo/.test(h.Oa(p))&&m){p=m.length;for(var q=0;q<p&&0!==k;q++){var r=m[q].alt;r?k?r!==k&&(k=0):k=r:k=0}(m=l.querySelector("*|altitudeOffset"))&&
m.parentNode===g&&"http://www.google.com/kml/ext/2.2"===m.namespaceURI&&(g=h.ag(m))&&(k+=g);k&&(k=vd(yi,k),(g=l.querySelector("extrude"))&&g.parentNode===l&&h.Wd(g)?this.b=k:this.f=k)}}else this.c.push(jt(h))}}}}}u(lt,kt);t("H.data.kml.Polygon",lt);function mt(a,b){var c=document.createElement("CANVAS");c.width=1;c.height=1;this.i=a;this.b={};this.f={};this.g=new Ij(c);this.c=b||""}mt.prototype.create=function(a){this.a=new gt(a,this.i);return nt(this,a,null)};
function nt(a,b,c){b=b.childNodes;for(var d=b.length,e,f={},g;d--;){var h=b[d];switch(h.nodeName){case "Point":e=new ht(h);g=ot(a,"Marker");e=new yn(e.a,g);g.ti&&Ce(g.ti,"statechange",A(a.j,a,g.ti,e,g),!1);break;case "LineString":e=new it(h);g=ot(a,"Polyline");e=new nh(jt(e),g);break;case "LinearRing":e=new it(h);g=ot(a,"Polyline");e=new nh(jt(e),g);break;case "Polygon":e=new lt(h);g=ot(a,"Polygon");g.elevation=e.f;g.extrusion=e.b;e=new xi(new O(e.a,e.c),g);break;case "MultiGeometry":e=new Q,e=nt(a,
h,e)}e&&(a.a.name&&(f.name=a.a.name),a.a.description&&(f.description=a.a.description),g&&g.Hf&&(f.balloonStyle=g.Hf),f.kmlNode=a.a.Qo,e.setData(f),c&&c.ea(e))}c&&(e=c);return e}mt.prototype.j=function(a,b,c){var d=c.anchor,e=c.scale;c=e+"_"+d.x+d.y+d.fd+d.Gc+"_"+c.href;var f={};if(1===a.getState()){var g=this.b[c];if(!g){var h=d.x;var k=d.y;if(g=a.Db())g={w:g.w*e,h:g.h*e},f.size=g;h=d.fd&&g?g.w*h:h*e;k=d.Gc&&g?g.h*(1-k):!d.Gc&&g?g.h-k*e:k*e;f.anchor={x:h,y:k};g=new Ij(a.ad(),f);this.b[c]=g}b.Pc(g)}delete this.f[c]};
function ot(a,b){var c=a.a,d={visibility:c.visibility};var e=new Ss;var f=1;var g={x:0,y:0,fd:!1,Gc:!1};var h=pt(a,c.vm);c.yk&&(h=pt(a,c.yk,h));switch(b){case "Marker":if(h&&h.lk){e=h.lk;e.scale&&(f=e.scale);if(e.kk){var k=e.kk;g={x:k.x,y:k.y,fd:k.fd,Gc:k.Gc}}e.icon&&e.icon.href?(b=e.icon.href,qt.test(b)||(b=a.c+b),e=f+"_"+g.x+g.y+g.fd+g.Gc+"_"+b,k=a.b[e]||a.f[e],k||(k=new Ij(b),a.f[e]=k),0===k.getState()?(d.icon=a.g,d.ti=k,d.href=b,d.anchor=g,d.scale=f):1===k.getState()&&(d.icon=k)):1!==f&&(k||(g=
{x:14,y:4,fd:!1,Gc:!1}),a={w:28*f,h:36*f},f={size:new Ki(a.w,a.h),anchor:new I(g.fd?a.w*g.x:g.x*f,g.Gc?a.h*(1-g.y):a.h-g.y*f),hitArea:new Li(Mi.POLYGON,[0*f,16*f,0*f,7*f,8*f,0*f,18*f,0*f,26*f,7*f,26*f,16*f,18*f,34*f,8*f,34*f])},d.icon=new Ij('<svg xmlns="http://www.w3.org/2000/svg" width="28px" height="36px"><path d="M 19 31 C 19 32.7 16.3 34 13 34 C 9.7 34 7 32.7 7 31 C 7 29.3 9.7 28 13 28 C 16.3 28 19 29.3 19 31 Z" fill="#000" fill-opacity=".2"/><path d="M 13 0 C 9.5 0 6.3 1.3 3.8 3.8 C 1.4 7.8 0 9.4 0 12.8 C 0 16.3 1.4 19.5 3.8 21.9 L 13 31 L 22.2 21.9 C 24.6 19.5 25.9 16.3 25.9 12.8 C 25.9 9.4 24.6 6.1 22.1 3.8 C 19.7 1.3 16.5 0 13 0 Z" fill="#fff"/><path d="M 13 2.2 C 6 2.2 2.3 7.2 2.1 12.8 C 2.1 16.1 3.1 18.4 5.2 20.5 L 13 28.2 L 20.8 20.5 C 22.9 18.4 23.8 16.2 23.8 12.8 C 23.6 7.07 20 2.2 13 2.2 Z" fill="#18d"/></svg>',
f))}break;case "Polyline":d.style={};h&&h.ne&&(f=h.ne,d.style.strokeColor="rgba("+Vs(e,f.Mf.color,!0)+")",0<=f.width&&(d.style.lineWidth=f.width));break;case "Polygon":d.style={},h&&(h.ne&&(f=h.ne,d.style.strokeColor="rgba("+Vs(e,f.Mf.color,!0)+")",0<=f.width&&(d.style.lineWidth=f.width)),h.al&&(f=h.al,d.style.fillColor=f.fill?"rgba("+Vs(e,f.Mf.color,!0)+")":"rgba(0,0,0,0)",f.outline||(d.style.lineWidth=0)))}d.Hf=h.Hf;return d}
function pt(a,b,c){c=c||{};for(var d in b)b.hasOwnProperty(d)&&(c[d]="object"===typeof b[d]?pt(a,b[d],c[d]):b[d]);return c}var qt=/^[^:\/]+:/;function rt(a){uc(this,rt);this.url=a;this.b=[];this.a=y;this.c=A(this.c,this);F.call(this)}u(rt,F);t("H.data.AbstractReader",rt);var st={ERROR:-1,LOADING:0,VISIT:1,READY:2};rt.State=st;rt.prototype.f=st.READY;rt.prototype.j={am:"statechange"};rt.prototype.tb=function(){if(!this.a){this.a=new N;var a=this.a.kc();a.fc(this.b)}return new ml(this.a)};rt.prototype.getLayer=rt.prototype.tb;rt.prototype.tn=function(){return this.b.concat([])};rt.prototype.getParsedObjects=rt.prototype.tn;
rt.prototype.D=function(){return this.url};rt.prototype.getUrl=rt.prototype.D;rt.prototype.ep=function(a){if(this.f===st.LOADING||this.f===st.VISIT)throw Error("InvalidState: state "+this.f);this.b=[];this.a=y;this.url=a;return this};rt.prototype.setUrl=rt.prototype.ep;rt.prototype.getState=function(){return this.f};rt.prototype.getState=rt.prototype.getState;rt.prototype.P=function(a,b,c){this.f=a;this.dispatchEvent(new tt(b||this,this.j.am,a,c||""))};
rt.prototype.parse=function(){var a=this;tc(this.url)?(this.P(st.LOADING),(new rf("text/plain",this.url)).then(function(b){try{a.c(b)}catch(c){a.P(st.ERROR,y,c.message)}},function(){a.P(st.ERROR,y,"Error loading file")})):a.P(st.ERROR,y,"File url was not set")};rt.prototype.parse=rt.prototype.parse;function tt(a,b,c,d){tt.l.constructor.call(this,b,a);this.state=c;this.message=d}u(tt,rd);function ut(a){var b=a?a.lastIndexOf("/"):B;this.g=[];rt.call(this,a);0<=b&&(this.i=a.substr(0,b)+"/")}u(ut,rt);t("H.data.kml.Reader",ut);
ut.prototype.c=function(a){var b,c=null;if(a&&""!=a.trim()){try{var d=(new DOMParser).parseFromString(a,"text/xml")}catch(h){this.P(st.ERROR,void 0,"Error parsing KML document");return}if(d.getElementsByTagName("parsererror").length)this.P(st.ERROR,void 0,"Error parsing KML document");else if((a=d.childNodes&&"kml"===d.childNodes[0].nodeName?d.childNodes[0]:void 0)&&(b=vt(a.childNodes,"Document")[0]),b=b||a){d=new ft;for(var e=vt(b.childNodes,"Style"),f=vt(b.childNodes,"StyleMap"),g=e.length;g--;)a=
new ct(e[g]),d.Yg(a);for(g=f.length;g--;)a=new et(f[g],d),d.Yg(a);this.o=d;this.m=new mt(this.o,this.i);a=b.childNodes;for(b=a.length;b--;)if(e=a[b],d=c,"Placemark"===e.nodeName?(e=this.m.create(e))&&wt(this,e,d):"Folder"===e.nodeName&&(e={group:new Q,node:e},wt(this,e.group,d),this.g.push(e)),!b&&(d=this.g.shift()))a=d.node.childNodes,c=d.group,b=a.length;this.P(st.READY)}else this.P(st.ERROR,void 0,"Invalid KML document")}else this.P(st.ERROR,void 0,"Unable to create objects from the empty data")};
function wt(a,b,c){c?c.ea(b):(a.a&&a.a.kc().ea(b),a.b.push(b),a.P(st.VISIT,b))}function vt(a,b){for(var c=a.length,d,e=[];c--;)d=a[c],d.nodeName===b&&e.push(d);return e};function xt(a,b){this.b=a;this.a=b}
xt.prototype.create=function(a,b){var c=a.coordinates;switch(a.type){case "Point":var d=new yn(yt(c));break;case "LineString":d=new nh(zt(c));break;case "Polygon":d=new xi(At(c));break;case "MultiPoint":var e=0;var f=c.length;d=[];if(this.a){for(;e<f;e++)d.push(yt(c[e]));c=new yn(new Ji(d))}else{for(;e<f;e++)d.push(new yn(yt(c[e])));c=new Q;c.fc(d)}d=c;f="multiPoint";break;case "MultiLineString":e=0;f=c.length;d=[];if(this.a){for(;e<f;e++)d.push(zt(c[e]));c=new nh(new mh(d))}else{for(;e<f;e++)d.push(new nh(zt(c[e])));
c=new Q;c.fc(d)}d=c;f="multiLineString";break;case "MultiPolygon":d=[];e=0;f=c.length;if(this.a){for(;e<f;e++)d.push(At(c[e]));c=new xi(new ui(d))}else{for(;e<f;e++)d.push(new xi(At(c[e])));c=new Q;c.fc(d)}d=c;f="multiPolygon";break;case "GeometryCollection":c=d=new Q;e=a.geometries;f=0;for(var g=e.length;f<g;f++)this.create(e[f],c);f="geometryCollection"}d&&(c=d,e=a.properties,a=a.id,g={},e&&(this.a?g=e:g.properties=e),f&&!this.a&&(g[f]=!0),a&&c.Qi(a),c.setData(g),this.b(d));b&&d&&b.ea(d);return d};
xt.prototype.create=xt.prototype.create;function yt(a){return new Wf(a[1],a[0])}function At(a){for(var b=zt(a[0]),c=[],d,e=1,f=a.length;e<f;e++)d=zt(a[e]),c.push(d);return new O(b,c)}function zt(a){for(var b=0,c=a.length,d=new L;b<c;b++)d.Fd(yt(a[b]));return d};function Bt(a,b){b=b||{};this.i=b.style||this.Sd;(this.g=!!b.disableLegacyMode)||window.console.warn("H.data.geojson.Reader: Legacy parser is enabled in GeoJSON Reader. Features like Multi-Geometries, Polygon interiors and GeoJSON feature properties might not work as expected. To maximise compatibility with the remote services it is recommended to set the `disableLegacyMode` flag to true.");rt.call(this,a)}u(Bt,rt);t("H.data.geojson.Reader",Bt);
Bt.prototype.c=function(a){var b,c;try{var d="string"===typeof a?JSON.parse(a):a;if("object"===typeof d){var e=new xt(this.i,this.g);switch(d.type){case "FeatureCollection":if(b=d.features){var f=new Q;Ct(this,f);for(c=0;c<b.length;c++){var g=Dt(b[c]);(g=e.create(g))&&f.ea(g)}}break;case "Feature":g=Dt(d);(g=e.create(g))&&Ct(this,g);break;default:(g=e.create(d))&&Ct(this,g)}this.P(st.READY)}else this.P(st.ERROR,void 0,"Invalid syntax")}catch(h){this.P(st.ERROR,void 0,"Parse error. "+h.message)}};
Bt.prototype.Po=function(a){this.P(st.LOADING);this.c(a)};Bt.prototype.parseData=Bt.prototype.Po;Bt.prototype.Sd=function(){};function Dt(a){var b={};if(a.geometry){var c=a.geometry;b.type=c.type;b.properties=a.properties;c.coordinates&&(b.coordinates=c.coordinates);c.geometries&&(b.geometries=c.geometries);a.id&&(b.id=a.id)}return b}function Ct(a,b){a.a&&a.a.kc().ea(b);a.b.push(b);a.P(st.VISIT,b)};t("H.data.buildInfo",function(){return Ef("H-data","1.30.6","abfe236")});

hg.prototype.Uc=ca(1,function(a,b){this.a.Uc(a,Cc(b)?b:this.c)});lg.prototype.Uc=ca(0,function(a,b){var c=0,d;if(!a(this)&&b--)for(;3>=c;c++)(d=this[c])&&d.Uc(a,b)});function Et(a,b,c){this.f=this.c=c;this.ui=[];this.a=0;this.R=dg(a,b,!0)}t("H.clustering.grid.Cluster",Et);Et.prototype.Ge=function(a){this.b||(this.b=Zf(a));this.a+=a.wt||1;this.ui.push(a)};Et.prototype.Ca=function(){return this.b};Et.prototype.getPosition=Et.prototype.Ca;Et.prototype.Ec=function(){return this.a};Et.prototype.getWeight=Et.prototype.Ec;Et.prototype.Bd=df;Et.prototype.isCluster=Et.prototype.Bd;Et.prototype.Ac=function(){return this.c};Et.prototype.getMinZoom=Et.prototype.Ac;
Et.prototype.cg=function(){return this.f};Et.prototype.getMaxZoom=Et.prototype.cg;Et.prototype.G=function(){return this.R};Et.prototype.getBoundingBox=Et.prototype.G;Et.prototype.qh=function(a){this.Se(a)};Et.prototype.forEachEntry=Et.prototype.qh;Et.prototype.Se=function(a){var b=this;if(!Ca(a))throw new D(this.Se,0,a);this.ui.forEach(function(c){a(new Ft(c,b.c+1))})};Et.prototype.forEachDataPoint=Et.prototype.Se;function Gt(a){nd.call(this);this.a=[];var b;a?Wa(b={},Ht,a):b=Ht;this.g=b;nd.call(this)}u(Gt,nd);var It={clusters:[],noisePoints:[]},Ht={projection:Xi,min:0,max:22,eps:32,minWeight:2};n=Gt.prototype;n.Oc=function(a){this.a=a;this.b=!0};n.Ib=function(a){this.a.push(a);this.b=!0};n.Gf=function(a){this.a=this.a.concat(a);this.b=!0};n.qf=function(a){this.a=this.a.filter(function(b){return b!==a});this.b=!0};n.u=function(){Gt.l.u.call(this);this.a=null};n.sl=hd;function Ft(a,b){this.a=a;this.b=b}t("H.clustering.grid.NoisePoint",Ft);Ft.prototype.Ca=function(){return Zf(this.a)};Ft.prototype.getPosition=Ft.prototype.Ca;Ft.prototype.Ec=function(){return this.a.wt};Ft.prototype.getWeight=Ft.prototype.Ec;Ft.prototype.Bd=ef;Ft.prototype.isCluster=Ft.prototype.Bd;Ft.prototype.Ac=function(){return this.b};Ft.prototype.getMinZoom=Ft.prototype.Ac;Ft.prototype.getData=function(){return this.a.data};Ft.prototype.getData=Ft.prototype.getData;function Jt(a){Gt.call(this,a)}u(Jt,Gt);
Jt.prototype.Ui=function(a){var b=this.g,c=b.min,d=b.max,e=[],f=[],g;if(this.b){for(g=this.a;c<=d;c++){for(var h,k=void 0,l,m,p,q,r,v,w,z=c,J=g,G=e,U=f,X=b.eps,xa=b.projection,ia=b.minWeight,gc=J.length,wb=Math.pow(2,z+8),md=[];w=J[--gc];)if(!w.cj){m=xa.$c(w).scale(wb).floor();v=wb;r=m.x;q=m.y;for(l=md.length;l--;)h=md[l],p=h.Ca(),h.bj||(h.bj=xa.$c(p).scale(wb).floor()),p=h.bj,p=p.Za(m),p<v&&(v=p,k=h);k&&k.G().pd(w)||(k=new Et(xa.vg({x:(r-X)/wb,y:(q-X)/wb}),xa.vg({x:(r+X)/wb,y:(q+X)/wb}),z),md.push(k));
k.Ge(w);k=null}for(gc=md.length;gc--;)if(h=md[gc],l=h.Ec(),l<ia)for(h=h.ui,l=h.length;w=h[--l];)U.push(new Ft(w,z)),w.cj=!0;else G.push(h)}c=0;for(d=g.length;c<d;c++)delete g[c].cj;this.b=!1;a({clusters:e,noisePoints:f})}};function Kt(a){this.a=a;a=document.createElement("canvas");var b=a.getContext("2d"),c=this.a,d=14*c;a.width=d;a.height=d;b.scale(c,c);b.beginPath();b.strokeStyle="#FFFFFF";b.fillStyle="#1080DD";b.arc(7,7,6,0,2*Math.PI,!1);b.fill();b.lineWidth=1;b.stroke();this.f=new Ij(a,{size:{w:14,h:14},anchor:{x:7,y:7}});this.b={};this.c={}}t("H.clustering.theme.Circular",Kt);
function Lt(a,b,c){var d,e=document.createElement("canvas"),f=e.getContext("2d");var g=a.a;var h=b*g;e.width=h;e.height=h;f.scale(g,g);g=b+":"+c;(d=a.b[g])?f.putImageData(d,0,0):(b/=2,f.beginPath(),f.strokeStyle="rgba("+c+",0.2)",f.fillStyle="rgba("+c+",1)",f.arc(b,b,b/5*3,0,2*Math.PI,!1),f.fill(),f.lineWidth=b/5*4,f.stroke(),a.b[g]=f.getImageData(0,0,h,h));return e}
Kt.prototype.Im=function(a){var b=a.Ec();var c=this.c[b];if(!c){if(10>b){c=Lt(this,28,"118,209,0");var d={x:11,y:18}}else 25>b?(c=Lt(this,38,"255,105,0"),d={x:13,y:23}):50>b?(c=Lt(this,38,"240,60,0"),d={x:13,y:23}):100>b?(c=Lt(this,38,"181,0,21"),d={x:13,y:23}):1E3>b?(c=Lt(this,48,"181,0,21"),d={x:15,y:28}):(c=Lt(this,66,"181,0,21"),d={x:20,y:38});var e=c.getContext("2d");e.fillStyle="#FFFFFF";e.font="bold 11px Arial";e.fillText(b,d.x,d.y);d=c.width/this.a;c=new Ij(c,{size:{w:d,h:d},anchor:{x:d/2,
y:d/2}});this.c[b]=c}b=new yn(a.Ca(),{icon:c,min:a.Ac(),max:a.cg()});b.setData(a);return b};Kt.prototype.getClusterPresentation=Kt.prototype.Im;Kt.prototype.qn=function(a){var b=new yn(a.Ca(),{icon:this.f,min:a.Ac()});b.setData(a);return b};Kt.prototype.getNoisePresentation=Kt.prototype.qn;function Mt(a){Gt.call(this,a);a=this.g;if(a.projection!==Xi)throw new D(Mt,0,"Other projection than mercator not supported yet");this.m=a.projection;this.f=a.eps;this.v=a.minWeight;this.o=new Yi(this.m);(new Mf).a("cluster","H.clustering.dynamicgrid.worker");this.i=A(this.i,this);this.j=A(this.j,this)}u(Mt,Gt);Mt.prototype.sl=function(a,b){this.aa=a;this.s=yd(b)};
Mt.prototype.Ui=function(a,b){var c=this.c;var d=this.aa,e=this.s||0;var f=!c||!(c.zoom===e&&c.b.oa(d));if(d&&(this.b||f)){c&&3>c.pe&&c.cancel();this.b=!1;c=this.f;if(c>=128*Dd(2,e))var g=Nt;else{f=this.o;f.Qa(e);var h=f.lb(d.Rb());g=f.lb(d.Nb());h.y-=c;g.y+=c;h=f.lf(h);var k=f.lf(g);g=new K(h.lat,h.lng,k.lat,k.lng);c=f.Sa(c,0).lng+180;g=g.Ic(h.lat,h.lng-c,k.lat,h.lng).Ic(h.lat,k.lng,k.lat,k.lng+c)}c=g;h=this.a;g=[];for(f=h.length;f--;)c.pd(h[f])&&g.push(h[f]);0<g.length?(this.c=new Ot(d,e,g,this.f,
this.v,this.m!==Xi,a,b),this.c.then(this.i,this.j)):a(It)}};Mt.prototype.i=function(a){Ba(a)||(a=new x.Uint32Array(a));this.c.g(Pt(this,a))};Mt.prototype.j=function(a){zc(a)&&this.c.c(a)};var Nt=new K(90,-180,-90,180);
function Pt(a,b){for(var c=0,d=b[c++],e=Array(d),f=0,g=[],h=b.length,k=a.c.a,l=a.c.zoom;d--;)e[f++]=new Ft(k[b[c++]],l);for(;c<h;){d=b[c++];f=k[b[c]];var m=a.o;var p=a.f;m.Qa(a.c.zoom);var q=m.lb(f);f=m.Sa(q.x-p,q.y-p);m=m.Sa(q.x+p,q.y+p);f=new K(f.lat,f.lng,m.lat,m.lng);for(f=new Et(f.Rb(),f.Nb(),l);d--;)f.Ge(k[b[c++]]);g.push(f)}return{clusters:g,noisePoints:e}}Mt.prototype.u=function(){Mt.l.u.call(this)};
function Ot(a,b,c,d,e,f,g,h){this.b=a;this.zoom=b;this.a=c;this.g=g;this.c=h;a=c.length;g=3*a;h=new (x.Float64Array||Array)(g);for(var k;a--;)k=c[a],h[--g]=k.lat,h[--g]=k.lng,h[--g]=k.wt;ee.call(this,"cluster",{message:[h,d,e,b,f]},void 0)}u(Ot,Pf);function Qt(a,b,c){this.c=a;this.a=b;this.f=c}t("H.clustering.fastgrid.NoisePoint",Qt);Qt.prototype.Ca=function(){this.b||(this.b=this.c.Sa(this.a[1],this.a[0],1));return this.b};Qt.prototype.getPosition=Qt.prototype.Ca;Qt.prototype.Ec=function(){return this.a.a};Qt.prototype.getWeight=Qt.prototype.Ec;Qt.prototype.Bd=ef;Qt.prototype.isCluster=Qt.prototype.Bd;Qt.prototype.Ac=function(){return this.f-this.c.c};Qt.prototype.getMinZoom=Qt.prototype.Ac;Qt.prototype.getData=function(){return this.a.data};
Qt.prototype.getData=Qt.prototype.getData;function Rt(a,b,c,d){this.c=a;this.a=b;this.j=c;this.o=d;this.g=Ia(this.g,this);this.f=Ia(this.f,this)}t("H.clustering.fastgrid.Cluster",Rt);Rt.prototype.Ca=function(){this.b||(this.b=this.c.Sa(this.a.Je,this.a.Ke,this.a.Kb));return this.b};Rt.prototype.getPosition=Rt.prototype.Ca;Rt.prototype.Ec=function(){return this.a.Kb};Rt.prototype.getWeight=Rt.prototype.Ec;Rt.prototype.Bd=df;Rt.prototype.isCluster=Rt.prototype.Bd;Rt.prototype.Ac=function(){return this.j?this.j-this.c.c:-1/0};
Rt.prototype.getMinZoom=Rt.prototype.Ac;Rt.prototype.cg=function(){return this.o-this.c.c};Rt.prototype.getMaxZoom=Rt.prototype.cg;Rt.prototype.G=function(){this.R||(this.R=dg(this.c.Sa(this.a.a,this.a.f,1),this.c.Sa(this.a.b,this.a.c,1),!0));return this.R};Rt.prototype.getBoundingBox=Rt.prototype.G;Rt.prototype.qh=function(a){this.i=a;this.a.Uc(this.g,Td)};Rt.prototype.forEachEntry=Rt.prototype.qh;
Rt.prototype.g=function(a,b){var c=!1,d,e;a.Kb>=this.c.m&&a!==this.a&&a.Kb!==this.a.Kb&&(this.i(new Rt(this.c,a,0,b)),c=!0);if(!c&&(d=a.entries))for(a=d.length,e=0;e<a;e++)this.i(new Qt(this.c,d[e],b));return c};Rt.prototype.Se=function(a){this.m=a;this.a.Uc(this.f,Td)};Rt.prototype.forEachDataPoint=Rt.prototype.Se;Rt.prototype.f=function(a,b){var c;if(a=a.entries){var d=a.length;for(c=0;c<d;c++)this.m(new Qt(this.c,a[c],b))}return!1};function St(a,b,c,d,e,f){this.g=b;a&&(this.parent=a,b&1?(c=a[8],e=a[5]):(c=a[7],e=a[8]),b&2?(d=a[9],f=a[6]):(d=a[4],f=a[9]));this[7]=c;this[5]=e;this[8]=(c+e)/2;this[4]=d;this[6]=f;this[9]=(d+f)/2}n=St.prototype;n.oe=0;function Tt(a,b){return a[b]||(++a.oe,a[b]=new St(a,b))}n.removeChild=function(a){var b=a.g;this[b]===a&&(delete this[b],delete a.parent,--this.oe)};n.Uc=function(a,b){for(var c=0,d=this;d=d.parent;)++c;Ut(this,a,b,c)};
function Ut(a,b,c,d){var e,f;if(!b(a,d)&&c--)for(++d,e=0;4>e;e++)(f=a[e])&&Ut(f,b,c,d)}n.Je=0;n.Ke=0;n.Kb=0;function Vt(a){this.b=a||10;this.a=null;Wt(this)}function Wt(a){a.head=a.a=new St(null,NaN,0,0,4294967296,4294967296)}function Xt(a,b){var c,d;for(c=0;4>c;c++)if(d=b[c])Xt(a,d),delete b[c];delete b.parent;delete b.entries}function Yt(a,b){var c=a.head,d;if(b){var e=b;if(e!==c)for(c=e;e=e.parent;)if(e.entries||1<e.oe)c=e}else for(;!c.entries&&2>(d=c.oe);)if(d)c=e;else break;a.head=c}
Vt.prototype.Fc=function(a,b,c,d){var e=this.a;if(!(a>=e[7]&&b>=e[4]&&a<=e[5]&&b<=e[6]))throw Error("Coordinates out of bounds");return Zt(this,this.a,a,b,c,this.b,d)};
function Zt(a,b,c,d,e,f,g){var h=b.entries;if(f)if(b.oe)h=Zt(a,Tt(b,c>=b[8]|(d>=b[9])<<1),c,d,e,f-1,g);else if(h){h=h[0];var k=Tt(b,h[1]>=b[8]|(h[0]>=b[9])<<1);k.entries=b.entries;k.Je=b.Je;k.Ke=b.Ke;k.Kb=b.Kb;k.a=b.a;k.f=b.f;k.b=b.b;k.c=b.c;delete b.entries;h.node=k;Yt(a,k);h=Zt(a,Tt(b,c>=b[8]|(d>=b[9])<<1),c,d,e,f-1,g)}else f=h=new $t(c,d,e,g),(b.entries||(b.entries=[])).push(f),Yt(a,b);else h||Yt(a,b),a=h=new $t(c,d,e,g),(b.entries||(b.entries=[])).push(a);b.Je+=c*e;b.Ke+=d*e;b.Kb+=e;b.a===B?(b.a=
b.b=c,b.f=b.c=d):(c<b.a?b.a=c:c>b.b&&(b.b=c),d<b.f?b.f=d:d>b.c&&(b.c=d));return h}Vt.prototype.Uc=function(a,b){Ut(this.a,a,b===+b?b:this.b,0)};function $t(a,b,c,d){this[0]=b;this[1]=a;this.a=c;this.data=d};function au(a){Gt.call(this,a);a=this.g;this.j=a.projection;this.o=a.min;this.f=a.max;this.m=a.minWeight;this.c=7-xd(Bd(wd(1,a.eps))/Ld);this.i=new Vt(wd(this.o,this.f+this.c))}u(au,Gt);n=au.prototype;n.Oc=function(a){var b=0,c=a.length,d,e=new I(0,0),f=this.j,g=this.i;au.l.Oc.call(this,a);Xt(g,g.a);for(Wt(g);b<c;b++)f.$c(d=a[b],e).scale(4294967296).floor(),g.Fc(e.x,e.y,d.wt,d.data);this.b=!0};n.Ib=function(a){au.l.Ib.call(this,a);this.Oc(this.a)};
n.Gf=function(a){for(var b=a.length,c=au.l.Ib;b--;)c.call(this,a[b]);this.Oc(this.a)};n.qf=function(a){au.l.qf.call(this,a);this.Oc(this.a)};n.Sa=function(a,b,c,d){return this.j.Sa(a/c/4294967296,b/c/4294967296,d)};n.Ui=function(a){if(this.b){var b={clusters:[],noisePoints:[]};bu(this,this.i.a,0,this.f+this.c,-1/0,b,null);this.b=!1;a(b)}};
function bu(a,b,c,d,e,f,g){var h=b.Kb,k;g&&(g.node.Kb!==h?(f.clusters.push(new Rt(a,g.node,g.depth,c-1)),g=null):e++);g||(h>=a.m?(g={node:b,depth:c},e=c):cu(a,b,e+1,f));if(b.oe&&d--)for(c++,h=0;4>h;h++)if(k=b[h])bu(a,k,c,d,e,f,g),g=null;g&&f.clusters.push(new Rt(a,g.node,g.depth,a.f+a.c))}function cu(a,b,c,d){b=b.entries;var e;if(b){var f=b.length;d=d.noisePoints;for(e=0;e<f;e++)d.push(new Qt(a,b[e],c))}else for(e=0;4>e;e++)(f=a[e])&&cu(a,f,c,d)}n.u=function(){au.l.u.call(this);this.i=null};function du(a,b,c,d){this.lat=a;this.lng=b;this.wt=c===+c?c:1;this.data=d}t("H.clustering.DataPoint",du);du.prototype.vk=NaN;du.prototype.xk=NaN;function eu(a,b){b=b||{};var c={},d=b.min||0,e=wd(d,b.max||22);d={min:d,max:e};eu.l.constructor.call(this,d);this.kb=b.pixelRatio||Se();Wa(c,Ht,d,b.clusteringOptions||{});c.minWeight=wd(Ht.minWeight,c.minWeight);switch(c.strategy){case fu.DYNAMICGRID:if(c.projection!==Xi)throw new D(eu,1,"Unsupported projection");this.a=new Mt(c);break;case fu.GRID:this.a=new Jt(c);break;default:this.a=new au(c)}this.a.Oc(a);this.C=b.theme||new Kt(this.kb);this.ma=A(this.ma,this);this.Xa=A(this.Xa,this);gu(this)}
u(eu,N);t("H.clustering.Provider",eu);eu.prototype.u=function(){eu.l.u.call(this);this.c.qa();this.a.B();this.C=this.N=this.a=null;x.clearTimeout(this.W)};var fu={FASTGRID:0,GRID:1,DYNAMICGRID:2};eu.Strategy=fu;eu.prototype.ma=function(){this.dispatchEvent("start");this.a.Ui(this.Xa,hd)};function gu(a,b,c){a.W&&x.clearTimeout(a.W);b&&a.a.sl(b,c);a.W=x.setTimeout(a.ma,150)}eu.prototype.Xa=function(a){this.dispatchEvent("end");this.N=a;hu(this)};eu.prototype.Oc=function(a){this.a.Oc(a);gu(this)};
eu.prototype.setDataPoints=eu.prototype.Oc;eu.prototype.Ib=function(a){this.a.Ib(a);gu(this)};eu.prototype.addDataPoint=eu.prototype.Ib;eu.prototype.Gf=function(a){this.a.Gf(a);gu(this)};eu.prototype.addDataPoints=eu.prototype.Gf;eu.prototype.qf=function(a){this.a.qf(a);gu(this)};eu.prototype.removeDataPoint=eu.prototype.qf;eu.prototype.Ln=function(){return this.C};eu.prototype.getTheme=eu.prototype.Ln;eu.prototype.bp=function(a){this.C=a;this.N&&(this.c.qa(),hu(this))};eu.prototype.setTheme=eu.prototype.bp;
function hu(a){var b=a.N.clusters,c=a.N.noisePoints,d=b.length,e=c.length,f=0<d+e;for(a.c.qa();e--;){var g=c[e];a.c.ea(a.C.getNoisePresentation(g))}for(;d--;)c=b[d],a.c.ea(a.C.getClusterPresentation(c));f&&Wj(a)}eu.prototype.Vb=function(){return!0};eu.prototype.providesDomMarkers=eu.prototype.Vb;eu.prototype.Wb=function(){return!0};eu.prototype.providesMarkers=eu.prototype.Wb;eu.prototype.Jc=function(){return!0};eu.prototype.providesSpatials=eu.prototype.Jc;
eu.prototype.nf=function(a,b){gu(this,a,b)};eu.prototype.preprocessData=eu.prototype.nf;t("H.clustering.buildInfo",function(){return Ef("H-clustering","1.30.6","5f44999")});

function iu(a,b){a:{for(var c=a.length,d="string"===typeof a?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:"string"===typeof a?a.charAt(b):a[b]}var ju={};function ku(a){var b=a.ownerDocument,c=b.documentElement;b=b.defaultView;var d=a.getBoundingClientRect();a=d.left;d=d.top;isNaN(b.pageXOffset)?(a+=c.scrollLeft,d+=c.scrollTop):(a+=b.pageXOffset,d+=b.pageYOffset);return new I(a,d)}
function lu(a,b,c){b=Cc(b)?b+"px":b;c=Cc(c)?c+"px":c;a.style[xf("transform")]="translate("+b+","+c+")"}var mu={TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right",LEFT_TOP:"left-top",LEFT_MIDDLE:"left-middle",LEFT_BOTTOM:"left-bottom",RIGHT_TOP:"right-top",RIGHT_MIDDLE:"right-middle",RIGHT_BOTTOM:"right-bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right"};t("H.ui.LayoutAlignment",mu);function nu(a,b){var c={},d={};c["top-left"]=ou(b,"div",[pu,qu].join(" "));c["top-center"]=ou(b,"div",[pu,ru,su,qu].join(" "));c["top-right"]=ou(b,"div",[pu,qu].join(" "));c["left-top"]=ou(b,"div",[pu,tu].join(" "));c["left-middle"]=ou(b,"div",[pu,uu,vu,tu].join(" "));c["left-bottom"]=ou(b,"div",[pu,tu].join(" "));c["right-top"]=ou(b,"div",[pu,tu].join(" "));c["right-middle"]=ou(b,"div",[pu,wu,vu,tu].join(" "));c["right-bottom"]=ou(b,"div",[pu,tu].join(" "));c["bottom-left"]=ou(b,"div",[pu,qu].join(" "));
c["bottom-center"]=ou(b,"div",[pu,xu,su,qu].join(" "));c["bottom-right"]=ou(b,"div",[pu,qu].join(" "));d["top-left"]=ou(b,"div",[ru,uu].join(" "));d["top-right"]=ou(b,"div",[ru,wu].join(" "));d["bottom-left"]=ou(b,"div",[xu,uu].join(" "));d["bottom-right"]=ou(b,"div",[xu,wu].join(" "));yu(d["top-left"],c["top-left"],c["left-top"]);yu(d["top-right"],c["top-right"],c["right-top"]);yu(d["bottom-left"],c["left-bottom"],c["bottom-left"]);yu(d["bottom-right"],c["right-bottom"],c["bottom-right"]);yu(a,d["top-left"],
d["top-right"],d["bottom-left"],d["bottom-right"],c["top-center"],c["left-middle"],c["right-middle"],c["bottom-center"]);this.a=c}var ru="H_l_top",xu="H_l_bottom",uu="H_l_left",wu="H_l_right",su="H_l_center",vu="H_l_middle",qu="H_l_horizontal",tu="H_l_vertical",pu="H_l_anchor";nu.prototype.update=function(){var a=this.a;zu(a["top-center"],!0);zu(a["bottom-center"],!0);zu(a["left-middle"],!1);zu(a["right-middle"],!1)};
function zu(a,b){b?(b=a.offsetWidth,a.style.marginLeft=-Math.round(.5*b)+"px"):(b=a.offsetHeight,a.style.marginTop=-Math.round(.5*b)+"px")}nu.prototype.put=function(a,b){a=a?a.L():null;var c=b?this.a[b]:null;a&&c&&(a.parentElement&&a.parentElement.removeChild(a),c.insertBefore(a,/(bottom|right)$/.test(b)||/(center|middle)/.test(b)&&c.childNodes.length%2?c.firstChild:null));this.update()};var Au={IMPERIAL:"imperial",METRIC:"metric"};t("H.ui.UnitSystem",Au);function Bu(){this.a=this.Gj()}Bu.prototype.Gj=function(){var a=Function("return this;")(),b=a.navigator,c=[];b&&(b.msPointerEnabled?c.push(Cu):b.pointerEnabled&&c.push(Du));1>c.length&&("TouchEvent"in a&&c.push(Eu),c.push(Fu));return c};Bu.prototype.detectEventSets=Bu.prototype.Gj;Bu.prototype.addEventListener=function(a,b,c,d){for(var e=this.a,f,g=e.length,h=!1;g--;)if(f=e[g][b])h=!0,a.addEventListener(f,c,d||!1);h||a.addEventListener(b,c,d||!1)};
Bu.prototype.removeEventListener=function(a,b,c,d){for(var e=this.a,f,g=e.length,h=!1;g--;)if(f=e[g][b])h=!0,a.removeEventListener(f,c,d||!1);h||a.removeEventListener(b,c,d||!1)};
var Du={start:"pointerdown",end:"pointerup",move:"pointermove",cancel:"pointercancel",over:"pointerover",out:"pointerout",hover:"pointerhover"},Cu={start:"MSPointerDown",end:"MSPointerUp",move:"MSPointerMove",cancel:"MSPointerCancel",over:"MSPointerOver",out:"MSPointerOut",hover:"MSPointerHover"},Eu={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},Fu={start:"mousedown",end:"mouseup",move:"mousemove",over:"mouseover",out:"mouseout",hover:"mousehover"};function ou(a,b,c,d){a=a.createElement(b);c&&(a.className=c);d&&(a.innerHTML=d);return a}function yu(a,b){for(var c=1,d=arguments.length;c<d;c++)a.appendChild(arguments[c])}var Gu=new Bu;function Hu(a,b,c){Gu.addEventListener(a,b,c,void 0)}function Iu(a,b,c){Gu.removeEventListener(a,b,c,void 0)};var Ju=[];t("H.ui.i18n.defaultLocales",Ju);var Ku={},Lu=[];function Mu(a,b){Ku[a]=b;-1===Ju.indexOf(a)&&Ju.push(a);Lu.length?Nu(a,b):Lu=Object.keys(b)}function Nu(a,b){for(var c=Lu,d=c.length,e;d--;)if(e=c[d],!b[e])throw Error("'"+e+"' key missing in translation map for "+a);};Mu("nl-NL",{"layers.normal":"Kaartweergave","layers.satellite":"Satelliet","layers.terrain":"Terrein","layer.transit":"Openbaar vervoer","layer.traffic":"Verkeerssituatie","layer.incidents":"Toon verkeersincidenten","layers.choose":"Weergave kiezen",minimap:"Minimap","scale.switchToImperial":"Overgaan naar mijlen","scale.switchToMetric":"Wijzigen naar km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Uitzoomen","zoom.in":"Inzoomen","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Openbaar vervoer",
"traffic.MISCELLANEOUS":"Diversen","traffic.ACCIDENT":"Ongeval","traffic.OTHER_NEWS":"Meer informatie","traffic.PLANNED_EVENT":"Geplande afzetting","traffic.ROAD_HAZARD":"Gevaar op de weg","traffic.ROAD_CLOSURE":"Rijbaan afgesloten","traffic.WEATHER":"Weer","traffic.CONGESTION":"Verkeersopstopping","traffic.CONSTRUCTION":"Wegwerkzaamheden","traffic.DISABLED_VEHICLE":"Voertuig met pech","traffic.from":"Begintijd:","traffic.until":"Geschatte eindtijd:","distance.measurement":"Measure distance"});Mu("pt-PT",{"layers.normal":"Vista do mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transportes p\u00fablicos","layer.traffic":"Condi\u00e7\u00f5es de tr\u00e2nsito","layer.incidents":"Mostrar incidentes de tr\u00e2nsito","layers.choose":"Escolher vista",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Diminuir","zoom.in":"Aumentar",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transportes p\u00fablicos","traffic.MISCELLANEOUS":"Diversos","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras not\u00edcias","traffic.PLANNED_EVENT":"Evento planeado","traffic.ROAD_HAZARD":"Perigo na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Meteorologia","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Constru\u00e7\u00e3o","traffic.DISABLED_VEHICLE":"Ve\u00edculo avariado","traffic.from":"Hora de in\u00edcio:",
"traffic.until":"Hora de fim prevista:","distance.measurement":"Measure distance"});Mu("ru-RU",{"layers.normal":"\u0420\u0435\u0436\u0438\u043c \u043a\u0430\u0440\u0442\u044b","layers.satellite":"\u0421\u043f\u0443\u0442\u043d\u0438\u043a\u043e\u0432\u0430\u044f","layers.terrain":"\u041c\u0435\u0441\u0442\u043d\u043e\u0441\u0442\u044c","layer.transit":"\u041e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442","layer.traffic":"\u0414\u043e\u0440\u043e\u0436\u043d\u044b\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f",
"layer.incidents":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0434\u043e\u0440\u043e\u0436\u043d\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f","layers.choose":"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0438\u0434",minimap:"Minimap","scale.switchToImperial":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0438\u043b\u0438","scale.switchToMetric":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u0438\u043b\u043e\u043c\u0435\u0442\u0440\u044b",
"scale.km":"\u043a\u043c","scale.m":"\u043c","scale.mi":"\u043c\u0438\u043b\u044c","scale.ft":"\u0444\u0443\u0442","zoom.out":"\u041e\u0442\u0434\u0430\u043b\u0438\u0442\u044c","zoom.in":"\u041f\u0440\u0438\u0431\u043b\u0438\u0437\u0438\u0442\u044c","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u041e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442","traffic.MISCELLANEOUS":"\u041f\u0440\u043e\u0447\u0435\u0435 \u0414\u0422\u041f",
"traffic.ACCIDENT":"\u0414\u0422\u041f","traffic.OTHER_NEWS":"\u0414\u0440\u0443\u0433\u0438\u0435 \u043d\u043e\u0432\u043e\u0441\u0442\u0438","traffic.PLANNED_EVENT":"\u041f\u043b\u0430\u043d\u043e\u0432\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435","traffic.ROAD_HAZARD":"\u0414\u043e\u0440\u043e\u0436\u043d\u0430\u044f \u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c","traffic.ROAD_CLOSURE":"\u0414\u043e\u0440\u043e\u0433\u0430 \u0437\u0430\u043a\u0440\u044b\u0442\u0430",
"traffic.WEATHER":"\u041f\u043e\u0433\u043e\u0434\u0430","traffic.CONGESTION":"\u041f\u0440\u043e\u0431\u043a\u0430","traffic.CONSTRUCTION":"\u0420\u0435\u043c\u043e\u043d\u0442","traffic.DISABLED_VEHICLE":"\u041d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u044b\u0439 \u0430\u0432\u0442\u043e\u043c\u043e\u0431\u0438\u043b\u044c","traffic.from":"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430:","traffic.until":"\u041e\u0436\u0438\u0434\u0430\u0435\u043c\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f:",
"distance.measurement":"\u0418\u0437\u043c\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0441\u0441\u0442\u043e\u044f\u043d\u0438\u0435"});Mu("fi-FI",{"layers.normal":"Karttan\u00e4kym\u00e4","layers.satellite":"Satelliitti","layers.terrain":"Maasto","layer.transit":"Julkinen liikenne","layer.traffic":"Liikenneolosuhteet","layer.incidents":"N\u00e4yt\u00e4 liikennetapahtumat","layers.choose":"Valitse n\u00e4kym\u00e4",minimap:"Minimap","scale.switchToImperial":"Vaihda maileihin","scale.switchToMetric":"Vaihda kilometreihin","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Loitonna","zoom.in":"L\u00e4henn\u00e4",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Julkinen liikenne","traffic.MISCELLANEOUS":"Erittelem\u00e4t\u00f6n syy","traffic.ACCIDENT":"Onnettomuus","traffic.OTHER_NEWS":"Muu tapahtuma","traffic.PLANNED_EVENT":"Suunniteltu tapahtuma","traffic.ROAD_HAZARD":"Vaara tiell\u00e4","traffic.ROAD_CLOSURE":"Tie suljettu","traffic.WEATHER":"S\u00e4\u00e4","traffic.CONGESTION":"Ruuhka","traffic.CONSTRUCTION":"Rakennusty\u00f6","traffic.DISABLED_VEHICLE":"Pys\u00e4htynyt ajoneuvo","traffic.from":"Alkamisaika:",
"traffic.until":"Arvioitu p\u00e4\u00e4ttymisaika:","distance.measurement":"Measure distance"});Mu("pt-BR",{"layers.normal":"Exibi\u00e7\u00e3o do mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transporte p\u00fablico","layer.traffic":"Condi\u00e7\u00f5es do tr\u00e2nsito","layer.incidents":"Mostrar incidentes no tr\u00e2nsito","layers.choose":"Escolher exibi\u00e7\u00e3o",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"milhas","scale.ft":"p\u00e9s","zoom.out":"Menos zoom",
"zoom.in":"Mais zoom","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transporte p\u00fablico","traffic.MISCELLANEOUS":"Miscel\u00e2nea","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras not\u00edcias","traffic.PLANNED_EVENT":"Evento planejado","traffic.ROAD_HAZARD":"Risco na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Clima","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Constru\u00e7\u00e3o","traffic.DISABLED_VEHICLE":"Ve\u00edculo incapacitado",
"traffic.from":"Hora de in\u00edcio:","traffic.until":"Tempo final estimado:","distance.measurement":"Measure distance"});Mu("zh-CN",{"layers.normal":"\u5730\u56fe\u89c6\u56fe","layers.satellite":"\u536b\u661f","layers.terrain":"\u5730\u5f62","layer.transit":"\u516c\u5171\u4ea4\u901a","layer.traffic":"\u4ea4\u901a\u60c5\u51b5","layer.incidents":"\u663e\u793a\u4ea4\u901a\u4e8b\u4ef6","layers.choose":"\u9009\u62e9\u89c6\u56fe",minimap:"Minimap","scale.switchToImperial":"\u5207\u6362\u4e3a\u300c\u82f1\u91cc\u300d","scale.switchToMetric":"\u5207\u6362\u4e3a\u300c\u516c\u91cc\u300d","scale.km":"\u516c\u91cc","scale.m":"\u7c73",
"scale.mi":"\u82f1\u91cc","scale.ft":"\u82f1\u5c3a","zoom.out":"\u7f29\u5c0f","zoom.in":"\u653e\u5927","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u516c\u5171\u4ea4\u901a","traffic.MISCELLANEOUS":"\u7efc\u5408\u4e8b\u4ef6","traffic.ACCIDENT":"\u4ea4\u901a\u610f\u5916","traffic.OTHER_NEWS":"\u5176\u4ed6\u65b0\u95fb","traffic.PLANNED_EVENT":"\u9884\u5b9a\u4e8b\u4ef6","traffic.ROAD_HAZARD":"\u9053\u8def\u5371\u9669","traffic.ROAD_CLOSURE":"\u9053\u8def\u5df2\u5173\u95ed","traffic.WEATHER":"\u5929\u6c14",
"traffic.CONGESTION":"\u5835\u585e","traffic.CONSTRUCTION":"\u65bd\u5de5","traffic.DISABLED_VEHICLE":"\u8f66\u8f86\u629b\u951a","traffic.from":"\u5f00\u59cb\u65f6\u95f4\uff1a","traffic.until":"\u9884\u8ba1\u7ed3\u675f\u65f6\u95f4\uff1a","distance.measurement":"Measure distance"});Mu("es-ES",{"layers.normal":"Mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transporte p\u00fablico","layer.traffic":"Estado del tr\u00e1fico","layer.incidents":"Mostrar incidentes de tr\u00e1fico","layers.choose":"Elija una vista",minimap:"Minimap","scale.switchToImperial":"Cambiar a millas","scale.switchToMetric":"Cambiar a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Alejar","zoom.in":"Acercar","zoom.rectangle":"Zoom rectangle",
"traffic.MASS_TRANSIT":"Transporte p\u00fablico","traffic.MISCELLANEOUS":"Varios","traffic.ACCIDENT":"Accidente","traffic.OTHER_NEWS":"M\u00e1s noticias","traffic.PLANNED_EVENT":"Acto programado","traffic.ROAD_HAZARD":"Riesgo en carretera","traffic.ROAD_CLOSURE":"Carretera cerrada","traffic.WEATHER":"Tiempo","traffic.CONGESTION":"Atasco","traffic.CONSTRUCTION":"Construcci\u00f3n","traffic.DISABLED_VEHICLE":"Veh\u00edculo averiado","traffic.from":"Inicio:","traffic.until":"Finalizaci\u00f3n estimada:",
"distance.measurement":"Measure distance"});Mu("fr-FR",{"layers.normal":"Carte","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Transports publics","layer.traffic":"Conditions de circulation","layer.incidents":"Afficher les incidents de circulation","layers.choose":"Choisir la vue",minimap:"Minimap","scale.switchToImperial":"Passer en miles","scale.switchToMetric":"Passer en km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom arri\u00e8re","zoom.in":"Zoom avant","zoom.rectangle":"Zoom rectangle",
"traffic.MASS_TRANSIT":"Transports publics","traffic.MISCELLANEOUS":"Divers","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Autre","traffic.PLANNED_EVENT":"\u00c9v\u00e9nement pr\u00e9vu","traffic.ROAD_HAZARD":"Danger routier","traffic.ROAD_CLOSURE":"Chauss\u00e9e ferm\u00e9e","traffic.WEATHER":"M\u00e9t\u00e9o","traffic.CONGESTION":"Embouteillage","traffic.CONSTRUCTION":"Travaux","traffic.DISABLED_VEHICLE":"V\u00e9hicule en panne","traffic.from":"Date ou heure de d\u00e9but:","traffic.until":"Date et heure de fin estim\u00e9es:",
"distance.measurement":"Measure distance"});Mu("pl-PL",{"layers.normal":"Widok mapy","layers.satellite":"Satelita","layers.terrain":"Teren","layer.transit":"Transport publiczny","layer.traffic":"Warunki drogowe","layer.incidents":"Poka\u017c zdarzenia drogowe","layers.choose":"Wybierz widok",minimap:"Minimap","scale.switchToImperial":"Zmie\u0144 na mile","scale.switchToMetric":"Zmie\u0144 na km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Oddal","zoom.in":"Przybli\u017c","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transport publiczny",
"traffic.MISCELLANEOUS":"Inne zdarzenie","traffic.ACCIDENT":"Wypadek","traffic.OTHER_NEWS":"Inne wiadomo\u015bci","traffic.PLANNED_EVENT":"Zdarzenie planowane","traffic.ROAD_HAZARD":"Niebezpiecze\u0144stwo na drodze","traffic.ROAD_CLOSURE":"Jezdnia zamkni\u0119ta","traffic.WEATHER":"Pogoda","traffic.CONGESTION":"Korek","traffic.CONSTRUCTION":"Budowa","traffic.DISABLED_VEHICLE":"Uszkodzony pojazd","traffic.from":"Data rozpocz\u0119cia:","traffic.until":"Przybli\u017cona data zako\u0144czenia:","distance.measurement":"Measure distance"});Mu("de-DE",{"layers.normal":"Kartenansicht","layers.satellite":"Satellit","layers.terrain":"Gel\u00e4nde","layer.transit":"\u00d6ffentliche Verkehrsmittel","layer.traffic":"Verkehrslage","layer.incidents":"Verkehrsst\u00f6rungen anzeigen","layers.choose":"Ansicht ausw\u00e4hlen",minimap:"Minimap","scale.switchToImperial":"Umrechnung in Meilen","scale.switchToMetric":"Umrechnung in Kilometer","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Verkleinern","zoom.in":"Vergr\u00f6\u00dfern",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u00d6ffentliche Verkehrsmittel","traffic.MISCELLANEOUS":"Diverse","traffic.ACCIDENT":"Unfall","traffic.OTHER_NEWS":"Anderes Ereignis","traffic.PLANNED_EVENT":"Geplantes Ereignis","traffic.ROAD_HAZARD":"Verkehrshindernis","traffic.ROAD_CLOSURE":"Fahrbahn gesperrt","traffic.WEATHER":"Wetter","traffic.CONGESTION":"Verkehrsstau","traffic.CONSTRUCTION":"Baustelle","traffic.DISABLED_VEHICLE":"Liegengebliebenes Fahrzeug","traffic.from":"Beginn:",
"traffic.until":"Voraussichtliches Ende:","distance.measurement":"Measure distance"});Mu("tr-TR",{"layers.normal":"Harita g\u00f6r\u00fcn\u00fcm\u00fc","layers.satellite":"Uydu","layers.terrain":"Arazi","layer.transit":"Toplu ula\u015f\u0131m","layer.traffic":"Trafik durumlar\u0131","layer.incidents":"Trafik olaylar\u0131n\u0131 g\u00f6ster","layers.choose":"G\u00f6r\u00fcn\u00fcm se\u00e7",minimap:"Minimap","scale.switchToImperial":"Mile d\u00f6n\u00fc\u015ft\u00fcr","scale.switchToMetric":"Kilometreye d\u00f6n\u00fc\u015ft\u00fcr","scale.km":"km","scale.m":"m","scale.mi":"mil","scale.ft":"ft",
"zoom.out":"Uzakla\u015ft\u0131r","zoom.in":"Yak\u0131nla\u015ft\u0131r","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Toplu ula\u015f\u0131m","traffic.MISCELLANEOUS":"\u00c7e\u015fitli","traffic.ACCIDENT":"Kaza","traffic.OTHER_NEWS":"Di\u011fer haberler","traffic.PLANNED_EVENT":"Planl\u0131 etkinlik","traffic.ROAD_HAZARD":"Yol tehlikesi","traffic.ROAD_CLOSURE":"Yol kapal\u0131","traffic.WEATHER":"Hava durumu","traffic.CONGESTION":"Yo\u011funluk","traffic.CONSTRUCTION":"Yol \u00e7al\u0131\u015fmas\u0131",
"traffic.DISABLED_VEHICLE":"Ara\u00e7 ar\u0131zas\u0131","traffic.from":"Ba\u015flang\u0131\u00e7 zaman\u0131:","traffic.until":"Tahmini biti\u015f zaman\u0131:","distance.measurement":"Measure distance"});Mu("it-IT",{"layers.normal":"Vista mappa","layers.satellite":"Satellite","layers.terrain":"Terreno","layer.transit":"Mezzi pubblici","layer.traffic":"Condizioni del traffico","layer.incidents":"Mostra incidenti stradali","layers.choose":"Scegli vista",minimap:"Minimap","scale.switchToImperial":"Passa a miglia","scale.switchToMetric":"Passa a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom indietro","zoom.in":"Zoom avanti","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Mezzi pubblici",
"traffic.MISCELLANEOUS":"Varie","traffic.ACCIDENT":"Incidente","traffic.OTHER_NEWS":"Altre notizie","traffic.PLANNED_EVENT":"Evento pianificato","traffic.ROAD_HAZARD":"Strada dissestata","traffic.ROAD_CLOSURE":"Strada chiusa","traffic.WEATHER":"Maltempo","traffic.CONGESTION":"Ingorgo","traffic.CONSTRUCTION":"Lavori in corso","traffic.DISABLED_VEHICLE":"Veicolo in panne","traffic.from":"Ora di inizio:","traffic.until":"Ora di fine stimata:","distance.measurement":"Measure distance"});Mu("en-US",{"layers.normal":"Map view","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Public transport","layer.traffic":"Traffic conditions","layer.incidents":"Show traffic incidents","layers.choose":"Choose view",minimap:"Minimap","scale.switchToImperial":"Change to miles","scale.switchToMetric":"Change to km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom out","zoom.in":"Zoom in","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Public transport",
"traffic.MISCELLANEOUS":"Miscellaneous","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Other news","traffic.PLANNED_EVENT":"Planned event","traffic.ROAD_HAZARD":"Road hazard","traffic.ROAD_CLOSURE":"Roadway closed","traffic.WEATHER":"Weather","traffic.CONGESTION":"Congestion","traffic.CONSTRUCTION":"Construction","traffic.DISABLED_VEHICLE":"Disabled vehicle","traffic.from":"Start time:","traffic.until":"Estimated end time:","distance.measurement":"Measure distance"});function Ou(a,b){if(!zc(a))throw new TypeError("string locale code required");if(Da(b))Nu(a,b);else{if(-1===Ju.indexOf(a))throw Error("Default locale '"+a+"' does nto exist.");b=Ku[a]}this.a=b||{};this.b=a}t("H.ui.i18n.Localization",Ou);Ou.prototype.mn=function(){return this.b};Ou.prototype.getLocale=Ou.prototype.mn;Ou.prototype.fn=function(){return Object.keys(this.a)};Ou.prototype.getKeys=Ou.prototype.fn;Ou.prototype.Kh=function(a){return!(!this.a||!this.a[a])};Ou.prototype.hasKey=Ou.prototype.Kh;
Ou.prototype.translate=function(a){var b=this.a[a];if(!zc(b))throw Error("Translation missing for key '"+a+"'.");return b};Ou.prototype.translate=Ou.prototype.translate;function Z(a,b){F.call(this);this.Ra=a||"div";this.g=b?b.split(" "):[];this.J=!1;this.g.push("H_el")}u(Z,F);t("H.ui.base.Element",Z);Z.prototype.V=function(a){if(!a)throw Error("Wrong document object");this.S=ou(a,this.Ra,this.g.join(" "));this.renderInternal(this.S,a);this.Da(this.mc(),!0);this.sc(this.ma);this.wb(this.c);return this.S};Z.prototype.fa=function(){};Z.prototype.N=function(){};Z.prototype.$=function(){};Z.prototype.renderInternal=Z.prototype.$;Z.prototype.mc=function(){return this.J};
Z.prototype.isDisabled=Z.prototype.mc;Z.prototype.Da=function(a,b){a=!!a;if(a!==this.J||b)(this.J=a)?this.La("H_disabled"):this.qb("H_disabled");return this};Z.prototype.setDisabled=Z.prototype.Da;Z.prototype.O=null;Z.prototype.getData=function(){return this.O};Z.prototype.getData=Z.prototype.getData;Z.prototype.setData=function(a){this.O=a};Z.prototype.setData=Z.prototype.setData;Z.prototype.sc=function(a){var b=this.L();this.ma=a;b&&(a?b.setAttribute("title",a):b.removeAttribute("title"))};
Z.prototype.setTooltip=Z.prototype.sc;Z.prototype.S=null;Z.prototype.L=function(){return this.S};Z.prototype.getElement=Z.prototype.L;Z.prototype.c=!0;Z.prototype.wb=function(a){var b=this.L();this.c=a;b&&(b.style.display=a?"":"none")};Z.prototype.setVisibility=Z.prototype.wb;Z.prototype.Dc=function(){return this.c};Z.prototype.getVisibility=Z.prototype.Dc;Z.prototype.La=function(a){var b=this.L();0>this.g.indexOf(a)&&this.g.push(a);b&&(b.className=this.g.join(" "));return this};
Z.prototype.addClass=Z.prototype.La;Z.prototype.qb=function(a){a=this.g.indexOf(a);var b=this.L();-1<a&&this.g.splice(a,1);b&&(b.className=this.g.join(" "));return this};Z.prototype.removeClass=Z.prototype.qb;function Pu(a){(a=a.L())&&a.parentNode&&a.parentNode.removeChild(a)}Z.prototype.u=function(){Z.l.u.call(this);Pu(this);this.ma=this.O=this.S=null};function Qu(a,b,c){Z.call(this,a,b);this.b=c?c.concat():[]}u(Qu,Z);t("H.ui.base.Container",Qu);Qu.prototype.Da=function(a,b){var c=this.b?this.b.length:0;for(Z.prototype.Da.call(this,a,b);c--;)this.b[c].Da(a,b);return this};Qu.prototype.setDisabled=Qu.prototype.Da;Qu.prototype.Ka=function(a){var b=this.L();this.b.push(a);b&&(a.V(b.ownerDocument),b.appendChild(a.L()));return this};Qu.prototype.addChild=Qu.prototype.Ka;Qu.prototype.vh=function(){return this.b.concat()};
Qu.prototype.getChildren=Qu.prototype.vh;Qu.prototype.removeChild=function(a){var b=this.b.indexOf(a),c=this.L();0<=b&&(this.b.splice(b,1),c&&c.removeChild(a.L()))};Qu.prototype.removeChild=Qu.prototype.removeChild;Qu.prototype.qa=function(){var a=this.L();a&&this.b.forEach(function(b){a.removeChild(b.L())});this.b=[]};Qu.prototype.$=function(a,b){for(var c=0,d=this.b.length;c<d;c++)a.appendChild(this.b[c].V(b))};Qu.prototype.renderInternal=Qu.prototype.$;
Qu.prototype.u=function(){this.qa();this.b.forEach(this.W,this);Z.prototype.u.call(this)};Qu.prototype.W=function(a){a.B()};function Ru(a){C(a,Oe,Ru,1);Z.call(this,"div","H_context_menu_item");this.b=a;this.f=A(this.f,this);this.a=A(this.a,this);this.b.addEventListener("update",this.a)}u(Ru,Z);t("H.ui.context.Item",Ru);Ru.prototype.f=function(a){var b=this.b,c=b.callback;c&&!b.isDisabled()&&(this.dispatchEvent("click"),c(a))};Ru.prototype.$=function(){var a=this,b=this.L();Be(b,"click",this.f);b.addEventListener("keyup",function(c){13==c.keyCode&&a.f(c)});this.a()};Ru.prototype.renderInternal=Ru.prototype.$;
Ru.prototype.a=function(){var a=this.L(),b=this.b;b.callback?(this.La("clickable"),a.setAttribute("tabindex","0")):(this.qb("clickable"),a.removeAttribute("tabindex"));b.isDisabled()?this.La("disabled"):this.qb("disabled");b=b.getLabel();Su.textContent=b;a.innerHTML=Su.innerHTML.split("\n").join("<br/>")};Ru.prototype.u=function(){Z.prototype.u.call(this);this.b.removeEventListener("update",this.a)};function Tu(a){C(a,Array,Tu,1);Qu.call(this,"div","H_context_menu");this.f=a;this.a=null}u(Tu,Qu);t("H.ui.context.Menu",Tu);Tu.prototype.$=function(){Qu.prototype.$.apply(this,arguments);this.f.forEach(function(a){a===Pe?a=new Z("div","H_context_menu_item_separator"):(a=new Ru(a),a.addEventListener("click",this.i.bind(this)));this.Ka(a)},this);Be(this.L(),["mousedown","touchstart","pointerdown","wheel"],function(a){a.stopPropagation()})};Tu.prototype.renderInternal=Tu.prototype.$;
Tu.prototype.setPosition=function(a,b){if(this.a){var c=this.L();var d=c.offsetWidth;var e=c.offsetHeight;var f=this.a;var g=f.ya.width;f=f.ya.height;a+d>g&&a>g/2&&(a-=d);b+e>f&&b>f/2&&(b-=e);lu(c,a,b)}};Tu.prototype.setPosition=Tu.prototype.setPosition;Tu.prototype.i=function(){this.a&&this.a.dispatchEvent(new rd("contextmenuclose",this.a))};Tu.prototype.Ja=function(a){this.a=a};Tu.prototype.setMap=Tu.prototype.Ja;function Uu(a,b){b=b||{};var c=this;Z.call(this,"div","H_ib H_ib_top");this.v=A(function(d){c.mc()||(c.close(),d.preventDefault())},this);this.update=A(this.update,this);this.i=A(this.i,this);this.setPosition(a);this.xf(b.content);b.onStateChange&&this.addEventListener("statechange",b.onStateChange);this.P(Vu.OPEN)}u(Uu,Z);t("H.ui.InfoBubble",Uu);Uu.prototype.a=null;Uu.prototype.Ca=function(){return this.b};Uu.prototype.setPosition=function(a){this.b=Zf(a);this.update()};
Uu.prototype.setPosition=Uu.prototype.setPosition;Uu.prototype.Ja=function(a){this.a=a};
Uu.prototype.$=function(a,b){this.o=ou(b,"div","H_ib_body");this.tailEl_=ou(b,"div","H_ib_tail");this.j=ou(b,"div","H_ib_close H_btn",Wu);this.f=ou(b,"div","H_ib_content","&nbsp;");this.o.appendChild(this.j);this.o.appendChild(this.f);Hu(this.j,"start",this.v);this.a.b.addEventListener("sync",this.update);this.a.ya.addEventListener("sync",this.update);this.a.addEventListener("enginechange",this.i);a.appendChild(this.o);a.appendChild(this.tailEl_);this.xf(this.m)};
Uu.prototype.renderInternal=Uu.prototype.$;Uu.prototype.i=function(){this.s||(this.s=setTimeout(this.update,0))};Uu.prototype.update=function(){var a=this.L(),b=this.a,c,d="none";this.s=0;if(b&&a&&this.getState()===Vu.OPEN){if(c=b.Fa(this.b)){var e=c.x;c=c.y;b=b.ya.width;if(e>=-b||e<=2*b||c>=-b||c<=2*b)d="",Xu?(a.style.left=e-b+"px",a.style.top=c+"px"):lu(a,e,c)}a.style.display=d;""===d&&(a.style.visibility="visible")}};var Vu={OPEN:"open",CLOSED:"closed"};Uu.State=Vu;Uu.prototype.A=Vu.OPEN;
Uu.prototype.getState=function(){return this.A};Uu.prototype.getState=Uu.prototype.getState;Uu.prototype.P=function(a){a!==this.A&&(this.A=a,this.dispatchEvent("statechange"));if(a=this.L())this.A===Vu.OPEN?(a.style.display="block",a.style.visibility="hidden",this.i()):a.style.display="none"};Uu.prototype.setState=Uu.prototype.P;Uu.prototype.close=function(){this.P(Vu.CLOSED)};Uu.prototype.close=Uu.prototype.close;Uu.prototype.open=function(){this.P(Vu.OPEN)};Uu.prototype.open=Uu.prototype.open;
Uu.prototype.Km=function(){return this.f||null};Uu.prototype.getContentElement=Uu.prototype.Km;
Uu.prototype.xf=function(a){if(a)if("string"===typeof a||"number"===typeof a.nodeType&&"string"===typeof a.nodeName)this.m=a;else throw Error("InfoBubble content must be a string or HTML node.");else this.m=void 0;this.L()&&(this.m?(this.f.innerHTML="","string"===typeof this.m?this.f.innerHTML=a:"number"===typeof a.nodeType&&"string"===typeof a.nodeName&&this.f.appendChild(a)):this.f.innerHTML="&nbsp;",this.i())};Uu.prototype.setContent=Uu.prototype.xf;
Uu.prototype.u=function(){this.close();this.xf(null);this.j&&Iu(this.j,"end",this.v);this.a&&(this.a.b.removeEventListener("sync",this.update),this.a.ya.removeEventListener("sync",this.update));Z.prototype.u.call(this)};var Wu='<svg version="1.1" class="H_icon" viewBox="0 0 12 12"><path d="m8.12 6 3.66-3.66c.29-.29.29-.76 0-1.05l-1.06-1.06c-.29-.29-.76-.29-1.05 0l-3.66 3.66-3.66-3.66c-.29-.29-.76-.29-1.05 0l-1.06 1.06c-.29.29-.3.76 0 1.05l3.66 3.66-3.66 3.66c-.29.29-.29.76 0 1.05l1.06 1.06c.29.29.76.29 1.05 0l3.66-3.66 3.66 3.66c.29.29.76.29 1.05 0l1.06-1.06c.29-.29.3-.76 0-1.05z"></path></svg>';function Yu(a){this.c=a;this.a=this.b=null;this.i=0;this.g=22;this.f=A(this.f,this);a=this.c.jc();a.addEventListener("mapviewchange",this.o,!1,this);a=a.a;a.addEventListener("add",this.j,!1,this);a.addEventListener("remove",this.m,!1,this)}function Zu(a,b){a.b&&b&&a.b===b.ga()||(a.b&&a.b.removeEventListener("tap",a.f),b?(a.b=b.ga(),a.b.addEventListener("tap",a.f),a.i=a.b.min,a.g=a.b.max):(a.b=null,a.i=0,a.g=22))}
Yu.prototype.o=function(a){var b=a.newValue.zoom;this.a&&a.modifiers&a.ZOOM&&(b<this.i||b>this.g)&&this.a.close()};Yu.prototype.j=function(a){a=a.added;$u(a)&&Zu(this,a)};Yu.prototype.m=function(a){$u(a.removed)&&(this.a&&this.a.close(),Zu(this,null))};function $u(a){return window.H.service&&a.ga()instanceof window.H.service.traffic.incidents.Provider}
Yu.prototype.f=function(a){var b;if(a.target&&(b=a.target.getData())&&0===a.currentPointer.button){this.a||(this.a=new Uu(a.target.ba()),this.a.La("H_tib"),this.c.sj(this.a));this.a.setPosition(a.target.ba());var c=b.TRAFFIC_ITEM_TYPE_DESC.replace(" ","_");this.c.Ba().Kh("traffic."+c)?c=this.c.Ba().translate("traffic."+c):c=b.TRAFFIC_ITEM_DESCRIPTION[b.TRAFFIC_ITEM_DESCRIPTION.length-1].value;this.a.xf('<div class="H_tib_content"><div class="H_rdo_title" dir="auto">{{title}}</div><div class="H_tib_desc" dir="auto"><span>{{desc}}</span><div class="H_tib_time"><span class="H_tib_left">{{traffic.from}}</span><span class="H_tib_right">{{from}}</span><br/><span class="H_tib_left">{{traffic.until}}</span><span class="H_tib_right">{{until}}</span></div></div>'.replace("{{title}}",
c).replace("{{desc}}",b.TRAFFIC_ITEM_DESCRIPTION[0].value).replace("{{traffic.from}}",this.c.Ba().translate("traffic.from")).replace("{{traffic.until}}",this.c.Ba().translate("traffic.until")).replace("{{from}}",b.START_TIME).replace("{{until}}",b.END_TIME));this.a.open()}a.stopPropagation()};function av(a,b){var c=a.L(),d=this;F.call(this);this.a=a;this.i=c.ownerDocument;this.f={};this.c=[];new Yu(this);this.S=ou(this.i,"div","H_ui");this.setDirection();this.C=A(function(e){this.o.put(e.target,e.target.Vc)},this);this.addEventListener("alignmentchange",this.C);this.J=A(function(){this.Pl()},this);this.addEventListener("toggleunitsystem",this.J);this.S.addEventListener("contextmenu",this.v,!1);this.S.addEventListener("MSHoldVisual",this.v,!1);this.a.addEventListener("contextmenu",
this.O,!1,this);this.a.addEventListener("contextmenuclose",this.s,!1,this);this.a.zb(this.B.bind(this));this.b=null;this.m=-1;this.o=new nu(this.S,this.i);this.g=Au.METRIC;bv(this,"en-US");b&&cv(this,b);c.appendChild(this.S);x.setTimeout(function(){d.o.update()},1)}u(av,F);t("H.ui.UI",av);av.prototype.v=function(a){for(var b=a.target;b&&!/\bH_ib_content\b/.test(b.className);)b=b.parentNode;b||a.preventDefault()};av.prototype.L=function(){return this.S};av.prototype.getElement=av.prototype.L;
av.prototype.jc=function(){return this.a};av.prototype.getMap=av.prototype.jc;av.prototype.Qn=function(){return this.g};av.prototype.getUnitSystem=av.prototype.Qn;av.prototype.Jg=function(a){var b=this.f,c;if(a!==this.g)for(c in this.g=a,b)if(b[c]instanceof dv)b[c].onUnitSystemChange(this.g)};av.prototype.setUnitSystem=av.prototype.Jg;av.prototype.setDirection=function(a){this.S.setAttribute("dir",a||getComputedStyle(this.jc().L()).direction)};av.prototype.setDirection=av.prototype.setDirection;
function bv(a,b){if(zc(b))var c=b;else if(b instanceof Ou){c=b.b;var d=b}else throw Error("The locale parameter must be a string or a H.ui.i18n.Localization object.");if(c)if(d)a.j=d;else if(0<=Ju.indexOf(c))a.j=new Ou(c);else throw Error("Locale ["+c+"] is not supported.");else throw Error("No locale was defined.");}av.prototype.Ba=function(){return this.j};av.prototype.Pl=function(){this.g===Au.METRIC?this.Jg(Au.IMPERIAL):this.Jg(Au.METRIC)};av.prototype.toggleUnitSystem=av.prototype.Pl;
av.prototype.sj=function(a){var b=this.c.length,c=this.S;if(0>this.c.indexOf(a)){a.ka(this);a.Ja(this.a);var d=a.V(this.i);b=0<b?this.c[b-1].L().nextSibling:this.S.firstChild;c.insertBefore(d,b);this.c.push(a)}};av.prototype.addBubble=av.prototype.sj;
av.prototype.O=function(a){var b=a.items;this.b&&this.s();clearTimeout(this.m);this.m=x.setTimeout(function(){b.length&&(this.b=new Tu(b),this.S.insertBefore(this.b.V(this.i),this.S.firstChild),this.b.ka(this),this.b.Ja(this.a),this.b.setPosition(a.viewportX,a.viewportY))}.bind(this),0)};av.prototype.s=function(){this.b&&(this.b.B(),this.b=null)};av.prototype.Ro=function(a){var b=this.c.indexOf(a);-1<b&&(a.ka(null),a.Ja(null),this.c.splice(b,1),this.S.removeChild(a.L()))};
av.prototype.removeBubble=av.prototype.Ro;av.prototype.Gm=function(){return this.c};av.prototype.getBubbles=av.prototype.Gm;av.prototype.Od=function(a,b){if(this.Ve(a))throw Error("A control with name ["+a+"] is already registered.");b.ka(this);b.Ja(this.a);b.Xa=this.j;b.V(this.i);b.onUnitSystemChange(this.g);this.f[a]=b};av.prototype.addControl=av.prototype.Od;
av.prototype.To=function(a){var b=this.Ve(a);if(b)b.N(),b.ka(null),b.Ja(null),Pu(b),delete this.f[a];else throw Error("Control ["+a+"] not found in this UI's controls.");return b};av.prototype.removeControl=av.prototype.To;av.prototype.Ve=function(a){return this.f[a]};av.prototype.getControl=av.prototype.Ve;
av.prototype.u=function(){for(var a in this.f)ju.hasOwnProperty.call(this.f,a)&&this.f[a].B();this.c.forEach(function(b){b.B()});(a=this.S.parentNode)&&a.removeChild(this.S);F.prototype.u.call(this);this.S=null};
function cv(a,b){var c,d;b.unitSystem&&a.Jg(b.unitSystem);(d=b.locale)&&bv(a,d);(c=b.zoom)&&a.Od("zoom",new ev(Da(c)?c:null));(c=b.zoomrectangle)&&a.Od("zoomrectangle",new fv(Da(c)?c:null));(c=b.mapsettings)&&a.Od("mapsettings",new gv(Da(c)?c:null));(c=b.scalebar)&&a.Od("scalebar",new hv(Da(c)?c:null));(c=b.distancemeasurement)&&a.Od("distancemeasurement",new iv(Da(c)?c:null))}
av.prototype.capture=function(a,b,c,d){var e=this.Ve("scalebar"),f=a.getContext("2d"),g=a.width,h=a.height,k=this.a.m,l=5+(k?k.L().childNodes[1].offsetHeight:0);e&&e.Dc()?e.capture(b,function(m){f.drawImage(m,g-m.width-5*b,h-m.height-l*b);c(a)},d):c(a)};av.prototype.capture=av.prototype.capture;
av.createDefault=function(a,b,c){var d=a.ic().type;c=new av(a,{unitSystem:Au.METRIC,zoom:{alignment:"right-bottom"},mapsettings:jv(d,b,a.c),scalebar:{alignment:"bottom-right"},locale:c||"en-US"});if(d===Al.P2D){var e=c.Ve("mapsettings");var f=function(){if(e.jc()){var g=jv(d,b,a.c);kv(e,g.baseLayers,g.layers)}};a.addEventListener(a.o.Ff,f);c.zb(function(){a.removeEventListener(a.o.Ff,f)});e.zb(function(){a.removeEventListener(a.o.Ff,f)})}return c};
function jv(a,b,c){var d=b.raster;b=b.vector.normal;var e;if(a===Al.P2D){a=[{label:"layers.normal",layer:d.normal.map},{label:"layers.satellite",layer:d.satellite.map},{label:"layers.terrain",layer:d.terrain.map}];if(c)for(e in d)if(d[e].map===c){var f=e;break}c=[{label:"layer.incidents",layer:d.normal.trafficincidents},{label:"layer.transit",layer:f&&d[f].transit}]}else a=[{label:"layers.normal",layer:b.map},{label:"layers.satellite",layer:d.satellite.map}],c=[{label:"layer.traffic",layer:b.traffic},
{label:"layer.incidents",layer:b.trafficincidents}];return{alignment:"bottom-right",baseLayers:a,layers:c}};function lv(a){a=a||{};Z.call(this,"div","H_btn");this.Qc(a.label||" ");this.sc(a.tooltip||"");this.setData(a.data);this.Da(!!a.disabled);this.P(mv.UP,!0);a.onStateChange&&this.addEventListener("statechange",a.onStateChange);this.f=A(this.f,this);this.b=A(this.b,this)}u(lv,Z);t("H.ui.base.Button",lv);lv.prototype.Da=function(a,b){a&&this.qb("H_active");return lv.l.Da.call(this,a,b)};
lv.prototype.$=function(a){Hu(a,"start",this.f);Hu(a,"end",this.b);Hu(a,"out",this.b);this.Qc(this.Ye(),!0)};lv.prototype.renderInternal=lv.prototype.$;lv.prototype.getState=function(){return this.A};lv.prototype.getState=lv.prototype.getState;lv.prototype.P=function(a,b){a!==this.A&&(this.A=a,a===mv.DOWN?this.La("H_active"):this.qb("H_active"),b||this.dispatchEvent("statechange"));return this};lv.prototype.setState=lv.prototype.P;lv.prototype.Ye=function(){return this.a};
lv.prototype.getLabel=lv.prototype.Ye;lv.prototype.Qc=function(a,b){if(b||a!==this.a)if(this.a=a,b=this.L())b.innerHTML=a;return this};lv.prototype.setLabel=lv.prototype.Qc;lv.prototype.f=function(a){this.mc()||this.P(mv.DOWN);a.preventDefault()};lv.prototype.b=function(a){this.mc()||this.P(mv.UP);a.preventDefault()};lv.prototype.u=function(){var a=this.L();a&&(Iu(a,"start",this.f),Iu(a,"end",this.b),Iu(a,"out",this.b));Z.prototype.u.call(this)};var mv={UP:"up",DOWN:"down"};lv.State=mv;function nv(a){a=a||{};var b;this.f=!!a.vertical;this.W=a.length||"16em";this.a=Cc(b=a.min)?b:0;this.m=wd(this.a,Cc(b=a.max)?b:100);this.za=E(b=a.step)?1:b;this.o=ov(this,Cc(b=a.value)?b:(this.a+this.m)/2);this.sg=A(this.sg,this);this.og=A(this.og,this);this.ug=A(this.ug,this);this.tg=A(this.tg,this);this.b=a.pointerArea;Z.call(this,"div","H_slider"+(this.f?"":" H_l_horizontal"))}u(nv,Z);t("H.ui.base.Slider",nv);
nv.prototype.Kg=function(a,b){var c=this.f,d=c?"top":"left";if(!this.i||b)a=Yd(a,this.a,this.m),this.j&&(b=100*(a-this.a)/(this.m-this.a),c=(c?-1:1)*b,this.j.style[d]=c+"%",this.Xa.style[d]=100+c+"%"),this.o=ov(this,a);return this.o};nv.prototype.setValue=nv.prototype.Kg;nv.prototype.Rn=function(){return this.o};nv.prototype.getValue=nv.prototype.Rn;function pv(a){a.s||(Hu(a.L(),"start",a.sg),Hu(a.b,"move",a.og),Hu(a.b,"end",a.ug),Hu(a.b,"out",a.tg),a.s=!0)}
function qv(a){a.s&&(Iu(a.L(),"start",a.sg),Iu(a.b,"move",a.og),Iu(a.b,"end",a.ug),Iu(a.b,"out",a.tg),a.s=!1)}function ov(a,b){var c=a.za;b=Yd(b,a.a,a.m);return c?a.a+xd((b-a.a)/c)*c:b}function rv(a,b){var c=a.C,d=a.f;a.v||(a.v=c["offset"+(d?"Height":"Width")]);b-=ku(c)[d?"y":"x"];0>b&&(b=0);b=(a.m-a.a)*b/a.v;b=ov(a,d?a.m-b:a.a+b);a.o!==b&&(a.Kg(b,!0),a.dispatchEvent(new Ng(a.Kk.nd,b,a.o)))}function sv(a,b){return(b.touches?b.targetTouches[0]:b)["page"+(a.f?"Y":"X")]}
function tv(a){var b=!1,c=a.type;-1!==c.indexOf("pointer")||-1!==c.indexOf("touch")?b=!0:C(a,MouseEvent)&&(b=1===a.which||1===a.buttons);return b}function uv(a){var b=a.touches;return b&&1===b.length||C(a,MouseEvent)}n=nv.prototype;
n.sg=function(a){var b=this.f;if(tv(a)&&uv(a)){var c=sv(this,a);var d=a.target;d===this.j||d.parentElement===this.j?(this.U=c-ku(this.j)[b?"y":"x"]-this.j.offsetWidth/2,this.L().className="H_slider H_slider_active"+(this.f?"":" H_l_horizontal"),this.i=!0):rv(this,c);a.preventDefault()}};n.ug=function(){this.i&&(this.L().className="H_slider "+(this.f?"":" H_l_horizontal"),this.i=!1)};n.tg=function(a){this.i&&a.target===this.b&&(this.i=!1)};
n.og=function(a){this.i&&uv(a)&&(tv(a)?(rv(this,sv(this,a)-this.U),a.preventDefault()):this.i=!1)};n.Kk={nd:"change"};
n.$=function(a,b){var c=ou(b,"div","H_slider_cont"),d=ou(b,"div","H_slider_knob_cont"),e=ou(b,"div","H_slider_knob"),f=ou(b,"div","H_slider_knob_halo"),g=ou(b,"div","H_slider_track");b=ou(b,"div","H_slider_track H_slider_track_active");a.appendChild(c);c.appendChild(g);g.appendChild(b);c.appendChild(d);d.appendChild(e);d.appendChild(f);this.C=g;this.Xa=b;this.j=d;this.b||(this.b=a.ownerDocument.body);c.style[this.f?"height":"width"]=this.W;this.Kg(this.o);pv(this)};
nv.prototype.renderInternal=nv.prototype.$;nv.prototype.u=function(){qv(this)};nv.prototype.Da=function(a,b){a?qv(this):this.C&&pv(this);return Z.prototype.Da.call(this,a,b)};nv.prototype.setDisabled=nv.prototype.Da;var vv={"in":'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g><path d="m5 10.6h5.6v-5.6h2.8v5.6h5.6v2.8h-5.6v5.6h-2.8v-5.6h-5.6v-2.8z"></path></g></svg>',out:'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><path d="m5 10.6h14v2.8h-14z"/></svg>'};function dv(){Qu.call(this,"div","H_ctl");this.map=null;this.Vc="top-left"}u(dv,Qu);t("H.ui.Control",dv);dv.prototype.Ja=function(a){this.map=a};dv.prototype.V=function(a){return Qu.prototype.V.call(this,a)};dv.prototype.$=function(a,b){Qu.prototype.renderInternal.call(this,a,b);this.Zb(this.Vc)};dv.prototype.renderInternal=dv.prototype.$;dv.prototype.kf=function(){};dv.prototype.onUnitSystemChange=dv.prototype.kf;dv.prototype.jc=function(){return this.map};dv.prototype.getMap=dv.prototype.jc;
dv.prototype.Ba=function(){return this.Xa};dv.prototype.getLocalization=dv.prototype.Ba;dv.prototype.Bm=function(){return this.Vc};dv.prototype.getAlignment=dv.prototype.Bm;dv.prototype.Zb=function(a){"string"===typeof a&&mu[a.replace("-","_").toUpperCase()]===a&&(this.Vc=a,this.dispatchEvent("alignmentchange"));return this};dv.prototype.setAlignment=dv.prototype.Zb;function ev(a){a=a||{};var b=a.slider;dv.call(this);this.o=A(this.o,this);this.i=A(this.i,this);this.a=A(this.a,this);b&&(this.v=A(this.v,this),this.C=b,this.Aa=a.sliderSnaps,this.La("H_zoom_slider"));this.j=new lv({label:vv["in"],onStateChange:this.o});this.s=new lv({label:vv.out,onStateChange:this.o});this.La("H_zoom");this.La("H_grp");this.za=!1!==a.fractionalZoom;this.setZoomSpeed(a.zoomSpeed||4);this.Zb(a.alignment||"right-middle")}u(ev,dv);t("H.ui.ZoomControl",ev);
ev.prototype.Wn=function(){return this.U};ev.prototype.getZoomSpeed=ev.prototype.Wn;ev.prototype.fp=function(a){this.U=a};ev.prototype.setZoomSpeed=ev.prototype.fp;ev.prototype.Ja=function(a){this.map!==a&&(this.map&&this.map.removeEventListener("mapviewchange",this.i),wv(this));dv.prototype.Ja.apply(this,arguments);this.map&&(this.a(),a.addEventListener("mapviewchange",this.i),a.addEventListener("baselayerchange",this.a))};ev.prototype.setMap=ev.prototype.Ja;
ev.prototype.u=function(){dv.prototype.u.apply(this,arguments);this.map.removeEventListener("baselayerchange",this.a);wv(this)};ev.prototype.$=function(a,b){dv.prototype.renderInternal.call(this,a,b);this.j.sc(this.Ba().translate("zoom.in"));this.s.sc(this.Ba().translate("zoom.out"))};ev.prototype.renderInternal=ev.prototype.$;ev.prototype.Zb=function(a){var b=this.Vc;dv.prototype.Zb.call(this,a);b!==a&&this.a();return this};ev.prototype.setAlignment=ev.prototype.Zb;
ev.prototype.i=function(){var a=this.map,b=a.vb(),c=a.$a()-1;a=a.c||a.ic().getCapabilities().lookAt.zoom;this.C&&this.f.Kg(b);this.mc()||(this.j.Da(b+c>=a.max),this.s.Da(b<=a.min))};ev.prototype.Da=function(a,b){ev.l.Da.call(this,a,b);this.i();return this};ev.prototype.setDisabled=ev.prototype.Da;function wv(a){a.removeChild(a.f);a.f=null;a.m&&(a.m.removeEventListener("minchange",a.a),a.m.removeEventListener("maxchange",a.a),a.m=null)}
ev.prototype.o=function(a){a=a.target;var b=a===this.j?1:-1,c=0<b?Math.ceil:Math.floor,d=this.map,e,f=this;d&&("down"===a.getState()?(d.b.startControl(),d.b.control(0,0,b*this.U,0,0,0)):d.b.endControl(!0,function(g){e=f.za?g.zoom:c(g.zoom);g.zoom=e}))};ev.prototype.v=function(a){this.map&&this.map.zf(a.newValue)};
ev.prototype.a=function(){var a=this.Vc,b=this.jc();if(/^top/g.test(a)||/^bottom/g.test(a)){var c=this.s;a=this.j;var d=!1}else c=this.j,a=this.s,d=!0;this.removeChild(c);this.removeChild(a);this.Ka(c);if(this.C&&b){wv(this);b=d;var e=(d=(c=this.map)&&c.c)||c.ic().getCapabilities().lookAt.zoom;if(this.m=d)d.addEventListener("minchange",this.a),d.addEventListener("maxchange",this.a);this.f=new nv({step:this.Aa?1:0,vertical:b,min:e.min,max:e.max,value:c.vb(),pointerArea:c.L()});this.f.addEventListener(this.f.Kk.nd,
this.v);this.Ka(this.f)}this.Ka(a)};var xv={btn:'<svg class="H_icon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"><g transform="translate(3 2)"><path d="m18 13v7h-18v-7h2v5h2v-2h2v2h2v-3h2v3h2v-2h2v2h2v-5z"></path><path d="m2.3.3c.7 0 1.3.1 1.8.4s.9.6 1.1 1 .4.9.4 1.4c0 .5-.1 1-.3 1.4s-.57 1-1 1.6-1.3 1.3-2.3 2.2h3.9l-.2 1.7h-6.16v-1.6c1.1-1.1 2-2 2.5-2.6s.9-1 1-1.4.3-.8.3-1.2c0-.4-.1-.7-.3-.9s-.5-.3-.9-.3c-.3 0-.6 0-.9.2s-.5.4-.8.7l-1.3-1c.4-.5.9-.9 1.4-1.2s1.2-.4 1.8-.4zm14.4 9.7h-2.3l-.2-3.8c 0-.9-.1-1.7-.1-2.4 0-.5 0-1 0-1.5l-1.5 6.7h-2.2l-1.6-6.7c.1.8.1 1.6.1 2.3 0 .5 0 1.1 0 1.7l-.2 3.8h-2.2l.7-9.7h2.9l1.5 6.6 1.4-6.6h2.9z"></path></g></g></svg>',
point:'<svg height="22" viewBox="0 0 12 12" width="22" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m6 12c3.3 0 6-2.7 6-6s-2.7-6-6-6-6 2.7-6 6 2.7 6 6 6z" fill="#fff"></path><path d="m6 10c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4z" fill="#2ed5c9" stroke="#272c36" stroke-width="2"></path></g></svg>'};function yv(a){lv.call(this,a);this.j=function(b){b.preventDefault()};this.i=A(function(b){this.mc()||this.toggleState();b.preventDefault()},this)}u(yv,lv);t("H.ui.base.PushButton",yv);yv.prototype.$=function(a){Hu(a,"start",this.i);Hu(a,"end",this.j);this.Qc(this.Ye(),!0)};yv.prototype.renderInternal=yv.prototype.$;yv.prototype.mp=function(){var a=mv.DOWN;this.P(this.getState()===a?mv.UP:a);return this};yv.prototype.toggleState=yv.prototype.mp;
yv.prototype.u=function(){var a=this.L();a&&Iu(a,"start",this.i);lv.prototype.u.call(this)};var Xu,zv=navigator.userAgent,Av=-1<zv.indexOf("Android")&&-1<zv.indexOf("Mozilla/5.0")&&-1<zv.indexOf("AppleWebKit"),Bv=/AppleWebKit\/([\d.]+)/,Cv=null===Bv.exec(zv)?null:parseFloat(Bv.exec(zv)[1]);Xu=Av&&null!==Cv&&537>Cv;var Dv=Function("return this")(),Su=document.createElement("T");function Ev(a,b,c){Qi.call(this,a,{icon:Fv,visibility:c});Gv(this,b)}u(Ev,Qi);function Gv(a,b){a.oo=b;a.S&&(a.S.textContent=b)}var Fv=new Hi(ou(Dv.document,"span","H_dm_label"),{onAttach:function(a,b,c){c.S=a;Gv(c,c.oo)},onDetach:function(a,b,c){delete c.S}});function Hv(a,b){F.call(this);this.f=a;this.a=new Ev(this.N,"");b.push(this.a);this.b=new Q({objects:b,data:this});this.j=this.j.bind(this)}u(Hv,F);Hv.prototype.g=!1;Hv.prototype.N={lat:0,lng:0};Hv.prototype.Qc=function(a,b){Gv(this.a,a);this.a.da(b)};Hv.prototype.j=function(){this.a.wb(this.c)};function Iv(a,b){b&&(a.nextSibling=b,b.previousSibling=a)};function Jv(a,b,c,d){var e=new L,f=[];Iv(a,this);Iv(this,b);e.Fd(a.Ca());e.Fd(b.Ca());this.i=new nh(e,{style:c.ne});this.s=new nh(e,{style:{strokeColor:"transparent",lineWidth:Math.min(100,this.i.ua().lineWidth+2*(d||5))}});c.c&&(this.o=new nh(e,{style:c.c}),f.push(this.o));f.push(this.i,this.s);Hv.call(this,c,f);this.O=this.v=-1;a=this.b;a.addEventListener("pointermove",this.J,!0,this);a.addEventListener("pointerleave",this.C,!0,this)}u(Jv,Hv);Jv.prototype.Xe=function(){var a=this.i.ba();return a.Qe(0).Za(a.Qe(1))};
function Kv(a,b,c){var d=a.i.ba();d.Bf(3*c,3,[b.lat,b.lng,0]);a.o&&a.o.da(d);a.s.da(d);a.i.da(d)}Jv.prototype.J=function(a){var b=a.currentPointer;a=this.previousSibling.Ca();var c=this.nextSibling.Ca(),d=this.f.f,e=b.viewportX;b=b.viewportY;if(this.v!==e||this.O!==b)this.v=e,this.O=b,d.da(this.f.g(a,c,{x:e,y:b})),d.wb(!0)};Jv.prototype.C=function(){this.f.f.wb()};Jv.prototype.Ei=function(){this.Qc(this.f.a(this.Xe()),this.i.G().fb())};function Lv(a,b,c){c=b.b(c||0);this.i=new yn(a,{icon:c,zIndex:0});this.i.draggable=!0;Hv.call(this,b,[this.i]);a=this.b;a.addEventListener("dragstart",this.Bo,!0,this);a.addEventListener("drag",this.Co,!0,this);a.addEventListener("dragend",this.Ao,!0,this)}u(Lv,Hv);n=Lv.prototype;n.Lk=0;n.ii={nd:"change"};n.Xe=function(){return this.Lk};n.Ca=function(){return this.i.ba()};
function Mv(a){var b=0;a.nextSibling&&a.previousSibling&&(a.nextSibling.g||a.previousSibling.g?a.nextSibling.g&&!a.previousSibling.g&&(b=2):b=1);b=a.f.b(b);a.i.Pc(b)}n.Co=function(a){var b=a.currentPointer;a=b.viewportX;b=b.viewportY;if(this.s!==a||this.v!==b)this.s=a,this.v=b,this.i.da(this.f.map.Wa(a-this.o.x,b-this.o.y)),this.dispatchEvent(new rd(this.ii.nd,this))};
n.Bo=function(a){var b=a.currentPointer,c=b.viewportX;b=b.viewportY;var d=this.f.map.Fa(this.Ca());this.i.ye(1);this.o={x:c-d.x,y:b-d.y};a.stopPropagation()};n.Ao=function(){this.i.ye(0)};n.Ei=function(a){this.Lk=a;this.Qc(this.f.a(a),this.Ca())};function Nv(a,b){this.c=b;this.b=a;this.a={previousSibling:null,nextSibling:null,g:!0};Ov(this,this.a);this.rg=A(this.rg,this)}t("H.ui.distanceMeasurement.Model",Nv);n=Nv.prototype;n.jg=function(){return this.a.nextSibling===this.a};function Pv(a,b){a=a.a;for(var c=a.nextSibling;c!==a;){var d=c,e=c.previousSibling===a?!1:b;(d.c=e)?d.j():(d.m&&x.clearTimeout(d.m),d.m=x.setTimeout(d.j,100));c=c.nextSibling}}
function Qv(a,b){var c=b||a.a.nextSibling,d=0,e=0;if(b&&!Rv(a,b))throw new D(a.sf,0,b);c instanceof Lv?d=c.Xe():c instanceof Jv&&(d=c.previousSibling.Xe());for(b=c;b&&b!==a.a;b=b.nextSibling,e++)b.Ei(d),1===e%2&&(d+=b.Xe())}n.Ge=function(a){var b=this.a.previousSibling,c=this.jg();a=new Lv(a,this.c,c?0:2);this.b.ea(a.b);Iv(a,this.a);a.addEventListener(a.ii.nd,this.rg);c?Ov(this,a):(Sv(this,b,a),Mv(b),Qv(this,b));return a};
n.insertBefore=function(a,b){var c;var d=1;if(b){if(!Rv(this,b))throw new D(this.insertBefore,1,b);if(c=b.previousSibling.g)d=0;a=new Lv(a,this.c,d);a.addEventListener(a.ii.nd,this.rg);this.b.ea(a.b);c?(c=this.a.nextSibling,Sv(this,a,c),Ov(this,a),b=a,Mv(c)):(c=b.previousSibling,b=c.previousSibling,d=c.nextSibling,this.b.Ia(c.b),Sv(this,b,a),Sv(this,a,d));Qv(this,b)}else a=this.Ge(a);return a};n.qa=function(){Ov(this,this.a);this.b.qa()};
n.sf=function(a){var b=this.a,c=a.previousSibling,d=a.nextSibling;if(!Rv(this,a))throw new D(this.sf,0,a);this.b.Ia(a.b);if(c===b){var e=d;e!==b?(a=e.nextSibling,Ov(this,a),a.Ei(0),Mv(a),Qv(this,a)):Ov(this,this.a)}else d===b?(e=c,a=e.previousSibling,Iv(a,b),Mv(a)):c&&d&&(Sv(this,c.previousSibling,d.nextSibling),this.b.Gd([d.b,c.b]),Qv(this,c.previousSibling));e&&e!==b&&this.b.Ia(e.b)};function Rv(a,b){for(var c=a.a.nextSibling,d=!1;c!==a.a;){if(c===b){d=!0;break}c=c.nextSibling}return d}
function Sv(a,b,c){b=new Jv(b,c,a.c);a.b.ea(b.b)}function Ov(a,b){a.a.nextSibling=b;b.previousSibling=a.a}n.rg=function(a){a=a.target;var b=a.previousSibling,c=a.nextSibling,d=a.Ca();if(!c.g){Kv(c,d,!1);var e=a}b.g||(Kv(b,d,!0),e=b.previousSibling);Qv(this,e)};function iv(a){a=a||{};var b,c=a.lineStyle;dv.call(this);this.s=new yv({label:xv.btn,onStateChange:A(this.yo,this)});this.Ka(this.s);if(b=a.distanceFormatter)this.Jj=b;c&&(this.wk=c,this.Vk=B);this.Zb(a.alignment||"right-bottom");this.m={};this.m[0]=a.startIcon;this.m[2]=a.endIcon;this.m[1]=a.stopoverIcon;this.m[3]=a.splitIcon}u(iv,dv);t("H.ui.DistanceMeasurement",iv);n=iv.prototype;n.wk={strokeColor:"rgb(39,44,54)",lineWidth:5};n.Vk={strokeColor:"white",lineWidth:7};
function Tv(a){var b=a.map,c,d={};a.i||(a.j=new N,a.f=new ml(a.j,{pixelRatio:a.map.$a()}),a.v=c=a.j.kc(),a.v.El(!0),c.addEventListener("dragstart",a.wo,!0,a),c.addEventListener("dragend",a.Af,!0,a),c.addEventListener("pointerenter",a.Af,!0,a),c.addEventListener("pointerleave",a.xo,!0,a),c.addEventListener("tap",a.Lo,!0,a),a.o=Uv(a),d.a=A(a.Jj,a),d.b=A(a.Gk,a),d.g=A(a.Zj,a),d.map=a.map,d.f=a.o,d.ne=a.wk,d.c=a.Vk,a.a=new Nv(a.v,d),a.i=!0);a.o&&a.v.ea(a.o);b.addEventListener("tap",a.Sk,!0,a);b.a.add(a.f)}
function Vv(a){var b=a.map;a.i&&(b.removeEventListener("tap",a.Sk,!0,a),b.rf(a.f),a.a.qa())}function Uv(a){function b(){var h=c.Db();h={anchor:c.ud().clone().scale(f).floor(),size:new Ki(yd(h.w*f),yd(h.h*f)),hitArea:d};return new Ij(c.ad(),h)}var c=a.Gk(3),d=new Li(Mi.NONE,[]),e,f=c===a.C?.5:1;if(1===c.getState())var g=b();else g=new Ij("<svg/>",{hitArea:d}),c.addEventListener("statechange",function(){1===c.getState()&&e.Pc(b())});return e=new yn(a.map.fb(),{visibility:!1,icon:g})}
n.Jj=function(a){var b="m",c=0;"metric"===this.U?1E3<=a&&(a/=1E3,b="km",c=1):(a/=.3048,b="ft",5280<=a&&(a/=5280,b="mi",c=1));return a.toFixed(c)+" "+this.Ba().translate("scale."+b)};n.Zj=function(a,b,c){a=this.map.Fa(a);b=this.map.Fa(b);c=(new I(c.x,c.y)).Yj(a,b);return this.map.Wa(c.x,c.y)};
n.$=function(a,b){var c=22*(this.map.ic().type===Vj.P2D?this.map.$a():1),d=c/2;dv.prototype.renderInternal.call(this,a,b);this.U=Au.METRIC;this.C=new Ij(xv.point,{anchor:{x:d,y:d},size:{w:c,h:c},hitArea:new Li(Mi.CIRCLE,[d,d,d])});this.s.sc(this.Ba().translate("distance.measurement"))};iv.prototype.renderInternal=iv.prototype.$;n=iv.prototype;n.Gk=function(a){return this.m[a]||this.C};n.Af=function(){Pv(this.a,!0)};n.wo=function(){Pv(this.a)};n.xo=function(a){"touch"!==a.currentPointer.type&&Pv(this.a)};
n.Lo=function(a){var b=a.currentPointer;var c=a.target.Ha;var d;c&&(c=c.getData())instanceof Hv&&(d=c);c=d;a=a.originalEvent;a=a.metaKey||a.altKey;c&&(a&&c instanceof Lv?this.a.sf(c):c instanceof Jv&&(a=c.previousSibling.Ca(),d=c.nextSibling.Ca(),b={x:b.viewportX,y:b.viewportY},this.a.insertBefore(this.Zj(a,d,b),c.nextSibling),this.o.wb()),this.Af())};
n.Sk=function(a){var b=a.currentPointer;a=a.target;a!==this.map&&a.getProvider&&a.getProvider()===this.j||(this.a.Ge(this.map.Wa(b.viewportX,b.viewportY)),this.o.wb(),this.Af())};n.yo=function(a){"down"===a.target.getState()?Tv(this):Vv(this)};n.kf=function(a){this.U=a;this.i&&(Qv(this.a),this.Af())};iv.prototype.onUnitSystemChange=iv.prototype.kf;iv.prototype.u=function(){Vv(this);this.i&&(this.j.B(),this.f.B());iv.l.u.call(this)};
iv.prototype.Ja=function(a){a?this.s.getState()===mv.DOWN&&(this.map=a,Tv(this)):(Vv(this),this.i=!1);dv.prototype.Ja.apply(this,arguments)};iv.prototype.setMap=iv.prototype.Ja;function Wv(){this.A=Xv.CLOSED;Qu.call(this,"div","H_overlay")}u(Wv,Qu);t("H.ui.base.OverlayPanel",Wv);Wv.prototype.P=function(a,b){if(a!==this.A||b)this.A=a,a===Xv.OPEN?this.La("H_open"):this.qb("H_open");return this};Wv.prototype.setState=Wv.prototype.P;Wv.prototype.getState=function(){return this.A};Wv.prototype.getState=Wv.prototype.getState;
Wv.prototype.$k=function(a){var b=a.Vc;a=a.L();var c=this.L(),d=c.style;this.qb("H_top");this.qb("H_middle");this.qb("H_bottom");this.qb("H_left");this.qb("H_center");this.qb("H_right");d.bottom=d.top=d.left=d.right=d.margin="";if(/top/g.test(b)){this.La("H_top");d.top="0";d.margin="0 12px";var e=-1}else/bottom/g.test(b)?(this.La("H_bottom"),d.bottom="0",d.margin="0 12px",e=1):(this.La("H_middle"),d.top="50%",d.margin="0 12px",d.marginTop=-Math.round(.5*
c.offsetHeight)+"px",e=0);/left/g.test(b)?(this.La("H_left"),d.left=a.offsetWidth+"px",d.marginLeft="12px"):/right/g.test(b)?(this.La("H_right"),d.right=a.offsetWidth+"px",d.marginRight="12px"):(this.La("H_center"),d.left="50%",0>e?(d.top=a.offsetHeight+"px",d.marginTop="12px"):0<e&&(d.bottom=a.offsetHeight+"px",d.marginBottom="12px"),d.marginLeft=-Math.round(.5*c.offsetWidth)+"px",a.appendChild(c))};Wv.prototype.pointToControl=Wv.prototype.$k;var Xv={OPEN:"open",CLOSED:"closed"};
Wv.State=Xv;function Yv(a){a=a||{};Qu.call(this,"div","H_rdo");this.i=new Z("div","H_rdo_title");this.a=new Qu("div","H_rdo_buttons");this.Ka(this.i);this.Ka(this.a);this.j=A(function(b){b.target.getState()===mv.DOWN?(this.ql(b.target,!0),this.dispatchEvent(Zv)):b.target.P(mv.DOWN,!0)},this);this.addEventListener("statechange",this.j);this.Ri(a.title||"");a.onActiveButtonChange&&this.addEventListener(Zv,a.onActiveButtonChange);a.buttonsOptions&&a.buttonsOptions.forEach(function(b){this.Vg(new yv(b))},
this)}u(Yv,Qu);t("H.ui.base.RadioGroup",Yv);var Zv="activebuttonchange";Yv.prototype.$=function(a,b){Qu.prototype.renderInternal.call(this,a,b);this.Ri(this.f,!0)};Yv.prototype.renderInternal=Yv.prototype.$;Yv.prototype.qa=function(){this.a.qa()};Yv.prototype.Ri=function(a,b){if(a!==this.f||b)this.f=a,this.i.L()&&(this.i.L().innerHTML=this.f);return this};Yv.prototype.setTitle=Yv.prototype.Ri;Yv.prototype.Nn=function(){return this.f};Yv.prototype.getTitle=Yv.prototype.Nn;
Yv.prototype.Vg=function(a){if(!(a instanceof yv))throw Error("PushButton expected");a.ka(this);this.a.Ka(a);return this};Yv.prototype.addButton=Yv.prototype.Vg;Yv.prototype.So=function(a){this.a.removeChild(a);a.ka(null);return this};Yv.prototype.removeButton=Yv.prototype.So;Yv.prototype.Yf=function(){return this.a.vh()};Yv.prototype.getButtons=Yv.prototype.Yf;Yv.prototype.ql=function(a,b){for(var c=this.Yf(),d=c.length;d--;)c[d].P(c[d]===a?mv.DOWN:mv.UP,b)};Yv.prototype.setActiveButton=Yv.prototype.ql;
Yv.prototype.u=function(){this.removeEventListener("statechange",this.j);this.qa();Qu.prototype.u.call(this)};function gv(a){a=a||{};dv.call(this);this.i=new Wv;new Yv;this.a=this.a.bind(this);this.o=this.o.bind(this);this.s=this.s.bind(this);this.Zb(a.alignment||"bottom-right");kv(this,a.baseLayers,a.layers)}u(gv,dv);t("H.ui.MapSettingsControl",gv);function kv(a,b,c){var d=a.jc();a.f&&a.f.forEach(function(e){var f=e.layer;e=f&&iu(c,function(g){return g.layer===f});f&&!e&&d.rf(f)});a.m=yc(b)?b:[];a.f=yc(c)?c:[];a.j&&(a.j.qa(),a.v.qa(),$v(a))}
gv.prototype.fa=function(){var a=this.jc();a&&(a.addEventListener("tap",this.o),a=a.a,a.addEventListener("add",this.a),a.addEventListener("remove",this.a),a.addEventListener("set",this.a))};gv.prototype.N=function(){var a=this.jc();a&&(a.removeEventListener("tap",this.o),a=a.a,a.removeEventListener("add",this.a),a.removeEventListener("remove",this.a),a.removeEventListener("set",this.a))};
gv.prototype.$=function(a,b){var c=this.Ba().translate("layers.choose");dv.prototype.renderInternal.call(this,a,b);this.fa();this.C=new yv({tooltip:c,label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M6.7,14.6 L4.5,16 L12,20.6 L19.5,16 L17.3,14.6 L19.1,13.5 L23,16 L12,23 L1,16 L4.9,13.5 L6.7,14.6 Z M12,2 L23,9 L12,16 L1,9 L12,2 Z"></path></svg>',onStateChange:A(function(d){d.target.getState()===mv.DOWN?(this.i.P(Xv.OPEN),this.i.$k(this)):
this.i.P(Xv.CLOSED)},this)});this.j=new Yv({title:c,onActiveButtonChange:function(){a:{var d=this.j.Yf();for(var e=d.length;e--;)if(d[e].getState()===mv.DOWN){d=d[e];break a}d=null}d=d.getData();this.map.Kd(this.m[d].layer);this.s()}.bind(this)});this.v=new Qu("div","H_grp");this.U=new Z("div","H_separator");this.Ka(this.C);this.Ka(this.i);this.i.Ka(this.j);this.i.Ka(this.U);this.i.Ka(this.v);$v(this)};gv.prototype.renderInternal=gv.prototype.$;
function $v(a){var b=a.Ba();a.m.forEach(function(c,d){this.j.Vg(new yv({label:aw(b,c.label),data:d,disabled:!c.layer}))},a);a.f.forEach(function(c,d){this.v.Ka(new yv({label:aw(b,c.label),onStateChange:this.za.bind(this,c.layer),data:d,disabled:!c.layer}))},a);a.U.wb(!(!a.f.length||!a.m.length));x.setTimeout(function(){this.map&&(this.a(),this.C.Da(!(this.m&&this.m.length||this.f&&this.f.length)))}.bind(a))}
gv.prototype.a=function(){var a=this.map.c,b=this.map.a;this.m.forEach(function(c,d){this.j.Yf()[d].P(mv[c.layer===a?"DOWN":"UP"],!0)},this);this.f.forEach(function(c,d){d=this.v.vh()[d];c.layer?d.P(mv[-1!==b.indexOf(c.layer)?"DOWN":"UP"],!0):d.Da(!0)},this)};gv.prototype.za=function(a,b){b.target.getState()===mv.DOWN?this.map.Xg(a):this.map.rf(a);this.s()};
gv.prototype.s=function(){var a;if(a=bw(this)){var b=a.Qg;b.ga().ua().hf(a.ga().ua().vd());this.map.rf(a);a.B();delete a.Qg}cw(this)&&dw(this,this.map.c)};
function dw(a,b){var c,d,e={},f=b.ga(),g=window.H.service&&window.H.service.omv.Provider;if(g&&b.ga()instanceof g&&f.ua().Pe){var h=f.ua();var k=function(){var l=ew.ground.filter(function(p){return!!h.Eh("layers."+p)}),m=ew.water.filter(function(p){return!!h.Eh("layers."+p)});l.concat(m).length&&(vh(e,h.Pe(l)),vh(e,h.Pe(m,!1,!0)),delete e.global,c=new Th(e,h.hc()),d=f.o.qd(c),d.Qg=b,this.map.Xg(d));h.removeEventListener(Sh.CHANGE,k)}.bind(a);h.getState()!==Qh.READY?h.addEventListener(Sh.CHANGE,
k):k()}}function bw(a){return iu(a.map.a.Na(),function(b){return!!b.Qg})}function cw(a){a=a.map.a.Na();var b=window.H.service&&window.H.service.traffic.flow.Provider;return!!b&&a.some(function(c){return c.ga()instanceof b})}var ew={water:["water.water-labels"],ground:"road_labels continent_label island_label roads.shields roads.directions truck-restriction.signs places landuse.label".split(" ")};function aw(a,b){return/^layers?/.test(b)&&a.Kh(b)?a.translate(b):b}gv.prototype.o=function(){this.C.P(mv.UP)};
gv.prototype.u=function(){gv.l.u.call(this);this.N()};function fv(a){a=a||{};dv.call(this);this.f=new yv({label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><g transform="translate(1 3)"><path fill-rule="nonzero" d="M5,0 L5,2 L2,2 L2,16 L5,16 L5,18 L2,18 C0.9,18 0,17 0,15.75 L0,2.25 C0,1 0.9,0 2,0 L5,0 Z M17,0 L20,0 C21.1,0 22,1 22,2.25 L22,15.75 C22,17 21.1,18 20,18 L17,18 L17,16 L20,16 L20,2 L17,2 L17,0 Z"></path><rect width="10" height="2" x="6" y="8"></rect><rect width="2" height="10" x="10" y="4"></rect></g></svg>',
onStateChange:A(this.zo,this)});this.Ka(this.f);this.Zb(a.alignment||"right-bottom")}u(fv,dv);t("H.ui.ZoomRectangle",fv);n=fv.prototype;
n.zo=function(a){var b=this.map,c=b.ya.element;a.target.getState()===mv.DOWN?(b.addEventListener("dragstart",this.Ik,!0,this),b.addEventListener("drag",this.Jk,!0,this),b.addEventListener("dragend",this.Hk,!0,this),a=c.ownerDocument.createElement("div"),a.className="H_zoom_lasso",c.appendChild(a),this.a=a):(b.removeEventListener("dragstart",this.Ik,!0,this),b.removeEventListener("drag",this.Jk,!0,this),b.removeEventListener("dragend",this.Hk,!0,this),c.removeChild(this.a))};
n.Ik=function(a){var b=this.a.style,c=a.currentPointer,d=c.viewportX;c=c.viewportY;a.target===this.map&&(a.stopPropagation(),b.width="0px",b.height="0px",b.top=c+"px",b.left=d+"px",b.display="block",this.j=c,this.i=d)};n.Jk=function(a){var b=a.currentPointer,c=b.viewportX,d=b.viewportY;b=this.i;var e=this.j,f=this.a.style;a.target===this.map&&(a.stopPropagation(),a=c-b,c=d-e,f.left=b+(0>a?a:0)+"px",f.top=e+(0>c?c:0)+"px",f.width=Math.abs(a)+"px",f.height=Math.abs(c)+"px")};
n.Hk=function(a){var b=this.map,c=a.currentPointer;a.target===this.map&&(a.stopPropagation(),this.a.style.display="none",b.b.$b({bounds:eg([b.Wa(this.i,this.j),b.Wa(c.viewportX,c.viewportY)])},!0))};n.$=function(a,b){dv.prototype.renderInternal.call(this,a,b);this.f.sc(this.Ba().translate("zoom.rectangle"))};fv.prototype.renderInternal=fv.prototype.$;function fw(a,b){b=b||{};if(!(a&&a instanceof ll))throw Error("Base layer is mandatory for overview UI element");dv.call(this);this.f=new yv({label:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="H_icon"><g fill-rule="evenodd" transform="translate(2 2)"><rect width="9" height="9" x="10" y="10"/><rect class="H_icon_stroke" width="18" height="18" x="1" y="1" fill="none" stroke="#000" stroke-width="2" rx="2"/></g></svg>',onStateChange:A(this.i,this)});this.Ka(this.f);this.a=
new gw(a,b.zoomDelta,b.scaleX,b.scaleY);this.Zb(b.alignment||"right-bottom");this.Ka(this.a)}u(fw,dv);t("H.ui.Overview",fw);fw.prototype.Kd=function(a){this.a.Kd(a);return this};fw.prototype.setBaseLayer=fw.prototype.Kd;fw.prototype.i=function(a){a.target.getState()===mv.DOWN?(a=this.a,hw(a,!0),a.Vi(),a.La("H_overview_active"),a.a.addEventListener("mapviewchange",a.Vi,!1,a)):iw(this.a)};
fw.prototype.$=function(a,b){dv.prototype.renderInternal.call(this,a,b);this.f.L().style["float"]=this.Vc.match("right")?"right":"left";this.a.Ja(this.map);this.f.sc(this.Ba().translate("minimap"))};fw.prototype.renderInternal=fw.prototype.$;fw.prototype.u=function(){this.a.B();Z.prototype.u.call(this)};function gw(a,b,c,d){this.m=a;"number"===typeof b&&(this.Sl=b);"number"===typeof c&&(this.Wk=c);"number"===typeof d&&(this.Xk=d);Qu.call(this,"div","H_overview")}u(gw,dv);gw.prototype.Kd=function(a){this.f.Kd(a)};
gw.prototype.$=function(a,b){b=ou(b,"div","H_overview_map");yu(a,b);this.i=b};gw.prototype.renderInternal=gw.prototype.$;n=gw.prototype;n.Sl=3;n.Wk=5;n.Xk=5;n.Ja=function(a){this.a=a;this.f=new T(this.i,this.m,{pixelRatio:this.a.$a(),engineType:this.a.ic().type});this.f.m.L().style.display="none";this.o=this.f.b;this.j=this.a.b};function iw(a){!a.Nd&&hw(a);a.qb("H_overview_active");a.a.removeEventListener("mapviewchange",a.Vi,!1,a)}
n.Vi=function(a){a&&a.modifiers&a.SIZE&&hw(this,!0);a=this.j.mb();a.zoom=a.zoom-this.Sl;this.o.$b(a)};function hw(a,b){var c=a.a.ya.element,d=a.L().style,e=c.offsetWidth/a.Wk/10;c=c.offsetHeight/a.Xk/10;var f=a.i.style;b?(d.width=e+"em",d.height=c+"em",f.width=e+"em",f.height=c+"em"):d.width=d.height="0em";a.f.ya.resize()}n.u=function(){gw.l.u.call(this);iw(this);this.f.B();this.f=this.o=this.j=this.a=this.m=this.i=null};function hv(a){a=a||{};dv.call(this);this.La("H_scalebar");this.Zb(a.alignment||"right-bottom");this.v=150;this.update=A(this.update,this);this.m=this.f=this.a=this.j=null}u(hv,dv);t("H.ui.ScaleBar",hv);
hv.prototype.$=function(a,b){dv.prototype.renderInternal.call(this,a,b);a.innerHTML='<svg height="12" version="1.1" xmlns="http://www.w3.org/2000/svg"><polyline style="fill:none; stroke:white; stroke-width:4" points="2,2 2,10 98,10 98,2"/><polyline style="fill:none; stroke:black; stroke-width:2" points="2,2 2,10 98,10 98,2"/></svg><div style="padding: 0 0 0 10px"></div>';a.style.direction="ltr";this.j=a.firstChild;b=this.j.childNodes;this.a=b[0];this.f=b[1];this.m=a.lastChild;this.o=Au.METRIC;this.s=
A(function(c){this.mc()||(this.dispatchEvent("toggleunitsystem"),c.preventDefault())},this);this.i=A(function(c){c.preventDefault()},this);Hu(a,"start",this.i);Hu(a,"end",this.s);this.sc(this.Ba().translate("scale.switchToImperial"));this.update()};hv.prototype.renderInternal=hv.prototype.$;hv.prototype.Ja=function(a){this.map&&this.map.removeEventListener("mapviewchange",this.update);a&&a.addEventListener("mapviewchange",this.update);dv.prototype.Ja.apply(this,arguments)};hv.prototype.setMap=hv.prototype.Ja;
hv.prototype.capture=function(a,b,c){var d=this.L();var e=d.ownerDocument,f=e.createElement("canvas"),g=f.getContext("2d"),h=e.createElementNS("http://www.w3.org/2000/svg","svg"),k=e.createElementNS("http://www.w3.org/2000/svg","foreignObject"),l=jf(d,e,!1);e=parseFloat(d.offsetWidth)+1;var m=parseFloat(d.offsetHeight),p=e*a;a*=m;f.width=p;f.height=a;h.setAttribute("xmlns","http://www.w3.org/2000/svg");h.setAttribute("width",p);h.setAttribute("height",a);h.setAttribute("viewBox","0 0 "+e+" "+m);k.setAttribute("width",
"100%");k.setAttribute("height","100%");h.appendChild(k);l.setAttribute("width","100%");l.setAttribute("height","100%");l.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var q=window.getComputedStyle(d);"box-shadow display align-items font font-family font-size height text-shadow direction".split(" ").forEach(function(r){l.style.setProperty(r,q.getPropertyValue(r))});k.appendChild(l);d=$e(h.outerHTML);(new rf("image",d)).then(function(r){g.drawImage(r,0,0);b(f)},c)};hv.prototype.capture=hv.prototype.capture;
hv.prototype.kf=function(a){this.o=a;this.sc("imperial"===a?this.Ba().translate("scale.switchToMetric"):this.Ba().translate("scale.switchToImperial"));this.update()};hv.prototype.onUnitSystemChange=hv.prototype.kf;
hv.prototype.update=function(){if(this.L()){var a=this.v;var b=0;var c=this.map;var d;if(c){var e=Math.round(.5*c.ya.width);var f=Math.round(.5*c.ya.height);if(d=c.Wa(e,f))b=Zf(d),c=Zf(c.Wa(e+1,f)),b=100*b.Za(c)}if(c=b)this.o===Au.IMPERIAL?c<jw?(f=c/kw,e=this.Ba().translate("scale.ft")):(f=c/jw,e=this.Ba().translate("scale.mi")):1E3>c?(f=c,e=this.Ba().translate("scale.m")):(f=c/1E3,e=this.Ba().translate("scale.km")),c=Math.pow(10,Math.floor(Math.log(f)/Math.LN10)),f=c/f*100,f<a/5?(c*=5,f*=5):f<a/
2?(c*=2,f*=2):f>a&&(c/=2,f/=2),f=Math.round(f),this.j.setAttribute("width",f),this.m.textContent=c+" "+e,this.a.points.getItem(2).x=this.f.points.getItem(2).x=this.a.points.getItem(3).x=this.f.points.getItem(3).x=f-2}};var jw=1609.344,kw=.3048006;t("H.ui.buildInfo",function(){return Ef("H-ui","1.30.6","e7e9557")});

H.__bootstrap__="var l,aa=\"function\"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ca=\"undefined\"!=typeof window&&window===this?this:\"undefined\"!=typeof global&&null!=global?global:this;function da(a,b){if(b){var c=ca;a=a.split(\".\");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}var fa;\nif(\"function\"==typeof Object.setPrototypeOf)fa=Object.setPrototypeOf;else{var ha;a:{var ia={hb:!0},ka={};try{ka.__proto__=ia;ha=ka.hb;break a}catch(a){}ha=!1}fa=ha?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+\" is not extensible\");return a}:null}var la=fa;da(\"Object.setPrototypeOf\",function(a){return a||la});var p=this||self;\nfunction ma(a,b,c){a=a.split(\".\");c=c||p;a[0]in c||\"undefined\"==typeof c.execScript||c.execScript(\"var \"+a[0]);for(var d;a.length&&(d=a.shift());)a.length||void 0===b?c[d]&&c[d]!==Object.prototype[d]?c=c[d]:c=c[d]={}:c[d]=b}function na(){}\nfunction oa(a){var b=typeof a;if(\"object\"==b)if(a){if(a instanceof Array)return\"array\";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if(\"[object Window]\"==c)return\"object\";if(\"[object Array]\"==c||\"number\"==typeof a.length&&\"undefined\"!=typeof a.splice&&\"undefined\"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable(\"splice\"))return\"array\";if(\"[object Function]\"==c||\"undefined\"!=typeof a.call&&\"undefined\"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable(\"call\"))return\"function\"}else return\"null\";\nelse if(\"function\"==b&&\"undefined\"==typeof a.call)return\"object\";return b}function r(a){return\"function\"==oa(a)}function qa(a){var b=typeof a;return\"object\"==b&&null!=a||\"function\"==b}var ra=\"closure_uid_\"+(1E9*Math.random()>>>0),sa=0;function ta(a,b,c){return a.call.apply(a.bind,arguments)}\nfunction ua(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function va(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf(\"native code\")?va=ta:va=ua;return va.apply(null,arguments)}\nfunction wa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function t(a,b){ma(a,b,void 0)}function xa(a,b){function c(){}c.prototype=b.prototype;a.W=b.prototype;a.prototype=new c;a.prototype.constructor=a};function x(){}t(\"H.util.ICache\",x);x.prototype.add=function(){};x.prototype.add=x.prototype.add;x.prototype.get=function(){};x.prototype.get=x.prototype.get;x.prototype.sa=function(){};x.prototype.drop=x.prototype.sa;x.prototype.forEach=function(){};x.prototype.forEach=x.prototype.forEach;x.prototype.U=function(){};x.prototype.removeAll=x.prototype.U;x.prototype.ca=function(){};x.prototype.registerOnDrop=x.prototype.ca;x.prototype.qa=function(){};x.prototype.deRegisterOnDrop=x.prototype.qa;function ya(){var a=za,b;for(b in a)return!1;return!0}function Aa(a){var b={},c;for(c in a)b[c]=a[c];return b}var Ba=\"constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function Ca(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Ba.length;f++)c=Ba[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var y=this;function Da(a){if(Error.captureStackTrace)Error.captureStackTrace(this,Da);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}xa(Da,Error);Da.prototype.name=\"CustomError\";var Ea=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if(\"string\"===typeof a)return\"string\"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};var Fa=va,Ga=String,Ha=y.Object.freeze||function(a){return a},z=self.eval(\"undefined\"),Ia=self.eval(\"null\");function La(a){return Ga(a).split(\",\"!==z?\",\":\" \")}var Ma=\"prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function Na(a,b,c,d){if(!(b=a instanceof b)&&c)throw new A(c,d,void 0!==z?void 0:a);return b}function Oa(a,b,c,d){var e;if(!(e=\"Array\"===Pa(a))&&b)throw new A(b,c,d!==z?d:a);return e}\nt(\"H.lang.isArray\",function(a,b,c,d){return Oa(a,b,c,d)});function Qa(a){return\"string\"===typeof a}t(\"H.lang.isString\",Qa);var Ra=isNaN;function Sa(a){return a===+a}t(\"H.lang.isNumber\",Sa);t(\"H.lang.isInteger\",Number.isInteger?Number.isInteger:function(a){return\"number\"===typeof a&&0===a%1});function Pa(a){var b=Object[Ma[0]][Ma[6]].call(a).match(/^\\[object (\\w+)\\]$/);return b?b[1]:typeof a}var Ta=[];0>Ta.indexOf(Ta)&&Ta.push(Ta);\nfunction Ua(a,b,c,d){var e=\"\",f=2>arguments.length,g;f&&(b={H:y.H},c=\"\",d=Ta.slice());Va(b,!0,function(h,k){try{if(g=h[k],k=Wa(h,g),!(qa(g)&&g.window===g&&g.self===g||qa(g)&&0<g.nodeType&&r(g.cloneNode))&&qa(g)){if(g===a)return e=c+\".\"+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=Ua(a,g,c+\".\"+k,d)))return!0}}catch(m){}});f&&(e=e?e.substr(1).replace(\".\"+Ma[0]+\".\",\"#\"):\"~\"+(r(a)?Xa(a)+\"()\":Pa(a)));return e}\nfunction Wa(a,b){var c=[];Va(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(Ya)[0]}function Ya(a,b){return b.length-a.length}var Za=Object[Ma[0]][Ma[2]];function Va(a,b,c){var d;if(a){for(e in a)if((!b||Za.call(a,e))&&c(a,e,!0))return;for(d=Ma.length;d--;){var e=Ma[d];if((!b||Za.call(a,e))&&c(a,e,!1))break}}}function Xa(a){return(a=/^\\s*function ([^\\( ]+)/.exec(a))?a[1]:\"anonymous\"}function $a(a,b,c){c[b]=\"#\"+b};function B(a,b,c){this.g=[];b&&this.ca(b);if(c&&!r(c))throw new A(B,2,c);this.b=0;this.filter=c;this.a={};this.f=this.c=null;this.Ia(a)}t(\"H.util.Cache\",B);B.prototype.add=function(a,b,c){var d,e;c=+c;if(!Sa(c)||0>c)throw new A(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.a[a])?(d.data!==b&&db(this,d),this.b+=c-d.size,d.size=c,d.data=b,eb(this,d)):this.a[a]=fb(this,{id:a,data:b,size:c,A:null,F:null},this.c),gb(this);return e};B.prototype.add=B.prototype.add;\nB.prototype.ca=function(a){if(!r(a))throw new A(this.ca,0,a);this.g.push(a)};B.prototype.registerOnDrop=B.prototype.ca;B.prototype.qa=function(a){this.g=this.g.filter(function(b){return b!==a})};B.prototype.deRegisterOnDrop=B.prototype.qa;B.prototype.get=function(a,b){return(a=b?this.a[a]:eb(this,this.a[a]))&&a.data};B.prototype.get=B.prototype.get;B.prototype.sa=function(a){var b;(b=this.a[a])&&hb(this,b,!0)};B.prototype.drop=B.prototype.sa;\nB.prototype.forEach=function(a,b,c){var d;for(d in this.a){var e=this.a[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};B.prototype.forEach=B.prototype.forEach;B.prototype.U=function(a){var b;for(b in this.a){var c=this.a[b];(a?a(b,c.data,c.size):1)&&hb(this,this.a[b],!0)}};B.prototype.removeAll=B.prototype.U;B.prototype.Ia=function(a){if(!(0<+a))throw new A(B.prototype.Ia,0,a);this.o=+a;gb(this);return this};B.prototype.setMaxSize=B.prototype.Ia;B.prototype.Bb=function(){return this.o};\nB.prototype.getMaxSize=B.prototype.Bb;B.prototype.xb=function(){return this.b};B.prototype.getCurrentSize=B.prototype.xb;function eb(a,b){b&&(a.c=fb(a,b,a.c));return b}function gb(a){for(;a.b>a.o&&a.f;)hb(a,a.f,!0)}function fb(a,b,c){if(c!==b){(b.A||b.F)&&hb(a,b,!1);if(b.A=c)b.F=c.F,c.F=b;b.F||(a.c=b);b.A||(a.f=b);a.b+=b.size}return b}function hb(a,b,c){var d=b.F,e=b.A;if(d||e||b==a.c&&b==a.f)d?d.A=e:a.c=e,e?e.F=d:a.f=d,a.b-=b.size,c&&(delete a.a[b.id],db(a,b));b.A=b.F=null}\nfunction db(a,b){for(var c=a.g.length;c--;)a.g[c].call(a,b.id,b.data,b.size)};function C(){}t(\"H.service.extension.dataView.ITable\",C);C.prototype.ya=function(){};C.prototype.getMeta=C.prototype.ya;C.prototype.za=function(){};C.prototype.getRowCount=C.prototype.za;C.prototype.ja=function(){};C.prototype.getRow=C.prototype.ja;C.prototype.D=function(){};C.prototype.getColumnNames=C.prototype.D;C.prototype.xa=function(){};C.prototype.getColumn=C.prototype.xa;C.prototype.s=function(){};C.prototype.getCell=C.prototype.s;C.prototype.concat=function(){};C.prototype.concat=C.prototype.concat;function ib(){}t(\"H.service.extension.dataView.IRow\",ib);ib.prototype.D=function(){};ib.prototype.getColumnNames=ib.prototype.D;ib.prototype.s=function(){};ib.prototype.getCell=ib.prototype.s;ib.prototype.Aa=function(){};ib.prototype.getTable=ib.prototype.Aa;function jb(a,b){this.a=a;this.b=b}t(\"H.service.extension.dataView.ObjRow\",jb);jb.prototype.D=function(){return this.a.D()};jb.prototype.getColumnNames=jb.prototype.D;jb.prototype.s=function(a){return this.a.s(this.b,a)};jb.prototype.getCell=jb.prototype.s;jb.prototype.Aa=function(){return this.a};jb.prototype.getTable=jb.prototype.Aa;function kb(){}t(\"H.service.extension.dataView.IColumn\",kb);kb.prototype.s=function(){};kb.prototype.getCell=kb.prototype.s;function lb(a,b){this.b=a;this.a=b}t(\"H.service.extension.dataView.ObjColumn\",lb);lb.prototype.s=function(a){return this.b.s(a,this.a)};lb.prototype.getCell=lb.prototype.s;function A(a,b,c){var d=arguments.length;b=b!==z?+b:b;if(b!==z){var e=(e=/^.*?\\(([^\\)]+)/.exec((\"\"+a).replace(/(\\/\\*([\\s\\S]*?)\\*\\/)|(\\/\\/(.*)$)/gm,\"\")))?La(e[1].replace(/\\s+/g,\"\")):[];e.forEach($a);e=e[b]||\"#\"+b}var f=a?Ua(a):\"\";d=2<d?Ga(c):\"\";if(e||d)f+=\" (Argument \"+(e||\"\")+(d?\" \"+d:\"\")+\")\";d=Error(f);Object.setPrototypeOf(d,A.prototype);return d}xa(A,Error);t(\"H.lang.InvalidArgumentError\",A);A.prototype.name=\"InvalidArgumentError\";function D(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):z);this.G=a;if(b)for(this.O=b,this.pa=a=Object.create(Ia,void 0),d=b.length;d--;)a[b[d]]=!0;c!==z&&(this.Ca=c)}t(\"H.service.extension.dataView.ObjTable\",D);l=D.prototype;l.Ca=z;l.G=z;l.O=z;l.pa=z;l.ya=function(){return this.Ca};D.prototype.getMeta=D.prototype.ya;D.prototype.za=function(){return this.G?this.G.length:0};D.prototype.getRowCount=D.prototype.za;D.prototype.ja=function(a){var b=this.G;return b&&b[a]?new jb(this,a):z};\nD.prototype.getRow=D.prototype.ja;D.prototype.D=function(){return this.O||mb};D.prototype.getColumnNames=D.prototype.D;D.prototype.xa=function(a){return this.pa[a]?new lb(this,a):z};D.prototype.getColumn=D.prototype.xa;D.prototype.s=function(a,b){var c=this.G;return(a=c&&this.pa[b]&&c[a])&&a[b]};D.prototype.getCell=D.prototype.s;\nD.prototype.concat=function(){var a=arguments.length,b,c=this.O,d=\"\"+this.O,e=(this.G||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof D))throw new A(this.concat,b);if(f.G){if(c&&\"\"+f.O!==d)throw new A(this.concat,b,\"Incompatible columns!\");e=e.concat(f.G)}}return new D(e,this.O,this.Ca)};D.prototype.concat=D.prototype.concat;function E(a,b){this.x=+a;this.y=+b}t(\"H.math.Point\",E);E.prototype.set=E;E.prototype.set=E.prototype.set;E.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new E(this.x,this.y);return a};E.prototype.clone=E.prototype.clone;E.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};E.prototype.add=E.prototype.add;E.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};E.prototype.sub=E.prototype.sub;E.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};\nE.prototype.scale=E.prototype.scale;E.prototype.round=function(){this.x=nb(this.x);this.y=nb(this.y);return this};E.prototype.round=E.prototype.round;E.prototype.floor=function(){this.x=ob(this.x);this.y=ob(this.y);return this};E.prototype.floor=E.prototype.floor;E.prototype.ceil=function(){this.x=pb(this.x);this.y=pb(this.y);return this};E.prototype.ceil=E.prototype.ceil;E.prototype.I=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};E.prototype.equals=E.prototype.I;\nE.prototype.Cb=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=a;if(c||d){var f=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d);0>=f?e=a:1<=f?e=b:e=new E(a.x+f*c,a.y+f*d)}return e};E.prototype.getNearest=E.prototype.Cb;E.prototype.ra=function(a){return qb(rb(this.x-a.x,2)+rb(this.y-a.y,2))};E.prototype.distance=E.prototype.ra;E.fromIPoint=function(a){if(!a)throw Error(\"invalid argument\");return a instanceof E?a:new E(a.x,a.y)};var F=Math,sb=F.min,tb=F.max,nb=F.round,ob=F.floor,pb=F.ceil,ub=F.abs,vb=F.log,qb=F.sqrt,rb=F.pow,wb=F.exp,xb=F.sin,yb=F.asin,zb=F.cos,Ab=F.tan,Bb=F.atan,Cb=F.atan2,Db=F.LN2,I=F.PI,Eb=I/2,Gb=I/4,Hb=2*I,Ib=3*I,Jb=I/180,Kb=180/I,Lb=1/0;rb(-2,53);function Mb(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}t(\"H.math.normalize\",function(a,b,c){b-=c=c||0;a-=c;return a-ob(a/b)*b+c});function Nb(a,b,c){return a>c?c:a<b?b:a}t(\"H.math.clamp\",Nb);function Ob(a,b,c){return b<c?a>=b&&a<=c:a>=c&&a<=b}\nfunction Pb(a,b,c,d,e,f){return qb(rb((a-e)*(d-f)-(b-f)*(c-e),2)/(rb(c-e,2)+rb(d-f,2)))}var Qb={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};t(\"H.math.CoverType\",Qb);\nfunction Rb(a,b,c){for(var d=c.length,e=d,f,g,h,k,m=c[0],n=0,q=0,u=0;1!=n&&1<e;){g=c[--e];f=c[--e];k=c[e?e-1:(d+(e-1))%d];h=c[e?e-2:(d+(e-2))%d];if(f>=a&&f<=a&&g>=b&&g<=b||h>=a&&h<=a&&k>=b&&k<=b)n=1;else if(!n&&f===a)h===a&&(g<b&&k>b||g>b&&k<b)||(m<=a&&h>a||m>=a&&h<a)&&(g>=b?++q:++u),n=Ob(b,g,k)&&0>=Pb(a,b,f,g,h,k)?2:0;else if(!n&&Ob(a,f,h)){if(f<a&&h>a||f>a&&h<a)m=g+(a-f)/(h-f)*(k-g),q+=m>b,u+=m<b;n=Ob(b,g,k)&&0>=Pb(a,b,f,g,h,k)?2:0}m=f}!n&&0!==u&&0!==q%2&&(n=3);return n}\nfunction Sb(a,b){return Rb(a.x,a.y,b)!==Qb.NONE}t(\"H.math.isPointInsidePolygon\",Sb);function Tb(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&a[0].x!==z;b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}t(\"H.math.flatten\",Tb);function Ub(a,b,c,d,e,f){var g,h,k=a.length,m,n;if(k)for(g=[];k--;){var q=a[k];var u=q.length;var J=0;for(m=1;m<u;m++)if(n=Vb(q[m-1],q[m],c,b,d,e)){var M=n[0];var v=n[1];J&&J.I(M)?h.push(v):g.push(h=n);J=v;f&&(m=u,k=0)}}else g=a;return g}t(\"H.math.clipping.clipStrips\",Ub);\nfunction Vb(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var m=a;g=h;a=b;h=k;b=m;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var n=1;a=-a;b=-b;m=f;f=-c;c=-m}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);n&&(a=-a,b=-b);return k?[new E(h,-b),new E(g,-a)]:[new E(g,-a),new E(h,-b)]}\nfunction Wb(a,b,c){a=Xb(a,!0);b=Xb(b,!1);var d,e;var f={};var g=d=1;switch(~~(c||0)){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.ia=Yb(b.x,b.y,null,Zb(b));a.ia=Yb(a.x,a.y,null,Zb(a));for(g=b;g.next;g=g.next)if(!g.C)for(d=a;d.next;d=d.next)if(!d.C){var k=$b(g.next);var m=$b(d.next);if(e=ac(g,k,d,m,f)){e=f.kb;var n=f.lb;var q=f.kc;var u=f.lc;e=Yb(q,u,null,null,null,null,!0,0,0,e);bc(e,g,k);k=Yb(q,u,null,null,null,null,!0,0,0,n);bc(k,d,m);e.Da=k;k.Da=e}}f=Sb(b,cc(a));\nc&&(f=!f);for(g=b;g;g=g.next)g.C&&(g.ta=f,f=!f);f=Sb(a,cc(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.C&&(d.ta=f,f=!f);dc(b);for(dc(a);(a=ec(b))!=b;){for(c=null;!a.na;a=a.Da){for(f=a.ta;;){c=Yb(a.x,a.y,c);c.artificial=a.C||a.Ob;a.na=1;a=f?a.next:a.u;if(!a)break;if(a.C){a.na=1;break}}if(!a)break}c.Xa=J;var J=c}return J}}t(\"H.math.clipping.clipPolygon\",Wb);\nfunction Yb(a,b,c,d,e,f,g,h,k,m){a={x:a,y:b,next:c||null,u:d||null,Xa:e||null,Da:f||null,C:!!g,ta:h||0,na:k||0,alpha:m||0};d&&(a.u.next=a);c&&(a.next.u=a);return a}function $b(a){for(;a&&a.C;)a=a.next;return a}function Zb(a){if(a)for(;a.next;)a=a.next;return a}function ec(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.C||b.C&&b.na))}return b}function dc(a){var b=Zb(a);b.u.next=a;a.u=b.u}\nfunction ac(a,b,c,d,e){var f,g=b.x-a.x,h=b.y-a.y;var k=d.x-c.x;var m=d.y-c.y;var n=g*m-h*k;if(!n)return 0;k=((c.x-a.x)*m-(c.y-a.y)*k)/n;n=(h*(c.x-a.x)-g*(c.y-a.y))/n;if(0>k||1<k||0>n||1<n)return 0;0===k?f=a:1===k?f=b:0===n?f=c:1===n&&(f=d);if(f)return f.x+=2.480549651603763E-5,f.y+=7.321997314118067E-5,f.ia&&(f.ia.x=f.x,f.ia.y=f.y),ac(a,b,c,d,e);e.kc=a.x+k*g;e.lc=a.y+k*h;e.kb=k;e.lb=n;return 1}function cc(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}\nfunction bc(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.u=b.u;a.next.u=a;a.u.next=a}function Xb(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=Yb(a[e].x,a[e].y,d);c.Ob=b;if(c.next=d)d.u=c;d=c}return d};function fc(a,b){var c=[];a&&c.push(Ua(a));1<arguments.length&&c.push(\"\"+b);c=Error(c.join(\" \"));Object.setPrototypeOf(c,fc.prototype);return c}xa(fc,Error);t(\"H.lang.IllegalOperationError\",fc);fc.prototype.name=\"IllegalOperationError\";function gc(){if(!Qa(\"STATIC_DB\"))throw new A(this.constructor,0);this.o=y.indexedDB||y.jc||y.Rb||y.Sb;if(!this.o)throw new fc(this.constructor,\"This browser does not support IndexedDB\");this.a=[];this.c=[];this.g=Fa(this.g,this)}var hc,ic;gc.prototype.get=function(a,b,c){var d;if(!Qa(a)&&!Sa(a))throw new A(this.get,0);if(!r(b))throw new A(this.get,1);jc(this,function(e){d=e.get(a);kc(d,b,c)},c);return{cancel:function(){d&&(d.onsuccess=lc)}}};\ngc.prototype.g=function(){var a=this.b.result;a.objectStoreNames.contains(\"data\")||a.createObjectStore(\"data\")};\nfunction mc(a,b,c){if(a.b)a.a?(a.a.push(b),c&&a.c.push(c)):a.f?c&&c(a.f):b(a.b.result);else{a.b=a.o.open(nc+\"STATIC_DB\",1);a.b.onupgradeneeded=a.g;var d=a.b.onerror=function(){clearTimeout(a.v);a.f=this.error;a.c.forEach(function(e){e(a.f)});a.a=a.c=null};a.v=setTimeout(function(){d.call({error:Error(\"DbOpenTimeoutError\")})},500);a.b.onsuccess=function(){clearTimeout(a.v);a.a?(a.a.forEach(function(e){e(this.result)},this),a.a=a.c=null):(a.b=a.f=null,a.a=[],a.c=[])};a.a.push(b);c&&a.c.push(c)}}\nfunction jc(a,b,c){mc(a,function(d){d=d.transaction([\"data\"],\"readwrite\");b(d.objectStore(\"data\"))},c)}function kc(a,b,c){b&&(a.onsuccess=function(){b(this.result)});c&&(a.onerror=function(){c(this.error)})}t(\"H.util.IndexedDBStorage.getInstance\",function(){hc||(hc=new gc);return hc});var nc=\"H_\";\nt(\"H.util.IndexedDBStorage.isSupported\",function(){if(ic===z)if(\"file:\"===window.location.protocol&&-1<navigator.userAgent.toLowerCase().indexOf(\"firefox\")&&128<=window.location.href.length)ic=!1;else{var a=y.indexedDB||y.jc||y.Rb||y.Sb;var b=nc+\"TEST_DB\";try{var c=a&&a.open(b,1)}catch(d){}ic=!!c&&null===c.onupgradeneeded;c&&a.deleteDatabase&&a.deleteDatabase(b)}return ic});function K(){0!=oc&&(pc[this[ra]||(this[ra]=++sa)]=this);this.c=this.c;this.a=this.a}var oc=0,pc={};K.prototype.c=!1;K.prototype.B=function(){if(!this.c&&(this.c=!0,this.P(),0!=oc)){var a=this[ra]||(this[ra]=++sa);if(0!=oc&&this.a&&0<this.a.length)throw Error(this+\" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.\");delete pc[a]}};\nK.prototype.N=function(a,b){this.c?void 0!==b?a.call(b):a():(this.a||(this.a=[]),this.a.push(void 0!==b?va(a,b):a))};K.prototype.P=function(){if(this.a)for(;this.a.length;)this.a.shift()()};function L(a,b){this.type=a;this.currentTarget=this.target=b;this.a=!1;this.Za=!0}L.prototype.stopPropagation=function(){this.a=!0};L.prototype.c=function(){this.Za=!1};t(\"H.util.Event\",L);L.prototype.stopPropagation=L.prototype.stopPropagation;L.prototype.stopPropagation=L.prototype.stopPropagation;L.prototype.CAPTURING_PHASE=1;L.prototype.CAPTURING_PHASE=L.prototype.CAPTURING_PHASE;L.prototype.AT_TARGET=2;L.prototype.AT_TARGET=L.prototype.AT_TARGET;L.prototype.BUBBLING_PHASE=3;L.prototype.BUBBLING_PHASE=L.prototype.BUBBLING_PHASE;L.prototype.eventPhase=0;L.prototype.eventPhase=L.prototype.eventPhase;function qc(a,b,c){qc.W.constructor.call(this,a,c);this.data=b}xa(qc,L);t(\"H.util.DataEvent\",qc);function rc(a,b,c){rc.W.constructor.call(this,a,c);this.message=b}xa(rc,L);t(\"H.util.ErrorEvent\",rc);function sc(a,b){this.c=a;this.f=b;this.b=0;this.a=null}sc.prototype.get=function(){if(0<this.b){this.b--;var a=this.a;this.a=a.next;a.next=null}else a=this.c();return a};function tc(a,b){a.f(b);100>a.b&&(a.b++,b.next=a.a,a.a=b)};function uc(){this.b=this.a=null}var wc=new sc(function(){return new vc},function(a){a.reset()});uc.prototype.add=function(a,b){var c=wc.get();c.set(a,b);this.b?this.b.next=c:this.a=c;this.b=c};function xc(){var a=yc,b=null;a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null);return b}function vc(){this.next=this.b=this.a=null}vc.prototype.set=function(a,b){this.a=a;this.b=b;this.next=null};vc.prototype.reset=function(){this.next=this.b=this.a=null};var Bc=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\\s\\xa0]*([\\s\\S]*?)[\\s\\xa0]*$/.exec(a)[1]};function Cc(a,b){return a<b?-1:a>b?1:0};var Dc;a:{var Ec=p.navigator;if(Ec){var Fc=Ec.userAgent;if(Fc){Dc=Fc;break a}}Dc=\"\"}function Gc(a){return-1!=Dc.indexOf(a)};function Hc(a,b){this.b=a===Ic&&b||\"\";this.a=Jc}var Jc={},Ic={},Kc=new Hc(Ic,\"\");function Lc(a,b){this.b=a===Mc&&b||\"\";this.a=Nc}var Nc={},Mc={};function Oc(){this.a=\"\";this.b=Pc}function Qc(){var a=Rc;if(a instanceof Oc&&a.constructor===Oc&&a.b===Pc)return a.a;oa(a);return\"type_error:SafeHtml\"}var Pc={};function Sc(a){var b=new Oc;b.a=a;return b}Sc(\"<!DOCTYPE html>\");var Rc=Sc(\"\");Sc(\"<br>\");function Tc(a){var b=new Lc(Mc,Kc instanceof Hc&&Kc.constructor===Hc&&Kc.a===Jc?Kc.b:\"type_error:Const\");b instanceof Lc&&b.constructor===Lc&&b.a===Nc?b=b.b:(oa(b),b=\"type_error:TrustedResourceUrl\");a.src=b.toString()};function Uc(a){Uc[\" \"](a);return a}Uc[\" \"]=na;var Vc=Gc(\"Opera\"),Wc=Gc(\"Trident\")||Gc(\"MSIE\"),Xc=Gc(\"Edge\"),Yc=Gc(\"Gecko\")&&!(-1!=Dc.toLowerCase().indexOf(\"webkit\")&&!Gc(\"Edge\"))&&!(Gc(\"Trident\")||Gc(\"MSIE\"))&&!Gc(\"Edge\"),Zc=-1!=Dc.toLowerCase().indexOf(\"webkit\")&&!Gc(\"Edge\");function $c(){var a=p.document;return a?a.documentMode:void 0}var ad;\na:{var bd=\"\",cd=function(){var a=Dc;if(Yc)return/rv:([^\\);]+)(\\)|;)/.exec(a);if(Xc)return/Edge\\/([\\d\\.]+)/.exec(a);if(Wc)return/\\b(?:MSIE|rv)[: ]([^\\);]+)(\\)|;)/.exec(a);if(Zc)return/WebKit\\/(\\S+)/.exec(a);if(Vc)return/(?:Version)[ \\/]?(\\S+)/.exec(a)}();cd&&(bd=cd?cd[1]:\"\");if(Wc){var dd=$c();if(null!=dd&&dd>parseFloat(bd)){ad=String(dd);break a}}ad=bd}var ed={},fd;fd=p.document&&Wc?$c():void 0;function gd(a){var b=document;a=String(a);\"application/xhtml+xml\"===b.contentType&&(a=a.toLowerCase());return b.createElement(a)};function hd(a){p.setTimeout(function(){throw a;},0)}var id;\nfunction jd(){var a=p.MessageChannel;\"undefined\"===typeof a&&\"undefined\"!==typeof window&&window.postMessage&&window.addEventListener&&!Gc(\"Presto\")&&(a=function(){var e=gd(\"IFRAME\");e.style.display=\"none\";Tc(e);document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.write(Qc());e.close();var g=\"callImmediate\"+Math.random(),h=\"file:\"==f.location.protocol?\"*\":f.location.protocol+\"//\"+f.location.host;e=va(function(k){if((\"*\"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},\nthis);f.addEventListener(\"message\",e,!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if(\"undefined\"!==typeof a&&!Gc(\"Trident\")&&!Gc(\"MSIE\")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.Oa;c.Oa=null;e()}};return function(e){d.next={Oa:e};d=d.next;b.port2.postMessage(0)}}return\"undefined\"!==typeof document&&\"onreadystatechange\"in gd(\"SCRIPT\")?function(e){var f=gd(\"SCRIPT\");f.onreadystatechange=function(){f.onreadystatechange=null;\nf.parentNode.removeChild(f);f=null;e();e=null};document.documentElement.appendChild(f)}:function(e){p.setTimeout(e,0)}};function kd(a,b){ld||md();nd||(ld(),nd=!0);yc.add(a,b)}var ld;function md(){if(p.Promise&&p.Promise.resolve){var a=p.Promise.resolve(void 0);ld=function(){a.then(od)}}else ld=function(){var b=od;!r(p.setImmediate)||p.Window&&p.Window.prototype&&!Gc(\"Edge\")&&p.Window.prototype.setImmediate==p.setImmediate?(id||(id=jd()),id(b)):p.setImmediate(b)}}var nd=!1,yc=new uc;function od(){for(var a;a=xc();){try{a.a.call(a.b)}catch(b){hd(b)}tc(wc,a)}nd=!1};function pd(a){this.a=qd;this.v=void 0;this.f=this.b=this.c=null;this.g=this.o=!1;if(a!=na)try{var b=this;a.call(void 0,function(c){rd(b,sd,c)},function(c){rd(b,td,c)})}catch(c){rd(this,td,c)}}var qd=0,sd=2,td=3;function ud(){this.next=this.c=this.b=this.f=this.a=null;this.g=!1}ud.prototype.reset=function(){this.c=this.b=this.f=this.a=null;this.g=!1};var vd=new sc(function(){return new ud},function(a){a.reset()});function wd(a,b,c){var d=vd.get();d.f=a;d.b=b;d.c=c;return d}\nfunction xd(a,b,c){yd(a,b,c,null)||kd(wa(b,a))}function zd(a){return new pd(function(b,c){var d=a.length,e=[];if(d)for(var f=function(m,n){d--;e[m]=n;0==d&&b(e)},g=function(m){c(m)},h=0,k;h<a.length;h++)k=a[h],xd(k,wa(f,h),g);else b(e)})}function Ad(){var a,b,c=new pd(function(d,e){a=d;b=e});return new Bd(c,a,b)}pd.prototype.then=function(a,b,c){return Cd(this,r(a)?a:null,r(b)?b:null,c)};pd.prototype.$goog_Thenable=!0;\npd.prototype.cancel=function(a){if(this.a==qd){var b=new Dd(a);kd(function(){Ed(this,b)},this)}};function Ed(a,b){if(a.a==qd)if(a.c){var c=a.c;if(c.b){for(var d=0,e=null,f=null,g=c.b;g&&(g.g||(d++,g.a==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.a==qd&&1==d?Ed(c,b):(f?(d=f,d.next==c.f&&(c.f=d),d.next=d.next.next):Fd(c),Gd(c,e,td,b)))}a.c=null}else rd(a,td,b)}function Hd(a,b){a.b||a.a!=sd&&a.a!=td||Id(a);a.f?a.f.next=b:a.b=b;a.f=b}\nfunction Cd(a,b,c,d){var e=wd(null,null,null);e.a=new pd(function(f,g){e.f=b?function(h){try{var k=b.call(d,h);f(k)}catch(m){g(m)}}:f;e.b=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof Dd?g(h):f(k)}catch(m){g(m)}}:g});e.a.c=a;Hd(a,e);return e.a}pd.prototype.Ea=function(a){this.a=qd;rd(this,sd,a)};pd.prototype.Ga=function(a){this.a=qd;rd(this,td,a)};\nfunction rd(a,b,c){a.a==qd&&(a===c&&(b=td,c=new TypeError(\"Promise cannot resolve to itself\")),a.a=1,yd(c,a.Ea,a.Ga,a)||(a.v=c,a.a=b,a.c=null,Id(a),b!=td||c instanceof Dd||Jd(a,c)))}function yd(a,b,c,d){if(a instanceof pd)return Hd(a,wd(b||na,c||null,d)),!0;if(a)try{var e=!!a.$goog_Thenable}catch(g){e=!1}else e=!1;if(e)return a.then(b,c,d),!0;if(qa(a))try{var f=a.then;if(r(f))return Kd(a,f,b,c,d),!0}catch(g){return c.call(d,g),!0}return!1}\nfunction Kd(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Id(a){a.o||(a.o=!0,kd(a.T,a))}function Fd(a){var b=null;a.b&&(b=a.b,a.b=b.next,b.next=null);a.b||(a.f=null);return b}pd.prototype.T=function(){for(var a;a=Fd(this);)Gd(this,a,this.a,this.v);this.o=!1};\nfunction Gd(a,b,c,d){if(c==td&&b.b&&!b.g)for(;a&&a.g;a=a.c)a.g=!1;if(b.a)b.a.c=null,Ld(b,c,d);else try{b.g?b.f.call(b.c):Ld(b,c,d)}catch(e){Md.call(null,e)}tc(vd,b)}function Ld(a,b,c){b==sd?a.f.call(a.c,c):a.b&&a.b.call(a.c,c)}function Jd(a,b){a.g=!0;kd(function(){a.g&&Md.call(null,b)})}var Md=hd;function Dd(a){Da.call(this,a)}xa(Dd,Da);Dd.prototype.name=\"cancel\";function Bd(a,b,c){this.a=a;this.b=b;this.reject=c};function Nd(a,b,c){this.type=a;this.data=b;this.a=Ad();this.Va=Fa(this.Va,this);this.reject=Fa(this.reject,this);this.priority=Od;c!==z&&(this.priority=c);this.b().add(this)}var Od=1,Pd={nc:0,oc:Od,mc:2};l=Nd.prototype;l.then=function(a,b,c){return this.a.a.then(a,b,c)};l.Va=function(a){this.$=3;this.a.b(a)};l.reject=function(a){this.$=5;this.a.reject(a)};l.$=0;\nl.cancel=function(){if(3>this.$){this.c();var a=this.b(),b=this.priority,c=a.a[b].indexOf(this);-1<c?a.a[b].splice(c,1):this.Na&&a.ea.ob(this.Na);this.$=4}};function Qd(a){var b;this.a={};for(b in Pd)this.a[Pd[b]]=[];this.ea=a;this.ea.addEventListener(\"allocatable\",Fa(this.b,this))}t(\"H.util.JobManager\",Qd);var Rd=Object.keys(Pd).map(function(a){return Pd[a]}).sort().reverse();Qd.prototype.add=function(a){Na(a,Nd,this.add,0);this.a[a.priority].push(a);this.b()};Qd.prototype.contains=function(a){return-1<this.a[a.priority].indexOf(a)};\nQd.prototype.b=function(){Rd.forEach(function(a){this.a[a]=this.a[a].filter(function(b){var c;if((c=this.ea.pc(b))!==Ia){var d=Fa(this.ea.ob,this.ea,c,b);b.Na=c;b.then(d,d);b.$=b.qc(c)?1:5}else return!0},this)},this)};function Sd(a,b,c){var d=[],e=arguments.length;a&&d.push(Ua(a));1<e&&(e=2<e&&Oa(c,void 0,void 0,void 0)?\" out of [\"+c[0]+\"...\"+c[1]+\"]\":\"\",d.push(\"(\"+b+e+\")\"));d=Error(d.join(\" \"));Object.setPrototypeOf(d,Sd.prototype);return d}xa(Sd,Error);t(\"H.lang.OutOfRangeError\",Sd);Sd.prototype.name=\"OutOfRangeError\";var Td=\"closure_listenable_\"+(1E6*Math.random()|0),Ud=0;function Vd(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.ka=e;this.key=++Ud;this.V=this.fa=!1}function Wd(a){a.V=!0;a.listener=null;a.proxy=null;a.src=null;a.ka=null};function Xd(a){this.src=a;this.a={};this.b=0}Xd.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.a[f];a||(a=this.a[f]=[],this.b++);var g=Yd(a,b,d,e);-1<g?(b=a[g],c||(b.fa=!1)):(b=new Vd(b,this.src,f,!!d,e),b.fa=c,a.push(b));return b};function Zd(a,b){var c=b.type;if(c in a.a){var d=a.a[c],e=Ea(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Wd(b),0==a.a[c].length&&(delete a.a[c],a.b--))}}\nXd.prototype.U=function(a){a=a&&a.toString();var b=0,c;for(c in this.a)if(!a||c==a){for(var d=this.a[c],e=0;e<d.length;e++)++b,Wd(d[e]);delete this.a[c];this.b--}return b};function Yd(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.V&&f.listener==b&&f.capture==!!c&&f.ka==d)return e}return-1};var $d;($d=!Wc)||($d=9<=Number(fd));var ae=$d,be;\nif(be=Wc){var ce;if(Object.prototype.hasOwnProperty.call(ed,\"9\"))ce=ed[\"9\"];else{for(var de=0,ee=Bc(String(ad)).split(\".\"),fe=Bc(\"9\").split(\".\"),ge=Math.max(ee.length,fe.length),he=0;0==de&&he<ge;he++){var ie=ee[he]||\"\",je=fe[he]||\"\";do{var ke=/(\\d*)(\\D*)(.*)/.exec(ie)||[\"\",\"\",\"\",\"\"],le=/(\\d*)(\\D*)(.*)/.exec(je)||[\"\",\"\",\"\",\"\"];if(0==ke[0].length&&0==le[0].length)break;de=Cc(0==ke[1].length?0:parseInt(ke[1],10),0==le[1].length?0:parseInt(le[1],10))||Cc(0==ke[2].length,0==le[2].length)||Cc(ke[2],le[2]);\nie=ke[3];je=le[3]}while(0==de)}ce=ed[\"9\"]=0<=de}be=!ce}var me=be,ne=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},\"passive\",{get:function(){a=!0}});try{p.addEventListener(\"test\",na,b),p.removeEventListener(\"test\",na,b)}catch(c){}return a}();function oe(a,b){L.call(this,a?a.type:\"\");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key=\"\";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType=\"\";this.b=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(Yc){a:{try{Uc(b.nodeName);var e=!0;break a}catch(f){}e=\n!1}e||(b=null)}}else\"mouseover\"==c?b=a.fromElement:\"mouseout\"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.key=a.key||\"\";this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=\na.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType=\"string\"===typeof a.pointerType?a.pointerType:pe[a.pointerType]||\"\";this.b=a;a.defaultPrevented&&this.c()}}xa(oe,L);var pe={2:\"touch\",3:\"pen\",4:\"mouse\"};oe.prototype.stopPropagation=function(){oe.W.stopPropagation.call(this);this.b.stopPropagation?this.b.stopPropagation():this.b.cancelBubble=!0};\noe.prototype.c=function(){oe.W.c.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,me)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var qe=\"closure_lm_\"+(1E6*Math.random()|0),re={},se=0;function te(a,b,c,d,e){if(d&&d.once)ue(a,b,c,d,e);else if(\"array\"==oa(b))for(var f=0;f<b.length;f++)te(a,b[f],c,d,e);else c=ve(c),a&&a[Td]?a.b.add(String(b),c,!1,qa(d)?!!d.capture:!!d,e):we(a,b,c,!1,d,e)}\nfunction we(a,b,c,d,e,f){if(!b)throw Error(\"Invalid event type\");var g=qa(e)?!!e.capture:!!e,h=xe(a);h||(a[qe]=h=new Xd(a));c=h.add(b,c,d,g,f);if(!c.proxy){d=ye();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)ne||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(ze(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error(\"addEventListener and attachEvent are unavailable.\");se++}}\nfunction ye(){var a=Ae,b=ae?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function ue(a,b,c,d,e){if(\"array\"==oa(b))for(var f=0;f<b.length;f++)ue(a,b[f],c,d,e);else c=ve(c),a&&a[Td]?a.b.add(String(b),c,!0,qa(d)?!!d.capture:!!d,e):we(a,b,c,!0,d,e)}\nfunction Ce(a,b,c,d,e){if(\"array\"==oa(b))for(var f=0;f<b.length;f++)Ce(a,b[f],c,d,e);else(d=qa(d)?!!d.capture:!!d,c=ve(c),a&&a[Td])?(a=a.b,b=String(b).toString(),b in a.a&&(f=a.a[b],c=Yd(f,c,d,e),-1<c&&(Wd(f[c]),Array.prototype.splice.call(f,c,1),0==f.length&&(delete a.a[b],a.b--)))):a&&(a=xe(a))&&(b=a.a[b.toString()],a=-1,b&&(a=Yd(b,c,d,e)),(c=-1<a?b[a]:null)&&De(c))}\nfunction De(a){if(\"number\"!==typeof a&&a&&!a.V){var b=a.src;if(b&&b[Td])Zd(b.b,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(ze(c),d):b.addListener&&b.removeListener&&b.removeListener(d);se--;(c=xe(b))?(Zd(c,a),0==c.b&&(c.src=null,b[qe]=null)):Wd(a)}}}function ze(a){return a in re?re[a]:re[a]=\"on\"+a}\nfunction Ee(a,b,c,d){var e=!0;if(a=xe(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.V&&(f=Fe(f,d),e=e&&!1!==f)}return e}function Fe(a,b){var c=a.listener,d=a.ka||a.src;a.fa&&De(a);return c.call(d,b)}\nfunction Ae(a,b){if(a.V)return!0;if(!ae){if(!b)a:{b=[\"window\",\"event\"];for(var c=p,d=0;d<b.length;d++)if(c=c[b[d]],null==c){b=null;break a}b=c}d=b;b=new oe(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;!b.a&&0<=e;e--){b.currentTarget=d[e];var f=Ee(d[e],a,!0,b);c=c&&f}for(e=0;!b.a&&e<d.length;e++)b.currentTarget=\nd[e],f=Ee(d[e],a,!1,b),c=c&&f}return c}return Fe(a,new oe(b,this))}function xe(a){a=a[qe];return a instanceof Xd?a:null}var Ge=\"__closure_events_fn_\"+(1E9*Math.random()>>>0);function ve(a){if(r(a))return a;a[Ge]||(a[Ge]=function(b){return a.handleEvent(b)});return a[Ge]};function N(){K.call(this);this.b=new Xd(this);this.v=this;this.o=null}xa(N,K);N.prototype[Td]=!0;l=N.prototype;l.K=function(){return this.o};l.Ja=function(a){this.o=a};l.addEventListener=function(a,b,c,d){te(this,a,b,c,d)};l.removeEventListener=function(a,b,c,d){Ce(this,a,b,c,d)};\nl.dispatchEvent=function(a){var b,c=this.K();if(c)for(b=[];c;c=c.K())b.push(c);c=this.v;var d=a.type||a;if(\"string\"===typeof a)a=new L(a,c);else if(a instanceof L)a.target=a.target||c;else{var e=a;a=new L(d,c);Ca(a,e)}e=!0;if(b)for(var f=b.length-1;!a.a&&0<=f;f--){var g=a.currentTarget=b[f];e=g.R(d,!0,a)&&e}a.a||(g=a.currentTarget=c,e=g.R(d,!0,a)&&e,a.a||(e=g.R(d,!1,a)&&e));if(b)for(f=0;!a.a&&f<b.length;f++)g=a.currentTarget=b[f],e=g.R(d,!1,a)&&e;return e};\nl.P=function(){N.W.P.call(this);this.b&&this.b.U(void 0);this.o=null};l.R=function(a,b,c){a=this.b.a[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.V&&f.capture==b){var g=f.listener,h=f.ka||f.src;f.fa&&Zd(this.b,f);d=!1!==g.call(h,c)&&d}}return d&&0!=c.Za};t(\"H.util.EventTarget\",N);N.prototype.Ja=N.prototype.Ja;N.prototype.setParentEventTarget=N.prototype.Ja;N.prototype.K=N.prototype.K;N.prototype.getParentEventTarget=N.prototype.K;N.prototype.addEventListener=N.prototype.addEventListener;N.prototype.addEventListener=N.prototype.addEventListener;N.prototype.removeEventListener=N.prototype.removeEventListener;N.prototype.removeEventListener=N.prototype.removeEventListener;N.prototype.dispatchEvent=N.prototype.dispatchEvent;\nN.prototype.dispatchEvent=N.prototype.dispatchEvent;N.prototype.B=N.prototype.B;N.prototype.dispose=N.prototype.B;N.prototype.N=N.prototype.N;N.prototype.addOnDisposeCallback=N.prototype.N;N.prototype.T=N.prototype.R;\nN.prototype.R=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?\"AT_TARGET\":b?\"CAPTURING_PHASE\":(d=!0,\"BUBBLING_PHASE\")];if(!d||\"pointerenter\"!==(e=c.type)&&\"pointerleave\"!==e)c.eventPhase=g,f=N.prototype.T.apply(this,arguments),d&&this.K&&null===this.K()&&delete c.eventPhase;return f};function O(a){a=a||{};var b=a.callback;this.g=a.label;r(b)&&(this.callback=b);this.f=!!a.disabled;O.W.constructor.call(this)}xa(O,N);t(\"H.util.ContextItem\",O);O.prototype.zb=function(){return this.g};O.prototype.getLabel=O.prototype.zb;O.prototype.cc=function(a){this.g!==a&&(this.g=a,this.dispatchEvent(\"update\"));return this};O.prototype.setLabel=O.prototype.cc;O.prototype.Pb=function(){return this.f};O.prototype.isDisabled=O.prototype.Pb;\nO.prototype.bc=function(a){a^this.f&&(this.f=a,this.dispatchEvent(\"update\"));return this};O.prototype.setDisabled=O.prototype.bc;var He=new O;O.SEPARATOR=He;function Ie(){if(y.document){var a=document.createElement(\"canvas\");a.width=a.height=1;a.getContext(\"2d\")}}t(\"H.util.getPixelRatio\",function(){return window.devicePixelRatio||1});Object.create(Ia,void 0);t(\"H.util.eval\",function(a){return eval(a)});t(\"H.util.provide\",function(a){var b=p.$jscomp;if(b&&(\"function\"!=typeof b.wb?0:b.wb()))throw Error(\"goog.provide cannot be used within a module.\");ma(a,void 0)});function Je(){this.A=0}\nJe.prototype.next=function(a){if(9007199254740992===this.A)throw new Sd(a,this.A,[0,9007199254740991]);return this.A++};var Ke=new Je;Fa(Ke.next,Ke);function lc(){}var mb=Ha([]);Ha({});Ie();Ie();function Le(a,b,c){var d=Nb(+a,-90,90);if(b&&Ra(d))throw new A(b,c,a);return d}function Me(a,b,c){var d=+a;if(-180>d||180<d)d=Mb(d+180,360)-180;if(b&&Ra(d))throw new A(b,c,a);return d}function Ne(a,b,c){var d;if(a!==z&&Ra(d=+a)&&b)throw new A(b,c,a);return d}t(\"H.geo.isDBC\",function(a,b){return 0!==(0>a^0>b)&&180<ub(b-a)});function Q(){var a=Q;if(!0===(Na(this,a)&&this.constructor===a))throw new TypeError(\"Illegal constructor \"+Ua(a));}t(\"H.geo.AbstractGeometry\",Q);Q.prototype.getBoundingBox=Q.prototype.Y;Q.prototype.equals=Q.prototype.I;Q.prototype.oa=\"\";Q.prototype.wa=\"\";Q.prototype.toString=function(){return this.eb([this.oa.toUpperCase(),\" \"]).join(\"\")};Q.prototype.toString=Q.prototype.toString;Q.prototype.ec=function(){return{type:this.wa,coordinates:this.cb()}};Q.prototype.toGeoJSON=Q.prototype.ec;\nQ.prototype.ua=function(){return{type:this.oa,coordinates:this.va(),boundingBox:this.Y().ua()}};Q.prototype.forWorkerMessage=Q.prototype.ua;function R(a,b,c){this.lat=Le(a,R,0);this.lng=Me(b,R,1);c!==z&&(this.alt=Ne(c,R,2))}xa(R,Q);t(\"H.geo.Point\",R);R.prototype.I=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};R.prototype.equals=R.prototype.I;R.prototype.ra=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*Jb;var c=a.lat*Jb;a=1.274200158E7*yb(sb(1,qb(rb(xb((b-c)/2),2)+zb(b)*zb(c)*rb(xb((this.lng*Jb-a.lng*Jb)/2),2))))}return a};\nR.prototype.distance=R.prototype.ra;\nR.prototype.ic=function(a,b,c){if(c){if(b/=6371000.79){a*=Jb;var d=Jb*this.lat;var e=xb(d);var f=xb(b);var g=zb(b);var h=Jb*this.lng;var k=zb(d);d=yb(k*zb(a)*f+e*g);a=Cb(xb(a)*k*f,g-e*xb(d));a=(h+a+I)%(2*I)-I;k=a*Kb}return b?new R(d*Kb,(k+540)%360-180):this}a=(a%360+360)%360;if(0===(a+90)%180)return d=this.lng+b/(6371000.79*Hb*zb(this.lat*Jb))*(270===a?-360:360),new R(this.lat,(d+540)%360-180);if(b/=6371000.79){a*=Jb;h=this.lat*Jb;e=this.lng*Jb;f=h+b*zb(a);g=f-h;d=vb(Ab(f/2+Gb)/Ab(h/2+Gb));d=Ra(g/\nd)?zb(h):g/d;var m=b*xb(a)/d;ub(f)>Eb&&(f=0<f?I-f:-(I+f))}return b?new R(f*Kb,((e+m+Ib+(ub(h+g)>Eb?I:0))%Hb-I)*Kb):this};R.prototype.walk=R.prototype.ic;R.prototype.Y=function(){return new T(this.lat,this.lng,this.lat,this.lng)};R.prototype.getBoundingBox=R.prototype.Y;function Oe(a,b,c){var d=qa(a)&&!(Ra(a.lat=Le(a.lat))||Ra(a.lng=Me(a.lng))||a.alt!==z&&Ra(a.alt=Ne(a.alt)));if(!d&&b)throw new A(b,c,a);return d}R.validate=Oe;\nfunction Pe(a){if(!a)throw new A(Pe,0,a);return new R(a.lat,a.lng,a.alt)}R.fromIPoint=Pe;l=R.prototype;l.oa=\"Point\";l.eb=function(a){a.push(\"(\",this.lng,\" \",this.lat,\")\");return a};l.wa=\"Point\";l.cb=function(){return[this.lng,this.lat,this.alt||0]};l.va=function(){return[this.lat,this.lng,this.alt||0]};var W={};t(\"H.geo.mercator\",W);W.a=function(a){return sb(1,tb(0,.5-vb(Ab(Gb+Eb*a/180))/I/2))};W.b=function(a){return a/360+.5};W.la=function(a,b,c){c?(c.x=W.b(b),c.y=W.a(a)):c=new E(W.b(b),W.a(a));return c};W.latLngToPoint=W.la;W.tb=function(a,b){return W.la(a.lat,a.lng,b)};W.geoToPoint=W.tb;W.f=function(a){return 0>=a?90:1<=a?-90:Kb*(2*Bb(wb(I*(1-2*a)))-Eb)};W.c=function(a){return 360*(1===a?1:Mb(a,1))-180};W.X=function(a,b,c){c?(c.lat=W.f(b),c.lng=W.c(a)):c=new R(W.f(b),W.c(a));return c};\nW.xyToGeo=W.X;W.Wb=function(a,b){return W.X(a.x,a.y,b)};W.pointToGeo=W.Wb;t(\"H.util.constants.DEFAULT_MIN_ZOOM_LEVEL\",0);t(\"H.util.constants.DEFAULT_MAX_ZOOM_LEVEL\",22);function X(a,b){this.projection=a||W;this.b=0;this.a=this.exp=vb(b||256)/Db;Qe(this);this.y=this.x=0}t(\"H.geo.PixelProjection\",X);var Re=ub(24)+ub(-8);X.prototype.Zb=W;X.prototype.projection=X.prototype.Zb;X.prototype.x=0;X.prototype.x=X.prototype.x;X.prototype.y=0;X.prototype.y=X.prototype.y;X.prototype.hc=rb(2,Re);X.prototype.w=X.prototype.hc;X.prototype.Jb=rb(2,Re);X.prototype.h=X.prototype.Jb;\nX.prototype.da=function(a){if(Ra(a))throw new A(this.da,0,a);var b=this.x/this.w;var c=this.y/this.h;this.b=a;this.a=this.exp+a;Qe(this);this.x=b*this.w;this.y=c*this.h};X.prototype.rescale=X.prototype.da;function Qe(a){a.a>Re&&(a.a=Re);a.w=rb(2,a.a);a.h=rb(2,a.a)}X.prototype.Sa=function(){return this.b||0};X.prototype.getZoomScale=X.prototype.Sa;X.prototype.sb=function(a,b){a=this.projection.la(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};X.prototype.geoToPixel=X.prototype.sb;\nX.prototype.Fa=function(a,b){return this.projection.X((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};X.prototype.pixelToGeo=X.prototype.Fa;X.prototype.X=function(a,b,c){return this.projection.X((a+this.x)/this.w,(b+this.y)/this.h,c)};X.prototype.xyToGeo=X.prototype.X;X.prototype.Ba=function(a,b,c){a=this.projection.la(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};X.prototype.latLngToPixel=X.prototype.Ba;X.prototype.Xb=function(a){return new E(a.x*this.w-this.x,a.y*this.h-this.y)};\nX.prototype.pointToPixel=X.prototype.Xb;t(\"H.util.Disposable\",K);K.prototype.N=K.prototype.N;K.prototype.addOnDisposeCallback=K.prototype.N;t(\"H.util.dispose\",function(a){a&&\"function\"==typeof a.B&&a.B()});K.prototype.B=K.prototype.B;K.prototype.dispose=K.prototype.B;K.prototype.P=K.prototype.P;function Se(){}t(\"H.util.ICancelable\",Se);Se.prototype.cancel=function(){};Se.prototype.cancel=Se.prototype.cancel;function Te(a,b,c,d){this.key=\"\";this.x=a;this.y=b;this.b=c;this.Z=d;this.a=Ad()}Te.prototype.then=function(a,b,c){return this.a.a.then(a,b,c)};Te.prototype.reject=function(a){this.a.reject(a)};Te.prototype.cancel=function(){this.a.a.cancel()};function Ue(a,b,c,d){if(!a||!b||!c)throw new A(Ue,null,\"Must specify name, version and revision parameter\");this.name=a;this.version=b;this.revision=c;d&&Ca(this,d)}t(\"H.util.BuildInfo\",Ue);Ue.prototype.toString=function(){var a,b=[];for(a in this)Qa(this[a])&&b.push(this[a]);return b.join(\";\")};var Ve={};function We(a,b,c,d){if(!a)throw new A(We,1,\"Must specify a name parameter\");return Ve[a]||(Ve[a]=new Ue(a,b,c,d))}Ue.get=We;function Z(a,b,c,d,e,f){if(a&&b)this.bb(a),this.Ha(b),this.Ka(c),this.ab(e),this.$a(f),this.La(d);else throw Error('Parameters \"scheme\" and \"host\" must be specified');}t(\"H.service.Url\",Z);\nfunction Xe(a,b){var c=y.document,d,e=c&&c.createElement(\"a\"),f=\"\";if(c){if(b){var g=(d=c.getElementsByTagName(\"base\")[0])&&d.href;var h=c.head;var k=d||h.appendChild(c.createElement(\"base\"));k.href=b}e.href=a;f=e.href;b&&(d?d.href=g:h.removeChild(k))}else/[\\w]+:\\/\\//.test(a)&&(f=a);g=/(?:(\\w+):\\/\\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\\/[^?#]*)?(\\?[^#]+)?(#.*)?/.exec(f);a=g[1];k=g[4];b=g[5];h=g[6];c=g[7];d=g[8];!g[2]&&k&&/@/.test(k)&&(k=k.split(\"@\")[1]);g=k;h=h&&0<h.length?h.substr(1):\n\"\";k={};if(c)for(e=/([?&]?([^=&+]+))(=([^&]+))?/g;f=e.exec(c);)k[decodeURIComponent(f[2])]=f[4]?decodeURIComponent(f[4]):void 0;return new Z(a,g,h,k,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):\"\")}Z.parse=Xe;var Ye=0;Z.prototype.clone=function(){Ye++;var a={},b;for(b in this.a)a[b]=this.a[b];return new Z(this.o,this.f,this.b,a,this.g,this.c)};Z.prototype.clone=Z.prototype.clone;\nZ.prototype.bb=function(a){if(!a||\"string\"!==typeof a)throw Error('The \"scheme\" parameter must be a non-empty string.');this.o=a;return this};Z.prototype.setScheme=Z.prototype.bb;Z.prototype.Gb=function(){return this.o};Z.prototype.getScheme=Z.prototype.Gb;Z.prototype.Ha=function(a){if(!a||\"string\"!==typeof a||\"-\"===a.charAt(0)||\".\"===a.charAt(0)||\".\"===a.charAt(a.length-1))throw Error('The \"host\" parameter is not a valid host name.');this.f=a;return this};Z.prototype.setHost=Z.prototype.Ha;\nZ.prototype.yb=function(){return this.f};Z.prototype.getHost=Z.prototype.yb;Z.prototype.Ka=function(a){this.b=a||void 0;return this};Z.prototype.setPath=Z.prototype.Ka;Z.prototype.Db=function(){return this.b};Z.prototype.getPath=Z.prototype.Db;Z.prototype.La=function(a){if(a)if(\"object\"==typeof a)this.a=a;else throw Error('Parameter \"params\" must be an object.');else this.a={};return this};Z.prototype.setQuery=Z.prototype.La;Z.prototype.Kb=function(){return!Ze(this)};Z.prototype.hasQuery=Z.prototype.Kb;\nZ.prototype.getQuery=function(){return this.a};Z.prototype.getQuery=Z.prototype.getQuery;Z.prototype.ab=function(a){if(a&&isNaN(parseInt(a,10)))throw Error('Parameter \"port\" must be a number or undefined');this.g=+a||void 0;return this};Z.prototype.setPort=Z.prototype.ab;Z.prototype.Eb=function(){return this.g};Z.prototype.getPort=Z.prototype.Eb;Z.prototype.$a=function(a){this.c=a||void 0;return this};Z.prototype.setAnchor=Z.prototype.$a;Z.prototype.ub=function(){return this.c};\nZ.prototype.getAnchor=Z.prototype.ub;Z.prototype.aa=function(a){if(\"object\"!==typeof a)throw Error('Parameter \"other\" must be an object.');var b=this.a,c;for(c in a)a.hasOwnProperty(c)&&\"function\"!==typeof a[c]&&(b[c]=a[c]);return this};Z.prototype.mergeQuery=Z.prototype.aa;Z.prototype.ib=function(a){if(!a||\"string\"!==typeof a)throw Error('Parameter \"subDomain\" must be a non-empty string');\".\"===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Ha(a+\".\"+this.f)};\nZ.prototype.addSubDomain=Z.prototype.ib;Z.prototype.jb=function(a){if(!a||\"string\"!==typeof a)throw Error('Parameter \"subPath\" must be a non-empty string');return this.Ka((this.b?this.b+\"/\":\"\")+a)};Z.prototype.addSubPath=Z.prototype.jb;Z.prototype.toString=function(){return[this.o+\"://\",this.f,this.g?\":\"+this.g:\"\",this.b||!Ze(this)||this.c?\"/\":\"\",this.b?encodeURI(this.b):\"\",$e(this),this.c?\"#\"+encodeURIComponent(this.c):\"\"].join(\"\")};Z.prototype.toString=Z.prototype.toString;\nfunction $e(a){function b(g,h){return encodeURIComponent(g)+(void 0===h?\"\":\"=\"+encodeURIComponent(h).replace(/[!'()*]/g,function(k){return\"%\"+k.charCodeAt(0).toString(16)}))}var c=[],d,e=a.a;for(d in e)if(e.hasOwnProperty(d)&&\"function\"!==typeof e[d]){var f=a.a[d];Na(f,af)?f.fb.forEach(function(g){c.push(b(d,g))}):c.push(b(d,f))}return 0<c.length?\"?\"+c.join(\"&\"):\"\"}function Ze(a){var b,c=0;for(b in a.a)if(a.a.hasOwnProperty(b)&&\"function\"!==typeof a.a[b]&&(c++,0<c))break;return!c}\nfunction af(a){var b;if(!Oa(a,void 0,void 0,void 0))throw new A(af,0,a);for(b=0;b<a.length;b++){var c=a[b];if(!Qa(c)&&!Sa(c))throw new A(af,0,\"The array can only contain strings and numbers\");}this.fb=a}Z.MultiValueQueryParameter=af;af.prototype.Ib=function(){return this.fb};af.prototype.getValues=af.prototype.Ib;var bf={};function cf(a){try{importScripts.apply(self,arguments)}catch(b){this.postError(\"invalid_script\")}}function df(a){bf[a]=null;this.postMessage(a)}function ef(a,b,c){if(r(b))var d=b;else try{d=self.eval(\"(\"+b+\")\"),r(d)||(d=null)}catch(e){}d?(bf[a]=d,c||this.postMessage(a)):this.postError(\"invalid_processor\")}function ff(a){this.b=a&&a[0];this.a=a&&a[1];this.c=a&&a[2]||[]}ff.prototype.postError=function(a){this.postMessage(a,z,0)};\nff.prototype.postMessage=function(a,b,c){self.postMessage({processor:this.b,taskId:this.a,type:c===z?1:c,data:a},b||z)};function gf(a,b,c){if(!Qa(a))throw new A(gf,0,\"InvalidArgument\");if(!r(b))throw new A(gf,1,\"InvalidArgument\");var d=hf++;jf[d]={mimeType:c||kf,mb:b};(new ff([\"3\",d,[]])).postMessage(a,[],2)}var jf={},hf=0;\nfunction lf(a,b){var c=a;if(jf[this.a]){var d=jf[this.a];var e=d.mb;delete jf[this.a];if(b)e(null,b);else{if(d.mimeType===mf){a=new Uint8Array(a);b=a.byteLength;d=\"\";c=0;for(var f,g,h,k;c<b;)f=a[c++],192>f||(g=a[c++],224>f?f=(f&31)<<6|g&63:(h=a[c++],240>f?f=(f&15)<<12|(g&63)<<6|h&63:(k=a[c++],f=(f&7)<<18|(g&63)<<12|(h&63)<<6|k&63))),65536>f?d+=String.fromCharCode(f):(f-=65536,d+=String.fromCharCode((f>>10)+55296,(f&1023)+56320));c=d}e(c)}}}var kf=0,mf=1;function T(a,b,c,d){nf(this,Le(a,T,0),Me(b,T,1),Le(c,T,2),Me(d,T,3))}xa(T,Q);t(\"H.geo.Rect\",T);T.prototype.oa=\"Polygon\";T.prototype.eb=function(a){var b=this.m,c=this.i,d=this.l,e=this.j;a.push(\"(\",\"(\",c,\" \",b,\",\",e,\" \",b,\",\",e,\" \",d,\",\",c,\" \",d,\",\",c,\" \",b,\")\",\")\");return a};T.prototype.I=function(a){return this===a||!!a&&this.m===a.m&&this.i===a.i&&this.l===a.l&&this.j===a.j};T.prototype.equals=T.prototype.I;T.prototype.clone=function(){return new T(this.m,this.i,this.l,this.j)};\nT.prototype.clone=T.prototype.clone;function nf(a,b,c,d,e){a.i=c;a.j=e;b<d&&(c=b,b=d,d=c);a.m=b;a.l=d;a.c=a.a=a.b=null;return a}T.prototype.Ra=function(){this.c||(this.c=new R(this.m,this.i));return this.c};T.prototype.getTopLeft=T.prototype.Ra;T.prototype.Qa=function(){this.a||(this.a=new R(this.l,this.j));return this.a};T.prototype.getBottomRight=T.prototype.Qa;T.prototype.Hb=function(){return this.m};T.prototype.getTop=T.prototype.Hb;T.prototype.vb=function(){return this.l};\nT.prototype.getBottom=T.prototype.vb;T.prototype.Ab=function(){return this.i};T.prototype.getLeft=T.prototype.Ab;T.prototype.Fb=function(){return this.j};T.prototype.getRight=T.prototype.Fb;T.prototype.J=function(){this.b||(this.b=new R(this.l+(this.m-this.l)/2,of(this.i,this.L())));return this.b};T.prototype.getCenter=T.prototype.J;T.prototype.L=function(){return pf(this.i,this.j)};T.prototype.getWidth=T.prototype.L;T.prototype.S=function(){return this.m-this.l};T.prototype.getHeight=T.prototype.S;\nT.prototype.Nb=function(){return this.i>this.j};T.prototype.isCDB=T.prototype.Nb;T.prototype.Qb=function(){return!this.L()&&!this.S()};T.prototype.isEmpty=T.prototype.Qb;T.prototype.Y=function(){return new T(this.m,this.i,this.l,this.j)};T.prototype.getBoundingBox=T.prototype.Y;T.prototype.ga=function(a,b,c){var d=this.J();c||(a=Le(a,this.ga,0),b=Me(b,this.ga,1));b=this.M(a,b,c);a=b.J();return a.lat===d.lat&&a.lng===d.lng&&this.S()===b.S()&&this.L()===b.L()};T.prototype.containsLatLng=T.prototype.ga;\nT.prototype.ha=function(a,b){b||Oe(a,this.ha,0);return this.ga(a.lat,a.lng,b)};T.prototype.containsPoint=T.prototype.ha;T.prototype.Pa=function(a,b){var c=this.J();if(!b&&!Na(a,T))throw new A(this.Pa,0,a);b=this.ma(a,b);a=b.J();return a.lat===c.lat&&a.lng===c.lng&&this.S()===b.S()&&this.L()===b.L()};T.prototype.containsRect=T.prototype.Pa;\nT.prototype.M=function(a,b,c,d){if(!c){if(Ra(a=Le(a)))throw new A(this.M,0,a);if(Ra(b=Me(b)))throw new A(this.M,1,b);}return qf(this.m,this.i,this.l,this.j,a,b,a,b,d)};T.prototype.mergeLatLng=T.prototype.M;T.prototype.Wa=function(a,b,c){b||Oe(a,this.Wa,0);return this.M(a.lat,a.lng,b,c)};T.prototype.mergePoint=T.prototype.Wa;T.prototype.ma=function(a,b,c){if(!b&&!Na(a,T))throw new A(this.ma,0,a);return qf(this.m,this.i,this.l,this.j,a.m,a.i,a.l,a.j,c)};T.prototype.mergeRect=T.prototype.ma;\nT.prototype.ba=function(a,b,c,d,e,f){e||(a=Le(a,this.ba,0),b=Me(b,this.ba,1),c=Le(c,this.ba,2),d=Me(d,this.ba,3));return qf(this.m,this.i,this.l,this.j,a,b,c,d,f)};T.prototype.mergeTopLeftBottomRight=T.prototype.ba;T.prototype.Ua=function(a,b){var c=this.i<=this.j,d=a.i<=a.j,e=this.i<a.j,f=a.i<this.j;if(!b&&!Na(a,T))throw new A(this.Ua,0,a);return this.l<=a.m&&a.l<=this.m&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};T.prototype.intersects=T.prototype.Ua;function pf(a,b){a=b-a;return a+(0>a?360:0)}\nfunction of(a,b){a+=b/2;return a-(180<a?360:0)}function qf(a,b,c,d,e,f,g,h,k){c=sb(c,g);a=tb(a,e);e=pf(b,d);var m=of(b,e);g=pf(f,h);var n=of(f,g)-m;n+=0>n-1E-6?360:0;if(180>n-1E-6){m=b;var q=h}else n=360-n,m=f,q=d;n=n+e/2+g/2;360<=n+5E-7?(m=-180,q=180):n-5E-7<e?(m=b,q=d):n-5E-7<g&&(m=f,q=h);return k?nf(k,a,m,c,q):new T(a,m,c,q)}T.merge=qf;function rf(a,b,c){c||(Oe(a,rf,0),Oe(b,rf,1));return new T(a.lat,a.lng,b.lat,b.lng)}T.fromPoints=rf;\nfunction sf(a,b){var c=1,d=a.length,e=null;var f=oa(a);if(\"array\"!=f&&(\"object\"!=f||\"number\"!=typeof a.length))throw new A(sf,0,a);if(0<d)for(f=a[0],e=rf(f,f,b);c<d;c++)f=a[c],e.M(f.lat,f.lng,b,e);return e}T.coverPoints=sf;function tf(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new A(tf,0,a);if(0<d)for(e=new T(a[0],a[1],a[0],a[1]);c<d;c+=3)e.M(a[c],a[c+1],b,e);return e}T.coverLatLngAlts=tf;\nfunction uf(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new A(uf,0,a);if(0<d)for(e=new T(a[0].m,a[0].i,a[0].l,a[0].j);c<d;c++)e.ma(a[c],b,e);return e}T.coverRects=uf;\nT.prototype.Ya=function(a,b){var c=this.i,d=this.m,e=this.j,f=this.l,g=this.J().lng;Oe(a,this.Ya,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?nf(b,d,a,f,e):new T(d,a,f,e)};T.prototype.resizeToCenter=T.prototype.Ya;T.prototype.wa=\"Polygon\";\nT.prototype.cb=function(){return[[this.i,this.m,0],[this.j,this.m,0],[this.j,this.l,0],[this.i,this.l,0],[this.i,this.m,0]]};T.prototype.ua=function(){return this.va()};T.prototype.va=function(){return[this.m,this.i,this.l,this.j]};function vf(a,b,c,d){var e=!!c,f,g=0,h=0,k=0,m=0,n=0,q,u=-1;var J=y.Float32Array;var M,v=[];if(b){b=La(b);a=La(a);e&&(f=La(c));c=b.length;d=d?1E-7:1E-5;for(M=new J(3*c);g<c;){J=b[g];var G=+J;var Y=+a[g];e&&(q=+f[g]);wf.test(J)?0<=u&&(0<g-u&&v.push(u,g+1),u=-1):0>u&&(u=g);g++;m=M[h++]=m+Y*d;k=M[h++]=k+G*d;e&&(n=M[h]=n+q);h++}0<=u&&1<c-u&&v.push(u,c)}else M=new J(0);return{path:M,outlineIndices:v}}var wf=/^-?0\\d/;\nfunction xf(a,b){for(var c=0,d=a.length/3,e=new y.Array(d),f=0;c<d;)e[c++]=b.Ba(a[f],a[++f]),f+=2;return e};function yf(a,b){b=180/(1<<b);var c=a.lat+90;a=(a.lng+180)%360;var d=0;180==c&&d--;d+=Math.floor(c/b);return[d,Math.floor(a/b)]}var zf=1/Math.pow(10,10);function Af(a,b){var c=[],d=a.Ra();a=a.Qa();var e;180==a.lng&&(a.lng-=zf);d=yf(d,b);a=yf(a,b);for(e=d[0];e>=a[0];e--)for(b=d[1];b<=a[1];b++)c.push(e,b);return c};function Bf(a,b){var c=a.tileSize||256;this.b={};this.v=Xe(a.serverUrl);this.g=b;this.fc=a.layerConfigs||[];this.o=a.projected;this.T=c;this.Ea=!1!==a.batchTiles;this.Ga=a.horizontalMargin||0;this.gc=a.onlyOutline;this.gb=new X(Ia,c);this.f=new X(Ia,c);this.f.da(22-Math.log(c)/Math.LN2+8)}xa(Bf,K);l=Bf.prototype;\nl.ac=function(a,b,c){var d=this.T,e=this.Ga,f={x:a*d-e,y:b*d};d={x:(a+1)*d-1+e,y:(b+1)*d-1};e=this.gb;e.da(c);f=e.Fa(f);d=e.Fa(d);return Cf(this,new T(f.lat,f.lng,d.lat,d.lng),this.fc,{x:a,y:b,z:c})};l.$b=function(a,b,c,d,e){return Cf(this,new T(a,b,c,d),e)};\nfunction Cf(a,b,c,d){var e=Df(c),f=e.length,g={},h,k=a.b,m=[],n=[];for(c=0;c<f;c++){var q=e[c];var u=q.layerId;var J=q.level;g[u]=q.columns;q=Af(b,J);var M=q.length-1;for(h=0;h<M;h+=2){var v=[u,q[h+1],q[h],J].join(\"_\");var G=k[v]||a.g.get(v);G||(G=new Te(q[h+1],q[h],J,u),G.key=v,k[v]=G,n.push(G));m.push(G)}}n.length&&(a.Ea?Ef(a,n):Ff(a,n));return zd(m.map(function(Y){return Y.then(Fa(this.qb,this,Y.Z,Gf(e))).then(Fa(this.Yb,this,Y,d||{})).then(Fa(this.rb,this,g[Y.Z]))},a))}\nl.qb=function(a,b,c){var d=c.Rows,e=d.length,f,g;if(e&&(f=b[a])){b=new D(c.Rows);var h=[];for(g=0;g<e;g++){var k=d[g];f(b.ja(g),a)&&h.push(k)}a={Rows:h};if(c=c.Meta)a.Meta=c}else a=c;return a};function Ff(a,b){function c(k,m,n){n?(delete a.b[k.key],k.reject(n)):Hf(a,k,m)}var d,e=b.length,f=a.v;for(d=0;d<e;d++){var g=b[d];var h=f.clone().aa({tilex:g.x}).aa({tiley:g.y}).aa({level:g.b}).aa({layer:g.Z});new gf(h.toString(),Fa(c,null,g),mf)}}\nfunction Ef(a,b){var c=b.length,d;for(d=0;d<c;d+=15){var e=b.slice(d,d+15);If(a,e)}}function If(a,b){var c=a.v.clone(),d=[],e=[],f=[],g=c.getQuery();b.length&&(b.forEach(function(h){d.push(h.x,h.y);e.push(h.b);f.push(h.Z)}),g.tilexy=d.join(\",\"),g.layers=f.join(\",\"),g.levels=e.join(\",\"),c.La(g),new gf(c.toString(),function(h,k){k?b.forEach(function(m){delete a.b[m.key];m.reject(\"error\")}):Hf(a,b,h)},mf))}\nfunction Hf(a,b,c){var d=b.length,e;if(Oa(b,void 0,void 0,void 0)){var f=c.indexOf(\"[\")+1;for(e=0;e<d;e++){var g=c.indexOf(\"]},{\",f+3)+2;g<f&&(g=c.lastIndexOf(\"]}\"));var h=c.substr(f,g-f);f=g+1;Jf(a,b[e],h)}}else Jf(a,b,c)}function Jf(a,b,c){try{var d=c.length;var e=b.key;delete a.b[e];a.g.add(e,b,2*d);var f=JSON.parse(c);b.a.b(f)}catch(g){b.reject(g.message)}}\nfunction Gf(a){var b={},c,d=a.length;for(c=0;c<d;c++){var e=a[c];if(e.rowFilter){var f=e.layerId;f=f!==z?f:e.layer;b[f]=Fa(e.rowFilter,e.rowFilterContext)}}return b}function Kf(a,b,c,d,e){return e?[new E(a,b),new E(c,b),new E(c,d),new E(a,d),new E(a,b)]:[a,b,c,b,c,d,a,d]}\nl.Yb=function(a,b,c){var d=this.f.Sa()-b.z,e=this.T<<d,f=50<<d,g=b.x*e;b=b.y*e;var h=g+e;e=b+e;var k=g-f,m=b-f,n=h+f;f=e+f;var q,u,J=c.Rows,M=J.length,v,G=/^ADAS/.test(a.Z),Y=this.f,pa=this.gc,S,ab=[],Ja=[],Ka=[],bb=[];for(a=0;a<M;a++){var w=v=J[a];var P=(S=G)?\"HPY\":\"LAT\";var U=S?\"HPX\":\"LON\";var ea=S?\"HPZ\":\"ZLEVEL\";if(w[P]){var V=vf(w[P],w[U],w[ea],S);w.geometry=V;delete w[P];delete w[U];delete w[ea];if(w.INNER_LAT)for(P=w.INNER_LAT.split(\";\"),V=w.INNER_LON.split(\";\"),delete w.INNER_LAT,delete w.INNER_LON,\nw.interiors=ea=[],U=P.length,w=0;w<U;w++)ea.push(vf(P[w],V[w],\"\",S))}if(this.o){S=void 0;U=v;V=Y;P=U.$$projected$$;if(!P){var ba=U.geometry;w=xf(ba.path,V);v=[w];U.$$projected$$=P={Vb:v};U=(ea=U.interiors)?ea.length:0;v.length+=U;S|=Lf(v,w,ba.outlineIndices);if(U)for(P.Lb=1,q=0;q<U;q++)ba=ea[q],w=xf(ba.path,V),v[1+q]=w,S|=Lf(v,w,ba.outlineIndices);S&&(P.Tb=1+U)}w=P;S=w.Vb;v=w.Lb;var zc=w.Tb;V=[];P=U=Lb;var cb=ea=z;w=S[0];if(1===w.length){var Ac=Ac||(Ac=Kf(g,b,h,e,!1));v=w[0];Rb(v.x,v.y,Ac)&&V.push(Mf(w,\ng,b,d))}else{var Be=S.length;for(ba=pa?zc:0;ba<Be&&(pa||!ba||V.length);ba++)if(w=S[ba],ba>=zc){ba===zc&&(P=V.length);var ja=Ub([w],k,m,n,f,!1);Nf(ja,g,b,d,V)}else{var Fb=Fb||(Fb=Kf(k,m,n,f,!0));if(ba>=v)if(ba===v&&(U=V.length),cb)for(q=cb.length;q--;){if(ja=Of(cb[q],w),u=ja.length){for(ea=ea||[];u--;)ea.push(q);Nf(ja,g,b,d,V)}}else ja=Of(Fb,w),Nf(ja,g,b,d,V);else if(ja=Of(Fb,w),Nf(ja,g,b,d,V),1<ja.length&&v<Be)for(cb=[],q=ja.length;q--;)cb[q]=ja[q]}}V.length&&(ab[a]=V,Ja[a]=U,Ka[a]=ea,bb[a]=P)}}return{dc:c,\nnb:ab,Mb:Ja,pb:Ka,Ub:bb}};function Lf(a,b,c){for(var d=c.length,e=0,f,g,h=b.length;e<d;)f=c[e++],g=c[e++],a.push(g-f===h?b:b.slice(f,g));return 0<c.length}function Of(a,b){var c,d=[];if(c=Wb(a,b)){do{a=[];b=c;do a.push(b);while(b=b.next);d.push(a)}while(c=c.Xa)}else Sb(b[0],Tb(a))?d.push(b):Sb(a[0],Tb(b))&&d.push(a);return d}function Nf(a,b,c,d,e){for(var f=0,g=a.length;f<g;f++)e.push(Mf(a[f],b,c,d))}\nfunction Mf(a,b,c,d){var e,f=a.length,g=new Int32Array(2*f),h=0;for(e=0;e<f;e++){var k=a[e];g[h++]=k.x-b>>d;g[h++]=k.y-c>>d}return g}\nl.rb=function(a,b){var c=b.dc,d=b.nb,e=b.Mb,f=b.Ub;b=b.pb;for(var g=[],h,k={Rows:g},m,n=a?a.length:0,q=0,u,J=c.Rows,M=J.length,v;q<M;q+=1)if(d[q]||!this.o){h={};u=J[q];if(n)for(m=0;m<n;m++)u.hasOwnProperty(a[m])&&(h[a[m]]=u[a[m]]);else for(v in u)\"$$projected$$\"!==v&&(h[v]=u[v]);u.geometry&&(h.geometry=u.geometry);m=void 0;var G,Y=h,pa=d[q],S=e[q],ab=b[q],Ja=f[q],Ka=g;if(pa){var bb=pa.length;if(ab)for(G=S;G--;){if(G){var w={};for(m in Y)w[m]=Y[m]}else w=Y;u=[pa[G]];var P=sb(bb,Ja)-S;for(h=0;h<P;h++)ab[h]===\nG&&u.push(pa[S+h]);P=u.length;if(!G)for(h=Ja;h<bb;h++)u.push(pa[h]);w.$HProjGeometry={paths:u,interiorsIndex:1,outlinesIndex:P};Ka.push(w)}else Y.$HProjGeometry={paths:pa,interiorsIndex:S,outlinesIndex:Ja},Ka.push(Y)}else Ka.push(Y)}c.Meta&&(k.Meta=c.Meta);return k};l.P=function(){var a,b=this.b;for(a in b)b.hasOwnProperty(a)&&(b[a].reject(\"disposed\"),delete b[a])};\nfunction Df(a){for(var b=[],c,d=a.length,e=0;e<d;e++){c=Aa(a[e]);if(c.rowFilter&&(c.rowFilter=eval(\"(\"+c.rowFilter+\")\"),!r(c.rowFilter)))throw Error(\"Invalid row filter for layer \"+c.layerId);b.push(c)}return b};t(\"H.service.extension.worker.processor\",function(a,b,c){function d(h){e.postMessage(h)}var e=this,f=za[a];var g=function(h){e.postError(h.toString())};if(0===b)f||(za[a]=new Bf(c,Pf)),this.postMessage();else if(f)switch(b){case 1:try{f.ac.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 2:try{f.$b.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 3:f.B();delete za[a];ya()&&Pf.U();break;default:e.postError(\"Unsupported command\")}});\nvar Pf=new B(26214400),za=Object.create(Ia,void 0);function Qf(a,b,c){var d=a[b];a=a[b+1];this.Ta=[];this.Ma=0;this.b=b;this.a=[a-c,d-c,a+c,d+c]}Qf.prototype.ha=function(a,b){var c=a[b];a=a[b+1];b=this.a;return b[1]<=c&&c<=b[3]&&b[0]<=a&&a<=b[2]};Qf.prototype.J=function(){return this.b};var Rf=new E(0,0);function Sf(a,b,c,d,e){d[e]=b;d[e+1]=a}var Tf=new X;function Uf(a,b,c,d,e){Tf.Ba(a,b,Rf);d[e]=Rf.x;d[e+1]=Rf.y}\nt(\"H.clustering.dynamicgrid.worker\",function(a,b,c,d,e){var f=e?Sf:Uf,g=0;e=!!self.ArrayBuffer;var h=a.byteLength?new Float64Array(a):a,k=h.length/3;a=[];var m=[],n=[],q=e?new Float64Array(2*k):[];k=0;var u=0;for(Tf.da(d);g<h.length;){var J=h[g++];var M=h[g++];var v=h[g++];f(v,M,d,q,u);for(v=a.length;v--;)if(M=a[v],M.ha(q,u)){var G=M;break}G||(G=new Qf(q,u,b),a.push(G));v=u/2;G.Ma+=J||1;G.Ta.push(v);G=null;u+=2}for(v=a.length;v--;)M=a[v],b=M.Ma>=c,f=M.Ta,d=f.length,b?(m.push(d),m=m.concat(f)):\n(k+=d,n=n.concat(f));c=[k].concat(n,m);c=e?(new Uint32Array(c)).buffer:c;this.postMessage(c,[c])});self.addEventListener(\"message\",function(a){a=new ff(a.data);var b=bf[a.b];if(b)try{b.apply(a,a.c)}catch(c){a.postError(c.message)}else a.postError(\"processor_not_found\")});(function(){var a=new ff;var b=function(c,d){ef.apply(a,[c,d,!0])};b(\"0\",cf);b(\"1\",ef);b(\"2\",df);b(\"3\",lf)})();\n";
/**!
 * The code below uses open source software. Please visit the URL below for an overview of the licenses: 
 * https://sdk.venues.here.com/v3/3.1/HERE_NOTICE 
 */
this.H=this.H||{},this.H.venues=function(e){"use strict";function t(e,t){void 0===t&&(t={});var n,r=t.insertAt;e&&"undefined"!=typeof document&&(n=document.head||document.getElementsByTagName("head")[0],(t=document.createElement("style")).type="text/css","top"===r&&n.firstChild?n.insertBefore(t,n.firstChild):n.appendChild(t),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)))}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach(function(e){c(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function v(e,t,n){return(v=a()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);r=new(Function.bind.apply(e,r));return n&&o(r,n.prototype),r}).apply(null,arguments)}function f(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};for(var n,r={},i=Object.keys(e),o=0;o<i.length;o++)n=i[o],0<=t.indexOf(n)||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),o=0;o<i.length;o++)n=i[o],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(n){var r=a();return function(){var e,t=d(n);return e=r?(e=d(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!=typeof e&&"function"!=typeof e?g(t):e}}function y(e,t,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(n):t.value}})(e,t,n||e)}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}t(".H_l_right .venues-ui__drawings .trigger.button--active .arrow {\n  transform: rotate(90deg); }\n\n.H_l_right .venues-ui__drawings .drawings {\n  right: 45px;\n  left: initial; }\n");var I=function(){h(r,H.map.Feature);var n=p(r);function r(e){var t;return u(this,r),(t=n.call(this)).id=e.id,t.model=e,t}return l(r,[{key:"getData",value:function(){return this.model}},{key:"getAddress",value:function(){return this.model.getInternalAddress()}},{key:"getCenter",value:function(){var e=A(this.model.getCenter(),2),t=e[0],e=e[1];return new H.geo.Point(e,t)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"toGeoJSON",value:function(){return this.model.toJSON()}},{key:"getLevel",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getLevel().getDrawing().getParentEventTarget()}}]),r}(),_=function(){h(r,H.map.Feature);var n=p(r);function r(e){var t;return u(this,r),(t=n.call(this)).id=e.id,t.model=e,t}return l(r,[{key:"getData",value:function(){return this.model}},{key:"getBoundingBox",value:function(){return v(H.geo.Rect,L(this.model.getBoundingBox()))}},{key:"getCenter",value:function(){var e=A(this.model.getCenter(),2),t=e[0],e=e[1];return new H.geo.Point(e,t)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getLevel",value:function(t){return this.getLevels().find(function(e){return e.id===t})}},{key:"getLevels",value:function(){var t=this.getData().getLevels().map(function(e){return e.getId()});return this.getVenue().getLevels().filter(function(e){return-1!==t.indexOf(e.id)})}},{key:"getMainLevel",value:function(){return this.getLevel(this.model.getMainLevel().getId())}},{key:"getVenue",value:function(){return this.getParentEventTarget()}}]),r}(),E=function(){h(r,H.map.Feature);var n=p(r);function r(e){var t;return u(this,r),(t=n.call(this)).id=e.id,t.model=e,t}return l(r,[{key:"getGeometry",value:function(t){return this.getGeometries().find(function(e){return e.id===t})}},{key:"getGeometries",value:function(){var t=this.getData().getGeometries().map(function(e){return e.getId()});return this.getDrawing().getVenue().getGeometries().filter(function(e){return-1!==t.indexOf(e.id)})}},{key:"getData",value:function(){return this.model}},{key:"getId",value:function(){return this.model.getId()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getShortName",value:function(){return this.model.getShortName()}},{key:"getZIndex",value:function(){return this.model.getZIndex()}},{key:"isMain",value:function(){return this.model.isMain()}},{key:"getDrawing",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getDrawing().getParentEventTarget()}}]),r}();function M(e,t,n,r){for(var i,o=r,a=n-t>>1,s=n-t,u=e[t],l=e[t+1],c=e[n],h=e[n+1],d=t+3;d<n;d+=3){var v=function(e,t,n,r,i,o){var a=i-n,s=o-r;{var u;0===a&&0===s||(1<(u=((e-n)*a+(t-r)*s)/(a*a+s*s))?(n=i,r=o):0<u&&(n+=a*u,r+=s*u))}return(a=e-n)*a+(s=t-r)*s}(e[d],e[d+1],u,l,c,h);o<v?(i=d,o=v):v!==o||(v=Math.abs(d-a))<s&&(i=d,s=v)}r<o&&(3<i-t&&M(e,t,i,r),e[i+2]=o,3<n-i&&M(e,i,n,r))}function T(e,t,n,r){r={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)N(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)N(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)N(e,t[r][i])}(r),r}function N(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function b(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)S(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)S(i[l],s);else if("LineString"===o)k(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],k(i[l],s,a,!1),e.push(T(u,"LineString",s,t.properties));return}w(i,s,a,!1)}else if("Polygon"===o)w(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"!==o)throw new Error("Input data is not a valid GeoJSON object.");for(l=0;l<t.geometry.geometries.length;l++)b(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}for(l=0;l<i.length;l++){var c=[];w(i[l],c,a,!0),s.push(c)}}e.push(T(u,o,s,t.properties))}}function S(e,t){t.push(P(e[0])),t.push(C(e[1])),t.push(0)}function k(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=P(e[s][0]),l=C(e[s][1]);t.push(u),t.push(l),t.push(0),0<s&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=t.length-3;t[2]=1,M(t,0,c,n),t[2+c]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function w(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];k(e[i],o,n,r),t.push(o)}}function P(e){return e/360+.5}function C(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}function x(e,t,n,r,i,o,a,s){if(r/=t,(n/=t)<=o&&a<r)return e;if(a<n||r<=o)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],h=c.geometry,d=c.type,v=0===i?c.minX:c.minY,f=0===i?c.maxX:c.maxY;if(n<=v&&f<r)u.push(c);else if(!(f<n||r<=v)){var g=[];if("Point"===d||"MultiPoint"===d)!function(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];n<=a&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}(h,g,n,r,i);else if("LineString"===d)D(h,g,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===d)R(h,g,n,r,i,!1);else if("Polygon"===d)R(h,g,n,r,i,!0);else if("MultiPolygon"===d)for(var p=0;p<h.length;p++){var y=[];R(h[p],y,n,r,i,!0),y.length&&g.push(y)}if(g.length)if(s.lineMetrics&&"LineString"===d)for(p=0;p<g.length;p++)u.push(T(c.id,d,g[p],c.tags));else"LineString"!==d&&"MultiLineString"!==d||(1===g.length?(d="LineString",g=g[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===g.length?"Point":"MultiPoint"),u.push(T(c.id,d,g,c.tags))}}return u.length?u:null}function D(e,t,n,r,i,o,a){for(var s,u,l=V(e),c=0===i?j:F,h=e.start,d=0;d<e.length-3;d+=3){var v=e[d],f=e[d+1],g=e[d+2],p=e[d+3],y=e[d+4],m=0===i?v:f,I=0===i?p:y,_=!1;a&&(s=Math.sqrt(Math.pow(v-p,2)+Math.pow(f-y,2))),m<n?n<I&&(u=c(l,v,f,p,y,n),a&&(l.start=h+s*u)):r<m?I<r&&(u=c(l,v,f,p,y,r),a&&(l.start=h+s*u)):G(l,v,f,g),I<n&&n<=m&&(u=c(l,v,f,p,y,n),_=!0),r<I&&m<=r&&(u=c(l,v,f,p,y,r),_=!0),!o&&_&&(a&&(l.end=h+s*u),t.push(l),l=V(e)),a&&(h+=s)}var E=e.length-3,v=e[E],f=e[1+E],g=e[2+E];n<=(m=0===i?v:f)&&m<=r&&G(l,v,f,g),E=l.length-3,o&&3<=E&&(l[E]!==l[0]||l[1+E]!==l[1])&&G(l,l[0],l[1],l[2]),l.length&&t.push(l)}function V(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function R(e,t,n,r,i,o){for(var a=0;a<e.length;a++)D(e[a],t,n,r,i,o,!1)}function G(e,t,n,r){e.push(t),e.push(n),e.push(r)}function j(e,t,n,r,i,o){t=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*t),e.push(1),t}function F(e,t,n,r,i,o){n=(o-n)/(i-n);return e.push(t+(r-t)*n),e.push(o),e.push(1),n}function U(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=B(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(B(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(B(o.geometry[s][l],t));i.push(u)}n.push(T(o.id,a,i,o.tags))}return n}function B(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function z(e,t){if(e.transformed)return e;for(var n,r=1<<e.z,i=e.x,o=e.y,a=0;a<e.features.length;a++){var s=e.features[a],u=s.geometry,l=s.type;if(s.geometry=[],1===l)for(n=0;n<u.length;n+=2)s.geometry.push(Y(u[n],u[n+1],t,r,i,o));else for(n=0;n<u.length;n++){for(var c=[],h=0;h<u[n].length;h+=2)c.push(Y(u[n][h],u[n][h+1],t,r,i,o));s.geometry.push(c)}}return e.transformed=!0,e}function Y(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function Z(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,function(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)W(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)W(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)W(a,l[s],e,n,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}r={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(r.id=t.id),e.features.push(r)}}(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,h=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function W(e,t,n,r,i,o){var a=r*r;if(0<r&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(0<n===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function J(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(t.maxZoom<0||24<t.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r,i,o,a,s=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)b(n,e.features[r],t,r);else"Feature"===e.type?b(n,e,t):b(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(this.stats={},this.total=0),r=s,o=(i=t).buffer/i.extent,e=x(a=r,1,-1-o,o,0,-1,2,i),t=x(r,1,1-o,2+o,0,-1,2,i),(e||t)&&(a=x(r,1,-o,1+o,0,-1,2,i)||[],e&&(a=U(e,1).concat(a)),t&&(a=a.concat(U(t,-1)))),(s=a).length&&this.splitTile(s,0,0,0),n&&s.length}function K(e,t,n){return 32*((1<<e)*n+t)+e}J.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},J.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c,h,d,v,f,g,p,y,m=1<<t,I=K(t,n,r),_=this.tiles[I];if(_||(_=this.tiles[I]=Z(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l&&(y="z"+t,this.stats[y]=(this.stats[y]||0)+1,this.total++)),_.source=e,i){if(t===u.maxZoom||t===i)continue;var E=1<<i-t;if(n!==Math.floor(o/E)||r!==Math.floor(a/E))continue}else if(t===u.indexMaxZoom||_.numPoints<=u.indexMaxPoints)continue;_.source=null,0!==e.length&&(h=.5-(c=.5*u.buffer/u.extent),d=1+c,p=v=f=g=null,y=x(e,m,n-c,n+(I=.5+c),0,_.minX,_.maxX,u),E=x(e,m,n+h,n+d,0,_.minX,_.maxX,u),e=null,y&&(p=x(y,m,r-c,r+I,1,_.minY,_.maxY,u),v=x(y,m,r+h,r+d,1,_.minY,_.maxY,u),y=null),E&&(f=x(E,m,r-c,r+I,1,_.minY,_.maxY,u),g=x(E,m,r+h,r+d,1,_.minY,_.maxY,u),E=null),s.push(p||[],t+1,2*n,2*r),s.push(v||[],t+1,2*n,2*r+1),s.push(f||[],t+1,2*n+1,2*r),s.push(g||[],t+1,2*n+1,2*r+1))}},J.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent;r.debug;if(e<0||24<e)return null;r=1<<e,r=K(e,t=(t%r+r)%r,n);if(this.tiles[r])return z(this.tiles[r],i);for(var o,a=e,s=t,u=n;!o&&0<a;)a--,s=Math.floor(s/2),u=Math.floor(u/2),o=this.tiles[K(a,s,u)];return o&&o.source?(this.splitTile(o.source,a,s,u,e,t,n),this.tiles[r]?z(this.tiles[r],i):null):null};function X(e){for(var t,n=[],r=[],i=0,o=e.coordinates.length;i<o;i+=1){var a=e.coordinates[i],s=function(e){e=function(e){for(var t=0,n=e.length,r=0;r<n-1;r+=1){var i=e[r],o=e[r+1];t+=i[0]*o[1]-o[0]*i[1]}return t+=e[n-1][0]*e[0][1]-e[0][0]*e[n-1][1]}(e);return 0<e?ve:e<0?fe:void 0}(a);null!==s&&(s===(t=t||s)&&r.length&&(n.push(r),r=[]),r.push(a))}return 0<r.length&&n.push(r),1===n.length?(e.type=$,e.coordinates=n[0]):1<n.length?(e.type=ne,e.coordinates=n):e=null,e}function Q(e,t,n,r,i){var o;return i=(t=n=(o=n,n=r,r=i,t=1<<(i=t),(i=[])[0]=((e=e)[0]/r+o)/t,i[1]=(e[1]/r+n)/t,{x:i[0],y:i[1]})).x,n=t.y,t=360*(i-.5),i=Math.exp(Math.PI*(.5-n)/.25)-1,n=Math.exp(Math.PI*(.5-n)/.25)+1,[t,180*Math.asin(i/n)/Math.PI]}var q="Point",$="Polygon",ee="MultiPoint",te="MultiLineString",ne="MultiPolygon",re={fillColor:"#e0e0e0",outlineColor:"#829DB4",outlineWidth:1},ie={fill:"#333333",size:13},oe={fillColor:"#F2F285",outlineColor:"#0088BF",outlineWidth:1.2},ae=18,se=18,ue=24,le={FOOTPRINT:"FOOTPRINT",ICON:"ICON",TEXT:"TEXT",VECTOR:"VECTOR"},ce=1,he=2,de=3,ve="CW",fe="CCW";function ge(e){var t=void 0===(i=e.addressList)?[]:i,n=void 0===(r=e.geometries)?[]:r,r=void 0===(i=e.entity)?null:i,i=void 0===(i=e.name)?"":i,e=void 0===(e=e.icon)?"":e;u(this,ge),this.addressList=t,this.geometries=n,this.icon=e,this.entity=r,this.name=i}var pe,ye,me=(function(e){e.exports=function(n){var r={};function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return i.m=n,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==s(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,n){function c(e){return(c="function"==typeof Symbol&&"symbol"==s(Symbol.iterator)?function(e){return s(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":s(e)})(e)}var o=n(1),n=n(7),I=n.get,P=(n.deepValue,n.isArray),n=(function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(_.prototype,[{key:"setCollection",value:function(e){return this.list=e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var r=e[t];this._keyWeights[r]=1,this._keyNames.push(r)}else{for(var i=0,o=0,a=e.length;o<a;o+=1){var s=e[o];if(!s.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var u=s.name;if(this._keyNames.push(u),!s.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');s=s.weight;if(s<0||1<s)throw new Error('"weight" property in key must bein the range of [0, 1)');i+=this._keyWeights[u]=s}if(1<i)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));t=this._prepareSearchers(e),e=t.tokenSearchers,t=t.fullSearcher,t=this._search(e,t);return this._computeScore(t),this.options.shouldSort&&this._sort(t),n.limit&&"number"==typeof n.limit&&(t=t.slice(0,n.limit)),this._format(t)}},{key:"_prepareSearchers",value:function(e){var e=0<arguments.length&&void 0!==e?e:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),r=0,i=n.length;r<i;r+=1)t.push(new o(n[r],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(e,t){var n=0<arguments.length&&void 0!==e?e:[],r=1<arguments.length?t:void 0,i=this.list,o={},a=[];if("string"==typeof i[0]){for(var s=0,u=i.length;s<u;s+=1)this._analyze({key:"",value:i[s],record:s,index:s},{resultMap:o,results:a,tokenSearchers:n,fullSearcher:r});return a}for(var l=0,c=i.length;l<c;l+=1)for(var h=i[l],d=0,v=this._keyNames.length;d<v;d+=1){var f=this._keyNames[d];this._analyze({key:f,value:this.options.getFn(h,f),record:h,index:l},{resultMap:o,results:a,tokenSearchers:n,fullSearcher:r})}return a}},{key:"_analyze",value:function(e,t){var T=this,N=e.key,n=e.arrayIndex,r=void 0===n?-1:n,i=e.value,o=e.record,n=e.index,e=t.tokenSearchers,b=void 0===e?[]:e,S=t.fullSearcher,e=t.resultMap,k=void 0===e?{}:e,t=t.results,w=void 0===t?[]:t;!function e(t,n,r,i){if(null!=n)if("string"==typeof n){var o=!1,a=-1,s=0;T._log("\nKey: ".concat(""===N?"--":N));var u=S.search(n);if(T._log('Full text: "'.concat(n,'", score: ').concat(u.score)),T.options.tokenize){for(var l=n.split(T.options.tokenSeparator),c=l.length,h=[],d=0,v=b.length;d<v;d+=1){var f=b[d];T._log('\nPattern: "'.concat(f.pattern,'"'));for(var g=!1,p=0;p<c;p+=1){var y=l[p],m=f.search(y),I={};m.isMatch?(I[y]=m.score,g=o=!0,h.push(m.score)):(I[y]=1,T.options.matchAllTokens||h.push(1)),T._log('Token: "'.concat(y,'", score: ').concat(I[y]))}g&&(s+=1)}a=h[0];for(var _=h.length,E=1;E<_;E+=1)a+=h[E];a/=_,T._log("Token score average:",a)}var M=u.score;-1<a&&(M=(M+a)/2),T._log("Score average:",M);var O=!T.options.tokenize||!T.options.matchAllTokens||s>=b.length;T._log("\nCheck Matches: ".concat(O)),(o||u.isMatch)&&O&&(M={key:N,arrayIndex:t,value:n,score:M},T.options.includeMatches&&(M.matchedIndices=u.matchedIndices),(u=k[i])?u.output.push(M):(k[i]={item:r,output:[M]},w.push(k[i])))}else if(P(n))for(var A=0,L=n.length;A<L;A+=1)e(A,n[A],r,i)}(r,i,o,n)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,r=0,i=e.length;r<i;r+=1){for(var o=e[r],a=o.output,s=a.length,u=1,l=0;l<s;l+=1){var c=a[l],h=c.key,d=n?t[h]:1,c=0===c.score&&t&&0<t[h]?Number.EPSILON:c.score;u*=Math.pow(c,d)}o.score=u,this._log(o)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var n,t=[];this.options.verbose&&(n=[],this._log("\n\nOutput:\n\n",JSON.stringify(e,function(e,t){if("object"===c(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t},2)),n=null);var r=[];this.options.includeMatches&&r.push(function(e,t){var n=e.output;t.matches=[];for(var r=0,i=n.length;r<i;r+=1){var o,a=n[r];0!==a.matchedIndices.length&&(o={indices:a.matchedIndices,value:a.value},a.key&&(o.key=a.key),a.hasOwnProperty("arrayIndex")&&-1<a.arrayIndex&&(o.arrayIndex=a.arrayIndex),t.matches.push(o))}}),this.options.includeScore&&r.push(function(e,t){t.score=e.score});for(var i=0,o=e.length;i<o;i+=1){var a=e[i];if(this.options.id&&(a.item=this.options.getFn(a.item,this.options.id)[0]),r.length){for(var s={item:a.item},u=0,l=r.length;u<l;u+=1)r[u](a,s);t.push(s)}else t.push(a.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}]),_);function _(e,t){var n=t.location,r=void 0===n?0:n,i=t.distance,o=void 0===i?100:i,a=t.threshold,s=void 0===a?.6:a,u=t.maxPatternLength,l=void 0===u?32:u,c=t.caseSensitive,h=void 0!==c&&c,d=t.tokenSeparator,v=void 0===d?/ +/g:d,f=t.findAllMatches,g=void 0!==f&&f,p=t.minMatchCharLength,y=void 0===p?1:p,m=t.id,n=void 0===m?null:m,i=t.keys,a=void 0===i?[]:i,u=t.shouldSort,c=void 0===u||u,d=t.getFn,f=void 0===d?I:d,p=t.sortFn,m=void 0===p?function(e,t){return e.score-t.score}:p,i=t.tokenize,u=void 0!==i&&i,d=t.matchAllTokens,p=void 0!==d&&d,i=t.includeMatches,d=void 0!==i&&i,i=t.includeScore,i=void 0!==i&&i,t=t.verbose,t=void 0!==t&&t;!function(e){if(!(e instanceof _))throw new TypeError("Cannot call a class as a function")}(this),this.options={location:r,distance:o,threshold:s,maxPatternLength:l,isCaseSensitive:h,tokenSeparator:v,findAllMatches:g,minMatchCharLength:y,id:n,keys:a,includeMatches:d,includeScore:i,shouldSort:c,getFn:f,sortFn:m,verbose:t,tokenize:u,matchAllTokens:p},this.setCollection(e),this._processKeys(a)}e.exports=n},function(e,t,n){var s=n(2),u=n(3),c=n(6),n=(function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(h.prototype,[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,r=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var i={isMatch:!0,score:0};return r&&(i.matchedIndices=[[0,e.length-1]]),i}var o=this.options,a=o.maxPatternLength,t=o.tokenSeparator;if(this.pattern.length>a)return s(e,this.pattern,t);n=this.options,i=n.location,o=n.distance,a=n.threshold,t=n.findAllMatches,n=n.minMatchCharLength;return u(e,this.pattern,this.patternAlphabet,{location:i,distance:o,threshold:a,findAllMatches:t,minMatchCharLength:n,includeMatches:r})}}]),h);function h(e,t){var n=t.location,r=void 0===n?0:n,i=t.distance,o=void 0===i?100:i,a=t.threshold,s=void 0===a?.6:a,u=t.maxPatternLength,l=void 0===u?32:u,n=t.isCaseSensitive,i=void 0!==n&&n,a=t.tokenSeparator,u=void 0===a?/ +/g:a,n=t.findAllMatches,a=void 0!==n&&n,n=t.minMatchCharLength,n=void 0===n?1:n,t=t.includeMatches,t=void 0!==t&&t;!function(e){if(!(e instanceof h))throw new TypeError("Cannot call a class as a function")}(this),this.options={location:r,distance:o,threshold:s,maxPatternLength:l,isCaseSensitive:i,tokenSeparator:u,findAllMatches:a,includeMatches:t,minMatchCharLength:n},this.pattern=i?e:e.toLowerCase(),this.pattern.length<=l&&(this.patternAlphabet=c(this.pattern))}e.exports=n},function(e,t){var u=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:/ +/g,n=new RegExp(t.replace(u,"\\$&").replace(n,"|")),r=e.match(n),n=!!r,i=[];if(n)for(var o=0,a=r.length;o<a;o+=1){var s=r[o];i.push([e.indexOf(s),s.length-1])}return{score:n?.5:1,isMatch:n,matchedIndices:i}}},function(e,t,n){var k=n(4),w=n(5);e.exports=function(e,t,n,r){for(var i=r.location,o=void 0===i?0:i,a=r.distance,s=void 0===a?100:a,i=r.threshold,a=void 0===i?.6:i,i=r.findAllMatches,u=void 0!==i&&i,i=r.minMatchCharLength,i=void 0===i?1:i,r=r.includeMatches,r=void 0!==r&&r,l=o,c=e.length,h=a,d=e.indexOf(t,l),v=t.length,f=[],g=0;g<c;g+=1)f[g]=0;-1!==d&&(a=k(t,{errors:0,currentLocation:d,expectedLocation:l,distance:s}),h=Math.min(a,h),-1!==(d=e.lastIndexOf(t,l+v))&&(S=k(t,{errors:0,currentLocation:d,expectedLocation:l,distance:s}),h=Math.min(S,h))),d=-1;for(var p=[],y=1,m=v+c,I=1<<(v<=31?v-1:30),_=0;_<v;_+=1){for(var E=0,M=m;E<M;)k(t,{errors:_,currentLocation:l+M,expectedLocation:l,distance:s})<=h?E=M:m=M,M=Math.floor((m-E)/2+E);m=M;var O=Math.max(1,l-M+1),A=u?c:Math.min(l+M,c)+v,L=Array(A+2);L[A+1]=(1<<_)-1;for(var T=A;O<=T;--T){var N=T-1,b=n[e.charAt(N)];if(b&&(f[N]=1),L[T]=(L[T+1]<<1|1)&b,0!==_&&(L[T]|=(p[T+1]|p[T])<<1|1|p[T+1]),L[T]&I&&(y=k(t,{errors:_,currentLocation:N,expectedLocation:l,distance:s}))<=h){if(h=y,(d=N)<=l)break;O=Math.max(1,2*l-d)}}if(k(t,{errors:_+1,currentLocation:l,expectedLocation:l,distance:s})>h)break;p=L}var S={isMatch:0<=d,score:0===y?.001:y};return r&&(S.matchedIndices=w(f,i)),S}},function(e,t){e.exports=function(e,t){var n=t.errors,r=void 0===n?0:n,i=t.currentLocation,n=void 0===i?0:i,i=t.expectedLocation,i=void 0===i?0:i,t=t.distance,t=void 0===t?100:t,e=r/e.length,n=Math.abs(i-n);return t?e+n/t:n?1:e}},function(e,t){e.exports=function(){for(var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=[],i=-1,o=0,a=t.length;o<a;o+=1){var s=t[o];s&&-1===i?i=o:s||-1===i||((e=o-1)-i+1>=n&&r.push([i,e]),i=-1)}return t[o-1]&&n<=o-i&&r.push([i,o-1]),r}},function(e,t){e.exports=function(e){for(var t={},n=e.length,r=0;r<n;r+=1)t[e.charAt(r)]=0;for(var i=0;i<n;i+=1)t[e.charAt(i)]|=1<<n-i-1;return t}},function(e,t){function c(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}function h(t){return null==t?"":function(){if("string"==typeof t)return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}()}function d(e){return"string"==typeof e}function v(e){return"number"==typeof e}e.exports={get:function(e,t){var l=[];return function e(t,n){if(n){var r=n.indexOf("."),i=n,o=null;-1!==r&&(i=n.slice(0,r),o=n.slice(r+1));var a=t[i];if(null!=a)if(o||!d(a)&&!v(a))if(c(a))for(var s=0,u=a.length;s<u;s+=1)e(a[s],o);else o&&e(a,o);else l.push(h(a))}else l.push(t)}(e,t),l},isArray:c,isString:d,isNum:v,toString:h}}])}(pe={exports:{}}),pe.exports),Ie=(ye=me)&&ye.__esModule&&Object.prototype.hasOwnProperty.call(ye,"default")?ye.default:ye,_e=(me.Fuse,{keys:[{name:"name",weight:.6},{name:"addressList",weight:.4}],threshold:.2}),Ee=function(){function t(e){u(this,t),this.fuseSearch=null,this.levels_=null,this.searchListEntities_=[],this.searchListIcons_=[],this.searchList_=[],this.venueModel=e,this.init()}return l(t,[{key:"init",value:function(){var e=this.venueModel.getGeometries().reduce(function(e,t){return e[t.getId()]=t,e},{});this.initEntityList(this.venueModel.entities),this.initIconList(e),this.levels_=this.venueModel.getLevels().map(function(e){return{levelId:e.getId(),levelName:e.getName(),drawingId:e.getDrawing().getId(),drawingName:e.getDrawing().getName()}});e=[].concat(L(this.searchListEntities_),L(this.searchListIcons_));this.searchList_=e.sort(function(e,t){return e.name.localeCompare(t.name)}),this.fuseSearch_=new Ie(this.searchList_,_e)}},{key:"initEntityList",value:function(e){e=(0<arguments.length&&void 0!==e?e:[]).map(function(e){return new ge({geometries:e.getGeometries(),addressList:e.getInternalAddress()||[],name:e.getName()||"",entity:e})});this.searchListEntities_=e}},{key:"initIconList",value:function(e){e=0<arguments.length&&void 0!==e?e:{};this.searchListIcons_=Object.values(e).filter(function(e){return e.getIcon()}).map(function(e){var t=e.getIcon();return new ge({geometries:[e],icon:t.getSVG(),name:t.ar||""})})}},{key:"all",value:function(){return this.searchList_}},{key:"allIconTypes",value:function(){var e=this.searchListIcons_.reduce(function(e,t){return e[t.name]=t.name,e},{});return Object.keys(e)}},{key:"find",value:function(e){e=0<arguments.length&&void 0!==e?e:"";return""===e?this.searchList_:this.fuseSearch_.search(e)}},{key:"groupByLevel",value:function(e){var t=0<arguments.length&&void 0!==e?e:this.searchList_;return this.levels_?L(this.levels_.flatMap(function(n){return O(O({},n),{},{results:t.filter(function(e){return t=n,0<(e=e).geometries.length&&e.geometries.find(function(e){return Number(e.getLevel().getId())===Number(t.levelId)});var t})})})):[]}}]),t}(),Me="MFS",Oe=0,Ae=1,Le=2,Te=3,Ne=4,be=2,Se=0,ke=1,we=2,Pe=3,Ce="Point",xe="LineString",De="Polygon",Ve="MultiPoint",Re="MultiLineString",Ge="MultiPolygon",He=Object.freeze({STANDARD:"STANDARD",FLATTEN:"FLATTEN",OUTDOOR_MAIN:"OUTDOOR_MAIN",INDOOR_MAIN:"INDOOR_MAIN",NO_OUTDOORS:"NO_OUTDOORS",FLATTEN_INDOOR_MAIN:"FLATTEN_INDOOR_MAIN",FLATTEN_OUTDOOR_COPY:"FLATTEN_OUTDOOR_COPY"}),je=Object.freeze({THEME:"THEME",THEME_MAP:"THEME_MAP",PRESETS:"PRESETS",SDK_STRINGS:"SDK_STRINGS",ICON_FILE:"ICON_FILE",INPUT_COLORS:"INPUT_COLORS",BASE_MAP_INFO:"BASE_MAP_INFO",CONFIG_PROFILE:"CONFIG_PROFILE",NAV_THEME:"NAV_THEME",NAV_NAME_THEME:"NAV_NAME_THEME",NAV_PROP_MAP:"NAV_PROP_MAP",NAV_STRINGS:"NAV_STRINGS",NAV_THEME_MAP:"NAV_THEME_MAP",NAV_NAME_THEME_MAP:"NAV_NAME_THEME_MAP",V4_THEME_FAMILY:"V4_THEME_FAMILY",V4_MAPTYPE_THEME:"V4_MAPTYPE_THEME",ICON:"ICON",MARKER:"MARKER",PERMISSIONS:"PERMISSIONS",NAICS_ARRAY:"NAICS_ARRAY",NAICS_MAP:"NAICS_MAP"}),Fe=Object.freeze((c(zt={},je.THEME,"themeUrls"),c(zt,je.THEME_MAP,"themeMapUrl"),c(zt,je.PRESETS,"presetsUrl"),c(zt,je.SDK_STRINGS,"stringsUrl"),zt)),Ue=Object.freeze((c(Ft={},je.THEME,"themeOverrides"),c(Ft,je.THEME_MAP,"themeMapOverrides"),c(Ft,je.PRESETS,"presetOverrides"),c(Ft,je.SDK_STRINGS,"stringsOverrides"),c(Ft,je.INPUT_COLORS,"inputColorOverrides"),Ft)),Be=(Object.freeze((c(Ye={},je.THEME,["Modern","Standard","Factory","Navteq","TheBase","Westfield_noLabels","Westfield","TDM_noLabel"]),c(Ye,je.SDK_STRINGS,["Standard","SDK","sdk/standard"]),c(Ye,je.V4_THEME_FAMILY,["modern","standard"]),c(Ye,je.V4_MAPTYPE_THEME,["Airport Terminal","Airport","Casino","College Building","College Campus","Convention","General","Hospital","Outdoor","Retail","School Building","School Campus","Shopping Mall","Traffic","Train Station"]),c(Ye,je.NAV_THEME,["Factory","MapEditor"]),c(Ye,je.ICON,["Multicolor","Standard","TheBase","Factory"]),Ye)),Object.freeze((c(zt={},je.THEME,"Modern"),c(zt,je.THEME_MAP,"Standard"),c(zt,je.PRESETS,"Standard"),c(zt,je.SDK_STRINGS,"Standard"),c(zt,je.ICON_FILE,"Standard"),c(zt,je.INPUT_COLORS,"Standard"),c(zt,je.BASE_MAP_INFO,"Standard"),c(zt,je.CONFIG_PROFILE,"factory"),c(zt,je.NAV_THEME,"Factory"),c(zt,je.NAV_NAME_THEME,"FactoryName"),c(zt,je.NAV_PROP_MAP,"Standard"),c(zt,je.NAV_STRINGS,"Standard"),c(zt,je.NAV_THEME_MAP,"Standard"),c(zt,je.NAV_NAME_THEME_MAP,"StandardName"),c(zt,je.V4_THEME_FAMILY,"Standard"),c(zt,je.V4_MAPTYPE_THEME,"Standard"),c(zt,je.ICON,"Multicolor"),c(zt,je.MARKER,"Standard"),zt))),ze=Object.freeze({GEO_JSON:"GEO_JSON",V5_MAP:"V5_MAP",V5_NAV:"V5_NAV",V5_INFO:"V5_INFO",KML:"KML",SVG:"SVG",PNG:"PNG"}),Ye=Object.freeze((c(Ft={},ze.V5_MAP,{COMMUNITY_MAP:"COMMUNITY_MAP",COMMUNITY_DIRECTORY:"COMMUNITY_DIRECTORY",COMMUNITY_DETAIL:"COMMUNITY_DETAIL",LEVEL_GEOMETRY:"LEVEL_GEOMETRY",DRAWING_ENTITY:"DRAWING_ENTITY"}),c(Ft,ze.GEO_JSON,{COMMUNITY_MAP:"COMMUNITY_MAP",COMMUNITY_ENTITY:"COMMUNITY_ENTITY",PATH_LEVEL_GEOMETRY:"PATH_LEVEL_GEOMETRY",GEOJSON_LEVEL_GEOMETRY:"GEOJSON_LEVEL_GEOMETRY"}),c(Ft,ze.V5_NAV,{JSON_NAV:"JSON_NAV",BINARY_NAV:"BINARY_NAV",JSON_ENHANCED_NAV:"JSON_ENHANCED_NAV",BINARY_ENHANCED_NAV:"BINARY_ENHANCED_NAV"}),c(Ft,ze.V5_INFO,{GEOMETRY_INFO:"GEOMETRY_INFO"}),c(Ft,ze.SVG,{PLAIN:"PLAIN",PRETTY:"PRETTY",PRETTY_HORIZONTAL_LABEL:"PRETTY_HORIZONTAL_LABEL"}),c(Ft,ze.KML,{RASTER:"RASTER",VECTOR:"VECTOR",RASTER_HORIZONTAL:"RASTER_HORIZONTAL",VECTOR_HORIZONTAL:"VECTOR_HORIZONTAL"}),c(Ft,ze.PNG,{LOW_RESOLUTION:"LOW_RESOLUTION",HIGH_RESOLUTION:"HIGH_RESOLUTION",LOW_RESOLUTION_GEO:"LOW_RESOLUTION_GEO",HIGH_RESOLUTION_GEO:"HIGH_RESOLUTION_GEO",LOW_RESOLUTION_HORIZONTAL:"LOW_RESOLUTION_HORIZONTAL",HIGH_RESOLUTION_HORIZONTAL:"HIGH_RESOLUTION_HORIZONTAL",LOW_RESOLUTION_HORIZONTAL_GEO:"LOW_RESOLUTION_HORIZONTAL_GEO",HIGH_RESOLUTION_HORIZONTAL_GEO:"HIGH_RESOLUTION_HORIZONTAL_GEO"}),Ft));function Ze(){}function We(){We.init.call(this)}function Je(e){return void 0===e._maxListeners?We.defaultMaxListeners:e._maxListeners}function Ke(e,t,n,r){var i,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');return(i=e._events)?(i.newListener&&(e.emit("newListener",t,n.listener||n),i=e._events),o=i[t]):(i=e._events=new Ze,e._eventsCount=0),o?("function"==typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),o.warned||(r=Je(e))&&0<r&&o.length>r&&(o.warned=!0,(r=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",r.emitter=e,r.type=t,r.count=o.length,console.warn)):(o=i[t]=n,++e._eventsCount),e}function Xe(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function Qe(e){var t=this._events;if(t){e=t[e];if("function"==typeof e)return 1;if(e)return e.length}return 0}function qe(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}Ze.prototype=Object.create(null),(We.EventEmitter=We).usingDomains=!1,We.prototype.domain=void 0,We.prototype._events=void 0,We.prototype._maxListeners=void 0,We.defaultMaxListeners=10,We.init=function(){this.domain=null,We.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Ze,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},We.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},We.prototype.getMaxListeners=function(){return Je(this)},We.prototype.emit=function(e,t,n,r){var i,o,a,s="error"===e,u=this._events;if(u)s=s&&null==u.error;else if(!s)return!1;if(l=this.domain,s){if(s=t,l)return(s=s||new Error('Uncaught, unspecified "error" event')).domainEmitter=this,s.domain=l,s.domainThrown=!1,l.emit("error",s),!1;if(s instanceof Error)throw s;var l=new Error('Uncaught, unspecified "error" event. ('+s+")");throw l.context=s,l}if(!(i=u[e]))return!1;var c,h="function"==typeof i;switch(c=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=qe(e,r),o=0;o<r;++o)i[o].call(n)}(i,h,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=qe(e,i),a=0;a<i;++a)o[a].call(n,r)}(i,h,this,t);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=qe(e,o),s=0;s<o;++s)a[s].call(n,r,i)}(i,h,this,t,n);break;case 4:!function(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=qe(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}(i,h,this,t,n,r);break;default:for(o=new Array(c-1),a=1;a<c;a++)o[a-1]=arguments[a];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=qe(e,i),a=0;a<i;++a)o[a].apply(n,r)}(i,h,this,o)}return!0},We.prototype.addListener=function(e,t){return Ke(this,e,t,!1)},We.prototype.on=We.prototype.addListener,We.prototype.prependListener=function(e,t){return Ke(this,e,t,!0)},We.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Xe(this,e,t)),this},We.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Xe(this,e,t)),this},We.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new Ze:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;0<o--;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Ze,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},We.prototype.removeAllListeners=function(e){var t,n=this._events;if(!n)return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Ze,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new Ze:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new Ze,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(;this.removeListener(e,t[t.length-1]),t[0];);return this},We.prototype.listeners=function(e){var t=this._events,n=t&&(n=t[e])?"function"==typeof n?[n.listener||n]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(n):[];return n},We.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Qe.call(e,t)},We.prototype.listenerCount=Qe,We.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};var $e="venues-ui-button--active",et="venues-ui-button",tt="venues-ui__drawings",nt="data-drawing",rt=function(){function o(e,t,n){var r=this;u(this,o),this.clickHandler=n,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("class",tt);var i=document.createElement("div");i.setAttribute("class","trigger ".concat(et));n=document.createElement("div");n.setAttribute("class","arrow arrow--down"),i.appendChild(n),i.addEventListener("click",function(){i.classList.toggle($e),r.containerButtons.classList.toggle("drawings--open")}),this.containerDiv.appendChild(i),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","drawings"),this.containerDiv.appendChild(this.containerButtons),t&&this.update(t),e.appendChild(this.containerDiv)}return l(o,[{key:"drawButton",value:function(e,t,n){var r=this,i=document.createElement("div"),n=Number(n)===Number(e);i.setAttribute("class",n?"".concat(et," ").concat($e):et),i.innerHTML=t,i.setAttribute(nt,e),i.addEventListener("click",function(){r.switch(e),r.clickHandler(e)}),this.containerButtons.appendChild(i)}},{key:"switch",value:function(e){this.containerButtons.querySelectorAll(".".concat(tt," .").concat($e)).forEach(function(e){return e.setAttribute("class",et)});e=this.containerButtons.querySelector("[".concat(nt,"='").concat(e,"']"));e&&e.setAttribute("class","".concat(et," ").concat($e))}},{key:"update",value:function(n){var r=this;this.containerButtons.innerHTML="";var e=function(e){e=e.getDrawings();return new Map(e.map(function(e){var t=e.getDisplayName()||e.getName();return[e.getId(),t]}))}(n);0<e.size&&e.forEach(function(e,t){return r.drawButton(t,e,n.getRootDrawing().getId())})}}]),o}(),it="venues-ui-button--active",ot="venues-ui-button",at="levels",st="data-level",ut="venues-ui__levels",lt=4,ct=function(){function o(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:lt;u(this,o),this.clickHandler=r,this.levelButtonCount=i,this.currentScrollIndex=0,this.containerUI=document.createElement("div"),this.containerUI.setAttribute("class","".concat(ut)),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class",at),this.containerUI.appendChild(this.containerButtons),t&&this.update(t,n),e.appendChild(this.containerUI)}return l(o,[{key:"clear",value:function(){this.containerButtons.innerHTML="",this.buttonScrollUp&&(this.containerUI.removeChild(this.buttonScrollUp),this.buttonScrollUp=null),this.buttonScrollDown&&(this.containerUI.removeChild(this.buttonScrollDown),this.buttonScrollDown=null)}},{key:"drawLevelButton",value:function(e,t){var n=this,r=document.createElement("div");r.innerHTML=t,r.style.fontSize="".concat(Math.max(Math.min(28.8/t.length,11.52),10),"px"),r.style.display="block",r.setAttribute("class",ot),r.setAttribute(st,e),r.addEventListener("click",function(){n.switch(e),n.clickHandler(e)}),this.containerButtons.appendChild(r)}},{key:"drawScrollButtons",value:function(){var e=this;this.buttonScrollUp=document.createElement("div"),this.buttonScrollUp.setAttribute("class","".concat(ot," ").concat(ot,"--up"));var t=document.createElement("div");t.setAttribute("class","arrow arrow--up"),this.buttonScrollUp.appendChild(t),this.buttonScrollUp.addEventListener("click",function(){return e.scroll(1)}),this.containerUI.insertBefore(this.buttonScrollUp,this.containerButtons),this.buttonScrollDown=document.createElement("div"),this.buttonScrollDown.setAttribute("class","".concat(ot," ").concat(ot,"--down"));t=document.createElement("div");t.setAttribute("class","arrow arrow--down"),this.buttonScrollDown.appendChild(t),this.buttonScrollDown.addEventListener("click",function(){return e.scroll(-1)}),this.containerUI.appendChild(this.buttonScrollDown)}},{key:"scroll",value:function(e){var t,n=0<arguments.length&&void 0!==e?e:0,r=Array.from(this.containerButtons.querySelectorAll(".".concat(ot))).reverse(),i=[];0<=n?(this.currentScrollIndex=Math.min(this.currentScrollIndex+n,r.length-this.levelButtonCount),e=Math.min(this.currentScrollIndex,r.length-this.levelButtonCount),t=Math.min(this.currentScrollIndex+this.levelButtonCount,r.length),i=r.slice(e,t)):n<0&&(this.currentScrollIndex=Math.max(this.currentScrollIndex+n,0),t=Math.max(0,this.currentScrollIndex),n=Math.min(r.length,this.currentScrollIndex+this.levelButtonCount),i=r.slice(t,n)),r.forEach(function(e){-1!==i.indexOf(e)?e.style.display="block":e.style.display="none"}),this.buttonScrollDown&&(0===this.currentScrollIndex?this.buttonScrollDown.setAttribute("disabled","disabled"):this.buttonScrollDown.removeAttribute("disabled")),this.buttonScrollUp&&(this.currentScrollIndex===r.length-this.levelButtonCount?this.buttonScrollUp.setAttribute("disabled","disabled"):this.buttonScrollUp.removeAttribute("disabled"))}},{key:"switch",value:function(e){this.containerButtons.querySelectorAll(".".concat(it)).forEach(function(e){return e.setAttribute("class",ot)});var t=this.containerButtons.querySelector(".".concat(ut," [").concat(st,"='").concat(e,"']"));t&&(e=Array.from(this.containerButtons.querySelectorAll(".".concat(ot))).reverse(),t.setAttribute("class","".concat(ot," ").concat(it)),((t=e.indexOf(t))<this.currentScrollIndex||t>=this.currentScrollIndex+lt)&&this.scroll(t-this.currentScrollIndex))}},{key:"update",value:function(e,t){var n=this,t=function(e){return new Map((0<arguments.length&&void 0!==e?e:[]).map(function(e){return[e.getZIndex(),e.getShortName()||e.getDisplayName()||e.getName()]}))}(function(e,t){if(t!==He.FLATTEN)return e.getLevels();e=e.getVenueModel().getLevelMapFlattenedByZIndex_();return Object.values(e).map(function(e){return e[0]})}(e,t).sort(function(e,t){return t.getZIndex()-e.getZIndex()})),r=e.getMainLevel().getZIndex();this.clear(),t.forEach(function(e,t){return n.drawLevelButton(t,e)}),t.size>this.levelButtonCount&&(t.size>this.levelButtonCount+1?this.currentScrollIndex=Math.min(Array.from(t).reverse().findIndex(function(e){return e[0]===r}),t.size-this.levelButtonCount):this.currentScrollIndex=0,this.drawScrollButtons(),this.scroll(0)),this.switch(r)}}]),o}(),ht={VENUE_DATA_LOADED:"VENUE_DATA_LOADED",VENUE_MAP_DATA_LOADED:"VENUE_MAP_DATA_LOADED",VENUE_ENTITY_DATA_LOADED:"VENUE_ENTITY_DATA_LOADED",VENUE_DATA_MODEL_LOADED:"VENUE_DATA_MODEL_LOADED",VENUE_NAV_DATA_LOADED:"VENUE_NAV_DATA_LOADED",META_DATA_LOADED:"META_DATA_LOADED",META_DATA_MODEL_LOADED:"META_DATA_MODEL_LOADED",META_DATA_MODEL_UPDATED:"META_DATA_MODEL_UPDATED",VENUE_ICONS_LOADED:"VENUE_ICONS_LOADED"},dt=(Object.freeze((c(zt={},ht.VENUE_DATA_LOADED,{description:"event fired when all requested files along with metadata & overrides are loaded",emitTemplate:{}}),c(zt,ht.VENUE_MAP_DATA_LOADED,{description:"event fired when requested levels, drawings & community files are loaded",emitTemplate:{}}),c(zt,ht.VENUE_ENTITY_DATA_LOADED,{description:"event fired when requested entity data is loaded",emitTemplate:{}}),c(zt,ht.VENUE_DATA_MODEL_LOADED,{description:"event fired when a map file is loaded",emitTemplate:{}}),c(zt,ht.VENUE_NAV_DATA_LOADED,{description:"event fired when requested navigation product is loaded",emitTemplate:{}}),c(zt,ht.META_DATA_LOADED,{description:"event fired when all requested meta files are loaded except icon & marker",emitTemplate:{}}),c(zt,ht.META_DATA_MODEL_LOADED,{description:"event fired when a specific model is loaded except icon & marker",emitTemplate:{}}),c(zt,ht.META_DATA_MODEL_UPDATED,{description:"event fired when a specific meta override is added or removed",emitTemplate:{}}),c(zt,ht.VENUE_ICONS_LOADED,{description:"event fired when all icons of venue are loaded",emitTemplate:{}}),zt)),new We);dt.EVENT_NAME=ht,dt.on("newListener",function(e){});function vt(t,n){var r,i,o,a,s=0;Object.keys(n).forEach(function(e){for(r=n[e],null==(o=r.priority)&&(o=0),a=!1;!a;)s<t.length?(i=t[s],null==(i=i.priority)&&(i=0)):i=Number.MAX_VALUE,o<=i&&(t.splice(s,0,r),a=!0),s+=1})}var ft=Math.PI/180,gt=180/Math.PI,pt=function(){function d(){u(this,d)}return l(d,null,[{key:"toRadians",value:function(e){return e*ft}},{key:"toDegrees",value:function(e){return e*gt}},{key:"getInverseTransform",value:function(e){var t=e[0]*e[3]-e[1]*e[2],t=[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,0,0];return t[4]=-(t[0]*e[4]+t[2]*e[5]),t[5]=-(t[1]*e[4]+t[3]*e[5]),t}},{key:"applyTransformToPoint",value:function(e,t){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}},{key:"transformProduct",value:function(e,t){var n=[0,0,0,0,0,0];return n[0]=t[0]*e[0]+t[2]*e[1],n[1]=t[1]*e[0]+t[3]*e[1],n[2]=t[0]*e[2]+t[2]*e[3],n[3]=t[1]*e[2]+t[3]*e[3],n[4]=t[0]*e[4]+t[2]*e[5]+t[4],n[5]=t[1]*e[4]+t[3]*e[5]+t[5],n}},{key:"convertLonLatToMerc",value:function(e){var t=e[0]*ft,e=e[1]*ft,e=Math.sin(e);return[.5+t/(2*Math.PI),.5-Math.log((1+e)/(1-e))/(4*Math.PI)]}},{key:"convertMercToLatLon",value:function(e){var t=2*Math.PI*(e[0]-.5),e=Math.atan(Math.sinh(2*Math.PI*(.5-e[1])));return[t/ft,e/ft]}},{key:"getTransformScale",value:function(e){return Math.sqrt(e[0]*e[3]-e[1]*e[2])}},{key:"getLonLatToMercTransform",value:function(e){var t=[1/360,0,0,-1/(360*Math.cos(e[1]*ft)),0,0],n=d.applyTransformToPoint(t,e),e=d.convertLonLatToMerc(e);return t[4]=e[0]-n[0],t[5]=e[1]-n[1],t}},{key:"getNatToMercTransform",value:function(e){var t=[e[4],e[5]],t=d.getLonLatToMercTransform(t);return d.transformProduct(e,t)}},{key:"convertMxMy2LonLat",value:function(e,t){return e.length&&t.length?d.applyTransformToPoint(e,t):[]}},{key:"convertLonLat2MxMy",value:function(e,t){if(!e.length||!t.length)return[];e=d.getInverseTransform(e);return d.applyTransformToPoint(e,t)}},{key:"getFlattenedQuadraticBezierCurve",value:function(e,t,n,r){var i=[],o=3<arguments.length&&void 0!==r?r:10;o<1&&(o=6);for(var a=0;a<=o;a+=1){var s=a/o,u=(1-s)*(1-s),l=2*s*(1-s),c=s*s,s=u*e[0]+l*t[0]+c*n[0],c=u*e[1]+l*t[1]+c*n[1];i.push([s,c])}return i}},{key:"getFlattenedCubicBezierCurve",value:function(e,t,n,r,i){var o=[],a=4<arguments.length&&void 0!==i?i:10;a<1&&(a=6);for(var s=0;s<=a;s+=1){var u=s/a,l=(1-u)*(1-u)*(1-u),c=3*u*(1-u)*(1-u),h=3*u*u*(1-u),d=u*u*u,u=l*e[0]+c*t[0]+h*n[0]+d*r[0],d=l*e[1]+c*t[1]+h*n[1]+d*r[1];o.push([u,d])}return o}},{key:"getRectangularCoordinatesOfLabelArea",value:function(e,t,n){var r=!(2<arguments.length&&void 0!==n)||n,i=A(e,6),o=i[0],a=i[1],s=i[2],u=i[3],n=i[5],i=d.getDeltaLonLatForMeterAtGivenLonLat(o,a),e=e[4];return r?(n&&(e*=-1),null!=t&&(e=(e+=t<0?2*Math.PI+t:t)<0?2*Math.PI+e:e)):e=0,d.getRectVerticesFromSignatureRectRepresentation([o,a],{xLength:s,yLength:u},e,i)}},{key:"getRotatedPoint",value:function(e,t,n,r){var i=!(2<arguments.length&&void 0!==n)||n,o=3<arguments.length&&void 0!==r?r:[0,0],a=Math.cos(t),n=Math.sin(t),r=e[0]-o[0],t=e[1]-o[1],e=[];return[(e=i?[r*a+t*n,t*a-r*n]:[r*a-t*n,t*a+r*n])[0]+o[0],e[1]+o[1]]}},{key:"getRectVerticesFromSignatureRectRepresentation",value:function(e,t,n,r,i){var o=t.xLength,t=t.yLength,a=!(4<arguments.length&&void 0!==i)||i,e=A(e,2),s=e[0],u=e[1],l=o/2,H=t/2,r=A(r,2),c=r[0],h=r[1];return[[1,1],[-1,1],[-1,-1],[1,-1]].map(function(e){return[e[0]*l,e[1]*H]}).map(function(e){return d.getRotatedPoint(e,n,a)}).map(function(e){return[e[0]*c,e[1]*h]}).map(function(e){return[e[0]+s,e[1]+u]})}},{key:"getScaleFactorForRectInSpace",value:function(e,t,n,r){n=e/n,r=t/r;return r<n?r:n}},{key:"getDeltaLonLatForMeterAtGivenLonLat",value:function(e,t){return[1/6371e3*(180/Math.PI)/Math.cos(t*Math.PI/180),1/6371e3*(180/Math.PI)]}},{key:"getBoundingBoxVertices",value:function(e){var t=0<arguments.length&&void 0!==e?e:[],e=[[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]];return t.reduce(function(e,t){return[[Math.min(t[0],e[0][0]),Math.min(t[1],e[0][1])],[Math.max(t[0],e[1][0]),Math.max(t[1],e[1][1])]]},e)}},{key:"isPointInBoundingBox",value:function(e,t){if(e&&t){var n=A(e,2),r=n[0],i=n[1],o=A(t,2),e=A(o[0],2),n=e[0],t=e[1],e=A(o[1],2),o=e[0],e=e[1];return r<=o&&n<=r&&i<=e&&t<=i}}},{key:"isPointOnLineSegment",value:function(e,t,n){var r=A(e,2),i=r[0],o=r[1],a=A(t,2),e=a[0],r=a[1],t=A(n,2),a=t[0],n=t[1],t=(r-o)*(n-o)<=0;return e===a?e===i&&t:o-n==(n-r)/(a-e)*(i-a)&&t}},{key:"rayIntersectLineSegment",value:function(e,t,n){var r=A(e,2),i=r[0],o=r[1],e=A(t,2),r=e[0],t=e[1],e=A(n,2),n=e[0],e=e[1];if(r===n)return!1;r=(i-r)/(n-r);return 0<=r&&r<1&&o<(e-t)*r+t}},{key:"isPointInPolygon",value:function(e,t){var e=A(e,2),n=e[0],r=e[1],e=t.length;if(e<3)return!1;var i=0,o=t[e-1];return t.forEach(function(e){d.rayIntersectLineSegment([n,r],o,e)&&(i+=1),o=e}),i%2!=0}},{key:"isPointOnLineString",value:function(e,t){var e=A(e,2),n=e[0],r=e[1],i=t.length;if(i<2)return!1;for(var o=t[i-1],a=0;a<i;a+=1){var s=t[a];if(d.isPointOnLineSegment([n,r],o,s))return!0;o=t[a]}return!1}},{key:"getAreaOfPolygon",value:function(e){var t=e.length;if(t<3)return null;var o=0,a=e[t-1];return e.forEach(function(e){var t,n,r,i;o+=.5*(n=e,r=A(t=a,2),i=r[0],t=r[1],r=A(n,2),n=r[0],i*r[1]-t*n),a=e}),o}},{key:"getDistanceBetweenPoints",value:function(e,t){var n=A(e,2),e=n[0],n=n[1],t=A(t,2),e=e-t[0],t=n-t[1];return Math.sqrt(e*e+t*t)}}]),d}(),yt=function(){function e(){u(this,e)}return l(e,null,[{key:"get",value:function(t,e){return fetch(t,1<arguments.length&&void 0!==e?e:{method:"GET"}).then(function(e){return e.ok?e.json():Promise.reject(new Error("Call failed for ".concat(t," : ").concat(e.status," ").concat(e.statusText)))})}}]),e}(),mt=!1,It=function(){function M(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:mt;u(this,M),e&&Object.assign(this,e),this.splitIconGeomBasisGeomType_=t,this.splitIconGeomBasisGeomType_&&this.splitMultiGeom()}return l(M,[{key:"flattenIconShape",value:function(e){var t,n=0<arguments.length&&void 0!==e&&e;this.isFlattened||(t=[],(e=this.g)&&e.forEach(function(e){var c,h=[];e.shp&&e.shp.forEach(function(e){var t,n=A(e,7),r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],l=n[6];switch(r){case Oe:case Ae:h.push(e),c=[i,o];break;case Le:t=pt.getFlattenedQuadraticBezierCurve(c,[i,o],[a,s]),c=[a,s];break;case Te:t=pt.getFlattenedCubicBezierCurve(c,[i,o],[a,s],[u,l]),c=[u,l];break;case Ne:h.push(e),c=void 0}t&&(t.splice(0,2),t.forEach(function(e){h.push([1].concat(L(e)))}))}),t.push(O(O({},e),{shp:h}))}),n&&(this.g_original=e),this.g=t,this.isFlattened=!0)}},{key:"splitMultiGeom",value:function(){var e=this;if(this.isIconGeomSplittedBasisGeomType)return this.isIconWithHole;this.splitIconGeomBasisGeomType_||(this.splitIconGeomBasisGeomType_=!0);var f=be,t=this.g,g=[],p=[],n=!1,y=!0,m=-1,I=Se,_=ke,E=we,r=Pe;return!!t&&(t.forEach(function(c){var h,d=[],v=[];c.gt===r||(c.shp.forEach(function(e){var t=A(e,7),n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=null;switch(n){case Oe:d.push([r,i]),h=[r,i],y||m!==_&&m!==I||g.push(O(O({},c),{},{st:f},{gt:m,shp:p})),m=I,y=!(p=[]),p.push(e);break;case Ae:d.push([r,i]),h=[r,i],m===E||m!==I&&m!==_||(m=_,p.push(e));break;case Le:(l=pt.getFlattenedQuadraticBezierCurve(h,[r,i],[o,a],15)).splice(0,2),d.push.apply(d,L(l)),h=[o,a],m===E||m!==I&&m!==_||(m=_,p.push(e));break;case Te:(l=pt.getFlattenedCubicBezierCurve(h,[r,i],[o,a],[s,u],15)).splice(0,2),d.push.apply(d,L(l)),h=[s,u],m===E||m!==I&&m!==_||(m=_,p.push(e));break;case Ne:p.push(e),m=E,y=!0,2<d.length&&v.push({shp:p,area:pt.getAreaOfPolygon(d),points:d,children:[]}),h=void 0,d=[]}},e),M.getLinkedParentChildPolygonArray(v).forEach(function(e){var t=[];t.push.apply(t,L(e.shp)),e.children.forEach(function(e){n=!0,t.push.apply(t,L(e.shp))}),g.push(O(O({},c),{},{st:f},{gt:we,shp:t}))}))},this),this.g=g,this.isIconGeomSplittedBasisGeomType=!0,this.isIconWithHole=n,this.isIconWithHole)}},{key:"getIconWithOriginTranslatedToIconCenter",value:function(){var t=new M(this,this.splitIconGeomBasisGeomType_),c=Number.parseInt(t.w,10)/2*1,h=Number.parseInt(t.h,10)/2*1;return t.g=[],this.g&&this.g.forEach(function(e){var l=[];e.shp&&e.shp.forEach(function(e){var t=A(e,7),n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6];switch(n){case 0:case 1:l.push([n,r-c,i-h]);break;case 2:l.push([n,r-c,i-h,o-c,a-h]);break;case 3:l.push([n,r-c,i-h,o-c,a-h,s-c,u-h]);break;case 4:l.push(e)}}),t.g.push(O(O({},e),{shp:l}))}),t}},{key:"getTransformedIconThatFitsInLabelArea",value:function(e,t,n){var r=1<arguments.length&&void 0!==t?t:0,t=!(2<arguments.length&&void 0!==n)||n,n=new M(this,this.splitIconGeomBasisGeomType_),g=M.getParamForTransformedIconThatFitsInLabelArea(n,e,r,t),t=g.scaleFactor;n.w=t,n.h=t;var i=[];return n.g&&n.g.forEach(function(e){var f=[];e.shp&&e.shp.forEach(function(e){var t=A(e,7),n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],t=t[6],i=A(M.getTransformedIconPointThatFitsInLabelArea([r,i],g),2),u=i[0],l=i[1],a=A(M.getTransformedIconPointThatFitsInLabelArea([o,a],g),2),c=a[0],h=a[1],t=A(M.getTransformedIconPointThatFitsInLabelArea([s,t],g),2),d=t[0],v=t[1];switch(n){case Oe:case Ae:f.push([n,u,l]);break;case Le:f.push([n,u,l,c,h]);break;case Te:f.push([n,u,l,c,h,d,v]);break;case Ne:f.push(e)}}),i.push(O(O({},e),{shp:f}))}),n.g=i,n}},{key:"getSVG",value:function(e){var t,n,r='<?xml version="1.0" encoding="utf-8"?>',i=this.w||50,o=this.h||50,a=this.g;if(r+='<svg viewBox="0 0 '.concat(i," ").concat(o,'" xmlns="http://www.w3.org/2000/svg" width="').concat(i,'" height="').concat(o,'">'),r+="<g>",a&&0<a.length)for(var s=0;s<a.length;s+=1){r+="<path ",a[s].gw&&(r+=' stroke-width="'.concat(a[s].gw,'"')),e?r+=' fill="'.concat(e,'"'):a[s].os&&a[s].os.m?r+=' fill="'.concat(a[s].os.m,'"'):r+=0===s?' fill="#006BB7"':' fill="#ffffff"',r+=' d="';for(var u=0;u<a[s].shp.length;u+=1)for(var l=0;l<a[s].shp[u].length;l+=1)r+=0===l?(t=a[s].shp[u][l],n=void 0,(c(n={},Oe,"M"),c(n,Ae,"L"),c(n,Le,"Q"),c(n,Te,"C"),c(n,Ne,"Z"),n)[t]):a[s].shp[u][l],0===l||l+1===a[s].shp[u][l].length?r+="":r+=" ";r+='" ></path>'}return r+="</g>",r+="</svg>"}}],[{key:"getParamForTransformedIconThatFitsInLabelArea",value:function(e,t,n,r){var i=2<arguments.length&&void 0!==n?n:0,o=!(3<arguments.length&&void 0!==r)||r,a=A(t,5),s=a[0],u=a[1],n=a[2],r=a[3],t=a[4],a=(o?0:t)+i,o=A(pt.getDeltaLonLatForMeterAtGivenLonLat(s,u),2),t=o[0],i=o[1],o=[Number.parseInt(e.w,10),Number.parseInt(e.h,10)],e=o[0],o=o[1];return{labelCenterX:s,labelCenterY:u,iconWidth:e,iconHeight:o,deltaLonPerMeter:t,deltaLatPerMeter:i,scaleFactor:pt.getScaleFactorForRectInSpace(n,r,e,o),effectiveRotation:a}}},{key:"getTransformedIconPointThatFitsInLabelArea",value:function(e,t){var n=A(e,2),r=n[0],i=n[1];if(void 0===r||void 0===i||null===r||null===i)return[];var o=t.labelCenterX,a=t.labelCenterY,s=t.iconWidth,u=t.iconHeight,l=t.deltaLonPerMeter,e=t.deltaLatPerMeter,n=t.scaleFactor,t=t.effectiveRotation,r=r,i=i;r-=+s/2,i-=+u/2,i*=-1;l=r*=n*l,e=i*=n*e,r=l*Math.cos(t)+e*Math.sin(t),i=e*Math.cos(t)-l*Math.sin(t);return[r+=o,i+=a]}},{key:"getWebGLSuitableCoordinatesOfIconSubGeom",value:function(e){var i,t=e.st,n=e.gt,r=e.shp,o=[];if(t!==be||!r||!n)return o;switch(n){case we:r.forEach(function(e){var t=A(e,3),e=t[0],n=t[1],r=t[2];switch(e){case Oe:(i=[]).push([n,r]);break;case Ae:i.push([n,r]);break;case Ne:o.push(i)}});break;case ke:r.forEach(function(e){var t=A(e,3),e=t[1],t=t[2];o.push([e,t])})}return o}},{key:"getLinkedParentChildPolygonArray",value:function(e){var t=[];e.sort(function(e,t){return Math.abs(t.area)-Math.abs(e.area)});for(var n=0;n<e.length;n+=1){for(var r=null,i=e[n],o=i.points[0],a=n-1;0<=a;--a){var s=e[a],u=i.area*s.area<0;if(u)if(pt.isPointInPolygon(o,s.points)||pt.isPointOnLineString(o,s.points)){r=s;break}}(r?r.children:t).push(i)}return t}}]),M}(),_t=Object.freeze({TEXT:"",ICON:"icon:",IMAGE:"icon:"}),Et=Object.freeze({VALUE:"<value>",SHORT:"<short>",LONG:"<long>",FULL:"<full>"}),Mt=Object.freeze({NONE:0,TEXT:1,ICON:2,IMAGE:3}),Ot=dt.EVENT_NAME,At=["resetBaseMetaFileRules_","updateOverridableComponents"],Lt=function(t){var n=[];return At.forEach(function(e){t[e]||n.push(e)}),0<n.length?n:null},Tt=function(){function i(e,t,n){if(u(this,i),!e)throw new Error("one should not instantiate object of this class without apt payload");var r=Lt(this);if(r)throw new Error("function definition missing in the implementation ".concat(r.join()));this.metaFileIdentifier=t,this.metaInformation_=n,this.basedata_=O({},e),this.baseOverrides_=[],this.customOverrides_=[],this.resetBaseMetaFileRules_()}return l(i,[{key:"applyOverride",value:function(e,t,n){var r=!(1<arguments.length&&void 0!==t)||t,t=2<arguments.length&&void 0!==n&&n;e&&(t||(r?this.customOverrides_:this.baseOverrides_).push(e),this.updateOverridableComponents(e),n=this.getMetaInformation(),!t&&n&&n.config.emitEventOnOverrideUpdate&&(e={applyOverride:!0,metaFileIdentifier:this.metaFileIdentifier,isCustomOverride:r,metaInformation:n,overrideJson:e},dt.emit(Ot.META_DATA_MODEL_UPDATED,e)))}},{key:"undoOverride",value:function(){var e,t,n=this;0!==this.customOverrides_.length&&(t=this.customOverrides_.pop(),this.resetBaseMetaFileRules_(),this.baseOverrides_.forEach(function(e){return n.applyOverride(e,!1,!0)}),this.customOverrides_.forEach(function(e){return n.applyOverride(e,!0,!0)}),(e=this.getMetaInformation())&&e.config.emitEventOnOverrideUpdate&&(t={metaFileIdentifier:this.metaFileIdentifier,undoOverride:!0,metaInformation:e,overrideJson:t},dt.emit(Ot.META_DATA_MODEL_UPDATED,t)))}},{key:"getMetaInformation",value:function(){return this.metaInformation_}},{key:"basedata_",get:function(){return this.basedata__},set:function(e){this.basedata__||(this.basedata__=e)}}]),i}(),Nt=je.PRESETS,bt=function(){h(r,Tt);var n=p(r);function r(e,t){return u(this,r),n.call(this,e,Nt,t)}return l(r,[{key:"resetBaseMetaFileRules_",value:function(){this.property_trees=null,this.named_groups=null,this.named_keys=null,this.updateOverridableComponents(this.basedata_)}},{key:"updateOverridableComponents",value:function(e){this.property_trees=e.property_trees,this.named_groups=e.named_groups,this.named_keys=e.named_keys}},{key:"getPropertyTree",value:function(e){var n,r=this,e=this.property_trees[e],i=[];return e.forEach(function(e){switch(e.input){case"named_group":n=r.getNamedGroup(r.getKeyKey(e)),i=[].concat(L(i),L(n));break;case"named_key":var t;(n=r.getKeyName(e))?((t=r.getNamedKey(n)).k=r.getKeyKey(e),t.name=n,i.push(t)):i.push(r.getNamedKey(r.getKeyKey(e)));break;default:i.push(e)}},this),i}},{key:"getNamedGroup",value:function(e){return this.named_groups[e]}},{key:"getNamedKey",value:function(e){return this.named_keys[e]}}],[{key:"getMetaFileIdentifier",value:function(){return Nt}}]),r}(),St=je.SDK_STRINGS,kt=function(){h(r,Tt);var n=p(r);function r(e,t){return u(this,r),n.call(this,e,St,t)}return l(r,[{key:"resetBaseMetaFileRules_",value:function(){this.stringsTable={},this.updateOverridableComponents(this.basedata_)}},{key:"updateOverridableComponents",value:function(e){e&&this.updateTranslationsStringMap(e.translations)}},{key:"updateTranslationsStringMap",value:function(t){var n=this;t&&Object.keys(t).forEach(function(e){n.addToStringsTable(e,t[e])},this)}},{key:"addToStringsTable",value:function(e,t){this.stringsTable[e]=t}},{key:"translate",value:function(e,t){var n,r=t;return!this.stringsTable||(n=this.stringsTable[e])&&(r=n.en||n.en||(0<(e=Object.keys(n)).length?n[e.pop()]:t)),r}}],[{key:"getMetaFileIdentifier",value:function(){return St}}]),r}(),wt=je.THEME,Pt=function(){h(r,Tt);var n=p(r);function r(e,t){return u(this,r),n.call(this,e,wt,t)}return l(r,[{key:"resetBaseMetaFileRules_",value:function(){var e=this.basedata_;this.ft=e.ft,this.name=e.nm,this.iurl=e.iurl,this.styleMap={},this.iconInfoMap={},this.labelStyleMap={},this.markerMap={},this.updateOverridableComponents(e)}},{key:"updateOverridableComponents",value:function(e){e&&(this.updateStyleMap(e.s),this.updateIconInfoMap(e.i,e.iurl),this.updateLabelStyleMap(e.l),this.updateMarkerMap(e.m))}},{key:"updateStyleMap",value:function(e){this.styleMap=O(O({},this.styleMap),e)}},{key:"updateIconInfoMap",value:function(r,i){var o=this;r&&Object.keys(r).forEach(function(e){var t=r[e],n=i||o.iurl;n&&t.rurl&&(t.url=n+t.rurl),o.iconInfoMap[e]=t},this)}},{key:"updateLabelStyleMap",value:function(e){this.labelStyleMap=O(O({},this.labelStyleMap),e)}},{key:"updateMarkerMap",value:function(e){this.markerMap=O(O({},this.markerMap),e)}},{key:"getStyleMap",value:function(){return this.styleMap}},{key:"getGeometryStyle",value:function(e){return this.styleMap?this.styleMap[e]:null}},{key:"getGeometryDefaultStyle",value:function(){return this.styleMap?this.styleMap.Object:null}},{key:"getLabelStyle",value:function(e){return this.labelStyleMap?this.labelStyleMap[e]:null}},{key:"getLabelDefaultStyle",value:function(){return this.labelStyleMap?this.labelStyleMap.default:null}},{key:"getMarker",value:function(e){return this.markerMap&&e?this.markerMap[e]:null}},{key:"getIconInfo",value:function(e){return this.iconInfoMap&&e?this.iconInfoMap[e]:null}}],[{key:"getMetaFileIdentifier",value:function(){return wt}}]),r}(),Ct=function(){function e(){u(this,e)}return l(e,null,[{key:"createShortAddress",value:function(e){return e&&Array.isArray(e)?e[1]:null}},{key:"createLongAddress",value:function(e){return e&&Array.isArray(e)?e[0]+" "+e[1]:null}},{key:"createFullAddress",value:function(e){if(e&&Array.isArray(e)){var t=3===e.length?e[2]+" ":"";return t+=e[0]+" "+e[1]}return null}}]),e}(),xt=je.THEME_MAP,Dt=function(){h(r,Tt);var n=p(r);function r(e,t){return u(this,r),n.call(this,e,xt,t)}return l(r,[{key:"resetBaseMetaFileRules_",value:function(){var e=this.basedata_;this.ft=e.ft,this.styleTreeList=[],this.labelTreeList=[],this.updateOverridableComponents(e)}},{key:"updateOverridableComponents",value:function(e){this.updateLabelTreeList(e.label),this.updateStyleTreeList(e.style)}},{key:"updateLabelTreeList",value:function(e){e&&vt(this.labelTreeList,e)}},{key:"updateStyleTreeList",value:function(e){e&&vt(this.styleTreeList,e)}}],[{key:"getMetaFileIdentifier",value:function(){return xt}},{key:"extractThemeMapPayload",value:function(e){return{labelType:e.lt,labelRef:e.r,styleName:e.n}}},{key:"getGeomStyleLookupTag",value:function(e,t){e=e?e.styleName:null;return e=e===Et.VALUE?t:e}},{key:"getLabelRefConstructed",value:function(e,t,n){var r=e;switch(e){case Et.VALUE:r=n;break;case Et.SHORT:r=Ct.createShortAddress(t);break;case Et.LONG:r=Ct.createLongAddress(t);break;case Et.FULL:r=Ct.createFullAddress(t)}return r}},{key:"getLabelInfoConstructed",value:function(e,t,n,r){var i={lt:e,entry:n};switch(e){case Mt.NONE:break;case Mt.TEXT:n.trans?i.ar=t:i.r=t;break;case Mt.ICON:i.iconIdentifier=t,r?i=O(O({},r),i):i.error=!0;break;case Mt.IMAGE:i.url=t;break;default:i=null}return i}}]),r}(),Vt=je.THEME,Rt=je.THEME_MAP,Gt=je.PRESETS,Ht=je.SDK_STRINGS,jt=function(){function e(){u(this,e),this.config=Object.seal({emitEventOnOverrideUpdate:!0}),this.iconCache={},this.imageCache={},this.releaseSettings_={}}return l(e,[{key:"instantiateMetaFileAccessor_",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];switch(e){case Vt:this[Vt]=v(Pt,n.concat([this]));break;case Rt:this[Rt]=v(Dt,n.concat([this]));break;case Gt:this[Gt]=v(bt,n.concat([this]));break;case Ht:this[Ht]=v(kt,n.concat([this]));break;default:return null}return this[e]}},{key:"applyOverride",value:function(e,t){this[e]&&this[e].applyOverride(t)}},{key:"undoOverride",value:function(e){this[e]&&this[e].undoOverride()}},{key:"getTheme",value:function(){return this[Vt]||{}}},{key:"getThemeMap",value:function(){return this[Rt]||{}}},{key:"getPresets",value:function(){return this[Gt]||{}}},{key:"getStrings",value:function(){return this[Ht]||{}}},{key:"getIcon",value:function(e){return e&&e.iconIdentifier?this.iconCache[e.iconIdentifier]:null}},{key:"getImage",value:function(e){return this.imageCache[e]}},{key:"extractGeomStyle",value:function(e){var t=e.valueEntry,e=e.value,t=Dt.extractThemeMapPayload(t),e=Dt.getGeomStyleLookupTag(t,e);return this.getTheme()?this.getTheme().getGeometryStyle(e):null}},{key:"getStyle",value:function(n,e){var r=this,t=1<arguments.length&&void 0!==e&&e,i=this.getThemeMap().styleTreeList,o=this.processValueEntry_.bind(this);if(null===i||0===i.length||!this.getTheme())return null;var e=this.getTheme().getGeometryDefaultStyle(),a=this.extractGeomStyle.bind(this),s=n.getAddress(),u=n.getEntities(),l=null,c=null,h={};return u&&0<u.length?i.find(function(t){return c=u.find(function(e){return l=o({geometry:n,entity:e,address:s,valueEntry:t,value:void 0,returnValueFunction:a,valueEntryIdentified:h})},r)},this):i.find(function(e){return l=o({geometry:n,entity:c,address:s,valueEntry:e,value:void 0,returnValueFunction:a,valueEntryIdentified:h})},this),l||t||(l=e),l?JSON.parse(JSON.stringify(l)):void 0}},{key:"getLabelValue",value:function(e){var t=e.address,n=e.valueEntry,r=e.value,i=Dt.extractThemeMapPayload(n),e=i.labelType,i=i.labelRef,t=Dt.getLabelRefConstructed(i,t,r),r=e===Mt.ICON?this.getTheme().getIconInfo(t):null,r=Dt.getLabelInfoConstructed(e,t,n,r);return r?JSON.parse(JSON.stringify(r)):void 0}},{key:"convertLabelToText",value:function(e){if(e){var t,n=e.r,r=e.ar,e=e.lt;if(n)return n;if(r){switch(e){case Mt.TEXT:t=_t.TEXT+r;break;case Mt.ICON:t=_t.ICON+r;break;case Mt.IMAGE:t=_t.IMAGE+r;break;default:return null}return this.getStrings().translate(t,r)}}return null}},{key:"getLabelStyle",value:function(e,t){var n,r=1<arguments.length&&void 0!==t&&t,i=this.getTheme(),o=i.getLabelDefaultStyle(),a={};return e&&(n=e.t,t=e.zmin,e=e.l,n&&(a.t=n),t&&(a.zmin=t),(e=i.getLabelStyle(e))&&(a=O(O({},a),e))),a||r||(a=o),a}},{key:"getLabelConstantsSet_",value:function(){var e=this.getThemeMap().labelTreeList,t=this.processValueEntry_.bind(this);return null==e||0===e.length?{isInsufficientInput:!0}:{labelTreeList:e,returnValueFunction:this.getLabelValue.bind(this),processValueEntry:t}}},{key:"getGeometryLabelInfo",value:function(t){var n=this,e=this.getLabelConstantsSet_(),r=e.isInsufficientInput,i=e.labelTreeList,o=e.returnValueFunction,a=e.processValueEntry;if(r)return null;var s=t.getAddress(),u=null;return i.find(function(e){return(u=a({geometry:t,address:s,valueEntry:e,returnValueFunction:o}))&&(u.r=n.convertLabelToText(u)),u}),u?JSON.parse(JSON.stringify(u)):void 0}},{key:"getEntityLabelInfo",value:function(t){var e=this.getLabelConstantsSet_(),n=e.isInsufficientInput,r=e.labelTreeList,i=e.returnValueFunction,o=e.processValueEntry;if(n)return null;var a=null;return r.find(function(e){return a=o({entity:t,valueEntry:e,returnValueFunction:i})}),a?JSON.parse(JSON.stringify(a)):void 0}},{key:"getLabelInfo",value:function(o){var a=this,e=this.getLabelConstantsSet_(),t=e.isInsufficientInput,n=e.labelTreeList,s=e.returnValueFunction,u=e.processValueEntry;if(t)return null;var l,r,c=o.getAddress(),h=o.getEntities(),d=null;return h&&1<h.length?(l=null,n.find(function(t){var n,r=null,i=!1;return h.forEach(function(e){n=u({entity:e,valueEntry:t,returnValueFunction:s}),(r=a.convertLabelToText(n))&&0<r.length&&(l?l+=", "+r:(l=r,i=!0))},a),i||(n=u({geometry:o,address:c,valueEntry:t,returnValueFunction:s}),(r=a.convertLabelToText(n))&&0<r.length&&(l?l+=", "+r:l=r,i=!0)),i&&(d={lt:a.TEXT_LABEL_TYPE,r:l}),i},this)):(r=h?h[0]:null,n.find(function(e){return(d=u({geometry:o,entity:r,address:c,valueEntry:e,returnValueFunction:s}))&&(d.r=a.convertLabelToText(d)),d},this)),d?JSON.parse(JSON.stringify(d)):void 0}},{key:"processValueEntry_",value:function(e){var r=this,i=e.geometry,o=e.entity,a=e.address,t=e.valueEntry,n=e.value,s=e.returnValueFunction,u=null,e=t.ks;if(void 0!==e&&e.find(function(e){var t;if(e.gk&&i?(n=e.gk,t=i.properties[n]):e.ek&&o?(n=e.ek,t=o.properties[n]):e.ak&&a&&(n=e.ak)===a[0]&&(t=A(a,2)[1]),void 0!==t){if(e.v){var n=e.v[t];if(void 0!==n&&void 0!==(u=r.processValueEntry_({geometry:i,entity:o,address:a,valueEntry:n,value:t,returnValueFunction:s})))return!0}if(void 0!==(u=s({geometry:i,entity:o,address:a,valueEntry:e,value:t})))return!0}return!1},this))return u;return s?s({geometry:i,entity:o,address:a,valueEntry:t,value:n}):u}},{key:"setIcon",value:function(e,t){e&&t&&(this.iconCache[e]=t)}},{key:"setReleaseSettings_",value:function(e){this.releaseSettings_=e}}]),e}(),Ft={NODES_LB:"mfs.micello.com",US_1:"mfs-us-1.micello.com",US_2:"mfs-us-2.micello.com",AU_1:"mfs-au-1.micello.com",AU_2:"mfs-au-2.micello.com",EU_1:"mfs-eu-1.micello.com",SG_1:"mfs-sg-1.micello.com",HUB:"mfs-hub-master.micello.com",PREVIEW:"preview.micello.com/mfs",FACTORY:"factory-mfs.micello.com",CIT:"integration.mfs.hub.venues.ext.here.com",STG:"alpha.mfs.hub.venues.ext.here.com"},Ut=Ft.HUB,Bt=Object.freeze({MFILE:"MFILE",MVAR:"MVAR",MPATH:"MPATH",MKEY:"MKEY",MPATTERN:"MPATTERN",MPACKAGE:"MPACKAGE"}),zt=(Object.freeze((c(zt={},Bt.MFILE,"/mfile"),c(zt,Bt.MVAR,"/mvar"),c(zt,Bt.MPATH,"/mpath"),c(zt,Bt.MKEY,"/mkey"),c(zt,Bt.MPATTERN,"/mpattern"),c(zt,Bt.MPACKAGE,"/mpackage"),zt)),Object.freeze(Object.values(Ft).reduce(function(e,t){return O(O({},e),{},c({},t,{key:null}))},{}))),Yt=Object.freeze({apiKey:null,dataApiType:Me,fileHost:Ut,queryParamMap:zt}),Zt=ze.GEO_JSON,Ft=Ye[Zt],Wt=Ft.COMMUNITY_MAP,Jt=Ft.COMMUNITY_ENTITY,Kt=Ft.GEOJSON_LEVEL_GEOMETRY,Xt=function(){function t(e){u(this,t),this.baseApi=e}return l(t,[{key:"getBaseAPI",value:function(){return this.baseApi}},{key:"getCommunityMap",value:function(e,t,n){return this.baseApi.fetch(this.baseApi.getMapProductFileUrl(e,Zt,Wt,null,t,n))}},{key:"getCommunityEntity",value:function(e,t,n){return this.baseApi.fetch(this.baseApi.getMapProductFileUrl(e,Zt,Jt,null,t,n))}},{key:"getGeoJsonLevelGeometry",value:function(e,t,n,r){t="/".concat(t);return this.baseApi.fetch(this.baseApi.getMapProductFileUrl(e,Zt,Kt,t,n,r))}}]),t}(),Qt=Object.freeze({MAP:"MAP",META:"META",CUSTOMER:"CUSTOMER"}),qt=Object.freeze((c(zt={},Qt.MAP,"/map"),c(zt,Qt.META,"/meta"),c(zt,Qt.CUSTOMER,"/customer"),zt)),$t=Object.freeze({METACONFIG:"METACONFIG",OVERRIDES:"OVERRIDES",DATAHOSTS:"DATAHOSTS"}),en=Object.freeze((c(Ye={},$t.METACONFIG,"/metaConfig"),c(Ye,$t.OVERRIDES,"/overrides"),c(Ye,$t.DATAHOSTS,"/map/dataHosts"),Ye)),Ft=Object.freeze({V4:"V4",V5:"V5"}),tn=(Object.freeze((c(zt={},Ft.V4,"/v4"),c(zt,Ft.V5,"/v5"),zt)),Object.freeze((c(Ye={},je.THEME,"/theme/v5"),c(Ye,je.THEME_MAP,"/thememap/v5"),c(Ye,je.PRESETS,"/presets/v5"),c(Ye,je.SDK_STRINGS,"/strings/v5"),c(Ye,je.ICON_FILE,"/iconfile/v5"),c(Ye,je.INPUT_COLORS,"/miceditor/inputcolors"),c(Ye,je.BASE_MAP_INFO,"/miceditor/basemapinfo"),c(Ye,je.CONFIG_PROFILE,"/miceditor/configprofile"),c(Ye,je.NAV_THEME,"/navtheme/v5"),c(Ye,je.NAV_NAME_THEME,"/navtheme/v5"),c(Ye,je.NAV_PROP_MAP,"/navpropmap/v5"),c(Ye,je.NAV_STRINGS,"/strings/v5/nav"),c(Ye,je.NAV_THEME_MAP,"/navthememap/v5"),c(Ye,je.NAV_NAME_THEME_MAP,"/navthememap/v5"),c(Ye,je.V4_THEME_FAMILY,"/theme/v4"),c(Ye,je.V4_MAPTYPE_THEME,"/theme/v4"),c(Ye,je.ICON,"/theme/icon/v5"),c(Ye,je.MARKER,"/theme/marker"),c(Ye,je.PERMISSIONS,"/auth/stringroles"),c(Ye,je.NAICS_ARRAY,"/naics/2012/array"),c(Ye,je.NAICS_MAP,"/naics/2012/map"),Ye))),nn=Object.freeze((c(Ft={},ze.GEO_JSON,"/geojson"),c(Ft,ze.V5_MAP,"/v5_map"),c(Ft,ze.V5_NAV,"/v5_nav"),c(Ft,ze.V5_INFO,"/v5_info"),c(Ft,ze.KML,"/kml"),c(Ft,ze.SVG,"/svg"),c(Ft,ze.PNG,"/png"),Ft)),rn=Object.freeze((c(zt={},ze.V5_MAP,{COMMUNITY_MAP:"/com-map",COMMUNITY_DIRECTORY:"/com-dir",COMMUNITY_DETAIL:"/com-detail",LEVEL_GEOMETRY:"/level-geom",DRAWING_ENTITY:"/drawing-entity"}),c(zt,ze.GEO_JSON,{COMMUNITY_MAP:"/com-map",COMMUNITY_ENTITY:"/com-entity",PATH_LEVEL_GEOMETRY:"/path-level-geom",GEOJSON_LEVEL_GEOMETRY:"/geojson-level-geom"}),c(zt,ze.V5_NAV,{JSON_NAV:"/json",BINARY_NAV:"/bin",JSON_ENHANCED_NAV:"/json-enh",BINARY_ENHANCED_NAV:"/bin-enh"}),c(zt,ze.V5_NAV,{JSON_NAV:"/json",BINARY_NAV:"/bin",JSON_ENHANCED_NAV:"/json-enh",BINARY_ENHANCED_NAV:"/bin-enh"}),c(zt,ze.V5_INFO,{GEOMETRY_INFO:"/geom-info"}),c(zt,ze.SVG,{PLAIN:"/plain",PRETTY:"/pretty",PRETTY_HORIZONTAL_LABEL:"/pretty"}),c(zt,ze.KML,{RASTER:"/raster",RASTER_HORIZONTAL:"/raster",VECTOR:"/vector",VECTOR_HORIZONTAL:"/vector"}),c(zt,ze.PNG,{LOW_RESOLUTION:"/lo-res",HIGH_RESOLUTION:"/high-res",LOW_RESOLUTION_GEO:"/lo-res-geo",HIGH_RESOLUTION_GEO:"/high-res-geo",LOW_RESOLUTION_HORIZONTAL:"/lo-res",HIGH_RESOLUTION_HORIZONTAL:"/high-res",LOW_RESOLUTION_HORIZONTAL_GEO:"/lo-res-geo",HIGH_RESOLUTION_HORIZONTAL_GEO:"/high-res-geo"}),zt)),on=Object.freeze({venueId:null,language:"-",mapVersion:"-",entityVersion:"-",fileVersion:null,themeName:Be[je.THEME]}),an=Object.freeze({MFILE:"MFILE",MPATH:"MPATH",MVAR:"MVAR"}),sn=Object.freeze((c(Ye={},an.MFILE,"/mfile"),c(Ye,an.MPATH,"/mpath"),c(Ye,an.MVAR,"/mvar"),Ye)),un=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u(this,r),this.productAPI={},this.hostConfig_=e,this.isHostCustom=!1}return l(r,[{key:"getBaseUrl",value:function(e){e=!(0<arguments.length&&void 0!==e)||e,e="".concat(this.hostConfig_.fileHost).concat(e?"/ms/v1":"");return e.startsWith("https://")||e.startsWith("http://")||(e="https://".concat(e)),e}},{key:"getFileServiceBaseUrl",value:function(e){e=0<arguments.length&&void 0!==e?e:an.MFILE;if(an[e])return"".concat(this.getBaseUrl()).concat(sn[e])}},{key:"getGlobalMetaBaseUrl",value:function(e){var t=qt[Qt.META],e=this.getFileServiceBaseUrl(e);return"".concat(e).concat(t)}},{key:"getVenueMapBaseUrl",value:function(e){var t=this.getFileServiceBaseUrl(e),e=qt[Qt.MAP];return"".concat(t).concat(e)}},{key:"getGlobalMetaFileUrl",value:function(e,t,n,r){var t=1<arguments.length&&void 0!==t?t:Be[e],i=2<arguments.length?n:void 0,r=3<arguments.length?r:void 0,o=this.getGlobalMetaBaseUrl(r),a=tn[e],s=null===t||""===t?"":"/".concat(t);switch(e){case je.THEME:case je.THEME_MAP:case je.PRESETS:case je.SDK_STRINGS:case je.ICON_FILE:case je.INPUT_COLORS:case je.BASE_MAP_INFO:case je.CONFIG_PROFILE:case je.NAV_THEME:case je.NAV_NAME_THEME:case je.NAV_PROP_MAP:case je.NAV_STRINGS:case je.NAV_THEME_MAP:case je.NAV_NAME_THEME_MAP:case je.V4_THEME_FAMILY:o+="".concat(a).concat(s);break;case je.ICON:case je.MARKER:case je.V4_MAPTYPE_THEME:o+=0<s.length&&i&&0<i.length?"".concat(a).concat(s,"/").concat(i):"".concat(a);break;case je.PERMISSIONS:case je.NAICS_ARRAY:case je.NAICS_MAP:o+="".concat(a)}return o}},{key:"getGeoJsonApi",value:function(){return this.productAPI[ze.GEO_JSON]||(this.productAPI[ze.GEO_JSON]=new Xt(this)),this.productAPI[ze.GEO_JSON]}},{key:"getMapProductUrlPath",value:function(e,t,n,r){t=!(1<arguments.length&&void 0!==t)||t,n=2<arguments.length?n:void 0,r=3<arguments.length?r:void 0,r=this.getVersionedVenueUrl(e,t,r);return n&&(r+="".concat(nn[n])),r}},{key:"getMapProductFileUrl",value:function(e,t,n,r,i,o){var a=rn[ze[t]][n],i=this.getMapProductUrlPath(e,!0,t,i);return n&&(i+="".concat(a)),r&&(i+="".concat(r)),!o&&0!==o||(i+="/fv/".concat(o)),i}},{key:"getMetaConfigUrl",value:function(e,t){var n=en[$t.METACONFIG],t=this.getVersionedVenueUrl(e,!0,t);return t+="".concat(n)}},{key:"getMetaFileUrl",value:function(e,t,n){n=2<arguments.length&&void 0!==n?n:Be[t];if(e){var r,t=Fe[t];return"object"===s(e[t])&&e[t][n]?r=new URL(e[t][n]):"string"==typeof e[t]&&(r=new URL(e[t])),r?this.isHostCustom?"".concat(this.getBaseUrl(!1)).concat(r.pathname):r.toString():null}}},{key:"getMetaOverrideFileUrls",value:function(e,t,n,r){r=3<arguments.length&&void 0!==r?r:Be[n];if(!t||!t.communityOverrides||!t.communityOverrides[e])return[];n=Ue[n],n=t.communityOverrides[e][n]||{};return Array.isArray(n)?n:n[r]||[]}},{key:"getVersionedVenueUrl",value:function(e,t,n){n=2<arguments.length?n:void 0,n=!(1<arguments.length&&void 0!==t)||t?this.getFileServiceBaseUrl(n):"";return n+=r.getVersionedVenuePathSegment(e)}},{key:"getNormalizedUrl",value:function(e){if(this.isHostCustom){var t=new URL(e);return"".concat(this.getBaseUrl(!1)).concat(t.pathname)}return e}},{key:"getMetaConfig",value:function(n){var r=this;if(!n)return null;var i={venueId:n.cid};Object.values(Fe).forEach(function(t){n[t]&&("string"==typeof n[t]?i[t]=n[t]:(i[t]={},Object.keys(n[t]).forEach(function(e){i[t][e]=n[t][e]})))});var e={},o=n.communityOverrides[i.venueId];return Object.keys(o).forEach(function(t){var n;Array.isArray(o[t])?e[t]=o[t].map(function(e){return"".concat(r.getFileServiceBaseUrl()).concat(e)}):"object"===s(o[t])&&(n={},Object.keys(o[t]).forEach(function(e){Array.isArray(o[t][e])&&(n[e]=o[t][e].map(function(e){return"".concat(r.getFileServiceBaseUrl()).concat(e)}))}),e[t]=n)}),i.communityOverrides=c({},i.venueId,e),O(O({},n),i)}}],[{key:"getVersionedVenuePathSegment",value:function(e,t,n){var r=1<arguments.length&&void 0!==t?t:"-",t=2<arguments.length&&void 0!==n?n:"-",n=qt[Qt.MAP];return"".concat(n,"/").concat(e,"/mv/").concat(r,"/ev/").concat(t)}},{key:"getVenueConfig",value:function(e){e=O(O({},on),e);return e.mapVersion=Number(e.mapVersion)||"-",e.entityVersion=Number(e.entityVersion)||"-",e.fileVersion=Number(e.fileVersion)||null,e.venueId=Number(e.venueId),e}}]),r}(),ln=function(){h(a,un);var n=p(a);function a(e){var t;return u(this,a),(t=n.call(this,e)).setAndUpdateHostConfig_(e),e.fileHost&&(t.isHostCustom=!0),t}return l(a,[{key:"setAndUpdateHostConfig_",value:function(e){var t=e.apiKey,e=e.fileHost,n={};Object.keys(Yt.queryParamMap).forEach(function(e){n[e]={key:t}}),e&&(n[e]={key:t}),this.hostConfig_={apiKey:t,dataApiType:Me,fileHost:e||Ut,queryParamMap:O(O({},n),Yt.QUERY_PARAM_MAP_DEFAULT)}}},{key:"addServer",value:function(e,t){var e=-1<e.indexOf("://")?e.split("://")[1]:e,n=this.hostConfig_.queryParamMap[e]?O(O({},this.hostConfig_.queryParamMap[e]),t):t;Object.keys(n).forEach(function(e){null!==n[e]&&void 0!==n[e]&&""!==n[e]||delete n[e]}),this.hostConfig_.queryParamMap[e]=n}},{key:"appendQueryParams",value:function(e){var t=this.hostConfig_.queryParamMap,n=-1<e.indexOf("://")?e.split("://")[1]:e,t=t[A(Object.keys(t).filter(function(e){return n.startsWith(e)}).sort(function(e,t){return t.length-e.length}),1)[0]];return a.appendParamList(e,t)}},{key:"fetch",value:function(e,t,n,r){r=3<arguments.length&&void 0!==r&&r;return e.startsWith("http://")&&(e=e.replace(/http:\/\//gm,"https://")),r||(e=this.appendQueryParams(e)),yt.get(e,t,n)}},{key:"getMapProductFileUrl",value:function(e,t,n,r,i,o){return y(d(a.prototype),"getMapProductFileUrl",this).call(this,e,t,n,r,i,o)}},{key:"getGlobalMetaFileUrl",value:function(e,t,n,r,i){i=4<arguments.length&&void 0!==i?i:0,n=y(d(a.prototype),"getGlobalMetaFileUrl",this).call(this,e,t,n,r);return r&&r===Bt.MPATH&&(n=a.appendParamList(n,{fvhistory:i})),n}}],[{key:"appendParamList",value:function(e,t){if(!t||"object"!==s(t))return e;var n=e.split("?"),r=A(n,2)[1],i=void 0===r?"":r;return Object.keys(t).filter(function(e){return-1===i.indexOf("".concat(e,"="))}).forEach(function(e){i+="&".concat(e,"=").concat(t[e])}),0<(i=i.startsWith("&")?i.substr(1):i).length?"".concat(n[0],"?").concat(i):e}}]),a}(),cn=function(){function i(){u(this,i)}return l(i,null,[{key:"isPointOnGeoJSONLineString",value:function(e,t){var n=!1;if(t&&1<t.length)for(var r,i,o=1;o<t.length;o+=1)if(r=t[o-1],i=t[o],pt.isPointOnLineSegment(e,r,i)){n=!0;break}return n}},{key:"isPointOnGeoJSONMultiLineString",value:function(e,t){for(var n=!1,r=0;r<t.length;r+=1)if(i.isPointOnGeoJSONLineString(e,t[r])){n=!0;break}return n}},{key:"isPointInsideGeoJSONPolygon",value:function(e,t){var n=!1;if(pt.isPointInPolygon(e,t[0])&&(n=!0),n)for(var r=1;r<t.length;r+=1)if(pt.isPointInPolygon(e,t[r])){n=!1;break}return n}},{key:"isPointInsideGeoJSONMultiPolygon",value:function(e,t){for(var n=t.length,r=0;r<n;r+=1)if(i.isPointInsideGeoJSONPolygon(e,t[r]))return!0;return!1}},{key:"convertIntAddressToGeometryAddressListFormat",value:function(e){if(e&&"string"==typeof e){var t=[];return e.split(" ").forEach(function(e){t.push.apply(t,L(e.split(" ")))}),t}return null}},{key:"getGeometriesByLonLat",value:function(t,e,n){for(var r=2<arguments.length&&void 0!==n&&n,i=[],o=e.filter(function(e){return pt.isPointInBoundingBox(t,e.getBoundingBox())}),a=0;a<o.length;a+=1){var s=o[a];if(s.isPointInsideGeometry(t,!0)&&(i.push(s),!r))break}return i.sort(function(e,t){return t.getZIndex()-e.getZIndex()})}}]),i}(),hn=function(){function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0;u(this,r),this.venueModel=n,this.id=e,this.properties=O({geometry:[],int_address:[]},t)}return l(r,[{key:"getId",value:function(){return this.id}},{key:"getGeometries",value:function(){var t=this;return this.properties.geometry.filter(function(e){return A(e,2)[1]}).map(function(e){e=A(e,1)[0];return t.venueModel.getGeometryById(e)})}},{key:"getInternalAddress",value:function(){return this.properties.int_address||[]}},{key:"getName",value:function(){return(Array.isArray(this.properties.name)?this.properties.name[0]:this.properties.name)||""}},{key:"getProperties",value:function(){return this.properties}},{key:"getLabelInfo",value:function(){return this.venueModel.metaInformation_.getEntityLabelInfo(this)}}]),r}(),dn=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0,n=2<arguments.length?arguments[2]:void 0;u(this,r),this.id=e.id,this.properties=e.properties||{},this.labelArea=e.label_area||[],this.geometry=e.geometry||{},this.location=e.location||{},this.level=t,this.zIndex=n,this.state_={isHighlighted:!1,highlightedStyle:{}}}return l(r,[{key:"getId",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getAddress",value:function(){return cn.convertIntAddressToGeometryAddressListFormat(this.getInternalAddress())}},{key:"getInternalAddress",value:function(){return this.properties.int_address||""}},{key:"getCenter",value:function(){return this.location.coordinates||[]}},{key:"getCoordinates",value:function(){return this.geometry.coordinates||[]}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getStyle",value:function(){return this.getMetaInformation_().getStyle(this)}},{key:"getIcon",value:function(){return this.getMetaInformation_().getIcon(this.getLabelInfo())}},{key:"getLabelArea",value:function(){return this.labelArea||[]}},{key:"getLabelInfo",value:function(){return this.getMetaInformation_().getLabelInfo(this)}},{key:"getLabelStyle",value:function(){return O({fill:"#333333"},this.getMetaInformation_().getLabelStyle(this.getStyle()))}},{key:"getGeometryLabelInfo",value:function(){return this.getMetaInformation_().getGeometryLabelInfo(this)}},{key:"getEntities",value:function(){var t=this;return(this.properties.entities||[]).map(function(e){return t.level.getDrawing().getVenueModel().getEntityById(e)})}},{key:"getLevel",value:function(){return this.level}},{key:"getType",value:function(){return this.geometry.type}},{key:"getZIndex",value:function(){return this.zIndex}},{key:"getBoundingBox",value:function(){var e=this.getType(),t=this.getCoordinates(),n=[];switch(e){case Ce:n=[t,t];break;case Ve:case xe:n=t;break;case Re:case De:n=t.reduce(function(e,t){return e.concat(t)},[]);break;case Ge:n=t.reduce(function(e,t){return e.concat(t)},[]).reduce(function(e,t){return e.concat(t)},[])}return pt.getBoundingBoxVertices(n)}},{key:"isIcon",value:function(){var e=this.getLabelInfo();return e&&e.lt===Mt.ICON}},{key:"isPointInsideGeometry",value:function(e,t){var n,r=1<arguments.length&&void 0!==t&&t,i=!1;switch(this.getType()){case Ce:n=this.getLabelArea()&&pt.getRectangularCoordinatesOfLabelArea(this.getLabelArea()),i=pt.isPointInPolygon(e,n);break;case Ve:break;case xe:i=r&&cn.isPointOnGeoJSONLineString(e,this.getCoordinates());break;case Re:i=r&&cn.isPointOnGeoJSONMultiLineString(e,this.getCoordinates());break;case De:i=cn.isPointInsideGeoJSONPolygon(e,this.getCoordinates());break;case Ge:i=cn.isPointInsideGeoJSONMultiPolygon(e,this.getCoordinates())}return i}},{key:"highlight",value:function(e,t){e=!(0<arguments.length&&void 0!==e)||e,t=1<arguments.length?t:void 0;this.state_.isHighlighted=e,this.state_.highlightedStyle=e?t:{}}},{key:"isHighlighted",value:function(){return Boolean(this.state_.isHighlighted)}},{key:"getHighlightedStyle",value:function(){return this.state_.highlightedStyle||{}}},{key:"toJSON",value:function(){return O({},this.geometry)}},{key:"getMetaInformation_",value:function(){return this.getLevel()?this.getLevel().getDrawing().getVenueModel().metaInformation_:null}}]),r}(),vn=function(){function o(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],i=3<arguments.length?arguments[3]:void 0;u(this,o),this.id=e,this.properties=O({},n),this.zIndexCount=0,this.geometries=r.map(function(e){return t.zIndexCount+=1,new dn(e,t,t.zIndexCount)}),this.drawing=i}return l(o,[{key:"getId",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getDrawing",value:function(){return this.drawing}},{key:"getShortName",value:function(){return this.properties["short name"]||""}},{key:"getZIndex",value:function(){return Number(this.properties.zlevel)}},{key:"getFeatureCollectionArray",value:function(){return this.getGeometries().map(function(e){return e.toJSON()})}},{key:"getGeometryById",value:function(t){return this.geometries.find(function(e){return e.getId()===t})}},{key:"getGeometries",value:function(e){return 0<arguments.length&&void 0!==e&&e?this.geometries.sort(function(e,t){return t.getZIndex()-e.getZIndex()}):this.geometries.sort(function(e,t){return e.getZIndex()-t.getZIndex()})}},{key:"getGeometriesByAddress",value:function(t){return this.geometries.filter(function(e){return e.getInternalAddress()===t})}},{key:"isMain",value:function(){return Boolean(this.properties.main)}}]),o}(),fn=function(){function a(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=4<arguments.length?arguments[4]:void 0;u(this,a),this.venueModel=o,this.levels=i.map(function(e){return new vn(e.id,e.properties,e.features,t)}),this.id=e,this.properties=n,this.frame_=r}return l(a,[{key:"getId",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"isRoot",value:function(){return Boolean(this.properties.is_root)}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getBoundingBox",value:function(){var e=this.frame_,t=e.height,n=e.width,e=e.transform,n=A(pt.getBoundingBoxVertices([pt.convertMxMy2LonLat(e,[0,0]),pt.convertMxMy2LonLat(e,[0,t]),pt.convertMxMy2LonLat(e,[n,0]),pt.convertMxMy2LonLat(e,[n,t])]),2),t=n[0],n=n[1];return[n[1],t[0],t[1],n[0]]}},{key:"getCenter",value:function(){var e=this.frame_;if(e)return pt.convertMxMy2LonLat(e.transform,[e.width/2,e.height/2])}},{key:"getGeometryById",value:function(t,e){return e?e.getGeometryById(t):this.getGeometries().find(function(e){return e.getId()===t})}},{key:"getGeometries",value:function(){return this.levels.flatMap(function(e){return e.getGeometries()})}},{key:"getLevelById",value:function(t){return this.levels.find(function(e){return e.getId()===t})}},{key:"getLevelByZIndex",value:function(t){return this.levels.find(function(e){return e.getZIndex()===t})}},{key:"getLevels",value:function(){return this.levels}},{key:"getMainLevel",value:function(){return this.levels.find(function(e){return e.isMain()})}},{key:"getVenueModel",value:function(){return this.venueModel}}]),a}(),gn=He.STANDARD,pn=function(){function o(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new jt;u(this,o),this.metaInformation_=i,this.id=e.id,this.location=e.location||{},this.properties=O({},e.properties),this.drawings=(e.drawings||[]).map(function(e){var t=e.levels.map(function(e){var t=e.id;return r.find(function(e){return e.id===t})});return new fn(e.id,e.properties,e.ref_frame,t,n)}),this.entities=(t.entities||[]).map(function(e){return new hn(e.id,e.properties,n)})}return l(o,[{key:"getDisplaySettings",value:function(){return this.metaInformation_.releaseSettings_.displayOptions.display||gn}},{key:"getId",value:function(){return this.id}},{key:"getName",value:function(){return this.properties.name}},{key:"getBoundingBox",value:function(){var e=pt.getBoundingBoxVertices(this.getDrawings().flatMap(function(e){var t=A(e.getBoundingBox(),4),e=t[0];return[[t[1],t[2]],[t[3],e]]})),t=A(e,2),e=t[0],t=t[1];return[t[1],e[0],e[1],t[0]]}},{key:"getCenter",value:function(){return this.location.coordinates}},{key:"getEntityById",value:function(t){return this.entities.find(function(e){return e.id===t})}},{key:"getGeometryById",value:function(t){return this.getGeometries().find(function(e){return e.getId()===t})}},{key:"getGeometries",value:function(){return this.getLevels().sort(function(e,t){return e.getZIndex()-t.getZIndex()}).flatMap(function(e){return e.getGeometries()})}},{key:"getGeometriesByLonLat",value:function(t,e,n){var r=this,n=!(2<arguments.length&&void 0!==n)||n,e=(1<arguments.length&&void 0!==e?e:[]).map(function(e){return r.getLevelById(e)});return 0===e.length&&(e=this.drawings.filter(function(e){e=e.getBoundingBox();return pt.isPointInBoundingBox(t,e)}).flatMap(function(e){return e.getLevels()})),cn.getGeometriesByLonLat(t,e.flatMap(function(e){return e.getGeometries(!0)}),n)}},{key:"getDrawingById",value:function(t){return this.drawings.find(function(e){return e.getId()===t})}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getRootDrawing",value:function(){return this.drawings.find(function(e){return e.isRoot()})}},{key:"getLevelById",value:function(t){return this.getLevels().find(function(e){return e.getId()===t})}},{key:"getLevelsByZIndex",value:function(e){var t=0<arguments.length&&void 0!==e?e:0;return this.getLevels().filter(function(e){return Number(e.getZIndex())===Number(t)})}},{key:"getLevels",value:function(){return this.drawings.flatMap(function(e){return e.getLevels()})}},{key:"getLevelMapFlattenedByZIndex_",value:function(){return this.getLevels().reduce(function(e,t){var n=t.getZIndex(),e=e;return e[n]||(e[n]=[]),e[n].push(t),e},{})}},{key:"getIconsInformation",value:function(){var t=new Map;return this.getGeometries().filter(function(e){return e.isIcon()}).forEach(function(e){e=e.getLabelInfo();t.set(e.iconIdentifier,e)}),Array.from(t.values())}}]),o}(),yn={PRD:"vfs.venue.maps.api.here.com",STG:"vfs.sit.venue.maps.api.here.com"},mn=function(){h(i,un);var r=p(i);function i(e){var t=e.apiKey,n=e.fileHost,e=e.token;return u(this,i),e=r.call(this,{apiKey:t,fileHost:n||yn.PRD,token:e}),n&&(e.isHostCustom=!0),e}return l(i,[{key:"fetch",value:function(e,t,n){var r=this.hostConfig_,i=r.apiKey,o=r.token,r=O({method:"GET",headers:{}},t),t=e;return t.startsWith("http://")&&(t=t.replace(/http:\/\//gm,"https://")),o?(e="Bearer ",o=o.startsWith(e)?o:"".concat(e).concat(o),r.headers instanceof Headers?r.headers.append("Authorization",o):r.headers.Authorization=o):i&&(t="".concat(t,"?apiKey=").concat(i)),yt.get(t,r,n)}}]),i}(),In={isIconsEnabled:!0,isMetaEnabled:!0,metaOptions:{},iconOptions:{}},_n=Object.keys(Fe).map(function(e){return{identifier:e,name:void 0,url:void 0}}),En=function(){function i(e){var t=e.apiKey,n=e.baseUrl,r=e.token,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];u(this,i);r={apiKey:t,fileHost:n,token:r};this.dataApi_=new(e?ln:mn)(r)}return l(i,[{key:"load",value:function(n,e){var r=this,e=1<arguments.length&&void 0!==e?e:{},e=O(O({},In),e),i=e.isIconsEnabled,t=e.isMetaEnabled,o=e.iconOptions,a=e.metaOptions;return Promise.resolve().then(function(){return t?r.getMeta_(n,a).catch(function(e){return Promise.resolve()}):new jt}).then(function(e){return r.getVenue_(n,e)}).then(function(e){if(dt.emit(ht.VENUE_MAP_DATA_LOADED,{data:e}),i){var t=e.getIconsInformation();return r.getIcons_(n,e.metaInformation_,t,o).then(function(){return e})}return e})}},{key:"getVenue_",value:function(t,r){var n=this;return this.getCommunityMap_(t).then(function(e){return Promise.all([Promise.resolve(e),n.getCommunityEntity_(t),n.getLevels_(t,e.drawings.flatMap(function(e){return e.levels.map(function(e){return e.id})}))])}).then(function(e){var t=A(e,3),n=t[0],e=t[1],t=t[2];return new pn(n,e,void 0===t?[]:t,r)})}},{key:"getCommunityMap_",value:function(t){return this.dataApi_.getGeoJsonApi().getCommunityMap(t).catch(function(e){return Promise.reject(new Error("Community map load failed for venue id ".concat(t,' with error "\n ').concat(e.message,'"')))})}},{key:"getCommunityEntity_",value:function(t){return this.dataApi_.getGeoJsonApi().getCommunityEntity(t).catch(function(e){return Promise.reject(new Error("Community Entity failed for venue id ".concat(t,' with error "').concat(e.message,'"')))})}},{key:"getLevels_",value:function(e,t){var n=this,t=1<arguments.length&&void 0!==t?t:[];return Promise.all(t.map(function(t){return n.dataApi_.getGeoJsonApi().getGeoJsonLevelGeometry(e,t).catch(function(e){return Promise.reject(new Error("Level load failed for level id ".concat(t,' with error: "').concat(e.message,'"')))})}))}},{key:"getIcon_",value:function(e,t,n,r){var i=2<arguments.length&&void 0!==n?n:{},o=3<arguments.length&&void 0!==r&&r,a=i.iconIdentifier,r=i.url;return a&&r?this.dataApi_.fetch(this.dataApi_.getNormalizedUrl(r)).then(function(e){e=new It(O(O({},i),e),o);return t.setIcon(a,e),e}):Promise.reject(new Error("Issue with icon data, iconIdentifier and url should be available: ".concat(i)))}},{key:"getIcons_",value:function(e,n,t,r){var i=this,t=2<arguments.length&&void 0!==t?t:[],o=(3<arguments.length&&void 0!==r?r:{}).isMultiObjectToSplit;return Promise.all(t.map(function(t){return i.getIcon_(e,n,t,o).catch(function(e){return Promise.resolve(t)})})).catch(function(e){return Promise.resolve()})}},{key:"getMeta_",value:function(t,e,n){var r=this,i=1<arguments.length&&void 0!==e?e:{},o=2<arguments.length&&void 0!==n?n:_n,a=new jt;return Promise.resolve().then(function(){return r.getMetaConfig_(t,i).then(function(e){return a.releaseSettings_=e.settings,r.dataApi_.getMetaConfig(e)})}).then(function(e){return r.getMetaFiles_(e,a,o).then(function(){return r.getMetaOverrides_(t,e,a,o)})}).then(function(){return a})}},{key:"getMetaConfig_",value:function(e){e=this.dataApi_.getMetaConfigUrl(e);return this.dataApi_.fetch(e).catch(function(e){return Promise.reject(e)})}},{key:"getMetaFiles_",value:function(r,i,e,t){var o=this,e=2<arguments.length&&void 0!==e?e:[],a=!(3<arguments.length&&void 0!==t)||t;return Promise.all(e.map(function(e){var t=e.identifier,n=e.name,e=e.url;return!e&&a&&(e=o.dataApi_.getMetaFileUrl(r,t,n)),e=e||o.dataApi_.getGlobalMetaFileUrl(t,n),o.dataApi_.fetch(e).then(function(e){return i.instantiateMetaFileAccessor_(t,e),e}).catch(function(e){return Promise.resolve()})}))}},{key:"getMetaOverrides_",value:function(r,i,o,e){var a=this,e=3<arguments.length&&void 0!==e?e:[];return Promise.all(e.map(function(e){var t=e.identifier,n=e.name,n=(e=t,n=n,r&&i&&a.dataApi_.getMetaOverrideFileUrls(r,i,e,n)||[]);return Promise.all(n.map(function(e){return a.dataApi_.fetch(e).then(function(e){return o[t]&&o[t].applyOverride(e,!1),Promise.resolve()}).catch(function(e){return Promise.resolve()})}))}))}}]),i}(),Mn="https://meta-indoor-routing.api-gateway.ls.hereapi.com",On=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(u(this,t),!e.apiKey&&!e.token)throw new Error("API key or Token is missing");this.config_=O({baseUrl:Mn},e)}return l(t,[{key:"calculateRoute",value:function(e){var t=e.origin,n=void 0===t?{}:t,r=e.destination,i=void 0===r?{}:r,t=f(e,["origin","destination"]);if(!n.coordinates||!i.coordinates)throw new Error("Waypoint coordinates are missing");var r=function(e){var t=e.coordinates,n=e.venueId,e=e.levelId,t=t.join(",");return n&&e?t.concat(";indoorMapId=",n,";levelId=",e):t},e=new URL("".concat(this.config_.baseUrl,"/v1/routes")),o=new URLSearchParams({origin:r(n),destination:r(i),apiKey:this.config_.apiKey});return Object.entries(t).forEach(function(e){var t=A(e,2),e=t[0],t=t[1];o.append(e,"object"===s(t)?JSON.stringify(t):t)}),e.search=o,fetch(e,{headers:{"X-Api-Key":this.config_.apiKey}}).then(function(e){return e.json()})}}]),t}(),An=function(){h(s,H.map.Feature);var t=p(s);function s(e){var n;if(u(this,s),n=t.call(this),!(e instanceof pn))throw new Error("It is mandatory to provide valid instance of venueModel");return n.venueModel=e,n.search_=new Ee(e),n.status_={activeDrawingId:e.getRootDrawing().getId(),activeLevelIndex:e.getRootDrawing().getMainLevel().getZIndex()},n.mapObjectStore_=n.getDefaultMapObjectsStore_(),n.drawings=e.getDrawings().map(function(e){e=new _(e);return e.setParentEventTarget(g(n)),e}),n.levels=e.getLevels().map(function(e){var t=new E(e);return t.setParentEventTarget(n.drawings.find(function(e){return e.getId()===t.getData().getDrawing().getId()})),t}),n.geometries=e.getGeometries().map(function(e){var t=new I(e);return t.setParentEventTarget(n.levels.find(function(e){return e.getId()===t.getData().getLevel().getId()})),t}),n}return l(s,[{key:"getData",value:function(){return this.venueModel}},{key:"getBoundingBox",value:function(){return v(H.geo.Rect,L(this.venueModel.getBoundingBox()))}},{key:"getCenter",value:function(){var e=A(this.venueModel.getCenter(),2),t=e[0],e=e[1];return new H.geo.Point(e,t)}},{key:"getId",value:function(){return this.venueModel.getId()}},{key:"getName",value:function(){return this.venueModel.getName()}},{key:"getDrawing",value:function(t){return this.drawings.find(function(e){return e.getId()===t})}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getLevel",value:function(t){return this.levels.find(function(e){return e.getId()===t})}},{key:"getLevels",value:function(){return this.levels}},{key:"getGeometry",value:function(t){return this.geometries.find(function(e){return e.getId()===t})}},{key:"getGeometries",value:function(){return this.geometries}},{key:"getActiveLevels",value:function(){var t=this;return this.getData().getDisplaySettings()===He.FLATTEN?this.venueModel.getLevelsByZIndex(this.status_.activeLevelIndex).map(function(e){return t.getLevel(e.getId())}):[this.venueModel.getDrawingById(this.status_.activeDrawingId).getLevelByZIndex(this.status_.activeLevelIndex)].map(function(e){return t.getLevel(e.getId())})}},{key:"getActiveDrawing",value:function(){return this.getDrawing(this.status_.activeDrawingId)}},{key:"setActiveDrawing",value:function(e){if(this.status_.activeDrawingId!==e){var t=this.venueModel.getDrawingById(e);if(!t)throw new Error("Drawing ".concat(e," was not found"));var n=this.status_.activeDrawingId;this.status_.activeDrawingId=e,this.setActiveLevelIndex(t.getMainLevel().getZIndex()),this.dispatchEvent(new H.util.ChangeEvent(s.EVENTS.DRAWING_CHANGE,e,n))}}},{key:"getActiveLevelIndex",value:function(){return this.status_.activeLevelIndex}},{key:"setActiveLevelIndex",value:function(e){var t;this.venueModel.getLevelsByZIndex(e)&&(t=this.status_.activeLevelIndex,this.status_.activeLevelIndex=e,this.dispatchEvent(new H.util.ChangeEvent(s.EVENTS.LEVEL_CHANGE,e,t)))}},{key:"isActive",value:function(){var e=this.getParentEventTarget();return!!e&&this===e.activeVenue}},{key:"getHighlightedGeometries",value:function(){var t=this;return this.venueModel.getGeometries().filter(function(e){return e.isHighlighted()}).map(function(e){return t.getGeometry(e.getId())})}},{key:"setHighlightedGeometries",value:function(e,t,n){var r=!(0<arguments.length&&void 0!==e)||e,t=1<arguments.length&&void 0!==t?t:[],n=2<arguments.length&&void 0!==n?n:{},n=O(O({},oe),n),i=n.fillColor,o=n.outlineColor,a=n.outlineWidth;t.forEach(function(e){e.getData().highlight(r,{m:i,o:o,w:a})}),this.dispatchEvent(s.EVENTS.GEOMETRY_HIGHLIGHT)}},{key:"getMapObjects",value:function(e,t){e=0<arguments.length&&void 0!==e?e:this.getActiveLevelIndex(),t=1<arguments.length&&void 0!==t?t:this.getActiveDrawing();return this.mapObjectStore_[e][t.getId()]}},{key:"setMapObjects",value:function(e,t,n){e=0<arguments.length&&void 0!==e?e:[],t=1<arguments.length&&void 0!==t?t:this.getActiveLevelIndex(),n=2<arguments.length&&void 0!==n?n:this.getActiveDrawing();this.mapObjectStore_[t]&&this.mapObjectStore_[t][n.getId()]&&(this.mapObjectStore_[t][n.getId()]=L(e)),this.updateMapObjectsVisibility_()}},{key:"search",value:function(e){var t=this,e=0<arguments.length&&void 0!==e?e:"";return this.search_.find(e).flatMap(function(e){return e.geometries.map(function(e){return t.getGeometry(e.getId())})})}},{key:"updateMapObjectsVisibility_",value:function(){Object.values(this.mapObjectStore_).forEach(function(e){Object.values(e).forEach(function(e){return e.forEach(function(e){return e.setVisibility(!1)})})}),this.isActive()&&this.mapObjectStore_[this.getActiveLevelIndex()][this.getActiveDrawing().getId()].forEach(function(e){return e.setVisibility(!0)})}},{key:"getDefaultMapObjectsStore_",value:function(){var r=this,i=this.getData().getDisplaySettings()===He.FLATTEN;return this.venueModel.getLevels().reduce(function(e,t){var n=t.getZIndex(),e=O({},e);return e[n]||(e[n]={}),e[n][t.getDrawing().getId()]=[],i&&(e[n][r.venueModel.getRootDrawing().getId()]=[]),e},{})}}]),s}();An.EVENTS={ACTIVE_VENUE_CHANGE:"activevenuechange",DRAWING_CHANGE:"drawingchange",LEVEL_CHANGE:"levelchange",GEOMETRY_HIGHLIGHT:"geometryhighlight"};function Ln(e,t,n){return n===Rn.ObjectType.SEGMENT_START_MARKER?0===e?Cn:Dn:n===Rn.ObjectType.SEGMENT_FINISH_MARKER?1===t.length||e===t.length-1?xn:Vn:"indoor"===t[e].departure.place.type?wn:Pn}var Tn=function(){function e(){u(this,e)}return l(e,null,[{key:"getIconLayer",value:function(e){return{type:"FeatureCollection",features:(0<arguments.length&&void 0!==e?e:[]).flatMap(function(e){return e.getData().getGeometries()}).filter(function(e){return e.isIcon()&&e.getIcon()}).map(function(e){var t=A(e.getLabelArea(),2),n=t[0],r=t[1],i=e.getLevel(),t=e.getIcon().getSVG();return{type:"Feature",properties:{id:e.getId(),geometryId:e.getId(),levelId:i.getId(),name:e.getDisplayName(),venueId:i.getDrawing().getVenueModel().getId(),url:t?"data:image/svg+xml;utf8,".concat(encodeURIComponent(t)):""},geometry:{type:q,coordinates:[n,r]}}})}}},{key:"getLabelLayer",value:function(e){return{type:"FeatureCollection",features:(0<arguments.length&&void 0!==e?e:[]).flatMap(function(e){return e.getData().getGeometries()}).filter(function(e){return e.getDisplayName()&&!e.isIcon()}).map(function(e){var t=A(e.getLabelArea(),2),n=t[0],r=t[1],i=e.getLabelStyle(),o=i.fill,t=i.zmin,i=e.getLevel();return{type:"Feature",properties:{id:e.getId(),geometryId:e.getId(),levelId:i.getId(),venueId:i.getDrawing().getVenueModel().getId(),name:e.getDisplayName(),minZoom:t||15,textFillColor:o.toLowerCase()},geometry:{type:q,coordinates:[n,r]}}})}}},{key:"getGeometryLayer",value:function(e){return{type:"FeatureCollection",features:(0<arguments.length&&void 0!==e?e:[]).flatMap(function(e){return e.getData().getGeometries()}).filter(function(e){return e.getType()!==q}).map(function(e){var t=e.getHighlightedStyle()||{},n=t.m,r=t.o,i=t.w,o=O({},e.getStyle()),a=o.m,s=o.o,u=o.w,l=re.fillColor,c=re.outlineColor,t=re.outlineWidth,o=e.getLevel();return{type:"Feature",properties:{id:e.getId(),fillColor:(n||a||l).toLowerCase(),geometryId:e.getId(),levelId:o.getId(),venueId:o.getDrawing().getVenueModel().getId(),outlineColor:(r||s||c).toLowerCase(),outlineWidth:Number(((i||u||t)/3).toFixed(2)),zIndex:e.getZIndex()},geometry:{type:e.getType(),coordinates:e.getCoordinates()}}})}}},{key:"getFootprintLayer",value:function(e){return{type:"FeatureCollection",features:e.flatMap(function(e){var t=e.getData().getRootDrawing().getMainLevel().getId(),n=e.getLevel(t).getData().getGeometries().filter(function(e){return e.getType()===$});return[{type:"Feature",properties:{isFootprint:!0,levelId:t,venueId:e.getId(),zIndex:1},geometry:{type:"MultiPolygon",coordinates:n.map(function(e){return e.getCoordinates()})}},{type:"Feature",properties:{isFootprint:!0,levelId:t,venueId:e.getId(),zIndex:2,venueName:e.getName()},geometry:{type:"Point",coordinates:e.getCenter().toGeoJSON().coordinates.slice(0,2)}}]})}}}]),e}(),Nn=function(){function e(){u(this,e)}return l(e,null,[{key:"getStyle",value:function(e){var e=0<arguments.length&&void 0!==e?e:[],n={styles:[{layer:le.FOOTPRINT,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#613F8E",lineWidth:"2px",renderOrder:1},{layer:le.FOOTPRINT,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:"#AF91B4",renderOrder:2},{layer:le.FOOTPRINT,when:["==",["geometry-type"],"Point"],technique:"text",color:"black",size:16,text:["get","venueName"],priority:61},{layer:le.VECTOR,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:["get","fillColor"],renderOrder:["get","zIndex"]},{layer:le.VECTOR,technique:"solid-line",color:["get","outlineColor"],lineWidth:["get","outlineWidth"],renderOrder:["get","zIndex"]},{layer:le.TEXT,minZoomLevel:["get","minZoom"],technique:"text",color:["get","textFillColor"],size:ie.size,text:["get","name"],priority:60},{layer:le.ICON,minZoomLevel:ae,when:["==",["geometry-type"],"Point"],technique:"labeled-icon",textIsOptional:!0,size:0,imageTexture:["concat","texture",["get","name"]],screenWidth:["interpolate",["linear"],["zoom"],15,3,21,25],screenHeight:["interpolate",["linear"],["zoom"],15,3,21,25],priority:61}],images:{},imageTextures:[]};return e.forEach(function(e){var t="texture"+e.properties.name;n.images[t]||(n.images[t]={url:e.properties.url,preload:!0},n.imageTextures.push({name:t,image:t}))}),new H.map.render.harp.Style(n)}}]),e}(),bn=function(){function n(){u(this,n)}return l(n,null,[{key:"getIconsTextures",value:function(e){var i={},o={},a=(0<arguments.length&&void 0!==e?e:[]).reduce(function(e,t){var n=t.properties.name;return e[n]||(e[n]=[]),e[n].push(t),e},{});return Object.keys(a).forEach(function(e){var t="texture".concat(e),n="sprite".concat(e),r=a[e][0].properties.url;i[t]={url:r,sprites:c({},n,[0,0,50,50])},a[e].forEach(function(e){e=e.properties;o["icon".concat(e.name)]={filter:{name:e.name,$zoom:{min:ae}},draw:{points:{interactive:!0,priority:1,size:[[15,"5%"],[16,"10%"],[17,"15%"],[18,"25%"],[19,"35%"],[20,"40%"],[21,"50%"]],texture:t,sprite:n}}}})}),{textures:i,iconLayers:o}}},{key:"getFootprintLayer",value:function(){return{data:{source:"venues",layer:le.FOOTPRINT},draw:{polygons:{interactive:!0,color:"#AF91B4",order:2},lines:{color:"#613F8E",width:"2px",order:1},points:{color:"[0, 0, 0, 0]",size:"0px",order:3,priority:1,text:{anchor:"center",collide:!1,font:{fill:"black",size:"16px"},text_source:"function() { return feature.venueName }"}}}}}},{key:"getGeometryLayer",value:function(){return{data:{source:"venues",layer:le.VECTOR},draw:{polygons:{interactive:!0,color:"function() { return feature.fillColor }",order:"function() { return feature.zIndex }"},lines:{color:"function() { return feature.outlineColor }",order:"function() { return feature.zIndex }",width:"function() { return feature.outlineWidth }"}}}}},{key:"getTextLayer",value:function(){return{filter:{$zoom:{min:se}},data:{source:"venues",layer:le.TEXT},draw:{points:{filter:"function() { return $zoom > feature.minZoom }",color:"[0, 0, 0, 0]",size:"0px",offset:["0px","-10px"],priority:2,text:{font:{fill:"function() { return feature.textFillColor }",size:ie.size},text_source:"function() { return feature.name }"}}}}}},{key:"getIconLayer",value:function(e){return O({data:{source:"venues",layer:le.ICON}},e)}},{key:"getStyle",value:function(e){var t=n.getIconsTextures(0<arguments.length&&void 0!==e?e:[]),e=t.textures,t=t.iconLayers,t={venue_footprints:n.getFootprintLayer(),venue_geometries:n.getGeometryLayer(),venue_labels:n.getTextLayer(),venue_icons:n.getIconLayer(t)},e=H.gl.yaml.safeDump({sources:{venues:{max_zoom:ue,type:"GeoJSONTileSource"}},layers:t,textures:e});return new H.map.render.webgl.Style(e)}}]),n}(),Sn={type:"FeatureCollection",features:[]},kn={extent:4096,indexMaxZoom:0,maxZoom:24,tolerance:3},Ft=function(){h(n,H.map.provider.RemoteTileProvider);var t=p(n);function n(e){return u(this,n),(e=t.call(this,e)).venues=[],e.activeVenue=null,e.dataLayers_={},e.tileIndexes_={},e.addEventListener(An.EVENTS.ACTIVE_VENUE_CHANGE,e.activeVenueChangeHandler_,void 0,g(e)),e}return l(n,[{key:"setStyle",value:function(e){return this.setStyleInternal(e)}},{key:"getStyle",value:function(){return this.getStyleInternal()}},{key:"isFeatureVisible_",value:function(e,t){var n=e.properties;return this.activeVenue&&n.venueId===this.activeVenue.getId()?t!==le.FOOTPRINT&&this.activeVenue.getActiveLevels().some(function(e){return e.id===n.levelId}):!0===n.isFootprint&&t===le.FOOTPRINT}},{key:"requestInternal",value:function(s,u,l,e){function c(e){for(var t=0;t<e.length;t+=1)e[t]=e[t].map(function(e){return Q(e,l,s,u,kn.extent)})}var h=this,d={};return Object.keys(this.tileIndexes_).forEach(function(t){var e=h.tileIndexes_[t].getTile(l,s,u);d[t]=e?function(e){var t=[],n=e&&e.features;if(n)for(var r=0,i=n.length;r<i;r+=1){var o=n[r],a=o.type,s=void 0,u=!1;switch(a){case ce:s={type:ee,coordinates:o.geometry.map(function(e){return e.slice()})};break;case he:case de:s={type:te,coordinates:o.geometry.map(function(e){return e.map(function(e){return e.slice()})})},a===de&&null==(s=X(s))&&(u=!0);break;default:u=!0}u||t.push({geometry:s,id:o.id,properties:o.tags,type:"Feature"})}return{type:"FeatureCollection",features:t}}(e):Sn,d[t].features=d[t].features.filter(function(e){return h.isFeatureVisible_(e,t)});for(var n=0;n<d[t].features.length;n+=1){var r=d[t].features[n],i=r.geometry.type;if(i===$||i===te)c(r.geometry.coordinates);else if(i===ne)r.geometry.coordinates.map(c);else for(var o=r.geometry.coordinates,a=0;a<o.length;a+=1)o[a]=Q(o[a],l,s,u,kn.extent)}}),e(d),{cancel:function(){}}}},{key:"getActiveVenue",value:function(){return this.activeVenue}},{key:"getVenue",value:function(t){return t?this.venues.find(function(e){return e.getId()===Number(t)}):this.activeVenue}},{key:"setActiveVenue",value:function(e){var t=this.activeVenue;this.activeVenue=e,this.dispatchEvent(new H.util.ChangeEvent(An.EVENTS.ACTIVE_VENUE_CHANGE,e,t)),this.reload()}},{key:"addVenue",value:function(e,t){var n=1<arguments.length&&void 0!==t&&t;if(!(e instanceof An))throw new Error("Invalid argument");t=e.getId();if(this.getVenue(t))throw new Error("Please invoke provider.removeVenue to remove old instance of venue ".concat(t," before adding new"));e.setParentEventTarget(this),this.venues.push(e),n||(this.reloadData_(),this.reloadStyle_())}},{key:"addVenues",value:function(e){var t=this,e=0<arguments.length&&void 0!==e?e:[];0<e.length&&(e.forEach(function(e){e instanceof An&&t.addVenue(e,!0)}),this.reloadData_(),this.reloadStyle_())}},{key:"removeVenue",value:function(e){var t;e instanceof An&&-1<this.venues.indexOf(e)&&(t=e.getId(),this.activeVenue&&this.activeVenue.getId()===t&&this.setActiveVenue(null),this.venues.splice(this.venues.indexOf(e),1),this.reloadData_(),this.reloadStyle_(),this.reload())}},{key:"getFeatureProxy",value:function(e,t,n){var r=e.geometryId,e=e.venueId,e=this.getVenue(e);return r?n(e.getGeometries().find(function(e){return e.id===r})):e&&n(e),!0}},{key:"addVenueEventListeners_",value:function(e){e&&(e.addEventListener(An.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),e.addEventListener(An.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),e.addEventListener(An.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"removeVenueEventListeners_",value:function(e){e&&(e.removeEventListener(An.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),e.removeEventListener(An.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),e.removeEventListener(An.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"activeVenueChangeHandler_",value:function(e){var t=e.oldValue,e=e.newValue;t&&(this.removeVenueEventListeners_(t),t.updateMapObjectsVisibility_()),e&&(this.addVenueEventListeners_(e),e.updateMapObjectsVisibility_())}},{key:"drawingChangeHandler_",value:function(){this.reload()}},{key:"levelChangeHandler_",value:function(){this.activeVenue&&(this.activeVenue.updateMapObjectsVisibility_(),this.reload())}},{key:"geometryHighlightHandler_",value:function(){this.reloadData_([le.VECTOR]),this.reload()}},{key:"createDataLayers_",value:function(e){var t=this,e=0<arguments.length&&void 0!==e?e:Object.keys(le),n=le.FOOTPRINT,r=le.ICON,i=le.TEXT,o=le.VECTOR;e.forEach(function(e){switch(e){case o:t.dataLayers_[o]=Tn.getGeometryLayer(t.venues);break;case n:t.dataLayers_[n]=Tn.getFootprintLayer(t.venues);break;case r:t.dataLayers_[r]=Tn.getIconLayer(t.venues);break;case i:t.dataLayers_[i]=Tn.getLabelLayer(t.venues);break;default:throw new Error("Unsupported Layer ".concat(e))}})}},{key:"createTileIndexes_",value:function(e){var t=this;(0<arguments.length&&void 0!==e?e:Object.keys(le)).forEach(function(e){t.tileIndexes_[e]=new J(t.dataLayers_[e],kn)})}},{key:"reloadData_",value:function(e){e=0<arguments.length&&void 0!==e?e:Object.keys(le);this.createDataLayers_(e),this.createTileIndexes_(e)}},{key:"reloadStyle_",value:function(){var e=this.dataLayers_[le.ICON]?this.dataLayers_[le.ICON].features:[];this.getEngineType()===H.Map.EngineType.WEBGL?this.setStyle(bn.getStyle(e)):this.getEngineType()===H.Map.EngineType.HARP&&this.setStyle(Nn.getStyle(e))}},{key:"providesGeoJSON",value:function(){return!0}}]),n}(),wn=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),Pn=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),Cn=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImIiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PG1hc2sgaWQ9ImMiIHdpZHRoPSIzOCIgaGVpZ2h0PSI0NiIgeD0iMCIgeT0iMCIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjYSIvPjwvbWFzaz48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48ZWxsaXBzZSBjeD0iMjAiIGN5PSI0NS4xNiIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjOTc5Nzk3IiBzdHJva2Utd2lkdGg9Ii4yNSIgcng9IjMuNSIgcnk9IjMuNSIvPjx1c2UgZmlsbD0iIzAxQjZCMiIgeGxpbms6aHJlZj0iI2IiLz48cGF0aCBmaWxsPSIjMzIzMjMyIiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJNMTEuODEgMzcuNjZoMTYuMzhsLTguMiA4eiIvPjx1c2Ugc3Ryb2tlPSIjNDE2QTg2IiBzdHJva2Utd2lkdGg9Ii41IiBtYXNrPSJ1cmwoI2MpIiB4bGluazpocmVmPSIjYSIvPjxlbGxpcHNlIGN4PSIxOS44MSIgY3k9IjE5LjE5IiBmaWxsPSIjRkZGIiByeD0iNC44MSIgcnk9IjQuODEiLz48L2c+PC9zdmc+"),xn=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzMi44MyAzMy4xMDRjLjQwNy0uMzc0IDEuNDE5LTEuNDUyIDEuNDE5LTEuNDUyeiIvPjxtYXNrIGlkPSJjIiB3aWR0aD0iMzgiIGhlaWdodD0iNDYiIHg9IjAiIHk9IjAiIGZpbGw9IiNmZmYiPjx1c2UgeGxpbms6aHJlZj0iI2EiLz48L21hc2s+PGVsbGlwc2UgaWQ9ImIiIGN4PSIxOS44MDciIGN5PSIxOS4xNjgiIHJ4PSIxMi4zNjMiIHJ5PSIxMi4xOTciLz48bWFzayBpZD0iZCIgd2lkdGg9IjI1LjcyNSIgaGVpZ2h0PSIyNS4zOTQiIHg9Ii0uNSIgeT0iLS41Ij48cGF0aCBmaWxsPSIjZmZmIiBkPSJNNi45NDQgNi40NzFoMjUuNzI1djI1LjM5NEg2Ljk0NHoiLz48dXNlIHhsaW5rOmhyZWY9IiNiIi8+PC9tYXNrPjwvZGVmcz48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxlbGxpcHNlIGN4PSIyMCIgY3k9IjQ1LjE2IiBmaWxsPSIjRkZGIiBzdHJva2U9IiM5Nzk3OTciIHN0cm9rZS13aWR0aD0iLjI1IiByeD0iMy41IiByeT0iMy41Ii8+PHVzZSBmaWxsPSIjMzIzMjMyIiB4bGluazpocmVmPSIjYSIvPjxwYXRoIGZpbGw9IiM3RDdEN0QiIGQ9Ik0xMi4wMTEgMzcuODA1aDE1Ljk3OGwtNy45MTYgOHoiLz48dXNlIHN0cm9rZT0iIzdDN0M3QyIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNlKSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIHN0cm9rZT0iI0ZGRiIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNjKSIgeGxpbms6aHJlZj0iI2EiLz48ZWxsaXBzZSBmaWxsPSIjRkZGIiBjeD0iMTkuODA3IiBjeT0iMTkuMTY4IiByeD0iMTIuMzYzIiByeT0iMTIuMTk3Ii8+PHBhdGggZmlsbD0iIzMyMzIzMiIgZD0iTTYuODEyIDYuOTQ4aDYuNDV2Ni4zNjRoLTYuNDV6bTAgMTIuNzI3aDYuNDV2Ni4zNjRoLTYuNDV6bTYuNDUtNi4zNjNoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS0xOS4wOTFoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS02LjM2M2g2LjQ1djYuMzY0aC02LjQ1em0wIDEyLjcyN2g2LjQ1djYuMzY0aC02LjQ1eiIvPjx1c2Ugc3Ryb2tlPSIjRkZGIiBtYXNrPSJ1cmwoI2QpIiB4bGluazpocmVmPSIjYiIgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIvPjwvZz48L3N2Zz4="),Dn=null,Vn=null,Rn=function(){function v(e,t){u(this,v),this.indoorMapObjects_=null,this.outdoorMapObjects_=null,this.createRouteObjects_(e,t)}return l(v,[{key:"createRouteObjects_",value:function(e,t){var c=this,e=e.sections,h=void 0===e?[]:e,d=1<arguments.length&&void 0!==t?t:Ln;this.indoorMapObjects_={},this.outdoorMapObjects_=new H.map.Group;for(var n=function(e){var t=h[e],n=t.departure.place,r=n.id,i=n.type,o=H.util.flexiblePolyline.decode(t.polyline).polyline,a=void 0,s=void 0,n=d(e,h,v.ObjectType.SEGMENT_START_MARKER);n&&(a=new H.map.Marker(t.departure.place.location,{icon:n}));n=d(e,h,v.ObjectType.SEGMENT_FINISH_MARKER);n&&(s=new H.map.Marker(t.arrival.place.location,{icon:n}));var u,l=d(e,h,v.ObjectType.SEGMENT_POLYLINE);"indoor"===i?(i=function(e){var e=0<arguments.length&&void 0!==e?e:[],t=new Map,n=new H.geo.LineString,r=A(e[0],3)[2];return t.set(r,[n]),e.forEach(function(e){e[2]!==r&&(r=e[2],n=new H.geo.LineString,t.has(r)?t.get(r).push(n):t.set(r,[n])),n.pushLatLngAlt.apply(n,L(e))}),t}(o),u=Array.from(i.keys()).reduce(function(e,t){return e[t]||(e[t]=new H.map.Group),e},{}),l&&i.forEach(function(e,t){e.forEach(function(e){1<e.getPointCount()&&(e=new H.map.Polyline(e,{style:l}),u[t].addObject(e))})}),a&&u[t.departure.place.location.lvl].addObject(a),s&&u[t.arrival.place.location.lvl].addObject(s),c.indoorMapObjects_[r]=O(O({},c.indoorMapObjects_[r]||{}),u)):(l&&(o=new H.geo.LineString(o.flatMap(function(e){return[e[0],e[1],0]})),o=new H.map.Polyline(o,{style:l}),c.outdoorMapObjects_.addObject(o)),a&&c.outdoorMapObjects_.addObject(a),s&&c.outdoorMapObjects_.addObject(s))},r=0;r<h.length;r++)n(r)}},{key:"getIndoorObjects",value:function(){return this.indoorMapObjects_}},{key:"getOutdoorObjects",value:function(){return this.outdoorMapObjects_}}]),v}();Rn.ObjectType={SEGMENT_START_MARKER:1,SEGMENT_FINISH_MARKER:2,SEGMENT_POLYLINE:3};var Gn=function(){h(a,H.service.Service);var o=p(a);function a(e){var t;u(this,a),t=o.call(this,a,e);var n={apiKey:e.apikey,baseUrl:e.baseUrl&&e.baseUrl.getHost(),token:e.token},r={apiKey:n.apiKey,token:n.token};n.apiKey||(n.apiKey=t.getUrl().getQuery().apikey);var i=e.useLegacy||!1;return t.venueService_=new En(n,i),r.apiKey||(r.apiKey=t.getUrl().getQuery().apikey),e.routingBaseUrl&&(r.baseUrl=e.routingBaseUrl),t.routingService_=new On(r),t}return l(a,[{key:"loadVenue",value:function(e,t){t=1<arguments.length&&void 0!==t?t:{};return this.venueService_.load(e,t).then(function(e){return new An(e)})}},{key:"calculateRoute",value:function(e){return this.routingService_.calculateRoute(e)}}]),a}();Gn.CONFIG_KEY="venues",H.service.Platform.prototype.getVenuesService=function(e){return this.createService(Gn,e)};zt=function(){h(i,H.ui.Control);var r=p(i);function i(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return u(this,i),(t=r.call(this)).provider_=null,t.levelSelectorUI_=null,t.setAlignment(n&&n.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),t.addClass("venues-ui"),e instanceof An&&t.setVenue(e),t}return l(i,[{key:"renderInternal",value:function(e,t){y(d(i.prototype),"renderInternal",this).call(this,e,t),this.createLevelSelectorUI_(e),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(e){e instanceof An&&(this.removeEventListeners_(),this.venue=e,this.provider_=e.getParentEventTarget(),this.update_(),this.addEventListeners_())}},{key:"createLevelSelectorUI_",value:function(e){var t=this;e.innerHTML="",this.levelSelectorUI_=null;this.levelSelectorUI_=new ct(e,null,null,function(e){return t.venue.setActiveLevelIndex(e)})}},{key:"update_",value:function(){var e,t;this.levelSelectorUI_&&(e=this.venue.getActiveDrawing().getData(),t=this.venue.getData().getDisplaySettings(),this.levelSelectorUI_.update(e,t),this.levelChangeHandler_())}},{key:"addEventListeners_",value:function(){this.venue&&(this.venue.addEventListener(An.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.addEventListener(An.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.addEventListener(An.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&(this.venue.removeEventListener(An.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.removeEventListener(An.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.removeEventListener(An.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"levelChangeHandler_",value:function(){this.levelSelectorUI_.switch(this.venue.getActiveLevelIndex())}},{key:"drawingChangeHandler_",value:function(){this.update_()}},{key:"activeVenueChangeHandler_",value:function(e){this.setVenue(e.newValue)}}]),i}(),Ye=function(){h(i,H.ui.Control);var r=p(i);function i(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return u(this,i),(t=r.call(this)).provider_=null,t.drawingSelectorUI_=null,t.addClass("venues-ui"),t.setAlignment(n&&n.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),e instanceof An&&t.setVenue(e),t}return l(i,[{key:"renderInternal",value:function(e,t){y(d(i.prototype),"renderInternal",this).call(this,e,t),this.createDrawingSelectorUI_(e),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(e){e instanceof An&&(this.removeEventListeners_(),this.venue=e,this.provider_=e.getParentEventTarget(),this.drawingSelectorUI_&&this.drawingSelectorUI_.update(e.getData()),this.addEventListeners_())}},{key:"createDrawingSelectorUI_",value:function(e){var t=this;e.innerHTML="",this.drawingSelectorUI_=null,this.drawingSelectorUI_=new rt(e,null,function(e){return t.venue.setActiveDrawing(e)})}},{key:"addEventListeners_",value:function(){this.venue&&this.venue.addEventListener(An.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.addEventListener(An.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&this.venue.removeEventListener(An.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.removeEventListener(An.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"drawingChangeHandler_",value:function(){this.drawingSelectorUI_.switch(this.venue.getActiveDrawing().id)}},{key:"activeVenueChangeHandler_",value:function(e){this.setVenue(e.newValue)}}]),i}(),zt=Object.freeze({__proto__:null,DrawingControl:Ye,LevelControl:zt});return t(".venues-ui * {\n  font-family: 'Fira Sans', 'Helvetica Neue', Helvetica, sans-serif;\n  color: #0F1621; }\n\n.venues-ui .arrow {\n  display: block;\n  width: 100%;\n  height: 100%;\n  background-repeat: no-repeat;\n  background-position: center; }\n  .venues-ui .arrow--up {\n    background-image: url(\"data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-426.000000, -584.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls-Copy' transform='translate(417.753906, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(15.000000, 16.499023) rotate(-180.000000) translate(-15.000000, -16.499023) translate(9.000000, 12.749023)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E\"); }\n  .venues-ui .arrow--down {\n    background-image: url(\"data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-347.000000, -704.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls' transform='translate(338.251953, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(9.000000, 132.746094)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E\"); }\n\n.venues-ui .venues-ui-button {\n  display: block;\n  width: 40px;\n  height: 40px;\n  line-height: 40px;\n  font-size: 16px;\n  font-weight: 600;\n  background-color: #fff;\n  border: none;\n  border-bottom: 1px solid #9FA2A6;\n  cursor: pointer;\n  overflow: hidden;\n  color: #6e737a;\n  text-align: center;\n  text-overflow: ellipsis;\n  white-space: nowrap; }\n  .venues-ui .venues-ui-button:hover, .venues-ui .venues-ui-button--active {\n    background-color: #f0f0f0;\n    color: #0F1621; }\n\n@keyframes fade {\n  0% {\n    opacity: 0; }\n  100% {\n    opacity: 1; } }\n\n.venues-ui__drawings .drawings {\n  position: absolute;\n  top: 0;\n  right: 45px;\n  display: none;\n  opacity: 0;\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6); }\n  .venues-ui__drawings .drawings--open {\n    display: block;\n    opacity: 1;\n    animation: fade 1s; }\n  .venues-ui__drawings .drawings .venues-ui-button {\n    width: auto;\n    padding: 0 10px; }\n    .venues-ui__drawings .drawings .venues-ui-button:first-of-type {\n      border-top-left-radius: 5px;\n      border-top-right-radius: 5px; }\n    .venues-ui__drawings .drawings .venues-ui-button:last-of-type {\n      border-bottom-left-radius: 5px;\n      border-bottom-right-radius: 5px; }\n\n.venues-ui__drawings .trigger {\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6); }\n  .venues-ui__drawings .trigger .arrow {\n    transform: rotate(0);\n    transition: 0.4s; }\n  .venues-ui__drawings .trigger.venues-ui-button--active .arrow {\n    transform: rotate(90deg);\n    transition: 0.4s; }\n\n.venues-ui__levels {\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6); }\n  .venues-ui__levels .levels {\n    overflow: hidden; }\n  .venues-ui__levels .venues-ui-button--up + .levels .venues-ui-button {\n    border-radius: 0; }\n  .venues-ui__levels .venues-ui-button:first-of-type {\n    border-top-left-radius: 5px;\n    border-top-right-radius: 5px; }\n  .venues-ui__levels .venues-ui-button:last-of-type {\n    border-bottom-left-radius: 5px;\n    border-bottom-right-radius: 5px; }\n  .venues-ui__levels .venues-ui-button[disabled=disabled] .arrow {\n    opacity: 0.5; }\n\n.venues-ui__directory {\n  position: absolute;\n  top: 10px;\n  right: 60px;\n  bottom: calc(100% - 45px);\n  width: 350px;\n  overflow: hidden;\n  background: white;\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6); }\n  .venues-ui__directory.active {\n    bottom: 10px; }\n  .venues-ui__directory .directory__list {\n    top: 80px;\n    bottom: 20px;\n    position: absolute;\n    overflow-y: scroll;\n    right: 10px;\n    left: 10px;\n    font-size: 12px; }\n    .venues-ui__directory .directory__list svg {\n      width: 25px;\n      height: 25px; }\n  .venues-ui__directory .directory__heading {\n    margin: 8px;\n    font-size: 15px;\n    font-weight: normal;\n    cursor: pointer; }\n  .venues-ui__directory .directory__input {\n    margin: 10px; }\n    .venues-ui__directory .directory__input input {\n      width: 100%;\n      padding: 5px 0; }\n  .venues-ui__directory .directory__trigger {\n    position: absolute;\n    right: 10px;\n    top: 15px;\n    width: 10px;\n    height: 10px; }\n    .venues-ui__directory .directory__trigger .arrow {\n      transform: rotate(0);\n      transition: 0.4s; }\n    .venues-ui__directory .directory__trigger--active .arrow {\n      transform: rotate(-180deg);\n      transition: 0.4s; }\n"),e.Drawing=_,e.Geometry=I,e.Level=E,e.Provider=Ft,e.Route=Rn,e.Service=Gn,e.Venue=An,e.ui=zt,Object.defineProperty(e,"__esModule",{value:!0}),e}({});

H.__harp_worker_decoders__="!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=56)}([function(e,t,n){\"use strict\";n.r(t),n.d(t,\"ACESFilmicToneMapping\",(function(){return ne})),n.d(t,\"AddEquation\",(function(){return T})),n.d(t,\"AddOperation\",(function(){return K})),n.d(t,\"AdditiveAnimationBlendMode\",(function(){return qt})),n.d(t,\"AdditiveBlending\",(function(){return b})),n.d(t,\"AlphaFormat\",(function(){return ze})),n.d(t,\"AlwaysDepth\",(function(){return V})),n.d(t,\"AlwaysStencilFunc\",(function(){return Sn})),n.d(t,\"AmbientLight\",(function(){return Ih})),n.d(t,\"AmbientLightProbe\",(function(){return ed})),n.d(t,\"AnimationClip\",(function(){return Ou})),n.d(t,\"AnimationLoader\",(function(){return ku})),n.d(t,\"AnimationMixer\",(function(){return Cd})),n.d(t,\"AnimationObjectGroup\",(function(){return Ad})),n.d(t,\"AnimationUtils\",(function(){return _u})),n.d(t,\"ArcCurve\",(function(){return Zu})),n.d(t,\"ArrayCamera\",(function(){return qa})),n.d(t,\"ArrowHelper\",(function(){return xp})),n.d(t,\"Audio\",(function(){return hd})),n.d(t,\"AudioAnalyser\",(function(){return vd})),n.d(t,\"AudioContext\",(function(){return Kh})),n.d(t,\"AudioListener\",(function(){return ud})),n.d(t,\"AudioLoader\",(function(){return $h})),n.d(t,\"AxesHelper\",(function(){return _p})),n.d(t,\"AxisHelper\",(function(){return _f})),n.d(t,\"BackSide\",(function(){return m})),n.d(t,\"BasicDepthPacking\",(function(){return on})),n.d(t,\"BasicShadowMap\",(function(){return u})),n.d(t,\"BinaryTextureLoader\",(function(){return Tf})),n.d(t,\"Bone\",(function(){return Rl})),n.d(t,\"BooleanKeyframeTrack\",(function(){return Eu})),n.d(t,\"BoundingBoxHelper\",(function(){return bf})),n.d(t,\"Box2\",(function(){return Ud})),n.d(t,\"Box3\",(function(){return ur})),n.d(t,\"Box3Helper\",(function(){return fp})),n.d(t,\"BoxBufferGeometry\",(function(){return To})),n.d(t,\"BoxGeometry\",(function(){return To})),n.d(t,\"BoxHelper\",(function(){return pp})),n.d(t,\"BufferAttribute\",(function(){return Bi})),n.d(t,\"BufferGeometry\",(function(){return io})),n.d(t,\"BufferGeometryLoader\",(function(){return Uh})),n.d(t,\"ByteType\",(function(){return Te})),n.d(t,\"Cache\",(function(){return Nu})),n.d(t,\"Camera\",(function(){return Co})),n.d(t,\"CameraHelper\",(function(){return up})),n.d(t,\"CanvasRenderer\",(function(){return Lf})),n.d(t,\"CanvasTexture\",(function(){return ac})),n.d(t,\"CatmullRomCurve3\",(function(){return th})),n.d(t,\"CineonToneMapping\",(function(){return te})),n.d(t,\"CircleBufferGeometry\",(function(){return cc})),n.d(t,\"CircleGeometry\",(function(){return cc})),n.d(t,\"ClampToEdgeWrapping\",(function(){return de})),n.d(t,\"Clock\",(function(){return id})),n.d(t,\"Color\",(function(){return Oi})),n.d(t,\"ColorKeyframeTrack\",(function(){return Lu})),n.d(t,\"CompressedTexture\",(function(){return sc})),n.d(t,\"CompressedTextureLoader\",(function(){return Vu})),n.d(t,\"ConeBufferGeometry\",(function(){return hc})),n.d(t,\"ConeGeometry\",(function(){return hc})),n.d(t,\"CubeCamera\",(function(){return Io})),n.d(t,\"CubeReflectionMapping\",(function(){return oe})),n.d(t,\"CubeRefractionMapping\",(function(){return se})),n.d(t,\"CubeTexture\",(function(){return Oo})),n.d(t,\"CubeTextureLoader\",(function(){return ju})),n.d(t,\"CubeUVReflectionMapping\",(function(){return ce})),n.d(t,\"CubeUVRefractionMapping\",(function(){return ue})),n.d(t,\"CubicBezierCurve\",(function(){return oh})),n.d(t,\"CubicBezierCurve3\",(function(){return sh})),n.d(t,\"CubicInterpolant\",(function(){return wu})),n.d(t,\"CullFaceBack\",(function(){return a})),n.d(t,\"CullFaceFront\",(function(){return l})),n.d(t,\"CullFaceFrontBack\",(function(){return c})),n.d(t,\"CullFaceNone\",(function(){return s})),n.d(t,\"Curve\",(function(){return Xu})),n.d(t,\"CurvePath\",(function(){return ph})),n.d(t,\"CustomBlending\",(function(){return S})),n.d(t,\"CustomToneMapping\",(function(){return re})),n.d(t,\"CylinderBufferGeometry\",(function(){return uc})),n.d(t,\"CylinderGeometry\",(function(){return uc})),n.d(t,\"Cylindrical\",(function(){return Fd})),n.d(t,\"DataTexture\",(function(){return Il})),n.d(t,\"DataTexture2DArray\",(function(){return is})),n.d(t,\"DataTexture3D\",(function(){return os})),n.d(t,\"DataTextureLoader\",(function(){return Wu})),n.d(t,\"DataUtils\",(function(){return Mp})),n.d(t,\"DecrementStencilOp\",(function(){return pn})),n.d(t,\"DecrementWrapStencilOp\",(function(){return mn})),n.d(t,\"DefaultLoadingManager\",(function(){return Bu})),n.d(t,\"DepthFormat\",(function(){return Ve})),n.d(t,\"DepthStencilFormat\",(function(){return He})),n.d(t,\"DepthTexture\",(function(){return lc})),n.d(t,\"DirectionalLight\",(function(){return Rh})),n.d(t,\"DirectionalLightHelper\",(function(){return ap})),n.d(t,\"DiscreteInterpolant\",(function(){return Su})),n.d(t,\"DodecahedronBufferGeometry\",(function(){return pc})),n.d(t,\"DodecahedronGeometry\",(function(){return pc})),n.d(t,\"DoubleSide\",(function(){return g})),n.d(t,\"DstAlphaFactor\",(function(){return z})),n.d(t,\"DstColorFactor\",(function(){return F})),n.d(t,\"DynamicBufferAttribute\",(function(){return uf})),n.d(t,\"DynamicCopyUsage\",(function(){return In})),n.d(t,\"DynamicDrawUsage\",(function(){return En})),n.d(t,\"DynamicReadUsage\",(function(){return Pn})),n.d(t,\"EdgesGeometry\",(function(){return yc})),n.d(t,\"EdgesHelper\",(function(){return wf})),n.d(t,\"EllipseCurve\",(function(){return Yu})),n.d(t,\"EqualDepth\",(function(){return W})),n.d(t,\"EqualStencilFunc\",(function(){return xn})),n.d(t,\"EquirectangularReflectionMapping\",(function(){return ae})),n.d(t,\"EquirectangularRefractionMapping\",(function(){return le})),n.d(t,\"Euler\",(function(){return Yr})),n.d(t,\"EventDispatcher\",(function(){return zn})),n.d(t,\"ExtrudeBufferGeometry\",(function(){return Xc})),n.d(t,\"ExtrudeGeometry\",(function(){return Xc})),n.d(t,\"FaceColors\",(function(){return $p})),n.d(t,\"FileLoader\",(function(){return Uu})),n.d(t,\"FlatShading\",(function(){return v})),n.d(t,\"Float16BufferAttribute\",(function(){return Wi})),n.d(t,\"Float32Attribute\",(function(){return yf})),n.d(t,\"Float32BufferAttribute\",(function(){return qi})),n.d(t,\"Float64Attribute\",(function(){return xf})),n.d(t,\"Float64BufferAttribute\",(function(){return Xi})),n.d(t,\"FloatType\",(function(){return Ce})),n.d(t,\"Fog\",(function(){return tl})),n.d(t,\"FogExp2\",(function(){return el})),n.d(t,\"Font\",(function(){return Xh})),n.d(t,\"FontLoader\",(function(){return Zh})),n.d(t,\"FrontSide\",(function(){return f})),n.d(t,\"Frustum\",(function(){return Bo})),n.d(t,\"GLBufferAttribute\",(function(){return Od})),n.d(t,\"GLSL1\",(function(){return Dn})),n.d(t,\"GLSL3\",(function(){return Nn})),n.d(t,\"GammaEncoding\",(function(){return $t})),n.d(t,\"GreaterDepth\",(function(){return X})),n.d(t,\"GreaterEqualDepth\",(function(){return q})),n.d(t,\"GreaterEqualStencilFunc\",(function(){return Mn})),n.d(t,\"GreaterStencilFunc\",(function(){return bn})),n.d(t,\"GridHelper\",(function(){return np})),n.d(t,\"Group\",(function(){return Xa})),n.d(t,\"HalfFloatType\",(function(){return Re})),n.d(t,\"HemisphereLight\",(function(){return vh})),n.d(t,\"HemisphereLightHelper\",(function(){return tp})),n.d(t,\"HemisphereLightProbe\",(function(){return Qh})),n.d(t,\"IcosahedronBufferGeometry\",(function(){return Zc})),n.d(t,\"IcosahedronGeometry\",(function(){return Zc})),n.d(t,\"ImageBitmapLoader\",(function(){return Wh})),n.d(t,\"ImageLoader\",(function(){return Hu})),n.d(t,\"ImageUtils\",(function(){return $n})),n.d(t,\"ImmediateRenderObject\",(function(){return jd})),n.d(t,\"IncrementStencilOp\",(function(){return dn})),n.d(t,\"IncrementWrapStencilOp\",(function(){return fn})),n.d(t,\"InstancedBufferAttribute\",(function(){return Gh})),n.d(t,\"InstancedBufferGeometry\",(function(){return Fh})),n.d(t,\"InstancedInterleavedBuffer\",(function(){return Id})),n.d(t,\"InstancedMesh\",(function(){return Ul})),n.d(t,\"Int16Attribute\",(function(){return ff})),n.d(t,\"Int16BufferAttribute\",(function(){return ki})),n.d(t,\"Int32Attribute\",(function(){return gf})),n.d(t,\"Int32BufferAttribute\",(function(){return Hi})),n.d(t,\"Int8Attribute\",(function(){return hf})),n.d(t,\"Int8BufferAttribute\",(function(){return Fi})),n.d(t,\"IntType\",(function(){return Ae})),n.d(t,\"InterleavedBuffer\",(function(){return rl})),n.d(t,\"InterleavedBufferAttribute\",(function(){return ol})),n.d(t,\"Interpolant\",(function(){return bu})),n.d(t,\"InterpolateDiscrete\",(function(){return Gt})),n.d(t,\"InterpolateLinear\",(function(){return Ut})),n.d(t,\"InterpolateSmooth\",(function(){return kt})),n.d(t,\"InvertStencilOp\",(function(){return gn})),n.d(t,\"JSONLoader\",(function(){return Af})),n.d(t,\"KeepStencilOp\",(function(){return un})),n.d(t,\"KeyframeTrack\",(function(){return Tu})),n.d(t,\"LOD\",(function(){return Sl})),n.d(t,\"LatheBufferGeometry\",(function(){return Jc})),n.d(t,\"LatheGeometry\",(function(){return Jc})),n.d(t,\"Layers\",(function(){return Zr})),n.d(t,\"LensFlare\",(function(){return Cf})),n.d(t,\"LessDepth\",(function(){return H})),n.d(t,\"LessEqualDepth\",(function(){return j})),n.d(t,\"LessEqualStencilFunc\",(function(){return _n})),n.d(t,\"LessStencilFunc\",(function(){return yn})),n.d(t,\"Light\",(function(){return gh})),n.d(t,\"LightProbe\",(function(){return Nh})),n.d(t,\"Line\",(function(){return Xl})),n.d(t,\"Line3\",(function(){return Hd})),n.d(t,\"LineBasicMaterial\",(function(){return kl})),n.d(t,\"LineCurve\",(function(){return ah})),n.d(t,\"LineCurve3\",(function(){return lh})),n.d(t,\"LineDashedMaterial\",(function(){return yu})),n.d(t,\"LineLoop\",(function(){return Kl})),n.d(t,\"LinePieces\",(function(){return Jp})),n.d(t,\"LineSegments\",(function(){return Jl})),n.d(t,\"LineStrip\",(function(){return Zp})),n.d(t,\"LinearEncoding\",(function(){return Jt})),n.d(t,\"LinearFilter\",(function(){return xe})),n.d(t,\"LinearInterpolant\",(function(){return Mu})),n.d(t,\"LinearMipMapLinearFilter\",(function(){return Me})),n.d(t,\"LinearMipMapNearestFilter\",(function(){return be})),n.d(t,\"LinearMipmapLinearFilter\",(function(){return we})),n.d(t,\"LinearMipmapNearestFilter\",(function(){return _e})),n.d(t,\"LinearToneMapping\",(function(){return Q})),n.d(t,\"Loader\",(function(){return Fu})),n.d(t,\"LoaderUtils\",(function(){return Bh})),n.d(t,\"LoadingManager\",(function(){return zu})),n.d(t,\"LogLuvEncoding\",(function(){return en})),n.d(t,\"LoopOnce\",(function(){return zt})),n.d(t,\"LoopPingPong\",(function(){return Ft})),n.d(t,\"LoopRepeat\",(function(){return Bt})),n.d(t,\"LuminanceAlphaFormat\",(function(){return Ue})),n.d(t,\"LuminanceFormat\",(function(){return Ge})),n.d(t,\"MOUSE\",(function(){return i})),n.d(t,\"Material\",(function(){return Ei})),n.d(t,\"MaterialLoader\",(function(){return zh})),n.d(t,\"Math\",(function(){return Yn})),n.d(t,\"MathUtils\",(function(){return Yn})),n.d(t,\"Matrix3\",(function(){return Jn})),n.d(t,\"Matrix4\",(function(){return Fr})),n.d(t,\"MaxEquation\",(function(){return P})),n.d(t,\"Mesh\",(function(){return Mo})),n.d(t,\"MeshBasicMaterial\",(function(){return Di})),n.d(t,\"MeshDepthMaterial\",(function(){return Ua})),n.d(t,\"MeshDistanceMaterial\",(function(){return ka})),n.d(t,\"MeshFaceMaterial\",(function(){return ef})),n.d(t,\"MeshLambertMaterial\",(function(){return gu})),n.d(t,\"MeshMatcapMaterial\",(function(){return vu})),n.d(t,\"MeshNormalMaterial\",(function(){return mu})),n.d(t,\"MeshPhongMaterial\",(function(){return pu})),n.d(t,\"MeshPhysicalMaterial\",(function(){return du})),n.d(t,\"MeshStandardMaterial\",(function(){return hu})),n.d(t,\"MeshToonMaterial\",(function(){return fu})),n.d(t,\"MinEquation\",(function(){return A})),n.d(t,\"MirroredRepeatWrapping\",(function(){return pe})),n.d(t,\"MixOperation\",(function(){return J})),n.d(t,\"MultiMaterial\",(function(){return tf})),n.d(t,\"MultiplyBlending\",(function(){return M})),n.d(t,\"MultiplyOperation\",(function(){return Z})),n.d(t,\"NearestFilter\",(function(){return fe})),n.d(t,\"NearestMipMapLinearFilter\",(function(){return ye})),n.d(t,\"NearestMipMapNearestFilter\",(function(){return ge})),n.d(t,\"NearestMipmapLinearFilter\",(function(){return ve})),n.d(t,\"NearestMipmapNearestFilter\",(function(){return me})),n.d(t,\"NeverDepth\",(function(){return k})),n.d(t,\"NeverStencilFunc\",(function(){return vn})),n.d(t,\"NoBlending\",(function(){return x})),n.d(t,\"NoColors\",(function(){return Kp})),n.d(t,\"NoToneMapping\",(function(){return $})),n.d(t,\"NormalAnimationBlendMode\",(function(){return Wt})),n.d(t,\"NormalBlending\",(function(){return _})),n.d(t,\"NotEqualDepth\",(function(){return Y})),n.d(t,\"NotEqualStencilFunc\",(function(){return wn})),n.d(t,\"NumberKeyframeTrack\",(function(){return Au})),n.d(t,\"Object3D\",(function(){return ci})),n.d(t,\"ObjectLoader\",(function(){return kh})),n.d(t,\"ObjectSpaceNormalMap\",(function(){return ln})),n.d(t,\"OctahedronBufferGeometry\",(function(){return Kc})),n.d(t,\"OctahedronGeometry\",(function(){return Kc})),n.d(t,\"OneFactor\",(function(){return R})),n.d(t,\"OneMinusDstAlphaFactor\",(function(){return B})),n.d(t,\"OneMinusDstColorFactor\",(function(){return G})),n.d(t,\"OneMinusSrcAlphaFactor\",(function(){return N})),n.d(t,\"OneMinusSrcColorFactor\",(function(){return O})),n.d(t,\"OrthographicCamera\",(function(){return Ph})),n.d(t,\"PCFShadowMap\",(function(){return h})),n.d(t,\"PCFSoftShadowMap\",(function(){return d})),n.d(t,\"PMREMGenerator\",(function(){return Up})),n.d(t,\"ParametricBufferGeometry\",(function(){return $c})),n.d(t,\"ParametricGeometry\",(function(){return $c})),n.d(t,\"Particle\",(function(){return rf})),n.d(t,\"ParticleBasicMaterial\",(function(){return af})),n.d(t,\"ParticleSystem\",(function(){return of})),n.d(t,\"ParticleSystemMaterial\",(function(){return lf})),n.d(t,\"Path\",(function(){return fh})),n.d(t,\"PerspectiveCamera\",(function(){return Ro})),n.d(t,\"Plane\",(function(){return pi})),n.d(t,\"PlaneBufferGeometry\",(function(){return Uo})),n.d(t,\"PlaneGeometry\",(function(){return Uo})),n.d(t,\"PlaneHelper\",(function(){return mp})),n.d(t,\"PointCloud\",(function(){return nf})),n.d(t,\"PointCloudMaterial\",(function(){return sf})),n.d(t,\"PointLight\",(function(){return Ah})),n.d(t,\"PointLightHelper\",(function(){return Kd})),n.d(t,\"Points\",(function(){return rc})),n.d(t,\"PointsMaterial\",(function(){return $l})),n.d(t,\"PolarGridHelper\",(function(){return rp})),n.d(t,\"PolyhedronBufferGeometry\",(function(){return dc})),n.d(t,\"PolyhedronGeometry\",(function(){return dc})),n.d(t,\"PositionalAudio\",(function(){return gd})),n.d(t,\"PropertyBinding\",(function(){return Ld})),n.d(t,\"PropertyMixer\",(function(){return yd})),n.d(t,\"QuadraticBezierCurve\",(function(){return ch})),n.d(t,\"QuadraticBezierCurve3\",(function(){return uh})),n.d(t,\"Quaternion\",(function(){return sr})),n.d(t,\"QuaternionKeyframeTrack\",(function(){return Cu})),n.d(t,\"QuaternionLinearInterpolant\",(function(){return Pu})),n.d(t,\"REVISION\",(function(){return r})),n.d(t,\"RGBADepthPacking\",(function(){return sn})),n.d(t,\"RGBAFormat\",(function(){return Fe})),n.d(t,\"RGBAIntegerFormat\",(function(){return Ze})),n.d(t,\"RGBA_ASTC_10x10_Format\",(function(){return yt})),n.d(t,\"RGBA_ASTC_10x5_Format\",(function(){return mt})),n.d(t,\"RGBA_ASTC_10x6_Format\",(function(){return gt})),n.d(t,\"RGBA_ASTC_10x8_Format\",(function(){return vt})),n.d(t,\"RGBA_ASTC_12x10_Format\",(function(){return xt})),n.d(t,\"RGBA_ASTC_12x12_Format\",(function(){return _t})),n.d(t,\"RGBA_ASTC_4x4_Format\",(function(){return at})),n.d(t,\"RGBA_ASTC_5x4_Format\",(function(){return lt})),n.d(t,\"RGBA_ASTC_5x5_Format\",(function(){return ct})),n.d(t,\"RGBA_ASTC_6x5_Format\",(function(){return ut})),n.d(t,\"RGBA_ASTC_6x6_Format\",(function(){return ht})),n.d(t,\"RGBA_ASTC_8x5_Format\",(function(){return dt})),n.d(t,\"RGBA_ASTC_8x6_Format\",(function(){return pt})),n.d(t,\"RGBA_ASTC_8x8_Format\",(function(){return ft})),n.d(t,\"RGBA_BPTC_Format\",(function(){return bt})),n.d(t,\"RGBA_ETC2_EAC_Format\",(function(){return st})),n.d(t,\"RGBA_PVRTC_2BPPV1_Format\",(function(){return rt})),n.d(t,\"RGBA_PVRTC_4BPPV1_Format\",(function(){return nt})),n.d(t,\"RGBA_S3TC_DXT1_Format\",(function(){return Ke})),n.d(t,\"RGBA_S3TC_DXT3_Format\",(function(){return $e})),n.d(t,\"RGBA_S3TC_DXT5_Format\",(function(){return Qe})),n.d(t,\"RGBDEncoding\",(function(){return rn})),n.d(t,\"RGBEEncoding\",(function(){return Qt})),n.d(t,\"RGBEFormat\",(function(){return ke})),n.d(t,\"RGBFormat\",(function(){return Be})),n.d(t,\"RGBIntegerFormat\",(function(){return Ye})),n.d(t,\"RGBM16Encoding\",(function(){return nn})),n.d(t,\"RGBM7Encoding\",(function(){return tn})),n.d(t,\"RGB_ETC1_Format\",(function(){return it})),n.d(t,\"RGB_ETC2_Format\",(function(){return ot})),n.d(t,\"RGB_PVRTC_2BPPV1_Format\",(function(){return tt})),n.d(t,\"RGB_PVRTC_4BPPV1_Format\",(function(){return et})),n.d(t,\"RGB_S3TC_DXT1_Format\",(function(){return Je})),n.d(t,\"RGFormat\",(function(){return qe})),n.d(t,\"RGIntegerFormat\",(function(){return Xe})),n.d(t,\"RawShaderMaterial\",(function(){return uu})),n.d(t,\"Ray\",(function(){return Br})),n.d(t,\"Raycaster\",(function(){return Dd})),n.d(t,\"RectAreaLight\",(function(){return Oh})),n.d(t,\"RedFormat\",(function(){return je})),n.d(t,\"RedIntegerFormat\",(function(){return We})),n.d(t,\"ReinhardToneMapping\",(function(){return ee})),n.d(t,\"RepeatWrapping\",(function(){return he})),n.d(t,\"ReplaceStencilOp\",(function(){return hn})),n.d(t,\"ReverseSubtractEquation\",(function(){return L})),n.d(t,\"RingBufferGeometry\",(function(){return Qc})),n.d(t,\"RingGeometry\",(function(){return Qc})),n.d(t,\"SRGB8_ALPHA8_ASTC_10x10_Format\",(function(){return Ot})),n.d(t,\"SRGB8_ALPHA8_ASTC_10x5_Format\",(function(){return Ct})),n.d(t,\"SRGB8_ALPHA8_ASTC_10x6_Format\",(function(){return Rt})),n.d(t,\"SRGB8_ALPHA8_ASTC_10x8_Format\",(function(){return It})),n.d(t,\"SRGB8_ALPHA8_ASTC_12x10_Format\",(function(){return Dt})),n.d(t,\"SRGB8_ALPHA8_ASTC_12x12_Format\",(function(){return Nt})),n.d(t,\"SRGB8_ALPHA8_ASTC_4x4_Format\",(function(){return wt})),n.d(t,\"SRGB8_ALPHA8_ASTC_5x4_Format\",(function(){return Mt})),n.d(t,\"SRGB8_ALPHA8_ASTC_5x5_Format\",(function(){return St})),n.d(t,\"SRGB8_ALPHA8_ASTC_6x5_Format\",(function(){return Tt})),n.d(t,\"SRGB8_ALPHA8_ASTC_6x6_Format\",(function(){return Et})),n.d(t,\"SRGB8_ALPHA8_ASTC_8x5_Format\",(function(){return Lt})),n.d(t,\"SRGB8_ALPHA8_ASTC_8x6_Format\",(function(){return At})),n.d(t,\"SRGB8_ALPHA8_ASTC_8x8_Format\",(function(){return Pt})),n.d(t,\"Scene\",(function(){return nl})),n.d(t,\"SceneUtils\",(function(){return Pf})),n.d(t,\"ShaderChunk\",(function(){return ko})),n.d(t,\"ShaderLib\",(function(){return Ho})),n.d(t,\"ShaderMaterial\",(function(){return Po})),n.d(t,\"ShadowMaterial\",(function(){return cu})),n.d(t,\"Shape\",(function(){return mh})),n.d(t,\"ShapeBufferGeometry\",(function(){return eu})),n.d(t,\"ShapeGeometry\",(function(){return eu})),n.d(t,\"ShapePath\",(function(){return qh})),n.d(t,\"ShapeUtils\",(function(){return jc})),n.d(t,\"ShortType\",(function(){return Ee})),n.d(t,\"Skeleton\",(function(){return Nl})),n.d(t,\"SkeletonHelper\",(function(){return Jd})),n.d(t,\"SkinnedMesh\",(function(){return Cl})),n.d(t,\"SmoothShading\",(function(){return y})),n.d(t,\"Sphere\",(function(){return Pr})),n.d(t,\"SphereBufferGeometry\",(function(){return tu})),n.d(t,\"SphereGeometry\",(function(){return tu})),n.d(t,\"Spherical\",(function(){return Bd})),n.d(t,\"SphericalHarmonics3\",(function(){return Dh})),n.d(t,\"SplineCurve\",(function(){return hh})),n.d(t,\"SpotLight\",(function(){return Mh})),n.d(t,\"SpotLightHelper\",(function(){return qd})),n.d(t,\"Sprite\",(function(){return _l})),n.d(t,\"SpriteMaterial\",(function(){return sl})),n.d(t,\"SrcAlphaFactor\",(function(){return D})),n.d(t,\"SrcAlphaSaturateFactor\",(function(){return U})),n.d(t,\"SrcColorFactor\",(function(){return I})),n.d(t,\"StaticCopyUsage\",(function(){return Rn})),n.d(t,\"StaticDrawUsage\",(function(){return Tn})),n.d(t,\"StaticReadUsage\",(function(){return An})),n.d(t,\"StereoCamera\",(function(){return rd})),n.d(t,\"StreamCopyUsage\",(function(){return On})),n.d(t,\"StreamDrawUsage\",(function(){return Ln})),n.d(t,\"StreamReadUsage\",(function(){return Cn})),n.d(t,\"StringKeyframeTrack\",(function(){return Ru})),n.d(t,\"SubtractEquation\",(function(){return E})),n.d(t,\"SubtractiveBlending\",(function(){return w})),n.d(t,\"TOUCH\",(function(){return o})),n.d(t,\"TangentSpaceNormalMap\",(function(){return an})),n.d(t,\"TetrahedronBufferGeometry\",(function(){return nu})),n.d(t,\"TetrahedronGeometry\",(function(){return nu})),n.d(t,\"TextBufferGeometry\",(function(){return ru})),n.d(t,\"TextGeometry\",(function(){return ru})),n.d(t,\"Texture\",(function(){return er})),n.d(t,\"TextureLoader\",(function(){return qu})),n.d(t,\"TorusBufferGeometry\",(function(){return iu})),n.d(t,\"TorusGeometry\",(function(){return iu})),n.d(t,\"TorusKnotBufferGeometry\",(function(){return ou})),n.d(t,\"TorusKnotGeometry\",(function(){return ou})),n.d(t,\"Triangle\",(function(){return Si})),n.d(t,\"TriangleFanDrawMode\",(function(){return Zt})),n.d(t,\"TriangleStripDrawMode\",(function(){return Yt})),n.d(t,\"TrianglesDrawMode\",(function(){return Xt})),n.d(t,\"TubeBufferGeometry\",(function(){return su})),n.d(t,\"TubeGeometry\",(function(){return su})),n.d(t,\"UVMapping\",(function(){return ie})),n.d(t,\"Uint16Attribute\",(function(){return mf})),n.d(t,\"Uint16BufferAttribute\",(function(){return Vi})),n.d(t,\"Uint32Attribute\",(function(){return vf})),n.d(t,\"Uint32BufferAttribute\",(function(){return ji})),n.d(t,\"Uint8Attribute\",(function(){return df})),n.d(t,\"Uint8BufferAttribute\",(function(){return Gi})),n.d(t,\"Uint8ClampedAttribute\",(function(){return pf})),n.d(t,\"Uint8ClampedBufferAttribute\",(function(){return Ui})),n.d(t,\"Uniform\",(function(){return Rd})),n.d(t,\"UniformsLib\",(function(){return Vo})),n.d(t,\"UniformsUtils\",(function(){return Ao})),n.d(t,\"UnsignedByteType\",(function(){return Se})),n.d(t,\"UnsignedInt248Type\",(function(){return Ne})),n.d(t,\"UnsignedIntType\",(function(){return Pe})),n.d(t,\"UnsignedShort4444Type\",(function(){return Ie})),n.d(t,\"UnsignedShort5551Type\",(function(){return Oe})),n.d(t,\"UnsignedShort565Type\",(function(){return De})),n.d(t,\"UnsignedShortType\",(function(){return Le})),n.d(t,\"VSMShadowMap\",(function(){return p})),n.d(t,\"Vector2\",(function(){return Zn})),n.d(t,\"Vector3\",(function(){return ar})),n.d(t,\"Vector4\",(function(){return nr})),n.d(t,\"VectorKeyframeTrack\",(function(){return Iu})),n.d(t,\"Vertex\",(function(){return cf})),n.d(t,\"VertexColors\",(function(){return Qp})),n.d(t,\"VideoTexture\",(function(){return oc})),n.d(t,\"WebGL1Renderer\",(function(){return Qa})),n.d(t,\"WebGLCubeRenderTarget\",(function(){return Do})),n.d(t,\"WebGLMultipleRenderTargets\",(function(){return ir})),n.d(t,\"WebGLMultisampleRenderTarget\",(function(){return or})),n.d(t,\"WebGLRenderTarget\",(function(){return rr})),n.d(t,\"WebGLRenderTargetCube\",(function(){return Ef})),n.d(t,\"WebGLRenderer\",(function(){return $a})),n.d(t,\"WebGLUtils\",(function(){return Wa})),n.d(t,\"WireframeGeometry\",(function(){return au})),n.d(t,\"WireframeHelper\",(function(){return Mf})),n.d(t,\"WrapAroundEnding\",(function(){return jt})),n.d(t,\"XHRLoader\",(function(){return Sf})),n.d(t,\"ZeroCurvatureEnding\",(function(){return Vt})),n.d(t,\"ZeroFactor\",(function(){return C})),n.d(t,\"ZeroSlopeEnding\",(function(){return Ht})),n.d(t,\"ZeroStencilOp\",(function(){return cn})),n.d(t,\"sRGBEncoding\",(function(){return Kt}));\n/**\n * @license\n * Copyright 2010-2021 Three.js Authors\n * SPDX-License-Identifier: MIT\n */\nconst r=\"129\",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},o={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},s=0,a=1,l=2,c=3,u=0,h=1,d=2,p=3,f=0,m=1,g=2,v=1,y=2,x=0,_=1,b=2,w=3,M=4,S=5,T=100,E=101,L=102,A=103,P=104,C=200,R=201,I=202,O=203,D=204,N=205,z=206,B=207,F=208,G=209,U=210,k=0,V=1,H=2,j=3,W=4,q=5,X=6,Y=7,Z=0,J=1,K=2,$=0,Q=1,ee=2,te=3,ne=4,re=5,ie=300,oe=301,se=302,ae=303,le=304,ce=306,ue=307,he=1e3,de=1001,pe=1002,fe=1003,me=1004,ge=1004,ve=1005,ye=1005,xe=1006,_e=1007,be=1007,we=1008,Me=1008,Se=1009,Te=1010,Ee=1011,Le=1012,Ae=1013,Pe=1014,Ce=1015,Re=1016,Ie=1017,Oe=1018,De=1019,Ne=1020,ze=1021,Be=1022,Fe=1023,Ge=1024,Ue=1025,ke=Fe,Ve=1026,He=1027,je=1028,We=1029,qe=1030,Xe=1031,Ye=1032,Ze=1033,Je=33776,Ke=33777,$e=33778,Qe=33779,et=35840,tt=35841,nt=35842,rt=35843,it=36196,ot=37492,st=37496,at=37808,lt=37809,ct=37810,ut=37811,ht=37812,dt=37813,pt=37814,ft=37815,mt=37816,gt=37817,vt=37818,yt=37819,xt=37820,_t=37821,bt=36492,wt=37840,Mt=37841,St=37842,Tt=37843,Et=37844,Lt=37845,At=37846,Pt=37847,Ct=37848,Rt=37849,It=37850,Ot=37851,Dt=37852,Nt=37853,zt=2200,Bt=2201,Ft=2202,Gt=2300,Ut=2301,kt=2302,Vt=2400,Ht=2401,jt=2402,Wt=2500,qt=2501,Xt=0,Yt=1,Zt=2,Jt=3e3,Kt=3001,$t=3007,Qt=3002,en=3003,tn=3004,nn=3005,rn=3006,on=3200,sn=3201,an=0,ln=1,cn=0,un=7680,hn=7681,dn=7682,pn=7683,fn=34055,mn=34056,gn=5386,vn=512,yn=513,xn=514,_n=515,bn=516,wn=517,Mn=518,Sn=519,Tn=35044,En=35048,Ln=35040,An=35045,Pn=35049,Cn=35041,Rn=35046,In=35050,On=35042,Dn=\"100\",Nn=\"300 es\";class zn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const Bn=[];for(let e=0;e<256;e++)Bn[e]=(e<16?\"0\":\"\")+e.toString(16);let Fn=1234567;const Gn=Math.PI/180,Un=180/Math.PI;function kn(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Bn[255&e]+Bn[e>>8&255]+Bn[e>>16&255]+Bn[e>>24&255]+\"-\"+Bn[255&t]+Bn[t>>8&255]+\"-\"+Bn[t>>16&15|64]+Bn[t>>24&255]+\"-\"+Bn[63&n|128]+Bn[n>>8&255]+\"-\"+Bn[n>>16&255]+Bn[n>>24&255]+Bn[255&r]+Bn[r>>8&255]+Bn[r>>16&255]+Bn[r>>24&255]).toUpperCase()}function Vn(e,t,n){return Math.max(t,Math.min(n,e))}function Hn(e,t){return(e%t+t)%t}function jn(e,t,n){return(1-n)*e+n*t}function Wn(e){return 0==(e&e-1)&&0!==e}function qn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Xn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Yn=Object.freeze({__proto__:null,DEG2RAD:Gn,RAD2DEG:Un,generateUUID:kn,clamp:Vn,euclideanModulo:Hn,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:jn,damp:function(e,t,n,r){return jn(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(Hn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Fn=e%2147483647),Fn=16807*Fn%2147483647,(Fn-1)/2147483646},degToRad:function(e){return e*Gn},radToDeg:function(e){return e*Un},isPowerOfTwo:Wn,ceilPowerOfTwo:qn,floorPowerOfTwo:Xn,setQuaternionFromProperEuler:function(e,t,n,r,i){const o=Math.cos,s=Math.sin,a=o(n/2),l=s(n/2),c=o((t+r)/2),u=s((t+r)/2),h=o((t-r)/2),d=s((t-r)/2),p=o((r-t)/2),f=s((r-t)/2);switch(i){case\"XYX\":e.set(a*u,l*h,l*d,a*c);break;case\"YZY\":e.set(l*d,a*u,l*h,a*c);break;case\"ZXZ\":e.set(l*h,l*d,a*u,a*c);break;case\"XZX\":e.set(a*u,l*f,l*p,a*c);break;case\"YXY\":e.set(l*p,a*u,l*f,a*c);break;case\"ZYZ\":e.set(l*f,l*p,a*u,a*c);break;default:console.warn(\"THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: \"+i)}}});class Zn{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error(\"index is out of range: \"+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error(\"index is out of range: \"+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn(\"THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn(\"THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn(\"THREE.Vector2: offset has been removed from .fromBufferAttribute().\"),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Zn.prototype.isVector2=!0;class Jn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error(\"THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.\")}set(e,t,n,r,i,o,s,a,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=s,c[3]=t,c[4]=i,c[5]=a,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],x=r[7],_=r[2],b=r[5],w=r[8];return i[0]=o*f+s*v+a*_,i[3]=o*m+s*y+a*b,i[6]=o*g+s*x+a*w,i[1]=l*f+c*v+u*_,i[4]=l*m+c*y+u*b,i[7]=l*g+c*x+u*w,i[2]=h*f+d*v+p*_,i[5]=h*m+d*y+p*b,i[8]=h*g+d*x+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-n*i*c+n*s*a+r*i*l-r*o*a}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=c*o-s*l,h=s*a-c*i,d=l*i-o*a,p=t*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(r*l-c*n)*f,e[2]=(s*n-r*o)*f,e[3]=h*f,e[4]=(c*t-r*a)*f,e[5]=(r*i-s*t)*f,e[6]=d*f,e[7]=(n*a-l*t)*f,e[8]=(o*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,s){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-r*l,r*a,-r*(-l*o+a*s)+s+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],s=r[6],a=r[1],l=r[4],c=r[7];return r[0]=t*i+n*a,r[3]=t*o+n*l,r[6]=t*s+n*c,r[1]=-n*i+t*a,r[4]=-n*o+t*l,r[7]=-n*s+t*c,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let Kn;Jn.prototype.isMatrix3=!0;class $n{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if(\"undefined\"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Kn&&(Kn=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\")),Kn.width=e.width,Kn.height=e.height;const n=Kn.getContext(\"2d\");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Kn}return t.width>2048||t.height>2048?(console.warn(\"THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons\",e),t.toDataURL(\"image/jpeg\",.6)):t.toDataURL(\"image/png\")}}let Qn=0;class er extends zn{constructor(e=er.DEFAULT_IMAGE,t=er.DEFAULT_MAPPING,n=de,r=de,i=xe,o=we,s=Fe,a=Se,l=1,c=Jt){super(),Object.defineProperty(this,\"id\",{value:Qn++}),this.uuid=kn(),this.name=\"\",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new Zn(0,0),this.repeat=new Zn(1,1),this.center=new Zn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Jn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||\"string\"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:\"Texture\",generator:\"Texture.toJSON\"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=kn()),!t&&void 0===e.images[r.uuid]){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(tr(r[e].image)):t.push(tr(r[e]))}else t=tr(r);e.images[r.uuid]={uuid:r.uuid,url:t}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:\"dispose\"})}transformUv(e){if(this.mapping!==ie)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case he:e.x=e.x-Math.floor(e.x);break;case de:e.x=e.x<0?0:1;break;case pe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case he:e.y=e.y-Math.floor(e.y);break;case de:e.y=e.y<0?0:1;break;case pe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function tr(e){return\"undefined\"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||\"undefined\"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||\"undefined\"!=typeof ImageBitmap&&e instanceof ImageBitmap?$n.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn(\"THREE.Texture: Unable to serialize Texture.\"),{})}er.DEFAULT_IMAGE=void 0,er.DEFAULT_MAPPING=ie,er.prototype.isTexture=!0;class nr{constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error(\"index is out of range: \"+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error(\"index is out of range: \"+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn(\"THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn(\"THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const o=e.elements,s=o[0],a=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(s+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const e=(s+1)/2,o=(u+1)/2,m=(f+1)/2,g=(a+c)/4,v=(l+d)/4,y=(h+p)/4;return e>o&&e>m?e<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=g/n,i=v/n):o>m?o<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=g/r,i=y/r):m<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=v/i,r=y/i),this.set(n,r,i,t),this}let m=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(m)<.001&&(m=1),this.x=(p-h)/m,this.y=(l-d)/m,this.z=(c-a)/m,this.w=Math.acos((s+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn(\"THREE.Vector4: offset has been removed from .fromBufferAttribute().\"),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}nr.prototype.isVector4=!0;class rr extends zn{constructor(e,t,n){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new nr(0,0,e,t),this.scissorTest=!1,this.viewport=new nr(0,0,e,t),n=n||{},this.texture=new er(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:xe,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:\"dispose\"})}}rr.prototype.isWebGLRenderTarget=!0;class ir extends rr{constructor(e,t,n){super(e,t);const r=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=r.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}ir.prototype.isWebGLMultipleRenderTargets=!0;class or extends rr{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}or.prototype.isWebGLMultisampleRenderTarget=!0;class sr{constructor(e=0,t=0,n=0,r=1){this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return console.warn(\"THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead.\"),n.slerpQuaternions(e,t,r)}static slerpFlat(e,t,n,r,i,o,s){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(0===s)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==h||l!==d||c!==p){let e=1-s;const t=a*h+l*d+c*p+u*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,t*n);e=Math.sin(e*o)/i,s=Math.sin(s*o)/i}const i=s*n;if(a=a*e+h*i,l=l*e+d*i,c=c*e+p*i,u=u*e+f*i,e===1-s){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,o){const s=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[o],h=i[o+1],d=i[o+2],p=i[o+3];return e[t]=s*p+c*u+a*d-l*h,e[t+1]=a*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-a*u,e[t+3]=c*p-s*u-a*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error(\"THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.\");const n=e._x,r=e._y,i=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(n/2),c=s(r/2),u=s(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(o){case\"XYZ\":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case\"YXZ\":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case\"ZXY\":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case\"ZYX\":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case\"YZX\":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case\"XZY\":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn(\"THREE.Quaternion: .setFromEuler() encountered an unknown order: \"+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],s=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(i-l)*e,this._z=(o-r)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-a)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(i+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(i-l)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-r)/e,this._x=(i+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Vn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn(\"THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.\"),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*s+r*l-i*a,this._y=r*c+o*a+i*s-n*l,this._z=i*c+o*l+n*a-r*s,this._w=o*c-n*s-r*a-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,o=this._w;let s=o*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}sr.prototype.isQuaternion=!0;class ar{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error(\"index is out of range: \"+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error(\"index is out of range: \"+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.\"),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error(\"THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.\"),this.applyQuaternion(cr.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(cr.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*n,c=a*n+s*t-i*r,u=a*r+i*n-o*t,h=-i*t-o*n-s*r;return this.x=l*a+h*-i+c*-s-u*-o,this.y=c*a+h*-o+u*-i-l*-s,this.z=u*a+h*-s+l*-o-c*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.\"),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return lr.copy(this).projectOnVector(e),this.sub(lr)}reflect(e){return this.sub(lr.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Vn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn(\"THREE.Vector3: offset has been removed from .fromBufferAttribute().\"),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}ar.prototype.isVector3=!0;const lr=new ar,cr=new sr;class ur{constructor(e=new ar(1/0,1/0,1/0),t=new ar(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],u=e[a+2];l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>o&&(o=c),u>s&&(s=u)}return this.min.set(t,n,r),this.max.set(i,o,s),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),u=e.getZ(a);l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>o&&(o=c),u>s&&(s=u)}return this.min.set(t,n,r),this.max.set(i,o,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=dr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn(\"THREE.Box3: .getCenter() target is now required\"),e=new ar),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn(\"THREE.Box3: .getSize() target is now required\"),e=new ar),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),pr.copy(t.boundingBox),pr.applyMatrix4(e.matrixWorld),this.union(pr));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn(\"THREE.Box3: .getParameter() target is now required\"),t=new ar),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,dr),dr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(_r),br.subVectors(this.max,_r),fr.subVectors(e.a,_r),mr.subVectors(e.b,_r),gr.subVectors(e.c,_r),vr.subVectors(mr,fr),yr.subVectors(gr,mr),xr.subVectors(fr,gr);let t=[0,-vr.z,vr.y,0,-yr.z,yr.y,0,-xr.z,xr.y,vr.z,0,-vr.x,yr.z,0,-yr.x,xr.z,0,-xr.x,-vr.y,vr.x,0,-yr.y,yr.x,0,-xr.y,xr.x,0];return!!Sr(t,fr,mr,gr,br)&&(t=[1,0,0,0,1,0,0,0,1],!!Sr(t,fr,mr,gr,br)&&(wr.crossVectors(vr,yr),t=[wr.x,wr.y,wr.z],Sr(t,fr,mr,gr,br)))}clampPoint(e,t){return void 0===t&&(console.warn(\"THREE.Box3: .clampPoint() target is now required\"),t=new ar),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return dr.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error(\"THREE.Box3: .getBoundingSphere() target is now required\"),this.getCenter(e.center),e.radius=.5*this.getSize(dr).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(hr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),hr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),hr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),hr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),hr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),hr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),hr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),hr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(hr)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}ur.prototype.isBox3=!0;const hr=[new ar,new ar,new ar,new ar,new ar,new ar,new ar,new ar],dr=new ar,pr=new ur,fr=new ar,mr=new ar,gr=new ar,vr=new ar,yr=new ar,xr=new ar,_r=new ar,br=new ar,wr=new ar,Mr=new ar;function Sr(e,t,n,r,i){for(let o=0,s=e.length-3;o<=s;o+=3){Mr.fromArray(e,o);const s=i.x*Math.abs(Mr.x)+i.y*Math.abs(Mr.y)+i.z*Math.abs(Mr.z),a=t.dot(Mr),l=n.dot(Mr),c=r.dot(Mr);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>s)return!1}return!0}const Tr=new ur,Er=new ar,Lr=new ar,Ar=new ar;class Pr{constructor(e=new ar,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Tr.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn(\"THREE.Sphere: .clampPoint() target is now required\"),t=new ar),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn(\"THREE.Sphere: .getBoundingBox() target is now required\"),e=new ur),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Ar.subVectors(e,this.center);const t=Ar.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(Ar.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return Lr.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Er.copy(e.center).add(Lr)),this.expandByPoint(Er.copy(e.center).sub(Lr)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Cr=new ar,Rr=new ar,Ir=new ar,Or=new ar,Dr=new ar,Nr=new ar,zr=new ar;class Br{constructor(e=new ar,t=new ar(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn(\"THREE.Ray: .at() target is now required\"),t=new ar),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Cr)),this}closestPointToPoint(e,t){void 0===t&&(console.warn(\"THREE.Ray: .closestPointToPoint() target is now required\"),t=new ar),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Cr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Cr.copy(this.direction).multiplyScalar(t).add(this.origin),Cr.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Rr.copy(e).add(t).multiplyScalar(.5),Ir.copy(t).sub(e).normalize(),Or.copy(this.origin).sub(Rr);const i=.5*e.distanceTo(t),o=-this.direction.dot(Ir),s=Or.dot(this.direction),a=-Or.dot(Ir),l=Or.lengthSq(),c=Math.abs(1-o*o);let u,h,d,p;if(c>0)if(u=o*a-s,h=o*s-a,p=i*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+l}else h=i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h=-i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-o*i+s)),h=u>0?-i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+l):(u=Math.max(0,-(o*i+s)),h=u>0?i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+l);else h=o>0?-i:i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(Ir).multiplyScalar(h).add(Rr),d}intersectSphere(e,t){Cr.subVectors(e.center,this.origin);const n=Cr.dot(this.direction),r=Cr.dot(Cr)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,s,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>r?null:((s>n||n!=n)&&(n=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,Cr)}intersectTriangle(e,t,n,r,i){Dr.subVectors(t,e),Nr.subVectors(n,e),zr.crossVectors(Dr,Nr);let o,s=this.direction.dot(zr);if(s>0){if(r)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}Or.subVectors(this.origin,e);const a=o*this.direction.dot(Nr.crossVectors(Or,Nr));if(a<0)return null;const l=o*this.direction.dot(Dr.cross(Or));if(l<0)return null;if(a+l>s)return null;const c=-o*Or.dot(zr);return c<0?null:this.at(c/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Fr{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error(\"THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.\")}set(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Fr).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Gr.setFromMatrixColumn(e,0).length(),i=1/Gr.setFromMatrixColumn(e,1).length(),o=1/Gr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error(\"THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.\");const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if(\"XYZ\"===e.order){const e=o*c,n=o*u,r=s*c,i=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-s*a,t[2]=i-e*l,t[6]=r+n*l,t[10]=o*a}else if(\"YXZ\"===e.order){const e=a*c,n=a*u,r=l*c,i=l*u;t[0]=e+i*s,t[4]=r*s-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=n*s-r,t[6]=i+e*s,t[10]=o*a}else if(\"ZXY\"===e.order){const e=a*c,n=a*u,r=l*c,i=l*u;t[0]=e-i*s,t[4]=-o*u,t[8]=r+n*s,t[1]=n+r*s,t[5]=o*c,t[9]=i-e*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if(\"ZYX\"===e.order){const e=o*c,n=o*u,r=s*c,i=s*u;t[0]=a*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=a*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=s*a,t[10]=o*a}else if(\"YZX\"===e.order){const e=o*a,n=o*l,r=s*a,i=s*l;t[0]=a*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if(\"XZY\"===e.order){const e=o*a,n=o*l,r=s*a,i=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=o*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=s*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(kr,e,Vr)}lookAt(e,t,n){const r=this.elements;return Wr.subVectors(e,t),0===Wr.lengthSq()&&(Wr.z=1),Wr.normalize(),Hr.crossVectors(n,Wr),0===Hr.lengthSq()&&(1===Math.abs(n.z)?Wr.x+=1e-4:Wr.z+=1e-4,Wr.normalize(),Hr.crossVectors(n,Wr)),Hr.normalize(),jr.crossVectors(Wr,Hr),r[0]=Hr.x,r[4]=jr.x,r[8]=Wr.x,r[1]=Hr.y,r[5]=jr.y,r[9]=Wr.y,r[2]=Hr.z,r[6]=jr.z,r[10]=Wr.z,this}multiply(e,t){return void 0!==t?(console.warn(\"THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.\"),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],_=n[15],b=r[0],w=r[4],M=r[8],S=r[12],T=r[1],E=r[5],L=r[9],A=r[13],P=r[2],C=r[6],R=r[10],I=r[14],O=r[3],D=r[7],N=r[11],z=r[15];return i[0]=o*b+s*T+a*P+l*O,i[4]=o*w+s*E+a*C+l*D,i[8]=o*M+s*L+a*R+l*N,i[12]=o*S+s*A+a*I+l*z,i[1]=c*b+u*T+h*P+d*O,i[5]=c*w+u*E+h*C+d*D,i[9]=c*M+u*L+h*R+d*N,i[13]=c*S+u*A+h*I+d*z,i[2]=p*b+f*T+m*P+g*O,i[6]=p*w+f*E+m*C+g*D,i[10]=p*M+f*L+m*R+g*N,i[14]=p*S+f*A+m*I+g*z,i[3]=v*b+y*T+x*P+_*O,i[7]=v*w+y*E+x*C+_*D,i[11]=v*M+y*L+x*R+_*N,i[15]=v*S+y*A+x*I+_*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*a*u-r*l*u-i*s*h+n*l*h+r*s*d-n*a*d)+e[7]*(+t*a*d-t*l*h+i*o*h-r*o*d+r*l*c-i*a*c)+e[11]*(+t*l*u-t*s*d-i*o*u+n*o*d+i*s*c-n*l*c)+e[15]*(-r*s*c-t*a*u+t*s*h+r*o*u-n*o*h+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*h*l+f*a*d-s*m*d-u*a*g+s*h*g,y=p*h*l-c*m*l-p*a*d+o*m*d+c*a*g-o*h*g,x=c*f*l-p*u*l+p*s*d-o*f*d-c*s*g+o*u*g,_=p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m,b=t*v+n*y+r*x+i*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return e[0]=v*w,e[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*w,e[2]=(s*m*i-f*a*i+f*r*l-n*m*l-s*r*g+n*a*g)*w,e[3]=(u*a*i-s*h*i-u*r*l+n*h*l+s*r*d-n*a*d)*w,e[4]=y*w,e[5]=(c*m*i-p*h*i+p*r*d-t*m*d-c*r*g+t*h*g)*w,e[6]=(p*a*i-o*m*i-p*r*l+t*m*l+o*r*g-t*a*g)*w,e[7]=(o*h*i-c*a*i+c*r*l-t*h*l-o*r*d+t*a*d)*w,e[8]=x*w,e[9]=(p*u*i-c*f*i-p*n*d+t*f*d+c*n*g-t*u*g)*w,e[10]=(o*f*i-p*s*i+p*n*l-t*f*l-o*n*g+t*s*g)*w,e[11]=(c*s*i-o*u*i-c*n*l+t*u*l+o*n*d-t*s*d)*w,e[12]=_*w,e[13]=(c*f*r-p*u*r+p*n*h-t*f*h-c*n*m+t*u*m)*w,e[14]=(p*s*r-o*f*r-p*n*a+t*f*a+o*n*m-t*s*m)*w,e[15]=(o*u*r-c*s*r+c*n*a-t*u*a-o*n*h+t*s*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,s=e.y,a=e.z,l=i*o,c=i*s;return this.set(l*o+n,l*s-r*a,l*a+r*s,0,l*s+r*a,c*s+n,c*a-r*o,0,l*a-r*s,c*a+r*o,i*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,o){return this.set(1,n,i,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,s=t._z,a=t._w,l=i+i,c=o+o,u=s+s,h=i*l,d=i*c,p=i*u,f=o*c,m=o*u,g=s*u,v=a*l,y=a*c,x=a*u,_=n.x,b=n.y,w=n.z;return r[0]=(1-(f+g))*_,r[1]=(d+x)*_,r[2]=(p-y)*_,r[3]=0,r[4]=(d-x)*b,r[5]=(1-(h+g))*b,r[6]=(m+v)*b,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=Gr.set(r[0],r[1],r[2]).length();const o=Gr.set(r[4],r[5],r[6]).length(),s=Gr.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Ur.copy(this);const a=1/i,l=1/o,c=1/s;return Ur.elements[0]*=a,Ur.elements[1]*=a,Ur.elements[2]*=a,Ur.elements[4]*=l,Ur.elements[5]*=l,Ur.elements[6]*=l,Ur.elements[8]*=c,Ur.elements[9]*=c,Ur.elements[10]*=c,t.setFromRotationMatrix(Ur),n.x=i,n.y=o,n.z=s,this}makePerspective(e,t,n,r,i,o){void 0===o&&console.warn(\"THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.\");const s=this.elements,a=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),u=(n+r)/(n-r),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,r,i,o){const s=this.elements,a=1/(t-e),l=1/(n-r),c=1/(o-i),u=(t+e)*a,h=(n+r)*l,d=(o+i)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}Fr.prototype.isMatrix4=!0;const Gr=new ar,Ur=new Fr,kr=new ar(0,0,0),Vr=new ar(1,1,1),Hr=new ar,jr=new ar,Wr=new ar,qr=new Fr,Xr=new sr;class Yr{constructor(e=0,t=0,n=0,r=Yr.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const r=e.elements,i=r[0],o=r[4],s=r[8],a=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t=t||this._order){case\"XYZ\":this._y=Math.asin(Vn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(h,l),this._z=0);break;case\"YXZ\":this._x=Math.asin(-Vn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case\"ZXY\":this._x=Math.asin(Vn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,i));break;case\"ZYX\":this._y=Math.asin(-Vn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-o,l));break;case\"YZX\":this._z=Math.asin(Vn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(s,d));break;case\"XZY\":this._z=Math.asin(-Vn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn(\"THREE.Euler: .setFromRotationMatrix() encountered an unknown order: \"+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return qr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qr,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return Xr.setFromEuler(this),this.setFromQuaternion(Xr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new ar(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Yr.prototype.isEuler=!0,Yr.DefaultOrder=\"XYZ\",Yr.RotationOrders=[\"XYZ\",\"YZX\",\"ZXY\",\"XZY\",\"YXZ\",\"ZYX\"];class Zr{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let Jr=0;const Kr=new ar,$r=new sr,Qr=new Fr,ei=new ar,ti=new ar,ni=new ar,ri=new sr,ii=new ar(1,0,0),oi=new ar(0,1,0),si=new ar(0,0,1),ai={type:\"added\"},li={type:\"removed\"};class ci extends zn{constructor(){super(),Object.defineProperty(this,\"id\",{value:Jr++}),this.uuid=kn(),this.name=\"\",this.type=\"Object3D\",this.parent=null,this.children=[],this.up=ci.DefaultUp.clone();const e=new ar,t=new Yr,n=new sr,r=new ar(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Fr},normalMatrix:{value:new Jn}}),this.matrix=new Fr,this.matrixWorld=new Fr,this.matrixAutoUpdate=ci.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Zr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return $r.setFromAxisAngle(e,t),this.quaternion.multiply($r),this}rotateOnWorldAxis(e,t){return $r.setFromAxisAngle(e,t),this.quaternion.premultiply($r),this}rotateX(e){return this.rotateOnAxis(ii,e)}rotateY(e){return this.rotateOnAxis(oi,e)}rotateZ(e){return this.rotateOnAxis(si,e)}translateOnAxis(e,t){return Kr.copy(e).applyQuaternion(this.quaternion),this.position.add(Kr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ii,e)}translateY(e){return this.translateOnAxis(oi,e)}translateZ(e){return this.translateOnAxis(si,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Qr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?ei.copy(e):ei.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),ti.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Qr.lookAt(ti,ei,this.up):Qr.lookAt(ei,ti,this.up),this.quaternion.setFromRotationMatrix(Qr),r&&(Qr.extractRotation(r.matrixWorld),$r.setFromRotationMatrix(Qr),this.quaternion.premultiply($r.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error(\"THREE.Object3D.add: object can't be added as a child of itself.\",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ai)):console.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(li)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(li)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Qr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Qr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Qr),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty(\"id\",e)}getObjectByName(e){return this.getObjectByProperty(\"name\",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getWorldPosition(e){return void 0===e&&(console.warn(\"THREE.Object3D: .getWorldPosition() target is now required\"),e=new ar),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(console.warn(\"THREE.Object3D: .getWorldQuaternion() target is now required\"),e=new sr),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ti,e,ni),e}getWorldScale(e){return void 0===e&&(console.warn(\"THREE.Object3D: .getWorldScale() target is now required\"),e=new ar),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ti,ri,e),e}getWorldDirection(e){void 0===e&&(console.warn(\"THREE.Object3D: .getWorldDirection() target is now required\"),e=new ar),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||\"string\"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:\"Object\",generator:\"Object3D.toJSON\"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,\"\"!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),\"{}\"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type=\"InstancedMesh\",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=o(e.geometries),r=o(e.materials),i=o(e.textures),s=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=r,n;function o(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}ci.DefaultUp=new ar(0,1,0),ci.DefaultMatrixAutoUpdate=!0,ci.prototype.isObject3D=!0;const ui=new ar,hi=new ar,di=new Jn;class pi{constructor(e=new ar(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=ui.subVectors(n,t).cross(hi.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn(\"THREE.Plane: .projectPoint() target is now required\"),t=new ar),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn(\"THREE.Plane: .intersectLine() target is now required\"),t=new ar);const n=e.delta(ui),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(n).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn(\"THREE.Plane: .coplanarPoint() target is now required\"),e=new ar),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||di.getNormalMatrix(e),r=this.coplanarPoint(ui).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}pi.prototype.isPlane=!0;const fi=new ar,mi=new ar,gi=new ar,vi=new ar,yi=new ar,xi=new ar,_i=new ar,bi=new ar,wi=new ar,Mi=new ar;class Si{constructor(e=new ar,t=new ar,n=new ar){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){void 0===r&&(console.warn(\"THREE.Triangle: .getNormal() target is now required\"),r=new ar),r.subVectors(n,t),fi.subVectors(e,t),r.cross(fi);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){fi.subVectors(r,t),mi.subVectors(n,t),gi.subVectors(e,t);const o=fi.dot(fi),s=fi.dot(mi),a=fi.dot(gi),l=mi.dot(mi),c=mi.dot(gi),u=o*l-s*s;if(void 0===i&&(console.warn(\"THREE.Triangle: .getBarycoord() target is now required\"),i=new ar),0===u)return i.set(-2,-1,-1);const h=1/u,d=(l*a-s*c)*h,p=(o*c-s*a)*h;return i.set(1-d-p,p,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,vi),vi.x>=0&&vi.y>=0&&vi.x+vi.y<=1}static getUV(e,t,n,r,i,o,s,a){return this.getBarycoord(e,t,n,r,vi),a.set(0,0),a.addScaledVector(i,vi.x),a.addScaledVector(o,vi.y),a.addScaledVector(s,vi.z),a}static isFrontFacing(e,t,n,r){return fi.subVectors(n,t),mi.subVectors(e,t),fi.cross(mi).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return fi.subVectors(this.c,this.b),mi.subVectors(this.a,this.b),.5*fi.cross(mi).length()}getMidpoint(e){return void 0===e&&(console.warn(\"THREE.Triangle: .getMidpoint() target is now required\"),e=new ar),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Si.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn(\"THREE.Triangle: .getPlane() target is now required\"),e=new pi),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Si.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return Si.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return Si.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Si.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn(\"THREE.Triangle: .closestPointToPoint() target is now required\"),t=new ar);const n=this.a,r=this.b,i=this.c;let o,s;yi.subVectors(r,n),xi.subVectors(i,n),bi.subVectors(e,n);const a=yi.dot(bi),l=xi.dot(bi);if(a<=0&&l<=0)return t.copy(n);wi.subVectors(e,r);const c=yi.dot(wi),u=xi.dot(wi);if(c>=0&&u<=c)return t.copy(r);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(n).addScaledVector(yi,o);Mi.subVectors(e,i);const d=yi.dot(Mi),p=xi.dot(Mi);if(p>=0&&d<=p)return t.copy(i);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(xi,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return _i.subVectors(i,r),s=(u-c)/(u-c+(d-p)),t.copy(r).addScaledVector(_i,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(n).addScaledVector(yi,o).addScaledVector(xi,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Ti=0;class Ei extends zn{constructor(){super(),Object.defineProperty(this,\"id\",{value:Ti++}),this.uuid=kn(),this.name=\"\",this.type=\"Material\",this.fog=!0,this.blending=_,this.side=f,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=D,this.blendDst=N,this.blendEquation=T,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=j,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Sn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=un,this.stencilZFail=un,this.stencilZPass=un,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(\"THREE.Material: '\"+t+\"' parameter is undefined.\");continue}if(\"shading\"===t){console.warn(\"THREE.\"+this.type+\": .shading has been removed. Use the boolean .flatShading instead.\"),this.flatShading=n===v;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn(\"THREE.\"+this.type+\": '\"+t+\"' is not a property of this material.\")}}toJSON(e){const t=void 0===e||\"string\"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:\"Material\",generator:\"Material.toJSON\"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,\"\"!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==_&&(n.blending=this.blending),this.side!==f&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),\"round\"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),\"round\"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),\"{}\"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:\"dispose\"})}set needsUpdate(e){!0===e&&this.version++}}Ei.prototype.isMaterial=!0;const Li={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ai={h:0,s:0,l:0},Pi={h:0,s:0,l:0};function Ci(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Ri(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ii(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Oi{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):\"number\"==typeof e?this.setHex(e):\"string\"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Hn(e,1),t=Vn(t,0,1),n=Vn(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Ci(i,r,e+1/3),this.g=Ci(i,r,e),this.b=Ci(i,r,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn(\"THREE.Color: Alpha component of \"+e+\" will be ignored.\")}let n;if(n=/^((?:rgb|hsl)a?)\\(([^\\)]*)\\)/.exec(e)){let e;const r=n[1],i=n[2];switch(r){case\"rgb\":case\"rgba\":if(e=/^\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case\"hsl\":case\"hsla\":if(e=/^\\s*(\\d*\\.?\\d+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(i)){const n=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,i=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,r,i)}}}else if(n=/^\\#([A-Fa-f\\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Li[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn(\"THREE.Color: Unknown color \"+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Ri(e.r),this.g=Ri(e.g),this.b=Ri(e.b),this}copyLinearToSRGB(e){return this.r=Ii(e.r),this.g=Ii(e.g),this.b=Ii(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return(\"000000\"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn(\"THREE.Color: .getHSL() target is now required\"),e={h:0,s:0,l:0});const t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),o=Math.min(t,n,r);let s,a;const l=(o+i)/2;if(o===i)s=0,a=0;else{const e=i-o;switch(a=l<=.5?e/(i+o):e/(2-i-o),i){case t:s=(n-r)/e+(n<r?6:0);break;case n:s=(r-t)/e+2;break;case r:s=(t-n)/e+4}s/=6}return e.h=s,e.s=a,e.l=l,e}getStyle(){return\"rgb(\"+(255*this.r|0)+\",\"+(255*this.g|0)+\",\"+(255*this.b|0)+\")\"}offsetHSL(e,t,n){return this.getHSL(Ai),Ai.h+=e,Ai.s+=t,Ai.l+=n,this.setHSL(Ai.h,Ai.s,Ai.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Ai),e.getHSL(Pi);const n=jn(Ai.h,Pi.h,t),r=jn(Ai.s,Pi.s,t),i=jn(Ai.l,Pi.l,t);return this.setHSL(n,r,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Oi.NAMES=Li,Oi.prototype.isColor=!0,Oi.prototype.r=1,Oi.prototype.g=1,Oi.prototype.b=1;class Di extends Ei{constructor(e){super(),this.type=\"MeshBasicMaterial\",this.color=new Oi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this}}Di.prototype.isMeshBasicMaterial=!0;const Ni=new ar,zi=new Zn;class Bi{constructor(e,t,n){if(Array.isArray(e))throw new TypeError(\"THREE.BufferAttribute: array should be a Typed Array.\");this.name=\"\",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=Tn,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn(\"THREE.BufferAttribute.copyColorsArray(): color is undefined\",r),i=new Oi),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn(\"THREE.BufferAttribute.copyVector2sArray(): vector is undefined\",r),i=new Zn),t[n++]=i.x,t[n++]=i.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn(\"THREE.BufferAttribute.copyVector3sArray(): vector is undefined\",r),i=new ar),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn(\"THREE.BufferAttribute.copyVector4sArray(): vector is undefined\",r),i=new nr),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)zi.fromBufferAttribute(this,t),zi.applyMatrix3(e),this.setXY(t,zi.x,zi.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ni.fromBufferAttribute(this,t),Ni.applyMatrix3(e),this.setXYZ(t,Ni.x,Ni.y,Ni.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ni.x=this.getX(t),Ni.y=this.getY(t),Ni.z=this.getZ(t),Ni.applyMatrix4(e),this.setXYZ(t,Ni.x,Ni.y,Ni.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ni.x=this.getX(t),Ni.y=this.getY(t),Ni.z=this.getZ(t),Ni.applyNormalMatrix(e),this.setXYZ(t,Ni.x,Ni.y,Ni.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ni.x=this.getX(t),Ni.y=this.getY(t),Ni.z=this.getZ(t),Ni.transformDirection(e),this.setXYZ(t,Ni.x,Ni.y,Ni.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return\"\"!==this.name&&(e.name=this.name),this.usage!==Tn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}Bi.prototype.isBufferAttribute=!0;class Fi extends Bi{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Gi extends Bi{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Ui extends Bi{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class ki extends Bi{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Vi extends Bi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Hi extends Bi{constructor(e,t,n){super(new Int32Array(e),t,n)}}class ji extends Bi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Wi extends Bi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}Wi.prototype.isFloat16BufferAttribute=!0;class qi extends Bi{constructor(e,t,n){super(new Float32Array(e),t,n)}}class Xi extends Bi{constructor(e,t,n){super(new Float64Array(e),t,n)}}function Yi(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}const Zi={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Ji(e,t){return new Zi[e](t)}let Ki=0;const $i=new Fr,Qi=new ci,eo=new ar,to=new ur,no=new ur,ro=new ar;class io extends zn{constructor(){super(),Object.defineProperty(this,\"id\",{value:Ki++}),this.uuid=kn(),this.name=\"\",this.type=\"BufferGeometry\",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Yi(e)>65535?ji:Vi)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Jn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return $i.makeRotationFromQuaternion(e),this.applyMatrix4($i),this}rotateX(e){return $i.makeRotationX(e),this.applyMatrix4($i),this}rotateY(e){return $i.makeRotationY(e),this.applyMatrix4($i),this}rotateZ(e){return $i.makeRotationZ(e),this.applyMatrix4($i),this}translate(e,t,n){return $i.makeTranslation(e,t,n),this.applyMatrix4($i),this}scale(e,t,n){return $i.makeScale(e,t,n),this.applyMatrix4($i),this}lookAt(e){return Qi.lookAt(e),Qi.updateMatrix(),this.applyMatrix4(Qi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(eo).negate(),this.translate(eo.x,eo.y,eo.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute(\"position\",new qi(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ur);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set \"mesh.frustumCulled\" to \"false\".',this),void this.boundingBox.set(new ar(-1/0,-1/0,-1/0),new ar(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];to.setFromBufferAttribute(n),this.morphTargetsRelative?(ro.addVectors(this.boundingBox.min,to.min),this.boundingBox.expandByPoint(ro),ro.addVectors(this.boundingBox.max,to.max),this.boundingBox.expandByPoint(ro)):(this.boundingBox.expandByPoint(to.min),this.boundingBox.expandByPoint(to.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Pr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set \"mesh.frustumCulled\" to \"false\".',this),void this.boundingSphere.set(new ar,1/0);if(e){const n=this.boundingSphere.center;if(to.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];no.setFromBufferAttribute(n),this.morphTargetsRelative?(ro.addVectors(to.min,no.min),to.expandByPoint(ro),ro.addVectors(to.max,no.max),to.expandByPoint(ro)):(to.expandByPoint(no.min),to.expandByPoint(no.max))}to.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)ro.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(ro));if(t)for(let i=0,o=t.length;i<o;i++){const o=t[i],s=this.morphTargetsRelative;for(let t=0,i=o.count;t<i;t++)ro.fromBufferAttribute(o,t),s&&(eo.fromBufferAttribute(e,t),ro.add(eo)),r=Math.max(r,n.distanceToSquared(ro))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error(\"THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)\");const n=e.array,r=t.position.array,i=t.normal.array,o=t.uv.array,s=r.length/3;void 0===t.tangent&&this.setAttribute(\"tangent\",new Bi(new Float32Array(4*s),4));const a=t.tangent.array,l=[],c=[];for(let e=0;e<s;e++)l[e]=new ar,c[e]=new ar;const u=new ar,h=new ar,d=new ar,p=new Zn,f=new Zn,m=new Zn,g=new ar,v=new ar;function y(e,t,n){u.fromArray(r,3*e),h.fromArray(r,3*t),d.fromArray(r,3*n),p.fromArray(o,2*e),f.fromArray(o,2*t),m.fromArray(o,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(i),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(i),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(v),c[t].add(v),c[n].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(let e=0,t=x.length;e<t;++e){const t=x[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)y(n[e+0],n[e+1],n[e+2])}const _=new ar,b=new ar,w=new ar,M=new ar;function S(e){w.fromArray(i,3*e),M.copy(w);const t=l[e];_.copy(t),_.sub(w.multiplyScalar(w.dot(t))).normalize(),b.crossVectors(M,t);const n=b.dot(c[e])<0?-1:1;a[4*e]=_.x,a[4*e+1]=_.y,a[4*e+2]=_.z,a[4*e+3]=n}for(let e=0,t=x.length;e<t;++e){const t=x[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)S(n[e+0]),S(n[e+1]),S(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute(\"position\");if(void 0!==t){let n=this.getAttribute(\"normal\");if(void 0===n)n=new Bi(new Float32Array(3*t.count),3),this.setAttribute(\"normal\",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new ar,i=new ar,o=new ar,s=new ar,a=new ar,l=new ar,c=new ar,u=new ar;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),c.subVectors(o,i),u.subVectors(r,i),c.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),a.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error(\"THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.\",e);void 0===t&&(t=0,console.warn(\"THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.\"));const n=this.attributes;for(const r in n){if(void 0===e.attributes[r])continue;const i=n[r].array,o=e.attributes[r],s=o.array,a=o.itemSize*t,l=Math.min(s.length,i.length-a);for(let e=0,t=a;e<l;e++,t++)i[t]=s[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)ro.fromBufferAttribute(e,t),ro.normalize(),e.setXYZ(t,ro.x,ro.y,ro.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,o=new n.constructor(t.length*r);let s=0,a=0;for(let e=0,i=t.length;e<i;e++){s=t[e]*r;for(let e=0;e<r;e++)o[a++]=n[s++]}return new Bi(o,r,i)}if(null===this.index)return console.warn(\"THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed.\"),this;const t=new io,n=this.index.array,r=this.attributes;for(const i in r){const o=e(r[i],n);t.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],s=i[r];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);o.push(r)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:\"BufferGeometry\",generator:\"BufferGeometry.toJSON\"}};if(e.uuid=this.uuid,e.type=this.type,\"\"!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];o.push(r.toJSON(e.data))}o.length>0&&(r[t]=o,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new io).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:\"dispose\"})}}io.prototype.isBufferGeometry=!0;const oo=new Fr,so=new Br,ao=new Pr,lo=new ar,co=new ar,uo=new ar,ho=new ar,po=new ar,fo=new ar,mo=new ar,go=new ar,vo=new ar,yo=new Zn,xo=new Zn,_o=new Zn,bo=new ar,wo=new ar;class Mo extends ci{constructor(e=new io,t=new Di){super(),this.type=\"Mesh\",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error(\"THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\")}}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),ao.copy(n.boundingSphere),ao.applyMatrix4(i),!1===e.ray.intersectsSphere(ao))return;if(oo.copy(i).invert(),so.copy(e.ray).applyMatrix4(oo),null!==n.boundingBox&&!1===so.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=r[p.materialIndex];for(let n=Math.max(p.start,d.start),r=Math.min(p.start+p.count,d.start+d.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);o=So(this,f,e,so,s,a,l,c,u,r,h,d),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=p.materialIndex,t.push(o))}}else{for(let n=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);n<h;n+=3){const h=i.getX(n),d=i.getX(n+1),p=i.getX(n+2);o=So(this,r,e,so,s,a,l,c,u,h,d,p),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}else if(void 0!==s)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],p=r[i.materialIndex];for(let n=Math.max(i.start,d.start),r=Math.min(i.start+i.count,d.start+d.count);n<r;n+=3){o=So(this,p,e,so,s,a,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,t.push(o))}}else{for(let n=Math.max(0,d.start),i=Math.min(s.count,d.start+d.count);n<i;n+=3){o=So(this,r,e,so,s,a,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}}else n.isGeometry&&console.error(\"THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\")}}function So(e,t,n,r,i,o,s,a,l,c,u,h){lo.fromBufferAttribute(i,c),co.fromBufferAttribute(i,u),uo.fromBufferAttribute(i,h);const d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){mo.set(0,0,0),go.set(0,0,0),vo.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=d[e],n=o[e];0!==t&&(ho.fromBufferAttribute(n,c),po.fromBufferAttribute(n,u),fo.fromBufferAttribute(n,h),s?(mo.addScaledVector(ho,t),go.addScaledVector(po,t),vo.addScaledVector(fo,t)):(mo.addScaledVector(ho.sub(lo),t),go.addScaledVector(po.sub(co),t),vo.addScaledVector(fo.sub(uo),t)))}lo.add(mo),co.add(go),uo.add(vo)}e.isSkinnedMesh&&(e.boneTransform(c,lo),e.boneTransform(u,co),e.boneTransform(h,uo));const p=function(e,t,n,r,i,o,s,a){let l;if(l=t.side===m?r.intersectTriangle(s,o,i,!0,a):r.intersectTriangle(i,o,s,t.side!==g,a),null===l)return null;wo.copy(a),wo.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(wo);return c<n.near||c>n.far?null:{distance:c,point:wo.clone(),object:e}}(e,t,n,r,lo,co,uo,bo);if(p){a&&(yo.fromBufferAttribute(a,c),xo.fromBufferAttribute(a,u),_o.fromBufferAttribute(a,h),p.uv=Si.getUV(bo,lo,co,uo,yo,xo,_o,new Zn)),l&&(yo.fromBufferAttribute(l,c),xo.fromBufferAttribute(l,u),_o.fromBufferAttribute(l,h),p.uv2=Si.getUV(bo,lo,co,uo,yo,xo,_o,new Zn));const e={a:c,b:u,c:h,normal:new ar,materialIndex:0};Si.getNormal(lo,co,uo,e.normal),p.face=e}return p}Mo.prototype.isMesh=!0;class To extends io{constructor(e=1,t=1,n=1,r=1,i=1,o=1){super(),this.type=\"BoxGeometry\",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const s=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,r,i,o,p,f,m,g,v){const y=o/m,x=p/g,_=o/2,b=p/2,w=f/2,M=m+1,S=g+1;let T=0,E=0;const L=new ar;for(let o=0;o<S;o++){const s=o*x-b;for(let a=0;a<M;a++){const h=a*y-_;L[e]=h*r,L[t]=s*i,L[n]=w,l.push(L.x,L.y,L.z),L[e]=0,L[t]=0,L[n]=f>0?1:-1,c.push(L.x,L.y,L.z),u.push(a/m),u.push(1-o/g),T+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+M*e,r=h+t+M*(e+1),i=h+(t+1)+M*(e+1),o=h+(t+1)+M*e;a.push(n,r,o),a.push(r,i,o),E+=6}s.addGroup(d,E,v),d+=E,h+=T}p(\"z\",\"y\",\"x\",-1,-1,n,t,e,o,i,0),p(\"z\",\"y\",\"x\",1,-1,n,t,-e,o,i,1),p(\"x\",\"z\",\"y\",1,1,e,n,t,r,o,2),p(\"x\",\"z\",\"y\",1,-1,e,n,-t,r,o,3),p(\"x\",\"y\",\"z\",1,-1,e,t,n,r,i,4),p(\"x\",\"y\",\"z\",-1,-1,e,t,-n,r,i,5),this.setIndex(a),this.setAttribute(\"position\",new qi(l,3)),this.setAttribute(\"normal\",new qi(c,3)),this.setAttribute(\"uv\",new qi(u,2))}}function Eo(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Lo(e){const t={};for(let n=0;n<e.length;n++){const r=Eo(e[n]);for(const e in r)t[e]=r[e]}return t}const Ao={clone:Eo,merge:Lo};class Po extends Ei{constructor(e){super(),this.type=\"ShaderMaterial\",this.defines={},this.uniforms={},this.vertexShader=\"void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}\",this.fragmentShader=\"void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}\",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error(\"THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.\"),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Eo(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:\"t\",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:\"c\",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:\"v2\",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:\"v3\",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:\"v4\",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:\"m3\",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:\"m4\",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}Po.prototype.isShaderMaterial=!0;class Co extends ci{constructor(){super(),this.type=\"Camera\",this.matrixWorldInverse=new Fr,this.projectionMatrix=new Fr,this.projectionMatrixInverse=new Fr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){void 0===e&&(console.warn(\"THREE.Camera: .getWorldDirection() target is now required\"),e=new ar),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Co.prototype.isCamera=!0;class Ro extends Co{constructor(e=50,t=1,n=.1,r=2e3){super(),this.type=\"PerspectiveCamera\",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Un*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Gn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Un*Math.atan(Math.tan(.5*Gn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Gn*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/e,t-=o.offsetY*n/s,r*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Ro.prototype.isPerspectiveCamera=!0;class Io extends ci{constructor(e,t,n){if(super(),this.type=\"CubeCamera\",!0!==n.isWebGLCubeRenderTarget)return void console.error(\"THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.\");this.renderTarget=n;const r=new Ro(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new ar(1,0,0)),this.add(r);const i=new Ro(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new ar(-1,0,0)),this.add(i);const o=new Ro(90,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new ar(0,1,0)),this.add(o);const s=new Ro(90,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new ar(0,-1,0)),this.add(s);const a=new Ro(90,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new ar(0,0,1)),this.add(a);const l=new Ro(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new ar(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,o,s,a,l]=this.children,c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c}}class Oo extends er{constructor(e,t,n,r,i,o,s,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:oe,n,r,i,o,s=void 0!==s?s:Be,a,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Oo.prototype.isCubeTexture=!0;class Do extends rr{constructor(e,t,n){Number.isInteger(t)&&(console.warn(\"THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )\"),t=n),super(e,e,t),t=t||{},this.texture=new Oo(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:xe,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Fe,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:\"\\n\\n\\t\\t\\t\\tvarying vec3 vWorldDirection;\\n\\n\\t\\t\\t\\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\n\\t\\t\\t\\t\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\t\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\n\\t\\t\\t\\t\\t#include <begin_vertex>\\n\\t\\t\\t\\t\\t#include <project_vertex>\\n\\n\\t\\t\\t\\t}\\n\\t\\t\\t\",fragmentShader:\"\\n\\n\\t\\t\\t\\tuniform sampler2D tEquirect;\\n\\n\\t\\t\\t\\tvarying vec3 vWorldDirection;\\n\\n\\t\\t\\t\\t#include <common>\\n\\n\\t\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\t\\tvec3 direction = normalize( vWorldDirection );\\n\\n\\t\\t\\t\\t\\tvec2 sampleUV = equirectUv( direction );\\n\\n\\t\\t\\t\\t\\tgl_FragColor = texture2D( tEquirect, sampleUV );\\n\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"},r=new To(5,5,5),i=new Po({name:\"CubemapFromEquirect\",uniforms:Eo(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:m,blending:x});i.uniforms.tEquirect.value=t;const o=new Mo(r,i),s=t.minFilter;t.minFilter===we&&(t.minFilter=xe);return new Io(1,10,this).update(e,o),t.minFilter=s,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}Do.prototype.isWebGLCubeRenderTarget=!0;const No=new Pr,zo=new ar;class Bo{constructor(e=new pi,t=new pi,n=new pi,r=new pi,i=new pi,o=new pi){this.planes=[e,t,n,r,i,o]}set(e,t,n,r,i,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(s-r,u-a,f-h,y-m).normalize(),t[1].setComponents(s+r,u+a,f+h,y+m).normalize(),t[2].setComponents(s+i,u+l,f+d,y+g).normalize(),t[3].setComponents(s-i,u-l,f-d,y-g).normalize(),t[4].setComponents(s-o,u-c,f-p,y-v).normalize(),t[5].setComponents(s+o,u+c,f+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),No.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(No)}intersectsSprite(e){return No.center.set(0,0,0),No.radius=.7071067811865476,No.applyMatrix4(e.matrixWorld),this.intersectsSphere(No)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(zo.x=r.normal.x>0?e.max.x:e.min.x,zo.y=r.normal.y>0?e.max.y:e.min.y,zo.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(zo)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Fo(){let e=null,t=!1,n=null,r=null;function i(t,o){n(t,o),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Go(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=r.get(t);void 0===o?r.set(t,function(t,r){const i=t.array,o=t.usage,s=e.createBuffer();e.bindBuffer(r,s),e.bufferData(r,i,o),t.onUploadCallback();let a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn(\"THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.\"):i instanceof Uint16Array?t.isFloat16BufferAttribute?n?a=5131:console.warn(\"THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.\"):a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:(i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&(a=5121),{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(!function(t,r,i){const o=r.array,s=r.updateRange;e.bindBuffer(i,t),-1===s.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,t,i),o.version=t.version)}}}class Uo extends io{constructor(e=1,t=1,n=1,r=1){super(),this.type=\"PlaneGeometry\",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,o=t/2,s=Math.floor(n),a=Math.floor(r),l=s+1,c=a+1,u=e/s,h=t/a,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*h-o;for(let n=0;n<l;n++){const r=n*u-i;p.push(r,-t,0),f.push(0,0,1),m.push(n/s),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<s;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),o=t+1+l*e;d.push(n,r,o),d.push(r,i,o)}this.setIndex(d),this.setAttribute(\"position\",new qi(p,3)),this.setAttribute(\"normal\",new qi(f,3)),this.setAttribute(\"uv\",new qi(m,2))}}const ko={alphamap_fragment:\"#ifdef USE_ALPHAMAP\\n\\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n#endif\",alphamap_pars_fragment:\"#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\",alphatest_fragment:\"#ifdef ALPHATEST\\n\\tif ( diffuseColor.a < ALPHATEST ) discard;\\n#endif\",aomap_fragment:\"#ifdef USE_AOMAP\\n\\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\treflectedLight.indirectDiffuse *= ambientOcclusion;\\n\\t#if defined( USE_ENVMAP ) && defined( STANDARD )\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\\n\\t#endif\\n#endif\",aomap_pars_fragment:\"#ifdef USE_AOMAP\\n\\tuniform sampler2D aoMap;\\n\\tuniform float aoMapIntensity;\\n#endif\",begin_vertex:\"vec3 transformed = vec3( position );\",beginnormal_vertex:\"vec3 objectNormal = vec3( normal );\\n#ifdef USE_TANGENT\\n\\tvec3 objectTangent = vec3( tangent.xyz );\\n#endif\",bsdfs:\"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\\n\\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\\n\\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\\n\\tvec4 r = roughness * c0 + c1;\\n\\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\\n\\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\\n}\\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n\\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\\n\\tif( cutoffDistance > 0.0 ) {\\n\\t\\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n\\t}\\n\\treturn distanceFalloff;\\n#else\\n\\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\\n\\t\\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n\\t}\\n\\treturn 1.0;\\n#endif\\n}\\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\\n\\treturn RECIPROCAL_PI * diffuseColor;\\n}\\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\\n\\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\\n\\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n}\\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\\n\\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\\n\\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\\n\\treturn Fr * fresnel + F0;\\n}\\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\treturn 1.0 / ( gl * gv );\\n}\\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\treturn 0.5 / max( gv + gl, EPSILON );\\n}\\nfloat D_GGX( const in float alpha, const in float dotNH ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\\n\\treturn RECIPROCAL_PI * a2 / pow2( denom );\\n}\\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\\n\\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\\n\\tfloat dotNV = saturate( dot( normal, viewDir ) );\\n\\tfloat dotNH = saturate( dot( normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\\tfloat D = D_GGX( alpha, dotNH );\\n\\treturn F * ( G * D );\\n}\\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\\n\\tconst float LUT_SIZE = 64.0;\\n\\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\\n\\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\\n\\tfloat dotNV = saturate( dot( N, V ) );\\n\\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\\n\\tuv = uv * LUT_SCALE + LUT_BIAS;\\n\\treturn uv;\\n}\\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\\n\\tfloat l = length( f );\\n\\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\\n}\\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\\n\\tfloat x = dot( v1, v2 );\\n\\tfloat y = abs( x );\\n\\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\\n\\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\\n\\tfloat v = a / b;\\n\\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\\n\\treturn cross( v1, v2 ) * theta_sintheta;\\n}\\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\\n\\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\\n\\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\\n\\tvec3 lightNormal = cross( v1, v2 );\\n\\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\\n\\tvec3 T1, T2;\\n\\tT1 = normalize( V - N * dot( V, N ) );\\n\\tT2 = - cross( N, T1 );\\n\\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\\n\\tvec3 coords[ 4 ];\\n\\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\\n\\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\\n\\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\\n\\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\\n\\tcoords[ 0 ] = normalize( coords[ 0 ] );\\n\\tcoords[ 1 ] = normalize( coords[ 1 ] );\\n\\tcoords[ 2 ] = normalize( coords[ 2 ] );\\n\\tcoords[ 3 ] = normalize( coords[ 3 ] );\\n\\tvec3 vectorFormFactor = vec3( 0.0 );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\\n\\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\\n\\treturn vec3( result );\\n}\\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat dotNV = saturate( dot( normal, viewDir ) );\\n\\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\\n\\treturn specularColor * brdf.x + brdf.y;\\n}\\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\\n\\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\\n\\tvec3 FssEss = F * brdf.x + brdf.y;\\n\\tfloat Ess = brdf.x + brdf.y;\\n\\tfloat Ems = 1.0 - Ess;\\n\\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\\n\\tsingleScatter += FssEss;\\n\\tmultiScatter += Fms * Ems;\\n}\\nfloat G_BlinnPhong_Implicit( ) {\\n\\treturn 0.25;\\n}\\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\\n\\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n}\\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_BlinnPhong_Implicit( );\\n\\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\treturn F * ( G * D );\\n}\\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\\n\\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\\n}\\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\\n\\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\\n}\\n#if defined( USE_SHEEN )\\nfloat D_Charlie(float roughness, float NoH) {\\n\\tfloat invAlpha = 1.0 / roughness;\\n\\tfloat cos2h = NoH * NoH;\\n\\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\\n}\\nfloat V_Neubelt(float NoV, float NoL) {\\n\\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\\n}\\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\\n\\tvec3 N = geometry.normal;\\n\\tvec3 V = geometry.viewDir;\\n\\tvec3 H = normalize( V + L );\\n\\tfloat dotNH = saturate( dot( N, H ) );\\n\\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\\n}\\n#endif\",bumpmap_pars_fragment:\"#ifdef USE_BUMPMAP\\n\\tuniform sampler2D bumpMap;\\n\\tuniform float bumpScale;\\n\\tvec2 dHdxy_fwd() {\\n\\t\\tvec2 dSTdx = dFdx( vUv );\\n\\t\\tvec2 dSTdy = dFdy( vUv );\\n\\t\\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\\t\\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\\t\\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\t\\treturn vec2( dBx, dBy );\\n\\t}\\n\\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\\n\\t\\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\\n\\t\\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\\n\\t\\tvec3 vN = surf_norm;\\n\\t\\tvec3 R1 = cross( vSigmaY, vN );\\n\\t\\tvec3 R2 = cross( vN, vSigmaX );\\n\\t\\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\\n\\t\\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\\t\\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\t}\\n#endif\",clipping_planes_fragment:\"#if NUM_CLIPPING_PLANES > 0\\n\\tvec4 plane;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\\n\\t\\tplane = clippingPlanes[ i ];\\n\\t\\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\\n\\t\\tbool clipped = true;\\n\\t\\t#pragma unroll_loop_start\\n\\t\\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\\n\\t\\t\\tplane = clippingPlanes[ i ];\\n\\t\\t\\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\\n\\t\\t}\\n\\t\\t#pragma unroll_loop_end\\n\\t\\tif ( clipped ) discard;\\n\\t#endif\\n#endif\",clipping_planes_pars_fragment:\"#if NUM_CLIPPING_PLANES > 0\\n\\tvarying vec3 vClipPosition;\\n\\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\\n#endif\",clipping_planes_pars_vertex:\"#if NUM_CLIPPING_PLANES > 0\\n\\tvarying vec3 vClipPosition;\\n#endif\",clipping_planes_vertex:\"#if NUM_CLIPPING_PLANES > 0\\n\\tvClipPosition = - mvPosition.xyz;\\n#endif\",color_fragment:\"#if defined( USE_COLOR_ALPHA )\\n\\tdiffuseColor *= vColor;\\n#elif defined( USE_COLOR )\\n\\tdiffuseColor.rgb *= vColor;\\n#endif\",color_pars_fragment:\"#if defined( USE_COLOR_ALPHA )\\n\\tvarying vec4 vColor;\\n#elif defined( USE_COLOR )\\n\\tvarying vec3 vColor;\\n#endif\",color_pars_vertex:\"#if defined( USE_COLOR_ALPHA )\\n\\tvarying vec4 vColor;\\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\\n\\tvarying vec3 vColor;\\n#endif\",color_vertex:\"#if defined( USE_COLOR_ALPHA )\\n\\tvColor = vec4( 1.0 );\\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\\n\\tvColor = vec3( 1.0 );\\n#endif\\n#ifdef USE_COLOR\\n\\tvColor *= color;\\n#endif\\n#ifdef USE_INSTANCING_COLOR\\n\\tvColor.xyz *= instanceColor.xyz;\\n#endif\",common:\"#define PI 3.141592653589793\\n#define PI2 6.283185307179586\\n#define PI_HALF 1.5707963267948966\\n#define RECIPROCAL_PI 0.3183098861837907\\n#define RECIPROCAL_PI2 0.15915494309189535\\n#define EPSILON 1e-6\\n#ifndef saturate\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#endif\\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\\nfloat pow2( const in float x ) { return x*x; }\\nfloat pow3( const in float x ) { return x*x*x; }\\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\\nhighp float rand( const in vec2 uv ) {\\n\\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\\n\\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\\n\\treturn fract(sin(sn) * c);\\n}\\n#ifdef HIGH_PRECISION\\n\\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\\n#else\\n\\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\\n\\tfloat precisionSafeLength( vec3 v ) {\\n\\t\\tfloat maxComponent = max3( abs( v ) );\\n\\t\\treturn length( v / maxComponent ) * maxComponent;\\n\\t}\\n#endif\\nstruct IncidentLight {\\n\\tvec3 color;\\n\\tvec3 direction;\\n\\tbool visible;\\n};\\nstruct ReflectedLight {\\n\\tvec3 directDiffuse;\\n\\tvec3 directSpecular;\\n\\tvec3 indirectDiffuse;\\n\\tvec3 indirectSpecular;\\n};\\nstruct GeometricContext {\\n\\tvec3 position;\\n\\tvec3 normal;\\n\\tvec3 viewDir;\\n#ifdef CLEARCOAT\\n\\tvec3 clearcoatNormal;\\n#endif\\n};\\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n}\\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\\treturn - distance * planeNormal + point;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n}\\nmat3 transposeMat3( const in mat3 m ) {\\n\\tmat3 tmp;\\n\\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\\n\\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\\n\\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\\n\\treturn tmp;\\n}\\nfloat linearToRelativeLuminance( const in vec3 color ) {\\n\\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\\n\\treturn dot( weights, color.rgb );\\n}\\nbool isPerspectiveMatrix( mat4 m ) {\\n\\treturn m[ 2 ][ 3 ] == - 1.0;\\n}\\nvec2 equirectUv( in vec3 dir ) {\\n\\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\\n\\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\\n\\treturn vec2( u, v );\\n}\",cube_uv_reflection_fragment:\"#ifdef ENVMAP_TYPE_CUBE_UV\\n\\t#define cubeUV_maxMipLevel 8.0\\n\\t#define cubeUV_minMipLevel 4.0\\n\\t#define cubeUV_maxTileSize 256.0\\n\\t#define cubeUV_minTileSize 16.0\\n\\tfloat getFace( vec3 direction ) {\\n\\t\\tvec3 absDirection = abs( direction );\\n\\t\\tfloat face = - 1.0;\\n\\t\\tif ( absDirection.x > absDirection.z ) {\\n\\t\\t\\tif ( absDirection.x > absDirection.y )\\n\\t\\t\\t\\tface = direction.x > 0.0 ? 0.0 : 3.0;\\n\\t\\t\\telse\\n\\t\\t\\t\\tface = direction.y > 0.0 ? 1.0 : 4.0;\\n\\t\\t} else {\\n\\t\\t\\tif ( absDirection.z > absDirection.y )\\n\\t\\t\\t\\tface = direction.z > 0.0 ? 2.0 : 5.0;\\n\\t\\t\\telse\\n\\t\\t\\t\\tface = direction.y > 0.0 ? 1.0 : 4.0;\\n\\t\\t}\\n\\t\\treturn face;\\n\\t}\\n\\tvec2 getUV( vec3 direction, float face ) {\\n\\t\\tvec2 uv;\\n\\t\\tif ( face == 0.0 ) {\\n\\t\\t\\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\\n\\t\\t} else if ( face == 1.0 ) {\\n\\t\\t\\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\\n\\t\\t} else if ( face == 2.0 ) {\\n\\t\\t\\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\\n\\t\\t} else if ( face == 3.0 ) {\\n\\t\\t\\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\\n\\t\\t} else if ( face == 4.0 ) {\\n\\t\\t\\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\\n\\t\\t} else {\\n\\t\\t\\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\\n\\t\\t}\\n\\t\\treturn 0.5 * ( uv + 1.0 );\\n\\t}\\n\\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\\n\\t\\tfloat face = getFace( direction );\\n\\t\\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\\n\\t\\tmipInt = max( mipInt, cubeUV_minMipLevel );\\n\\t\\tfloat faceSize = exp2( mipInt );\\n\\t\\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\\n\\t\\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\\n\\t\\tvec2 f = fract( uv );\\n\\t\\tuv += 0.5 - f;\\n\\t\\tif ( face > 2.0 ) {\\n\\t\\t\\tuv.y += faceSize;\\n\\t\\t\\tface -= 3.0;\\n\\t\\t}\\n\\t\\tuv.x += face * faceSize;\\n\\t\\tif ( mipInt < cubeUV_maxMipLevel ) {\\n\\t\\t\\tuv.y += 2.0 * cubeUV_maxTileSize;\\n\\t\\t}\\n\\t\\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\\n\\t\\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\\n\\t\\tuv *= texelSize;\\n\\t\\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\\n\\t\\tuv.x += texelSize;\\n\\t\\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\\n\\t\\tuv.y += texelSize;\\n\\t\\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\\n\\t\\tuv.x -= texelSize;\\n\\t\\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\\n\\t\\tvec3 tm = mix( tl, tr, f.x );\\n\\t\\tvec3 bm = mix( bl, br, f.x );\\n\\t\\treturn mix( tm, bm, f.y );\\n\\t}\\n\\t#define r0 1.0\\n\\t#define v0 0.339\\n\\t#define m0 - 2.0\\n\\t#define r1 0.8\\n\\t#define v1 0.276\\n\\t#define m1 - 1.0\\n\\t#define r4 0.4\\n\\t#define v4 0.046\\n\\t#define m4 2.0\\n\\t#define r5 0.305\\n\\t#define v5 0.016\\n\\t#define m5 3.0\\n\\t#define r6 0.21\\n\\t#define v6 0.0038\\n\\t#define m6 4.0\\n\\tfloat roughnessToMip( float roughness ) {\\n\\t\\tfloat mip = 0.0;\\n\\t\\tif ( roughness >= r1 ) {\\n\\t\\t\\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\\n\\t\\t} else if ( roughness >= r4 ) {\\n\\t\\t\\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\\n\\t\\t} else if ( roughness >= r5 ) {\\n\\t\\t\\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\\n\\t\\t} else if ( roughness >= r6 ) {\\n\\t\\t\\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\\n\\t\\t} else {\\n\\t\\t\\tmip = - 2.0 * log2( 1.16 * roughness );\\t\\t}\\n\\t\\treturn mip;\\n\\t}\\n\\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\\n\\t\\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\\n\\t\\tfloat mipF = fract( mip );\\n\\t\\tfloat mipInt = floor( mip );\\n\\t\\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\\n\\t\\tif ( mipF == 0.0 ) {\\n\\t\\t\\treturn vec4( color0, 1.0 );\\n\\t\\t} else {\\n\\t\\t\\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\\n\\t\\t\\treturn vec4( mix( color0, color1, mipF ), 1.0 );\\n\\t\\t}\\n\\t}\\n#endif\",defaultnormal_vertex:\"vec3 transformedNormal = objectNormal;\\n#ifdef USE_INSTANCING\\n\\tmat3 m = mat3( instanceMatrix );\\n\\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\\n\\ttransformedNormal = m * transformedNormal;\\n#endif\\ntransformedNormal = normalMatrix * transformedNormal;\\n#ifdef FLIP_SIDED\\n\\ttransformedNormal = - transformedNormal;\\n#endif\\n#ifdef USE_TANGENT\\n\\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\\n\\t#ifdef FLIP_SIDED\\n\\t\\ttransformedTangent = - transformedTangent;\\n\\t#endif\\n#endif\",displacementmap_pars_vertex:\"#ifdef USE_DISPLACEMENTMAP\\n\\tuniform sampler2D displacementMap;\\n\\tuniform float displacementScale;\\n\\tuniform float displacementBias;\\n#endif\",displacementmap_vertex:\"#ifdef USE_DISPLACEMENTMAP\\n\\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\\n#endif\",emissivemap_fragment:\"#ifdef USE_EMISSIVEMAP\\n\\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\\n\\ttotalEmissiveRadiance *= emissiveColor.rgb;\\n#endif\",emissivemap_pars_fragment:\"#ifdef USE_EMISSIVEMAP\\n\\tuniform sampler2D emissiveMap;\\n#endif\",encodings_fragment:\"gl_FragColor = linearToOutputTexel( gl_FragColor );\",encodings_pars_fragment:\"\\nvec4 LinearToLinear( in vec4 value ) {\\n\\treturn value;\\n}\\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\\n\\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\\n}\\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\\n\\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\\n}\\nvec4 sRGBToLinear( in vec4 value ) {\\n\\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\\n}\\nvec4 LinearTosRGB( in vec4 value ) {\\n\\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\\n}\\nvec4 RGBEToLinear( in vec4 value ) {\\n\\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\\n}\\nvec4 LinearToRGBE( in vec4 value ) {\\n\\tfloat maxComponent = max( max( value.r, value.g ), value.b );\\n\\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\\n\\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\\n}\\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\\n\\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\\n}\\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\\n\\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\\n\\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\\n\\tM = ceil( M * 255.0 ) / 255.0;\\n\\treturn vec4( value.rgb / ( M * maxRange ), M );\\n}\\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\\n\\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\\n}\\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\\n\\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\\n\\tfloat D = max( maxRange / maxRGB, 1.0 );\\n\\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\\n\\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\\n}\\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\\nvec4 LinearToLogLuv( in vec4 value ) {\\n\\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\\n\\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\\n\\tvec4 vResult;\\n\\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\\n\\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\\n\\tvResult.w = fract( Le );\\n\\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\\n\\treturn vResult;\\n}\\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\\nvec4 LogLuvToLinear( in vec4 value ) {\\n\\tfloat Le = value.z * 255.0 + value.w;\\n\\tvec3 Xp_Y_XYZp;\\n\\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\\n\\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\\n\\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\\n\\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\\n\\treturn vec4( max( vRGB, 0.0 ), 1.0 );\\n}\",envmap_fragment:\"#ifdef USE_ENVMAP\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\tvec3 cameraToFrag;\\n\\t\\tif ( isOrthographic ) {\\n\\t\\t\\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\\n\\t\\t} else {\\n\\t\\t\\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\\n\\t\\t}\\n\\t\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#else\\n\\t\\tvec3 reflectVec = vReflect;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\\n\\t#else\\n\\t\\tvec4 envColor = vec4( 0.0 );\\n\\t#endif\\n\\t#ifndef ENVMAP_TYPE_CUBE_UV\\n\\t\\tenvColor = envMapTexelToLinear( envColor );\\n\\t#endif\\n\\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\t\\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\t\\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\t\\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\t#endif\\n#endif\",envmap_common_pars_fragment:\"#ifdef USE_ENVMAP\\n\\tuniform float envMapIntensity;\\n\\tuniform float flipEnvMap;\\n\\tuniform int maxMipLevel;\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tuniform samplerCube envMap;\\n\\t#else\\n\\t\\tuniform sampler2D envMap;\\n\\t#endif\\n\\t\\n#endif\",envmap_pars_fragment:\"#ifdef USE_ENVMAP\\n\\tuniform float reflectivity;\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\t#define ENV_WORLDPOS\\n\\t#endif\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t\\tuniform float refractionRatio;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t#endif\\n#endif\",envmap_pars_vertex:\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\\n\\t\\t#define ENV_WORLDPOS\\n\\t#endif\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\t\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n#endif\",envmap_physical_pars_fragment:\"#if defined( USE_ENVMAP )\\n\\t#ifdef ENVMAP_MODE_REFRACTION\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n\\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\\n\\t\\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\\n\\t\\t#else\\n\\t\\t\\tvec4 envMapColor = vec4( 0.0 );\\n\\t\\t#endif\\n\\t\\treturn PI * envMapColor.rgb * envMapIntensity;\\n\\t}\\n\\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\\n\\t\\tfloat maxMIPLevelScalar = float( maxMIPLevel );\\n\\t\\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\\n\\t\\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\\n\\t\\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\\n\\t}\\n\\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( -viewDir, normal );\\n\\t\\t\\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\\n\\t\\t#endif\\n\\t\\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\\n\\t\\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\\n\\t\\t#endif\\n\\t\\treturn envMapColor.rgb * envMapIntensity;\\n\\t}\\n#endif\",envmap_vertex:\"#ifdef USE_ENVMAP\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\tvWorldPosition = worldPosition.xyz;\\n\\t#else\\n\\t\\tvec3 cameraToVertex;\\n\\t\\tif ( isOrthographic ) {\\n\\t\\t\\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\\n\\t\\t} else {\\n\\t\\t\\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\t\\t}\\n\\t\\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#endif\\n#endif\",fog_vertex:\"#ifdef USE_FOG\\n\\tfogDepth = - mvPosition.z;\\n#endif\",fog_pars_vertex:\"#ifdef USE_FOG\\n\\tvarying float fogDepth;\\n#endif\",fog_fragment:\"#ifdef USE_FOG\\n\\t#ifdef FOG_EXP2\\n\\t\\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\\n\\t#else\\n\\t\\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\\n\\t#endif\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\\n#endif\",fog_pars_fragment:\"#ifdef USE_FOG\\n\\tuniform vec3 fogColor;\\n\\tvarying float fogDepth;\\n\\t#ifdef FOG_EXP2\\n\\t\\tuniform float fogDensity;\\n\\t#else\\n\\t\\tuniform float fogNear;\\n\\t\\tuniform float fogFar;\\n\\t#endif\\n#endif\",gradientmap_pars_fragment:\"#ifdef USE_GRADIENTMAP\\n\\tuniform sampler2D gradientMap;\\n#endif\\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\\n\\tfloat dotNL = dot( normal, lightDirection );\\n\\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\\n\\t#ifdef USE_GRADIENTMAP\\n\\t\\treturn texture2D( gradientMap, coord ).rgb;\\n\\t#else\\n\\t\\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\\n\\t#endif\\n}\",lightmap_fragment:\"#ifdef USE_LIGHTMAP\\n\\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\\n\\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\\n#endif\",lightmap_pars_fragment:\"#ifdef USE_LIGHTMAP\\n\\tuniform sampler2D lightMap;\\n\\tuniform float lightMapIntensity;\\n#endif\",lights_lambert_vertex:\"vec3 diffuse = vec3( 1.0 );\\nGeometricContext geometry;\\ngeometry.position = mvPosition.xyz;\\ngeometry.normal = normalize( transformedNormal );\\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\\nGeometricContext backGeometry;\\nbackGeometry.position = geometry.position;\\nbackGeometry.normal = -geometry.normal;\\nbackGeometry.viewDir = geometry.viewDir;\\nvLightFront = vec3( 0.0 );\\nvIndirectFront = vec3( 0.0 );\\n#ifdef DOUBLE_SIDED\\n\\tvLightBack = vec3( 0.0 );\\n\\tvIndirectBack = vec3( 0.0 );\\n#endif\\nIncidentLight directLight;\\nfloat dotNL;\\nvec3 directLightColor_Diffuse;\\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\\n#ifdef DOUBLE_SIDED\\n\\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\\n\\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if NUM_DIR_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\",lights_pars_begin:\"uniform bool receiveShadow;\\nuniform vec3 ambientLightColor;\\nuniform vec3 lightProbe[ 9 ];\\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\\n\\tfloat x = normal.x, y = normal.y, z = normal.z;\\n\\tvec3 result = shCoefficients[ 0 ] * 0.886227;\\n\\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\\n\\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\\n\\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\\n\\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\\n\\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\\n\\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\\n\\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\\n\\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\\n\\treturn result;\\n}\\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\\n\\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\\n\\treturn irradiance;\\n}\\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\\n\\tvec3 irradiance = ambientLightColor;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treturn irradiance;\\n}\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t};\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tdirectLight.color = directionalLight.color;\\n\\t\\tdirectLight.direction = directionalLight.direction;\\n\\t\\tdirectLight.visible = true;\\n\\t}\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\tstruct PointLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t};\\n\\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tvec3 lVector = pointLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tdirectLight.color = pointLight.color;\\n\\t\\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\\n\\t\\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tstruct SpotLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tfloat coneCos;\\n\\t\\tfloat penumbraCos;\\n\\t};\\n\\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tvec3 lVector = spotLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tfloat angleCos = dot( directLight.direction, spotLight.direction );\\n\\t\\tif ( angleCos > spotLight.coneCos ) {\\n\\t\\t\\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n\\t\\t\\tdirectLight.color = spotLight.color;\\n\\t\\t\\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_RECT_AREA_LIGHTS > 0\\n\\tstruct RectAreaLight {\\n\\t\\tvec3 color;\\n\\t\\tvec3 position;\\n\\t\\tvec3 halfWidth;\\n\\t\\tvec3 halfHeight;\\n\\t};\\n\\tuniform sampler2D ltc_1;\\tuniform sampler2D ltc_2;\\n\\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tstruct HemisphereLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 skyColor;\\n\\t\\tvec3 groundColor;\\n\\t};\\n\\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\\n\\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\\n\\t\\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\\n\\t\\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\\n\\t\\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tirradiance *= PI;\\n\\t\\t#endif\\n\\t\\treturn irradiance;\\n\\t}\\n#endif\",lights_toon_fragment:\"ToonMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\",lights_toon_pars_fragment:\"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\nstruct ToonMaterial {\\n\\tvec3 diffuseColor;\\n};\\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Toon\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Toon\\n#define Material_LightProbeLOD( material )\\t(0)\",lights_phong_fragment:\"BlinnPhongMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\\nmaterial.specularColor = specular;\\nmaterial.specularShininess = shininess;\\nmaterial.specularStrength = specularStrength;\",lights_phong_pars_fragment:\"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\nstruct BlinnPhongMaterial {\\n\\tvec3 diffuseColor;\\n\\tvec3 specularColor;\\n\\tfloat specularShininess;\\n\\tfloat specularStrength;\\n};\\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\\n}\\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_BlinnPhong\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_BlinnPhong\\n#define Material_LightProbeLOD( material )\\t(0)\",lights_physical_fragment:\"PhysicalMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\\n#ifdef REFLECTIVITY\\n\\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), rawDiffuseColor, metalnessFactor );\\n#else\\n\\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), rawDiffuseColor, metalnessFactor );\\n#endif\\n#ifdef CLEARCOAT\\n\\tmaterial.clearcoat = clearcoat;\\n\\tmaterial.clearcoatRoughness = clearcoatRoughness;\\n\\t#ifdef USE_CLEARCOATMAP\\n\\t\\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\\n\\t#endif\\n\\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\\n\\t\\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\\n\\t#endif\\n\\tmaterial.clearcoat = saturate( material.clearcoat );\\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\\n\\tmaterial.clearcoatRoughness += geometryRoughness;\\n\\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\\n#endif\\n#ifdef USE_SHEEN\\n\\tmaterial.sheenColor = sheen;\\n#endif\",lights_physical_pars_fragment:\"struct PhysicalMaterial {\\n\\tvec3 diffuseColor;\\n\\tfloat specularRoughness;\\n\\tvec3 specularColor;\\n#ifdef CLEARCOAT\\n\\tfloat clearcoat;\\n\\tfloat clearcoatRoughness;\\n#endif\\n#ifdef USE_SHEEN\\n\\tvec3 sheenColor;\\n#endif\\n};\\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\\n\\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\\n}\\n#if NUM_RECT_AREA_LIGHTS > 0\\n\\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\t\\tvec3 normal = geometry.normal;\\n\\t\\tvec3 viewDir = geometry.viewDir;\\n\\t\\tvec3 position = geometry.position;\\n\\t\\tvec3 lightPos = rectAreaLight.position;\\n\\t\\tvec3 halfWidth = rectAreaLight.halfWidth;\\n\\t\\tvec3 halfHeight = rectAreaLight.halfHeight;\\n\\t\\tvec3 lightColor = rectAreaLight.color;\\n\\t\\tfloat roughness = material.specularRoughness;\\n\\t\\tvec3 rectCoords[ 4 ];\\n\\t\\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\\t\\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\\n\\t\\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\\n\\t\\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\\n\\t\\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\\n\\t\\tvec4 t1 = texture2D( ltc_1, uv );\\n\\t\\tvec4 t2 = texture2D( ltc_2, uv );\\n\\t\\tmat3 mInv = mat3(\\n\\t\\t\\tvec3( t1.x, 0, t1.y ),\\n\\t\\t\\tvec3(    0, 1,    0 ),\\n\\t\\t\\tvec3( t1.z, 0, t1.w )\\n\\t\\t);\\n\\t\\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\\n\\t\\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\\n\\t\\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\\n\\t}\\n#endif\\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\t#ifdef CLEARCOAT\\n\\t\\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\\n\\t\\tvec3 ccIrradiance = ccDotNL * directLight.color;\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tccIrradiance *= PI;\\n\\t\\t#endif\\n\\t\\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\\n\\t\\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\\n\\t#else\\n\\t\\tfloat clearcoatDHR = 0.0;\\n\\t#endif\\n\\t#ifdef USE_SHEEN\\n\\t\\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\\n\\t\\t\\tmaterial.specularRoughness,\\n\\t\\t\\tdirectLight.direction,\\n\\t\\t\\tgeometry,\\n\\t\\t\\tmaterial.sheenColor\\n\\t\\t);\\n\\t#else\\n\\t\\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\\n\\t#endif\\n\\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\\n\\t#ifdef CLEARCOAT\\n\\t\\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\\n\\t\\tfloat ccDotNL = ccDotNV;\\n\\t\\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\\n\\t#else\\n\\t\\tfloat clearcoatDHR = 0.0;\\n\\t#endif\\n\\tfloat clearcoatInv = 1.0 - clearcoatDHR;\\n\\tvec3 singleScattering = vec3( 0.0 );\\n\\tvec3 multiScattering = vec3( 0.0 );\\n\\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\\n\\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\\n\\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\\n\\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\\n\\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\\n\\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Physical\\n#define RE_Direct_RectArea\\t\\tRE_Direct_RectArea_Physical\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Physical\\n#define RE_IndirectSpecular\\t\\tRE_IndirectSpecular_Physical\\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\\n\\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\\n}\",lights_fragment_begin:\"\\nGeometricContext geometry;\\ngeometry.position = - vViewPosition;\\ngeometry.normal = normal;\\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\\n#ifdef CLEARCOAT\\n\\tgeometry.clearcoatNormal = clearcoatNormal;\\n#endif\\nIncidentLight directLight;\\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tPointLight pointLight;\\n\\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\\n\\tPointLightShadow pointLightShadow;\\n\\t#endif\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\\n\\t\\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\\n\\t\\tpointLightShadow = pointLightShadows[ i ];\\n\\t\\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tSpotLight spotLight;\\n\\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\\n\\tSpotLightShadow spotLightShadow;\\n\\t#endif\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\\n\\t\\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\\n\\t\\tspotLightShadow = spotLightShadows[ i ];\\n\\t\\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tDirectionalLight directionalLight;\\n\\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\\n\\tDirectionalLightShadow directionalLightShadow;\\n\\t#endif\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\\n\\t\\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\\n\\t\\tdirectionalLightShadow = directionalLightShadows[ i ];\\n\\t\\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\\n\\tRectAreaLight rectAreaLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\\n\\t\\trectAreaLight = rectAreaLights[ i ];\\n\\t\\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if defined( RE_IndirectDiffuse )\\n\\tvec3 iblIrradiance = vec3( 0.0 );\\n\\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\\n\\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\\n\\t#if ( NUM_HEMI_LIGHTS > 0 )\\n\\t\\t#pragma unroll_loop_start\\n\\t\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\t\\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t}\\n\\t\\t#pragma unroll_loop_end\\n\\t#endif\\n#endif\\n#if defined( RE_IndirectSpecular )\\n\\tvec3 radiance = vec3( 0.0 );\\n\\tvec3 clearcoatRadiance = vec3( 0.0 );\\n#endif\",lights_fragment_maps:\"#if defined( RE_IndirectDiffuse )\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\\n\\t\\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tlightMapIrradiance *= PI;\\n\\t\\t#endif\\n\\t\\tirradiance += lightMapIrradiance;\\n\\t#endif\\n\\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\\n\\t#endif\\n#endif\\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\\n\\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\\n\\t#ifdef CLEARCOAT\\n\\t\\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\\n\\t#endif\\n#endif\",lights_fragment_end:\"#if defined( RE_IndirectDiffuse )\\n\\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\\n#endif\\n#if defined( RE_IndirectSpecular )\\n\\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\\n#endif\",logdepthbuf_fragment:\"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\\n\\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\\n#endif\",logdepthbuf_pars_fragment:\"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\\n\\tuniform float logDepthBufFC;\\n\\tvarying float vFragDepth;\\n\\tvarying float vIsPerspective;\\n#endif\",logdepthbuf_pars_vertex:\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t\\tvarying float vIsPerspective;\\n\\t#else\\n\\t\\tuniform float logDepthBufFC;\\n\\t#endif\\n#endif\",logdepthbuf_vertex:\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvFragDepth = 1.0 + gl_Position.w;\\n\\t\\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\\n\\t#else\\n\\t\\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\\n\\t\\t\\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\\n\\t\\t\\tgl_Position.z *= gl_Position.w;\\n\\t\\t}\\n\\t#endif\\n#endif\",map_fragment:\"#ifdef USE_MAP\\n\\tvec4 texelColor = texture2D( map, vUv );\\n\\ttexelColor = mapTexelToLinear( texelColor );\\n\\tdiffuseColor *= texelColor;\\n#endif\",map_pars_fragment:\"#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\",map_particle_fragment:\"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\\n\\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\\n#endif\\n#ifdef USE_MAP\\n\\tvec4 mapTexel = texture2D( map, uv );\\n\\tdiffuseColor *= mapTexelToLinear( mapTexel );\\n#endif\\n#ifdef USE_ALPHAMAP\\n\\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\\n#endif\",map_particle_pars_fragment:\"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\\n\\tuniform mat3 uvTransform;\\n#endif\\n#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\\n#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\",metalnessmap_fragment:\"float metalnessFactor = metalness;\\n#ifdef USE_METALNESSMAP\\n\\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\\n\\tmetalnessFactor *= texelMetalness.b;\\n#endif\",metalnessmap_pars_fragment:\"#ifdef USE_METALNESSMAP\\n\\tuniform sampler2D metalnessMap;\\n#endif\",morphnormal_vertex:\"#ifdef USE_MORPHNORMALS\\n\\tobjectNormal *= morphTargetBaseInfluence;\\n\\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\\n\\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\\n\\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\\n\\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\\n#endif\",morphtarget_pars_vertex:\"#ifdef USE_MORPHTARGETS\\n\\tuniform float morphTargetBaseInfluence;\\n\\t#ifndef USE_MORPHNORMALS\\n\\t\\tuniform float morphTargetInfluences[ 8 ];\\n\\t#else\\n\\t\\tuniform float morphTargetInfluences[ 4 ];\\n\\t#endif\\n#endif\",morphtarget_vertex:\"#ifdef USE_MORPHTARGETS\\n\\ttransformed *= morphTargetBaseInfluence;\\n\\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\\n\\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\\n\\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\\n\\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\\n\\t#ifndef USE_MORPHNORMALS\\n\\t\\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\\n\\t\\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\\n\\t\\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\\n\\t\\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\\n\\t#endif\\n#endif\",normal_fragment_begin:\"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\\n#ifdef FLAT_SHADED\\n\\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\\n\\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\\n\\tvec3 normal = normalize( cross( fdx, fdy ) );\\n#else\\n\\tvec3 normal = normalize( vNormal );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\tnormal = normal * faceDirection;\\n\\t#endif\\n\\t#ifdef USE_TANGENT\\n\\t\\tvec3 tangent = normalize( vTangent );\\n\\t\\tvec3 bitangent = normalize( vBitangent );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\ttangent = tangent * faceDirection;\\n\\t\\t\\tbitangent = bitangent * faceDirection;\\n\\t\\t#endif\\n\\t\\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\\n\\t\\t\\tmat3 vTBN = mat3( tangent, bitangent, normal );\\n\\t\\t#endif\\n\\t#endif\\n#endif\\nvec3 geometryNormal = normal;\",normal_fragment_maps:\"#ifdef OBJECTSPACE_NORMALMAP\\n\\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t#ifdef FLIP_SIDED\\n\\t\\tnormal = - normal;\\n\\t#endif\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\tnormal = normal * faceDirection;\\n\\t#endif\\n\\tnormal = normalize( normalMatrix * normal );\\n#elif defined( TANGENTSPACE_NORMALMAP )\\n\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\tmapN.xy *= normalScale;\\n\\t#ifdef USE_TANGENT\\n\\t\\tnormal = normalize( vTBN * mapN );\\n\\t#else\\n\\t\\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\\n\\t#endif\\n#elif defined( USE_BUMPMAP )\\n\\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\\n#endif\",normalmap_pars_fragment:\"#ifdef USE_NORMALMAP\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n#endif\\n#ifdef OBJECTSPACE_NORMALMAP\\n\\tuniform mat3 normalMatrix;\\n#endif\\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\\n\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\\n\\t\\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\\n\\t\\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\\n\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\t\\tvec3 N = surf_norm;\\n\\t\\tvec3 q1perp = cross( q1, N );\\n\\t\\tvec3 q0perp = cross( N, q0 );\\n\\t\\tvec3 T = q1perp * st0.x + q0perp * st1.x;\\n\\t\\tvec3 B = q1perp * st0.y + q0perp * st1.y;\\n\\t\\tfloat det = max( dot( T, T ), dot( B, B ) );\\n\\t\\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\\n\\t\\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\\n\\t}\\n#endif\",clearcoat_normal_fragment_begin:\"#ifdef CLEARCOAT\\n\\tvec3 clearcoatNormal = geometryNormal;\\n#endif\",clearcoat_normal_fragment_maps:\"#ifdef USE_CLEARCOAT_NORMALMAP\\n\\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\\n\\tclearcoatMapN.xy *= clearcoatNormalScale;\\n\\t#ifdef USE_TANGENT\\n\\t\\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\\n\\t#else\\n\\t\\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\\n\\t#endif\\n#endif\",clearcoat_pars_fragment:\"#ifdef USE_CLEARCOATMAP\\n\\tuniform sampler2D clearcoatMap;\\n#endif\\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\\n\\tuniform sampler2D clearcoatRoughnessMap;\\n#endif\\n#ifdef USE_CLEARCOAT_NORMALMAP\\n\\tuniform sampler2D clearcoatNormalMap;\\n\\tuniform vec2 clearcoatNormalScale;\\n#endif\",packing:\"vec3 packNormalToRGB( const in vec3 normal ) {\\n\\treturn normalize( normal ) * 0.5 + 0.5;\\n}\\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\\n\\treturn 2.0 * rgb.xyz - 1.0;\\n}\\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\\nconst float ShiftRight8 = 1. / 256.;\\nvec4 packDepthToRGBA( const in float v ) {\\n\\tvec4 r = vec4( fract( v * PackFactors ), v );\\n\\tr.yzw -= r.xyz * ShiftRight8;\\treturn r * PackUpscale;\\n}\\nfloat unpackRGBAToDepth( const in vec4 v ) {\\n\\treturn dot( v, UnpackFactors );\\n}\\nvec4 pack2HalfToRGBA( vec2 v ) {\\n\\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\\n\\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\\n}\\nvec2 unpackRGBATo2Half( vec4 v ) {\\n\\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\\n}\\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\\n\\treturn ( viewZ + near ) / ( near - far );\\n}\\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\\n\\treturn linearClipZ * ( near - far ) - near;\\n}\\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\\n\\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\\n}\\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\\n\\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\\n}\",premultiplied_alpha_fragment:\"#ifdef PREMULTIPLIED_ALPHA\\n\\tgl_FragColor.rgb *= gl_FragColor.a;\\n#endif\",project_vertex:\"vec4 mvPosition = vec4( transformed, 1.0 );\\n#ifdef USE_INSTANCING\\n\\tmvPosition = instanceMatrix * mvPosition;\\n#endif\\nmvPosition = modelViewMatrix * mvPosition;\\ngl_Position = projectionMatrix * mvPosition;\",dithering_fragment:\"#ifdef DITHERING\\n\\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\\n#endif\",dithering_pars_fragment:\"#ifdef DITHERING\\n\\tvec3 dithering( vec3 color ) {\\n\\t\\tfloat grid_position = rand( gl_FragCoord.xy );\\n\\t\\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\\n\\t\\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\\n\\t\\treturn color + dither_shift_RGB;\\n\\t}\\n#endif\",roughnessmap_fragment:\"float roughnessFactor = roughness;\\n#ifdef USE_ROUGHNESSMAP\\n\\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\\n\\troughnessFactor *= texelRoughness.g;\\n#endif\",roughnessmap_pars_fragment:\"#ifdef USE_ROUGHNESSMAP\\n\\tuniform sampler2D roughnessMap;\\n#endif\",shadowmap_pars_fragment:\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tstruct DirectionalLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tstruct SpotLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tstruct PointLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t\\tfloat shadowCameraNear;\\n\\t\\t\\tfloat shadowCameraFar;\\n\\t\\t};\\n\\t\\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t#endif\\n\\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\\n\\t\\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\\n\\t}\\n\\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\\n\\t\\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\\n\\t}\\n\\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\\n\\t\\tfloat occlusion = 1.0;\\n\\t\\tvec2 distribution = texture2DDistribution( shadow, uv );\\n\\t\\tfloat hard_shadow = step( compare , distribution.x );\\n\\t\\tif (hard_shadow != 1.0 ) {\\n\\t\\t\\tfloat distance = compare - distribution.x ;\\n\\t\\t\\tfloat variance = max( 0.00000, distribution.y * distribution.y );\\n\\t\\t\\tfloat softness_probability = variance / (variance + distance * distance );\\t\\t\\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\\t\\t\\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\\n\\t\\t}\\n\\t\\treturn occlusion;\\n\\t}\\n\\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tfloat shadow = 1.0;\\n\\t\\tshadowCoord.xyz /= shadowCoord.w;\\n\\t\\tshadowCoord.z += shadowBias;\\n\\t\\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\\t\\tbool inFrustum = all( inFrustumVec );\\n\\t\\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\t\\tbool frustumTest = all( frustumTestVec );\\n\\t\\tif ( frustumTest ) {\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx2 = dx0 / 2.0;\\n\\t\\t\\tfloat dy2 = dy0 / 2.0;\\n\\t\\t\\tfloat dx3 = dx1 / 2.0;\\n\\t\\t\\tfloat dy3 = dy1 / 2.0;\\n\\t\\t\\tshadow = (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 17.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx = texelSize.x;\\n\\t\\t\\tfloat dy = texelSize.y;\\n\\t\\t\\tvec2 uv = shadowCoord.xy;\\n\\t\\t\\tvec2 f = fract( uv * shadowMapSize + 0.5 );\\n\\t\\t\\tuv -= f * texelSize;\\n\\t\\t\\tshadow = (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.x ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.x ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.y ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.y ) +\\n\\t\\t\\t\\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t\\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t\\t  f.x ),\\n\\t\\t\\t\\t\\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t\\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t\\t  f.x ),\\n\\t\\t\\t\\t\\t f.y )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_VSM )\\n\\t\\t\\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#else\\n\\t\\t\\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#endif\\n\\t\\t}\\n\\t\\treturn shadow;\\n\\t}\\n\\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\\n\\t\\tvec3 absV = abs( v );\\n\\t\\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\\n\\t\\tabsV *= scaleToCube;\\n\\t\\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\\n\\t\\tvec2 planar = v.xy;\\n\\t\\tfloat almostATexel = 1.5 * texelSizeY;\\n\\t\\tfloat almostOne = 1.0 - almostATexel;\\n\\t\\tif ( absV.z >= almostOne ) {\\n\\t\\t\\tif ( v.z > 0.0 )\\n\\t\\t\\t\\tplanar.x = 4.0 - v.x;\\n\\t\\t} else if ( absV.x >= almostOne ) {\\n\\t\\t\\tfloat signX = sign( v.x );\\n\\t\\t\\tplanar.x = v.z * signX + 2.0 * signX;\\n\\t\\t} else if ( absV.y >= almostOne ) {\\n\\t\\t\\tfloat signY = sign( v.y );\\n\\t\\t\\tplanar.x = v.x + 2.0 * signY + 2.0;\\n\\t\\t\\tplanar.y = v.z * signY - 2.0;\\n\\t\\t}\\n\\t\\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\\n\\t}\\n\\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\\n\\t\\tvec3 lightToPosition = shadowCoord.xyz;\\n\\t\\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\\t\\tdp += shadowBias;\\n\\t\\tvec3 bd3D = normalize( lightToPosition );\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\\n\\t\\t\\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\\n\\t\\t#endif\\n\\t}\\n#endif\",shadowmap_pars_vertex:\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\t\\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tstruct DirectionalLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\t\\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tstruct SpotLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\t\\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tstruct PointLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t\\tfloat shadowCameraNear;\\n\\t\\t\\tfloat shadowCameraFar;\\n\\t\\t};\\n\\t\\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t#endif\\n#endif\",shadowmap_vertex:\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\\n\\t\\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\tvec4 shadowWorldPosition;\\n\\t#endif\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\\n\\t\\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\\n\\t\\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\\n\\t\\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n#endif\",shadowmask_pars_fragment:\"float getShadowMask() {\\n\\tfloat shadow = 1.0;\\n\\t#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\tDirectionalLightShadow directionalLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLightShadows[ i ];\\n\\t\\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\tSpotLightShadow spotLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tspotLight = spotLightShadows[ i ];\\n\\t\\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\tPointLightShadow pointLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tpointLight = pointLightShadows[ i ];\\n\\t\\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#endif\\n\\treturn shadow;\\n}\",skinbase_vertex:\"#ifdef USE_SKINNING\\n\\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n#endif\",skinning_pars_vertex:\"#ifdef USE_SKINNING\\n\\tuniform mat4 bindMatrix;\\n\\tuniform mat4 bindMatrixInverse;\\n\\t#ifdef BONE_TEXTURE\\n\\t\\tuniform highp sampler2D boneTexture;\\n\\t\\tuniform int boneTextureSize;\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tfloat j = i * 4.0;\\n\\t\\t\\tfloat x = mod( j, float( boneTextureSize ) );\\n\\t\\t\\tfloat y = floor( j / float( boneTextureSize ) );\\n\\t\\t\\tfloat dx = 1.0 / float( boneTextureSize );\\n\\t\\t\\tfloat dy = 1.0 / float( boneTextureSize );\\n\\t\\t\\ty = dy * ( y + 0.5 );\\n\\t\\t\\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\\t\\t\\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\\t\\t\\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\\t\\t\\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\t\\t\\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#else\\n\\t\\tuniform mat4 boneMatrices[ MAX_BONES ];\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tmat4 bone = boneMatrices[ int(i) ];\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#endif\\n#endif\",skinning_vertex:\"#ifdef USE_SKINNING\\n\\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\tvec4 skinned = vec4( 0.0 );\\n\\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\\ttransformed = ( bindMatrixInverse * skinned ).xyz;\\n#endif\",skinnormal_vertex:\"#ifdef USE_SKINNING\\n\\tmat4 skinMatrix = mat4( 0.0 );\\n\\tskinMatrix += skinWeight.x * boneMatX;\\n\\tskinMatrix += skinWeight.y * boneMatY;\\n\\tskinMatrix += skinWeight.z * boneMatZ;\\n\\tskinMatrix += skinWeight.w * boneMatW;\\n\\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n\\t#ifdef USE_TANGENT\\n\\t\\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\\n\\t#endif\\n#endif\",specularmap_fragment:\"float specularStrength;\\n#ifdef USE_SPECULARMAP\\n\\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\\tspecularStrength = texelSpecular.r;\\n#else\\n\\tspecularStrength = 1.0;\\n#endif\",specularmap_pars_fragment:\"#ifdef USE_SPECULARMAP\\n\\tuniform sampler2D specularMap;\\n#endif\",tonemapping_fragment:\"#if defined( TONE_MAPPING )\\n\\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\\n#endif\",tonemapping_pars_fragment:\"#ifndef saturate\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#endif\\nuniform float toneMappingExposure;\\nvec3 LinearToneMapping( vec3 color ) {\\n\\treturn toneMappingExposure * color;\\n}\\nvec3 ReinhardToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\treturn saturate( color / ( vec3( 1.0 ) + color ) );\\n}\\nvec3 OptimizedCineonToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\tcolor = max( vec3( 0.0 ), color - 0.004 );\\n\\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\\n}\\nvec3 RRTAndODTFit( vec3 v ) {\\n\\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\\n\\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\\n\\treturn a / b;\\n}\\nvec3 ACESFilmicToneMapping( vec3 color ) {\\n\\tconst mat3 ACESInputMat = mat3(\\n\\t\\tvec3( 0.59719, 0.07600, 0.02840 ),\\t\\tvec3( 0.35458, 0.90834, 0.13383 ),\\n\\t\\tvec3( 0.04823, 0.01566, 0.83777 )\\n\\t);\\n\\tconst mat3 ACESOutputMat = mat3(\\n\\t\\tvec3(  1.60475, -0.10208, -0.00327 ),\\t\\tvec3( -0.53108,  1.10813, -0.07276 ),\\n\\t\\tvec3( -0.07367, -0.00605,  1.07602 )\\n\\t);\\n\\tcolor *= toneMappingExposure / 0.6;\\n\\tcolor = ACESInputMat * color;\\n\\tcolor = RRTAndODTFit( color );\\n\\tcolor = ACESOutputMat * color;\\n\\treturn saturate( color );\\n}\\nvec3 CustomToneMapping( vec3 color ) { return color; }\",transmission_fragment:\"#ifdef USE_TRANSMISSION\\n\\t#ifdef USE_TRANSMISSIONMAP\\n\\t\\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\\n\\t#endif\\n\\t#ifdef USE_THICKNESSNMAP\\n\\t\\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\\n\\t#endif\\n\\tvec3 pos = vWorldPosition.xyz / vWorldPosition.w;\\n\\tvec3 v = normalize( cameraPosition - pos );\\n\\tvec3 viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\\n\\tfloat ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );\\n\\tvec3 f0 = vec3( pow( ior - 1.0, 2.0 ) / pow( ior + 1.0, 2.0 ) );\\n\\tvec3 f90 = vec3( 1.0 );\\n\\tvec3 f_transmission = totalTransmission * getIBLVolumeRefraction(\\n\\t\\tnormal, v, viewDir, roughnessFactor, diffuseColor.rgb, f0, f90,\\n\\t\\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\\n\\t\\tattenuationColor, attenuationDistance);\\n\\tdiffuseColor.rgb = mix( diffuseColor.rgb, f_transmission, totalTransmission );\\n#endif\",transmission_pars_fragment:\"#ifdef USE_TRANSMISSION\\n\\t#ifdef USE_TRANSMISSIONMAP\\n\\t\\tuniform sampler2D transmissionMap;\\n\\t#endif\\n\\t#ifdef USE_THICKNESSMAP\\n\\t\\tuniform sampler2D thicknessMap;\\n\\t#endif\\n\\tuniform vec2 transmissionSamplerSize;\\n\\tuniform sampler2D transmissionSamplerMap;\\n\\tuniform mat4 modelMatrix;\\n\\tuniform mat4 projectionMatrix;\\n\\tvarying vec4 vWorldPosition;\\n\\tvec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {\\n\\t\\tvec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);\\n\\t\\tvec3 modelScale;\\n\\t\\tmodelScale.x = length(vec3(modelMatrix[0].xyz));\\n\\t\\tmodelScale.y = length(vec3(modelMatrix[1].xyz));\\n\\t\\tmodelScale.z = length(vec3(modelMatrix[2].xyz));\\n\\t\\treturn normalize(refractionVector) * thickness * modelScale;\\n\\t}\\n\\tfloat applyIorToRoughness(float roughness, float ior) {\\n\\t\\treturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\\n\\t}\\n\\tvec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {\\n\\t\\tfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\\n\\t\\treturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;\\n\\t}\\n\\tvec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {\\n\\t\\tif (attenuationDistance == 0.0) {\\n\\t\\t\\treturn radiance;\\n\\t\\t} else {\\n\\t\\t\\tvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\\n\\t\\t\\tvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\\t\\t\\treturn transmittance * radiance;\\n\\t\\t}\\n\\t}\\n\\tvec3 getIBLVolumeRefraction(vec3 n, vec3 v, vec3 viewDir, float perceptualRoughness, vec3 baseColor, vec3 f0, vec3 f90,\\n\\t\\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec3 attenuationColor, float attenuationDistance) {\\n\\t\\tvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\\n\\t\\tvec3 refractedRayExit = position + transmissionRay;\\n\\t\\tvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\\n\\t\\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\\n\\t\\trefractionCoords += 1.0;\\n\\t\\trefractionCoords /= 2.0;\\n\\t\\tvec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);\\n\\t\\tvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);\\n\\t\\tfloat NdotV = saturate(dot(n, viewDir));\\n\\t\\tvec2 brdf = integrateSpecularBRDF(NdotV, perceptualRoughness);\\n\\t\\tvec3 specularColor = f0 * brdf.x + f90 * brdf.y;\\n\\t\\treturn (1.0 - specularColor) * attenuatedColor * baseColor;\\n\\t}\\n#endif\",uv_pars_fragment:\"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\\n\\tvarying vec2 vUv;\\n#endif\",uv_pars_vertex:\"#ifdef USE_UV\\n\\t#ifdef UVS_VERTEX_ONLY\\n\\t\\tvec2 vUv;\\n\\t#else\\n\\t\\tvarying vec2 vUv;\\n\\t#endif\\n\\tuniform mat3 uvTransform;\\n#endif\",uv_vertex:\"#ifdef USE_UV\\n\\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\\n#endif\",uv2_pars_fragment:\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvarying vec2 vUv2;\\n#endif\",uv2_pars_vertex:\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tattribute vec2 uv2;\\n\\tvarying vec2 vUv2;\\n\\tuniform mat3 uv2Transform;\\n#endif\",uv2_vertex:\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\\n#endif\",worldpos_vertex:\"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\\n\\tvec4 worldPosition = vec4( transformed, 1.0 );\\n\\t#ifdef USE_INSTANCING\\n\\t\\tworldPosition = instanceMatrix * worldPosition;\\n\\t#endif\\n\\tworldPosition = modelMatrix * worldPosition;\\n#endif\",background_frag:\"uniform sampler2D t2D;\\nvarying vec2 vUv;\\nvoid main() {\\n\\tvec4 texColor = texture2D( t2D, vUv );\\n\\tgl_FragColor = mapTexelToLinear( texColor );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\",background_vert:\"varying vec2 vUv;\\nuniform mat3 uvTransform;\\nvoid main() {\\n\\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\\n\\tgl_Position = vec4( position.xy, 1.0, 1.0 );\\n}\",cube_frag:\"#include <envmap_common_pars_fragment>\\nuniform float opacity;\\nvarying vec3 vWorldDirection;\\n#include <cube_uv_reflection_fragment>\\nvoid main() {\\n\\tvec3 vReflect = vWorldDirection;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = envColor;\\n\\tgl_FragColor.a *= opacity;\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\",cube_vert:\"varying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\tgl_Position.z = gl_Position.w;\\n}\",depth_frag:\"#if DEPTH_PACKING == 3200\\n\\tuniform float opacity;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvarying vec2 vHighPrecisionZW;\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tdiffuseColor.a = opacity;\\n\\t#endif\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\\n\\t#elif DEPTH_PACKING == 3201\\n\\t\\tgl_FragColor = packDepthToRGBA( fragCoordZ );\\n\\t#endif\\n}\",depth_vert:\"#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvarying vec2 vHighPrecisionZW;\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_DISPLACEMENTMAP\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvHighPrecisionZW = gl_Position.zw;\\n}\",distanceRGBA_frag:\"#define DISTANCE\\nuniform vec3 referencePosition;\\nuniform float nearDistance;\\nuniform float farDistance;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main () {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\tfloat dist = length( vWorldPosition - referencePosition );\\n\\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\\n\\tdist = saturate( dist );\\n\\tgl_FragColor = packDepthToRGBA( dist );\\n}\",distanceRGBA_vert:\"#define DISTANCE\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_DISPLACEMENTMAP\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvWorldPosition = worldPosition.xyz;\\n}\",equirect_frag:\"uniform sampler2D tEquirect;\\nvarying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvec3 direction = normalize( vWorldDirection );\\n\\tvec2 sampleUV = equirectUv( direction );\\n\\tvec4 texColor = texture2D( tEquirect, sampleUV );\\n\\tgl_FragColor = mapTexelToLinear( texColor );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\",equirect_vert:\"varying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n}\",linedashed_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\nuniform float dashSize;\\nuniform float totalSize;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\\n\\t\\tdiscard;\\n\\t}\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <color_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n}\",linedashed_vert:\"uniform float scale;\\nattribute float lineDistance;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvLineDistance = scale * lineDistance;\\n\\t#include <color_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n}\",meshbasic_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <fog_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\n\\t\\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\\n\\t\\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\\n\\t#else\\n\\t\\treflectedLight.indirectDiffuse += vec3( 1.0 );\\n\\t#endif\\n\\t#include <aomap_fragment>\\n\\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\\n\\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshbasic_vert:\"#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_ENVMAP\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshlambert_frag:\"uniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\nvarying vec3 vLightFront;\\nvarying vec3 vIndirectFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n\\tvarying vec3 vIndirectBack;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\\n\\t#else\\n\\t\\treflectedLight.indirectDiffuse += vIndirectFront;\\n\\t#endif\\n\\t#include <lightmap_fragment>\\n\\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\\n\\t#else\\n\\t\\treflectedLight.directDiffuse = vLightFront;\\n\\t#endif\\n\\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshlambert_vert:\"#define LAMBERT\\nvarying vec3 vLightFront;\\nvarying vec3 vIndirectFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n\\tvarying vec3 vIndirectBack;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <lights_lambert_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshmatcap_frag:\"#define MATCAP\\nuniform vec3 diffuse;\\nuniform float opacity;\\nuniform sampler2D matcap;\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\tvec3 viewDir = normalize( vViewPosition );\\n\\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\\n\\tvec3 y = cross( viewDir, x );\\n\\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\\n\\t#ifdef USE_MATCAP\\n\\t\\tvec4 matcapColor = texture2D( matcap, uv );\\n\\t\\tmatcapColor = matcapTexelToLinear( matcapColor );\\n\\t#else\\n\\t\\tvec4 matcapColor = vec4( 1.0 );\\n\\t#endif\\n\\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshmatcap_vert:\"#define MATCAP\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <color_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#ifndef FLAT_SHADED\\n\\t\\tvNormal = normalize( transformedNormal );\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n}\",meshtoon_frag:\"#define TOON\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <gradientmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <lights_toon_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_toon_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshtoon_vert:\"#define TOON\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshphong_frag:\"#define PHONG\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform vec3 specular;\\nuniform float shininess;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <lights_phong_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_phong_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshphong_vert:\"#define PHONG\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshphysical_frag:\"#define STANDARD\\n#ifdef PHYSICAL\\n\\t#define REFLECTIVITY\\n\\t#define CLEARCOAT\\n#endif\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n#ifdef USE_TRANSMISSION\\n\\tuniform float transmission;\\n\\tuniform float thickness;\\n\\tuniform vec3 attenuationColor;\\n\\tuniform float attenuationDistance;\\n#endif\\n#ifdef REFLECTIVITY\\n\\tuniform float reflectivity;\\n#endif\\n#ifdef CLEARCOAT\\n\\tuniform float clearcoat;\\n\\tuniform float clearcoatRoughness;\\n#endif\\n#ifdef USE_SHEEN\\n\\tuniform vec3 sheen;\\n#endif\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n\\t#ifdef USE_TANGENT\\n\\t\\tvarying vec3 vTangent;\\n\\t\\tvarying vec3 vBitangent;\\n\\t#endif\\n#endif\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <bsdfs>\\n#include <transmission_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_physical_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <lights_pars_begin>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <clearcoat_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#ifdef USE_TRANSMISSION\\n\\t\\tfloat totalTransmission = transmission;\\n\\t\\tfloat thicknessFactor = thickness;\\n\\t#endif\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <clearcoat_normal_fragment_begin>\\n\\t#include <clearcoat_normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\tvec3 rawDiffuseColor = diffuseColor.rgb;\\n\\t#include <transmission_fragment>\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshphysical_vert:\"#define STANDARD\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n\\t#ifdef USE_TANGENT\\n\\t\\tvarying vec3 vTangent;\\n\\t\\tvarying vec3 vBitangent;\\n\\t#endif\\n#endif\\n#ifdef USE_TRANSMISSION\\n\\tvarying vec4 vWorldPosition;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n\\t#ifdef USE_TANGENT\\n\\t\\tvTangent = normalize( transformedTangent );\\n\\t\\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\\n\\t#endif\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n#ifdef USE_TRANSMISSION\\n\\tvWorldPosition = worldPosition;\\n#endif\\n}\",normal_frag:\"#define NORMAL\\nuniform float opacity;\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n\\t#ifdef USE_TANGENT\\n\\t\\tvarying vec3 vTangent;\\n\\t\\tvarying vec3 vBitangent;\\n\\t#endif\\n#endif\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\\n}\",normal_vert:\"#define NORMAL\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n\\t#ifdef USE_TANGENT\\n\\t\\tvarying vec3 vTangent;\\n\\t\\tvarying vec3 vBitangent;\\n\\t#endif\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n\\t#ifdef USE_TANGENT\\n\\t\\tvTangent = normalize( transformedTangent );\\n\\t\\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\\n\\t#endif\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\\n}\",points_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <map_particle_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_particle_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n}\",points_vert:\"uniform float size;\\nuniform float scale;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\tgl_PointSize = size;\\n\\t#ifdef USE_SIZEATTENUATION\\n\\t\\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\\n\\t\\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\\n\\t#endif\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <fog_vertex>\\n}\",shadow_frag:\"uniform vec3 color;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\nvoid main() {\\n\\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\",shadow_vert:\"#include <common>\\n#include <fog_pars_vertex>\\n#include <shadowmap_pars_vertex>\\nvoid main() {\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",sprite_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\",sprite_vert:\"uniform float rotation;\\nuniform vec2 center;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\tvec2 scale;\\n\\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\\n\\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\\n\\t#ifndef USE_SIZEATTENUATION\\n\\t\\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\\n\\t\\tif ( isPerspective ) scale *= - mvPosition.z;\\n\\t#endif\\n\\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\\n\\tvec2 rotatedPosition;\\n\\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\\n\\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\\n\\tmvPosition.xy += rotatedPosition;\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n}\"},Vo={common:{diffuse:{value:new Oi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Jn},uv2Transform:{value:new Jn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Zn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Oi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Oi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Jn}},sprite:{diffuse:{value:new Oi(16777215)},opacity:{value:1},center:{value:new Zn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Jn}}},Ho={basic:{uniforms:Lo([Vo.common,Vo.specularmap,Vo.envmap,Vo.aomap,Vo.lightmap,Vo.fog]),vertexShader:ko.meshbasic_vert,fragmentShader:ko.meshbasic_frag},lambert:{uniforms:Lo([Vo.common,Vo.specularmap,Vo.envmap,Vo.aomap,Vo.lightmap,Vo.emissivemap,Vo.fog,Vo.lights,{emissive:{value:new Oi(0)}}]),vertexShader:ko.meshlambert_vert,fragmentShader:ko.meshlambert_frag},phong:{uniforms:Lo([Vo.common,Vo.specularmap,Vo.envmap,Vo.aomap,Vo.lightmap,Vo.emissivemap,Vo.bumpmap,Vo.normalmap,Vo.displacementmap,Vo.fog,Vo.lights,{emissive:{value:new Oi(0)},specular:{value:new Oi(1118481)},shininess:{value:30}}]),vertexShader:ko.meshphong_vert,fragmentShader:ko.meshphong_frag},standard:{uniforms:Lo([Vo.common,Vo.envmap,Vo.aomap,Vo.lightmap,Vo.emissivemap,Vo.bumpmap,Vo.normalmap,Vo.displacementmap,Vo.roughnessmap,Vo.metalnessmap,Vo.fog,Vo.lights,{emissive:{value:new Oi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ko.meshphysical_vert,fragmentShader:ko.meshphysical_frag},toon:{uniforms:Lo([Vo.common,Vo.aomap,Vo.lightmap,Vo.emissivemap,Vo.bumpmap,Vo.normalmap,Vo.displacementmap,Vo.gradientmap,Vo.fog,Vo.lights,{emissive:{value:new Oi(0)}}]),vertexShader:ko.meshtoon_vert,fragmentShader:ko.meshtoon_frag},matcap:{uniforms:Lo([Vo.common,Vo.bumpmap,Vo.normalmap,Vo.displacementmap,Vo.fog,{matcap:{value:null}}]),vertexShader:ko.meshmatcap_vert,fragmentShader:ko.meshmatcap_frag},points:{uniforms:Lo([Vo.points,Vo.fog]),vertexShader:ko.points_vert,fragmentShader:ko.points_frag},dashed:{uniforms:Lo([Vo.common,Vo.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ko.linedashed_vert,fragmentShader:ko.linedashed_frag},depth:{uniforms:Lo([Vo.common,Vo.displacementmap]),vertexShader:ko.depth_vert,fragmentShader:ko.depth_frag},normal:{uniforms:Lo([Vo.common,Vo.bumpmap,Vo.normalmap,Vo.displacementmap,{opacity:{value:1}}]),vertexShader:ko.normal_vert,fragmentShader:ko.normal_frag},sprite:{uniforms:Lo([Vo.sprite,Vo.fog]),vertexShader:ko.sprite_vert,fragmentShader:ko.sprite_frag},background:{uniforms:{uvTransform:{value:new Jn},t2D:{value:null}},vertexShader:ko.background_vert,fragmentShader:ko.background_frag},cube:{uniforms:Lo([Vo.envmap,{opacity:{value:1}}]),vertexShader:ko.cube_vert,fragmentShader:ko.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ko.equirect_vert,fragmentShader:ko.equirect_frag},distanceRGBA:{uniforms:Lo([Vo.common,Vo.displacementmap,{referencePosition:{value:new ar},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ko.distanceRGBA_vert,fragmentShader:ko.distanceRGBA_frag},shadow:{uniforms:Lo([Vo.lights,Vo.fog,{color:{value:new Oi(0)},opacity:{value:1}}]),vertexShader:ko.shadow_vert,fragmentShader:ko.shadow_frag}};function jo(e,t,n,r,i){const o=new Oi(0);let s,a,l=0,c=null,u=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),l=t,d(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,d(o,l)},render:function(n,i){let p=!1,g=!0===i.isScene?i.background:null;g&&g.isTexture&&(g=t.get(g));const v=e.xr,y=v.getSession&&v.getSession();y&&\"additive\"===y.environmentBlendMode&&(g=null),null===g?d(o,l):g&&g.isColor&&(d(g,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===ce)?(void 0===a&&(a=new Mo(new To(1,1,1),new Po({name:\"BackgroundCubeMaterial\",uniforms:Eo(Ho.cube.uniforms),vertexShader:Ho.cube.vertexShader,fragmentShader:Ho.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute(\"normal\"),a.geometry.deleteAttribute(\"uv\"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,\"envMap\",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),a.material.uniforms.envMap.value=g,a.material.uniforms.flipEnvMap.value=g.isCubeTexture&&g._needsFlipEnvMap?-1:1,c===g&&u===g.version&&h===e.toneMapping||(a.material.needsUpdate=!0,c=g,u=g.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):g&&g.isTexture&&(void 0===s&&(s=new Mo(new Uo(2,2),new Po({name:\"BackgroundMaterial\",uniforms:Eo(Ho.background.uniforms),vertexShader:Ho.background.vertexShader,fragmentShader:Ho.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute(\"normal\"),Object.defineProperty(s.material,\"map\",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),s.material.uniforms.uvTransform.value.copy(g.matrix),c===g&&u===g.version&&h===e.toneMapping||(s.material.needsUpdate=!0,c=g,u=g.version,h=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function Wo(e,t,n,r){const i=e.getParameter(34921),o=r.isWebGL2?null:t.get(\"OES_vertex_array_object\"),s=r.isWebGL2||null!==o,a={},l=d(null);let c=l;function u(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function d(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,i){const o=c.newAttributes,s=c.enabledAttributes,a=c.attributeDivisors;if(o[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),a[n]!==i){(r.isWebGL2?e:t.get(\"ANGLE_instanced_arrays\"))[r.isWebGL2?\"vertexAttribDivisor\":\"vertexAttribDivisorANGLE\"](n,i),a[n]=i}}function g(){const t=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function v(t,n,i,o,s,a){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,o,s,a):e.vertexAttribIPointer(t,n,i,s,a)}function y(){x(),c!==l&&(c=l,u(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,y,x){let _=!1;if(s){const t=function(t,n,i){const s=!0===i.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[s];void 0===u&&(u=d(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[s]=u);return u}(y,h,l);c!==t&&(c=t,u(c.object)),_=function(e,t){const n=c.attributes,r=e.attributes;let i=0;for(const e in r){const t=n[e],o=r[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;i++}return c.attributesNum!==i||c.index!==t}(y,x),_&&function(e,t){const n={},r=e.attributes;let i=0;for(const e in r){const t=r[e],o={};o.attribute=t,t.data&&(o.data=t.data),n[e]=o,i++}c.attributes=n,c.attributesNum=i,c.index=t}(y,x)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===e||(c.geometry=y.id,c.program=h.id,c.wireframe=e,_=!0)}!0===i.isInstancedMesh&&(_=!0),null!==x&&n.update(x,34963),_&&(!function(i,o,s,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get(\"ANGLE_instanced_arrays\"))return;p();const l=a.attributes,c=s.getAttributes(),u=o.defaultAttributeValues;for(const t in c){const r=c[t];if(r>=0){const o=l[t];if(void 0!==o){const t=o.normalized,i=o.itemSize,s=n.get(o);if(void 0===s)continue;const l=s.buffer,c=s.type,u=s.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,s=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(m(r,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(r),e.bindBuffer(34962,l),v(r,i,c,t,s*u,h*u)}else o.isInstancedBufferAttribute?(m(r,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):f(r),e.bindBuffer(34962,l),v(r,i,c,t,0,0)}else if(\"instanceMatrix\"===t){const t=n.get(i.instanceMatrix);if(void 0===t)continue;const o=t.buffer,s=t.type;m(r+0,1),m(r+1,1),m(r+2,1),m(r+3,1),e.bindBuffer(34962,o),e.vertexAttribPointer(r+0,4,s,!1,64,0),e.vertexAttribPointer(r+1,4,s,!1,64,16),e.vertexAttribPointer(r+2,4,s,!1,64,32),e.vertexAttribPointer(r+3,4,s,!1,64,48)}else if(\"instanceColor\"===t){const t=n.get(i.instanceColor);if(void 0===t)continue;const o=t.buffer,s=t.type;m(r,1),e.bindBuffer(34962,o),e.vertexAttribPointer(r,3,s,!1,12,0)}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r,n);break;case 3:e.vertexAttrib3fv(r,n);break;case 4:e.vertexAttrib4fv(r,n);break;default:e.vertexAttrib1fv(r,n)}}}}g()}(i,l,h,y),null!==x&&e.bindBuffer(34963,n.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)h(r[e].object),delete r[e];delete n[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function qo(e,t,n,r){const i=r.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),n.update(r,o,1)},this.renderInstances=function(r,s,a){if(0===a)return;let l,c;if(i)l=e,c=\"drawArraysInstanced\";else if(l=t.get(\"ANGLE_instanced_arrays\"),c=\"drawArraysInstancedANGLE\",null===l)return void console.error(\"THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");l[c](o,r,s,a),n.update(s,o,a)}}function Xo(e,t,n){let r;function i(t){if(\"highp\"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return\"highp\";t=\"mediump\"}return\"mediump\"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?\"mediump\":\"lowp\"}const o=\"undefined\"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||\"undefined\"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:\"highp\";const a=i(s);a!==s&&(console.warn(\"THREE.WebGLRenderer:\",s,\"not supported, using\",a,\"instead.\"),s=a);const l=o||t.has(\"WEBGL_draw_buffers\"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=h>0,x=o||t.has(\"OES_texture_float\");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has(\"EXT_texture_filter_anisotropic\")){const n=t.get(\"EXT_texture_filter_anisotropic\");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:o?e.getParameter(36183):0}}function Yo(e){const t=this;let n=null,r=0,i=!1,o=!1;const s=new pi,a=new Jn,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(e,n,r,i){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==i||null===c){const t=r+4*o,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==o;++t,n+=4)s.copy(e[t]).applyMatrix4(i,a),s.normal.toArray(c,n),c[n+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const s=0!==e.length||t||0!==r||i;return i=t,n=u(e,o,0),r=e.length,s},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,c()},this.setState=function(t,s,a){const h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!i||null===h||0===h.length||o&&!p)o?u(null):c();else{const e=o?0:r,t=4*e;let i=f.clippingState||null;l.value=i,i=u(h,s,t,a);for(let e=0;e!==t;++e)i[e]=n[e];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Zo(e){let t=new WeakMap;function n(e,t){return t===ae?e.mapping=oe:t===le&&(e.mapping=se),e}function r(e){const n=e.target;n.removeEventListener(\"dispose\",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping;if(o===ae||o===le){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const o=i.image;if(o&&o.height>0){const s=e.getRenderTarget(),a=new Do(o.height/2);return a.fromEquirectangularTexture(e,i),t.set(i,a),e.setRenderTarget(s),i.addEventListener(\"dispose\",r),n(a.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}function Jo(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case\"WEBGL_depth_texture\":r=e.getExtension(\"WEBGL_depth_texture\")||e.getExtension(\"MOZ_WEBGL_depth_texture\")||e.getExtension(\"WEBKIT_WEBGL_depth_texture\");break;case\"EXT_texture_filter_anisotropic\":r=e.getExtension(\"EXT_texture_filter_anisotropic\")||e.getExtension(\"MOZ_EXT_texture_filter_anisotropic\")||e.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\");break;case\"WEBGL_compressed_texture_s3tc\":r=e.getExtension(\"WEBGL_compressed_texture_s3tc\")||e.getExtension(\"MOZ_WEBGL_compressed_texture_s3tc\")||e.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\");break;case\"WEBGL_compressed_texture_pvrtc\":r=e.getExtension(\"WEBGL_compressed_texture_pvrtc\")||e.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n(\"EXT_color_buffer_float\"):(n(\"WEBGL_depth_texture\"),n(\"OES_texture_float\"),n(\"OES_texture_half_float\"),n(\"OES_texture_half_float_linear\"),n(\"OES_standard_derivatives\"),n(\"OES_element_index_uint\"),n(\"OES_vertex_array_object\"),n(\"ANGLE_instanced_arrays\")),n(\"OES_texture_float_linear\"),n(\"EXT_color_buffer_half_float\")},get:function(e){const t=n(e);return null===t&&console.warn(\"THREE.WebGLRenderer: \"+e+\" extension not supported.\"),t}}}function Ko(e,t,n,r){const i={},o=new WeakMap;function s(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener(\"dispose\",s),delete i[a.id];const l=o.get(a);l&&(t.remove(l),o.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],r=e.index,i=e.attributes.position;let s=0;if(null!==r){const e=r.array;s=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],o=e[t+2];n.push(r,i,i,o,o,r)}}else{const e=i.array;s=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const a=new(Yi(n)>65535?ji:Vi)(n,1);a.version=s;const l=o.get(e);l&&t.remove(l),o.set(e,a)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener(\"dispose\",s),i[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const r=e.morphAttributes;for(const e in r){const n=r[e];for(let e=0,r=n.length;e<r;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function $o(e,t,n,r){const i=r.isWebGL2;let o,s,a;this.setMode=function(e){o=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,s,t*a),n.update(r,o,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=e,h=\"drawElementsInstanced\";else if(u=t.get(\"ANGLE_instanced_arrays\"),h=\"drawElementsInstancedANGLE\",null===u)return void console.error(\"THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");u[h](o,l,s,r*a,c),n.update(l,o,c)}}function Qo(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error(\"THREE.WebGLInfo: Unknown draw mode:\",n)}}}}function es(e,t){return e[0]-t[0]}function ts(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ns(e){const t={},n=new Float32Array(8),r=[];for(let e=0;e<8;e++)r[e]=[e,0];return{update:function(i,o,s,a){const l=i.morphTargetInfluences,c=void 0===l?0:l.length;let u=t[o.id];if(void 0===u){u=[];for(let e=0;e<c;e++)u[e]=[e,0];t[o.id]=u}for(let e=0;e<c;e++){const t=u[e];t[0]=e,t[1]=l[e]}u.sort(ts);for(let e=0;e<8;e++)e<c&&u[e][1]?(r[e][0]=u[e][0],r[e][1]=u[e][1]):(r[e][0]=Number.MAX_SAFE_INTEGER,r[e][1]=0);r.sort(es);const h=s.morphTargets&&o.morphAttributes.position,d=s.morphNormals&&o.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=r[e],i=t[0],s=t[1];i!==Number.MAX_SAFE_INTEGER&&s?(h&&o.getAttribute(\"morphTarget\"+e)!==h[i]&&o.setAttribute(\"morphTarget\"+e,h[i]),d&&o.getAttribute(\"morphNormal\"+e)!==d[i]&&o.setAttribute(\"morphNormal\"+e,d[i]),n[e]=s,p+=s):(h&&!0===o.hasAttribute(\"morphTarget\"+e)&&o.deleteAttribute(\"morphTarget\"+e),d&&!0===o.hasAttribute(\"morphNormal\"+e)&&o.deleteAttribute(\"morphNormal\"+e),n[e]=0)}const f=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,\"morphTargetBaseInfluence\",f),a.getUniforms().setValue(e,\"morphTargetInfluences\",n)}}}function rs(e,t,n,r){let i=new WeakMap;function o(e){const t=e.target;t.removeEventListener(\"dispose\",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const s=r.render.frame,a=e.geometry,l=t.get(e,a);return i.get(l)!==s&&(t.update(l),i.set(l,s)),e.isInstancedMesh&&(!1===e.hasEventListener(\"dispose\",o)&&e.addEventListener(\"dispose\",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}Ho.physical={uniforms:Lo([Ho.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Zn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Oi(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Zn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Oi(0)}}]),vertexShader:ko.meshphysical_vert,fragmentShader:ko.meshphysical_frag};class is extends er{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=fe,this.minFilter=fe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}is.prototype.isDataTexture2DArray=!0;class os extends er{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=fe,this.minFilter=fe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}os.prototype.isDataTexture3D=!0;const ss=new er,as=new is,ls=new os,cs=new Oo,us=[],hs=[],ds=new Float32Array(16),ps=new Float32Array(9),fs=new Float32Array(4);function ms(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let o=us[i];if(void 0===o&&(o=new Float32Array(i),us[i]=o),0!==t){r.toArray(o,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(o,i)}return o}function gs(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function vs(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function ys(e,t){let n=hs[t];void 0===n&&(n=new Int32Array(t),hs[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function xs(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function _s(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(gs(n,t))return;e.uniform2fv(this.addr,t),vs(n,t)}}function bs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(gs(n,t))return;e.uniform3fv(this.addr,t),vs(n,t)}}function ws(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(gs(n,t))return;e.uniform4fv(this.addr,t),vs(n,t)}}function Ms(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(gs(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),vs(n,t)}else{if(gs(n,r))return;fs.set(r),e.uniformMatrix2fv(this.addr,!1,fs),vs(n,r)}}function Ss(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(gs(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),vs(n,t)}else{if(gs(n,r))return;ps.set(r),e.uniformMatrix3fv(this.addr,!1,ps),vs(n,r)}}function Ts(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(gs(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),vs(n,t)}else{if(gs(n,r))return;ds.set(r),e.uniformMatrix4fv(this.addr,!1,ds),vs(n,r)}}function Es(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ls(e,t){const n=this.cache;gs(n,t)||(e.uniform2iv(this.addr,t),vs(n,t))}function As(e,t){const n=this.cache;gs(n,t)||(e.uniform3iv(this.addr,t),vs(n,t))}function Ps(e,t){const n=this.cache;gs(n,t)||(e.uniform4iv(this.addr,t),vs(n,t))}function Cs(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Rs(e,t){const n=this.cache;gs(n,t)||(e.uniform2uiv(this.addr,t),vs(n,t))}function Is(e,t){const n=this.cache;gs(n,t)||(e.uniform3uiv(this.addr,t),vs(n,t))}function Os(e,t){const n=this.cache;gs(n,t)||(e.uniform4uiv(this.addr,t),vs(n,t))}function Ds(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||ss,i)}function Ns(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||ls,i)}function zs(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||cs,i)}function Bs(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||as,i)}function Fs(e,t){e.uniform1fv(this.addr,t)}function Gs(e,t){const n=ms(t,this.size,2);e.uniform2fv(this.addr,n)}function Us(e,t){const n=ms(t,this.size,3);e.uniform3fv(this.addr,n)}function ks(e,t){const n=ms(t,this.size,4);e.uniform4fv(this.addr,n)}function Vs(e,t){const n=ms(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Hs(e,t){const n=ms(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function js(e,t){const n=ms(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Ws(e,t){e.uniform1iv(this.addr,t)}function qs(e,t){e.uniform2iv(this.addr,t)}function Xs(e,t){e.uniform3iv(this.addr,t)}function Ys(e,t){e.uniform4iv(this.addr,t)}function Zs(e,t){e.uniform1uiv(this.addr,t)}function Js(e,t){e.uniform2uiv(this.addr,t)}function Ks(e,t){e.uniform3uiv(this.addr,t)}function $s(e,t){e.uniform4uiv(this.addr,t)}function Qs(e,t,n){const r=t.length,i=ys(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTexture2D(t[e]||ss,i[e])}function ea(e,t,n){const r=t.length,i=ys(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTextureCube(t[e]||cs,i[e])}function ta(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return xs;case 35664:return _s;case 35665:return bs;case 35666:return ws;case 35674:return Ms;case 35675:return Ss;case 35676:return Ts;case 5124:case 35670:return Es;case 35667:case 35671:return Ls;case 35668:case 35672:return As;case 35669:case 35673:return Ps;case 5125:return Cs;case 36294:return Rs;case 36295:return Is;case 36296:return Os;case 35678:case 36198:case 36298:case 36306:case 35682:return Ds;case 35679:case 36299:case 36307:return Ns;case 35680:case 36300:case 36308:case 36293:return zs;case 36289:case 36303:case 36311:case 36292:return Bs}}(t.type)}function na(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Fs;case 35664:return Gs;case 35665:return Us;case 35666:return ks;case 35674:return Vs;case 35675:return Hs;case 35676:return js;case 5124:case 35670:return Ws;case 35667:case 35671:return qs;case 35668:case 35672:return Xs;case 35669:case 35673:return Ys;case 5125:return Zs;case 36294:return Js;case 36295:return Ks;case 36296:return $s;case 35678:case 36198:case 36298:case 36306:case 35682:return Qs;case 35680:case 36300:case 36308:case 36293:return ea}}(t.type)}function ra(e){this.id=e,this.seq=[],this.map={}}na.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),vs(t,e)},ra.prototype.setValue=function(e,t,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(e,t[o.id],n)}};const ia=/(\\w+)(\\])?(\\[|\\.)?/g;function oa(e,t){e.seq.push(t),e.map[t.id]=t}function sa(e,t,n){const r=e.name,i=r.length;for(ia.lastIndex=0;;){const o=ia.exec(r),s=ia.lastIndex;let a=o[1];const l=\"]\"===o[2],c=o[3];if(l&&(a|=0),void 0===c||\"[\"===c&&s+2===i){oa(n,void 0===c?new ta(a,e,t):new na(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new ra(a),oa(n,e)),n=e}}}function aa(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);sa(n,e.getUniformLocation(t,n.name),this)}}function la(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}aa.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},aa.prototype.setOptional=function(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)},aa.upload=function(e,t,n,r){for(let i=0,o=t.length;i!==o;++i){const o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},aa.seqWithValue=function(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n};let ca=0;function ua(e){switch(e){case Jt:return[\"Linear\",\"( value )\"];case Kt:return[\"sRGB\",\"( value )\"];case Qt:return[\"RGBE\",\"( value )\"];case tn:return[\"RGBM\",\"( value, 7.0 )\"];case nn:return[\"RGBM\",\"( value, 16.0 )\"];case rn:return[\"RGBD\",\"( value, 256.0 )\"];case $t:return[\"Gamma\",\"( value, float( GAMMA_FACTOR ) )\"];case en:return[\"LogLuv\",\"( value )\"];default:return console.warn(\"THREE.WebGLProgram: Unsupported encoding:\",e),[\"Linear\",\"( value )\"]}}function ha(e,t,n){const r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(r&&\"\"===i)return\"\";return\"THREE.WebGLShader: gl.getShaderInfoLog() \"+n+\"\\n\"+i+function(e){const t=e.split(\"\\n\");for(let e=0;e<t.length;e++)t[e]=e+1+\": \"+t[e];return t.join(\"\\n\")}(e.getShaderSource(t))}function da(e,t){const n=ua(t);return\"vec4 \"+e+\"( vec4 value ) { return \"+n[0]+\"ToLinear\"+n[1]+\"; }\"}function pa(e,t){const n=ua(t);return\"vec4 \"+e+\"( vec4 value ) { return LinearTo\"+n[0]+n[1]+\"; }\"}function fa(e,t){let n;switch(t){case Q:n=\"Linear\";break;case ee:n=\"Reinhard\";break;case te:n=\"OptimizedCineon\";break;case ne:n=\"ACESFilmic\";break;case re:n=\"Custom\";break;default:console.warn(\"THREE.WebGLProgram: Unsupported toneMapping:\",t),n=\"Linear\"}return\"vec3 \"+e+\"( vec3 color ) { return \"+n+\"ToneMapping( color ); }\"}function ma(e){return\"\"!==e}function ga(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function va(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const ya=/^[ \\t]*#include +<([\\w\\d./]+)>/gm;function xa(e){return e.replace(ya,_a)}function _a(e,t){const n=ko[t];if(void 0===n)throw new Error(\"Can not resolve #include <\"+t+\">\");return xa(n)}const ba=/#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g,wa=/#pragma unroll_loop_start\\s+for\\s*\\(\\s*int\\s+i\\s*=\\s*(\\d+)\\s*;\\s*i\\s*<\\s*(\\d+)\\s*;\\s*i\\s*\\+\\+\\s*\\)\\s*{([\\s\\S]+?)}\\s+#pragma unroll_loop_end/g;function Ma(e){return e.replace(wa,Ta).replace(ba,Sa)}function Sa(e,t,n,r){return console.warn(\"WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.\"),Ta(e,t,n,r)}function Ta(e,t,n,r){let i=\"\";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\\[\\s*i\\s*\\]/g,\"[ \"+e+\" ]\").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function Ea(e){let t=\"precision \"+e.precision+\" float;\\nprecision \"+e.precision+\" int;\";return\"highp\"===e.precision?t+=\"\\n#define HIGH_PRECISION\":\"mediump\"===e.precision?t+=\"\\n#define MEDIUM_PRECISION\":\"lowp\"===e.precision&&(t+=\"\\n#define LOW_PRECISION\"),t}function La(e,t,n,r){const i=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const l=function(e){let t=\"SHADOWMAP_TYPE_BASIC\";return e.shadowMapType===h?t=\"SHADOWMAP_TYPE_PCF\":e.shadowMapType===d?t=\"SHADOWMAP_TYPE_PCF_SOFT\":e.shadowMapType===p&&(t=\"SHADOWMAP_TYPE_VSM\"),t}(n),c=function(e){let t=\"ENVMAP_TYPE_CUBE\";if(e.envMap)switch(e.envMapMode){case oe:case se:t=\"ENVMAP_TYPE_CUBE\";break;case ce:case ue:t=\"ENVMAP_TYPE_CUBE_UV\"}return t}(n),u=function(e){let t=\"ENVMAP_MODE_REFLECTION\";if(e.envMap)switch(e.envMapMode){case se:case ue:t=\"ENVMAP_MODE_REFRACTION\"}return t}(n),f=function(e){let t=\"ENVMAP_BLENDING_NONE\";if(e.envMap)switch(e.combine){case Z:t=\"ENVMAP_BLENDING_MULTIPLY\";break;case J:t=\"ENVMAP_BLENDING_MIX\";break;case K:t=\"ENVMAP_BLENDING_ADD\"}return t}(n),m=e.gammaFactor>0?e.gammaFactor:1,g=n.isWebGL2?\"\":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||\"physical\"===e.shaderID?\"#extension GL_OES_standard_derivatives : enable\":\"\",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?\"#extension GL_EXT_frag_depth : enable\":\"\",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?\"#extension GL_EXT_draw_buffers : require\":\"\",(e.extensionShaderTextureLOD||e.envMap||e.transmission>0)&&e.rendererExtensionShaderTextureLod?\"#extension GL_EXT_shader_texture_lod : enable\":\"\"].filter(ma).join(\"\\n\")}(n),v=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push(\"#define \"+n+\" \"+r)}return t.join(\"\\n\")}(o),y=i.createProgram();let x,_,b=n.glslVersion?\"#version \"+n.glslVersion+\"\\n\":\"\";n.isRawShaderMaterial?(x=[v].filter(ma).join(\"\\n\"),x.length>0&&(x+=\"\\n\"),_=[g,v].filter(ma).join(\"\\n\"),_.length>0&&(_+=\"\\n\")):(x=[Ea(n),\"#define SHADER_NAME \"+n.shaderName,v,n.instancing?\"#define USE_INSTANCING\":\"\",n.instancingColor?\"#define USE_INSTANCING_COLOR\":\"\",n.supportsVertexTextures?\"#define VERTEX_TEXTURES\":\"\",\"#define GAMMA_FACTOR \"+m,\"#define MAX_BONES \"+n.maxBones,n.useFog&&n.fog?\"#define USE_FOG\":\"\",n.useFog&&n.fogExp2?\"#define FOG_EXP2\":\"\",n.map?\"#define USE_MAP\":\"\",n.envMap?\"#define USE_ENVMAP\":\"\",n.envMap?\"#define \"+u:\"\",n.lightMap?\"#define USE_LIGHTMAP\":\"\",n.aoMap?\"#define USE_AOMAP\":\"\",n.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",n.bumpMap?\"#define USE_BUMPMAP\":\"\",n.normalMap?\"#define USE_NORMALMAP\":\"\",n.normalMap&&n.objectSpaceNormalMap?\"#define OBJECTSPACE_NORMALMAP\":\"\",n.normalMap&&n.tangentSpaceNormalMap?\"#define TANGENTSPACE_NORMALMAP\":\"\",n.clearcoatMap?\"#define USE_CLEARCOATMAP\":\"\",n.clearcoatRoughnessMap?\"#define USE_CLEARCOAT_ROUGHNESSMAP\":\"\",n.clearcoatNormalMap?\"#define USE_CLEARCOAT_NORMALMAP\":\"\",n.displacementMap&&n.supportsVertexTextures?\"#define USE_DISPLACEMENTMAP\":\"\",n.specularMap?\"#define USE_SPECULARMAP\":\"\",n.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",n.metalnessMap?\"#define USE_METALNESSMAP\":\"\",n.alphaMap?\"#define USE_ALPHAMAP\":\"\",n.transmission?\"#define USE_TRANSMISSION\":\"\",n.transmissionMap?\"#define USE_TRANSMISSIONMAP\":\"\",n.thicknessMap?\"#define USE_THICKNESSMAP\":\"\",n.vertexTangents?\"#define USE_TANGENT\":\"\",n.vertexColors?\"#define USE_COLOR\":\"\",n.vertexAlphas?\"#define USE_COLOR_ALPHA\":\"\",n.vertexUvs?\"#define USE_UV\":\"\",n.uvsVertexOnly?\"#define UVS_VERTEX_ONLY\":\"\",n.flatShading?\"#define FLAT_SHADED\":\"\",n.skinning?\"#define USE_SKINNING\":\"\",n.useVertexTexture?\"#define BONE_TEXTURE\":\"\",n.morphTargets?\"#define USE_MORPHTARGETS\":\"\",n.morphNormals&&!1===n.flatShading?\"#define USE_MORPHNORMALS\":\"\",n.doubleSided?\"#define DOUBLE_SIDED\":\"\",n.flipSided?\"#define FLIP_SIDED\":\"\",n.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",n.shadowMapEnabled?\"#define \"+l:\"\",n.sizeAttenuation?\"#define USE_SIZEATTENUATION\":\"\",n.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?\"#define USE_LOGDEPTHBUF_EXT\":\"\",\"uniform mat4 modelMatrix;\",\"uniform mat4 modelViewMatrix;\",\"uniform mat4 projectionMatrix;\",\"uniform mat4 viewMatrix;\",\"uniform mat3 normalMatrix;\",\"uniform vec3 cameraPosition;\",\"uniform bool isOrthographic;\",\"#ifdef USE_INSTANCING\",\"\\tattribute mat4 instanceMatrix;\",\"#endif\",\"#ifdef USE_INSTANCING_COLOR\",\"\\tattribute vec3 instanceColor;\",\"#endif\",\"attribute vec3 position;\",\"attribute vec3 normal;\",\"attribute vec2 uv;\",\"#ifdef USE_TANGENT\",\"\\tattribute vec4 tangent;\",\"#endif\",\"#if defined( USE_COLOR_ALPHA )\",\"\\tattribute vec4 color;\",\"#elif defined( USE_COLOR )\",\"\\tattribute vec3 color;\",\"#endif\",\"#ifdef USE_MORPHTARGETS\",\"\\tattribute vec3 morphTarget0;\",\"\\tattribute vec3 morphTarget1;\",\"\\tattribute vec3 morphTarget2;\",\"\\tattribute vec3 morphTarget3;\",\"\\t#ifdef USE_MORPHNORMALS\",\"\\t\\tattribute vec3 morphNormal0;\",\"\\t\\tattribute vec3 morphNormal1;\",\"\\t\\tattribute vec3 morphNormal2;\",\"\\t\\tattribute vec3 morphNormal3;\",\"\\t#else\",\"\\t\\tattribute vec3 morphTarget4;\",\"\\t\\tattribute vec3 morphTarget5;\",\"\\t\\tattribute vec3 morphTarget6;\",\"\\t\\tattribute vec3 morphTarget7;\",\"\\t#endif\",\"#endif\",\"#ifdef USE_SKINNING\",\"\\tattribute vec4 skinIndex;\",\"\\tattribute vec4 skinWeight;\",\"#endif\",\"\\n\"].filter(ma).join(\"\\n\"),_=[g,Ea(n),\"#define SHADER_NAME \"+n.shaderName,v,n.alphaTest?\"#define ALPHATEST \"+n.alphaTest+(n.alphaTest%1?\"\":\".0\"):\"\",\"#define GAMMA_FACTOR \"+m,n.useFog&&n.fog?\"#define USE_FOG\":\"\",n.useFog&&n.fogExp2?\"#define FOG_EXP2\":\"\",n.map?\"#define USE_MAP\":\"\",n.matcap?\"#define USE_MATCAP\":\"\",n.envMap?\"#define USE_ENVMAP\":\"\",n.envMap?\"#define \"+c:\"\",n.envMap?\"#define \"+u:\"\",n.envMap?\"#define \"+f:\"\",n.lightMap?\"#define USE_LIGHTMAP\":\"\",n.aoMap?\"#define USE_AOMAP\":\"\",n.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",n.bumpMap?\"#define USE_BUMPMAP\":\"\",n.normalMap?\"#define USE_NORMALMAP\":\"\",n.normalMap&&n.objectSpaceNormalMap?\"#define OBJECTSPACE_NORMALMAP\":\"\",n.normalMap&&n.tangentSpaceNormalMap?\"#define TANGENTSPACE_NORMALMAP\":\"\",n.clearcoatMap?\"#define USE_CLEARCOATMAP\":\"\",n.clearcoatRoughnessMap?\"#define USE_CLEARCOAT_ROUGHNESSMAP\":\"\",n.clearcoatNormalMap?\"#define USE_CLEARCOAT_NORMALMAP\":\"\",n.specularMap?\"#define USE_SPECULARMAP\":\"\",n.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",n.metalnessMap?\"#define USE_METALNESSMAP\":\"\",n.alphaMap?\"#define USE_ALPHAMAP\":\"\",n.sheen?\"#define USE_SHEEN\":\"\",n.transmission?\"#define USE_TRANSMISSION\":\"\",n.transmissionMap?\"#define USE_TRANSMISSIONMAP\":\"\",n.thicknessMap?\"#define USE_THICKNESSMAP\":\"\",n.vertexTangents?\"#define USE_TANGENT\":\"\",n.vertexColors||n.instancingColor?\"#define USE_COLOR\":\"\",n.vertexAlphas?\"#define USE_COLOR_ALPHA\":\"\",n.vertexUvs?\"#define USE_UV\":\"\",n.uvsVertexOnly?\"#define UVS_VERTEX_ONLY\":\"\",n.gradientMap?\"#define USE_GRADIENTMAP\":\"\",n.flatShading?\"#define FLAT_SHADED\":\"\",n.doubleSided?\"#define DOUBLE_SIDED\":\"\",n.flipSided?\"#define FLIP_SIDED\":\"\",n.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",n.shadowMapEnabled?\"#define \"+l:\"\",n.premultipliedAlpha?\"#define PREMULTIPLIED_ALPHA\":\"\",n.physicallyCorrectLights?\"#define PHYSICALLY_CORRECT_LIGHTS\":\"\",n.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?\"#define USE_LOGDEPTHBUF_EXT\":\"\",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?\"#define TEXTURE_LOD_EXT\":\"\",\"uniform mat4 viewMatrix;\",\"uniform vec3 cameraPosition;\",\"uniform bool isOrthographic;\",n.toneMapping!==$?\"#define TONE_MAPPING\":\"\",n.toneMapping!==$?ko.tonemapping_pars_fragment:\"\",n.toneMapping!==$?fa(\"toneMapping\",n.toneMapping):\"\",n.dithering?\"#define DITHERING\":\"\",ko.encodings_pars_fragment,n.map?da(\"mapTexelToLinear\",n.mapEncoding):\"\",n.matcap?da(\"matcapTexelToLinear\",n.matcapEncoding):\"\",n.envMap?da(\"envMapTexelToLinear\",n.envMapEncoding):\"\",n.emissiveMap?da(\"emissiveMapTexelToLinear\",n.emissiveMapEncoding):\"\",n.lightMap?da(\"lightMapTexelToLinear\",n.lightMapEncoding):\"\",pa(\"linearToOutputTexel\",n.outputEncoding),n.depthPacking?\"#define DEPTH_PACKING \"+n.depthPacking:\"\",\"\\n\"].filter(ma).join(\"\\n\")),s=xa(s),s=ga(s,n),s=va(s,n),a=xa(a),a=ga(a,n),a=va(a,n),s=Ma(s),a=Ma(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(b=\"#version 300 es\\n\",x=[\"#define attribute in\",\"#define varying out\",\"#define texture2D texture\"].join(\"\\n\")+\"\\n\"+x,_=[\"#define varying in\",n.glslVersion===Nn?\"\":\"out highp vec4 pc_fragColor;\",n.glslVersion===Nn?\"\":\"#define gl_FragColor pc_fragColor\",\"#define gl_FragDepthEXT gl_FragDepth\",\"#define texture2D texture\",\"#define textureCube texture\",\"#define texture2DProj textureProj\",\"#define texture2DLodEXT textureLod\",\"#define texture2DProjLodEXT textureProjLod\",\"#define textureCubeLodEXT textureLod\",\"#define texture2DGradEXT textureGrad\",\"#define texture2DProjGradEXT textureProjGrad\",\"#define textureCubeGradEXT textureGrad\"].join(\"\\n\")+\"\\n\"+_);const w=b+_+a,M=la(i,35633,b+x+s),S=la(i,35632,w);if(i.attachShader(y,M),i.attachShader(y,S),void 0!==n.index0AttributeName?i.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(y,0,\"position\"),i.linkProgram(y),e.debug.checkShaderErrors){const e=i.getProgramInfoLog(y).trim(),t=i.getShaderInfoLog(M).trim(),n=i.getShaderInfoLog(S).trim();let r=!0,o=!0;if(!1===i.getProgramParameter(y,35714)){r=!1;const t=ha(i,M,\"vertex\"),n=ha(i,S,\"fragment\");console.error(\"THREE.WebGLProgram: shader error: \",i.getError(),\"35715\",i.getProgramParameter(y,35715),\"gl.getProgramInfoLog\",e,t,n)}else\"\"!==e?console.warn(\"THREE.WebGLProgram: gl.getProgramInfoLog()\",e):\"\"!==t&&\"\"!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:x},fragmentShader:{log:n,prefix:_}})}let T,E;return i.deleteShader(M),i.deleteShader(S),this.getUniforms=function(){return void 0===T&&(T=new aa(i,y)),T},this.getAttributes=function(){return void 0===E&&(E=function(e,t){const n={},r=e.getProgramParameter(t,35721);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i).name;n[r]=e.getAttribLocation(t,r)}return n}(i,y)),E},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=ca++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=S,this}function Aa(e,t,n,r,i,o){const s=[],a=r.isWebGL2,l=r.logarithmicDepthBuffer,c=r.floatVertexTextures,u=r.maxVertexUniforms,h=r.vertexTextures;let d=r.precision;const p={MeshDepthMaterial:\"depth\",MeshDistanceMaterial:\"distanceRGBA\",MeshNormalMaterial:\"normal\",MeshBasicMaterial:\"basic\",MeshLambertMaterial:\"lambert\",MeshPhongMaterial:\"phong\",MeshToonMaterial:\"toon\",MeshStandardMaterial:\"physical\",MeshPhysicalMaterial:\"physical\",MeshMatcapMaterial:\"matcap\",LineBasicMaterial:\"basic\",LineDashedMaterial:\"dashed\",PointsMaterial:\"points\",ShadowMaterial:\"shadow\",SpriteMaterial:\"sprite\"},f=[\"precision\",\"isWebGL2\",\"supportsVertexTextures\",\"outputEncoding\",\"instancing\",\"instancingColor\",\"map\",\"mapEncoding\",\"matcap\",\"matcapEncoding\",\"envMap\",\"envMapMode\",\"envMapEncoding\",\"envMapCubeUV\",\"lightMap\",\"lightMapEncoding\",\"aoMap\",\"emissiveMap\",\"emissiveMapEncoding\",\"bumpMap\",\"normalMap\",\"objectSpaceNormalMap\",\"tangentSpaceNormalMap\",\"clearcoatMap\",\"clearcoatRoughnessMap\",\"clearcoatNormalMap\",\"displacementMap\",\"specularMap\",\"roughnessMap\",\"metalnessMap\",\"gradientMap\",\"alphaMap\",\"combine\",\"vertexColors\",\"vertexAlphas\",\"vertexTangents\",\"vertexUvs\",\"uvsVertexOnly\",\"fog\",\"useFog\",\"fogExp2\",\"flatShading\",\"sizeAttenuation\",\"logarithmicDepthBuffer\",\"skinning\",\"maxBones\",\"useVertexTexture\",\"morphTargets\",\"morphNormals\",\"premultipliedAlpha\",\"numDirLights\",\"numPointLights\",\"numSpotLights\",\"numHemiLights\",\"numRectAreaLights\",\"numDirLightShadows\",\"numPointLightShadows\",\"numSpotLightShadows\",\"shadowMapEnabled\",\"shadowMapType\",\"toneMapping\",\"physicallyCorrectLights\",\"alphaTest\",\"doubleSided\",\"flipSided\",\"numClippingPlanes\",\"numClipIntersection\",\"depthPacking\",\"dithering\",\"sheen\",\"transmission\",\"transmissionMap\",\"thicknessMap\"];function v(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn(\"THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.\"),t=e.texture.encoding):t=Jt,t}return{getParameters:function(i,s,f,y,x){const _=y.fog,b=i.isMeshStandardMaterial?y.environment:null,w=t.get(i.envMap||b),M=p[i.type],S=x.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(c)return 1024;{const e=u,n=Math.floor((e-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn(\"THREE.WebGLRenderer: Skeleton has \"+t.length+\" bones. This GPU supports \"+r+\".\"),0):r}}(x):0;let T,E;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision),d!==i.precision&&console.warn(\"THREE.WebGLProgram.getParameters:\",i.precision,\"not supported, using\",d,\"instead.\")),M){const e=Ho[M];T=e.vertexShader,E=e.fragmentShader}else T=i.vertexShader,E=i.fragmentShader;const L=e.getRenderTarget();return{isWebGL2:a,shaderID:M,shaderName:i.type,vertexShader:T,fragmentShader:E,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:h,outputEncoding:null!==L?v(L.texture):e.outputEncoding,map:!!i.map,mapEncoding:v(i.map),matcap:!!i.matcap,matcapEncoding:v(i.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:v(w),envMapCubeUV:!!w&&(w.mapping===ce||w.mapping===ue),lightMap:!!i.lightMap,lightMapEncoding:v(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:v(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===ln,tangentSpaceNormalMap:i.normalMapType===an,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmission:!!i.transmission,transmissionMap:!!i.transmissionMap,thicknessMap:!!i.thicknessMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&x.geometry&&x.geometry.attributes.color&&4===x.geometry.attributes.color.itemSize,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmission||i.transmissionMap||i.thicknessMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmission||i.transmissionMap||i.thicknessMap||!i.displacementMap),fog:!!_,useFog:i.fog,fogExp2:_&&_.isFogExp2,flatShading:!!i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===x.isSkinnedMesh&&S>0,maxBones:S,useVertexTexture:c,morphTargets:i.morphTargets,morphNormals:i.morphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:$,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===g,flipSided:i.side===m,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has(\"EXT_frag_depth\"),rendererExtensionDrawBuffers:a||n.has(\"WEBGL_draw_buffers\"),rendererExtensionShaderTextureLod:a||n.has(\"EXT_shader_texture_lod\"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<f.length;e++)n.push(t[f[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=Ho[t];n=Ao.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=s.length;e<t;e++){const t=s[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new La(e,n,t,i),s.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function Pa(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Ca(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ra(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ia(e){const t=[];let n=0;const r=[],i=[],o=[],s={id:-1};function a(r,i,o,a,l,c){let u=t[n];const h=e.get(o);return void 0===u?(u={id:r.id,object:r,geometry:i,material:o,program:h.program||s,groupOrder:a,renderOrder:r.renderOrder,z:l,group:c},t[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=o,u.program=h.program||s,u.groupOrder=a,u.renderOrder=r.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:r,transmissive:i,transparent:o,init:function(){n=0,r.length=0,i.length=0,o.length=0},push:function(e,t,n,s,l,c){const u=a(e,t,n,s,l,c);n.transmission>0?i.push(u):!0===n.transparent?o.push(u):r.push(u)},unshift:function(e,t,n,s,l,c){const u=a(e,t,n,s,l,c);n.transmission>0?i.unshift(u):!0===n.transparent?o.unshift(u):r.unshift(u)},finish:function(){for(let e=n,r=t.length;e<r;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Ca),i.length>1&&i.sort(t||Ra),o.length>1&&o.sort(t||Ra)}}}function Oa(e){let t=new WeakMap;return{get:function(n,r){let i;return!1===t.has(n)?(i=new Ia(e),t.set(n,[i])):r>=t.get(n).length?(i=new Ia(e),t.get(n).push(i)):i=t.get(n)[r],i},dispose:function(){t=new WeakMap}}}function Da(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case\"DirectionalLight\":n={direction:new ar,color:new Oi};break;case\"SpotLight\":n={position:new ar,direction:new ar,color:new Oi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case\"PointLight\":n={position:new ar,color:new Oi,distance:0,decay:0};break;case\"HemisphereLight\":n={direction:new ar,skyColor:new Oi,groundColor:new Oi};break;case\"RectAreaLight\":n={color:new Oi,position:new ar,halfWidth:new ar,halfHeight:new ar}}return e[t.id]=n,n}}}let Na=0;function za(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ba(e,t){const n=new Da,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case\"DirectionalLight\":case\"SpotLight\":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zn};break;case\"PointLight\":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)i.probe.push(new ar);const o=new ar,s=new Fr,a=new Fr;return{setup:function(o){let s=0,a=0,l=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0;o.sort(za);for(let e=0,t=o.length;e<t;e++){const t=o[e],v=t.color,y=t.intensity,x=t.distance,_=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=v.r*y,a+=v.g*y,l+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[c]=n,i.directionalShadowMap[c]=_,i.directionalShadowMatrix[c]=t.shadow.matrix,f++}i.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=x,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=_,i.spotShadowMatrix[h]=t.shadow.matrix,g++}i.spot[h]=e,h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[d]=e,d++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[u]=n,i.pointShadowMap[u]=_,i.pointShadowMatrix[u]=t.shadow.matrix,m++}i.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),i.hemi[p]=e,p++}}d>0&&(t.isWebGL2||!0===e.has(\"OES_texture_float_linear\")?(i.rectAreaLTC1=Vo.LTC_FLOAT_1,i.rectAreaLTC2=Vo.LTC_FLOAT_2):!0===e.has(\"OES_texture_half_float_linear\")?(i.rectAreaLTC1=Vo.LTC_HALF_1,i.rectAreaLTC2=Vo.LTC_HALF_2):console.error(\"THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.\")),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=l;const v=i.hash;v.directionalLength===c&&v.pointLength===u&&v.spotLength===h&&v.rectAreaLength===d&&v.hemiLength===p&&v.numDirectionalShadows===f&&v.numPointShadows===m&&v.numSpotShadows===g||(i.directional.length=c,i.spot.length=h,i.rectArea.length=d,i.point.length=u,i.hemi.length=p,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=m,i.spotShadowMatrix.length=g,v.directionalLength=c,v.pointLength=u,v.spotLength=h,v.rectAreaLength=d,v.hemiLength=p,v.numDirectionalShadows=f,v.numPointShadows=m,v.numSpotShadows=g,i.version=Na++)},setupView:function(e,t){let n=0,r=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}},state:i}}function Fa(e,t){const n=new Ba(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Ga(e,t){let n=new WeakMap;return{get:function(r,i=0){let o;return!1===n.has(r)?(o=new Fa(e,t),n.set(r,[o])):i>=n.get(r).length?(o=new Fa(e,t),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}class Ua extends Ei{constructor(e){super(),this.type=\"MeshDepthMaterial\",this.depthPacking=on,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Ua.prototype.isMeshDepthMaterial=!0;class ka extends Ei{constructor(e){super(),this.type=\"MeshDistanceMaterial\",this.referencePosition=new ar,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}ka.prototype.isMeshDistanceMaterial=!0;function Va(e,t,n){let r=new Bo;const i=new Zn,o=new Zn,s=new nr,a=[],l=[],c={},u=n.maxTextureSize,d={0:m,1:f,2:g},v=new Po({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Zn},radius:{value:4}},vertexShader:\"void main() {\\n\\tgl_Position = vec4( position, 1.0 );\\n}\",fragmentShader:\"uniform sampler2D shadow_pass;\\nuniform vec2 resolution;\\nuniform float radius;\\n#include <packing>\\nvoid main() {\\n\\tfloat mean = 0.0;\\n\\tfloat squared_mean = 0.0;\\n\\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\\n\\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\\n\\t\\t#ifdef HORIZONTAL_PASS\\n\\t\\t\\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\\n\\t\\t\\tmean += distribution.x;\\n\\t\\t\\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\\n\\t\\t#else\\n\\t\\t\\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\\n\\t\\t\\tmean += depth;\\n\\t\\t\\tsquared_mean += depth * depth;\\n\\t\\t#endif\\n\\t}\\n\\tmean = mean * HALF_SAMPLE_RATE;\\n\\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\\n\\tfloat std_dev = sqrt( squared_mean - mean * mean );\\n\\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\\n}\"}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const _=new io;_.setAttribute(\"position\",new Bi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new Mo(_,v),w=this;function M(n,r){const i=t.update(b);v.uniforms.shadow_pass.value=n.map.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,v,b,null),y.uniforms.shadow_pass.value=n.mapPass.texture,y.uniforms.resolution.value=n.mapSize,y.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,y,b,null)}function S(e){const t=e<<0;let n=a[t];return void 0===n&&(n=new Ua({depthPacking:sn,morphTargets:e}),a[t]=n),n}function T(e){const t=e<<0;let n=l[t];return void 0===n&&(n=new ka({morphTargets:e}),l[t]=n),n}function E(t,n,r,i,o,s,a){let l=null,u=S,h=t.customDepthMaterial;if(!0===i.isPointLight&&(u=T,h=t.customDistanceMaterial),void 0===h){let e=!1;!0===r.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0),l=u(e)}else l=h;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const e=l.uuid,t=r.uuid;let n=c[e];void 0===n&&(n={},c[e]=n);let i=n[t];void 0===i&&(i=l.clone(),n[t]=i),l=i}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=a===p?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:d[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=o,l.farDistance=s),l}function L(n,i,o,s,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===p)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=i[c.materialIndex];if(u&&u.visible){const t=E(n,r,u,s,o.near,o.far,a);e.renderBufferDirect(o,null,r,t,n,c)}}}else if(i.visible){const t=E(n,r,i,s,o.near,o.far,a);e.renderBufferDirect(o,null,r,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)L(l[e],i,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(t,n,a){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(x),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn(\"THREE.WebGLShadowMap:\",c,\"has no shadow.\");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const f=h.getFrameExtents();if(i.multiply(f),o.copy(h.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(o.x=Math.floor(u/f.x),i.x=o.x*f.x,h.mapSize.x=o.x),i.y>u&&(o.y=Math.floor(u/f.y),i.y=o.y*f.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&this.type===p){const e={minFilter:xe,magFilter:xe,format:Fe};h.map=new rr(i.x,i.y,e),h.map.texture.name=c.name+\".shadowMap\",h.mapPass=new rr(i.x,i.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:fe,magFilter:fe,format:Fe};h.map=new rr(i.x,i.y,e),h.map.texture.name=c.name+\".shadowMap\",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const m=h.getViewportCount();for(let e=0;e<m;e++){const t=h.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),d.viewport(s),h.updateMatrices(c,e),r=h.getFrustum(),L(n,a,h.camera,c,this.type)}h.isPointLightShadow||this.type!==p||M(h,a),h.needsUpdate=!1}w.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function Ha(e,t,n){const r=n.isWebGL2;const i=new function(){let t=!1;const n=new nr;let r=null;const i=new nr(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,s,a){!0===a&&(t*=s,r*=s,o*=s),n.set(t,r,o,s),!1===i.equals(n)&&(e.clearColor(t,r,o,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(e){e?ye(2929):xe(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case k:e.depthFunc(512);break;case V:e.depthFunc(519);break;case H:e.depthFunc(513);break;case j:e.depthFunc(515);break;case W:e.depthFunc(514);break;case q:e.depthFunc(518);break;case X:e.depthFunc(516);break;case Y:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},c=new function(){let t=!1,n=null,r=null,i=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?ye(2960):xe(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,s){r===t&&i===n&&o===s||(e.stencilFunc(t,n,s),r=t,i=n,o=s)},setOp:function(t,n,r){s===t&&a===n&&l===r||(e.stencilOp(t,n,r),s=t,a=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,s=null,a=null,l=null,c=null}}};let u={},h=null,d={},p=null,f=!1,v=null,y=null,Z=null,J=null,K=null,$=null,Q=null,ee=!1,te=null,ne=null,re=null,ie=null,oe=null;const se=e.getParameter(35661);let ae=!1,le=0;const ce=e.getParameter(7938);-1!==ce.indexOf(\"WebGL\")?(le=parseFloat(/^WebGL (\\d)/.exec(ce)[1]),ae=le>=1):-1!==ce.indexOf(\"OpenGL ES\")&&(le=parseFloat(/^OpenGL ES (\\d)/.exec(ce)[1]),ae=le>=2);let ue=null,he={};const de=e.getParameter(3088),pe=e.getParameter(2978),fe=(new nr).fromArray(de),me=(new nr).fromArray(pe);function ge(t,n,r){const i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<r;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,i);return o}const ve={};function ye(t){!0!==u[t]&&(e.enable(t),u[t]=!0)}function xe(t){!1!==u[t]&&(e.disable(t),u[t]=!1)}ve[3553]=ge(3553,3553,1),ve[34067]=ge(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),c.setClear(0),ye(2929),o.setFunc(j),Me(!1),Se(a),ye(2884),we(x);const _e={[T]:32774,[E]:32778,[L]:32779};if(r)_e[A]=32775,_e[P]=32776;else{const e=t.get(\"EXT_blend_minmax\");null!==e&&(_e[A]=e.MIN_EXT,_e[P]=e.MAX_EXT)}const be={[C]:0,[R]:1,[I]:768,[D]:770,[U]:776,[F]:774,[z]:772,[O]:769,[N]:771,[G]:775,[B]:773};function we(t,n,r,i,o,s,a,l){if(t!==x){if(!1===f&&(ye(3042),f=!0),t===S)o=o||n,s=s||r,a=a||i,n===y&&o===K||(e.blendEquationSeparate(_e[n],_e[o]),y=n,K=o),r===Z&&i===J&&s===$&&a===Q||(e.blendFuncSeparate(be[r],be[i],be[s],be[a]),Z=r,J=i,$=s,Q=a),v=t,ee=null;else if(t!==v||l!==ee){if(y===T&&K===T||(e.blendEquation(32774),y=T,K=T),l)switch(t){case _:e.blendFuncSeparate(1,771,1,771);break;case b:e.blendFunc(1,1);break;case w:e.blendFuncSeparate(0,0,769,771);break;case M:e.blendFuncSeparate(0,768,0,770);break;default:console.error(\"THREE.WebGLState: Invalid blending: \",t)}else switch(t){case _:e.blendFuncSeparate(770,771,1,771);break;case b:e.blendFunc(770,1);break;case w:e.blendFunc(0,769);break;case M:e.blendFunc(0,768);break;default:console.error(\"THREE.WebGLState: Invalid blending: \",t)}Z=null,J=null,$=null,Q=null,v=t,ee=l}}else!0===f&&(xe(3042),f=!1)}function Me(t){te!==t&&(t?e.frontFace(2304):e.frontFace(2305),te=t)}function Se(t){t!==s?(ye(2884),t!==ne&&(t===a?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):xe(2884),ne=t}function Te(t,n,r){t?(ye(32823),ie===n&&oe===r||(e.polygonOffset(n,r),ie=n,oe=r)):xe(32823)}function Ee(t){void 0===t&&(t=33984+se-1),ue!==t&&(e.activeTexture(t),ue=t)}return{buffers:{color:i,depth:o,stencil:c},enable:ye,disable:xe,bindFramebuffer:function(t,n){return null===n&&null!==h&&(n=h),d[t]!==n&&(e.bindFramebuffer(t,n),d[t]=n,r&&(36009===t&&(d[36160]=n),36160===t&&(d[36009]=n)),!0)},bindXRFramebuffer:function(t){t!==h&&(e.bindFramebuffer(36160,t),h=t)},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:we,setMaterial:function(e,t){e.side===g?xe(2884):ye(2884);let n=e.side===m;t&&(n=!n),Me(n),e.blending===_&&!1===e.transparent?we(x):we(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),i.setMask(e.colorWrite);const r=e.stencilWrite;c.setTest(r),r&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Te(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?ye(32926):xe(32926)},setFlipSided:Me,setCullFace:Se,setLineWidth:function(t){t!==re&&(ae&&e.lineWidth(t),re=t)},setPolygonOffset:Te,setScissorTest:function(e){e?ye(3089):xe(3089)},activeTexture:Ee,bindTexture:function(t,n){null===ue&&Ee();let r=he[ue];void 0===r&&(r={type:void 0,texture:void 0},he[ue]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||ve[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=he[ue];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error(\"THREE.WebGLState:\",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error(\"THREE.WebGLState:\",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error(\"THREE.WebGLState:\",e)}},scissor:function(t){!1===fe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),fe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===r&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},ue=null,he={},h=null,d={},p=null,f=!1,v=null,y=null,Z=null,J=null,K=null,$=null,Q=null,ee=!1,te=null,ne=null,re=null,ie=null,oe=null,fe.set(0,0,e.canvas.width,e.canvas.height),me.set(0,0,e.canvas.width,e.canvas.height),i.reset(),o.reset(),c.reset()}}}function ja(e,t,n,r,i,o,s){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=new WeakMap;let p,f=!1;try{f=\"undefined\"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext(\"2d\")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\")}function g(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if(\"undefined\"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||\"undefined\"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||\"undefined\"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?Xn:Math.floor,o=r(i*e.width),s=r(i*e.height);void 0===p&&(p=m(o,s));const a=n?m(o,s):p;a.width=o,a.height=s;return a.getContext(\"2d\").drawImage(e,0,0,o,s),console.warn(\"THREE.WebGLRenderer: Texture has been resized from (\"+e.width+\"x\"+e.height+\") to (\"+o+\"x\"+s+\").\"),a}return\"data\"in e&&console.warn(\"THREE.WebGLRenderer: Image in DataTexture is too big (\"+e.width+\"x\"+e.height+\").\"),e}return e}function v(e){return Wn(e.width)&&Wn(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==fe&&e.minFilter!==xe}function x(t,n,i,o){e.generateMipmap(t);r.get(n).__maxMipLevel=Math.log2(Math.max(i,o))}function _(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn(\"THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '\"+n+\"'\")}let o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get(\"EXT_color_buffer_float\"),o}function b(e){return e===fe||e===me||e===ve?9728:9729}function w(t){const n=t.target;n.removeEventListener(\"dispose\",w),function(t){const n=r.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),r.remove(t)}(n),n.isVideoTexture&&d.delete(n),s.memory.textures--}function M(t){const n=t.target;n.removeEventListener(\"dispose\",M),function(t){const n=t.texture,i=r.get(t),o=r.get(n);if(!t)return;void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),s.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),s.memory.textures--),r.remove(n[t])}r.remove(n),r.remove(t)}(n)}let S=0;function T(e,t){const i=r.get(e);if(e.isVideoTexture&&function(e){const t=s.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){const n=e.image;if(void 0===n)console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is undefined\");else{if(!1!==n.complete)return void R(i,e,t);console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is incomplete\")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function E(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;C(t,r),n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const s=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),l=r.image[0]&&r.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=s||l?l?r.image[e].image:r.image[e]:g(r.image[e],!1,!0,c);const h=u[0],d=v(h)||a,p=o.convert(r.format),f=o.convert(r.type),m=_(r.internalFormat,p,f);let b;if(P(34067,r,d),s){for(let e=0;e<6;e++){b=u[e].mipmaps;for(let t=0;t<b.length;t++){const i=b[t];r.format!==Fe&&r.format!==Be?null!==p?n.compressedTexImage2D(34069+e,t,m,i.width,i.height,0,i.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()\"):n.texImage2D(34069+e,t,m,i.width,i.height,0,p,f,i.data)}}t.__maxMipLevel=b.length-1}else{b=r.mipmaps;for(let e=0;e<6;e++)if(l){n.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,p,f,u[e].data);for(let t=0;t<b.length;t++){const r=b[t].image[e].image;n.texImage2D(34069+e,t+1,m,r.width,r.height,0,p,f,r.data)}}else{n.texImage2D(34069+e,0,m,p,f,u[e]);for(let t=0;t<b.length;t++){const r=b[t];n.texImage2D(34069+e,t+1,m,p,f,r.image[e])}}t.__maxMipLevel=b.length}y(r,d)&&x(34067,r,h.width,h.height);t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(s,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,s.__webglTexture))}const L={[he]:10497,[de]:33071,[pe]:33648},A={[fe]:9728,[me]:9984,[ve]:9986,[xe]:9729,[_e]:9985,[we]:9987};function P(n,o,s){if(s?(e.texParameteri(n,10242,L[o.wrapS]),e.texParameteri(n,10243,L[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,L[o.wrapR]),e.texParameteri(n,10240,A[o.magFilter]),e.texParameteri(n,10241,A[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===de&&o.wrapT===de||console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.\"),e.texParameteri(n,10240,b(o.magFilter)),e.texParameteri(n,10241,b(o.minFilter)),o.minFilter!==fe&&o.minFilter!==xe&&console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.\")),!0===t.has(\"EXT_texture_filter_anisotropic\")){const s=t.get(\"EXT_texture_filter_anisotropic\");if(o.type===Ce&&!1===t.has(\"OES_texture_float_linear\"))return;if(!1===a&&o.type===Re&&!1===t.has(\"OES_texture_half_float_linear\"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function C(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener(\"dispose\",w),t.__webglTexture=e.createTexture(),s.memory.textures++)}function R(t,r,i){let s=3553;r.isDataTexture2DArray&&(s=35866),r.isDataTexture3D&&(s=32879),C(t,r),n.activeTexture(33984+i),n.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!a&&(e.wrapS!==de||e.wrapT!==de||e.minFilter!==fe&&e.minFilter!==xe)}(r)&&!1===v(r.image),c=g(r.image,l,!1,u),h=v(c)||a,d=o.convert(r.format);let p,f=o.convert(r.type),m=_(r.internalFormat,d,f);P(s,r,h);const b=r.mipmaps;if(r.isDepthTexture)m=6402,a?m=r.type===Ce?36012:r.type===Pe?33190:r.type===Ne?35056:33189:r.type===Ce&&console.error(\"WebGLRenderer: Floating point depth texture requires WebGL2.\"),r.format===Ve&&6402===m&&r.type!==Le&&r.type!==Pe&&(console.warn(\"THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.\"),r.type=Le,f=o.convert(r.type)),r.format===He&&6402===m&&(m=34041,r.type!==Ne&&(console.warn(\"THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.\"),r.type=Ne,f=o.convert(r.type))),n.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(r.isDataTexture)if(b.length>0&&h){for(let e=0,t=b.length;e<t;e++)p=b[e],n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);r.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(let e=0,t=b.length;e<t;e++)p=b[e],r.format!==Fe&&r.format!==Be?null!==d?n.compressedTexImage2D(3553,e,m,p.width,p.height,0,p.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\"):n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);t.__maxMipLevel=b.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(b.length>0&&h){for(let e=0,t=b.length;e<t;e++)p=b[e],n.texImage2D(3553,e,m,d,f,p);r.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else n.texImage2D(3553,0,m,d,f,c),t.__maxMipLevel=0;y(r,h)&&x(s,r,c.width,c.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function I(t,i,s,a,l){const c=o.convert(s.format),u=o.convert(s.type),h=_(s.internalFormat,c,u);32879===l||35866===l?n.texImage3D(l,0,h,i.width,i.height,i.depth,0,c,u,null):n.texImage2D(l,0,h,i.width,i.height,0,c,u,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,l,r.get(s).__webglTexture,0),n.bindFramebuffer(36160,null)}function O(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Ce?i=36012:t.type===Pe&&(i=33190));const r=N(n);e.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const t=N(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,i=o.convert(t.format),s=o.convert(t.type),a=_(t.internalFormat,i,s);if(r){const t=N(n);e.renderbufferStorageMultisample(36161,t,a,n.width,n.height)}else e.renderbufferStorage(36161,a,n.width,n.height)}e.bindRenderbuffer(36161,null)}function D(t){const i=r.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(o)throw new Error(\"target.depthTexture not supported in Cube render targets\");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error(\"Depth Texture with cube render targets is not supported\");if(n.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error(\"renderTarget.depthTexture must be an instance of THREE.DepthTexture\");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),T(i.depthTexture,0);const o=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Ve)e.framebufferTexture2D(36160,36096,3553,o,0);else{if(i.depthTexture.format!==He)throw new Error(\"Unknown depthTexture format\");e.framebufferTexture2D(36160,33306,3553,o,0)}}(i.__webglFramebuffer,t)}else if(o){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(36160,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),O(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),O(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function N(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}let z=!1,B=!1;this.allocateTextureUnit=function(){const e=S;return e>=l&&console.warn(\"THREE.WebGLTextures: Trying to use \"+e+\" texture units while this GPU supports only \"+l),S+=1,e},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?R(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?R(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),u=r.get(l);t.addEventListener(\"dispose\",M),!0!==t.isWebGLMultipleRenderTargets&&(u.__webglTexture=e.createTexture(),u.__version=l.version,s.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=!0===t.isWebGLMultisampleRenderTarget,f=l.isDataTexture3D||l.isDataTexture2DArray,m=v(t)||a;if(!a||l.format!==Be||l.type!==Ce&&l.type!==Re||(l.format=Fe,console.warn(\"THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.\")),h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),d)if(i.drawBuffers){const n=t.texture;for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn(\"THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.\");else if(p)if(a){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const r=o.convert(l.format),i=o.convert(l.type),s=_(l.internalFormat,r,i),a=N(t);e.renderbufferStorageMultisample(36161,a,s,t.width,t.height),n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),O(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn(\"THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.\");if(h){n.bindTexture(34067,u.__webglTexture),P(34067,l,m);for(let e=0;e<6;e++)I(c.__webglFramebuffer[e],t,l,36064,34069+e);y(l,m)&&x(34067,l,t.width,t.height),n.bindTexture(34067,null)}else if(d){const e=t.texture;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=r.get(o);n.bindTexture(3553,s.__webglTexture),P(3553,o,m),I(c.__webglFramebuffer,t,o,36064+i,3553),y(o,m)&&x(3553,o,t.width,t.height)}n.bindTexture(3553,null)}else{let e=3553;if(f)if(a){e=l.isDataTexture3D?32879:35866}else console.warn(\"THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.\");n.bindTexture(e,u.__webglTexture),P(e,l,m),I(c.__webglFramebuffer,t,l,36064,e),y(l,m)&&x(3553,l,t.width,t.height),n.bindTexture(3553,null)}t.depthBuffer&&D(t)},this.updateRenderTargetMipmap=function(e){const t=v(e)||a,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,s=i.length;o<s;o++){const s=i[o];if(y(s,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,i=r.get(s).__webglTexture;n.bindTexture(t,i),x(t,s,e.width,e.height),n.bindTexture(t,null)}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const i=t.width,o=t.height;let s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024);const a=r.get(t);n.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,a.__webglFramebuffer),e.blitFramebuffer(0,0,i,o,0,0,i,o,s,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn(\"THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.\")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===z&&(console.warn(\"THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead.\"),z=!0),e=e.texture),T(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===B&&(console.warn(\"THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead.\"),B=!0),e=e.texture),E(e,t)}}function Wa(e,t,n){const r=n.isWebGL2;return{convert:function(e){let n;if(e===Se)return 5121;if(e===Ie)return 32819;if(e===Oe)return 32820;if(e===De)return 33635;if(e===Te)return 5120;if(e===Ee)return 5122;if(e===Le)return 5123;if(e===Ae)return 5124;if(e===Pe)return 5125;if(e===Ce)return 5126;if(e===Re)return r?5131:(n=t.get(\"OES_texture_half_float\"),null!==n?n.HALF_FLOAT_OES:null);if(e===ze)return 6406;if(e===Be)return 6407;if(e===Fe)return 6408;if(e===Ge)return 6409;if(e===Ue)return 6410;if(e===Ve)return 6402;if(e===He)return 34041;if(e===je)return 6403;if(e===We)return 36244;if(e===qe)return 33319;if(e===Xe)return 33320;if(e===Ye)return 36248;if(e===Ze)return 36249;if(e===Je||e===Ke||e===$e||e===Qe){if(n=t.get(\"WEBGL_compressed_texture_s3tc\"),null===n)return null;if(e===Je)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ke)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===$e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Qe)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===nt||e===rt){if(n=t.get(\"WEBGL_compressed_texture_pvrtc\"),null===n)return null;if(e===et)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===nt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===rt)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===it)return n=t.get(\"WEBGL_compressed_texture_etc1\"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===ot||e===st)&&(n=t.get(\"WEBGL_compressed_texture_etc\"),null!==n)){if(e===ot)return n.COMPRESSED_RGB8_ETC2;if(e===st)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===at||e===lt||e===ct||e===ut||e===ht||e===dt||e===pt||e===ft||e===mt||e===gt||e===vt||e===yt||e===xt||e===_t||e===wt||e===Mt||e===St||e===Tt||e===Et||e===Lt||e===At||e===Pt||e===Ct||e===Rt||e===It||e===Ot||e===Dt||e===Nt?(n=t.get(\"WEBGL_compressed_texture_astc\"),null!==n?e:null):e===bt?(n=t.get(\"EXT_texture_compression_bptc\"),null!==n?e:null):e===Ne?r?34042:(n=t.get(\"WEBGL_depth_texture\"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class qa extends Ro{constructor(e=[]){super(),this.cameras=e}}qa.prototype.isArrayCamera=!0;class Xa extends ci{constructor(){super(),this.type=\"Group\"}}Xa.prototype.isGroup=!0;const Ya={type:\"move\"};class Za{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Xa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Xa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ar,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ar),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Xa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ar,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ar),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:\"disconnected\",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,o=null;const s=this._targetRay,a=this._grip,l=this._hand;if(e&&\"visible-blurred\"!==t.session.visibilityState)if(null!==s&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Ya))),l&&e.hand){o=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n);if(void 0===l.joints[r.jointName]){const e=new Xa;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[r.jointName]=e,l.add(e)}const i=l.joints[r.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints[\"index-finger-tip\"],i=l.joints[\"thumb-tip\"],s=r.position.distanceTo(i.position),a=.02,c=.005;l.inputState.pinching&&s>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:\"pinchend\",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:\"pinchstart\",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1));return null!==s&&(s.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==o),this}}class Ja extends zn{constructor(e,t){super();const n=this,r=e.state;let i=null,o=1,s=null,a=\"local-floor\",l=null;const c=[],u=new Map,h=new Ro;h.layers.enable(1),h.viewport=new nr;const d=new Ro;d.layers.enable(2),d.viewport=new nr;const p=[h,d],f=new qa;f.layers.enable(1),f.layers.enable(2);let m=null,g=null;function v(e){const t=u.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function y(){u.forEach((function(e,t){e.disconnect(t)})),u.clear(),m=null,g=null,r.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),S.stop(),n.isPresenting=!1,n.dispatchEvent({type:\"sessionend\"})}function x(e){const t=i.inputSources;for(let e=0;e<c.length;e++)u.set(t[e],c[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=u.get(n);r&&(r.dispatchEvent({type:\"disconnected\",data:n}),u.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],r=u.get(n);r&&r.dispatchEvent({type:\"connected\",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new Za,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new Za,c[e]=t),t.getGripSpace()},this.getHand=function(e){let t=c[e];return void 0===t&&(t=new Za,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){o=e,!0===n.isPresenting&&console.warn(\"THREE.WebXRManager: Cannot change framebuffer scale while presenting.\")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn(\"THREE.WebXRManager: Cannot change reference space type while presenting.\")},this.getReferenceSpace=function(){return s},this.getSession=function(){return i},this.setSession=async function(e){if(i=e,null!==i){i.addEventListener(\"select\",v),i.addEventListener(\"selectstart\",v),i.addEventListener(\"selectend\",v),i.addEventListener(\"squeeze\",v),i.addEventListener(\"squeezestart\",v),i.addEventListener(\"squeezeend\",v),i.addEventListener(\"end\",y),i.addEventListener(\"inputsourceschange\",x);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const r={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:o},l=new XRWebGLLayer(i,t,r);i.updateRenderState({baseLayer:l}),s=await i.requestReferenceSpace(a),S.setContext(i),S.start(),n.isPresenting=!0,n.dispatchEvent({type:\"sessionstart\"})}};const _=new ar,b=new ar;function w(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;f.near=d.near=h.near=e.near,f.far=d.far=h.far=e.far,m===f.near&&g===f.far||(i.updateRenderState({depthNear:f.near,depthFar:f.far}),m=f.near,g=f.far);const t=e.parent,n=f.cameras;w(f,t);for(let e=0;e<n.length;e++)w(n[e],t);e.matrixWorld.copy(f.matrixWorld),e.matrix.copy(f.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){_.setFromMatrixPosition(t.matrixWorld),b.setFromMatrixPosition(n.matrixWorld);const r=_.distanceTo(b),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=r/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,v=a+f,y=d-m,x=p+(r-m),w=l*a/v*g,M=c*a/v*g;e.projectionMatrix.makePerspective(y,x,w,M,g,v)}(f,h,d):f.projectionMatrix.copy(h.projectionMatrix)},this.getCamera=function(){return f};let M=null;const S=new Fo;S.setAnimationLoop((function(e,t){if(l=t.getViewerPose(s),null!==l){const e=l.views,t=i.renderState.baseLayer;r.bindXRFramebuffer(t.framebuffer);let n=!1;e.length!==f.cameras.length&&(f.cameras.length=0,n=!0);for(let r=0;r<e.length;r++){const i=e[r],o=t.getViewport(i),s=p[r];s.matrix.fromArray(i.transform.matrix),s.projectionMatrix.fromArray(i.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===r&&f.matrix.copy(s.matrix),!0===n&&f.cameras.push(s)}}const n=i.inputSources;for(let e=0;e<c.length;e++){const r=c[e],i=n[e];r.update(i,t,s)}M&&M(e,t)})),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}}function Ka(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const r=e.get(n).envMap;if(r){t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const i=e.get(r).__maxMipLevel;void 0!==i&&(t.maxMipLevel.value=i)}let i,o;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===m&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===m&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias);e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,o,s){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t,r){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===m&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap);t.transmission>0&&(e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height));e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap);e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)}(e,r,s):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,o):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function $a(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");return e.style.display=\"block\",e}(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:\"default\",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Jt,this.physicallyCorrectLights=!1,this.toneMapping=$,this.toneMappingExposure=1;const m=this;let g=!1,v=0,y=0,x=null,_=-1,b=null;const w=new nr,M=new nr;let S=null,T=t.width,E=t.height,L=1,A=null,P=null;const C=new nr(0,0,T,E),R=new nr(0,0,T,E);let I=!1;const O=[],D=new Bo;let N=!1,z=!1,B=null;const F=new Fr,G=new ar,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function k(){return null===x?L:1}let V,H,j,W,q,X,Y,Z,J,K,Q,ee,te,ne,re,ie,oe,se,ae,le,ce,ue,he=n;function pe(e,n){for(let r=0;r<e.length;r++){const i=e[r],o=t.getContext(i,n);if(null!==o)return o}return null}try{const e={alpha:r,depth:i,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(t.addEventListener(\"webglcontextlost\",ve,!1),t.addEventListener(\"webglcontextrestored\",ye,!1),null===he){const t=[\"webgl2\",\"webgl\",\"experimental-webgl\"];if(!0===m.isWebGL1Renderer&&t.shift(),he=pe(t,e),null===he)throw pe(t)?new Error(\"Error creating WebGL context with your selected attributes.\"):new Error(\"Error creating WebGL context.\")}void 0===he.getShaderPrecisionFormat&&(he.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error(\"THREE.WebGLRenderer: \"+e.message),e}function me(){V=new Jo(he),H=new Xo(he,V,e),V.init(H),ce=new Wa(he,V,H),j=new Ha(he,V,H),O[0]=1029,W=new Qo(he),q=new Pa,X=new ja(he,V,j,q,H,ce,W),Y=new Zo(m),Z=new Go(he,H),ue=new Wo(he,V,Z,H),J=new Ko(he,Z,W,ue),K=new rs(he,J,Z,W),se=new ns(he),re=new Yo(q),Q=new Aa(m,Y,V,H,ue,re),ee=new Ka(q),te=new Oa(q),ne=new Ga(V,H),oe=new jo(m,Y,j,K,a),ie=new Va(m,K,H),ae=new qo(he,V,W,H),le=new $o(he,V,W,H),W.programs=Q.programs,m.capabilities=H,m.extensions=V,m.properties=q,m.renderLists=te,m.shadowMap=ie,m.state=j,m.info=W}me();const ge=new Ja(m,he);function ve(e){e.preventDefault(),console.log(\"THREE.WebGLRenderer: Context Lost.\"),g=!0}function ye(){console.log(\"THREE.WebGLRenderer: Context Restored.\"),g=!1;const e=W.autoReset,t=ie.enabled,n=ie.autoUpdate,r=ie.needsUpdate,i=ie.type;me(),W.autoReset=e,ie.enabled=t,ie.autoUpdate=n,ie.needsUpdate=r,ie.type=i}function xe(e){const t=e.target;t.removeEventListener(\"dispose\",xe),function(e){(function(e){const t=q.get(e).programs;void 0!==t&&t.forEach((function(e){Q.releaseProgram(e)}))})(e),q.remove(e)}(t)}this.xr=ge,this.getContext=function(){return he},this.getContextAttributes=function(){return he.getContextAttributes()},this.forceContextLoss=function(){const e=V.get(\"WEBGL_lose_context\");e&&e.loseContext()},this.forceContextRestore=function(){const e=V.get(\"WEBGL_lose_context\");e&&e.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e,this.setSize(T,E,!1))},this.getSize=function(e){return void 0===e&&(console.warn(\"WebGLRenderer: .getsize() now requires a Vector2 as an argument\"),e=new Zn),e.set(T,E)},this.setSize=function(e,n,r){ge.isPresenting?console.warn(\"THREE.WebGLRenderer: Can't change size while VR device is presenting.\"):(T=e,E=n,t.width=Math.floor(e*L),t.height=Math.floor(n*L),!1!==r&&(t.style.width=e+\"px\",t.style.height=n+\"px\"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn(\"WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument\"),e=new Zn),e.set(T*L,E*L).floor()},this.setDrawingBufferSize=function(e,n,r){T=e,E=n,L=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn(\"WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument\"),e=new nr),e.copy(w)},this.getViewport=function(e){return e.copy(C)},this.setViewport=function(e,t,n,r){e.isVector4?C.set(e.x,e.y,e.z,e.w):C.set(e,t,n,r),j.viewport(w.copy(C).multiplyScalar(L).floor())},this.getScissor=function(e){return e.copy(R)},this.setScissor=function(e,t,n,r){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,n,r),j.scissor(M.copy(R).multiplyScalar(L).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(e){j.setScissorTest(I=e)},this.setOpaqueSort=function(e){A=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(e){return void 0===e&&(console.warn(\"WebGLRenderer: .getClearColor() now requires a Color as an argument\"),e=new Oi),e.copy(oe.getClearColor())},this.setClearColor=function(){oe.setClearColor.apply(oe,arguments)},this.getClearAlpha=function(){return oe.getClearAlpha()},this.setClearAlpha=function(){oe.setClearAlpha.apply(oe,arguments)},this.clear=function(e,t,n){let r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),he.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener(\"webglcontextlost\",ve,!1),t.removeEventListener(\"webglcontextrestored\",ye,!1),te.dispose(),ne.dispose(),q.dispose(),Y.dispose(),K.dispose(),ue.dispose(),ge.dispose(),ge.removeEventListener(\"sessionstart\",be),ge.removeEventListener(\"sessionend\",Me),B&&(B.dispose(),B=null),Te.stop()},this.renderBufferImmediate=function(e,t){ue.initAttributes();const n=q.get(e);e.hasPositions&&!n.position&&(n.position=he.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=he.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=he.createBuffer()),e.hasColors&&!n.color&&(n.color=he.createBuffer());const r=t.getAttributes();e.hasPositions&&(he.bindBuffer(34962,n.position),he.bufferData(34962,e.positionArray,35048),ue.enableAttribute(r.position),he.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(he.bindBuffer(34962,n.normal),he.bufferData(34962,e.normalArray,35048),ue.enableAttribute(r.normal),he.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(he.bindBuffer(34962,n.uv),he.bufferData(34962,e.uvArray,35048),ue.enableAttribute(r.uv),he.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(he.bindBuffer(34962,n.color),he.bufferData(34962,e.colorArray,35048),ue.enableAttribute(r.color),he.vertexAttribPointer(r.color,3,5126,!1,0,0)),ue.disableUnusedAttributes(),he.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=U);const s=i.isMesh&&i.matrixWorld.determinant()<0,a=Ie(e,t,r,i);j.setMaterial(r,s);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===r.wireframe&&(l=J.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&se.update(i,n,r,a),ue.setup(i,r,a,n,l);let d=ae;null!==l&&(u=Z.get(l),d=le,d.setIndex(u));const p=null!==l?l.count:c.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(f,g),x=Math.min(p,f+m,g+v)-1,_=Math.max(0,x-y+1);if(0!==_){if(i.isMesh)!0===r.wireframe?(j.setLineWidth(r.wireframeLinewidth*k()),d.setMode(1)):d.setMode(4);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),j.setLineWidth(e*k()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(y,_,i.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,_,e)}else d.render(y,_)}},this.compile=function(e,t){d=ne.get(e),d.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){Ae(n[r],e,t)}else Ae(n,e,t)}))};let _e=null;function be(){Te.stop()}function Me(){Te.start()}const Te=new Fo;function Ee(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=o.object,a=o.geometry,l=null===r?o.material:r,c=o.group;if(n.isArrayCamera){const e=n.cameras;for(let n=0,r=e.length;n<r;n++){const r=e[n];s.layers.test(r.layers)&&(j.viewport(w.copy(r.viewport)),d.setupLightsView(r),Le(s,t,r,a,l,c))}}else Le(s,t,n,a,l,c)}}function Le(e,t,n,r,i,o){if(e.onBeforeRender(m,t,n,r,i,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const r=Ie(n,t,i,e);j.setMaterial(i),ue.reset(),function(e,t){e.render((function(e){m.renderBufferImmediate(e,t)}))}(e,r)}else m.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(m,t,n,r,i,o)}function Ae(e,t,n){!0!==t.isScene&&(t=U);const r=q.get(e),i=d.state.lights,o=d.state.shadowsArray,s=i.state.version,a=Q.getParameters(e,i.state,o,t,n),l=Q.getProgramCacheKey(a);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=Y.get(e.envMap||r.environment),void 0===c&&(e.addEventListener(\"dispose\",xe),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===s)return Pe(e,a),u}else a.uniforms=Q.getUniforms(e),e.onBuild(a,m),e.onBeforeCompile(a,m),u=Q.acquireProgram(a,l),c.set(l,u),r.uniforms=a.uniforms;const h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=re.uniform),Pe(e,a),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const p=u.getUniforms(),f=aa.seqWithValue(p.seq,h);return r.currentProgram=u,r.uniformsList=f,u}function Pe(e,t){const n=q.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas}function Ie(e,t,n,r){!0!==t.isScene&&(t=U),X.resetTextureUnits();const i=t.fog,o=n.isMeshStandardMaterial?t.environment:null,s=null===x?m.outputEncoding:x.texture.encoding,a=Y.get(n.envMap||o),l=!0===n.vertexColors&&r.geometry&&r.geometry.attributes.color&&4===r.geometry.attributes.color.itemSize,c=q.get(n),u=d.state.lights;if(!0===N&&(!0===z||e!==b)){const t=e===b&&n.id===_;re.setState(n,e,t)}let h=!1;n.version===c.__version?c.needsLights&&c.lightsStateVersion!==u.state.version||c.outputEncoding!==s||r.isInstancedMesh&&!1===c.instancing?h=!0:r.isInstancedMesh||!0!==c.instancing?r.isSkinnedMesh&&!1===c.skinning?h=!0:r.isSkinnedMesh||!0!==c.skinning?c.envMap!==a||n.fog&&c.fog!==i?h=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===re.numPlanes&&c.numIntersection===re.numIntersection?c.vertexAlphas!==l&&(h=!0):h=!0:h=!0:h=!0:(h=!0,c.__version=n.version);let p=c.currentProgram;!0===h&&(p=Ae(n,t,r));let f=!1,g=!1,v=!1;const y=p.getUniforms(),w=c.uniforms;if(j.useProgram(p.program)&&(f=!0,g=!0,v=!0),n.id!==_&&(_=n.id,g=!0),f||b!==e){if(y.setValue(he,\"projectionMatrix\",e.projectionMatrix),H.logarithmicDepthBuffer&&y.setValue(he,\"logDepthBufFC\",2/(Math.log(e.far+1)/Math.LN2)),b!==e&&(b=e,g=!0,v=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=y.map.cameraPosition;void 0!==t&&t.setValue(he,G.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&y.setValue(he,\"isOrthographic\",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&y.setValue(he,\"viewMatrix\",e.matrixWorldInverse)}if(r.isSkinnedMesh){y.setOptional(he,r,\"bindMatrix\"),y.setOptional(he,r,\"bindMatrixInverse\");const e=r.skeleton;e&&(H.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),y.setValue(he,\"boneTexture\",e.boneTexture,X),y.setValue(he,\"boneTextureSize\",e.boneTextureSize)):y.setOptional(he,e,\"boneMatrices\"))}var M,S;return(g||c.receiveShadow!==r.receiveShadow)&&(c.receiveShadow=r.receiveShadow,y.setValue(he,\"receiveShadow\",r.receiveShadow)),g&&(y.setValue(he,\"toneMappingExposure\",m.toneMappingExposure),c.needsLights&&(S=v,(M=w).ambientLightColor.needsUpdate=S,M.lightProbe.needsUpdate=S,M.directionalLights.needsUpdate=S,M.directionalLightShadows.needsUpdate=S,M.pointLights.needsUpdate=S,M.pointLightShadows.needsUpdate=S,M.spotLights.needsUpdate=S,M.spotLightShadows.needsUpdate=S,M.rectAreaLights.needsUpdate=S,M.hemisphereLights.needsUpdate=S),i&&n.fog&&ee.refreshFogUniforms(w,i),ee.refreshMaterialUniforms(w,n,L,E,B),aa.upload(he,c.uniformsList,w,X)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(aa.upload(he,c.uniformsList,w,X),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&y.setValue(he,\"center\",r.center),y.setValue(he,\"modelViewMatrix\",r.modelViewMatrix),y.setValue(he,\"normalMatrix\",r.normalMatrix),y.setValue(he,\"modelMatrix\",r.matrixWorld),p}Te.setAnimationLoop((function(e){_e&&_e(e)})),\"undefined\"!=typeof window&&Te.setContext(window),this.setAnimationLoop=function(e){_e=e,ge.setAnimationLoop(e),null===e?Te.stop():Te.start()},ge.addEventListener(\"sessionstart\",be),ge.addEventListener(\"sessionend\",Me),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error(\"THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.\");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ge.enabled&&!0===ge.isPresenting&&(!0===ge.cameraAutoUpdate&&ge.updateCamera(t),t=ge.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,x),d=ne.get(e,f.length),d.init(),f.push(d),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),D.setFromProjectionMatrix(F),z=this.localClippingEnabled,N=re.init(this.clippingPlanes,z,t),h=te.get(e,p.length),h.init(),p.push(h),function e(t,n,r,i){if(!1===t.visible)return;if(t.layers.test(n.layers))if(t.isGroup)r=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(n);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||D.intersectsSprite(t)){i&&G.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=K.update(t),n=t.material;n.visible&&h.push(t,e,n,r,G.z,null)}}else if(t.isImmediateRenderObject)i&&G.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F),h.push(t,null,t.material,r,G.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==W.render.frame&&(t.skeleton.update(),t.skeleton.frame=W.render.frame),!t.frustumCulled||D.intersectsObject(t))){i&&G.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=K.update(t),n=t.material;if(Array.isArray(n)){const i=e.groups;for(let o=0,s=i.length;o<s;o++){const s=i[o],a=n[s.materialIndex];a&&a.visible&&h.push(t,e,a,r,G.z,s)}}else n.visible&&h.push(t,e,n,r,G.z,null)}const o=t.children;for(let t=0,s=o.length;t<s;t++)e(o[t],n,r,i)}(e,t,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(A,P),!0===N&&re.beginShadows();const n=d.state.shadowsArray;ie.render(n,e,t),d.setupLights(),d.setupLightsView(t),!0===N&&re.endShadows(),!0===this.info.autoReset&&this.info.reset(),oe.render(h,e);const r=h.opaque,i=h.transmissive,o=h.transparent;r.length>0&&Ee(r,e,t),i.length>0&&function(e,t,n,r){null===B&&(B=new rr(1024,1024,{generateMipmaps:!0,minFilter:we,magFilter:fe,wrapS:de,wrapT:de}));const i=m.getRenderTarget();m.setRenderTarget(B),m.clear(),Ee(e,n,r),X.updateRenderTargetMipmap(B),m.setRenderTarget(i),Ee(t,n,r)}(r,i,e,t),o.length>0&&Ee(o,e,t),null!==x&&(X.updateRenderTargetMipmap(x),X.updateMultisampleRenderTarget(x)),!0===e.isScene&&e.onAfterRender(m,e,t),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),ue.resetDefaultState(),_=-1,b=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTarget=function(e,t=0,n=0){x=e,v=t,y=n,e&&void 0===q.get(e).__webglFramebuffer&&X.setupRenderTarget(e);let r=null,i=!1,o=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(o=!0);const s=q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=s[t],i=!0):r=e.isWebGLMultisampleRenderTarget?q.get(e).__webglMultisampledFramebuffer:s,w.copy(e.viewport),M.copy(e.scissor),S=e.scissorTest}else w.copy(C).multiplyScalar(L).floor(),M.copy(R).multiplyScalar(L).floor(),S=I;if(j.bindFramebuffer(36160,r)&&H.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const n=e.texture;if(O.length!==n.length||36064!==O[0]){for(let e=0,t=n.length;e<t;e++)O[e]=36064+e;O.length=n.length,t=!0}}else 1===O.length&&36064===O[0]||(O[0]=36064,O.length=1,t=!0);else 1===O.length&&1029===O[0]||(O[0]=1029,O.length=1,t=!0);t&&(H.isWebGL2?he.drawBuffers(O):V.get(\"WEBGL_draw_buffers\").drawBuffersWEBGL(O))}if(j.viewport(w),j.scissor(M),j.setScissorTest(S),i){const r=q.get(e.texture);he.framebufferTexture2D(36160,36064,34069+t,r.__webglTexture,n)}else if(o){const r=q.get(e.texture),i=t||0;he.framebufferTextureLayer(36160,36064,r.__webglTexture,n||0,i)}},this.readRenderTargetPixels=function(e,t,n,r,i,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.\");let a=q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){j.bindFramebuffer(36160,a);try{const s=e.texture,a=s.format,l=s.type;if(a!==Fe&&ce.convert(a)!==he.getParameter(35739))return void console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.\");const c=l===Re&&(V.has(\"EXT_color_buffer_half_float\")||H.isWebGL2&&V.has(\"EXT_color_buffer_float\"));if(!(l===Se||ce.convert(l)===he.getParameter(35738)||l===Ce&&(H.isWebGL2||V.has(\"OES_texture_float\")||V.has(\"WEBGL_color_buffer_float\"))||c))return void console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.\");36053===he.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&he.readPixels(t,n,r,i,ce.convert(a),ce.convert(l),o):console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.\")}finally{const e=null!==x?q.get(x).__webglFramebuffer:null;j.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r);let s=ce.convert(t.format);H.isWebGL2&&(6407===s&&(s=32849),6408===s&&(s=32856)),X.setTexture2D(t,0),he.copyTexImage2D(3553,n,s,e.x,e.y,i,o,0),j.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,o=t.image.height,s=ce.convert(n.format),a=ce.convert(n.type);X.setTexture2D(n,0),he.pixelStorei(37440,n.flipY),he.pixelStorei(37441,n.premultiplyAlpha),he.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?he.texSubImage2D(3553,r,e.x,e.y,i,o,s,a,t.image.data):t.isCompressedTexture?he.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):he.texSubImage2D(3553,r,e.x,e.y,s,a,t.image),0===r&&n.generateMipmaps&&he.generateMipmap(3553),j.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r,i=0){if(m.isWebGL1Renderer)return void console.warn(\"THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.\");const{width:o,height:s,data:a}=n.image,l=ce.convert(r.format),c=ce.convert(r.type);let u;if(r.isDataTexture3D)X.setTexture3D(r,0),u=32879;else{if(!r.isDataTexture2DArray)return void console.warn(\"THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.\");X.setTexture2DArray(r,0),u=35866}he.pixelStorei(37440,r.flipY),he.pixelStorei(37441,r.premultiplyAlpha),he.pixelStorei(3317,r.unpackAlignment);const h=he.getParameter(3314),d=he.getParameter(32878),p=he.getParameter(3316),f=he.getParameter(3315),g=he.getParameter(32877);he.pixelStorei(3314,o),he.pixelStorei(32878,s),he.pixelStorei(3316,e.min.x),he.pixelStorei(3315,e.min.y),he.pixelStorei(32877,e.min.z),he.texSubImage3D(u,i,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,l,c,a),he.pixelStorei(3314,h),he.pixelStorei(32878,d),he.pixelStorei(3316,p),he.pixelStorei(3315,f),he.pixelStorei(32877,g),0===i&&r.generateMipmaps&&he.generateMipmap(u),j.unbindTexture()},this.initTexture=function(e){X.setTexture2D(e,0),j.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,j.reset(),ue.reset()},\"undefined\"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent(\"observe\",{detail:this}))}class Qa extends $a{}Qa.prototype.isWebGL1Renderer=!0;class el{constructor(e,t=25e-5){this.name=\"\",this.color=new Oi(e),this.density=t}clone(){return new el(this.color,this.density)}toJSON(){return{type:\"FogExp2\",color:this.color.getHex(),density:this.density}}}el.prototype.isFogExp2=!0;class tl{constructor(e,t=1,n=1e3){this.name=\"\",this.color=new Oi(e),this.near=t,this.far=n}clone(){return new tl(this.color,this.near,this.far)}toJSON(){return{type:\"Fog\",color:this.color.getHex(),near:this.near,far:this.far}}}tl.prototype.isFog=!0;class nl extends ci{constructor(){super(),this.type=\"Scene\",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,\"undefined\"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent(\"observe\",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}nl.prototype.isScene=!0;class rl{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Tn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=kn()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=kn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=kn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}rl.prototype.isInterleavedBuffer=!0;const il=new ar;class ol{constructor(e,t,n,r){this.name=\"\",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)il.x=this.getX(t),il.y=this.getY(t),il.z=this.getZ(t),il.applyMatrix4(e),this.setXYZ(t,il.x,il.y,il.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)il.x=this.getX(t),il.y=this.getY(t),il.z=this.getZ(t),il.applyNormalMatrix(e),this.setXYZ(t,il.x,il.y,il.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)il.x=this.getX(t),il.y=this.getY(t),il.z=this.getZ(t),il.transformDirection(e),this.setXYZ(t,il.x,il.y,il.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log(\"THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.\");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Bi(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ol(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log(\"THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.\");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ol.prototype.isInterleavedBufferAttribute=!0;class sl extends Ei{constructor(e){super(),this.type=\"SpriteMaterial\",this.color=new Oi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let al;sl.prototype.isSpriteMaterial=!0;const ll=new ar,cl=new ar,ul=new ar,hl=new Zn,dl=new Zn,pl=new Fr,fl=new ar,ml=new ar,gl=new ar,vl=new Zn,yl=new Zn,xl=new Zn;class _l extends ci{constructor(e){if(super(),this.type=\"Sprite\",void 0===al){al=new io;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new rl(e,5);al.setIndex([0,1,2,0,2,3]),al.setAttribute(\"position\",new ol(t,3,0,!1)),al.setAttribute(\"uv\",new ol(t,2,3,!1))}this.geometry=al,this.material=void 0!==e?e:new sl,this.center=new Zn(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: \"Raycaster.camera\" needs to be set in order to raycast against sprites.'),cl.setFromMatrixScale(this.matrixWorld),pl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ul.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&cl.multiplyScalar(-ul.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;bl(fl.set(-.5,-.5,0),ul,o,cl,r,i),bl(ml.set(.5,-.5,0),ul,o,cl,r,i),bl(gl.set(.5,.5,0),ul,o,cl,r,i),vl.set(0,0),yl.set(1,0),xl.set(1,1);let s=e.ray.intersectTriangle(fl,ml,gl,!1,ll);if(null===s&&(bl(ml.set(-.5,.5,0),ul,o,cl,r,i),yl.set(0,1),s=e.ray.intersectTriangle(fl,gl,ml,!1,ll),null===s))return;const a=e.ray.origin.distanceTo(ll);a<e.near||a>e.far||t.push({distance:a,point:ll.clone(),uv:Si.getUV(ll,fl,ml,gl,vl,yl,xl,new Zn),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function bl(e,t,n,r,i,o){hl.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(dl.x=o*hl.x-i*hl.y,dl.y=i*hl.x+o*hl.y):dl.copy(hl),e.copy(t),e.x+=dl.x,e.y+=dl.y,e.applyMatrix4(pl)}_l.prototype.isSprite=!0;const wl=new ar,Ml=new ar;class Sl extends ci{constructor(){super(),this._currentLevel=0,this.type=\"LOD\",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){wl.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(wl);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){wl.setFromMatrixPosition(e.matrixWorld),Ml.setFromMatrixPosition(this.matrixWorld);const n=wl.distanceTo(Ml)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}}const Tl=new ar,El=new nr,Ll=new nr,Al=new ar,Pl=new Fr;class Cl extends Mo{constructor(e,t){super(e,t),this.type=\"SkinnedMesh\",this.bindMode=\"attached\",this.bindMatrix=new Fr,this.bindMatrixInverse=new Fr}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new nr,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),\"attached\"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():\"detached\"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn(\"THREE.SkinnedMesh: Unrecognized bindMode: \"+this.bindMode)}boneTransform(e,t){const n=this.skeleton,r=this.geometry;El.fromBufferAttribute(r.attributes.skinIndex,e),Ll.fromBufferAttribute(r.attributes.skinWeight,e),Tl.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=Ll.getComponent(e);if(0!==r){const i=El.getComponent(e);Pl.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Al.copy(Tl).applyMatrix4(Pl),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}Cl.prototype.isSkinnedMesh=!0;class Rl extends ci{constructor(){super(),this.type=\"Bone\"}}Rl.prototype.isBone=!0;class Il extends er{constructor(e,t,n,r,i,o,s,a,l,c,u,h){super(null,o,s,a,l,c,r,i,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:fe,this.minFilter=void 0!==c?c:fe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Il.prototype.isDataTexture=!0;const Ol=new Fr,Dl=new Fr;class Nl{constructor(e=[],t=[]){this.uuid=kn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn(\"THREE.Skeleton: Number of inverse bone matrices does not match amount of bones.\"),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Fr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Fr;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:Dl;Ol.multiplyMatrices(i,t[r]),Ol.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new Nl(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=qn(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Il(t,e,e,Fe,Ce);return this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn(\"THREE.Skeleton: No bone found with UUID:\",r),i=new Rl),this.bones.push(i),this.boneInverses.push((new Fr).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:\"Skeleton\",generator:\"Skeleton.toJSON\"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const o=n[r];e.boneInverses.push(o.toArray())}return e}}const zl=new Fr,Bl=new Fr,Fl=[],Gl=new Mo;class Ul extends Mo{constructor(e,t,n){super(e,t),this.instanceMatrix=new Bi(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(Gl.geometry=this.geometry,Gl.material=this.material,void 0!==Gl.material)for(let i=0;i<r;i++){this.getMatrixAt(i,zl),Bl.multiplyMatrices(n,zl),Gl.matrixWorld=Bl,Gl.raycast(e,Fl);for(let e=0,n=Fl.length;e<n;e++){const n=Fl[e];n.instanceId=i,n.object=this,t.push(n)}Fl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Bi(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:\"dispose\"})}}Ul.prototype.isInstancedMesh=!0;class kl extends Ei{constructor(e){super(),this.type=\"LineBasicMaterial\",this.color=new Oi(16777215),this.linewidth=1,this.linecap=\"round\",this.linejoin=\"round\",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}kl.prototype.isLineBasicMaterial=!0;const Vl=new ar,Hl=new ar,jl=new Fr,Wl=new Br,ql=new Pr;class Xl extends ci{constructor(e=new io,t=new kl){super(),this.type=\"Line\",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Vl.fromBufferAttribute(t,e-1),Hl.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Vl.distanceTo(Hl);e.setAttribute(\"lineDistance\",new qi(n,1))}else console.warn(\"THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.\");else e.isGeometry&&console.error(\"THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ql.copy(n.boundingSphere),ql.applyMatrix4(r),ql.radius+=i,!1===e.ray.intersectsSphere(ql))return;jl.copy(r).invert(),Wl.copy(e.ray).applyMatrix4(jl);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=new ar,c=new ar,u=new ar,h=new ar,d=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){for(let n=Math.max(0,o.start),s=Math.min(r.count,o.start+o.count)-1;n<s;n+=d){const o=r.getX(n),s=r.getX(n+1);l.fromBufferAttribute(i,o),c.fromBufferAttribute(i,s);if(Wl.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(h);d<e.near||d>e.far||t.push({distance:d,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,o.start),r=Math.min(i.count,o.start+o.count)-1;n<r;n+=d){l.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1);if(Wl.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(h);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error(\"THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error(\"THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.\")}}}Xl.prototype.isLine=!0;const Yl=new ar,Zl=new ar;class Jl extends Xl{constructor(e,t){super(e,t),this.type=\"LineSegments\"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)Yl.fromBufferAttribute(t,e),Zl.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Yl.distanceTo(Zl);e.setAttribute(\"lineDistance\",new qi(n,1))}else console.warn(\"THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.\");else e.isGeometry&&console.error(\"THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\");return this}}Jl.prototype.isLineSegments=!0;class Kl extends Xl{constructor(e,t){super(e,t),this.type=\"LineLoop\"}}Kl.prototype.isLineLoop=!0;class $l extends Ei{constructor(e){super(),this.type=\"PointsMaterial\",this.color=new Oi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}$l.prototype.isPointsMaterial=!0;const Ql=new Fr,ec=new Br,tc=new Pr,nc=new ar;class rc extends ci{constructor(e=new io,t=new $l){super(),this.type=\"Points\",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),tc.copy(n.boundingSphere),tc.applyMatrix4(r),tc.radius+=i,!1===e.ray.intersectsSphere(tc))return;Ql.copy(r).invert(),ec.copy(e.ray).applyMatrix4(Ql);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position;if(null!==i){for(let n=Math.max(0,o.start),l=Math.min(i.count,o.start+o.count);n<l;n++){const o=i.getX(n);nc.fromBufferAttribute(s,o),ic(nc,o,a,r,e,t,this)}}else{for(let n=Math.max(0,o.start),i=Math.min(s.count,o.start+o.count);n<i;n++)nc.fromBufferAttribute(s,n),ic(nc,n,a,r,e,t,this)}}else console.error(\"THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error(\"THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.\")}}}function ic(e,t,n,r,i,o,s){const a=ec.distanceSqToPoint(e);if(a<n){const n=new ar;ec.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:s})}}rc.prototype.isPoints=!0;class oc extends er{constructor(e,t,n,r,i,o,s,a,l){super(e,t,n,r,i,o,s,a,l),this.format=void 0!==s?s:Be,this.minFilter=void 0!==o?o:xe,this.magFilter=void 0!==i?i:xe,this.generateMipmaps=!1;const c=this;\"requestVideoFrameCallback\"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1===\"requestVideoFrameCallback\"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}oc.prototype.isVideoTexture=!0;class sc extends er{constructor(e,t,n,r,i,o,s,a,l,c,u,h){super(null,o,s,a,l,c,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}sc.prototype.isCompressedTexture=!0;class ac extends er{constructor(e,t,n,r,i,o,s,a,l){super(e,t,n,r,i,o,s,a,l),this.needsUpdate=!0}}ac.prototype.isCanvasTexture=!0;class lc extends er{constructor(e,t,n,r,i,o,s,a,l,c){if((c=void 0!==c?c:Ve)!==Ve&&c!==He)throw new Error(\"DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat\");void 0===n&&c===Ve&&(n=Le),void 0===n&&c===He&&(n=Ne),super(null,r,i,o,s,a,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:fe,this.minFilter=void 0!==a?a:fe,this.flipY=!1,this.generateMipmaps=!1}}lc.prototype.isDepthTexture=!0;class cc extends io{constructor(e=1,t=8,n=0,r=2*Math.PI){super(),this.type=\"CircleGeometry\",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],o=[],s=[],a=[],l=new ar,c=new Zn;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let i=0,u=3;i<=t;i++,u+=3){const h=n+i/t*r;l.x=e*Math.cos(h),l.y=e*Math.sin(h),o.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(o[u]/e+1)/2,c.y=(o[u+1]/e+1)/2,a.push(c.x,c.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute(\"position\",new qi(o,3)),this.setAttribute(\"normal\",new qi(s,3)),this.setAttribute(\"uv\",new qi(a,2))}}class uc extends io{constructor(e=1,t=1,n=1,r=8,i=1,o=!1,s=0,a=2*Math.PI){super(),this.type=\"CylinderGeometry\",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const i=p,o=new Zn,f=new ar;let v=0;const y=!0===n?e:t,x=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*x,0),h.push(0,x,0),d.push(.5,.5),p++;const _=p;for(let e=0;e<=r;e++){const t=e/r*a+s,n=Math.cos(t),i=Math.sin(t);f.x=y*i,f.y=m*x,f.z=y*n,u.push(f.x,f.y,f.z),h.push(0,x,0),o.x=.5*n+.5,o.y=.5*i*x+.5,d.push(o.x,o.y),p++}for(let e=0;e<r;e++){const t=i+e,r=_+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const o=new ar,v=new ar;let y=0;const x=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,y=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*a+s,l=Math.sin(i),f=Math.cos(i);v.x=y*l,v.y=-g*n+m,v.z=y*f,u.push(v.x,v.y,v.z),o.set(l,x,f).normalize(),h.push(o.x,o.y,o.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=f[t][e],r=f[t+1][e],i=f[t+1][e+1],o=f[t][e+1];c.push(n,r,o),c.push(r,i,o),y+=6}l.addGroup(g,y,0),g+=y}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute(\"position\",new qi(u,3)),this.setAttribute(\"normal\",new qi(h,3)),this.setAttribute(\"uv\",new qi(d,2))}}class hc extends uc{constructor(e=1,t=1,n=8,r=1,i=!1,o=0,s=2*Math.PI){super(0,e,t,n,r,i,o,s),this.type=\"ConeGeometry\",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:s}}}class dc extends io{constructor(e,t,n=1,r=0){super(),this.type=\"PolyhedronGeometry\",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],o=[];function s(e,t,n,r){const i=r+1,o=[];for(let r=0;r<=i;r++){o[r]=[];const s=e.clone().lerp(n,r/i),a=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)o[r][e]=0===e&&r===i?s:s.clone().lerp(a,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(a(o[e][n+1]),a(o[e+1][n]),a(o[e][n])):(a(o[e][n+1]),a(o[e+1][n+1]),a(o[e+1][n]))}}function a(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new ar,r=new ar,i=new ar;for(let o=0;o<t.length;o+=3)l(t[o+0],n),l(t[o+1],r),l(t[o+2],i),s(n,r,i,e)}(r),function(e){const t=new ar;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new ar;for(let n=0;n<i.length;n+=3){e.x=i[n+0],e.y=i[n+1],e.z=i[n+2];const r=u(e)/2/Math.PI+.5,s=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(r,1-s)}var t;(function(){const e=new ar,t=new ar,n=new ar,r=new ar,s=new Zn,a=new Zn,l=new Zn;for(let h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),r.copy(e).add(t).add(n).divideScalar(3);const p=u(r);c(s,d+0,e,p),c(a,d+2,t,p),c(l,d+4,n,p)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],r=o[e+4],i=Math.max(t,n,r),s=Math.min(t,n,r);i>.9&&s<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute(\"position\",new qi(i,3)),this.setAttribute(\"normal\",new qi(i.slice(),3)),this.setAttribute(\"uv\",new qi(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}}class pc extends dc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type=\"DodecahedronGeometry\",this.parameters={radius:e,detail:t}}}const fc=new ar,mc=new ar,gc=new ar,vc=new Si;class yc extends io{constructor(e,t){if(super(),this.type=\"EdgesGeometry\",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0===e.isGeometry)return void console.error(\"THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\");const n=Math.pow(10,4),r=Math.cos(Gn*t),i=e.getIndex(),o=e.getAttribute(\"position\"),s=i?i.count:o.count,a=[0,0,0],l=[\"a\",\"b\",\"c\"],c=new Array(3),u={},h=[];for(let e=0;e<s;e+=3){i?(a[0]=i.getX(e),a[1]=i.getX(e+1),a[2]=i.getX(e+2)):(a[0]=e,a[1]=e+1,a[2]=e+2);const{a:t,b:s,c:d}=vc;if(t.fromBufferAttribute(o,a[0]),s.fromBufferAttribute(o,a[1]),d.fromBufferAttribute(o,a[2]),vc.getNormal(gc),c[0]=`${Math.round(t.x*n)},${Math.round(t.y*n)},${Math.round(t.z*n)}`,c[1]=`${Math.round(s.x*n)},${Math.round(s.y*n)},${Math.round(s.z*n)}`,c[2]=`${Math.round(d.x*n)},${Math.round(d.y*n)},${Math.round(d.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=c[e],i=c[t],o=vc[l[e]],s=vc[l[t]],d=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(gc.dot(u[p].normal)<=r&&(h.push(o.x,o.y,o.z),h.push(s.x,s.y,s.z)),u[p]=null):d in u||(u[d]={index0:a[e],index1:a[t],normal:gc.clone()})}}for(const e in u)if(u[e]){const{index0:t,index1:n}=u[e];fc.fromBufferAttribute(o,t),mc.fromBufferAttribute(o,n),h.push(fc.x,fc.y,fc.z),h.push(mc.x,mc.y,mc.z)}this.setAttribute(\"position\",new qi(h,3))}}const xc=function(e,t,n){n=n||2;const r=t&&t.length,i=r?t[0]*n:e.length;let o=_c(e,0,i,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c,u,h,d,p;if(r&&(o=function(e,t,n,r){const i=[];let o,s,a,l,c;for(o=0,s=t.length;o<s;o++)a=t[o]*r,l=o<s-1?t[o+1]*r:e.length,c=_c(e,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Rc(c));for(i.sort(Lc),o=0;o<i.length;o++)Ac(i[o],n),n=bc(n,n.next);return n}(e,t,o,n)),e.length>80*n){a=c=e[0],l=u=e[1];for(let t=n;t<i;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?1/p:0}return wc(o,s,n,a,l,p),s};function _c(e,t,n,r,i){let o,s;if(i===function(e,t,n,r){let i=0;for(let o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)s=kc(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=kc(o,e[o],e[o+1],s);return s&&Nc(s,s.next)&&(Vc(s),s=s.next),s}function bc(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Nc(r,r.next)&&0!==Dc(r.prev,r,r.next))r=r.next;else{if(Vc(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function wc(e,t,n,r,i,o,s){if(!e)return;!s&&o&&function(e,t,n,r){let i=e;do{null===i.z&&(i.z=Cc(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,a=0,t=0;t<c&&(a++,r=r.nextZ,r);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(s>1)}(i)}(e,r,i,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Sc(e,r,i,o):Mc(e))t.push(a.i/n),t.push(e.i/n),t.push(l.i/n),Vc(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?wc(e=Tc(bc(e),t,n),t,n,r,i,o,2):2===s&&Ec(e,t,n,r,i,o):wc(bc(e),t,n,r,i,o,1);break}}function Mc(e){const t=e.prev,n=e,r=e.next;if(Dc(t,n,r)>=0)return!1;let i=e.next.next;for(;i!==e.prev;){if(Ic(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Dc(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Sc(e,t,n,r){const i=e.prev,o=e,s=e.next;if(Dc(i,o,s)>=0)return!1;const a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,l=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,c=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=Cc(a,l,t,n,r),d=Cc(c,u,t,n,r);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&Ic(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Dc(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&Ic(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Dc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Ic(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Dc(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&Ic(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Dc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Tc(e,t,n){let r=e;do{const i=r.prev,o=r.next.next;!Nc(i,o)&&zc(i,r,r.next,o)&&Gc(i,o)&&Gc(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),Vc(r),Vc(r.next),r=e=o),r=r.next}while(r!==e);return bc(r)}function Ec(e,t,n,r,i,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Oc(s,e)){let a=Uc(s,e);return s=bc(s,s.next),a=bc(a,a.next),wc(s,t,n,r,i,o),void wc(a,t,n,r,i,o)}e=e.next}s=s.next}while(s!==e)}function Lc(e,t){return e.x-t.x}function Ac(e,t){if(t=function(e,t){let n=t;const r=e.x,i=e.y;let o,s=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>s){if(s=e,e===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!o)return null;if(r===s)return o;const a=o,l=o.x,c=o.y;let u,h=1/0;n=o;do{r>=n.x&&n.x>=l&&r!==n.x&&Ic(i<c?r:s,i,l,c,i<c?s:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),Gc(n,e)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&Pc(o,n)))&&(o=n,h=u)),n=n.next}while(n!==a);return o}(e,t)){const n=Uc(t,e);bc(t,t.next),bc(n,n.next)}}function Pc(e,t){return Dc(e.prev,e,t.prev)<0&&Dc(t.next,e,e.next)<0}function Cc(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Rc(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ic(e,t,n,r,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function Oc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&zc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Gc(e,t)&&Gc(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Dc(e.prev,e,t.prev)||Dc(e,t.prev,t))||Nc(e,t)&&Dc(e.prev,e,e.next)>0&&Dc(t.prev,t,t.next)>0)}function Dc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Nc(e,t){return e.x===t.x&&e.y===t.y}function zc(e,t,n,r){const i=Fc(Dc(e,t,n)),o=Fc(Dc(e,t,r)),s=Fc(Dc(n,r,e)),a=Fc(Dc(n,r,t));return i!==o&&s!==a||(!(0!==i||!Bc(e,n,t))||(!(0!==o||!Bc(e,r,t))||(!(0!==s||!Bc(n,e,r))||!(0!==a||!Bc(n,t,r)))))}function Bc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Fc(e){return e>0?1:e<0?-1:0}function Gc(e,t){return Dc(e.prev,e,e.next)<0?Dc(e,t,e.next)>=0&&Dc(e,e.prev,t)>=0:Dc(e,t,e.prev)<0||Dc(e,e.next,t)<0}function Uc(e,t){const n=new Hc(e.i,e.x,e.y),r=new Hc(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function kc(e,t,n,r){const i=new Hc(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Vc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Hc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class jc{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return jc.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];Wc(e),qc(n,e);let o=e.length;t.forEach(Wc);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,qc(n,t[e]);const s=xc(n,r);for(let e=0;e<s.length;e+=3)i.push(s.slice(e,e+3));return i}}function Wc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function qc(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Xc extends io{constructor(e,t){super(),this.type=\"ExtrudeGeometry\",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++){o(e[t])}function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Yc;void 0!==t.amount&&(console.warn(\"THREE.ExtrudeBufferGeometry: amount has been renamed to depth.\"),l=t.amount);let g,v,y,x,_,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,c=!1,v=f.computeFrenetFrames(a,!1),y=new ar,x=new ar,_=new ar),c||(p=0,u=0,h=0,d=0);const w=e.extractPoints(s);let M=w.shape;const S=w.holes;if(!jc.isClockWise(M)){M=M.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];jc.isClockWise(t)&&(S[e]=t.reverse())}}const T=jc.triangulateShape(M,S),E=M;for(let e=0,t=S.length;e<t;e++){const t=S[e];M=M.concat(t)}function L(e,t,n){return t||console.error(\"THREE.ExtrudeGeometry: vec does not exist\"),t.clone().multiplyScalar(n).add(e)}const A=M.length,P=T.length;function C(e,t,n){let r,i,o;const s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+a*a,h=s*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-a/h,f=t.y+s/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(s*c-a*l);r=p+s*m-e.x,i=f+a*m-e.y;const g=r*r+i*i;if(g<=2)return new Zn(r,i);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(r=-a,i=s,o=Math.sqrt(u)):(r=s,i=a,o=Math.sqrt(u/2))}return new Zn(r/o,i/o)}const R=[];for(let e=0,t=E.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),R[e]=C(E[e],E[n],E[r]);const I=[];let O,D=R.concat();for(let e=0,t=S.length;e<t;e++){const t=S[e];O=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),O[e]=C(t[e],t[r],t[i]);I.push(O),D=D.concat(O)}for(let e=0;e<p;e++){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=L(E[e],R[e],r);B(t.x,t.y,-n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];O=I[e];for(let e=0,i=t.length;e<i;e++){const i=L(t[e],O[e],r);B(i.x,i.y,-n)}}}const N=h+d;for(let e=0;e<A;e++){const t=c?L(M[e],D[e],N):M[e];b?(x.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),_.copy(g[0]).add(x).add(y),B(_.x,_.y,_.z)):B(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<A;t++){const n=c?L(M[t],D[t],N):M[t];b?(x.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),_.copy(g[e]).add(x).add(y),B(_.x,_.y,_.z)):B(n.x,n.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=L(E[e],R[e],r);B(t.x,t.y,l+n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];O=I[e];for(let e=0,i=t.length;e<i;e++){const i=L(t[e],O[e],r);b?B(i.x,i.y+g[a-1].y,g[a-1].x+n):B(i.x,i.y,l+n)}}}function z(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=A*e,o=A*(e+1);G(t+r+n,t+i+n,t+i+o,t+r+o)}}}function B(e,t,n){o.push(e),o.push(t),o.push(n)}function F(e,t,i){U(e),U(t),U(i);const o=r.length/3,s=m.generateTopUV(n,r,o-3,o-2,o-1);k(s[0]),k(s[1]),k(s[2])}function G(e,t,i,o){U(e),U(t),U(o),U(t),U(i),U(o);const s=r.length/3,a=m.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);k(a[0]),k(a[1]),k(a[3]),k(a[1]),k(a[2]),k(a[3])}function U(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function k(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=A*e;for(let e=0;e<P;e++){const n=T[e];F(n[2]+t,n[1]+t,n[0]+t)}e=a+2*p,t=A*e;for(let e=0;e<P;e++){const n=T[e];F(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<P;e++){const t=T[e];F(t[2],t[1],t[0])}for(let e=0;e<P;e++){const t=T[e];F(t[0]+A*a,t[1]+A*a,t[2]+A*a)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;z(E,t),t+=E.length;for(let e=0,n=S.length;e<n;e++){const n=S[e];z(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute(\"position\",new qi(r,3)),this.setAttribute(\"uv\",new qi(i,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}const Yc={generateTopUV:function(e,t,n,r,i){const o=t[3*n],s=t[3*n+1],a=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new Zn(o,s),new Zn(a,l),new Zn(c,u)]},generateSideWallUV:function(e,t,n,r,i,o){const s=t[3*n],a=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(a-u)<Math.abs(s-c)?[new Zn(s,1-l),new Zn(c,1-h),new Zn(d,1-f),new Zn(m,1-v)]:[new Zn(a,1-l),new Zn(u,1-h),new Zn(p,1-f),new Zn(g,1-v)]}};class Zc extends dc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type=\"IcosahedronGeometry\",this.parameters={radius:e,detail:t}}}class Jc extends io{constructor(e,t=12,n=0,r=2*Math.PI){super(),this.type=\"LatheGeometry\",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=Vn(r,0,2*Math.PI);const i=[],o=[],s=[],a=1/t,l=new ar,c=new Zn;for(let i=0;i<=t;i++){const u=n+i*a*r,h=Math.sin(u),d=Math.cos(u);for(let n=0;n<=e.length-1;n++)l.x=e[n].x*h,l.y=e[n].y,l.z=e[n].x*d,o.push(l.x,l.y,l.z),c.x=i/t,c.y=n/(e.length-1),s.push(c.x,c.y)}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,o=r,s=r+e.length,a=r+e.length+1,l=r+1;i.push(o,s,l),i.push(s,a,l)}if(this.setIndex(i),this.setAttribute(\"position\",new qi(o,3)),this.setAttribute(\"uv\",new qi(s,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new ar,i=new ar,o=new ar,s=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)r.x=n[a+0],r.y=n[a+1],r.z=n[a+2],i.x=n[s+a+0],i.y=n[s+a+1],i.z=n[s+a+2],o.addVectors(r,i).normalize(),n[a+0]=n[s+a+0]=o.x,n[a+1]=n[s+a+1]=o.y,n[a+2]=n[s+a+2]=o.z}}}class Kc extends dc{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type=\"OctahedronGeometry\",this.parameters={radius:e,detail:t}}}class $c extends io{constructor(e,t,n){super(),this.type=\"ParametricGeometry\",this.parameters={func:e,slices:t,stacks:n};const r=[],i=[],o=[],s=[],a=1e-5,l=new ar,c=new ar,u=new ar,h=new ar,d=new ar;e.length<3&&console.error(\"THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.\");const p=t+1;for(let r=0;r<=n;r++){const p=r/n;for(let n=0;n<=t;n++){const r=n/t;e(r,p,c),i.push(c.x,c.y,c.z),r-a>=0?(e(r-a,p,u),h.subVectors(c,u)):(e(r+a,p,u),h.subVectors(u,c)),p-a>=0?(e(r,p-a,u),d.subVectors(c,u)):(e(r,p+a,u),d.subVectors(u,c)),l.crossVectors(h,d).normalize(),o.push(l.x,l.y,l.z),s.push(r,p)}}for(let e=0;e<n;e++)for(let n=0;n<t;n++){const t=e*p+n,i=e*p+n+1,o=(e+1)*p+n+1,s=(e+1)*p+n;r.push(t,i,s),r.push(i,o,s)}this.setIndex(r),this.setAttribute(\"position\",new qi(i,3)),this.setAttribute(\"normal\",new qi(o,3)),this.setAttribute(\"uv\",new qi(s,2))}}class Qc extends io{constructor(e=.5,t=1,n=8,r=1,i=0,o=2*Math.PI){super(),this.type=\"RingGeometry\",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},n=Math.max(3,n);const s=[],a=[],l=[],c=[];let u=e;const h=(t-e)/(r=Math.max(1,r)),d=new ar,p=new Zn;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*o;d.x=u*Math.cos(r),d.y=u*Math.sin(r),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}u+=h}for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,o=r+n+1,a=r+n+2,l=r+1;s.push(i,o,l),s.push(o,a,l)}}this.setIndex(s),this.setAttribute(\"position\",new qi(a,3)),this.setAttribute(\"normal\",new qi(l,3)),this.setAttribute(\"uv\",new qi(c,2))}}class eu extends io{constructor(e,t=12){super(),this.type=\"ShapeGeometry\",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(s,a,t),s+=a,a=0;function l(e){const s=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===jc.isClockWise(c)&&(c=c.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===jc.isClockWise(t)&&(u[e]=t.reverse())}const h=jc.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];r.push(t.x,t.y,0),i.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],r=t[0]+s,i=t[1]+s,o=t[2]+s;n.push(r,i,o),a+=3}}this.setIndex(n),this.setAttribute(\"position\",new qi(r,3)),this.setAttribute(\"normal\",new qi(i,3)),this.setAttribute(\"uv\",new qi(o,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class tu extends io{constructor(e=1,t=8,n=6,r=0,i=2*Math.PI,o=0,s=Math.PI){super(),this.type=\"SphereGeometry\",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(o+s,Math.PI);let l=0;const c=[],u=new ar,h=new ar,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0==d&&0==o?y=.5/t:d==n&&a==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(r+a*i)*Math.sin(o+v*s),u.y=e*Math.cos(o+v*s),u.z=e*Math.sin(r+a*i)*Math.sin(o+v*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=c[e][r+1],i=c[e][r],s=c[e+1][r],l=c[e+1][r+1];(0!==e||o>0)&&d.push(t,i,l),(e!==n-1||a<Math.PI)&&d.push(i,s,l)}this.setIndex(d),this.setAttribute(\"position\",new qi(p,3)),this.setAttribute(\"normal\",new qi(f,3)),this.setAttribute(\"uv\",new qi(m,2))}}class nu extends dc{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type=\"TetrahedronGeometry\",this.parameters={radius:e,detail:t}}}class ru extends Xc{constructor(e,t={}){const n=t.font;if(!n||!n.isFont)return console.error(\"THREE.TextGeometry: font parameter is not an instance of THREE.Font.\"),new io;const r=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(r,t),this.type=\"TextGeometry\"}}class iu extends io{constructor(e=1,t=.4,n=8,r=6,i=2*Math.PI){super(),this.type=\"TorusGeometry\",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const o=[],s=[],a=[],l=[],c=new ar,u=new ar,h=new ar;for(let o=0;o<=n;o++)for(let d=0;d<=r;d++){const p=d/r*i,f=o/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(d/r),l.push(o/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,s=(r+1)*(e-1)+t,a=(r+1)*e+t;o.push(n,i,a),o.push(i,s,a)}this.setIndex(o),this.setAttribute(\"position\",new qi(s,3)),this.setAttribute(\"normal\",new qi(a,3)),this.setAttribute(\"uv\",new qi(l,2))}}class ou extends io{constructor(e=1,t=.4,n=64,r=8,i=2,o=3){super(),this.type=\"TorusKnotGeometry\",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},n=Math.floor(n),r=Math.floor(r);const s=[],a=[],l=[],c=[],u=new ar,h=new ar,d=new ar,p=new ar,f=new ar,m=new ar,g=new ar;for(let s=0;s<=n;++s){const y=s/n*i*Math.PI*2;v(y,i,o,e,d),v(y+.01,i,o,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,o=-t*Math.cos(i),p=t*Math.sin(i);u.x=d.x+(o*g.x+p*f.x),u.y=d.y+(o*g.y+p*f.y),u.z=d.z+(o*g.z+p*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(s/n),c.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,a=(r+1)*(e-1)+t;s.push(n,i,a),s.push(i,o,a)}function v(e,t,n,r,i){const o=Math.cos(e),s=Math.sin(e),a=n/t*e,l=Math.cos(a);i.x=r*(2+l)*.5*o,i.y=r*(2+l)*s*.5,i.z=r*Math.sin(a)*.5}this.setIndex(s),this.setAttribute(\"position\",new qi(a,3)),this.setAttribute(\"normal\",new qi(l,3)),this.setAttribute(\"uv\",new qi(c,2))}}class su extends io{constructor(e,t=64,n=1,r=8,i=!1){super(),this.type=\"TubeGeometry\",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new ar,a=new ar,l=new Zn;let c=new ar;const u=[],h=[],d=[],p=[];function f(i){c=e.getPointAt(i/t,c);const l=o.normals[i],d=o.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),o=-Math.cos(t);a.x=o*l.x+i*d.x,a.y=o*l.y+i*d.y,a.z=o*l.z+i*d.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=c.x+n*a.x,s.y=c.y+n*a.y,s.z=c.z+n*a.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,s=(r+1)*(e-1)+t;p.push(n,i,s),p.push(i,o,s)}}()}(),this.setIndex(p),this.setAttribute(\"position\",new qi(u,3)),this.setAttribute(\"normal\",new qi(h,3)),this.setAttribute(\"uv\",new qi(d,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}}class au extends io{constructor(e){if(super(),this.type=\"WireframeGeometry\",!0===e.isGeometry)return void console.error(\"THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\");const t=[],n=[0,0],r={},i=new ar;if(null!==e.index){const o=e.attributes.position,s=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,t=a.length;e<t;++e){const t=a[e],i=t.start;for(let e=i,o=i+t.count;e<o;e+=3)for(let t=0;t<3;t++){const i=s.getX(e+t),o=s.getX(e+(t+1)%3);n[0]=Math.min(i,o),n[1]=Math.max(i,o);const a=n[0]+\",\"+n[1];void 0===r[a]&&(r[a]={index1:n[0],index2:n[1]})}}for(const e in r){const n=r[e];i.fromBufferAttribute(o,n.index1),t.push(i.x,i.y,i.z),i.fromBufferAttribute(o,n.index2),t.push(i.x,i.y,i.z)}}else{const n=e.attributes.position;for(let e=0,r=n.count/3;e<r;e++)for(let r=0;r<3;r++){const o=3*e+r;i.fromBufferAttribute(n,o),t.push(i.x,i.y,i.z);const s=3*e+(r+1)%3;i.fromBufferAttribute(n,s),t.push(i.x,i.y,i.z)}}this.setAttribute(\"position\",new qi(t,3))}}var lu=Object.freeze({__proto__:null,BoxGeometry:To,BoxBufferGeometry:To,CircleGeometry:cc,CircleBufferGeometry:cc,ConeGeometry:hc,ConeBufferGeometry:hc,CylinderGeometry:uc,CylinderBufferGeometry:uc,DodecahedronGeometry:pc,DodecahedronBufferGeometry:pc,EdgesGeometry:yc,ExtrudeGeometry:Xc,ExtrudeBufferGeometry:Xc,IcosahedronGeometry:Zc,IcosahedronBufferGeometry:Zc,LatheGeometry:Jc,LatheBufferGeometry:Jc,OctahedronGeometry:Kc,OctahedronBufferGeometry:Kc,ParametricGeometry:$c,ParametricBufferGeometry:$c,PlaneGeometry:Uo,PlaneBufferGeometry:Uo,PolyhedronGeometry:dc,PolyhedronBufferGeometry:dc,RingGeometry:Qc,RingBufferGeometry:Qc,ShapeGeometry:eu,ShapeBufferGeometry:eu,SphereGeometry:tu,SphereBufferGeometry:tu,TetrahedronGeometry:nu,TetrahedronBufferGeometry:nu,TextGeometry:ru,TextBufferGeometry:ru,TorusGeometry:iu,TorusBufferGeometry:iu,TorusKnotGeometry:ou,TorusKnotBufferGeometry:ou,TubeGeometry:su,TubeBufferGeometry:su,WireframeGeometry:au});class cu extends Ei{constructor(e){super(),this.type=\"ShadowMaterial\",this.color=new Oi(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}cu.prototype.isShadowMaterial=!0;class uu extends Po{constructor(e){super(e),this.type=\"RawShaderMaterial\"}}uu.prototype.isRawShaderMaterial=!0;class hu extends Ei{constructor(e){super(),this.defines={STANDARD:\"\"},this.type=\"MeshStandardMaterial\",this.color=new Oi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:\"\"},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}}hu.prototype.isMeshStandardMaterial=!0;class du extends hu{constructor(e){super(),this.defines={STANDARD:\"\",PHYSICAL:\"\"},this.type=\"MeshPhysicalMaterial\",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Zn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,\"ior\",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Vn(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Oi(1,1,1),this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:\"\",PHYSICAL:\"\"},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Oi).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this}}du.prototype.isMeshPhysicalMaterial=!0;class pu extends Ei{constructor(e){super(),this.type=\"MeshPhongMaterial\",this.color=new Oi(16777215),this.specular=new Oi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}pu.prototype.isMeshPhongMaterial=!0;class fu extends Ei{constructor(e){super(),this.defines={TOON:\"\"},this.type=\"MeshToonMaterial\",this.color=new Oi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}fu.prototype.isMeshToonMaterial=!0;class mu extends Ei{constructor(e){super(),this.type=\"MeshNormalMaterial\",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}mu.prototype.isMeshNormalMaterial=!0;class gu extends Ei{constructor(e){super(),this.type=\"MeshLambertMaterial\",this.color=new Oi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}gu.prototype.isMeshLambertMaterial=!0;class vu extends Ei{constructor(e){super(),this.defines={MATCAP:\"\"},this.type=\"MeshMatcapMaterial\",this.color=new Oi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:\"\"},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}vu.prototype.isMeshMatcapMaterial=!0;class yu extends kl{constructor(e){super(),this.type=\"LineDashedMaterial\",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}yu.prototype.isLineDashedMaterial=!0;var xu=Object.freeze({__proto__:null,ShadowMaterial:cu,SpriteMaterial:sl,RawShaderMaterial:uu,ShaderMaterial:Po,PointsMaterial:$l,MeshPhysicalMaterial:du,MeshStandardMaterial:hu,MeshPhongMaterial:pu,MeshToonMaterial:fu,MeshNormalMaterial:mu,MeshLambertMaterial:gu,MeshDepthMaterial:Ua,MeshDistanceMaterial:ka,MeshBasicMaterial:Di,MeshMatcapMaterial:vu,LineDashedMaterial:yu,LineBasicMaterial:kl,Material:Ei});const _u={arraySlice:function(e,t,n){return _u.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:\"number\"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const r=e.length,i=new e.constructor(r);for(let o=0,s=0;s!==r;++o){const r=n[o]*t;for(let n=0;n!==t;++n)i[s++]=e[r+n]}return i},flattenJSON:function(e,t,n,r){let i=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[i++];if(void 0===o)return;let s=o[r];if(void 0!==s)if(Array.isArray(s))do{s=o[r],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[r],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{s=o[r],void 0!==s&&(t.push(o.time),n.push(s)),o=e[i++]}while(void 0!==o)},subclip:function(e,t,n,r,i=30){const o=e.clone();o.name=t;const s=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*i;if(!(o<n||o>=r)){l.push(t.times[e]);for(let n=0;n<a;++n)c.push(t.values[e*a+n])}}0!==l.length&&(t.times=_u.convertArray(l,t.times.constructor),t.values=_u.convertArray(c,t.values.constructor),s.push(t))}o.tracks=s;let a=1/0;for(let e=0;e<o.tracks.length;++e)a>o.tracks[e].times[0]&&(a=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,o=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if(\"bool\"===i||\"string\"===i)continue;const s=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===s)continue;let a=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let d;if(o<=r.times[0]){const e=a,t=l-a;d=_u.arraySlice(r.values,e,t)}else if(o>=r.times[h]){const e=h*l+a,t=e+l-a;d=_u.arraySlice(r.values,e,t)}else{const e=r.createInterpolant(),t=a,n=l-a;e.evaluate(o),d=_u.arraySlice(e.resultBuffer,t,n)}if(\"quaternion\"===i){(new sr).fromArray(d).normalize().conjugate().toArray(d)}const p=s.times.length;for(let e=0;e<p;++e){const t=e*u+c;if(\"quaternion\"===i)sr.multiplyQuaternionsFlat(s.values,t,d,0,s.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)s.values[t+n]-=d[n]}}}return e.blendMode=qt,e}};class bu{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(e>=i)break e;{const s=t[1];e<s&&(n=2,i=s);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===o)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0}}for(;n<o;){const r=n+o>>>1;e<t[r]?o=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error(\"call to abstract method\")}intervalChanged_(){}}bu.prototype.beforeStart_=bu.prototype.copySampleValue_,bu.prototype.afterEnd_=bu.prototype.copySampleValue_;class wu extends bu{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Vt,endingEnd:Vt}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,o=e+1,s=r[i],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case Ht:i=e,s=2*t-n;break;case jt:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Ht:o=e,a=2*n-t;break;case jt:o=1,a=n+r[1]-r[0];break;default:o=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=o*c}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let e=0;e!==s;++e)i[e]=g*o[c+e]+v*o[l+e]+y*o[a+e]+x*o[u+e];return i}}class Mu extends bu{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==s;++e)i[e]=o[l+e]*u+o[a+e]*c;return i}}class Su extends bu{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Tu{constructor(e,t,n,r){if(void 0===e)throw new Error(\"THREE.KeyframeTrack: track name is undefined\");if(void 0===t||0===t.length)throw new Error(\"THREE.KeyframeTrack: no keyframes in track named \"+e);this.name=e,this.times=_u.convertArray(t,this.TimeBufferType),this.values=_u.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:_u.convertArray(e.times,Array),values:_u.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Su(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Mu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new wu(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Gt:t=this.InterpolantFactoryMethodDiscrete;break;case Ut:t=this.InterpolantFactoryMethodLinear;break;case kt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t=\"unsupported interpolation for \"+this.ValueTypeName+\" keyframe track named \"+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn(\"THREE.KeyframeTrack:\",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Gt;case this.InterpolantFactoryMethodLinear:return Ut;case this.InterpolantFactoryMethodSmooth:return kt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const e=this.getValueSize();this.times=_u.arraySlice(n,i,o),this.values=_u.arraySlice(this.values,i*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error(\"THREE.KeyframeTrack: Invalid value size in track.\",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error(\"THREE.KeyframeTrack: Track is empty.\",this),e=!1);let o=null;for(let t=0;t!==i;t++){const r=n[t];if(\"number\"==typeof r&&isNaN(r)){console.error(\"THREE.KeyframeTrack: Time is not a valid number.\",this,t,r),e=!1;break}if(null!==o&&o>r){console.error(\"THREE.KeyframeTrack: Out of order keys.\",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&_u.isTypedArray(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error(\"THREE.KeyframeTrack: Value is not a valid number.\",this,t,n),e=!1;break}}return e}optimize(){const e=_u.arraySlice(this.times),t=_u.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===kt,i=e.length-1;let o=1;for(let s=1;s<i;++s){let i=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(r)i=!0;else{const e=s*n,r=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[r+s]||n!==t[o+s]){i=!0;break}}}if(i){if(s!==o){e[o]=e[s];const r=s*n,i=o*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++o}}if(i>0){e[o]=e[i];for(let e=i*n,r=o*n,s=0;s!==n;++s)t[r+s]=t[e+s];++o}return o!==e.length?(this.times=_u.arraySlice(e,0,o),this.values=_u.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=_u.arraySlice(this.times,0),t=_u.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Tu.prototype.TimeBufferType=Float32Array,Tu.prototype.ValueBufferType=Float32Array,Tu.prototype.DefaultInterpolation=Ut;class Eu extends Tu{}Eu.prototype.ValueTypeName=\"bool\",Eu.prototype.ValueBufferType=Array,Eu.prototype.DefaultInterpolation=Gt,Eu.prototype.InterpolantFactoryMethodLinear=void 0,Eu.prototype.InterpolantFactoryMethodSmooth=void 0;class Lu extends Tu{}Lu.prototype.ValueTypeName=\"color\";class Au extends Tu{}Au.prototype.ValueTypeName=\"number\";class Pu extends bu{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(r-t);let l=e*s;for(let e=l+s;l!==e;l+=4)sr.slerpFlat(i,0,o,l-s,o,l,a);return i}}class Cu extends Tu{InterpolantFactoryMethodLinear(e){return new Pu(this.times,this.values,this.getValueSize(),e)}}Cu.prototype.ValueTypeName=\"quaternion\",Cu.prototype.DefaultInterpolation=Ut,Cu.prototype.InterpolantFactoryMethodSmooth=void 0;class Ru extends Tu{}Ru.prototype.ValueTypeName=\"string\",Ru.prototype.ValueBufferType=Array,Ru.prototype.DefaultInterpolation=Gt,Ru.prototype.InterpolantFactoryMethodLinear=void 0,Ru.prototype.InterpolantFactoryMethodSmooth=void 0;class Iu extends Tu{}Iu.prototype.ValueTypeName=\"vector\";class Ou{constructor(e,t=-1,n,r=Wt){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=kn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(Du(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(Tu.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,o=[];for(let e=0;e<i;e++){let s=[],a=[];s.push((e+i-1)%i,e,(e+1)%i),a.push(0,1,0);const l=_u.getKeyframeOrder(s);s=_u.sortedArray(s,1,l),a=_u.sortedArray(a,1,l),r||0!==s[0]||(s.push(i),a.push(a[0])),o.push(new Au(\".morphTargetInfluences[\"+t[e].name+\"]\",s,a).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\\w-]*?)([\\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(i);if(o&&o.length>1){const e=o[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const o=[];for(const e in r)o.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return o}static parseAnimation(e,t){if(!e)return console.error(\"THREE.AnimationClip: No animation in JSONLoader data.\"),null;const n=function(e,t,n,r,i){if(0!==n.length){const o=[],s=[];_u.flattenJSON(n,o,s,r),0!==o.length&&i.push(new e(t,o,s))}},r=[],i=e.name||\"default\",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new Au(\".morphTargetInfluence[\"+n+\"]\",e,o))}a=e.length*(o||1)}else{const o=\".bones[\"+t[e].name+\"]\";n(Iu,o+\".position\",i,\"pos\",r),n(Cu,o+\".quaternion\",i,\"rot\",r),n(Iu,o+\".scale\",i,\"scl\",r)}}if(0===r.length)return null;return new this(i,a,r,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Du(e){if(void 0===e.type)throw new Error(\"THREE.KeyframeTrack: track type undefined, can not parse\");const t=function(e){switch(e.toLowerCase()){case\"scalar\":case\"double\":case\"float\":case\"number\":case\"integer\":return Au;case\"vector\":case\"vector2\":case\"vector3\":case\"vector4\":return Iu;case\"color\":return Lu;case\"quaternion\":return Cu;case\"bool\":case\"boolean\":return Eu;case\"string\":return Ru}throw new Error(\"THREE.KeyframeTrack: Unsupported typeName: \"+e)}(e.type);if(void 0===e.times){const t=[],n=[];_u.flattenJSON(e.keys,t,n,\"value\"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Nu={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class zu{constructor(e,t,n){const r=this;let i=!1,o=0,s=0,a=void 0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===i&&void 0!==r.onStart&&r.onStart(e,o,s),i=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const Bu=new zu;class Fu{constructor(e){this.manager=void 0!==e?e:Bu,this.crossOrigin=\"anonymous\",this.withCredentials=!1,this.path=\"\",this.resourcePath=\"\",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Gu={};class Uu extends Fu{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=\"\"),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Nu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;if(void 0!==Gu[e])return void Gu[e].push({onLoad:t,onProgress:n,onError:r});const s=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(s){const n=s[1],o=!!s[2];let a=s[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let r;const o=(this.responseType||\"\").toLowerCase();switch(o){case\"arraybuffer\":case\"blob\":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);r=\"blob\"===o?new Blob([e.buffer],{type:n}):e.buffer;break;case\"document\":const t=new DOMParser;r=t.parseFromString(a,n);break;case\"json\":r=JSON.parse(a);break;default:r=a}setTimeout((function(){t&&t(r),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{Gu[e]=[],Gu[e].push({onLoad:t,onProgress:n,onError:r}),a=new XMLHttpRequest,a.open(\"GET\",e,!0),a.addEventListener(\"load\",(function(t){const n=this.response,r=Gu[e];if(delete Gu[e],200===this.status||0===this.status){0===this.status&&console.warn(\"THREE.FileLoader: HTTP Status 0 received.\"),Nu.add(e,n);for(let e=0,t=r.length;e<t;e++){const t=r[e];t.onLoad&&t.onLoad(n)}i.manager.itemEnd(e)}else{for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onError&&n.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),a.addEventListener(\"progress\",(function(t){const n=Gu[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onProgress&&r.onProgress(t)}}),!1),a.addEventListener(\"error\",(function(t){const n=Gu[e];delete Gu[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),a.addEventListener(\"abort\",(function(t){const n=Gu[e];delete Gu[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:\"text/plain\");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return i.manager.itemStart(e),a}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ku extends Fu{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Uu(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=Ou.parse(e[n]);t.push(r)}return t}}class Vu extends Fu{constructor(e){super(e)}load(e,t,n,r){const i=this,o=[],s=new sc,a=new Uu(this.manager);a.setPath(this.path),a.setResponseType(\"arraybuffer\"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const n=i.parse(e,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=xe),s.image=o,s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else a.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=xe),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,r);return s}}class Hu extends Fu{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Nu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"img\");function a(){s.removeEventListener(\"load\",a,!1),s.removeEventListener(\"error\",l,!1),Nu.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){s.removeEventListener(\"load\",a,!1),s.removeEventListener(\"error\",l,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return s.addEventListener(\"load\",a,!1),s.addEventListener(\"error\",l,!1),\"data:\"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s}}class ju extends Fu{constructor(e){super(e)}load(e,t,n,r){const i=new Oo,o=new Hu(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(e[n],(function(e){i.images[n]=e,s++,6===s&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)a(t);return i}}class Wu extends Fu{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Il,s=new Uu(this.manager);return s.setResponseType(\"arraybuffer\"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(e,(function(e){const n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:de,o.wrapT=void 0!==n.wrapT?n.wrapT:de,o.magFilter=void 0!==n.magFilter?n.magFilter:xe,o.minFilter=void 0!==n.minFilter?n.minFilter:xe,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=we),1===n.mipmapCount&&(o.minFilter=xe),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}class qu extends Fu{constructor(e){super(e)}load(e,t,n,r){const i=new er,o=new Hu(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){i.image=n;const r=e.search(/\\.jpe?g($|\\?)/i)>0||0===e.search(/^data\\:image\\/jpeg/);i.format=r?Be:Fe,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}class Xu{constructor(){this.type=\"Curve\",this.arcLengthDivisions=200}getPoint(){return console.warn(\"THREE.Curve: .getPoint() not implemented.\"),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let o;o=t||e*n[i-1];let s,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),s=n[r]-o,s<0)a=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,n[r]===o)return r/(i-1);const c=n[r];return(r+(o-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);const i=this.getPoint(n),o=this.getPoint(r),s=t||(i.isVector2?new Zn:new ar);return s.copy(o).sub(i).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new ar,r=[],i=[],o=[],s=new ar,a=new Fr;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new ar),r[t].normalize()}i[0]=new ar,o[0]=new ar;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),o[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),o[t]=o[t-1].clone(),s.crossVectors(r[t-1],r[t]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(Vn(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(a.makeRotationAxis(s,e))}o[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(Vn(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(s.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],t*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:\"Curve\",generator:\"Curve.toJSON\"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Yu extends Xu{constructor(e=0,t=0,n=1,r=1,i=0,o=2*Math.PI,s=!1,a=0){super(),this.type=\"EllipseCurve\",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e,t){const n=t||new Zn,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const s=this.aStartAngle+e*i;let a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Yu.prototype.isEllipseCurve=!0;class Zu extends Yu{constructor(e,t,n,r,i,o){super(e,t,n,n,r,i,o),this.type=\"ArcCurve\"}}function Ju(){let e=0,t=0,n=0,r=0;function i(i,o,s,a){e=i,t=s,n=-3*i+3*o-2*s-a,r=2*i-2*o+s+a}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,s,a){let l=(t-e)/o-(n-e)/(o+s)+(n-t)/s,c=(n-t)/s-(r-t)/(s+a)+(r-n)/a;l*=s,c*=s,i(t,n,l,c)},calc:function(i){const o=i*i;return e+t*i+n*o+r*(o*i)}}}Zu.prototype.isArcCurve=!0;const Ku=new ar,$u=new Ju,Qu=new Ju,eh=new Ju;class th extends Xu{constructor(e=[],t=!1,n=\"centripetal\",r=.5){super(),this.type=\"CatmullRomCurve3\",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new ar){const n=t,r=this.points,i=r.length,o=(i-(this.closed?0:1))*e;let s,a,l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?s=r[(l-1)%i]:(Ku.subVectors(r[0],r[1]).add(r[0]),s=Ku);const u=r[l%i],h=r[(l+1)%i];if(this.closed||l+2<i?a=r[(l+2)%i]:(Ku.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=Ku),\"centripetal\"===this.curveType||\"chordal\"===this.curveType){const e=\"chordal\"===this.curveType?.5:.25;let t=Math.pow(s.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),r=Math.pow(h.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),$u.initNonuniformCatmullRom(s.x,u.x,h.x,a.x,t,n,r),Qu.initNonuniformCatmullRom(s.y,u.y,h.y,a.y,t,n,r),eh.initNonuniformCatmullRom(s.z,u.z,h.z,a.z,t,n,r)}else\"catmullrom\"===this.curveType&&($u.initCatmullRom(s.x,u.x,h.x,a.x,this.tension),Qu.initCatmullRom(s.y,u.y,h.y,a.y,this.tension),eh.initCatmullRom(s.z,u.z,h.z,a.z,this.tension));return n.set($u.calc(c),Qu.calc(c),eh.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new ar).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function nh(e,t,n,r,i){const o=.5*(r-t),s=.5*(i-n),a=e*e;return(2*n-2*r+o+s)*(e*a)+(-3*n+3*r-2*o-s)*a+o*e+n}function rh(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function ih(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}th.prototype.isCatmullRomCurve3=!0;class oh extends Xu{constructor(e=new Zn,t=new Zn,n=new Zn,r=new Zn){super(),this.type=\"CubicBezierCurve\",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Zn){const n=t,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(ih(e,r.x,i.x,o.x,s.x),ih(e,r.y,i.y,o.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}oh.prototype.isCubicBezierCurve=!0;class sh extends Xu{constructor(e=new ar,t=new ar,n=new ar,r=new ar){super(),this.type=\"CubicBezierCurve3\",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new ar){const n=t,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(ih(e,r.x,i.x,o.x,s.x),ih(e,r.y,i.y,o.y,s.y),ih(e,r.z,i.z,o.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}sh.prototype.isCubicBezierCurve3=!0;class ah extends Xu{constructor(e=new Zn,t=new Zn){super(),this.type=\"LineCurve\",this.v1=e,this.v2=t}getPoint(e,t=new Zn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Zn;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}ah.prototype.isLineCurve=!0;class lh extends Xu{constructor(e=new ar,t=new ar){super(),this.type=\"LineCurve3\",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new ar){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ch extends Xu{constructor(e=new Zn,t=new Zn,n=new Zn){super(),this.type=\"QuadraticBezierCurve\",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Zn){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(rh(e,r.x,i.x,o.x),rh(e,r.y,i.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}ch.prototype.isQuadraticBezierCurve=!0;class uh extends Xu{constructor(e=new ar,t=new ar,n=new ar){super(),this.type=\"QuadraticBezierCurve3\",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ar){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(rh(e,r.x,i.x,o.x),rh(e,r.y,i.y,o.y),rh(e,r.z,i.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}uh.prototype.isQuadraticBezierCurve3=!0;class hh extends Xu{constructor(e=[]){super(),this.type=\"SplineCurve\",this.points=e}getPoint(e,t=new Zn){const n=t,r=this.points,i=(r.length-1)*e,o=Math.floor(i),s=i-o,a=r[0===o?o:o-1],l=r[o],c=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return n.set(nh(s,a.x,l.x,c.x,u.x),nh(s,a.y,l.y,c.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Zn).fromArray(n))}return this}}hh.prototype.isSplineCurve=!0;var dh=Object.freeze({__proto__:null,ArcCurve:Zu,CatmullRomCurve3:th,CubicBezierCurve:oh,CubicBezierCurve3:sh,EllipseCurve:Yu,LineCurve:ah,LineCurve3:lh,QuadraticBezierCurve:ch,QuadraticBezierCurve3:uh,SplineCurve:hh});class ph extends Xu{constructor(){super(),this.type=\"CurvePath\",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new ah(t,e))}getPoint(e){const t=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=t){const e=n[r]-t,i=this.curves[r],o=i.getLength(),s=0===o?0:1-e/o;return i.getPointAt(s)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],s=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const r=a[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new dh[n.type]).fromJSON(n))}return this}}class fh extends ph{constructor(e){super(),this.type=\"Path\",this.currentPoint=new Zn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new ah(this.currentPoint.clone(),new Zn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new ch(this.currentPoint.clone(),new Zn(e,t),new Zn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,o){const s=new oh(this.currentPoint.clone(),new Zn(e,t),new Zn(n,r),new Zn(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new hh(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,r,i,o),this}absarc(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this}ellipse(e,t,n,r,i,o,s,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,o,s,a),this}absellipse(e,t,n,r,i,o,s,a){const l=new Yu(e,t,n,r,i,o,s,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class mh extends fh{constructor(e){super(e),this.uuid=kn(),this.type=\"Shape\",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new fh).fromJSON(n))}return this}}class gh extends ci{constructor(e,t=1){super(),this.type=\"Light\",this.color=new Oi(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}gh.prototype.isLight=!0;class vh extends gh{constructor(e,t,n){super(e,n),this.type=\"HemisphereLight\",this.position.copy(ci.DefaultUp),this.updateMatrix(),this.groundColor=new Oi(t)}copy(e){return gh.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}vh.prototype.isHemisphereLight=!0;const yh=new Fr,xh=new ar,_h=new ar;class bh{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Zn(512,512),this.map=null,this.mapPass=null,this.matrix=new Fr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Bo,this._frameExtents=new Zn(1,1),this._viewportCount=1,this._viewports=[new nr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;xh.setFromMatrixPosition(e.matrixWorld),t.position.copy(xh),_h.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(_h),t.updateMatrixWorld(),yh.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yh),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class wh extends bh{constructor(){super(new Ro(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*Un*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}wh.prototype.isSpotLightShadow=!0;class Mh extends gh{constructor(e,t,n=0,r=Math.PI/3,i=0,o=1){super(e,t),this.type=\"SpotLight\",this.position.copy(ci.DefaultUp),this.updateMatrix(),this.target=new ci,this.distance=n,this.angle=r,this.penumbra=i,this.decay=o,this.shadow=new wh}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Mh.prototype.isSpotLight=!0;const Sh=new Fr,Th=new ar,Eh=new ar;class Lh extends bh{constructor(){super(new Ro(90,1,.5,500)),this._frameExtents=new Zn(4,2),this._viewportCount=6,this._viewports=[new nr(2,1,1,1),new nr(0,1,1,1),new nr(3,1,1,1),new nr(1,1,1,1),new nr(3,0,1,1),new nr(1,0,1,1)],this._cubeDirections=[new ar(1,0,0),new ar(-1,0,0),new ar(0,0,1),new ar(0,0,-1),new ar(0,1,0),new ar(0,-1,0)],this._cubeUps=[new ar(0,1,0),new ar(0,1,0),new ar(0,1,0),new ar(0,1,0),new ar(0,0,1),new ar(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Th.setFromMatrixPosition(e.matrixWorld),n.position.copy(Th),Eh.copy(n.position),Eh.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Eh),n.updateMatrixWorld(),r.makeTranslation(-Th.x,-Th.y,-Th.z),Sh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sh)}}Lh.prototype.isPointLightShadow=!0;class Ah extends gh{constructor(e,t,n=0,r=1){super(e,t),this.type=\"PointLight\",this.distance=n,this.decay=r,this.shadow=new Lh}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Ah.prototype.isPointLight=!0;class Ph extends Co{constructor(e=-1,t=1,n=1,r=-1,i=.1,o=2e3){super(),this.type=\"OrthographicCamera\",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,o=n+e,s=r+t,a=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,o=i+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Ph.prototype.isOrthographicCamera=!0;class Ch extends bh{constructor(){super(new Ph(-5,5,5,-5,.5,500))}}Ch.prototype.isDirectionalLightShadow=!0;class Rh extends gh{constructor(e,t){super(e,t),this.type=\"DirectionalLight\",this.position.copy(ci.DefaultUp),this.updateMatrix(),this.target=new ci,this.shadow=new Ch}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Rh.prototype.isDirectionalLight=!0;class Ih extends gh{constructor(e,t){super(e,t),this.type=\"AmbientLight\"}}Ih.prototype.isAmbientLight=!0;class Oh extends gh{constructor(e,t,n=10,r=10){super(e,t),this.type=\"RectAreaLight\",this.width=n,this.height=r}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}Oh.prototype.isRectAreaLight=!0;class Dh{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ar)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*r*1.092548),t.addScaledVector(o[5],r*i*1.092548),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],n*i*1.092548),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*i),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*r),t.addScaledVector(o[5],.858086*r*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],.858086*n*i),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}Dh.prototype.isSphericalHarmonics3=!0;class Nh extends gh{constructor(e=new Dh,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Nh.prototype.isLightProbe=!0;class zh extends Fu{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,o=new Uu(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn(\"THREE.MaterialLoader: Undefined texture\",e),t[e]}const r=new xu[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new Oi).setHex(e.sheen)),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.vertexTangents&&(r.vertexTangents=e.vertexTangents),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&(\"number\"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case\"t\":r.uniforms[t].value=n(i.value);break;case\"c\":r.uniforms[t].value=(new Oi).setHex(i.value);break;case\"v2\":r.uniforms[t].value=(new Zn).fromArray(i.value);break;case\"v3\":r.uniforms[t].value=(new ar).fromArray(i.value);break;case\"v4\":r.uniforms[t].value=(new nr).fromArray(i.value);break;case\"m3\":r.uniforms[t].value=(new Jn).fromArray(i.value);break;case\"m4\":r.uniforms[t].value=(new Fr).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new Zn).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Zn).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),r}setTextures(e){return this.textures=e,this}}class Bh{static decodeText(e){if(\"undefined\"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t=\"\";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf(\"/\");return-1===t?\"./\":e.substr(0,t+1)}}class Fh extends io{constructor(){super(),this.type=\"InstancedBufferGeometry\",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Fh.prototype.isInstancedBufferGeometry=!0;class Gh extends Bi{constructor(e,t,n,r){\"number\"==typeof n&&(r=n,n=!1,console.error(\"THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.\")),super(e,t,n),this.meshPerAttribute=r||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Gh.prototype.isInstancedBufferAttribute=!0;class Uh extends Fu{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Uu(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],o=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),s=Ji(i.type,o),a=new rl(s,i.stride);return a.uuid=i.uuid,t[r]=a,a}const i=e.isInstancedBufferGeometry?new Fh:new io,o=e.data.index;if(void 0!==o){const e=Ji(o.type,o.array);i.setIndex(new Bi(e,1))}const s=e.data.attributes;for(const t in s){const n=s[t];let o;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);o=new ol(t,n.itemSize,n.offset,n.normalized)}else{const e=Ji(n.type,n.array);o=new(n.isInstancedBufferAttribute?Gh:Bi)(e,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),void 0!==n.usage&&o.setUsage(n.usage),void 0!==n.updateRange&&(o.updateRange.offset=n.updateRange.offset,o.updateRange.count=n.updateRange.count),i.setAttribute(t,o)}const a=e.data.morphAttributes;if(a)for(const t in a){const n=a[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let s;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data);s=new ol(t,i.itemSize,i.offset,i.normalized)}else{const e=Ji(i.type,i.array);s=new Bi(e,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),o.push(s)}i.morphAttributes[t]=o}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];i.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new ar;void 0!==c.center&&e.fromArray(c.center),i.boundingSphere=new Pr(e,c.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}class kh extends Fu{constructor(e){super(e)}load(e,t,n,r){const i=this,o=\"\"===this.path?Bh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new Uu(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){let o=null;try{o=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error(\"THREE:ObjectLoader: Can't parse \"+e+\".\",t.message)}const s=o.metadata;void 0!==s&&void 0!==s.type&&\"geometry\"!==s.type.toLowerCase()?i.parse(o,t):console.error(\"THREE.ObjectLoader: Can't load \"+e)}),n,r)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,i,a,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in o)if(o[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new mh).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new Nl).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){const n={};let r;if(void 0!==e){const i=new Uh;for(let o=0,s=e.length;o<s;o++){let s;const a=e[o];switch(a.type){case\"PlaneGeometry\":case\"PlaneBufferGeometry\":s=new lu[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case\"BoxGeometry\":case\"BoxBufferGeometry\":s=new lu[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case\"CircleGeometry\":case\"CircleBufferGeometry\":s=new lu[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case\"CylinderGeometry\":case\"CylinderBufferGeometry\":s=new lu[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case\"ConeGeometry\":case\"ConeBufferGeometry\":s=new lu[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case\"SphereGeometry\":case\"SphereBufferGeometry\":s=new lu[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case\"DodecahedronGeometry\":case\"DodecahedronBufferGeometry\":case\"IcosahedronGeometry\":case\"IcosahedronBufferGeometry\":case\"OctahedronGeometry\":case\"OctahedronBufferGeometry\":case\"TetrahedronGeometry\":case\"TetrahedronBufferGeometry\":s=new lu[a.type](a.radius,a.detail);break;case\"RingGeometry\":case\"RingBufferGeometry\":s=new lu[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case\"TorusGeometry\":case\"TorusBufferGeometry\":s=new lu[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case\"TorusKnotGeometry\":case\"TorusKnotBufferGeometry\":s=new lu[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case\"TubeGeometry\":case\"TubeBufferGeometry\":s=new lu[a.type]((new dh[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case\"LatheGeometry\":case\"LatheBufferGeometry\":s=new lu[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case\"PolyhedronGeometry\":case\"PolyhedronBufferGeometry\":s=new lu[a.type](a.vertices,a.indices,a.radius,a.details);break;case\"ShapeGeometry\":case\"ShapeBufferGeometry\":r=[];for(let e=0,n=a.shapes.length;e<n;e++){const n=t[a.shapes[e]];r.push(n)}s=new lu[a.type](r,a.curveSegments);break;case\"ExtrudeGeometry\":case\"ExtrudeBufferGeometry\":r=[];for(let e=0,n=a.shapes.length;e<n;e++){const n=t[a.shapes[e]];r.push(n)}const e=a.options.extrudePath;void 0!==e&&(a.options.extrudePath=(new dh[e.type]).fromJSON(e)),s=new lu[a.type](r,a.options);break;case\"BufferGeometry\":case\"InstancedBufferGeometry\":s=i.parse(a);break;case\"Geometry\":console.error('THREE.ObjectLoader: Loading \"Geometry\" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type \"'+a.type+'\"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new zh;i.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];if(\"MultiMaterial\"===o.type){const e=[];for(let t=0;t<o.materials.length;t++){const r=o.materials[t];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),e.push(n[r.uuid])}r[o.uuid]=e}else void 0===n[o.uuid]&&(n[o.uuid]=i.parse(o)),r[o.uuid]=n[o.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=Ou.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function o(e){if(\"string\"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Ji(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new zu(t);i=new Hu(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){r[n.uuid]=[];for(let e=0,t=i.length;e<t;e++){const t=o(i[e]);null!==t&&(t instanceof HTMLImageElement?r[n.uuid].push(t):r[n.uuid].push(new Il(t.data,t.width,t.height)))}}else{const e=o(n.url);null!==e&&(r[n.uuid]=e)}}}return r}parseTextures(e,t){function n(e,t){return\"number\"==typeof e?e:(console.warn(\"THREE.ObjectLoader.parseTexture: Constant should be in numeric form.\",e),t[e])}const r={};if(void 0!==e)for(let i=0,o=e.length;i<o;i++){const o=e[i];let s;void 0===o.image&&console.warn('THREE.ObjectLoader: No \"image\" specified for',o.uuid),void 0===t[o.image]&&console.warn(\"THREE.ObjectLoader: Undefined image\",o.image);const a=t[o.image];Array.isArray(a)?(s=new Oo(a),6===a.length&&(s.needsUpdate=!0)):(s=a&&a.data?new Il(a.data,a.width,a.height):new er(a),a&&(s.needsUpdate=!0)),s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,Vh)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=n(o.wrap[0],Hh),s.wrapT=n(o.wrap[1],Hh)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=n(o.minFilter,jh)),void 0!==o.magFilter&&(s.magFilter=n(o.magFilter,jh)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),r[o.uuid]=s}return r}parseObject(e,t,n,r){let i,o,s;function a(e){return void 0===t[e]&&console.warn(\"THREE.ObjectLoader: Undefined geometry\",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];void 0===n[i]&&console.warn(\"THREE.ObjectLoader: Undefined material\",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn(\"THREE.ObjectLoader: Undefined material\",e),n[e]}}switch(e.type){case\"Scene\":i=new nl,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new Oi(e.background)),void 0!==e.fog&&(\"Fog\"===e.fog.type?i.fog=new tl(e.fog.color,e.fog.near,e.fog.far):\"FogExp2\"===e.fog.type&&(i.fog=new el(e.fog.color,e.fog.density)));break;case\"PerspectiveCamera\":i=new Ro(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case\"OrthographicCamera\":i=new Ph(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case\"AmbientLight\":i=new Ih(e.color,e.intensity);break;case\"DirectionalLight\":i=new Rh(e.color,e.intensity);break;case\"PointLight\":i=new Ah(e.color,e.intensity,e.distance,e.decay);break;case\"RectAreaLight\":i=new Oh(e.color,e.intensity,e.width,e.height);break;case\"SpotLight\":i=new Mh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case\"HemisphereLight\":i=new vh(e.color,e.groundColor,e.intensity);break;case\"LightProbe\":i=(new Nh).fromJSON(e);break;case\"SkinnedMesh\":o=a(e.geometry),s=l(e.material),i=new Cl(o,s),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case\"Mesh\":o=a(e.geometry),s=l(e.material),i=new Mo(o,s);break;case\"InstancedMesh\":o=a(e.geometry),s=l(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;i=new Ul(o,s,t),i.instanceMatrix=new Bi(new Float32Array(n.array),16),void 0!==r&&(i.instanceColor=new Bi(new Float32Array(r.array),r.itemSize));break;case\"LOD\":i=new Sl;break;case\"Line\":i=new Xl(a(e.geometry),l(e.material));break;case\"LineLoop\":i=new Kl(a(e.geometry),l(e.material));break;case\"LineSegments\":i=new Jl(a(e.geometry),l(e.material));break;case\"PointCloud\":case\"Points\":i=new rc(a(e.geometry),l(e.material));break;case\"Sprite\":i=new _l(l(e.material));break;case\"Group\":i=new Xa;break;case\"Bone\":i=new Rl;break;default:i=new ci}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)i.add(this.parseObject(o[e],t,n,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];i.animations.push(r[n])}}if(\"LOD\"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=i.getObjectByProperty(\"uuid\",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn(\"THREE.ObjectLoader: No skeleton found with UUID:\",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn(\"THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath().\"),this.setResourcePath(e)}}const Vh={UVMapping:ie,CubeReflectionMapping:oe,CubeRefractionMapping:se,EquirectangularReflectionMapping:ae,EquirectangularRefractionMapping:le,CubeUVReflectionMapping:ce,CubeUVRefractionMapping:ue},Hh={RepeatWrapping:he,ClampToEdgeWrapping:de,MirroredRepeatWrapping:pe},jh={NearestFilter:fe,NearestMipmapNearestFilter:me,NearestMipmapLinearFilter:ve,LinearFilter:xe,LinearMipmapNearestFilter:_e,LinearMipmapLinearFilter:we};class Wh extends Fu{constructor(e){super(e),\"undefined\"==typeof createImageBitmap&&console.warn(\"THREE.ImageBitmapLoader: createImageBitmap() not supported.\"),\"undefined\"==typeof fetch&&console.warn(\"THREE.ImageBitmapLoader: fetch() not supported.\"),this.options={premultiplyAlpha:\"none\"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=\"\"),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Nu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s={};s.credentials=\"anonymous\"===this.crossOrigin?\"same-origin\":\"include\",s.headers=this.requestHeader,fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:\"none\"}))})).then((function(n){Nu.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}Wh.prototype.isImageBitmapLoader=!0;class qh{constructor(){this.type=\"ShapePath\",this.color=new Oi,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new fh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new mh;i.curves=r.curves,t.push(i)}return t}function r(e,t){const n=t.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=t[i],s=t[o],a=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[o],a=-a,s=t[i],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return r}const i=jc.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let s,a,l;const c=[];if(1===o.length)return a=o[0],l=new mh,l.curves=a.curves,c.push(l),c;let u=!i(o[0].getPoints());u=e?!u:u;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let t=0,n=o.length;t<n;t++)a=o[t],p=a.getPoints(),s=i(p),s=e?!s:s,s?(!u&&d[g]&&g++,d[g]={s:new mh,p:p},d[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return n(o);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)h[e]=[];for(let n=0,i=d.length;n<i;n++){const i=m[n];for(let o=0;o<i.length;o++){const s=i[o];let a=!0;for(let i=0;i<d.length;i++)r(s.p,d[i].p)&&(n!==i&&t.push({froms:n,tos:i,hole:o}),a?(a=!1,h[i].push(s)):e=!0);a&&h[n].push(s)}}t.length>0&&(e||(m=h))}for(let e=0,t=d.length;e<t;e++){l=d[e].s,c.push(l),f=m[e];for(let e=0,t=f.length;e<t;e++)l.holes.push(f[e].h)}return c}}class Xh{constructor(e){this.type=\"Font\",this.data=e}generateShapes(e,t=100){const n=[],r=function(e,t,n){const r=Array.from(e),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,s=[];let a=0,l=0;for(let e=0;e<r.length;e++){const t=r[e];if(\"\\n\"===t)a=0,l-=o;else{const e=Yh(t,i,a,l,n);a+=e.offsetX,s.push(e.path)}}return s}(e,t,this.data);for(let e=0,t=r.length;e<t;e++)Array.prototype.push.apply(n,r[e].toShapes());return n}}function Yh(e,t,n,r,i){const o=i.glyphs[e]||i.glyphs[\"?\"];if(!o)return void console.error('THREE.Font: character \"'+e+'\" does not exists in font family '+i.familyName+\".\");const s=new qh;let a,l,c,u,h,d,p,f;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(\" \"));for(let i=0,o=e.length;i<o;){switch(e[i++]){case\"m\":a=e[i++]*t+n,l=e[i++]*t+r,s.moveTo(a,l);break;case\"l\":a=e[i++]*t+n,l=e[i++]*t+r,s.lineTo(a,l);break;case\"q\":c=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,s.quadraticCurveTo(h,d,c,u);break;case\"b\":c=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,p=e[i++]*t+n,f=e[i++]*t+r,s.bezierCurveTo(h,d,p,f,c,u)}}}return{offsetX:o.ha*t,path:s}}Xh.prototype.isFont=!0;class Zh extends Fu{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Uu(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn(\"THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead.\"),n=JSON.parse(e.substring(65,e.length-2))}const r=i.parse(n);t&&t(r)}),n,r)}parse(e){return new Xh(e)}}let Jh;const Kh={getContext:function(){return void 0===Jh&&(Jh=new(window.AudioContext||window.webkitAudioContext)),Jh},setContext:function(e){Jh=e}};class $h extends Fu{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Uu(this.manager);o.setResponseType(\"arraybuffer\"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);Kh.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}}class Qh extends Nh{constructor(e,t,n=1){super(void 0,n);const r=(new Oi).set(e),i=(new Oi).set(t),o=new ar(r.r,r.g,r.b),s=new ar(i.r,i.g,i.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(l)}}Qh.prototype.isHemisphereLightProbe=!0;class ed extends Nh{constructor(e,t=1){super(void 0,t);const n=(new Oi).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}ed.prototype.isAmbientLightProbe=!0;const td=new Fr,nd=new Fr;class rd{constructor(){this.type=\"StereoCamera\",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ro,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ro,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),r=t.eyeSep/2,i=r*t.near/t.focus,o=t.near*Math.tan(Gn*t.fov*.5)/t.zoom;let s,a;nd.elements[12]=-r,td.elements[12]=r,s=-o*t.aspect+i,a=o*t.aspect+i,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*t.aspect-i,a=o*t.aspect-i,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(nd),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(td)}}class id{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=od(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=od();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function od(){return(\"undefined\"==typeof performance?Date:performance).now()}const sd=new ar,ad=new sr,ld=new ar,cd=new ar;class ud extends ci{constructor(){super(),this.type=\"AudioListener\",this.context=Kh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new id}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(sd,ad,ld),cd.set(0,0,-1).applyQuaternion(ad),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(sd.x,e),t.positionY.linearRampToValueAtTime(sd.y,e),t.positionZ.linearRampToValueAtTime(sd.z,e),t.forwardX.linearRampToValueAtTime(cd.x,e),t.forwardY.linearRampToValueAtTime(cd.y,e),t.forwardZ.linearRampToValueAtTime(cd.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(sd.x,sd.y,sd.z),t.setOrientation(cd.x,cd.y,cd.z,n.x,n.y,n.z)}}class hd extends ci{constructor(e){super(),this.type=\"Audio\",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType=\"empty\",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType=\"audioNode\",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType=\"mediaNode\",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType=\"mediaStreamNode\",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType=\"buffer\",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn(\"THREE.Audio: Audio is already playing.\");if(!1===this.hasPlaybackControl)return void console.warn(\"THREE.Audio: this Audio has no playback control.\");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn(\"THREE.Audio: this Audio has no playback control.\")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn(\"THREE.Audio: this Audio has no playback control.\")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn(\"THREE.Audio: this Audio has no playback control.\")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn(\"THREE.Audio: this Audio has no playback control.\"),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn(\"THREE.Audio: this Audio has no playback control.\")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const dd=new ar,pd=new sr,fd=new ar,md=new ar;class gd extends hd{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel=\"HRTF\",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(dd,pd,fd),md.set(0,0,1).applyQuaternion(pd);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(dd.x,e),t.positionY.linearRampToValueAtTime(dd.y,e),t.positionZ.linearRampToValueAtTime(dd.z,e),t.orientationX.linearRampToValueAtTime(md.x,e),t.orientationY.linearRampToValueAtTime(md.y,e),t.orientationZ.linearRampToValueAtTime(md.z,e)}else t.setPosition(dd.x,dd.y,dd.z),t.setOrientation(md.x,md.y,md.z)}}class vd{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class yd{constructor(e,t,n){let r,i,o;switch(this.binding=e,this.valueSize=n,t){case\"quaternion\":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case\"string\":case\"bool\":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==r;++e)n[i+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){s.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){sr.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const o=this._workIndex*i;sr.multiplyQuaternionsFlat(e,o,e,t,e,n),sr.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,i){const o=1-r;for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]*o+e[n+s]*r}}_lerpAdditive(e,t,n,r,i){for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]+e[n+o]*r}}}const xd=new RegExp(\"[\\\\[\\\\]\\\\.:\\\\/]\",\"g\"),_d=\"[^\"+\"\\\\[\\\\]\\\\.:\\\\/\".replace(\"\\\\.\",\"\")+\"]\",bd=/((?:WC+[\\/:])*)/.source.replace(\"WC\",\"[^\\\\[\\\\]\\\\.:\\\\/]\"),wd=/(WCOD+)?/.source.replace(\"WCOD\",_d),Md=/(?:\\.(WC+)(?:\\[(.+)\\])?)?/.source.replace(\"WC\",\"[^\\\\[\\\\]\\\\.:\\\\/]\"),Sd=/\\.(WC+)(?:\\[(.+)\\])?/.source.replace(\"WC\",\"[^\\\\[\\\\]\\\\.:\\\\/]\"),Td=new RegExp(\"^\"+bd+wd+Md+Sd+\"$\"),Ed=[\"material\",\"materials\",\"bones\"];class Ld{constructor(e,t,n){this.path=t,this.parsedPath=n||Ld.parseTrackName(t),this.node=Ld.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Ld.Composite(e,t,n):new Ld(e,t,n)}static sanitizeNodeName(e){return e.replace(/\\s/g,\"_\").replace(xd,\"\")}static parseTrackName(e){const t=Td.exec(e);if(!t)throw new Error(\"PropertyBinding: Cannot parse trackName: \"+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(\".\");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==Ed.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error(\"PropertyBinding: can not parse propertyName from trackName: \"+e);return n}static findNode(e,t){if(!t||\"\"===t||\".\"===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const o=n(i.children);if(o)return o}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=Ld.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error(\"THREE.PropertyBinding: Trying to update node for track: \"+this.path+\" but it wasn't found.\");if(n){let r=t.objectIndex;switch(n){case\"materials\":if(!e.material)return void console.error(\"THREE.PropertyBinding: Can not bind to material as node does not have a material.\",this);if(!e.material.materials)return void console.error(\"THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.\",this);e=e.material.materials;break;case\"bones\":if(!e.skeleton)return void console.error(\"THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.\",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;default:if(void 0===e[n])return void console.error(\"THREE.PropertyBinding: Can not bind to objectName of node undefined.\",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error(\"THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.\",this,e);e=e[r]}}const o=e[r];if(void 0===o){const n=t.nodeName;return void console.error(\"THREE.PropertyBinding: Trying to update property for track: \"+n+\".\"+r+\" but it wasn't found.\",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if(\"morphTargetInfluences\"===r){if(!e.geometry)return void console.error(\"THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.\",this);if(!e.geometry.isBufferGeometry)return void console.error(\"THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.\",this);if(!e.geometry.morphAttributes)return void console.error(\"THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.\",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ld.Composite=class{constructor(e,t,n){const r=n||Ld.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Ld.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ld.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ld.prototype.GetterByBindingType=[Ld.prototype._getValue_direct,Ld.prototype._getValue_array,Ld.prototype._getValue_arrayElement,Ld.prototype._getValue_toArray],Ld.prototype.SetterByBindingTypeAndVersioning=[[Ld.prototype._setValue_direct,Ld.prototype._setValue_direct_setNeedsUpdate,Ld.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ld.prototype._setValue_array,Ld.prototype._setValue_array_setNeedsUpdate,Ld.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ld.prototype._setValue_arrayElement,Ld.prototype._setValue_arrayElement_setNeedsUpdate,Ld.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ld.prototype._setValue_fromArray,Ld.prototype._setValue_fromArray_setNeedsUpdate,Ld.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ad{constructor(){this.uuid=kn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let s=void 0,a=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=a++,t[h]=d,e.push(u);for(let e=0,t=o;e!==t;++e)i[e].push(new Ld(u,n[e],r[e]))}else if(d<l){s=e[d];const a=--l,c=e[a];t[c.uuid]=d,e[d]=c,t[h]=a,e[a]=u;for(let e=0,t=o;e!==t;++e){const t=i[e],o=t[a];let s=t[d];t[d]=o,void 0===s&&(s=new Ld(u,n[e],r[e])),t[a]=s}}else e[d]!==s&&console.error(\"THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.\")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,l=t[a];if(void 0!==l&&l>=i){const o=i++,c=e[o];t[c.uuid]=l,e[l]=c,t[a]=o,e[o]=s;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[l];t[l]=r,t[o]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<i){const s=--i,a=e[s],c=--o,u=e[c];t[a.uuid]=l,e[l]=a,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],i=t[c];t[l]=r,t[s]=i,t.pop()}}else{const i=--o,s=e[i];i>0&&(t[s.uuid]=l),e[l]=s,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,o.push(e),s.push(t),i.push(u);for(let n=c,r=a.length;n!==r;++n){const r=a[n];u[n]=new Ld(r,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=n,o[n]=a,o.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}}Ad.prototype.isAnimationObjectGroup=!0;class Pd{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,o=i.length,s=new Array(o),a={endingStart:Vt,endingEnd:Vt};for(let e=0;e!==o;++e){const t=i[e].createInterpolant(null);s[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Bt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,o=n/r;e.warp(1,i,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,l=s.sampleValues;return a[0]=i,a[1]=i+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;if(r<0||0===n)return;this._startTime=null,t=n*r}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case qt:for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);break;case Wt:default:for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulate(r,s)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const o=n===Ft;if(0===e)return-1===i?r:o&&1==(1&i)?t-r:r;if(n===zt){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:\"finished\",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:\"finished\",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:\"loop\",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Ht,r.endingEnd=Ht):(r.endingStart=e?this.zeroSlopeAtStart?Ht:Vt:jt,r.endingEnd=t?this.zeroSlopeAtEnd?Ht:Vt:jt)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=t,s[1]=i+e,a[1]=n,this}}class Cd extends zn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==i;++e){const i=r[e],l=i.name;let u=c[l];if(void 0!==u)o[e]=u;else{if(u=o[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,l));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;u=new yd(Ld.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,l),o[e]=u}s[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null;delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[t];void 0===o&&(o={},r[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,s=o[r],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[i],0===Object.keys(s).length&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Mu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let o=\"string\"==typeof e?Ou.findByName(r,e):e;const s=null!==o?o.uuid:e,a=this._actionsByClip[s];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:Wt),void 0!==a){const e=a.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new Pd(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,s,i),c}existingAction(e,t){const n=t||this._root,r=n.uuid,i=\"string\"==typeof e?Ou.findByName(n,e):e,o=i?i.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let s=0;s!==n;++s){t[s]._update(r,e,i,o)}const s=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)s[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,o=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,t[i]=o,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}Cd.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Rd{constructor(e){\"string\"==typeof e&&(console.warn(\"THREE.Uniform: Type parameter is no longer needed.\"),e=arguments[1]),this.value=e}clone(){return new Rd(void 0===this.value.clone?this.value:this.value.clone())}}class Id extends rl{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}Id.prototype.isInstancedInterleavedBuffer=!0;class Od{constructor(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Od.prototype.isGLBufferAttribute=!0;class Dd{constructor(e,t,n=0,r=1/0){this.ray=new Br(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Zr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error(\"THREE.Raycaster: Unsupported camera type: \"+t.type)}intersectObject(e,t=!1,n=[]){return zd(e,this,n,t),n.sort(Nd),n}intersectObjects(e,t=!1,n=[]){for(let r=0,i=e.length;r<i;r++)zd(e[r],this,n,t);return n.sort(Nd),n}}function Nd(e,t){return e.distance-t.distance}function zd(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)zd(r[e],t,n,!0)}}class Bd{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Vn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Fd{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const Gd=new Zn;class Ud{constructor(e=new Zn(1/0,1/0),t=new Zn(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Gd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn(\"THREE.Box2: .getCenter() target is now required\"),e=new Zn),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn(\"THREE.Box2: .getSize() target is now required\"),e=new Zn),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn(\"THREE.Box2: .getParameter() target is now required\"),t=new Zn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn(\"THREE.Box2: .clampPoint() target is now required\"),t=new Zn),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Gd.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Ud.prototype.isBox2=!0;const kd=new ar,Vd=new ar;class Hd{constructor(e=new ar,t=new ar){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn(\"THREE.Line3: .getCenter() target is now required\"),e=new ar),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn(\"THREE.Line3: .delta() target is now required\"),e=new ar),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn(\"THREE.Line3: .at() target is now required\"),t=new ar),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){kd.subVectors(e,this.start),Vd.subVectors(this.end,this.start);const n=Vd.dot(Vd);let r=Vd.dot(kd)/n;return t&&(r=Vn(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn(\"THREE.Line3: .closestPointToPoint() target is now required\"),n=new ar),this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class jd extends ci{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}jd.prototype.isImmediateRenderObject=!0;const Wd=new ar;class qd extends ci{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new io,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,o=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}n.setAttribute(\"position\",new qi(r,3));const i=new kl({fog:!1,toneMapped:!1});this.cone=new Jl(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Wd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Wd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Xd=new ar,Yd=new Fr,Zd=new Fr;class Jd extends Jl{constructor(e){const t=function e(t){const n=[];t&&t.isBone&&n.push(t);for(let r=0;r<t.children.length;r++)n.push.apply(n,e(t.children[r]));return n}(e),n=new io,r=[],i=[],o=new Oi(0,0,1),s=new Oi(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}n.setAttribute(\"position\",new qi(r,3)),n.setAttribute(\"color\",new qi(i,3));super(n,new kl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type=\"SkeletonHelper\",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute(\"position\");Zd.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(Yd.multiplyMatrices(Zd,i.matrixWorld),Xd.setFromMatrixPosition(Yd),r.setXYZ(n,Xd.x,Xd.y,Xd.z),Yd.multiplyMatrices(Zd,i.parent.matrixWorld),Xd.setFromMatrixPosition(Yd),r.setXYZ(n+1,Xd.x,Xd.y,Xd.z),n+=2)}n.getAttribute(\"position\").needsUpdate=!0,super.updateMatrixWorld(e)}}class Kd extends Mo{constructor(e,t,n){super(new tu(t,4,2),new Di({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type=\"PointLightHelper\",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const $d=new ar,Qd=new Oi,ep=new Oi;class tp extends ci{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new Kc(t);r.rotateY(.5*Math.PI),this.material=new Di({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute(\"position\"),o=new Float32Array(3*i.count);r.setAttribute(\"color\",new Bi(o,3)),this.add(new Mo(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute(\"color\");Qd.copy(this.light.color),ep.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?Qd:ep;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt($d.setFromMatrixPosition(this.light.matrixWorld).negate())}}class np extends Jl{constructor(e=10,t=10,n=4473924,r=8947848){n=new Oi(n),r=new Oi(r);const i=t/2,o=e/t,s=e/2,a=[],l=[];for(let e=0,c=0,u=-s;e<=t;e++,u+=o){a.push(-s,0,u,s,0,u),a.push(u,0,-s,u,0,s);const t=e===i?n:r;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new io;c.setAttribute(\"position\",new qi(a,3)),c.setAttribute(\"color\",new qi(l,3));super(c,new kl({vertexColors:!0,toneMapped:!1})),this.type=\"GridHelper\"}}class rp extends Jl{constructor(e=10,t=16,n=8,r=64,i=4473924,o=8947848){i=new Oi(i),o=new Oi(o);const s=[],a=[];for(let n=0;n<=t;n++){const r=n/t*(2*Math.PI),l=Math.sin(r)*e,c=Math.cos(r)*e;s.push(0,0,0),s.push(l,0,c);const u=1&n?i:o;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let t=0;t<=n;t++){const l=1&t?i:o,c=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c;s.push(n,0,i),a.push(l.r,l.g,l.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c,s.push(n,0,i),a.push(l.r,l.g,l.b)}}const l=new io;l.setAttribute(\"position\",new qi(s,3)),l.setAttribute(\"color\",new qi(a,3));super(l,new kl({vertexColors:!0,toneMapped:!1})),this.type=\"PolarGridHelper\"}}const ip=new ar,op=new ar,sp=new ar;class ap extends ci{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let r=new io;r.setAttribute(\"position\",new qi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new kl({fog:!1,toneMapped:!1});this.lightPlane=new Xl(r,i),this.add(this.lightPlane),r=new io,r.setAttribute(\"position\",new qi([0,0,0,0,0,1],3)),this.targetLine=new Xl(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){ip.setFromMatrixPosition(this.light.matrixWorld),op.setFromMatrixPosition(this.light.target.matrixWorld),sp.subVectors(op,ip),this.lightPlane.lookAt(op),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(op),this.targetLine.scale.z=sp.length()}}const lp=new ar,cp=new Co;class up extends Jl{constructor(e){const t=new io,n=new kl({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],o={},s=new Oi(16755200),a=new Oi(16711680),l=new Oi(43775),c=new Oi(16777215),u=new Oi(3355443);function h(e,t,n){d(e,n),d(t,n)}function d(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}h(\"n1\",\"n2\",s),h(\"n2\",\"n4\",s),h(\"n4\",\"n3\",s),h(\"n3\",\"n1\",s),h(\"f1\",\"f2\",s),h(\"f2\",\"f4\",s),h(\"f4\",\"f3\",s),h(\"f3\",\"f1\",s),h(\"n1\",\"f1\",s),h(\"n2\",\"f2\",s),h(\"n3\",\"f3\",s),h(\"n4\",\"f4\",s),h(\"p\",\"n1\",a),h(\"p\",\"n2\",a),h(\"p\",\"n3\",a),h(\"p\",\"n4\",a),h(\"u1\",\"u2\",l),h(\"u2\",\"u3\",l),h(\"u3\",\"u1\",l),h(\"c\",\"t\",c),h(\"p\",\"c\",u),h(\"cn1\",\"cn2\",u),h(\"cn3\",\"cn4\",u),h(\"cf1\",\"cf2\",u),h(\"cf3\",\"cf4\",u),t.setAttribute(\"position\",new qi(r,3)),t.setAttribute(\"color\",new qi(i,3)),super(t,n),this.type=\"CameraHelper\",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap;cp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),hp(\"c\",t,e,cp,0,0,-1),hp(\"t\",t,e,cp,0,0,1),hp(\"n1\",t,e,cp,-1,-1,-1),hp(\"n2\",t,e,cp,1,-1,-1),hp(\"n3\",t,e,cp,-1,1,-1),hp(\"n4\",t,e,cp,1,1,-1),hp(\"f1\",t,e,cp,-1,-1,1),hp(\"f2\",t,e,cp,1,-1,1),hp(\"f3\",t,e,cp,-1,1,1),hp(\"f4\",t,e,cp,1,1,1),hp(\"u1\",t,e,cp,.7,1.1,-1),hp(\"u2\",t,e,cp,-.7,1.1,-1),hp(\"u3\",t,e,cp,0,2,-1),hp(\"cf1\",t,e,cp,-1,0,1),hp(\"cf2\",t,e,cp,1,0,1),hp(\"cf3\",t,e,cp,0,-1,1),hp(\"cf4\",t,e,cp,0,1,1),hp(\"cn1\",t,e,cp,-1,0,-1),hp(\"cn2\",t,e,cp,1,0,-1),hp(\"cn3\",t,e,cp,0,-1,-1),hp(\"cn4\",t,e,cp,0,1,-1),e.getAttribute(\"position\").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function hp(e,t,n,r,i,o,s){lp.set(i,o,s).unproject(r);const a=t[e];if(void 0!==a){const e=n.getAttribute(\"position\");for(let t=0,n=a.length;t<n;t++)e.setXYZ(a[t],lp.x,lp.y,lp.z)}}const dp=new ur;class pp extends Jl{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new io;i.setIndex(new Bi(n,1)),i.setAttribute(\"position\",new Bi(r,3)),super(i,new kl({color:t,toneMapped:!1})),this.object=e,this.type=\"BoxHelper\",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn(\"THREE.BoxHelper: .update() has no longer arguments.\"),void 0!==this.object&&dp.setFromObject(this.object),dp.isEmpty())return;const t=dp.min,n=dp.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Jl.prototype.copy.call(this,e),this.object=e.object,this}}class fp extends Jl{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new io;r.setIndex(new Bi(n,1)),r.setAttribute(\"position\",new qi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new kl({color:t,toneMapped:!1})),this.box=e,this.type=\"Box3Helper\",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class mp extends Xl{constructor(e,t=1,n=16776960){const r=n,i=new io;i.setAttribute(\"position\",new qi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new kl({color:r,toneMapped:!1})),this.type=\"PlaneHelper\",this.plane=e,this.size=t;const o=new io;o.setAttribute(\"position\",new qi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Mo(o,new Di({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?m:f,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const gp=new ar;let vp,yp;class xp extends ci{constructor(e=new ar(0,0,1),t=new ar(0,0,0),n=1,r=16776960,i=.2*n,o=.2*i){super(),this.type=\"ArrowHelper\",void 0===vp&&(vp=new io,vp.setAttribute(\"position\",new qi([0,0,0,0,1,0],3)),yp=new uc(0,.5,1,5,1),yp.translate(0,-.5,0)),this.position.copy(t),this.line=new Xl(vp,new kl({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mo(yp,new Di({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{gp.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(gp,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class _p extends Jl{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new io;n.setAttribute(\"position\",new qi(t,3)),n.setAttribute(\"color\",new qi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new kl({vertexColors:!0,toneMapped:!1})),this.type=\"AxesHelper\"}dispose(){this.geometry.dispose(),this.material.dispose()}}const bp=new Float32Array(1),wp=new Int32Array(bp.buffer);class Mp{static toHalfFloat(e){bp[0]=e;const t=wp[0];let n=t>>16&32768,r=t>>12&2047;const i=t>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&t,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}}const Sp=Math.pow(2,8),Tp=[.125,.215,.35,.446,.526,.582],Ep=5+Tp.length,Lp={[Jt]:0,[Kt]:1,[Qt]:2,[tn]:3,[nn]:4,[rn]:5,[$t]:6},Ap=new Di({side:m,depthWrite:!1,depthTest:!1}),Pp=new Mo(new To,Ap),Cp=new Ph,{_lodPlanes:Rp,_sizeLods:Ip,_sigmas:Op}=Vp(),Dp=new Oi;let Np=null;const zp=(1+Math.sqrt(5))/2,Bp=1/zp,Fp=[new ar(1,1,1),new ar(-1,1,1),new ar(1,1,-1),new ar(-1,1,-1),new ar(0,zp,Bp),new ar(0,zp,-Bp),new ar(Bp,0,zp),new ar(-Bp,0,zp),new ar(zp,Bp,0),new ar(-zp,Bp,0)];function Gp(e){const t=Math.max(e.r,e.g,e.b),n=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);e.multiplyScalar(Math.pow(2,-n));return(n+128)/255}class Up{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(e),n=new ar(0,1,0);return new uu({name:\"SphericalGaussianBlur\",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Lp[Jt]},outputEncoding:{value:Lp[Jt]}},vertexShader:Xp(),fragmentShader:`\\n\\n\\t\\t\\tprecision mediump float;\\n\\t\\t\\tprecision mediump int;\\n\\n\\t\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t\\tuniform sampler2D envMap;\\n\\t\\t\\tuniform int samples;\\n\\t\\t\\tuniform float weights[ n ];\\n\\t\\t\\tuniform bool latitudinal;\\n\\t\\t\\tuniform float dTheta;\\n\\t\\t\\tuniform float mipInt;\\n\\t\\t\\tuniform vec3 poleAxis;\\n\\n\\t\\t\\t${Yp()}\\n\\n\\t\\t\\t#define ENVMAP_TYPE_CUBE_UV\\n\\t\\t\\t#include <cube_uv_reflection_fragment>\\n\\n\\t\\t\\tvec3 getSample( float theta, vec3 axis ) {\\n\\n\\t\\t\\t\\tfloat cosTheta = cos( theta );\\n\\t\\t\\t\\t// Rodrigues' axis-angle rotation\\n\\t\\t\\t\\tvec3 sampleDirection = vOutputDirection * cosTheta\\n\\t\\t\\t\\t\\t+ cross( axis, vOutputDirection ) * sin( theta )\\n\\t\\t\\t\\t\\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\\n\\n\\t\\t\\t\\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\\n\\n\\t\\t\\t}\\n\\n\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\\n\\n\\t\\t\\t\\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\\n\\n\\t\\t\\t\\t\\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\\n\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\taxis = normalize( axis );\\n\\n\\t\\t\\t\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\t\\t\\t\\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\\n\\n\\t\\t\\t\\tfor ( int i = 1; i < n; i++ ) {\\n\\n\\t\\t\\t\\t\\tif ( i >= samples ) {\\n\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tfloat theta = dTheta * float( i );\\n\\t\\t\\t\\t\\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\\n\\t\\t\\t\\t\\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\\n\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tgl_FragColor = linearToOutputTexel( gl_FragColor );\\n\\n\\t\\t\\t}\\n\\t\\t`,blending:x,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){Np=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=qp(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Wp(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Rp.length;e++)Rp[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Np),e.scissorTest=!1,jp(e,0,0,e.width,e.height)}_fromTexture(e){Np=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:fe,minFilter:fe,generateMipmaps:!1,type:Se,format:ke,encoding:kp(e)?e.encoding:Qt,depthBuffer:!1},n=Hp(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Hp(t),n}_compileMaterial(e){const t=new Mo(Rp[0],e);this._renderer.compile(t,Cp)}_sceneToCubeUV(e,t,n,r){const i=new Ro(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,u=a.toneMapping;a.getClearColor(Dp),a.toneMapping=$,a.outputEncoding=Jt,a.autoClear=!1;let h=!1;const d=e.background;if(d){if(d.isColor){Ap.color.copy(d).convertSRGBToLinear(),e.background=null;const t=Gp(Ap.color);Ap.opacity=t,h=!0}}else{Ap.color.copy(Dp).convertSRGBToLinear();const e=Gp(Ap.color);Ap.opacity=e,h=!0}for(let t=0;t<6;t++){const n=t%3;0==n?(i.up.set(0,o[t],0),i.lookAt(s[t],0,0)):1==n?(i.up.set(0,0,o[t]),i.lookAt(0,s[t],0)):(i.up.set(0,o[t],0),i.lookAt(0,0,s[t])),jp(r,n*Sp,t>2?Sp:0,Sp,Sp),a.setRenderTarget(r),h&&a.render(Pp,i),a.render(e,i)}a.toneMapping=u,a.outputEncoding=c,a.autoClear=l}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=qp()):null==this._equirectShader&&(this._equirectShader=Wp());const r=e.isCubeTexture?this._cubemapShader:this._equirectShader,i=new Mo(Rp[0],r),o=r.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=Lp[e.encoding],o.outputEncoding.value=Lp[t.texture.encoding],jp(t,0,0,3*Sp,2*Sp),n.setRenderTarget(t),n.render(i,Cp)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<Ep;t++){const n=Math.sqrt(Op[t]*Op[t]-Op[t-1]*Op[t-1]),r=Fp[(t-1)%Fp.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,\"latitudinal\",i),this._halfBlur(o,e,n,n,r,\"longitudinal\",i)}_halfBlur(e,t,n,r,i,o,s){const a=this._renderer,l=this._blurMaterial;\"latitudinal\"!==o&&\"longitudinal\"!==o&&console.error(\"blur direction must be either latitudinal or longitudinal!\");const c=new Mo(Rp[r],l),u=l.uniforms,h=Ip[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0==e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value=\"latitudinal\"===o,s&&(u.poleAxis.value=s),u.dTheta.value=d,u.mipInt.value=8-n,u.inputEncoding.value=Lp[e.texture.encoding],u.outputEncoding.value=Lp[e.texture.encoding];const v=Ip[r];jp(t,3*Math.max(0,Sp-2*v),(0===r?0:2*Sp)+2*v*(r>4?r-8+4:0),3*v,2*v),a.setRenderTarget(t),a.render(c,Cp)}}function kp(e){return void 0!==e&&e.type===Se&&(e.encoding===Jt||e.encoding===Kt||e.encoding===$t)}function Vp(){const e=[],t=[],n=[];let r=8;for(let i=0;i<Ep;i++){const o=Math.pow(2,r);t.push(o);let s=1/o;i>4?s=Tp[i-8+4-1]:0==i&&(s=0),n.push(s);const a=1/(o-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),v=new Float32Array(f*d*h),y=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(r,p*d*e),v.set(u,f*d*e);const i=[e,e,e,e,e,e];y.set(i,m*d*e)}const x=new io;x.setAttribute(\"position\",new Bi(g,p)),x.setAttribute(\"uv\",new Bi(v,f)),x.setAttribute(\"faceIndex\",new Bi(y,m)),e.push(x),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function Hp(e){const t=new rr(3*Sp,3*Sp,e);return t.texture.mapping=ce,t.texture.name=\"PMREM.cubeUv\",t.scissorTest=!0,t}function jp(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Wp(){const e=new Zn(1,1);return new uu({name:\"EquirectangularToCubeUV\",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Lp[Jt]},outputEncoding:{value:Lp[Jt]}},vertexShader:Xp(),fragmentShader:`\\n\\n\\t\\t\\tprecision mediump float;\\n\\t\\t\\tprecision mediump int;\\n\\n\\t\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t\\tuniform sampler2D envMap;\\n\\t\\t\\tuniform vec2 texelSize;\\n\\n\\t\\t\\t${Yp()}\\n\\n\\t\\t\\t#include <common>\\n\\n\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\n\\t\\t\\t\\tvec3 outputDirection = normalize( vOutputDirection );\\n\\t\\t\\t\\tvec2 uv = equirectUv( outputDirection );\\n\\n\\t\\t\\t\\tvec2 f = fract( uv / texelSize - 0.5 );\\n\\t\\t\\t\\tuv -= f * texelSize;\\n\\t\\t\\t\\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\\n\\t\\t\\t\\tuv.x += texelSize.x;\\n\\t\\t\\t\\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\\n\\t\\t\\t\\tuv.y += texelSize.y;\\n\\t\\t\\t\\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\\n\\t\\t\\t\\tuv.x -= texelSize.x;\\n\\t\\t\\t\\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\\n\\n\\t\\t\\t\\tvec3 tm = mix( tl, tr, f.x );\\n\\t\\t\\t\\tvec3 bm = mix( bl, br, f.x );\\n\\t\\t\\t\\tgl_FragColor.rgb = mix( tm, bm, f.y );\\n\\n\\t\\t\\t\\tgl_FragColor = linearToOutputTexel( gl_FragColor );\\n\\n\\t\\t\\t}\\n\\t\\t`,blending:x,depthTest:!1,depthWrite:!1})}function qp(){return new uu({name:\"CubemapToCubeUV\",uniforms:{envMap:{value:null},inputEncoding:{value:Lp[Jt]},outputEncoding:{value:Lp[Jt]}},vertexShader:Xp(),fragmentShader:`\\n\\n\\t\\t\\tprecision mediump float;\\n\\t\\t\\tprecision mediump int;\\n\\n\\t\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t\\tuniform samplerCube envMap;\\n\\n\\t\\t\\t${Yp()}\\n\\n\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\t\\t\\t\\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\\n\\t\\t\\t\\tgl_FragColor = linearToOutputTexel( gl_FragColor );\\n\\n\\t\\t\\t}\\n\\t\\t`,blending:x,depthTest:!1,depthWrite:!1})}function Xp(){return\"\\n\\n\\t\\tprecision mediump float;\\n\\t\\tprecision mediump int;\\n\\n\\t\\tattribute vec3 position;\\n\\t\\tattribute vec2 uv;\\n\\t\\tattribute float faceIndex;\\n\\n\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t// RH coordinate system; PMREM face-indexing convention\\n\\t\\tvec3 getDirection( vec2 uv, float face ) {\\n\\n\\t\\t\\tuv = 2.0 * uv - 1.0;\\n\\n\\t\\t\\tvec3 direction = vec3( uv, 1.0 );\\n\\n\\t\\t\\tif ( face == 0.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.zyx; // ( 1, v, u ) pos x\\n\\n\\t\\t\\t} else if ( face == 1.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.xzy;\\n\\t\\t\\t\\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\\n\\n\\t\\t\\t} else if ( face == 2.0 ) {\\n\\n\\t\\t\\t\\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\\n\\n\\t\\t\\t} else if ( face == 3.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.zyx;\\n\\t\\t\\t\\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\\n\\n\\t\\t\\t} else if ( face == 4.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.xzy;\\n\\t\\t\\t\\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\\n\\n\\t\\t\\t} else if ( face == 5.0 ) {\\n\\n\\t\\t\\t\\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\\n\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn direction;\\n\\n\\t\\t}\\n\\n\\t\\tvoid main() {\\n\\n\\t\\t\\tvOutputDirection = getDirection( uv, faceIndex );\\n\\t\\t\\tgl_Position = vec4( position, 1.0 );\\n\\n\\t\\t}\\n\\t\"}function Yp(){return\"\\n\\n\\t\\tuniform int inputEncoding;\\n\\t\\tuniform int outputEncoding;\\n\\n\\t\\t#include <encodings_pars_fragment>\\n\\n\\t\\tvec4 inputTexelToLinear( vec4 value ) {\\n\\n\\t\\t\\tif ( inputEncoding == 0 ) {\\n\\n\\t\\t\\t\\treturn value;\\n\\n\\t\\t\\t} else if ( inputEncoding == 1 ) {\\n\\n\\t\\t\\t\\treturn sRGBToLinear( value );\\n\\n\\t\\t\\t} else if ( inputEncoding == 2 ) {\\n\\n\\t\\t\\t\\treturn RGBEToLinear( value );\\n\\n\\t\\t\\t} else if ( inputEncoding == 3 ) {\\n\\n\\t\\t\\t\\treturn RGBMToLinear( value, 7.0 );\\n\\n\\t\\t\\t} else if ( inputEncoding == 4 ) {\\n\\n\\t\\t\\t\\treturn RGBMToLinear( value, 16.0 );\\n\\n\\t\\t\\t} else if ( inputEncoding == 5 ) {\\n\\n\\t\\t\\t\\treturn RGBDToLinear( value, 256.0 );\\n\\n\\t\\t\\t} else {\\n\\n\\t\\t\\t\\treturn GammaToLinear( value, 2.2 );\\n\\n\\t\\t\\t}\\n\\n\\t\\t}\\n\\n\\t\\tvec4 linearToOutputTexel( vec4 value ) {\\n\\n\\t\\t\\tif ( outputEncoding == 0 ) {\\n\\n\\t\\t\\t\\treturn value;\\n\\n\\t\\t\\t} else if ( outputEncoding == 1 ) {\\n\\n\\t\\t\\t\\treturn LinearTosRGB( value );\\n\\n\\t\\t\\t} else if ( outputEncoding == 2 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBE( value );\\n\\n\\t\\t\\t} else if ( outputEncoding == 3 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBM( value, 7.0 );\\n\\n\\t\\t\\t} else if ( outputEncoding == 4 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBM( value, 16.0 );\\n\\n\\t\\t\\t} else if ( outputEncoding == 5 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBD( value, 256.0 );\\n\\n\\t\\t\\t} else {\\n\\n\\t\\t\\t\\treturn LinearToGamma( value, 2.2 );\\n\\n\\t\\t\\t}\\n\\n\\t\\t}\\n\\n\\t\\tvec4 envMapTexelToLinear( vec4 color ) {\\n\\n\\t\\t\\treturn inputTexelToLinear( color );\\n\\n\\t\\t}\\n\\t\"}const Zp=0,Jp=1,Kp=0,$p=1,Qp=2;function ef(e){return console.warn(\"THREE.MeshFaceMaterial has been removed. Use an Array instead.\"),e}function tf(e=[]){return console.warn(\"THREE.MultiMaterial has been removed. Use an Array instead.\"),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function nf(e,t){return console.warn(\"THREE.PointCloud has been renamed to THREE.Points.\"),new rc(e,t)}function rf(e){return console.warn(\"THREE.Particle has been renamed to THREE.Sprite.\"),new _l(e)}function of(e,t){return console.warn(\"THREE.ParticleSystem has been renamed to THREE.Points.\"),new rc(e,t)}function sf(e){return console.warn(\"THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.\"),new $l(e)}function af(e){return console.warn(\"THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.\"),new $l(e)}function lf(e){return console.warn(\"THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.\"),new $l(e)}function cf(e,t,n){return console.warn(\"THREE.Vertex has been removed. Use THREE.Vector3 instead.\"),new ar(e,t,n)}function uf(e,t){return console.warn(\"THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead.\"),new Bi(e,t).setUsage(En)}function hf(e,t){return console.warn(\"THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.\"),new Fi(e,t)}function df(e,t){return console.warn(\"THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.\"),new Gi(e,t)}function pf(e,t){return console.warn(\"THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.\"),new Ui(e,t)}function ff(e,t){return console.warn(\"THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.\"),new ki(e,t)}function mf(e,t){return console.warn(\"THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.\"),new Vi(e,t)}function gf(e,t){return console.warn(\"THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.\"),new Hi(e,t)}function vf(e,t){return console.warn(\"THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.\"),new ji(e,t)}function yf(e,t){return console.warn(\"THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.\"),new qi(e,t)}function xf(e,t){return console.warn(\"THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.\"),new Xi(e,t)}function _f(e){return console.warn(\"THREE.AxisHelper has been renamed to THREE.AxesHelper.\"),new _p(e)}function bf(e,t){return console.warn(\"THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.\"),new pp(e,t)}function wf(e,t){return console.warn(\"THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.\"),new Jl(new yc(e.geometry),new kl({color:void 0!==t?t:16777215}))}function Mf(e,t){return console.warn(\"THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.\"),new Jl(new au(e.geometry),new kl({color:void 0!==t?t:16777215}))}function Sf(e){return console.warn(\"THREE.XHRLoader has been renamed to THREE.FileLoader.\"),new Uu(e)}function Tf(e){return console.warn(\"THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.\"),new Wu(e)}function Ef(e,t,n){return console.warn(\"THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options ).\"),new Do(e,n)}function Lf(){console.error(\"THREE.CanvasRenderer has been removed\")}function Af(){console.error(\"THREE.JSONLoader has been removed.\")}Xu.create=function(e,t){return console.log(\"THREE.Curve.create() has been deprecated\"),e.prototype=Object.create(Xu.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},fh.prototype.fromPoints=function(e){return console.warn(\"THREE.Path: .fromPoints() has been renamed to .setFromPoints().\"),this.setFromPoints(e)},np.prototype.setColors=function(){console.error(\"THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.\")},Jd.prototype.update=function(){console.error(\"THREE.SkeletonHelper: update() no longer needs to be called.\")},Fu.prototype.extractUrlBase=function(e){return console.warn(\"THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.\"),Bh.extractUrlBase(e)},Fu.Handlers={add:function(){console.error(\"THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.\")},get:function(){console.error(\"THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.\")}},Ud.prototype.center=function(e){return console.warn(\"THREE.Box2: .center() has been renamed to .getCenter().\"),this.getCenter(e)},Ud.prototype.empty=function(){return console.warn(\"THREE.Box2: .empty() has been renamed to .isEmpty().\"),this.isEmpty()},Ud.prototype.isIntersectionBox=function(e){return console.warn(\"THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)},Ud.prototype.size=function(e){return console.warn(\"THREE.Box2: .size() has been renamed to .getSize().\"),this.getSize(e)},ur.prototype.center=function(e){return console.warn(\"THREE.Box3: .center() has been renamed to .getCenter().\"),this.getCenter(e)},ur.prototype.empty=function(){return console.warn(\"THREE.Box3: .empty() has been renamed to .isEmpty().\"),this.isEmpty()},ur.prototype.isIntersectionBox=function(e){return console.warn(\"THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)},ur.prototype.isIntersectionSphere=function(e){return console.warn(\"THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().\"),this.intersectsSphere(e)},ur.prototype.size=function(e){return console.warn(\"THREE.Box3: .size() has been renamed to .getSize().\"),this.getSize(e)},Pr.prototype.empty=function(){return console.warn(\"THREE.Sphere: .empty() has been renamed to .isEmpty().\"),this.isEmpty()},Bo.prototype.setFromMatrix=function(e){return console.warn(\"THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix().\"),this.setFromProjectionMatrix(e)},Hd.prototype.center=function(e){return console.warn(\"THREE.Line3: .center() has been renamed to .getCenter().\"),this.getCenter(e)},Jn.prototype.flattenToArrayOffset=function(e,t){return console.warn(\"THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.\"),this.toArray(e,t)},Jn.prototype.multiplyVector3=function(e){return console.warn(\"THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.\"),e.applyMatrix3(this)},Jn.prototype.multiplyVector3Array=function(){console.error(\"THREE.Matrix3: .multiplyVector3Array() has been removed.\")},Jn.prototype.applyToBufferAttribute=function(e){return console.warn(\"THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead.\"),e.applyMatrix3(this)},Jn.prototype.applyToVector3Array=function(){console.error(\"THREE.Matrix3: .applyToVector3Array() has been removed.\")},Jn.prototype.getInverse=function(e){return console.warn(\"THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.\"),this.copy(e).invert()},Fr.prototype.extractPosition=function(e){return console.warn(\"THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().\"),this.copyPosition(e)},Fr.prototype.flattenToArrayOffset=function(e,t){return console.warn(\"THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.\"),this.toArray(e,t)},Fr.prototype.getPosition=function(){return console.warn(\"THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.\"),(new ar).setFromMatrixColumn(this,3)},Fr.prototype.setRotationFromQuaternion=function(e){return console.warn(\"THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().\"),this.makeRotationFromQuaternion(e)},Fr.prototype.multiplyToArray=function(){console.warn(\"THREE.Matrix4: .multiplyToArray() has been removed.\")},Fr.prototype.multiplyVector3=function(e){return console.warn(\"THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},Fr.prototype.multiplyVector4=function(e){return console.warn(\"THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},Fr.prototype.multiplyVector3Array=function(){console.error(\"THREE.Matrix4: .multiplyVector3Array() has been removed.\")},Fr.prototype.rotateAxis=function(e){console.warn(\"THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.\"),e.transformDirection(this)},Fr.prototype.crossVector=function(e){return console.warn(\"THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},Fr.prototype.translate=function(){console.error(\"THREE.Matrix4: .translate() has been removed.\")},Fr.prototype.rotateX=function(){console.error(\"THREE.Matrix4: .rotateX() has been removed.\")},Fr.prototype.rotateY=function(){console.error(\"THREE.Matrix4: .rotateY() has been removed.\")},Fr.prototype.rotateZ=function(){console.error(\"THREE.Matrix4: .rotateZ() has been removed.\")},Fr.prototype.rotateByAxis=function(){console.error(\"THREE.Matrix4: .rotateByAxis() has been removed.\")},Fr.prototype.applyToBufferAttribute=function(e){return console.warn(\"THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},Fr.prototype.applyToVector3Array=function(){console.error(\"THREE.Matrix4: .applyToVector3Array() has been removed.\")},Fr.prototype.makeFrustum=function(e,t,n,r,i,o){return console.warn(\"THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.\"),this.makePerspective(e,t,r,n,i,o)},Fr.prototype.getInverse=function(e){return console.warn(\"THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.\"),this.copy(e).invert()},pi.prototype.isIntersectionLine=function(e){return console.warn(\"THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().\"),this.intersectsLine(e)},sr.prototype.multiplyVector3=function(e){return console.warn(\"THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.\"),e.applyQuaternion(this)},sr.prototype.inverse=function(){return console.warn(\"THREE.Quaternion: .inverse() has been renamed to invert().\"),this.invert()},Br.prototype.isIntersectionBox=function(e){return console.warn(\"THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)},Br.prototype.isIntersectionPlane=function(e){return console.warn(\"THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().\"),this.intersectsPlane(e)},Br.prototype.isIntersectionSphere=function(e){return console.warn(\"THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().\"),this.intersectsSphere(e)},Si.prototype.area=function(){return console.warn(\"THREE.Triangle: .area() has been renamed to .getArea().\"),this.getArea()},Si.prototype.barycoordFromPoint=function(e,t){return console.warn(\"THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().\"),this.getBarycoord(e,t)},Si.prototype.midpoint=function(e){return console.warn(\"THREE.Triangle: .midpoint() has been renamed to .getMidpoint().\"),this.getMidpoint(e)},Si.prototypenormal=function(e){return console.warn(\"THREE.Triangle: .normal() has been renamed to .getNormal().\"),this.getNormal(e)},Si.prototype.plane=function(e){return console.warn(\"THREE.Triangle: .plane() has been renamed to .getPlane().\"),this.getPlane(e)},Si.barycoordFromPoint=function(e,t,n,r,i){return console.warn(\"THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().\"),Si.getBarycoord(e,t,n,r,i)},Si.normal=function(e,t,n,r){return console.warn(\"THREE.Triangle: .normal() has been renamed to .getNormal().\"),Si.getNormal(e,t,n,r)},mh.prototype.extractAllPoints=function(e){return console.warn(\"THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.\"),this.extractPoints(e)},mh.prototype.extrude=function(e){return console.warn(\"THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.\"),new Xc(this,e)},mh.prototype.makeGeometry=function(e){return console.warn(\"THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.\"),new eu(this,e)},Zn.prototype.fromAttribute=function(e,t,n){return console.warn(\"THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().\"),this.fromBufferAttribute(e,t,n)},Zn.prototype.distanceToManhattan=function(e){return console.warn(\"THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().\"),this.manhattanDistanceTo(e)},Zn.prototype.lengthManhattan=function(){return console.warn(\"THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().\"),this.manhattanLength()},ar.prototype.setEulerFromRotationMatrix=function(){console.error(\"THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.\")},ar.prototype.setEulerFromQuaternion=function(){console.error(\"THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.\")},ar.prototype.getPositionFromMatrix=function(e){return console.warn(\"THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().\"),this.setFromMatrixPosition(e)},ar.prototype.getScaleFromMatrix=function(e){return console.warn(\"THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().\"),this.setFromMatrixScale(e)},ar.prototype.getColumnFromMatrix=function(e,t){return console.warn(\"THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().\"),this.setFromMatrixColumn(t,e)},ar.prototype.applyProjection=function(e){return console.warn(\"THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.\"),this.applyMatrix4(e)},ar.prototype.fromAttribute=function(e,t,n){return console.warn(\"THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().\"),this.fromBufferAttribute(e,t,n)},ar.prototype.distanceToManhattan=function(e){return console.warn(\"THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().\"),this.manhattanDistanceTo(e)},ar.prototype.lengthManhattan=function(){return console.warn(\"THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().\"),this.manhattanLength()},nr.prototype.fromAttribute=function(e,t,n){return console.warn(\"THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().\"),this.fromBufferAttribute(e,t,n)},nr.prototype.lengthManhattan=function(){return console.warn(\"THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().\"),this.manhattanLength()},ci.prototype.getChildByName=function(e){return console.warn(\"THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().\"),this.getObjectByName(e)},ci.prototype.renderDepth=function(){console.warn(\"THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.\")},ci.prototype.translate=function(e,t){return console.warn(\"THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.\"),this.translateOnAxis(t,e)},ci.prototype.getWorldRotation=function(){console.error(\"THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.\")},ci.prototype.applyMatrix=function(e){return console.warn(\"THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4().\"),this.applyMatrix4(e)},Object.defineProperties(ci.prototype,{eulerOrder:{get:function(){return console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\"),this.rotation.order},set:function(e){console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\"),this.rotation.order=e}},useQuaternion:{get:function(){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")},set:function(){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")}}}),Mo.prototype.setDrawMode=function(){console.error(\"THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.\")},Object.defineProperties(Mo.prototype,{drawMode:{get:function(){return console.error(\"THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode.\"),Xt},set:function(){console.error(\"THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.\")}}}),Cl.prototype.initBones=function(){console.error(\"THREE.SkinnedMesh: initBones() has been removed.\")},Ro.prototype.setLens=function(e,t){console.warn(\"THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.\"),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(gh.prototype,{onlyShadow:{set:function(){console.warn(\"THREE.Light: .onlyShadow has been removed.\")}},shadowCameraFov:{set:function(e){console.warn(\"THREE.Light: .shadowCameraFov is now .shadow.camera.fov.\"),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn(\"THREE.Light: .shadowCameraLeft is now .shadow.camera.left.\"),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn(\"THREE.Light: .shadowCameraRight is now .shadow.camera.right.\"),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn(\"THREE.Light: .shadowCameraTop is now .shadow.camera.top.\"),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn(\"THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.\"),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn(\"THREE.Light: .shadowCameraNear is now .shadow.camera.near.\"),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn(\"THREE.Light: .shadowCameraFar is now .shadow.camera.far.\"),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn(\"THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.\")}},shadowBias:{set:function(e){console.warn(\"THREE.Light: .shadowBias is now .shadow.bias.\"),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn(\"THREE.Light: .shadowDarkness has been removed.\")}},shadowMapWidth:{set:function(e){console.warn(\"THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.\"),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn(\"THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.\"),this.shadow.mapSize.height=e}}}),Object.defineProperties(Bi.prototype,{length:{get:function(){return console.warn(\"THREE.BufferAttribute: .length has been deprecated. Use .count instead.\"),this.array.length}},dynamic:{get:function(){return console.warn(\"THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.\"),this.usage===En},set:function(){console.warn(\"THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.\"),this.setUsage(En)}}}),Bi.prototype.setDynamic=function(e){return console.warn(\"THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead.\"),this.setUsage(!0===e?En:Tn),this},Bi.prototype.copyIndicesArray=function(){console.error(\"THREE.BufferAttribute: .copyIndicesArray() has been removed.\")},Bi.prototype.setArray=function(){console.error(\"THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers\")},io.prototype.addIndex=function(e){console.warn(\"THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().\"),this.setIndex(e)},io.prototype.addAttribute=function(e,t){return console.warn(\"THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute().\"),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?\"index\"===e?(console.warn(\"THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.\"),this.setIndex(t),this):this.setAttribute(e,t):(console.warn(\"THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).\"),this.setAttribute(e,new Bi(arguments[1],arguments[2])))},io.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn(\"THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.\"),console.warn(\"THREE.BufferGeometry: .addDrawCall() is now .addGroup().\"),this.addGroup(e,t)},io.prototype.clearDrawCalls=function(){console.warn(\"THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().\"),this.clearGroups()},io.prototype.computeOffsets=function(){console.warn(\"THREE.BufferGeometry: .computeOffsets() has been removed.\")},io.prototype.removeAttribute=function(e){return console.warn(\"THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute().\"),this.deleteAttribute(e)},io.prototype.applyMatrix=function(e){return console.warn(\"THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4().\"),this.applyMatrix4(e)},Object.defineProperties(io.prototype,{drawcalls:{get:function(){return console.error(\"THREE.BufferGeometry: .drawcalls has been renamed to .groups.\"),this.groups}},offsets:{get:function(){return console.warn(\"THREE.BufferGeometry: .offsets has been renamed to .groups.\"),this.groups}}}),rl.prototype.setDynamic=function(e){return console.warn(\"THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead.\"),this.setUsage(!0===e?En:Tn),this},rl.prototype.setArray=function(){console.error(\"THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers\")},Xc.prototype.getArrays=function(){console.error(\"THREE.ExtrudeGeometry: .getArrays() has been removed.\")},Xc.prototype.addShapeList=function(){console.error(\"THREE.ExtrudeGeometry: .addShapeList() has been removed.\")},Xc.prototype.addShape=function(){console.error(\"THREE.ExtrudeGeometry: .addShape() has been removed.\")},nl.prototype.dispose=function(){console.error(\"THREE.Scene: .dispose() has been removed.\")},Rd.prototype.onUpdate=function(){return console.warn(\"THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.\"),this},Object.defineProperties(Ei.prototype,{wrapAround:{get:function(){console.warn(\"THREE.Material: .wrapAround has been removed.\")},set:function(){console.warn(\"THREE.Material: .wrapAround has been removed.\")}},overdraw:{get:function(){console.warn(\"THREE.Material: .overdraw has been removed.\")},set:function(){console.warn(\"THREE.Material: .overdraw has been removed.\")}},wrapRGB:{get:function(){return console.warn(\"THREE.Material: .wrapRGB has been removed.\"),new Oi}},shading:{get:function(){console.error(\"THREE.\"+this.type+\": .shading has been removed. Use the boolean .flatShading instead.\")},set:function(e){console.warn(\"THREE.\"+this.type+\": .shading has been removed. Use the boolean .flatShading instead.\"),this.flatShading=e===v}},stencilMask:{get:function(){return console.warn(\"THREE.\"+this.type+\": .stencilMask has been removed. Use .stencilFuncMask instead.\"),this.stencilFuncMask},set:function(e){console.warn(\"THREE.\"+this.type+\": .stencilMask has been removed. Use .stencilFuncMask instead.\"),this.stencilFuncMask=e}}}),Object.defineProperties(Po.prototype,{derivatives:{get:function(){return console.warn(\"THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\"),this.extensions.derivatives},set:function(e){console.warn(\"THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\"),this.extensions.derivatives=e}}}),$a.prototype.clearTarget=function(e,t,n,r){console.warn(\"THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead.\"),this.setRenderTarget(e),this.clear(t,n,r)},$a.prototype.animate=function(e){console.warn(\"THREE.WebGLRenderer: .animate() is now .setAnimationLoop().\"),this.setAnimationLoop(e)},$a.prototype.getCurrentRenderTarget=function(){return console.warn(\"THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().\"),this.getRenderTarget()},$a.prototype.getMaxAnisotropy=function(){return console.warn(\"THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().\"),this.capabilities.getMaxAnisotropy()},$a.prototype.getPrecision=function(){return console.warn(\"THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.\"),this.capabilities.precision},$a.prototype.resetGLState=function(){return console.warn(\"THREE.WebGLRenderer: .resetGLState() is now .state.reset().\"),this.state.reset()},$a.prototype.supportsFloatTextures=function(){return console.warn(\"THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).\"),this.extensions.get(\"OES_texture_float\")},$a.prototype.supportsHalfFloatTextures=function(){return console.warn(\"THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).\"),this.extensions.get(\"OES_texture_half_float\")},$a.prototype.supportsStandardDerivatives=function(){return console.warn(\"THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).\"),this.extensions.get(\"OES_standard_derivatives\")},$a.prototype.supportsCompressedTextureS3TC=function(){return console.warn(\"THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).\"),this.extensions.get(\"WEBGL_compressed_texture_s3tc\")},$a.prototype.supportsCompressedTexturePVRTC=function(){return console.warn(\"THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).\"),this.extensions.get(\"WEBGL_compressed_texture_pvrtc\")},$a.prototype.supportsBlendMinMax=function(){return console.warn(\"THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).\"),this.extensions.get(\"EXT_blend_minmax\")},$a.prototype.supportsVertexTextures=function(){return console.warn(\"THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.\"),this.capabilities.vertexTextures},$a.prototype.supportsInstancedArrays=function(){return console.warn(\"THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).\"),this.extensions.get(\"ANGLE_instanced_arrays\")},$a.prototype.enableScissorTest=function(e){console.warn(\"THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().\"),this.setScissorTest(e)},$a.prototype.initMaterial=function(){console.warn(\"THREE.WebGLRenderer: .initMaterial() has been removed.\")},$a.prototype.addPrePlugin=function(){console.warn(\"THREE.WebGLRenderer: .addPrePlugin() has been removed.\")},$a.prototype.addPostPlugin=function(){console.warn(\"THREE.WebGLRenderer: .addPostPlugin() has been removed.\")},$a.prototype.updateShadowMap=function(){console.warn(\"THREE.WebGLRenderer: .updateShadowMap() has been removed.\")},$a.prototype.setFaceCulling=function(){console.warn(\"THREE.WebGLRenderer: .setFaceCulling() has been removed.\")},$a.prototype.allocTextureUnit=function(){console.warn(\"THREE.WebGLRenderer: .allocTextureUnit() has been removed.\")},$a.prototype.setTexture=function(){console.warn(\"THREE.WebGLRenderer: .setTexture() has been removed.\")},$a.prototype.setTexture2D=function(){console.warn(\"THREE.WebGLRenderer: .setTexture2D() has been removed.\")},$a.prototype.setTextureCube=function(){console.warn(\"THREE.WebGLRenderer: .setTextureCube() has been removed.\")},$a.prototype.getActiveMipMapLevel=function(){return console.warn(\"THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel().\"),this.getActiveMipmapLevel()},Object.defineProperties($a.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn(\"THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.\"),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn(\"THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.\"),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.\")}},context:{get:function(){return console.warn(\"THREE.WebGLRenderer: .context has been removed. Use .getContext() instead.\"),this.getContext()}},vr:{get:function(){return console.warn(\"THREE.WebGLRenderer: .vr has been renamed to .xr\"),this.xr}},gammaInput:{get:function(){return console.warn(\"THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.\"),!1},set:function(){console.warn(\"THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.\")}},gammaOutput:{get:function(){return console.warn(\"THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.\"),!1},set:function(e){console.warn(\"THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.\"),this.outputEncoding=!0===e?Kt:Jt}},toneMappingWhitePoint:{get:function(){return console.warn(\"THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.\"),1},set:function(){console.warn(\"THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.\")}}}),Object.defineProperties(Va.prototype,{cullFace:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.\")}},renderReverseSided:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.\")}},renderSingleSided:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.\")}}}),Object.defineProperties(rr.prototype,{wrapS:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\"),this.texture.wrapS},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\"),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\"),this.texture.wrapT},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\"),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\"),this.texture.magFilter},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\"),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\"),this.texture.minFilter},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\"),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\"),this.texture.anisotropy},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\"),this.texture.anisotropy=e}},offset:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\"),this.texture.offset},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\"),this.texture.offset=e}},repeat:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\"),this.texture.repeat},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\"),this.texture.repeat=e}},format:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\"),this.texture.format},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\"),this.texture.format=e}},type:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\"),this.texture.type},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\"),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\"),this.texture.generateMipmaps},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\"),this.texture.generateMipmaps=e}}}),hd.prototype.load=function(e){console.warn(\"THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.\");const t=this;return(new $h).load(e,(function(e){t.setBuffer(e)})),this},vd.prototype.getData=function(){return console.warn(\"THREE.AudioAnalyser: .getData() is now .getFrequencyData().\"),this.getFrequencyData()},Io.prototype.updateCubeMap=function(e,t){return console.warn(\"THREE.CubeCamera: .updateCubeMap() is now .update().\"),this.update(e,t)},Io.prototype.clear=function(e,t,n,r){return console.warn(\"THREE.CubeCamera: .clear() is now .renderTarget.clear().\"),this.renderTarget.clear(e,t,n,r)},$n.crossOrigin=void 0,$n.loadTexture=function(e,t,n,r){console.warn(\"THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.\");const i=new qu;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},$n.loadTextureCube=function(e,t,n,r){console.warn(\"THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.\");const i=new ju;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},$n.loadCompressedTexture=function(){console.error(\"THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.\")},$n.loadCompressedTextureCube=function(){console.error(\"THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.\")};const Pf={createMultiMaterialObject:function(){console.error(\"THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js\")},detach:function(){console.error(\"THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js\")},attach:function(){console.error(\"THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js\")}};function Cf(){console.error(\"THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js\")}\"undefined\"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent(\"register\",{detail:{revision:r}})),\"undefined\"!=typeof window&&(window.__THREE__?console.warn(\"WARNING: Multiple instances of Three.js being imported.\"):window.__THREE__=r)},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),t.InterpolateExpr=t.StepExpr=t.CaseExpr=t.MatchExpr=t.CallExpr=t.HasAttributeExpr=t.ObjectLiteralExpr=t.StringLiteralExpr=t.NumberLiteralExpr=t.BooleanLiteralExpr=t.NullLiteralExpr=t.LiteralExpr=t.VarExpr=t.Expr=t.ExprScope=t.isJsonExpr=t.ExprDependencies=void 0;const o=n(0),s=n(85),a=n(99),l=n(100),c=n(28),u=n(27),h=n(17);i(n(19),t);const d=new s.ExprEvaluator,p=new a.ExprInstantiator;class f{constructor(){this.properties=new Set}}t.ExprDependencies=f;class m{static of(e){const t=new f;return e.accept(this.instance,t),t}visitNullLiteralExpr(e,t){}visitBooleanLiteralExpr(e,t){}visitNumberLiteralExpr(e,t){}visitStringLiteralExpr(e,t){}visitObjectLiteralExpr(e,t){}visitVarExpr(e,t){t.properties.add(e.name)}visitHasAttributeExpr(e,t){t.properties.add(e.name)}visitCallExpr(e,t){switch(e.args.forEach(e=>e.accept(this,t)),e.op){case\"dynamic-properties\":t.volatile=!0;break;case\"feature-state\":t.featureState=!0,t.properties.add(\"$state\"),t.properties.add(\"$id\");break;case\"id\":t.properties.add(\"$id\");break;case\"zoom\":case\"world-ppi-scale\":case\"world-discrete-ppi-scale\":t.properties.add(\"$zoom\");break;case\"geometry-type\":t.properties.add(\"$geometryType\")}}visitMatchExpr(e,t){e.value.accept(this,t),e.branches.forEach(([e,n])=>n.accept(this,t)),e.fallback.accept(this,t)}visitCaseExpr(e,t){e.branches.forEach(([e,n])=>{e.accept(this,t),n.accept(this,t)}),e.fallback.accept(this,t)}visitStepExpr(e,t){e.input.accept(this,t),e.defaultValue.accept(this,t),e.stops.forEach(([e,n])=>n.accept(this,t))}visitInterpolateExpr(e,t){e.input.accept(this,t),e.stops.forEach(([e,n])=>n.accept(this,t))}}function g(e){return Array.isArray(e)&&e.length>0&&\"string\"==typeof e[0]}var v;m.instance=new m,t.isJsonExpr=g,function(e){e[e.Value=0]=\"Value\",e[e.Condition=1]=\"Condition\",e[e.Dynamic=2]=\"Dynamic\"}(v=t.ExprScope||(t.ExprScope={}));class y{static isExpr(e){return e instanceof y}static parse(e){return new l.ExprParser(e).parse()}static fromJSON(e,t,n){return O(e,void 0!==t?{definitions:t,lockedNames:new Set,cache:null!=n?n:new Map}:void 0)}evaluate(e,t=v.Value,n){return this.accept(d,new s.ExprEvaluatorContext(d,e,t,n))}instantiate(e){return this.accept(p,e)}dependencies(){return this.m_dependencies||(this.m_dependencies=m.of(this)),this.m_dependencies}intern(e){return e.add(this)}toJSON(){return(new I).serialize(this)}isDynamic(){return void 0===this.m_isDynamic&&(this.m_isDynamic=this.exprIsDynamic()),this.m_isDynamic}}t.Expr=y;class x extends y{constructor(e){super(),this.name=e}accept(e,t){return e.visitVarExpr(this,t)}exprIsDynamic(){return!1}}t.VarExpr=x;class _ extends y{static fromValue(e){switch(typeof e){case\"boolean\":return new w(e);case\"number\":return new M(e);case\"string\":return new S(e);case\"object\":return null===e?b.instance:new T(e);default:throw new Error(`failed to create a literal from '${e}'`)}}exprIsDynamic(){return!1}}t.LiteralExpr=_;class b extends _{constructor(){super(),this.value=null}accept(e,t){return e.visitNullLiteralExpr(this,t)}exprIsDynamic(){return!1}}t.NullLiteralExpr=b,b.instance=new b;class w extends _{constructor(e){super(),this.value=e}accept(e,t){return e.visitBooleanLiteralExpr(this,t)}}t.BooleanLiteralExpr=w;class M extends _{constructor(e){super(),this.value=e}accept(e,t){return e.visitNumberLiteralExpr(this,t)}}t.NumberLiteralExpr=M;class S extends _{constructor(e){super(),this.value=e}get promotedValue(){var e,t,n;return void 0===this.m_promotedValue&&(this.m_promotedValue=null!==(t=null!==(e=h.RGBA.parse(this.value))&&void 0!==e?e:u.Pixels.parse(this.value))&&void 0!==t?t:null),null!==(n=this.m_promotedValue)&&void 0!==n?n:void 0}accept(e,t){return e.visitStringLiteralExpr(this,t)}}t.StringLiteralExpr=S;class T extends _{constructor(e){super(),this.value=e}get isArrayLiteral(){return Array.isArray(this.value)}accept(e,t){return e.visitObjectLiteralExpr(this,t)}}t.ObjectLiteralExpr=T;class E extends y{constructor(e){super(),this.name=e}accept(e,t){return e.visitHasAttributeExpr(this,t)}exprIsDynamic(){return!1}}t.HasAttributeExpr=E;class L extends y{constructor(e,t){super(),this.op=e,this.args=t}get children(){return this.args}accept(e,t){return e.visitCallExpr(this,t)}exprIsDynamic(){var e;const t=null!==(e=this.descriptor)&&void 0!==e?e:s.ExprEvaluator.getOperator(this.op);return!!(t&&t.isDynamicOperator&&t.isDynamicOperator(this))||this.args.some(e=>e.isDynamic())}}t.CallExpr=L;class A extends y{constructor(e,t,n){super(),this.value=e,this.branches=t,this.fallback=n}static isValidMatchLabel(e){switch(typeof e){case\"number\":case\"string\":return!0;case\"object\":if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return(\"number\"===t||\"string\"===t)&&e.every(e=>typeof e===t);default:return!1}}accept(e,t){return e.visitMatchExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()||this.branches.some(([e,t])=>t.isDynamic())||this.fallback.isDynamic()}}t.MatchExpr=A;class P extends y{constructor(e,t){super(),this.branches=e,this.fallback=t}accept(e,t){return e.visitCaseExpr(this,t)}exprIsDynamic(){return this.branches.some(([e,t])=>e.isDynamic()||t.isDynamic())||this.fallback.isDynamic()}}t.CaseExpr=P;class C extends y{constructor(e,t,n){super(),this.input=e,this.defaultValue=t,this.stops=n}accept(e,t){return e.visitStepExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.defaultValue.isDynamic()||this.stops.some(([e,t])=>t.isDynamic())}}t.StepExpr=C;class R extends y{constructor(e,t,n){super(),this.mode=e,this.input=t,this.stops=n}accept(e,t){return e.visitInterpolateExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.stops.some(([e,t])=>t.isDynamic())}}t.InterpolateExpr=R;class I{serialize(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value instanceof o.Vector2?[\"make-vector\",e.value.x,e.value.y]:e.value instanceof o.Vector3?[\"make-vector\",e.value.x,e.value.y,e.value.z]:e.value instanceof o.Vector4?[\"make-vector\",e.value.x,e.value.y,e.value.z,e.value.w]:[\"literal\",e.value]}visitVarExpr(e,t){return[\"get\",e.name]}visitHasAttributeExpr(e,t){return[\"has\",e.name]}visitCallExpr(e,t){return[e.op,...e.args.map(e=>this.serialize(e))]}visitMatchExpr(e,t){const n=[];for(const[t,r]of e.branches)n.push(t,this.serialize(r));return[\"match\",this.serialize(e.value),...n,this.serialize(e.fallback)]}visitCaseExpr(e,t){const n=[];for(const[t,r]of e.branches)n.push(this.serialize(t),this.serialize(r));return[\"case\",...n,this.serialize(e.fallback)]}visitStepExpr(e,t){const n=[\"step\"];return n.push(this.serialize(e.input)),n.push(this.serialize(e.defaultValue)),e.stops.forEach(([e,t])=>{n.push(e),n.push(this.serialize(t))}),n}visitInterpolateExpr(e,t){const n=[\"interpolate\",e.mode];return n.push(this.serialize(e.input)),e.stops.forEach(([e,t])=>{n.push(e),n.push(this.serialize(t))}),n}}function O(e,t){if(Array.isArray(e))return function e(t,n){const r=t[0];if(\"string\"!=typeof r)throw new Error(\"expected a builtin function name\");switch(r){case\"!has\":case\"!in\":return new L(\"!\",[e([r.slice(1),...t.slice(1)])]);case\"ref\":return function(e,t){if(\"string\"!=typeof e[1])throw new Error(\"expected the name of an attribute\");if(void 0===t)throw new Error(\"ref used with no definitions\");const n=e[1];if(t.lockedNames.has(n))throw new Error(`circular referene to '${n}'`);if(!(n in t.definitions))throw new Error(`definition '${n}' not found`);const r=t.cache.get(n);if(void 0!==r)return r;let i,o=t.definitions[n];if(c.isInterpolatedPropertyDefinition(o.value))return y.fromJSON(c.interpolatedPropertyDefinitionToJsonExpr(o.value));if(!g(o.value))return y.fromJSON(o.value);o=o.value;if(!g(o))throw new Error(\"unsupported definition \"+n);t.lockedNames.add(n);try{i=O(o,t)}finally{t.lockedNames.delete(n)}return t.cache.set(n,i),i}(t,n);case\"get\":return function(e,t){if(void 0!==e[2])return D(\"get\",e,t);const n=e[1];if(\"string\"!=typeof n)throw new Error(\"expected the name of an attribute\");return new x(n)}(t,n);case\"has\":return function(e,t){if(void 0!==e[2])return D(\"has\",e,t);const n=e[1];if(\"string\"!=typeof n)throw new Error(\"expected the name of an attribute\");return new E(n)}(t,n);case\"literal\":return function(e){const t=e[1];if(null===t||\"object\"!=typeof t)throw new Error(\"expected an object or array literal\");return new T(t)}(t);case\"match\":return function(e,t){if(e.length<4)throw new Error(\"not enough arguments\");if(!(e.length%2))throw new Error(\"fallback is missing in 'match' expression\");const n=O(e[1],t),r=[];for(let n=2;n<e.length-1;n+=2){const i=e[n];if(!A.isValidMatchLabel(i))throw new Error(`'${JSON.stringify(i)}' is not a valid label for 'match'`);const o=O(e[n+1],t);r.push([i,o])}const i=O(e[e.length-1],t);return new A(n,r,i)}(t,n);case\"case\":return function(e,t){if(e.length<3)throw new Error(\"not enough arguments\");if(e.length%2)throw new Error(\"fallback is missing in 'case' expression\");const n=[];for(let r=1;r<e.length-1;r+=2){const i=O(e[r],t),o=O(e[r+1],t);n.push([i,o])}const r=O(e[e.length-1],t);return new P(n,r)}(t,n);case\"interpolate\":return function(e,t){const n=e[1];if(!function(e){if(!Array.isArray(e))return!1;switch(e[0]){case\"discrete\":case\"linear\":case\"cubic\":case\"exponential\":return!0;default:return!1}}(n))throw new Error(\"expected an interpolation type\");if(\"exponential\"===n[0]&&\"number\"!=typeof n[1])throw new Error(\"expected the base of the exponential interpolation\");const r=void 0!==e[2]?O(e[2],t):void 0;if(!y.isExpr(r))throw new Error(\"expected the input of the interpolation\");if(3===e.length||!(e.length%2))throw new Error(\"invalid number of samples\");const i=[];for(let n=3;n<e.length-1;n+=2){const r=e[n],o=O(e[n+1],t);i.push([r,o])}return new R(n,r,i)}(t,n);case\"step\":return function(e,t){if(e.length<2)throw new Error(\"expected the input of the 'step' operator\");if(e.length<3||!(e.length%2))throw new Error(\"not enough arguments\");const n=O(e[1],t),r=O(e[2],t),i=[];for(let n=3;n<e.length;n+=2){const r=e[n],o=O(e[n+1],t);i.push([r,o])}return new C(n,r,i)}(t,n);default:return D(r,t,n)}}(e,t);if(null===e)return b.instance;if(\"boolean\"==typeof e)return new w(e);if(\"number\"==typeof e)return new M(e);if(\"string\"==typeof e)return new S(e);throw new Error(\"failed to create expression from: \"+JSON.stringify(e))}function D(e,t,n){return new L(e,t.slice(1).map(e=>O(e,n)))}},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),i(n(59),t),i(n(82),t)},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),i(n(8),t),i(n(108),t),i(n(9),t),i(n(4),t),i(n(30),t),i(n(109),t),i(n(110),t),i(n(31),t),i(n(13),t),i(n(41),t),i(n(111),t),i(n(12),t),i(n(20),t),i(n(42),t),i(n(112),t),i(n(43),t),i(n(44),t),i(n(21),t),i(n(113),t),i(n(45),t),i(n(114),t),i(n(22),t),i(n(46),t),i(n(47),t),i(n(14),t),i(n(115),t),i(n(116),t),i(n(117),t),i(n(118),t),i(n(119),t),i(n(120),t),i(n(10),t),i(n(11),t),i(n(6),t),i(n(121),t),i(n(122),t)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoCoordinates=t.MIN_LONGITUDE=t.MAX_LONGITUDE=t.MIN_LATITUDE=t.MAX_LATITUDE=void 0;const r=n(0),i=n(9),o=n(30),s=n(31);t.MAX_LATITUDE=90,t.MIN_LATITUDE=-90,t.MAX_LONGITUDE=180,t.MIN_LONGITUDE=-180;const a=new r.Vector3,l=new r.Vector3;class c{constructor(e,t,n){this.latitude=e,this.longitude=t,this.altitude=n}static fromDegrees(e,t,n){return new c(e,t,n)}static fromRadians(e,t,n){return new c(r.MathUtils.radToDeg(e),r.MathUtils.radToDeg(t),n)}static fromLatLng(e){return new c(e.lat,e.lng)}static fromGeoPoint(e){return new c(e[1],e[0],e[2])}static fromObject(e){if(o.isGeoPointLike(e))return c.fromGeoPoint(e);if(i.isGeoCoordinatesLike(e))return c.fromDegrees(e.latitude,e.longitude,e.altitude);if(s.isLatLngLike(e))return c.fromDegrees(e.lat,e.lng);throw new Error(\"Invalid input coordinate format.\")}static lerp(e,t,n,r=!1,i=!1){var o,s;if(r){if(e.lng<t.lng){const r=e.clone();return r.longitude+=360,this.lerp(t,r,1-n)}{const r=t.clone();return r.longitude+=360,this.lerp(e,r,n)}}const u=a.set(e.lat,e.lng,null!==(o=e.altitude)&&void 0!==o?o:0),h=l.set(t.lat,t.lng,null!==(s=t.altitude)&&void 0!==s?s:0);u.lerp(h,n);const d=new c(u.x,u.y,u.z);return i?d.normalized():d}get latitudeInRadians(){return r.MathUtils.degToRad(this.latitude)}get longitudeInRadians(){return r.MathUtils.degToRad(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;return isNaN(e)||isNaN(t)?this:((t<-180||t>180)&&(t=function(e,t){const n=e%t;return n<0===t<0?n:n+t}(t+180,360)-180),e=r.MathUtils.clamp(e,-90,90),new c(e,t,this.altitude))}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new c(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}minLongitudeSpanTo(e){const t=Math.min(this.longitude,e.longitude),n=Math.max(this.longitude,e.longitude);return Math.min(n-t,360+t-n)}}t.GeoCoordinates=c},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),i(n(16),t),i(n(1),t),i(n(29),t),i(n(37),t),i(n(101),t),i(n(102),t),i(n(38),t),i(n(28),t),i(n(103),t),i(n(104),t),i(n(105),t),i(n(106),t),i(n(107),t),i(n(39),t),i(n(123),t),i(n(49),t),i(n(124),t),i(n(18),t)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MathUtils=void 0;const r=n(0);!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function n(e,n){const r=(e=t(e))-(n=t(n));return r>180?r-360:r<=-180?r+360:r}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,n,r){return void 0===r?{x:e,y:t,z:n}:(r.x=e,r.y=t,r.z=n,r)},e.copyVector3=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.degToRad=r.MathUtils.degToRad,e.radToDeg=r.MathUtils.radToDeg,e.clamp=r.MathUtils.clamp,e.normalizeAngleDeg=t,e.normalizeLongitudeDeg=function(e){return(e=t(e))>180&&(e-=360),e},e.angleDistanceDeg=n,e.interpolateAnglesDeg=function(e,t,r){return(e+n(t,e)*r)%360}}(t.MathUtils||(t.MathUtils={}))},function(e,t,n){\"use strict\";(function(e){var r=t;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function o(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,\"message\",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,\"stack\",{value:(new Error).stack||\"\"}),n&&i(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,\"name\",{get:function(){return e}}),t.prototype.toString=function(){return this.name+\": \"+this.message},t}r.asPromise=n(147),r.base64=n(148),r.EventEmitter=n(149),r.float=n(150),r.inquire=n(151),r.utf8=n(152),r.pool=n(153),r.LongBits=n(154),r.isNode=Boolean(void 0!==e&&e&&e.process&&e.process.versions&&e.process.versions.node),r.global=r.isNode&&e||\"undefined\"!=typeof window&&window||\"undefined\"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return\"number\"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return\"string\"==typeof e||e instanceof String},r.isObject=function(e){return e&&\"object\"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&(\"object\"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire(\"buffer\").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return\"number\"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):\"undefined\"==typeof Uint8Array?e:new Uint8Array(e)},r.Array=\"undefined\"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire(\"long\"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\\\x00-\\\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=o,r.ProtocolError=o(\"ProtocolError\"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}).call(this,n(146))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoBox=void 0;const r=n(0),i=n(4);class o{constructor(e,t){this.southWest=e,this.northEast=t,this.west>this.east&&(this.northEast.longitude+=360)}static fromCoordinates(e,t){return new o(e,t)}static fromCenterAndExtents(e,t){return new o(new i.GeoCoordinates(e.latitude-t.latitudeSpan/2,e.longitude-t.longitudeSpan/2),new i.GeoCoordinates(e.latitude+t.latitudeSpan/2,e.longitude+t.longitudeSpan/2))}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:n}=this,{minAltitude:r,altitudeSpan:o}=this;let s;if(void 0!==r&&void 0!==o&&(s=r+.5*o),t<=n)return new i.GeoCoordinates(e,.5*(t+n),s);let a=.5*(360+n+t);return a>360&&(a-=360),new i.GeoCoordinates(e,a,s)}get latitudeSpanInRadians(){return r.MathUtils.degToRad(this.latitudeSpan)}get longitudeSpanInRadians(){return r.MathUtils.degToRad(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,n=this.minAltitude===e.altitude,r=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!!(t?n:r)&&this.containsHelper(e)}clone(){return new o(this.southWest.clone(),this.northEast.clone())}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:n}=this;let r=e.longitude;if(n>i.MAX_LONGITUDE)for(;r<t;)r+=360;if(r>n)for(;r>t+360;)r-=360;return r>=t&&r<n}}t.GeoBox=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isGeoCoordinatesLike=void 0,t.isGeoCoordinatesLike=function(e){return e&&\"number\"==typeof e.latitude&&\"number\"==typeof e.longitude&&(\"number\"==typeof e.altitude||void 0===e.altitude)}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isBox3Like=void 0,t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isOrientedBox3Like=void 0,t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.Projection=t.ProjectionType=void 0;const r=n(9),i=n(6);!function(e){e[e.Planar=0]=\"Planar\",e[e.Spherical=1]=\"Spherical\"}(t.ProjectionType||(t.ProjectionType={}));t.Projection=class{constructor(e){this.unitScale=e}localTangentSpace(e,t){return r.isGeoCoordinatesLike(e)?this.projectPoint(e,t.position):i.MathUtils.copyVector3(e,t.position),i.MathUtils.newVector3(1,0,0,t.xAxis),i.MathUtils.newVector3(0,1,0,t.yAxis),i.MathUtils.newVector3(0,0,1,t.zAxis),t}reprojectPoint(e,t,n){return e===this?void 0===n?{x:t.x,y:t.y,z:t.z}:(n.x=t.x,n.y=t.y,n.z=t.z,n):this.projectPoint(e.unprojectPoint(t),n)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.EarthConstants=void 0;class r{}t.EarthConstants=r,r.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,r.EQUATORIAL_RADIUS=6378137,r.MIN_ELEVATION=-433,r.MAX_ELEVATION=8848,r.MAX_BUILDING_HEIGHT=828},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TilingScheme=void 0;const r=n(43),i=n(46),o=n(47);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new r.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new o.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return i.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return i.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GEOJSON_TILER_SERVICE_TYPE=t.VECTOR_TILE_DECODER_SERVICE_TYPE=t.OmvGeometryType=t.OmvFilterString=t.FeatureModifierId=void 0,function(e){e[e.default=0]=\"default\"}(t.FeatureModifierId||(t.FeatureModifierId={})),function(e){let t;!function(e){e[e.Any=0]=\"Any\",e[e.Match=1]=\"Match\",e[e.StartsWith=2]=\"StartsWith\",e[e.Contains=3]=\"Contains\",e[e.EndsWith=4]=\"EndsWith\"}(t=e.StringMatch||(e.StringMatch={})),e.matchString=function(t,n){switch(n.match){case e.StringMatch.Any:return!0;case e.StringMatch.Match:return t===n.value;case e.StringMatch.StartsWith:return n.value.startsWith(t);case e.StringMatch.EndsWith:return n.value.endsWith(t);default:return t.includes(n.value)}}}(t.OmvFilterString||(t.OmvFilterString={})),function(e){e[e.UNKNOWN=0]=\"UNKNOWN\",e[e.POINT=1]=\"POINT\",e[e.LINESTRING=2]=\"LINESTRING\",e[e.POLYGON=3]=\"POLYGON\"}(t.OmvGeometryType||(t.OmvGeometryType={})),t.VECTOR_TILE_DECODER_SERVICE_TYPE=\"vector-tile-decoder\",t.GEOJSON_TILER_SERVICE_TYPE=\"geojson-tiler\"},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ColorUtils=void 0;const r=n(2),i=n(0),o=n(17),s=new i.Color;!function(e){e.getHexFromRgba=function(e,t,n,i){return r.assert(i>=0&&i<=1),255-Math.floor(255*i)<<24^255*e<<16^255*t<<8^255*n<<0},e.getHexFromRgb=function(e,t,n){return r.assert(e>=0&&e<=1),r.assert(t>=0&&t<=1),r.assert(n>=0&&n<=1),255*e<<16^255*t<<8^255*n<<0},e.getHexFromHsl=function(e,t,n){return r.assert(e>=0&&e<=1),r.assert(t>=0&&t<=1),r.assert(n>=0&&n<=1),s.setHSL(e,t,n).getHex()},e.getRgbaFromHex=function(e,t=new o.RGBA){return r.assert(0==(0&e),\"Wrong hex format\"),t.r=(e>>16&255)/255,t.g=(e>>8&255)/255,t.b=(e>>0&255)/255,t.a=(255-(e>>24&255))/255,t},e.hasAlphaInHex=function(e){return r.assert(0==(0&e),\"Wrong hex format\"),e>>24!=0},e.getAlphaFromHex=function(e){return r.assert(0==(0&e),\"Wrong hex format\"),(255-(e>>24)&255)/255},e.removeAlphaFromHex=function(e){return r.assert(0==(0&e),\"Wrong hex format\"),16777215&e}}(t.ColorUtils||(t.ColorUtils={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.RGBA=void 0;const r=n(0),i=n(16),o=n(18);class s{constructor(e=1,t=1,n=1,r=1){this.r=e,this.g=t,this.b=n,this.a=r}static parse(e){const t=o.parseStringEncodedColor(e);if(void 0!==t)return i.ColorUtils.getRgbaFromHex(t)}clone(){return new s(this.r,this.g,this.b,this.a)}getHex(){return i.ColorUtils.getHexFromRgba(this.r,this.g,this.b,this.a)}lerp(e,t){return this.r=r.MathUtils.lerp(this.r,e.r,t),this.g=r.MathUtils.lerp(this.g,e.g,t),this.b=r.MathUtils.lerp(this.b,e.b,t),this.a=r.MathUtils.lerp(this.a,e.a,t),this}toJSON(){return`rgba(${255*this.r<<0}, ${255*this.g<<0}, ${255*this.b<<0}, ${this.a})`}}t.RGBA=s},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.parseStringEncodedColor=t.parseStringEncodedNumeral=t.StringEncodedNumeralFormatMaxSize=t.StringEncodedNumeralFormats=t.StringEncodedColorFormats=t.StringEncodedMetricFormats=t.StringEncodedNumeralType=void 0;const r=n(2),i=n(84),o=n(16);var s;!function(e){e[e.Meters=0]=\"Meters\",e[e.Pixels=1]=\"Pixels\",e[e.Hex=2]=\"Hex\"}(s=t.StringEncodedNumeralType||(t.StringEncodedNumeralType={}));const a={type:s.Meters,size:1,regExp:/^((?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))m$/,decoder:(e,t)=>{const n=a.regExp.exec(e);return!!n&&void 0!==(t[0]=Number(n[1]))}},l={type:s.Pixels,size:1,mask:1,regExp:/^((?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))px$/,decoder:(e,t)=>{const n=l.regExp.exec(e);return null!==n&&(t[0]=Number(n[1]),!0)}},c={type:s.Hex,size:4,regExp:/^\\#((?:[0-9A-Fa-f][0-9A-Fa-f]){4}|[0-9A-Fa-f]{4})$/,decoder:(e,t)=>{const n=c.regExp.exec(e);if(null===n)return!1;const i=n[1],o=i.length;return r.assert(4===o||8===o,\"Matched incorrect hex color format\"),4===o?(t[0]=parseInt(i.charAt(0)+i.charAt(0),16)/255,t[1]=parseInt(i.charAt(1)+i.charAt(1),16)/255,t[2]=parseInt(i.charAt(2)+i.charAt(2),16)/255,t[3]=4===o?parseInt(i.charAt(3)+i.charAt(3),16)/255:1):8===o&&(t[0]=parseInt(i.charAt(0)+i.charAt(1),16)/255,t[1]=parseInt(i.charAt(2)+i.charAt(3),16)/255,t[2]=parseInt(i.charAt(4)+i.charAt(5),16)/255,t[3]=8===o?parseInt(i.charAt(6)+i.charAt(7),16)/255:1),!0}};t.StringEncodedMetricFormats=[a,l];const u=t.StringEncodedMetricFormats.reduce((e,t)=>Math.max(e,t.size),0);t.StringEncodedColorFormats=[c];const h=t.StringEncodedColorFormats.reduce((e,t)=>Math.max(e,t.size),0);t.StringEncodedNumeralFormats=[...t.StringEncodedMetricFormats,...t.StringEncodedColorFormats],t.StringEncodedNumeralFormatMaxSize=Math.max(h,u);const d=new Array(t.StringEncodedNumeralFormatMaxSize);function p(e,t,n=1){const r=t.find(t=>!!t.decoder(e,d));if(void 0===r){const t=i.parseCSSColor(e);return Array.isArray(t)&&!t.some(e=>isNaN(e))?o.ColorUtils.getHexFromRgba(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}switch(null==r?void 0:r.type){case s.Pixels:return d[0]*n;case s.Hex:return o.ColorUtils.getHexFromRgba(d[0],d[1],d[2],d[3]);default:return d[0]}}t.parseStringEncodedNumeral=function(e,n=1){return p(e,t.StringEncodedNumeralFormats,n)},t.parseStringEncodedColor=function(e){return p(e,t.StringEncodedColorFormats)}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MapEnv=t.Env=void 0;class r{static isEnv(e){return e instanceof r}lookup(e){}unmap(){return{}}}t.Env=r;t.MapEnv=class extends r{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){if(this.entries.hasOwnProperty(e)){const t=this.entries[e];if(void 0!==t)return t}return this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.webMercatorProjection=t.mercatorProjection=t.MercatorConstants=void 0;const r=n(0),i=n(8),o=n(4),s=n(9),a=n(10),l=n(6),c=n(11),u=n(13),h=n(12);class d extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Planar}static clamp(e,t,n){return Math.min(Math.max(t,e),n)}static latitudeClamp(e){return d.clamp(e,-p.MAXIMUM_LATITUDE,p.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return d.latitudeProject(d.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/this.unitScale-.5))}worldExtent(e,t,n){return n||(n=new r.Box3),n.min.x=0,n.min.y=0,n.min.z=e,n.max.x=this.unitScale,n.max.y=this.unitScale,n.max.z=t,n}projectPoint(e,t){var n;let r;return r=e instanceof o.GeoCoordinates?e:new o.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(r.longitude+180)/360*this.unitScale,t.y=(.5*d.latitudeClampProject(r.latitudeInRadians)+.5)*this.unitScale,t.z=null!==(n=r.altitude)&&void 0!==n?n:0,t}unprojectPoint(e){return o.GeoCoordinates.fromRadians(d.unprojectLatitude(2*(e.y/this.unitScale-.5)),e.x/this.unitScale*2*Math.PI-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){var n;const i=this.projectPoint(e.center),o=(.5*d.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*this.unitScale,s=(.5*d.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*this.unitScale,u=.5*(o+s);i.y=u;const h=o-s,p=e.longitudeSpan/360*this.unitScale;if(t||(t=new r.Box3),a.isBox3Like(t)){t.min.x=i.x-.5*p,t.min.y=i.y-.5*h,t.max.x=i.x+.5*p,t.max.y=i.y+.5*h;const n=e.altitudeSpan;void 0!==n?(t.min.z=i.z-.5*n,t.max.z=i.z+.5*n):(t.min.z=0,t.max.z=0)}else{if(!c.isOrientedBox3Like(t))throw new Error(\"invalid bounding box\");l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,1,0,t.yAxis),l.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=i.x,t.position.y=i.y,t.position.z=i.z,t.extents.x=.5*p,t.extents.y=.5*h,t.extents.z=Math.max(Number.EPSILON,.5*(null!==(n=e.altitudeSpan)&&void 0!==n?n:0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return i.GeoBox.fromCoordinates(t,n)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}reprojectPoint(e,n,r){return e===this||e!==t.webMercatorProjection&&e!==t.mercatorProjection?super.reprojectPoint(e,n,r):(void 0===r&&(r={}),r.x=n.x,r.y=this.unitScale-n.y,r.z=n.z,r)}}class p{}t.MercatorConstants=p,p.MAXIMUM_LATITUDE=1.4844222297453322,t.mercatorProjection=new d(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE),t.webMercatorProjection=new class extends d{projectPoint(e,t){var n;let r;r=e instanceof o.GeoCoordinates?e:new o.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(r.longitude+180)/360*this.unitScale;const i=Math.sin(d.latitudeClamp(r.latitudeInRadians));return t.y=(.5-Math.log((1+i)/(1-i))/(4*Math.PI))*this.unitScale,t.z=null!==(n=r.altitude)&&void 0!==n?n:0,t}unprojectPoint(e){const t=e.x/this.unitScale-.5,n=.5-e.y/this.unitScale,r=360*t,i=90-360*Math.atan(Math.exp(2*-n*Math.PI))/Math.PI;return new o.GeoCoordinates(i,r,e.z)}projectBox(e,t){const n=super.projectBox(e,t);if(a.isBox3Like(n)){const e=n.max.y;n.max.y=this.unitScale-n.min.y,n.min.y=this.unitScale-e}else c.isOrientedBox3Like(n)&&(l.MathUtils.newVector3(1,0,0,n.xAxis),l.MathUtils.newVector3(0,-1,0,n.yAxis),l.MathUtils.newVector3(0,0,-1,n.zAxis),n.position.y=this.unitScale-n.position.y);return n}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return new i.GeoBox(new o.GeoCoordinates(n.latitude,t.longitude,t.altitude),new o.GeoCoordinates(t.latitude,n.longitude,n.altitude))}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}localTangentSpace(e,t){return s.isGeoCoordinatesLike(e)?this.projectPoint(e,t.position):l.MathUtils.copyVector3(e,t.position),l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,-1,0,t.yAxis),l.MathUtils.newVector3(0,0,-1,t.zAxis),t}}(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.quadTreeSubdivisionScheme=void 0;t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TileKey=void 0;const r=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class i{constructor(e,t,n){this.row=e,this.column=t,this.level=n}static fromRowColumnLevel(e,t,n){return new i(e,t,n)}static fromQuadKey(e){const t=e.length;let n=0,r=0;for(let i=0;i<e.length;++i){const o=1<<i,s=parseInt(e.charAt(t-i-1),10);1&s&&(r|=o),2&s&&(n|=o)}return i.fromRowColumnLevel(n,r,t)}static fromMortonCode(e){let t=0,n=0,r=0,o=e;for(;o>1;){const e=1<<t;1&o&&(r|=e),2&o&&(n|=e),t++,o=(o-(3&o))/4}const s=i.fromRowColumnLevel(n,r,t);return s.m_mortonCode=e,s}static fromHereTile(e){const t=i.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,n,r,o){return i.fromRowColumnLevel(Math.floor(n/(o/i.rowsAtLevel(e))),Math.floor(t/(r/i.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}parent(){if(0===this.level)throw new Error(\"Cannot get the parent of the root tile key\");return i.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let n=this.row,r=this.column;return e>=0?(n<<=e,r<<=e):(n>>>=-e,r>>>=-e),i.fromRowColumnLevel(n,r,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,n=r[this.level<<1];for(let i=0;i<this.level;++i)1&e&&(n+=r[2*i]),1&t&&(n+=r[2*i+1]),e>>>=1,t>>>=1;this.m_mortonCode=n}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e=\"\";for(let t=this.level;t>0;--t){const n=1<<t-1,r=0!=(this.column&n),i=0!=(this.row&n);e+=r&&i?\"3\":i?\"2\":r?\"1\":\"0\"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=i.fromQuadKey(0===e.length?\"-\":e),n=this.changedLevelBy(t.level);return i.fromRowColumnLevel(n.row+t.row,n.column+t.column,n.level)}addedSubHereTile(e){const t=i.fromHereTile(e),n=this.changedLevelBy(t.level);return i.fromRowColumnLevel(n.row+t.row,n.column+t.column,n.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return i.rowsAtLevel(this.level)}columnCount(){return i.columnsAtLevel(this.level)}}t.TileKey=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerService=void 0;const r=n(5),i=n(2).LoggerManager.instance.create(\"WorkerService\",{enabled:!0});t.WorkerService=class{constructor(e){this.serviceId=e,this.m_pendingRequests=new Map,this.onMessage=e=>{if(\"string\"==typeof e.data.service&&e.data.service===this.serviceId)try{if(r.WorkerServiceProtocol.isRequestMessage(e.data)){const t=e.data,n={service:t.service,messageId:t.messageId,responseSent:!1};this.m_pendingRequests.set(t.messageId,n),this.tryHandleRequest(t.request).then(e=>{this.doSendResponse(n,{service:this.serviceId,type:r.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,response:e.response},e.transferList)}).catch(e=>{this.doSendResponse(n,{service:this.serviceId,type:r.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,errorMessage:e.toString(),errorStack:e.stack})})}else this.tryHandleMessage(e.data)}catch(t){i.error(`[${this.serviceId}]: Unhandled exception when handling ${e.type}`)}},self.addEventListener(\"message\",this.onMessage);const t={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Initialized};self.postMessage(t)}destroy(){this.cancelAllPendingRequests(),self.removeEventListener(\"message\",this.onMessage)}handleMessage(e){i.error(`[${this.serviceId}]: Invalid message ${e.type}`)}handleRequest(e){throw new Error(`ServiceAdapter[${this.serviceId}]: Invalid request '${e.type}'`)}tryHandleMessage(e){try{this.handleMessage(e)}catch(t){i.error(`[${this.serviceId}]: Failed, handling message ${e.type}`)}}tryHandleRequest(e){try{return this.handleRequest(e)}catch(e){return i.error(`[${this.serviceId}]: Failure`,e),Promise.reject(e)}}doSendResponse(e,t,n){e.responseSent||(void 0!==n?self.postMessage(t,n):self.postMessage(t),e.responseSent=!0,this.m_pendingRequests.delete(e.messageId))}cancelAllPendingRequests(){this.m_pendingRequests.forEach(e=>{this.doSendResponse(e,{service:this.serviceId,type:r.WorkerServiceProtocol.ServiceMessageName.Response,messageId:e.messageId,errorMessage:\"cancelled\"})})}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.webMercatorTile2TargetTile=t.webMercatorTile2TargetWorld=t.world2tile=t.tile2world=t.createWorldTileTransformationCookie=t.tile2lat=t.lat2tile=t.isArrayBufferLike=void 0;const r=n(3),i=n(0);function o(e,t){return Math.round((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}function s(e,t){const{north:n,west:r}=t.geoBox,i=Math.log2(e),s=Math.pow(2,t.tileKey.level+i);return{extents:e,scale:s,top:o(n,t.tileKey.level+i),left:Math.round((r+180)/360*s)}}function a(e,t,n,i=!1,o){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=s(e,t));const{top:a,left:l,scale:c}=t.worldTileProjectionCookie,u=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return o.x=(l+n.x)/c*u,o.y=(a+(i?-n.y:n.y))/c*u,o.z=r.isVector3Like(n)?n.z:0,o}function l(e,t,n,o,s,l=!1){a(e,t,n,l,o),t.targetProjection.reprojectPoint(r.webMercatorProjection,o,o),n instanceof i.Vector3&&s&&(o.z*=t.targetProjection.getScaleFactor(o))}t.isArrayBufferLike=function(e){return\"undefined\"!=typeof SharedArrayBuffer?e instanceof ArrayBuffer||e instanceof SharedArrayBuffer:e instanceof ArrayBuffer},t.lat2tile=o,t.tile2lat=function(e,t){const n=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))},t.createWorldTileTransformationCookie=s,t.tile2world=a,t.world2tile=function(e,t,n,i=!1,o){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=s(e,t));const{top:a,left:l,scale:c}=t.worldTileProjectionCookie,u=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return o.x=Math.round(n.x/u*c-l),o.y=Math.round((i?-1:1)*(n.y/u*c-a)),r.isVector3Like(o)&&(o.z=n.z),o},t.webMercatorTile2TargetWorld=l,t.webMercatorTile2TargetTile=function(e,t,n,r,i,o=!1){l(e,t,n,r,i,o),r.sub(t.center)}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.LoggerOptions=t.LogLevel=void 0,function(e){e[e.Trace=0]=\"Trace\",e[e.Debug=1]=\"Debug\",e[e.Log=2]=\"Log\",e[e.Info=3]=\"Info\",e[e.Warn=4]=\"Warn\",e[e.Error=5]=\"Error\",e[e.None=6]=\"None\"}(t.LogLevel||(t.LogLevel={}));t.LoggerOptions=class{}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.getUrlHostAndProtocol=t.getUrlOrigin=t.baseUrl=t.resolveReferenceUri=void 0,t.resolveReferenceUri=function(e,t){if(r.test(t))return t;if(t.startsWith(\"/\")){return o(e)+t}return t.startsWith(\"./\")&&(t=t.substr(2)),i(e)+t};const r=new RegExp(\"^(((?:[a-z]+:)?//)|(file:/)|(data:))\",\"i\");function i(e){if(void 0===e)return\"./\";let t=e.indexOf(\"#\");return-1!==t&&(e=e.slice(0,t)),t=e.indexOf(\"?\"),-1!==t&&(e=e.slice(0,t)),t=e.lastIndexOf(\"/\"),-1===t?\"./\":e.substring(0,t+1)}function o(e){if(void 0===e)return\"\";const t=s(e);return\"file:\"===t.protocol?\"file://\":t.host&&t.protocol?t.protocol+\"//\"+t.host:t.host?\"//\"+t.host:t.protocol?t.protocol+\"//\":\"\"}function s(e){const t=new RegExp(/^(?:([a-z]+:))?\\/\\/([^\\/]*)/,\"i\"),n=e.match(t);if(!n)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:n[1],host:n[2]}}t.baseUrl=i,t.getUrlOrigin=o,t.getUrlHostAndProtocol=s},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.Pixels=void 0;const r=/^((?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))px$/;class i{constructor(e){this.value=e}static parse(e){const t=r.exec(e);if(null!==t)return new i(Number(t[1]))}toJSON(){return this.value+\"px\"}}t.Pixels=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.interpolatedPropertyDefinitionToJsonExpr=t.isInterpolatedPropertyDefinition=t.InterpolationMode=void 0,function(e){e[e.Discrete=0]=\"Discrete\",e[e.Linear=1]=\"Linear\",e[e.Cubic=2]=\"Cubic\",e[e.Exponential=3]=\"Exponential\"}(t.InterpolationMode||(t.InterpolationMode={})),t.isInterpolatedPropertyDefinition=function(e){return!!(e&&void 0===e.interpolationMode&&Array.isArray(e.values)&&e.values.length>0&&void 0!==e.values[0]&&Array.isArray(e.zoomLevels)&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length)},t.interpolatedPropertyDefinitionToJsonExpr=function(e){if(void 0===e.interpolation||\"Discrete\"===e.interpolation){const t=[\"step\",[\"zoom\"],e.values[0]];for(let n=1;n<e.zoomLevels.length;++n)t.push(e.zoomLevels[n],e.values[n]);return t}const t=[\"interpolate\"];switch(e.interpolation){case\"Linear\":t.push([\"linear\"]);break;case\"Cubic\":t.push([\"cubic\"]);break;case\"Exponential\":t.push([\"exponential\",void 0!==e.exponent?e.exponent:2]);break;default:throw new Error(`interpolation mode '${e.interpolation}' is not supported`)}t.push([\"zoom\"]);for(let n=0;n<e.zoomLevels.length;++n)t.push(e.zoomLevels[n],e.values[n]);return t}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.setTechniqueRenderOrderOrPriority=t.composeTechniqueTextureName=t.addBuffersToTransferList=t.textureCoordinateType=t.supportsTextures=t.needsVertexNormals=t.isLabelRejectionLineTechnique=t.isShaderTechnique=t.isTextTechnique=t.isTerrainTechnique=t.isStandardTechnique=t.isExtrudedPolygonTechnique=t.isFillTechnique=t.isStandardExtrudedLineTechnique=t.isBasicExtrudedLineTechnique=t.isExtrudedLineTechnique=t.isSegmentsTechnique=t.isSpecialDashesLineTechnique=t.isSolidLineTechnique=t.isLineTechnique=t.isLineMarkerTechnique=t.isPoiTechnique=t.isSquaresTechnique=t.isCirclesTechnique=t.TRANSPARENCY_PROPERTY_KEYS=t.TEXTURE_PROPERTY_KEYS=void 0;const r=n(37);function i(e){return\"labeled-icon\"===e.name}function o(e){return\"line-marker\"===e.name}function s(e){return\"extruded-line\"===e.name}function a(e){return s(e)&&\"standard\"===e.shading}function l(e){return\"fill\"===e.name}function c(e){return\"extruded-polygon\"===e.name}function u(e){return\"standard\"===e.name}function h(e){return\"terrain\"===e.name}function d(e){return\"text\"===e.name}function p(e){return\"shader\"===e.name}function f(e){return l(e)||u(e)||c(e)||h(e)}t.TEXTURE_PROPERTY_KEYS=[\"map\",\"normalMap\",\"displacementMap\",\"roughnessMap\",\"emissiveMap\",\"alphaMap\",\"metalnessMap\",\"bumpMap\"],t.TRANSPARENCY_PROPERTY_KEYS=[\"opacity\",\"transparent\"],t.isCirclesTechnique=function(e){return\"circles\"===e.name},t.isSquaresTechnique=function(e){return\"squares\"===e.name},t.isPoiTechnique=i,t.isLineMarkerTechnique=o,t.isLineTechnique=function(e){return\"line\"===e.name},t.isSolidLineTechnique=function(e){return\"solid-line\"===e.name||\"dashed-line\"===e.name},t.isSpecialDashesLineTechnique=function(e){return(\"solid-line\"===e.name||\"dashed-line\"===e.name)&&void 0!==e.dashes&&\"Square\"!==e.dashes},t.isSegmentsTechnique=function(e){return\"segments\"===e.name},t.isExtrudedLineTechnique=s,t.isBasicExtrudedLineTechnique=function(e){return s(e)&&\"basic\"===e.shading},t.isStandardExtrudedLineTechnique=a,t.isFillTechnique=l,t.isExtrudedPolygonTechnique=c,t.isStandardTechnique=u,t.isTerrainTechnique=h,t.isTextTechnique=d,t.isShaderTechnique=p,t.isLabelRejectionLineTechnique=function(e){return\"label-rejection-line\"===e.name},t.needsVertexNormals=function(e){return c(e)||l(e)||u(e)||h(e)||a(e)},t.supportsTextures=f,t.textureCoordinateType=function(e){return f(e)||p(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,n){if(u(e)||c(e)||h(e))for(const i of t.TEXTURE_PROPERTY_KEYS){const t=e[i];r.isTextureBuffer(t)&&t.buffer instanceof ArrayBuffer&&n.push(t.buffer)}},t.composeTechniqueTextureName=function(e,t){let n=e;return\"string\"==typeof t.imageTexturePrefix&&(n=t.imageTexturePrefix+n),\"string\"==typeof t.imageTexturePostfix&&(n+=t.imageTexturePostfix),n},t.setTechniqueRenderOrderOrPriority=function(e,t,n){if(d(e)||i(e)||o(e)){if(n&&\"string\"==typeof e._category){const t=n.indexOf(e._category);-1!==t&&(e.priority=n.length-t)}}else if(t&&void 0!==e._styleSet){const n=n=>{const r=null==t?void 0:t.findIndex(t=>t.group===e._styleSet&&t.category===n);return void 0!==r&&-1!==r?10*(r+1):void 0};if(\"string\"==typeof e._category){const t=n(e._category);void 0!==t&&(e.renderOrder=t)}if(\"string\"==typeof e._secondaryCategory){const t=n(e._secondaryCategory);void 0!==t&&(e.secondaryRenderOrder=t)}}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isGeoPointLike=void 0,t.isGeoPointLike=function(e){if(Array.isArray(e)){const[t,n,r]=e;return\"number\"==typeof t&&\"number\"==typeof n&&(void 0===r||\"number\"==typeof r)}return!1}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isLatLngLike=void 0,t.isLatLngLike=function(e){return e&&\"number\"==typeof e.lat&&\"number\"==typeof e.lng}},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),i(n(125),t),i(n(128),t),i(n(129),t),i(n(1),t),i(n(130),t),i(n(49),t)},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),i(n(58),t),i(n(170),t),i(n(15),t),i(n(171),t)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ConsoleChannel=void 0;t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.Logger=void 0;const r=n(25);t.Logger=class{constructor(e,t,n){this.name=e,this.m_channel=t,this.enabled=!0,this.level=r.LogLevel.Trace,void 0!==n&&this.update(n)}error(e,...t){this.enabled&&this.level<=r.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=r.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=r.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=r.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=r.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=r.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+\":\"}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerChannel=t.WORKERCHANNEL_MSG_TYPE=void 0;const r=n(25);t.WORKERCHANNEL_MSG_TYPE=\"worker-channel-message\";t.WorkerChannel=class{error(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Error};self.postMessage(i)}debug(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Debug};self.postMessage(i)}info(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Info};self.postMessage(i)}log(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Log};self.postMessage(i)}trace(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Trace};self.postMessage(i)}warn(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Warn};self.postMessage(i)}}},function(e,t,n){\"use strict\";var r,i;Object.defineProperty(t,\"__esModule\",{value:!0}),t.isTextureBuffer=t.PlacementToken=t.transientToPickability=t.Pickability=t.PoiStackMode=t.TextureCoordinateType=t.GeometryKindSet=t.GeometryKind=t.StandardGeometryKind=void 0,function(e){e.All=\"_all_\",e.Background=\"background\",e.Terrain=\"terrain\",e.Area=\"area\",e.Line=\"line\",e.Water=\"water\",e.Border=\"border\",e.Road=\"road\",e.Building=\"building\",e.Label=\"label\",e.Detail=\"detail\"}(r=t.StandardGeometryKind||(t.StandardGeometryKind={})),t.GeometryKind=r;class o extends Set{isSuperset(e){for(const t of e)if(!this.has(t))return!1;return!0}hasIntersection(e){for(const t of e)if(this.has(t))return!0;return!1}hasOrIntersects(e){return e instanceof Set?this.hasIntersection(e):this.has(e)}hasOrIntersectsArray(e){for(const t of e)if(this.has(t))return!0;return!1}}t.GeometryKindSet=o,function(e){e.TileSpace=\"tile-space\",e.EquirectangularSpace=\"equirectangular-space\",e.FeatureSpace=\"feature-space\"}(t.TextureCoordinateType||(t.TextureCoordinateType={})),function(e){e.Show=\"show-in-stack\",e.Hide=\"hide-in-stack\",e.ShowParent=\"show-parent\"}(t.PoiStackMode||(t.PoiStackMode={})),function(e){e.onlyVisible=\"only-visible\",e.transient=\"transient\",e.all=\"all\"}(i=t.Pickability||(t.Pickability={})),t.transientToPickability=function(e){let t=i.onlyVisible;return null!=e&&(t=\"string\"==typeof e?e:!0===e?i.transient:i.onlyVisible),t},function(e){e.TopLeft=\"TL\",e.Top=\"T\",e.TopRight=\"TR\",e.Right=\"R\",e.BottomRight=\"BR\",e.Bottom=\"B\",e.BottomLeft=\"BL\",e.Left=\"L\",e.Center=\"C\",e.NorthWest=\"NW\",e.North=\"N\",e.NorthEast=\"NE\",e.East=\"E\",e.SouthEast=\"SE\",e.South=\"S\",e.SouthWest=\"SW\",e.West=\"W\"}(t.PlacementToken||(t.PlacementToken={})),t.isTextureBuffer=function(e){return e&&e.buffer&&\"string\"==typeof e.type}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.getPropertyValue=void 0;const r=n(2),i=n(1),o=n(27),s=n(17),a=n(18),l=r.LoggerManager.instance.create(\"PropertyValue\");t.getPropertyValue=function(e,t,n){var r,c,u;if(i.Expr.isExpr(e))try{let a=e.evaluate(t,i.ExprScope.Dynamic,n);return\"string\"==typeof a&&(a=null!==(c=null!==(r=s.RGBA.parse(a))&&void 0!==r?r:o.Pixels.parse(a))&&void 0!==c?c:a),a instanceof s.RGBA?a.getHex():a instanceof o.Pixels?a.value*(null!==(u=Number(t.lookup(\"$pixelToMeters\")))&&void 0!==u?u:1):a}catch(t){return l.error(\"failed to evaluate expression\",JSON.stringify(e),\"error\",String(t)),null}if(null==e)return null;if(\"string\"!=typeof e)return e;{const n=t.lookup(\"$pixelToMeters\")||1,r=a.parseStringEncodedNumeral(e,n);return void 0!==r?r:e}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.scaleHeight=t.getFeatureText=t.getFeatureName=t.getFeatureId=t.getProjectionName=t.getProjection=t.GeometryType=t.getArrayConstructor=void 0;const r=n(3),i=n(1),o=n(48),s=n(29);function a(e,t,n,r,i){var o;let s;if(void 0===t&&(t=\"name\"),n){const n=e.lookup(t+\":short\");if(\"string\"==typeof n&&n.length>0)return n}if(r){const t=e.lookup(\"iso_code\");if(\"string\"==typeof t&&t.length>0)return t}if(void 0!==i)for(const n of i)if(s=null!==(o=e.lookup(`${t}:${n}`))&&void 0!==o?o:e.lookup(`${t}_${n}`),\"string\"==typeof s&&s.length>0)return s;if(s=e.lookup(t),\"string\"==typeof s)return s}t.getArrayConstructor=function(e){switch(e){case\"float\":return Float32Array;case\"uint8\":return Uint8Array;case\"uint16\":return Uint16Array;case\"uint32\":return Uint32Array;case\"int8\":return Int8Array;case\"int16\":return Int16Array;case\"int32\":return Int32Array}},function(e){e[e.Unspecified=0]=\"Unspecified\",e[e.Point=1]=\"Point\",e[e.Line=2]=\"Line\",e[e.SolidLine=3]=\"SolidLine\",e[e.Text=4]=\"Text\",e[e.TextPath=5]=\"TextPath\",e[e.ExtrudedLine=6]=\"ExtrudedLine\",e[e.Polygon=7]=\"Polygon\",e[e.ExtrudedPolygon=8]=\"ExtrudedPolygon\",e[e.Object3D=9]=\"Object3D\",e[e.Other=1e3]=\"Other\"}(t.GeometryType||(t.GeometryType={})),t.getProjection=function(e){switch(e){case\"mercator\":return r.mercatorProjection;case\"webMercator\":return r.webMercatorProjection;case\"sphere\":return r.sphereProjection;case\"normalizedEquirectangular\":return r.normalizedEquirectangularProjection;case\"equirectangular\":return r.equirectangularProjection;default:throw new Error(\"Unknown projection \"+e)}},t.getProjectionName=function(e){if(e===r.mercatorProjection)return\"mercator\";if(e===r.webMercatorProjection)return\"webMercator\";if(e===r.sphereProjection)return\"sphere\";if(e===r.normalizedEquirectangularProjection)return\"normalizedEquirectangular\";if(e===r.equirectangularProjection)return\"equirectangular\";throw new Error(\"Unknown projection\")},t.getFeatureId=function(e){if(void 0===e)return 0;if(\"string\"==typeof e||\"number\"==typeof e)return e;if(e.hasOwnProperty(\"$id\")){const t=e.$id;if(\"string\"==typeof t||\"number\"==typeof t)return t}return 0},t.getFeatureName=a,t.getFeatureText=function(e,t,n){let r,l;const c=e instanceof i.Env?e:e.env;let u=\"name\";if(s.isTextTechnique(t)||s.isPoiTechnique(t)||s.isLineMarkerTechnique(t)){if(void 0!==t.text)return o.evaluateTechniqueAttr(e,t.text);if(void 0!==t.label&&(u=o.evaluateTechniqueAttr(e,t.label),\"string\"!=typeof u))return;r=t.useAbbreviation,l=t.useIsoCode}return a(c,u,r,l,n)},t.scaleHeight=function(e,t,n){return!o.evaluateTechniqueAttr(e,t.constantHeight,n<12)}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isGeoCoordLike=t.geoCoordLikeToGeoPointLike=t.geoCoordLikeToGeoCoordinatesLike=void 0;const r=n(9),i=n(30),o=n(31);t.geoCoordLikeToGeoCoordinatesLike=function(e){return r.isGeoCoordinatesLike(e)?e:o.isLatLngLike(e)?{latitude:e.lat,longitude:e.lng}:{latitude:e[1],longitude:e[0]}},t.geoCoordLikeToGeoPointLike=function(e){return i.isGeoPointLike(e)?e:o.isLatLngLike(e)?[e.lng,e.lat]:[e.longitude,e.latitude]},t.isGeoCoordLike=function(e){return r.isGeoCoordinatesLike(e)||o.isLatLngLike(e)||!i.isGeoPointLike(e)}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.equirectangularProjection=t.normalizedEquirectangularProjection=void 0;const r=n(0),i=n(8),o=n(4),s=n(10),a=n(6),l=n(11),c=n(13),u=n(12);class h extends u.Projection{constructor(){super(...arguments),this.type=u.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,n){return n||(n=new r.Box3),n.min.x=0,n.min.y=0,n.min.z=e,n.max.x=this.unitScale,n.max.y=this.unitScale/2,n.max.z=t,n}projectPoint(e,t){var n;return void 0===t&&(t={x:0,y:0,z:0}),t.x=(r.MathUtils.degToRad(e.longitude)+Math.PI)*h.geoToWorldScale*this.unitScale,t.y=(r.MathUtils.degToRad(e.latitude)+.5*Math.PI)*h.geoToWorldScale*this.unitScale,t.z=null!==(n=e.altitude)&&void 0!==n?n:0,t}unprojectPoint(e){return o.GeoCoordinates.fromRadians(e.y*h.worldToGeoScale/this.unitScale-.5*Math.PI,e.x*h.worldToGeoScale/this.unitScale-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const n=this.projectPoint(new o.GeoCoordinates(e.center.latitude,e.center.longitude,0)),{latitudeSpanInRadians:i,longitudeSpanInRadians:c,altitudeSpan:u}=e,d=c*h.geoToWorldScale,p=i*h.geoToWorldScale;return t||(t=new r.Box3),s.isBox3Like(t)?(t.min.x=n.x-.5*d*this.unitScale,t.min.y=n.y-.5*p*this.unitScale,t.max.x=n.x+.5*d*this.unitScale,t.max.y=n.y+.5*p*this.unitScale,void 0!==u?(t.min.z=n.z-.5*u,t.max.z=n.z+.5*u):(t.min.z=0,t.max.z=0)):l.isOrientedBox3Like(t)&&(a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=n.x,t.position.y=n.y,t.position.z=n.z,t.extents.x=.5*d*this.unitScale,t.extents.y=.5*p*this.unitScale,t.extents.z=Math.max(Number.EPSILON,.5*(null!=u?u:0))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return i.GeoBox.fromCoordinates(t,n)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}h.geoToWorldScale=1/(2*Math.PI),h.worldToGeoScale=2*Math.PI/1,t.normalizedEquirectangularProjection=new h(1),t.equirectangularProjection=new h(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.transverseMercatorProjection=t.TransverseMercatorUtils=void 0;const r=n(0),i=n(8),o=n(4),s=n(10),a=n(6),l=n(11),c=n(13),u=n(12);class h extends u.Projection{constructor(e){super(e),this.unitScale=e,this.type=u.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}static clampGeoPoint(e,t){const n=e.latitude,r=e.longitude,i=d.POLE_RADIUS,s=d.POLE_RADIUS_SQ,a=Math.round(r/90),l=90*a-r;if(a%2==0||Math.abs(l)>i)return e;const c=n-0,u=l*l+c*c;if(u<s){const e=Math.sqrt(u),t=(i-e)/e,s=1,a=0===l&&0===c?i*s:l;return new o.GeoCoordinates(n+c*t,r+a*t)}return e}getScaleFactor(e){return Math.cosh(2*(e.x/this.unitScale-.5)*Math.PI)}worldExtent(e,t,n){return n||(n=new r.Box3),n.min.x=0,n.min.y=0,n.min.z=e,n.max.x=this.unitScale,n.max.y=this.unitScale,n.max.z=t,n}projectPoint(e,t){var n;t||(t={x:0,y:0,z:0});const i=h.clampGeoPoint(e,this.unitScale),o=i.longitude/360+.5,s=1===o?0:Math.floor(o),a=r.MathUtils.degToRad(i.latitude),l=r.MathUtils.degToRad(i.longitude-360*s)-this.m_lambda0,c=Math.cos(a)*Math.sin(l);t.x=Math.atanh(c),t.y=Math.atan2(Math.tan(a),Math.cos(l))-this.m_phi0;const u=.5/Math.PI;return t.x=this.unitScale*(r.MathUtils.clamp(t.x*u+.5,0,1)+s),t.y=this.unitScale*r.MathUtils.clamp(t.y*u+.5,0,1),t.z=null!==(n=e.altitude)&&void 0!==n?n:0,t}unprojectPoint(e){const t=2*Math.PI,n=e.x/this.unitScale,r=e.y/this.unitScale,i=1===n?0:Math.floor(n),s=t*(n-.5-i),a=t*(r-.5),l=e.z||0,c=a+this.m_phi0,u=Math.asin(Math.sin(c)/Math.cosh(s)),h=this.m_lambda0+Math.atan2(Math.sinh(s),Math.cos(c))+i*t;return o.GeoCoordinates.fromRadians(u,h,l)}projectBox(e,t){const{north:n,south:i,east:c,west:u}=e,h=[e.center,e.northEast,e.southWest,new o.GeoCoordinates(i,c),new o.GeoCoordinates(n,u)],p=d.POLE_EDGE_DEG,f=u<90&&c>90,m=u<0&&c>0,g=u<p&&c>-p&&n>0&&i<0;u<-90&&c>-90&&(h.push(new o.GeoCoordinates(n,-90)),h.push(new o.GeoCoordinates(i,-90))),f&&(h.push(new o.GeoCoordinates(n,90)),h.push(new o.GeoCoordinates(i,90))),m&&(h.push(new o.GeoCoordinates(n,0)),h.push(new o.GeoCoordinates(i,0))),g&&(h.push(new o.GeoCoordinates(0,u)),h.push(new o.GeoCoordinates(0,c))),d.alignLatitude(h,h[0]);const v=h.map(e=>this.projectPoint(e)),y=v.map(e=>e.x),x=v.map(e=>e.y),_=v.map(e=>e.z),b=Math.min(...y),w=Math.min(...x),M=Math.min(..._),S=Math.max(...y),T=Math.max(...x),E=Math.max(..._);if(t||(t=new r.Box3),s.isBox3Like(t))t.min.x=b,t.min.y=w,t.min.z=M,t.max.x=S,t.max.y=T,t.max.z=E;else{if(!l.isOrientedBox3Like(t))throw new Error(\"invalid bounding box\");a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=(b+S)/2,t.position.y=(w+T)/2,t.position.z=(M+E)/2,t.extents.x=(S-b)/2,t.extents.y=(T-w)/2,t.extents.z=(E-M)/2}return t}unprojectBox(e){const t=this.unitScale,n=e.min,r=e.max,s=[{x:(n.x+r.x)/2,y:(n.y+r.y)/2,z:0},n,r,{x:n.x,y:r.y,z:0},{x:r.x,y:n.y,z:0}],a=.5*t,l=.25*t,c=.75*t,u=n.x<a&&r.x>a,h=n.y<a&&r.y>a,p=n.y<l&&r.y>l,f=n.y<c&&r.y>c;h&&(s.push({x:n.x,y:a,z:0}),s.push({x:r.x,y:a,z:0}),u&&s.push({x:a,y:a,z:0})),p&&(s.push({x:n.x,y:l,z:0}),s.push({x:r.x,y:l,z:0}),u&&s.push({x:a,y:l,z:0})),f&&(s.push({x:n.x,y:c,z:0}),s.push({x:r.x,y:c,z:0}),u&&s.push({x:a,y:c,z:0}));const m=s.map(e=>this.unprojectPoint(e));d.alignLongitude(m,m[0]);const g=m.map(e=>e.latitude),v=m.filter(e=>Math.abs(e.latitude)<90).map(e=>e.longitude),y=m.map(e=>{var t;return null!==(t=e.altitude)&&void 0!==t?t:0}),x=new o.GeoCoordinates(Math.min(...g),Math.min(...v),Math.min(...y)),_=new o.GeoCoordinates(Math.max(...g),Math.max(...v),Math.max(...y));return i.GeoBox.fromCoordinates(x,_)}unprojectAltitude(e){return e.z}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}}class d{static alignLatitude(e,t){for(const n of e)0===n.latitude&&(n.latitude=1e-9*t.latitude)}static alignLongitude(e,t){const n=t.longitude<0?180:-180,r=t.longitude<0?-180:180;for(const t of e)t.longitude===n&&(t.longitude=r)}}t.TransverseMercatorUtils=d,d.POLE_EDGE=1.4844222297453322,d.POLE_EDGE_DEG=r.MathUtils.radToDeg(d.POLE_EDGE),d.POLE_RADIUS=90-d.POLE_EDGE_DEG,d.POLE_RADIUS_SQ=Math.pow(d.POLE_RADIUS,2),t.transverseMercatorProjection=new h(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.FlatTileBoundingBoxGenerator=void 0;const r=n(0);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,n=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=n,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,n);const{min:r,max:i}=this.m_worldBox;this.m_worldDimensions={x:i.x-r.x,y:i.y-r.y,z:i.z-r.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const n=e.level,i=this.subdivisionScheme.getLevelDimensionX(n),o=this.subdivisionScheme.getLevelDimensionY(n),s=this.m_worldDimensions.x/i,a=this.m_worldDimensions.y/o,l=this.m_worldBox.min.x+s*e.column,c=this.m_worldBox.min.y+a*e.row;return t||(t=new r.Box3),t.min.x=l,t.min.y=c,t.min.z=this.m_worldBox.min.z,t.max.x=l+s,t.max.y=c+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.halfQuadTreeSubdivisionScheme=void 0;t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.SubTiles=void 0;const r=n(22);class i{constructor(e,t,n){this.tileKey=e,this.sizeX=t,this.sizeY=n}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?i.ZCurveIterator(this.tileKey):i.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}t.SubTiles=i,function(e){e.RowColumnIterator=function*(e,t,n){for(let i=0;i<n;i++)for(let o=0;o<t;o++)yield r.TileKey.fromRowColumnLevel(e.row*n+i,e.column*t+o,e.level+1)},e.ZCurveIterator=function*(e){for(let t=0;t<4;t++)yield r.TileKey.fromRowColumnLevel(e.row<<1|t>>1,e.column<<1|1&t,e.level+1)}}(i=t.SubTiles||(t.SubTiles={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TileKeyUtils=t.powerOfTwo=void 0;const r=n(4),i=n(22);t.powerOfTwo=(()=>{let e=.5;return new Array(53).fill(0).map(()=>e*=2)})(),function(e){function n(e,t,n){const r=e.projection,o=e.subdivisionScheme,s=o.getLevelDimensionX(n),a=o.getLevelDimensionY(n),{min:l,max:c}=r.worldExtent(0,0),u=c.x-l.x,h=c.y-l.y;if(t.x<l.x||t.x>c.x)return null;if(t.y<l.y||t.y>c.y)return null;const d=Math.min(s-1,Math.floor(s*(t.x-l.x)/u)),p=Math.min(a-1,Math.floor(a*(t.y-l.y)/h));return i.TileKey.fromRowColumnLevel(p,d,n)}function o(e,n,r=4){const i=function(e,n=4){let r=0;const i=t.powerOfTwo[n];e+=i/2;for(;e<0;)e+=i;for(;e>=i;)e-=i;for(let i=0;i<n&&e>0;i++)1&e&&(r+=t.powerOfTwo[53-n+i]),e>>>=1;return r}(n,r);return e.mortonCode()+i}function s(e,n=4){let r=0,i=e,o=0;for(;o<n;o++){const e=t.powerOfTwo[52-o];i>=e&&(i-=e,r+=t.powerOfTwo[n-1-o])}return r-=t.powerOfTwo[n-1],{offset:r,mortonCode:i}}e.geoCoordinatesToTileKey=function(e,t,r){return n(e,e.projection.projectPoint(t),r)},e.worldCoordinatesToTileKey=n,e.geoRectangleToTileKeys=function(t,n,o){const s=(e,t,n)=>e<t?n-(t-e)%(n-t):t+(e-t)%(n-t),a=(e,t,n)=>Math.min(Math.max(e,t),n),l=s(n.southWest.longitudeInRadians,-Math.PI,Math.PI),c=a(n.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),u=s(n.northEast.longitudeInRadians,-Math.PI,Math.PI),h=a(n.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),d=e.geoCoordinatesToTileKey(t,r.GeoCoordinates.fromRadians(c,l),o),p=e.geoCoordinatesToTileKey(t,r.GeoCoordinates.fromRadians(h,u),o),f=t.subdivisionScheme.getLevelDimensionX(o);if(!d||!p)throw new Error(\"Invalid coordinates\");const m=d.column;let g=p.column;l>u&&(g+=g!==m?f:f-1);const v=Math.min(d.row,p.row),y=Math.max(d.row,p.row),x=new Array;for(let e=v;e<=y;++e)for(let t=m;t<=g;++t)x.push(i.TileKey.fromRowColumnLevel(e,t%f,o));return x},e.getKeyForTileKeyAndOffset=o,e.extractOffsetAndMortonKeyFromKey=s,e.getParentKeyFromKey=function(e,t=4){const{offset:n,mortonCode:r}=s(e,t);return o(i.TileKey.fromMortonCode(i.TileKey.parentMortonCode(r)),n,t)}}(t.TileKeyUtils||(t.TileKeyUtils={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TileTreeTraverse=void 0;const r=n(45);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=this.m_subdivisionScheme.getSubdivisionX(e.level),n=this.m_subdivisionScheme.getSubdivisionY(e.level);return new r.SubTiles(e,t,n)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.evaluateTechniqueAttr=void 0;const r=n(1),i=n(38);t.evaluateTechniqueAttr=function(e,t,n){if(void 0===t)return n;const o=r.Env.isEnv(e)?i.getPropertyValue(t,e):i.getPropertyValue(t,e.env,e.cachedExprResults);return null!=o?o:n}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isFeatureGeometry=void 0,t.isFeatureGeometry=function(e){const t=e.type;return\"Point\"===t||\"MultiPoint\"===t||\"LineString\"===t||\"MultiLineString\"===t||\"Polygon\"===t||\"MultiPolygon\"===t}},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),i(n(131),t),i(n(132),t),i(n(133),t),i(n(23),t),i(n(134),t),i(n(51),t)},function(e,t,n){\"use strict\";var r;Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoJsonTiler=void 0;const i=n(5),o=n(172),s=null!==(r=o.default)&&void 0!==r?r:o,a=-(-2&-Math.ceil(204.8));t.GeoJsonTiler=class{constructor(){this.indexes=new Map}dispose(){}async connect(){return await Promise.resolve()}async registerIndex(e,t){if(!this.indexes.has(e))return await this.updateIndex(e,t)}async updateIndex(e,t){if(t instanceof URL){const e=await fetch(t.href);if(!e.ok)throw new Error(`GeoJsonTiler: Unable to fetch ${t.href}: ${e.statusText}`);t=await e.json()}else t=t;const n=i.isFeatureGeometry(t)||\"GeometryCollection\"===t.type||\"Feature\"===t.type&&void 0===t.id||\"FeatureCollection\"===t.type&&t.features.length>0&&void 0===t.features[0].id,r=s(t,{maxZoom:20,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:a,lineMetrics:!1,promoteId:null,generateId:n,debug:0});r.geojson=t,this.indexes.set(e,r)}async getTile(e,t){const n=this.indexes.get(e);if(void 0===n)throw new Error(\"Tile not found\");const r=n.getTile(t.level,t.column,t.row);return null!==r&&(r.layer=e),r||{}}}},function(e,t,n){\"use strict\";var r,i,o,s=n(144),a=s.Reader,l=s.util,c=s.roots.default||(s.roots.default={});c.com=((o={}).mapbox=((i={}).pb=((r={}).Tile=function(){function e(e){if(this.layers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n;return e.prototype.layers=l.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.com.mapbox.pb.Tile;e.pos<n;){var i=e.uint32();switch(i>>>3){case 3:r.layers&&r.layers.length||(r.layers=[]),r.layers.push(c.com.mapbox.pb.Tile.Layer.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile)return e;var t=new c.com.mapbox.pb.Tile;if(e.layers){if(!Array.isArray(e.layers))throw TypeError(\".com.mapbox.pb.Tile.layers: array expected\");t.layers=[];for(var n=0;n<e.layers.length;++n){if(\"object\"!=typeof e.layers[n])throw TypeError(\".com.mapbox.pb.Tile.layers: object expected\");t.layers[n]=c.com.mapbox.pb.Tile.Layer.fromObject(e.layers[n])}}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.layers=[]),e.layers&&e.layers.length){n.layers=[];for(var r=0;r<e.layers.length;++r)n.layers[r]=c.com.mapbox.pb.Tile.Layer.toObject(e.layers[r],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e.GeomType=(t={},(n=Object.create(t))[t[0]=\"UNKNOWN\"]=0,n[t[1]=\"POINT\"]=1,n[t[2]=\"LINESTRING\"]=2,n[t[3]=\"POLYGON\"]=3,n),e.Value=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.stringValue=\"\",e.prototype.floatValue=0,e.prototype.doubleValue=0,e.prototype.intValue=l.Long?l.Long.fromBits(0,0,!1):0,e.prototype.uintValue=l.Long?l.Long.fromBits(0,0,!0):0,e.prototype.sintValue=l.Long?l.Long.fromBits(0,0,!1):0,e.prototype.boolValue=!1,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.com.mapbox.pb.Tile.Value;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.stringValue=e.string();break;case 2:r.floatValue=e.float();break;case 3:r.doubleValue=e.double();break;case 4:r.intValue=e.int64();break;case 5:r.uintValue=e.uint64();break;case 6:r.sintValue=e.sint64();break;case 7:r.boolValue=e.bool();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Value)return e;var t=new c.com.mapbox.pb.Tile.Value;return null!=e.stringValue&&(t.stringValue=String(e.stringValue)),null!=e.floatValue&&(t.floatValue=Number(e.floatValue)),null!=e.doubleValue&&(t.doubleValue=Number(e.doubleValue)),null!=e.intValue&&(l.Long?(t.intValue=l.Long.fromValue(e.intValue)).unsigned=!1:\"string\"==typeof e.intValue?t.intValue=parseInt(e.intValue,10):\"number\"==typeof e.intValue?t.intValue=e.intValue:\"object\"==typeof e.intValue&&(t.intValue=new l.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber())),null!=e.uintValue&&(l.Long?(t.uintValue=l.Long.fromValue(e.uintValue)).unsigned=!0:\"string\"==typeof e.uintValue?t.uintValue=parseInt(e.uintValue,10):\"number\"==typeof e.uintValue?t.uintValue=e.uintValue:\"object\"==typeof e.uintValue&&(t.uintValue=new l.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),null!=e.sintValue&&(l.Long?(t.sintValue=l.Long.fromValue(e.sintValue)).unsigned=!1:\"string\"==typeof e.sintValue?t.sintValue=parseInt(e.sintValue,10):\"number\"==typeof e.sintValue?t.sintValue=e.sintValue:\"object\"==typeof e.sintValue&&(t.sintValue=new l.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber())),null!=e.boolValue&&(t.boolValue=Boolean(e.boolValue)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.stringValue=\"\",n.floatValue=0,n.doubleValue=0,l.Long){var r=new l.Long(0,0,!1);n.intValue=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.intValue=t.longs===String?\"0\":0;l.Long?(r=new l.Long(0,0,!0),n.uintValue=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.uintValue=t.longs===String?\"0\":0,l.Long?(r=new l.Long(0,0,!1),n.sintValue=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.sintValue=t.longs===String?\"0\":0,n.boolValue=!1}return null!=e.stringValue&&e.hasOwnProperty(\"stringValue\")&&(n.stringValue=e.stringValue),null!=e.floatValue&&e.hasOwnProperty(\"floatValue\")&&(n.floatValue=t.json&&!isFinite(e.floatValue)?String(e.floatValue):e.floatValue),null!=e.doubleValue&&e.hasOwnProperty(\"doubleValue\")&&(n.doubleValue=t.json&&!isFinite(e.doubleValue)?String(e.doubleValue):e.doubleValue),null!=e.intValue&&e.hasOwnProperty(\"intValue\")&&(\"number\"==typeof e.intValue?n.intValue=t.longs===String?String(e.intValue):e.intValue:n.intValue=t.longs===String?l.Long.prototype.toString.call(e.intValue):t.longs===Number?new l.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber():e.intValue),null!=e.uintValue&&e.hasOwnProperty(\"uintValue\")&&(\"number\"==typeof e.uintValue?n.uintValue=t.longs===String?String(e.uintValue):e.uintValue:n.uintValue=t.longs===String?l.Long.prototype.toString.call(e.uintValue):t.longs===Number?new l.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),null!=e.sintValue&&e.hasOwnProperty(\"sintValue\")&&(\"number\"==typeof e.sintValue?n.sintValue=t.longs===String?String(e.sintValue):e.sintValue:n.sintValue=t.longs===String?l.Long.prototype.toString.call(e.sintValue):t.longs===Number?new l.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber():e.sintValue),null!=e.boolValue&&e.hasOwnProperty(\"boolValue\")&&(n.boolValue=e.boolValue),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e.Feature=function(){function e(e){if(this.tags=[],this.geometry=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=l.Long?l.Long.fromBits(0,0,!0):0,e.prototype.tags=l.emptyArray,e.prototype.type=0,e.prototype.geometry=l.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.com.mapbox.pb.Tile.Feature;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=e.uint64();break;case 2:if(r.tags&&r.tags.length||(r.tags=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.tags.push(e.uint32());else r.tags.push(e.uint32());break;case 3:r.type=e.int32();break;case 4:if(r.geometry&&r.geometry.length||(r.geometry=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.geometry.push(e.uint32());else r.geometry.push(e.uint32());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Feature)return e;var t=new c.com.mapbox.pb.Tile.Feature;if(null!=e.id&&(l.Long?(t.id=l.Long.fromValue(e.id)).unsigned=!0:\"string\"==typeof e.id?t.id=parseInt(e.id,10):\"number\"==typeof e.id?t.id=e.id:\"object\"==typeof e.id&&(t.id=new l.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0))),e.tags){if(!Array.isArray(e.tags))throw TypeError(\".com.mapbox.pb.Tile.Feature.tags: array expected\");t.tags=[];for(var n=0;n<e.tags.length;++n)t.tags[n]=e.tags[n]>>>0}switch(e.type){case\"UNKNOWN\":case 0:t.type=0;break;case\"POINT\":case 1:t.type=1;break;case\"LINESTRING\":case 2:t.type=2;break;case\"POLYGON\":case 3:t.type=3}if(e.geometry){if(!Array.isArray(e.geometry))throw TypeError(\".com.mapbox.pb.Tile.Feature.geometry: array expected\");for(t.geometry=[],n=0;n<e.geometry.length;++n)t.geometry[n]=e.geometry[n]>>>0}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.tags=[],n.geometry=[]),t.defaults){if(l.Long){var r=new l.Long(0,0,!0);n.id=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.id=t.longs===String?\"0\":0;n.type=t.enums===String?\"UNKNOWN\":0}if(null!=e.id&&e.hasOwnProperty(\"id\")&&(\"number\"==typeof e.id?n.id=t.longs===String?String(e.id):e.id:n.id=t.longs===String?l.Long.prototype.toString.call(e.id):t.longs===Number?new l.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0):e.id),e.tags&&e.tags.length){n.tags=[];for(var i=0;i<e.tags.length;++i)n.tags[i]=e.tags[i]}if(null!=e.type&&e.hasOwnProperty(\"type\")&&(n.type=t.enums===String?c.com.mapbox.pb.Tile.GeomType[e.type]:e.type),e.geometry&&e.geometry.length)for(n.geometry=[],i=0;i<e.geometry.length;++i)n.geometry[i]=e.geometry[i];return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e.Layer=function(){function e(e){if(this.features=[],this.keys=[],this.values=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.version=1,e.prototype.name=\"\",e.prototype.features=l.emptyArray,e.prototype.keys=l.emptyArray,e.prototype.values=l.emptyArray,e.prototype.extent=4096,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.com.mapbox.pb.Tile.Layer;e.pos<n;){var i=e.uint32();switch(i>>>3){case 15:r.version=e.uint32();break;case 1:r.name=e.string();break;case 2:r.features&&r.features.length||(r.features=[]),r.features.push(c.com.mapbox.pb.Tile.Feature.decode(e,e.uint32()));break;case 3:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;case 4:r.values&&r.values.length||(r.values=[]),r.values.push(c.com.mapbox.pb.Tile.Value.decode(e,e.uint32()));break;case 5:r.extent=e.uint32();break;default:e.skipType(7&i)}}if(!r.hasOwnProperty(\"version\"))throw l.ProtocolError(\"missing required 'version'\",{instance:r});if(!r.hasOwnProperty(\"name\"))throw l.ProtocolError(\"missing required 'name'\",{instance:r});return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Layer)return e;var t=new c.com.mapbox.pb.Tile.Layer;if(null!=e.version&&(t.version=e.version>>>0),null!=e.name&&(t.name=String(e.name)),e.features){if(!Array.isArray(e.features))throw TypeError(\".com.mapbox.pb.Tile.Layer.features: array expected\");t.features=[];for(var n=0;n<e.features.length;++n){if(\"object\"!=typeof e.features[n])throw TypeError(\".com.mapbox.pb.Tile.Layer.features: object expected\");t.features[n]=c.com.mapbox.pb.Tile.Feature.fromObject(e.features[n])}}if(e.keys){if(!Array.isArray(e.keys))throw TypeError(\".com.mapbox.pb.Tile.Layer.keys: array expected\");for(t.keys=[],n=0;n<e.keys.length;++n)t.keys[n]=String(e.keys[n])}if(e.values){if(!Array.isArray(e.values))throw TypeError(\".com.mapbox.pb.Tile.Layer.values: array expected\");for(t.values=[],n=0;n<e.values.length;++n){if(\"object\"!=typeof e.values[n])throw TypeError(\".com.mapbox.pb.Tile.Layer.values: object expected\");t.values[n]=c.com.mapbox.pb.Tile.Value.fromObject(e.values[n])}}return null!=e.extent&&(t.extent=e.extent>>>0),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.features=[],n.keys=[],n.values=[]),t.defaults&&(n.name=\"\",n.extent=4096,n.version=1),null!=e.name&&e.hasOwnProperty(\"name\")&&(n.name=e.name),e.features&&e.features.length){n.features=[];for(var r=0;r<e.features.length;++r)n.features[r]=c.com.mapbox.pb.Tile.Feature.toObject(e.features[r],t)}if(e.keys&&e.keys.length)for(n.keys=[],r=0;r<e.keys.length;++r)n.keys[r]=e.keys[r];if(e.values&&e.values.length)for(n.values=[],r=0;r<e.values.length;++r)n.values[r]=c.com.mapbox.pb.Tile.Value.toObject(e.values[r],t);return null!=e.extent&&e.hasOwnProperty(\"extent\")&&(n.extent=e.extent),null!=e.version&&e.hasOwnProperty(\"version\")&&(n.version=e.version),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e}(),r),i),o),e.exports=c},function(e,t,n){\"use strict\";e.exports=h;var r,i=n(7),o=i.LongBits,s=i.base64,a=i.utf8;function l(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function c(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(c,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new l(e,t,n),this.len+=t,this},f.prototype=Object.create(l.prototype),f.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,o.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=o.from(e);return this._push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=o.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var n=h.alloc(t=s.length(e));s.decode(e,n,0),e=n}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new l(c,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(c,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=d(),r._configure()}},function(e,t,n){\"use strict\";e.exports=l;var r,i=n(7),o=i.LongBits,s=i.utf8;function a(e,t){return RangeError(\"index out of range: \"+e.pos+\" + \"+(t||1)+\" > \"+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var c,u=\"undefined\"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error(\"illegal buffer\")}:function(e){if(Array.isArray(e))return new l(e);throw Error(\"illegal buffer\")},h=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new r(e):u(e)})(e)}:u};function d(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error(\"invalid varint encoding\")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new o(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}l.create=h(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return c;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return c}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},l.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},l.prototype.skip=function(e){if(\"number\"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(\"invalid wire type \"+e+\" at offset \"+this.pos)}return this},l._configure=function(e){r=e,l.create=h(),r._configure();var t=i.Long?\"toLong\":\"toNumber\";i.merge(l.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.SubdivisionModifier=void 0;const r=n(0),i=new r.Vector3,o=new r.Vector3,s=new r.Vector3;t.SubdivisionModifier=class{constructor(){}modify(e){const t=e.getAttribute(\"position\"),n=Array.from(t.array),r=e.getAttribute(\"uv\"),a=void 0!==r?Array.from(r.array):void 0,l=e.getAttribute(\"edge\"),c=void 0!==l?Array.from(l.array):void 0,u=e.getAttribute(\"wall\"),h=void 0!==u?Array.from(u.array):void 0,d=e.getIndex(),p=Array.from(d.array),f=new Map;function m(e,t){const r=`${Math.min(e,t)}_${Math.max(e,t)}`,l=f.get(r);if(void 0!==l)return l;i.set(n[3*e],n[3*e+1],n[3*e+2]),o.set(n[3*t],n[3*t+1],n[3*t+2]),s.lerpVectors(i,o,.5);const u=n.length/3;return n.push(...s.toArray()),f.set(r,u),void 0!==a&&(i.set(a[2*e],a[2*e+1],0),o.set(a[2*t],a[2*t+1],0),s.lerpVectors(i,o,.5),a.push(s.x,s.y)),void 0!==c&&(c[e]===t?(c.push(t),c[e]=u):c[t]===e?(c.push(e),c[t]=u):c.push(-1)),void 0!==h&&(h[e]===t?(h.push(t),h[e]=u):h[t]===e?(h.push(e),h[t]=u):h.push(-1)),u}const g=[];for(;p.length>=3;){const e=p.shift(),t=p.shift(),r=p.shift();i.set(n[3*e],n[3*e+1],n[3*e+2]),o.set(n[3*t],n[3*t+1],n[3*t+2]),s.set(n[3*r],n[3*r+1],n[3*r+2]);switch(this.shouldSplitTriangle(i,o,s)){case 0:{const n=m(e,t);p.push(e,n,r,n,t,r);break}case 1:{const n=m(t,r);p.push(e,t,n,e,n,r);break}case 2:{const n=m(r,e);p.push(e,t,n,n,t,r);break}case void 0:g.push(e,t,r);break;default:throw new Error(\"failed to subdivide the given geometry\")}}return t.array=t.array instanceof Float32Array?new Float32Array(n):new Float64Array(n),t.count=n.length/t.itemSize,t.needsUpdate=!0,e.setIndex(g),void 0!==a&&(r.array=new Float32Array(a),r.count=a.length/r.itemSize,r.needsUpdate=!0),void 0!==c&&(l.array=new Float32Array(c),l.count=c.length/l.itemSize,l.needsUpdate=!0),e}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});const r=n(57);r.OmvTileDecoderService.start(),r.OmvTilerService.start()},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),i(n(33),t);var o=n(33);Object.defineProperty(t,\"OmvDecoder\",{enumerable:!0,get:function(){return o.VectorTileDataProcessor}}),Object.defineProperty(t,\"OmvTileDecoderService\",{enumerable:!0,get:function(){return o.VectorTileDecoderService}}),Object.defineProperty(t,\"OmvTileDecoder\",{enumerable:!0,get:function(){return o.VectorTileDecoder}}),Object.defineProperty(t,\"OmvTilerService\",{enumerable:!0,get:function(){return o.GeoJsonTilerService}})},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.VectorTileDecoderService=t.VectorTileDecoder=t.VectorTileDataProcessor=void 0;const r=n(5),i=n(32),o=n(50),s=n(2),a=n(135),l=n(137),c=n(138),u=n(160),h=n(15),d=n(161),p=s.LoggerManager.instance.create(\"VectorTileDecoder\",{enabled:!1});class f{constructor(e,t,n,r,i={},o){var s,a;this.m_tileKey=e,this.m_projection=t,this.m_styleSetEvaluator=n,this.m_dataAdapter=r,this.m_options=i,this.m_dataFilter=o,i.storageLevelOffset=null!==(s=i.storageLevelOffset)&&void 0!==s?s:0,i.showMissingTechniques=null!==(a=i.showMissingTechniques)&&void 0!==a&&a}getDecodedTile(e){this.m_styleSetEvaluator.resetTechniques();const t=new u.DecodeInfo(this.m_projection,this.m_tileKey,this.m_options.storageLevelOffset);return this.m_decodedTileEmitter=new d.VectorTileDataEmitter(t,this.m_styleSetEvaluator,this.m_options),this.m_dataAdapter.process(e,t,this),this.m_decodedTileEmitter.getDecodedTile()}processPointFeature(e,t,n,i,o){s.assert(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,n,\"point\",i,o,this.m_decodedTileEmitter.processPointFeature,r.GeometryKind.Label)}processLineFeature(e,t,n,i,o){s.assert(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,n,\"line\",i,o,this.m_decodedTileEmitter.processLineFeature,r.GeometryKind.Line)}processPolygonFeature(e,t,n,i,o){s.assert(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,n,\"polygon\",i,o,this.m_decodedTileEmitter.processPolygonFeature,r.GeometryKind.Area)}processFeature(e,t,n,r,i,o,s,a){const l=this.createMapEnv(i,o,e,r),c=this.applyKindFilter(this.m_styleSetEvaluator.getMatchingTechniques(l,e,r),a);if(0===c.length)return void(this.m_options.showMissingTechniques&&p.log(\"VectorTileDataProcessor#processFeature: no techniques for object:\",JSON.stringify(l.unmap())));const u={env:l,cachedExprResults:new Map};this.m_decodedTileEmitter&&s.apply(this.m_decodedTileEmitter,[e,t,n,u,c])}createMapEnv(e,t,n,r){const o=this.m_tileKey.level;return new i.MapEnv(Object.assign({$layer:n,$id:null!=t?t:null,$level:o,$zoom:Math.max(0,o-this.m_options.storageLevelOffset),$geometryType:r},e))}applyKindFilter(e,t){return void 0!==this.m_dataFilter&&this.m_dataFilter.hasKindFilter&&(e=e.filter(e=>{const n=void 0===e.kind?t:e.kind;return this.m_dataFilter.wantsKind(n)})),e}}t.VectorTileDataProcessor=f;class m extends o.ThemedTileDecoder{constructor(){super(),this.m_roundUpCoordinatesIfNeeded=!1,this.m_options={map:{},changed:!1},this.m_defaultDataAdapters=[],this.m_defaultDataAdapters.push(new c.OmvDataAdapter,new l.GeoJsonVtDataAdapter,new a.GeoJsonDataAdapter)}connect(){return Promise.resolve()}decodeThemedTile(e,t,n,r){const i=s.PerformanceTimer.now();if(!this.m_dataAdapter&&(this.m_dataAdapter=this.getDataAdapter(e),!this.m_dataAdapter))return Promise.reject(new Error(\"Unsupported data format.\"));const o=this.m_dataAdapter;if(s.assert(o.canProcess(e)),this.m_options.changed){if(o instanceof c.OmvDataAdapter){const e=this.m_options.map;o.configure(e,n),this.m_featureFilter=o.dataFilter}this.m_options.changed=!1}const a=new f(t,r,n,o,this.m_options.map,this.m_featureFilter).getDecodedTile(e);return a.decodeTime=s.PerformanceTimer.now()-i,Promise.resolve(a)}configure(e,t){super.configure(e,t),this.m_options.map=Object.assign(Object.assign(Object.assign({},this.m_options.map),e),t),this.m_options.changed=!0}getDataAdapter(e){for(const t of this.m_defaultDataAdapters)if(t.canProcess(e))return t}}t.VectorTileDecoder=m;t.VectorTileDecoderService=class{static start(){o.WorkerServiceManager.getInstance().register({serviceType:h.VECTOR_TILE_DECODER_SERVICE_TYPE,factory:e=>o.TileDecoderService.start(e,new m)})}}},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),i(n(60),t),i(n(61),t),i(n(62),t),i(n(67),t),i(n(68),t),i(n(69),t),i(n(70),t),i(n(71),t),i(n(72),t),i(n(73),t),i(n(74),t),i(n(75),t),i(n(76),t),i(n(77),t),i(n(26),t),i(n(78),t),i(n(79),t),i(n(80),t),i(n(81),t)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.DOMUtils=void 0,function(e){function t(e){return e.substring(0,2)}e.getBrowserLanguages=function(){if(void 0!==navigator.languages&&navigator.languages.length>0){const e=[];for(const n of navigator.languages)e.push(t(n));return e}if(void 0!==navigator.language)return[t(navigator.language)]}}(t.DOMUtils||(t.DOMUtils={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GroupedPriorityList=t.PriorityListGroup=void 0;class r{constructor(e,t=new Array){this.priority=e,this.elements=t}clone(){return new r(this.priority,this.elements.slice())}remove(e){const t=this.elements.indexOf(e);return-1!==t&&(this.elements.splice(t,1),!0)}}t.PriorityListGroup=r;class i{constructor(){this.groups=new Map}add(e){this.getGroup(e.priority).elements.push(e)}remove(e){const t=this.findGroup(e.priority);return!(void 0===t||!t.remove(e))&&(0===t.elements.length&&this.groups.delete(t.priority),!0)}clear(){this.groups.clear()}merge(e){for(const t of e.groups){const e=this.findGroup(t[1].priority);void 0!==e?e.elements=e.elements.concat(t[1].elements):this.groups.set(Math.floor(t[1].priority),t[1].clone())}return this}clone(){const e=new i;for(const[t,n]of this.groups)e.groups.set(t,n.clone());return e}forEach(e){for(const t of this.groups)t[1].elements.forEach(e)}count(){let e=0;for(const t of this.groups)e+=t[1].elements.length;return e}findGroup(e){const t=Math.floor(e);return this.groups.get(t)}getGroup(e){let t=this.findGroup(e);if(void 0===t){const n=Math.floor(e);t=new r(n),this.groups.set(t.priority,t)}return t}}t.GroupedPriorityList=i},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),i(n(34),t),i(n(63),t),i(n(25),t),i(n(35),t),i(n(64),t),i(n(66),t),i(n(36),t)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.LoggerManager=void 0;const r=n(65);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new r.LoggerManagerImpl)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.LoggerManagerImpl=void 0;const r=n(34),i=n(35),o=n(36);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel=\"undefined\"==typeof self||void 0!==self.document?new r.ConsoleChannel:new o.WorkerChannel}getLoggerNames(){return this.m_loggers.map(e=>e.name)}getLogger(e){return this.m_loggers.find(t=>t.name===e)}create(e,t={}){void 0!==this.m_levelSetForAll&&(void 0===t.level||t.level<this.m_levelSetForAll)&&(t.level=this.m_levelSetForAll);const n=new i.Logger(e,this.channel,t);return this.m_loggers.push(n),n}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister \"${e}\" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const n of this.m_loggers)n.name===e&&n.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){this.m_levelSetForAll=e;for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MultiChannel=void 0;t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const n of this.channels)n.error(e,...t)}debug(e,...t){for(const n of this.channels)n.debug(e,...t)}info(e,...t){for(const n of this.channels)n.info(e,...t)}log(e,...t){for(const n of this.channels)n.log(e,...t)}trace(e,...t){for(const n of this.channels)n.trace(e,...t)}warn(e,...t){for(const n of this.channels)n.warn(e,...t)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.Math2D=void 0,function(e){function t(e,t,n,r){return(e-n)*(e-n)+(t-r)*(t-r)}e.Box=class{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.w=n,this.h=r}set(e,t,n,r){this.x=e,this.y=t,this.w=n,this.h=r}copy(e){this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}containsBox(e){const t=e.x+e.w,n=e.y+e.h;return this.contains(e.x,e.y)&&this.contains(t,e.y)&&this.contains(e.x,n)&&this.contains(t,n)}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const n=e.length-4;for(let r=0;r<n;r+=3){const n=e[r+3]-e[r],i=e[r+4]-e[r+1];t+=n*n+i*i}return t},e.distToSegmentSquared=function(e,n,r,i,o,s){const a=t(r,i,o,s);if(0===a)return t(e,n,r,i);let l=((e-r)*(o-r)+(n-i)*(s-i))/a;return l=Math.max(0,Math.min(1,l)),t(e,n,r+l*(o-r),i+l*(s-i))},e.intersectLineAndCircle=function(e,t,n,r,i,o=0,s=0){const a=n-e,l=r-t,c=a*a+l*l,u=e*r-n*t-l*o+a*s,h=i*i*c-u*u;if(h<-1e-10)return;const d=u*l,p=-u*a;if(h<1e-10)return{x1:o+d/c,y1:s+p/c};const f=Math.sqrt(h),m=(l<0?-1:1)*a*f,g=Math.abs(l)*f;return{x1:o+(d+m)/c,y1:s+(p+g)/c,x2:o+(d-m)/c,y2:s+(p-g)/c}},e.intersectLines=function(e,t,n,r,i,o,s,a,l={x:0,y:0}){const c=(e-n)*(o-a)-(t-r)*(i-s);if(0===c)return;const u=((e*r-t*n)*(i-s)-(e-n)*(i*a-o*s))/c,h=((e*r-t*n)*(o-a)-(t-r)*(i*a-o*s))/c;return l.x=u,l.y=h,l}}(t.Math2D||(t.Math2D={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MathUtils=void 0,function(e){function t(e,t,n){return e<t?t:e>n?n:e}e.clamp=t,e.smoothStep=function(e,n,r){return(r=t((r-e)/(n-e),0,1))*r*(3-2*r)},e.smootherStep=function(e,n,r){return(r=t((r-e)/(n-e),0,1))*r*r*(r*(6*r-15)+10)},e.map=function(e,t,n,r,i){return(e-t)*(i-r)/(n-t)+r},e.min2=function(e,t){let n;return void 0!==e&&(n=e),void 0!==t&&(n=void 0===n?t:Math.min(n,t)),n},e.max2=function(e,t){let n;return void 0!==e&&(n=e),void 0!==t&&(n=void 0===n?t:Math.max(n,t)),n},e.isClamped=function(e,t,n){return!(void 0!==t&&e<t)&&!(void 0!==n&&e>n)},e.easeInOutCubic=function(e,t,n){return e+(t-e)*(n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1)}}(t.MathUtils||(t.MathUtils={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.applyMixinsWithoutProperties=t.applyMixins=void 0,t.applyMixins=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(n=>{e.prototype[n]=t.prototype[n]})})},t.applyMixinsWithoutProperties=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(n=>{const r=Object.getOwnPropertyDescriptor(t.prototype,n);void 0!==r&&void 0===r.get&&\"constructor\"!==n&&(e.prototype[n]=t.prototype[n])})})}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.assertExists=t.assert=void 0;t.assert=function(e,t){0},t.assertExists=function(e,t){return e}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ContextLogger=void 0;t.ContextLogger=class{constructor(e,t){this.m_logger=e,this.headerMessage=t,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod(\"warn\"),this.info=this.createLogMethod(\"info\"),this.error=this.createLogMethod(\"error\")}pushAttr(e){this.context.push(`${this.context.length>0?\".\":\"\"}${e}`)}pushIndex(e){this.context.push(`[${e}]`)}pop(){this.context.pop()}createLogMethod(e){return(t,...n)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[e](`${this.context.join(\"\")}: ${t}`,...n)}}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.PerformanceTimer=void 0;class r{static now(){return r.nowFunc()}static getNowFunc(){return\"undefined\"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}t.PerformanceTimer=r,r.instance=new r,r.nowFunc=r.getNowFunc()},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.pick=t.cloneDeep=void 0,t.cloneDeep=function(e){const t=new Map,n=function e(n){if(null===n)return null;if(\"object\"==typeof n){const r=t.get(n);if(void 0!==r)return r;if(Array.isArray(n)){const r=[];t.set(n,r),r.length=n.length;for(let t=0;t<r.length;++t)r[t]=e(n[t]);return r}if(n instanceof Date){const e=new Date(n.getTime());return t.set(n,e),e}if(n instanceof RegExp){const e=new RegExp(n.source,n.flags);return t.set(n,e),e}if(n.constructor!==Object)throw new Error(\"cloneDeep doesn't support objects with custom prototypes\");{const r={};t.set(n,r);for(const t in n)n.hasOwnProperty(t)&&(r[t]=e(n[t]));return r}}return n}(e);return t.clear(),n},t.pick=function(e,t){const n={};for(const r of t)e.hasOwnProperty(r)&&(n[r]=e[r]);return n}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.getOptionValue=void 0,t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TaskQueue=void 0;t.TaskQueue=class{constructor(e){var t;this.m_options=e,this.m_taskLists=new Map,null===(t=this.m_options.groups)||void 0===t||t.forEach(e=>{this.m_taskLists.set(e,[])}),this.m_options.prioSortFn&&(this.sort=this.m_options.prioSortFn)}update(e){if(void 0===e)this.m_taskLists.forEach(e=>{this.updateTaskList(e)});else{const t=this.getTaskList(e);t&&this.updateTaskList(t)}}add(e){var t;if(this.m_taskLists.has(e.group)){const n=this.m_taskLists.get(e.group);if(!(null==n?void 0:n.includes(e)))return null===(t=this.m_taskLists.get(e.group))||void 0===t||t.push(e),!0}return!1}remove(e){var t,n;if(this.m_taskLists.has(e.group)){const r=null===(t=this.m_taskLists.get(e.group))||void 0===t?void 0:t.indexOf(e);if(-1!==r)return null===(n=this.m_taskLists.get(e.group))||void 0===n||n.splice(r,1),!0}return!1}numItemsLeft(e){var t,n;let r=0;return void 0===e?this.m_taskLists.forEach(e=>{r+=e.length}):r+=null!==(n=null===(t=this.getTaskList(e))||void 0===t?void 0:t.length)&&void 0!==n?n:0,r}processNext(e,t,n=1){if(!this.getTaskList(e)||this.numItemsLeft(e)<=0)return!1;for(let r=0;r<n&&this.numItemsLeft(e)>0;r++){const n=this.pull(e,!0);void 0!==n&&(!t||(null==t?void 0:t(n))?n.execute():this.add(n))}return!0}clear(){this.m_taskLists.clear()}pull(e,t=!1){var n,r;let i;return this.getTaskList(e)&&(i=null===(n=this.getTaskList(e))||void 0===n?void 0:n.pop(),t&&i&&(null===(r=i.isExpired)||void 0===r?void 0:r.call(i)))?this.pull(e,t):i}sort(e,t){return t.getPriority()-e.getPriority()}getTaskList(e){return this.m_taskLists.get(e)}updateTaskList(e){var t;for(let n=0;n<e.length;n++){const r=e[n];(null===(t=null==r?void 0:r.isExpired)||void 0===t?void 0:t.call(r))&&(e.splice(n,1),n--)}e.sort(this.sort)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.composeUriResolvers=t.RelativeUriResolver=t.PrefixMapUriResolver=void 0;const r=n(26);t.PrefixMapUriResolver=class{constructor(e){this.definitions=e}resolveUri(e){return Object.keys(this.definitions).reduce((e,t)=>{if(t.endsWith(\"/\")&&e.startsWith(t)){return this.definitions[t]+e.substr(t.length)}return e===t?this.definitions[t]:e},e)}};t.RelativeUriResolver=class{constructor(e){this.parentUri=e}resolveUri(e){return r.resolveReferenceUri(this.parentUri,e)}},t.composeUriResolvers=function(...e){return{resolveUri:t=>e.reduce((e,t)=>void 0!==t?t.resolveUri(e):e,t)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.chainCallbacks=void 0,t.chainCallbacks=function(e,t){return function(...n){return e&&e.apply(this,n),t.apply(this,n)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.sampleBilinear=void 0,t.sampleBilinear=function(e,t,n,r,i){const o=t-1,s=n-1,a=r*o,l=Math.floor(a),c=i*s,u=Math.floor(c),h=u*t+l,d=l<o?h+1:h,p=u<s?h+t:h,f=l<o?p+1:p,m=e[h],g=e[d],v=e[p],y=e[f],x=Number.isInteger(a)?0:a-l,_=1-x,b=Number.isInteger(c)?0:c-u,w=1-b;return m*_*w+g*x*w+v*_*b+y*x*b}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.convertFragmentShaderToWebGL2=t.convertVertexShaderToWebGL2=void 0,t.convertVertexShaderToWebGL2=function(e){return[\"#define attribute in\",\"#define varying out\",\"#define texture2D texture\"].join(\"\\n\")+\"\\n\"+e},t.convertFragmentShaderToWebGL2=function(e){return[\"#define varying in\",\"out highp vec4 pc_fragColor;\",\"#define gl_FragColor pc_fragColor\",\"#define gl_FragDepthEXT gl_FragDepth\",\"#define texture2D texture\",\"#define textureCube texture\",\"#define texture2DProj textureProj\",\"#define texture2DLodEXT textureLod\",\"#define texture2DProjLodEXT textureProjLod\",\"#define textureCubeLodEXT textureLod\",\"#define texture2DGradEXT textureGrad\",\"#define texture2DProjGradEXT textureProjGrad\",\"#define textureCubeGradEXT textureGrad\"].join(\"\\n\")+\"\\n\"+e}},function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0}),t.getAppBaseUrl=void 0;const r=n(26);t.getAppBaseUrl=function(){return\"undefined\"==typeof window?`file://${e.cwd()}/`:r.baseUrl(window.location.href)}}).call(this,n(83))},function(e,t){var n,r,i=e.exports={};function o(){throw new Error(\"setTimeout has not been defined\")}function s(){throw new Error(\"clearTimeout has not been defined\")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n=\"function\"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r=\"function\"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l,c=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&p())}function p(){if(!u){var e=a(d);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title=\"browser\",i.browser=!0,i.env={},i.argv=[],i.version=\"\",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error(\"process.binding is not supported\")},i.cwd=function(){return\"/\"},i.chdir=function(e){throw new Error(\"process.chdir is not supported\")},i.umask=function(){return 0}},function(e,t){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function i(e){return e<0?0:e>1?1:e}function o(e){return\"%\"===e[e.length-1]?r(parseFloat(e)/100*255):r(parseInt(e))}function s(e){return\"%\"===e[e.length-1]?i(parseFloat(e)/100):i(parseFloat(e))}function a(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{t.parseCSSColor=function(e){var t,i=e.replace(/ /g,\"\").toLowerCase();if(i in n)return n[i].slice();if(\"#\"===i[0])return 4===i.length?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===i.length&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=i.indexOf(\"(\"),c=i.indexOf(\")\");if(-1!==l&&c+1===i.length){var u=i.substr(0,l),h=i.substr(l+1,c-(l+1)).split(\",\"),d=1;switch(u){case\"rgba\":if(4!==h.length)return null;d=s(h.pop());case\"rgb\":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),d];case\"hsla\":if(4!==h.length)return null;d=s(h.pop());case\"hsl\":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=s(h[1]),m=s(h[2]),g=m<=.5?m*(f+1):m+f-m*f,v=2*m-g;return[r(255*a(v,g,p+1/3)),r(255*a(v,g,p)),r(255*a(v,g,p-1/3)),d];default:return null}}return null}}catch(e){}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExprEvaluator=t.ExprEvaluatorContext=void 0;const r=n(0),i=n(1),o=n(86),s=n(87),a=n(88),l=n(89),c=n(90),u=n(91),h=n(92),d=n(93),p=n(94),f=n(95),m=n(96),g=n(97),v=n(98),y=n(27),x=n(17),_=new Map;function b(e,t){var n,r,o;if(t instanceof i.StringLiteralExpr)return null!==(n=t.promotedValue)&&void 0!==n?n:t.value;const s=e.evaluate(t);return\"string\"==typeof s&&null!==(o=null!==(r=x.RGBA.parse(s))&&void 0!==r?r:y.Pixels.parse(s))&&void 0!==o?o:s}t.ExprEvaluatorContext=class{constructor(e,t,n,r){this.evaluator=e,this.env=t,this.scope=n,this.cache=r}evaluate(e){var t,n;if(void 0===e)throw new Error(\"Failed to evaluate expression\");const r=null===(t=this.cache)||void 0===t?void 0:t.get(e);if(void 0!==r)return r;const i=e.accept(this.evaluator,this);return null===(n=this.cache)||void 0===n||n.set(e,i),i}wrapValue(e){return i.Expr.isExpr(e)?e:i.LiteralExpr.fromValue(e)}};class w{static defineOperator(e,t){_.set(e,t)}static defineOperators(e){Object.getOwnPropertyNames(e).forEach(t=>{this.defineOperator(t,e[t])})}static getOperator(e){return _.get(e)}visitVarExpr(e,t){const n=t.env.lookup(e.name);return void 0!==n?n:null}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value}visitHasAttributeExpr(e,t){return void 0!==t.env.lookup(e.name)}visitMatchExpr(e,t){const n=t.evaluate(e.value);for(const[r,i]of e.branches){if(Array.isArray(r)&&r.includes(n))return t.evaluate(i);if(r===n)return t.evaluate(i)}return t.evaluate(e.fallback)}visitCaseExpr(e,t){if(t.scope===i.ExprScope.Value){const n=e.branches.findIndex(([e,t])=>e.isDynamic());if(-1!==n){let r;for(let o=0;o<e.branches.length;++o){const[s,a]=e.branches[o],l=t.evaluate(s),c=t.evaluate(a);if(o<n&&Boolean(l))return c;if((i.Expr.isExpr(l)||Boolean(l))&&(void 0===r&&(r=[]),null==r||r.push([t.wrapValue(l),t.wrapValue(c)]),!i.Expr.isExpr(l)&&Boolean(l)))return new i.CaseExpr(r,i.LiteralExpr.fromValue(null))}const o=t.evaluate(e.fallback);return void 0===r?o:new i.CaseExpr(r,t.wrapValue(o))}}for(const[n,r]of e.branches)if(t.evaluate(n))return t.evaluate(r);return t.evaluate(e.fallback)}visitCallExpr(e,t){var n;const r=null!==(n=e.descriptor)&&void 0!==n?n:_.get(e.op);if(r){let n;if(e.descriptor=r,t.scope===i.ExprScope.Value&&e.isDynamic()){if(e.descriptor.partialEvaluate)return e.descriptor.partialEvaluate(t,e);const r=e.args.map(e=>t.wrapValue(t.evaluate(e)));if(r.every((t,n)=>t===e.args[n]))return e;n=new i.CallExpr(e.op,r)}else n=r.call(t,e);return n}throw new Error(`undefined operator '${e.op}'`)}visitStepExpr(e,t){if(t.scope===i.ExprScope.Value){const n=t.evaluate(e.input),r=t.evaluate(e.defaultValue);return new i.StepExpr(t.wrapValue(n),t.wrapValue(r),e.stops.map(([e,n])=>{const r=t.evaluate(n);return[e,t.wrapValue(r)]}))}{const n=t.evaluate(e.input);if(\"number\"!=typeof n)throw new Error(`input '${n}' must be a number`);if(n<e.stops[0][0])return t.evaluate(e.defaultValue);let r=e.stops.findIndex(e=>e[0]>n);return-1===r&&(r=e.stops.length),t.evaluate(e.stops[r-1][1])}}visitInterpolateExpr(e,t){if(t.scope===i.ExprScope.Value){const n=t.evaluate(e.input);return new i.InterpolateExpr(e.mode,t.wrapValue(n),e.stops.map(([e,n])=>{const r=t.evaluate(n);return[e,t.wrapValue(r)]}))}{const n=t.evaluate(e.input);if(\"number\"!=typeof n)throw new Error(\"input must be a number\");if(\"cubic\"===e.mode[0])return function(e,t,n){if(n<t.stops[0][0])return b(e,t.stops[0][1]);if(n>=t.stops[t.stops.length-1][0])return b(e,t.stops[t.stops.length-1][1]);const i=t.stops.findIndex(e=>e[0]>n),o=Math.max(0,i-1),s=0===o?i:o-1,a=i<t.stops.length-1?i+1:i-1,l=t.stops[s][0],c=t.stops[o][0],u=t.stops[i][0],h=.5*(u-c),d=h/(c-l),p=h/(t.stops[a][0]-u),f=(n-c)/(u-c),m=f*f,g=m*f,v=-d*g+2*d*m-d*f,_=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*f+1,w=(-1-p)*g+(1.5+p)*m+.5*f,M=p*g-p*m,S=b(e,t.stops[s][1]),T=b(e,t.stops[o][1]),E=b(e,t.stops[i][1]),L=b(e,t.stops[a][1]);if(\"number\"==typeof S&&\"number\"==typeof T&&\"number\"==typeof E&&\"number\"==typeof L)return v*S+_*T+w*E+M*L;if(S instanceof x.RGBA&&T instanceof x.RGBA&&E instanceof x.RGBA&&L instanceof x.RGBA)return new x.RGBA(r.MathUtils.clamp(v*S.r+_*T.r+w*E.r+M*L.r,0,1),r.MathUtils.clamp(v*S.g+_*T.g+w*E.g+M*L.g,0,1),r.MathUtils.clamp(v*S.b+_*T.b+w*E.b+M*L.b,0,1),r.MathUtils.clamp(v*S.a+_*T.a+w*E.a+M*L.a,0,1));if(S instanceof y.Pixels&&T instanceof y.Pixels&&E instanceof y.Pixels&&L instanceof y.Pixels)return new y.Pixels(v*S.value+_*T.value+w*E.value+M*L.value);if(S instanceof r.Color&&T instanceof r.Color&&E instanceof r.Color&&L instanceof r.Color)return new r.Color(v*S.r+_*T.r+w*E.r+M*L.r,v*S.g+_*T.g+w*E.g+M*L.g,v*S.b+_*T.b+w*E.b+M*L.b);if(S instanceof r.Vector2&&T instanceof r.Vector2&&E instanceof r.Vector2&&L instanceof r.Vector2)return new r.Vector2(v*S.x+_*T.x+w*E.x+M*L.x,v*S.y+_*T.y+w*E.y+M*L.y);if(S instanceof r.Vector3&&T instanceof r.Vector3&&E instanceof r.Vector3&&L instanceof r.Vector3)return new r.Vector3(v*S.x+_*T.x+w*E.x+M*L.x,v*S.y+_*T.y+w*E.y+M*L.y,v*S.z+_*T.z+w*E.z+M*L.z);if(S instanceof r.Vector4&&T instanceof r.Vector4&&E instanceof r.Vector4&&L instanceof r.Vector4)return new r.Vector4(v*S.x+_*T.x+w*E.x+M*L.x,v*S.y+_*T.y+w*E.y+M*L.y,v*S.z+_*T.z+w*E.z+M*L.z,v*S.w+_*T.w+w*E.w+M*L.w);if(Array.isArray(S)&&Array.isArray(T)&&Array.isArray(E)&&Array.isArray(L)){const e=S.length,t=[];for(let n=0;n<e;++n)t[n]=v*S[n]+_*T[n]+w*E[n]+M*L[n];return t}throw new Error(\"failed to interpolate values\")}(t,e,n);const i=e.stops.findIndex(e=>e[0]>n);if(-1===i)return t.evaluate(e.stops[e.stops.length-1][1]);if(0===i)return t.evaluate(e.stops[0][1]);const[o,s]=e.stops[i],[a,l]=e.stops[i-1],c=b(t,l);let u=0;switch(e.mode[0]){case\"discrete\":return c;case\"linear\":u=(n-a)/(o-a);break;case\"exponential\":{const t=e.mode[1];u=1===t?(n-a)/(o-a):(Math.pow(t,n-a)-1)/(Math.pow(t,o-a)-1);break}default:throw new Error(`interpolation mode ${JSON.stringify(e.mode)} is not supported`)}const h=b(t,s);if(\"number\"==typeof c&&\"number\"==typeof h)return r.MathUtils.lerp(c,h,u);if(c instanceof x.RGBA&&h instanceof x.RGBA)return c.clone().lerp(h,u);if(c instanceof y.Pixels&&h instanceof y.Pixels)return new y.Pixels(r.MathUtils.lerp(c.value,h.value,u));if(c instanceof r.Color&&h instanceof r.Color)return c.clone().lerp(h,u);if(c instanceof r.Vector2&&h instanceof r.Vector2)return c.clone().lerp(h,u);if(c instanceof r.Vector3&&h instanceof r.Vector3)return c.clone().lerp(h,u);if(c instanceof r.Vector4&&h instanceof r.Vector4)return c.clone().lerp(h,u);if(Array.isArray(c)&&Array.isArray(h)&&c.length===h.length)return c.map((e,t)=>r.MathUtils.lerp(e,h[t],u));throw new Error(`todo: mix(${JSON.stringify(c)}, ${JSON.stringify(h)}, ${u})`)}}}t.ExprEvaluator=w,w.defineOperators(s.CastOperators),w.defineOperators(l.ComparisonOperators),w.defineOperators(d.MathOperators),w.defineOperators(m.StringOperators),w.defineOperators(a.ColorOperators),w.defineOperators(g.TypeOperators),w.defineOperators(p.MiscOperators),w.defineOperators(u.FlowOperators),w.defineOperators(o.ArrayOperators),w.defineOperators(f.ObjectOperators),w.defineOperators(c.FeatureOperators),w.defineOperators(h.MapOperators),w.defineOperators(v.VectorOperators)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ArrayOperators=void 0;const r=n(1),i=[\"boolean\",\"number\",\"string\"];function o(e,t){if(!(e instanceof r.StringLiteralExpr&&i.includes(e.value)))throw new Error(`expected \"boolean\", \"number\" or \"string\" instead of '${JSON.stringify(e)}'`);const n=e.value;t.forEach((e,t)=>{if(typeof e!==n)throw new Error(`expected array element at index ${t} to have type '${n}'`)})}function s(e,t){const n=e.evaluate(t);if(!Array.isArray(n))throw new Error(`'${n}' is not an array`);return n}const a={array:{call:(e,t)=>{switch(t.args.length){case 0:throw new Error(\"not enough arguments\");case 1:return s(e,t.args[0]);case 2:{const n=s(e,t.args[1]);return o(t.args[0],n),n}case 3:{const n=s(e,t.args[2]);return function(e,t){if(!(e instanceof r.NumberLiteralExpr))throw new Error(\"missing expected number of elements\");const n=e.value;if(t.length!==n)throw new Error(`the array must have ${n} element(s)`)}(t.args[1],n),o(t.args[0],n),n}default:throw new Error(\"too many arguments\")}}},\"make-array\":{call:(e,t)=>{if(0===t.args.length)throw new Error(\"not enough arguments\");return[...t.args.map(t=>e.evaluate(t))]}},at:{call:(e,t)=>{const n=t.args,r=e.evaluate(n[0]);if(\"number\"!=typeof r)throw new Error(\"expected the index of the element to retrieve\");const i=e.evaluate(n[1]);if(!Array.isArray(i))throw new Error(\"expected an array\");return r>=0&&r<i.length?i[r]:null}},slice:{call:(e,t)=>{if(t.args.length<2)throw new Error(\"not enough arguments\");const n=e.evaluate(t.args[0]);if(\"string\"!=typeof n&&!Array.isArray(n))throw new Error(\"input must be a string or an array\");const r=e.evaluate(t.args[1]);if(\"number\"!=typeof r)throw new Error(\"expected an index\");let i;if(t.args.length>2&&(i=e.evaluate(t.args[2]),\"number\"!=typeof i))throw new Error(\"expected an index\");return n.slice(r,i)}}};t.ArrayOperators=a},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.CastOperators=void 0;const r={\"to-boolean\":{call:(e,t)=>Boolean(e.evaluate(t.args[0]))},\"to-string\":{call:(e,t)=>String(e.evaluate(t.args[0]))},\"to-number\":{call:(e,t)=>{for(const n of t.args){const t=Number(e.evaluate(n));if(!isNaN(t))return t}throw new Error(\"cannot convert the value to a number\")}}};t.CastOperators=r},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ColorOperators=void 0;const r=n(0),i=n(16),o=n(18),s={alpha:{call:(e,t)=>{let n=e.evaluate(t.args[0]);\"string\"==typeof n&&(n=o.parseStringEncodedColor(n));return\"number\"==typeof n?i.ColorUtils.getAlphaFromHex(n):1}},rgba:{call:(e,t)=>{const n=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]),a=e.evaluate(t.args[3]);if(\"number\"==typeof n&&\"number\"==typeof o&&\"number\"==typeof s&&\"number\"==typeof a&&n>=0&&o>=0&&s>=0&&a>=0&&a<=1)return function(e,t,n,o){return i.ColorUtils.getHexFromRgba(r.MathUtils.clamp(e,0,255)/255,r.MathUtils.clamp(t,0,255)/255,r.MathUtils.clamp(n,0,255)/255,r.MathUtils.clamp(o,0,1))}(n,o,s,a);throw new Error(`unknown color 'rgba(${n},${o},${s},${a})'`)}},rgb:{call:(e,t)=>{const n=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if(\"number\"==typeof n&&\"number\"==typeof o&&\"number\"==typeof s&&n>=0&&o>=0&&s>=0)return function(e,t,n){return i.ColorUtils.getHexFromRgb(r.MathUtils.clamp(e,0,255)/255,r.MathUtils.clamp(t,0,255)/255,r.MathUtils.clamp(n,0,255)/255)}(n,o,s);throw new Error(`unknown color 'rgb(${n},${o},${s})'`)}},hsl:{call:(e,t)=>{const n=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if(\"number\"==typeof n&&\"number\"==typeof o&&\"number\"==typeof s&&n>=0&&o>=0&&s>=0)return function(e,t,n){return i.ColorUtils.getHexFromHsl(r.MathUtils.euclideanModulo(e,360)/360,r.MathUtils.clamp(t,0,100)/100,r.MathUtils.clamp(n,0,100)/100)}(n,o,s);throw new Error(`unknown color 'hsl(${n},${o}%,${s}%)'`)}}};t.ColorOperators=s},function(e,t,n){\"use strict\";function r(e,t,n=!1){const r=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if(!(\"number\"==typeof r&&\"number\"==typeof i||\"string\"==typeof r&&\"string\"==typeof i)&&n)throw new Error(`invalid operands '${r}' and '${i}' for operator '${t.op}'`);switch(t.op){case\"<\":return r<i;case\">\":return r>i;case\"<=\":return r<=i;case\">=\":return r>=i;default:throw new Error(`invalid comparison operator '${t.op}'`)}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.ComparisonOperators=void 0;const i={\"!\":{call:(e,t)=>!e.evaluate(t.args[0])},\"==\":{call:(e,t)=>e.evaluate(t.args[0])===e.evaluate(t.args[1])},\"!=\":{call:(e,t)=>e.evaluate(t.args[0])!==e.evaluate(t.args[1])},\"<\":{call:(e,t)=>r(e,t)},\">\":{call:(e,t)=>r(e,t)},\"<=\":{call:(e,t)=>r(e,t)},\">=\":{call:(e,t)=>r(e,t)}};t.ComparisonOperators=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.FeatureOperators=void 0;const r=n(19),i=n(1),o={\"geometry-type\":{call:(e,t)=>{switch(e.env.lookup(\"$geometryType\")){case\"point\":return\"Point\";case\"line\":return\"LineString\";case\"polygon\":return\"Polygon\";default:return null}}},\"feature-state\":{isDynamicOperator:()=>!0,call:(e,t)=>{var n,o;if(e.scope!==i.ExprScope.Dynamic)throw new Error(\"feature-state cannot be used in this context\");const s=e.evaluate(t.args[0]);if(\"string\"!=typeof s)throw new Error(\"expected the name of the property of the feature state\");const a=e.env.lookup(\"$state\");return r.Env.isEnv(a)?null!==(n=a.lookup(s))&&void 0!==n?n:null:a instanceof Map&&null!==(o=a.get(s))&&void 0!==o?o:null}},id:{call:(e,t)=>{var n;return null!==(n=e.env.lookup(\"$id\"))&&void 0!==n?n:null}}};t.FeatureOperators=o},function(e,t,n){\"use strict\";function r(e,t,n){switch(t){case\"boolean\":case\"number\":case\"string\":for(const r of n){const n=e.evaluate(r);if(typeof n===t)return n}throw new Error(`expected a '${t}'`);default:throw new Error(`invalid type '${t}'`)}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.FlowOperators=void 0;const i={all:{call:(e,t)=>{for(const n of t.args)if(!e.evaluate(n))return!1;return!0}},any:{call:(e,t)=>{for(const n of t.args)if(e.evaluate(n))return!0;return!1}},none:{call:(e,t)=>{for(const n of t.args)if(e.evaluate(n))return!1;return!0}},boolean:{call:(e,t)=>r(e,\"boolean\",t.args)},number:{call:(e,t)=>r(e,\"number\",t.args)},string:{call:(e,t)=>r(e,\"string\",t.args)}};t.FlowOperators=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MapOperators=void 0;const r=n(1),i={\"ppi-scale\":{call:(e,t)=>e.evaluate(t.args[0])*(t.args[1]?e.evaluate(t.args[1]):1)},\"world-ppi-scale\":{isDynamicOperator:()=>!0,call:(e,t)=>{const n=e.evaluate(t.args[0]),r=t.args[1]?e.evaluate(t.args[1]):1,i=e.env.lookup(\"$zoom\");return n*(Math.pow(2,17)/Math.pow(2,i))*r}},\"world-discrete-ppi-scale\":{isDynamicOperator:()=>!0,call:(e,t)=>{const n=e.evaluate(t.args[0]),r=t.args[1]?e.evaluate(t.args[1]):1,i=e.env.lookup(\"$zoom\");return n*(Math.pow(2,17)/Math.pow(2,Math.floor(i)))*r}},ppi:{call:e=>{const t=e.env.lookup(\"$ppi\");return\"number\"==typeof t?t:72}},zoom:{isDynamicOperator:()=>!0,call:(e,t)=>{var n;return e.scope===r.ExprScope.Value?t:null!==(n=e.env.lookup(\"$zoom\"))&&void 0!==n?n:null}}};t.MapOperators=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MathOperators=void 0;const r=n(0),i={\"^\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if(\"number\"!=typeof n||\"number\"!=typeof r)throw new Error(`invalid operands '${typeof n}' and '${typeof r}' for operator '^'`);return Math.pow(n,r)}},\"-\":{call:(e,t)=>{if(1===t.args.length){const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`ìnvalid operand '${typeof n} for operator '-'`);return-n}const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if(\"number\"!=typeof n||\"number\"!=typeof r)throw new Error(`invalid operands '${typeof n}' and '${typeof r}' for operator '-'`);return n-r}},\"/\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if(\"number\"!=typeof n||\"number\"!=typeof r)throw new Error(`invalid operands '${typeof n}' and '${typeof r}' for operator '/'`);return n/r}},\"%\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if(\"number\"!=typeof n||\"number\"!=typeof r)throw new Error(`invalid operands '${typeof n}' and '${typeof r}' for operator '%'`);return n%r}},\"+\":{call:(e,t)=>t.args.reduce((t,n)=>Number(t)+Number(e.evaluate(n)),0)},\"*\":{call:(e,t)=>t.args.reduce((t,n)=>Number(t)*Number(e.evaluate(n)),1)},abs:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'abs'`);return Math.abs(n)}},acos:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'acos'`);return Math.acos(n)}},asin:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'asin'`);return Math.asin(n)}},atan:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'atan'`);return Math.atan(n)}},ceil:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'ceil'`);return Math.ceil(n)}},cos:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'cos'`);return Math.cos(n)}},e:{call:()=>Math.E},floor:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'floor'`);return Math.floor(n)}},ln:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'ln'`);return Math.log(n)}},ln2:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'ln2'`);return Math.log2(n)}},log10:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'log10'`);return Math.log10(n)}},max:{call:(e,t)=>Math.max(...t.args.map(t=>Number(e.evaluate(t))))},min:{call:(e,t)=>Math.min(...t.args.map(t=>Number(e.evaluate(t))))},clamp:{call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if(\"number\"!=typeof n||\"number\"!=typeof i||\"number\"!=typeof o)throw new Error(`invalid operands '${n}', ${i}, ${o} for operator 'clamp'`);return r.MathUtils.clamp(n,i,o)}},pi:{call:()=>Math.PI},round:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'round'`);return Math.round(n)}},sin:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'sin'`);return Math.sin(n)}},sqrt:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'sqrt'`);return Math.sqrt(n)}},tan:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'tan'`);return Math.tan(n)}}};t.MathOperators=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MiscOperators=void 0;const r={length:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(Array.isArray(n)||\"string\"==typeof n)return n.length;throw new Error(`invalid operand '${n}' for operator 'length'`)}},coalesce:{call:(e,t)=>{for(const n of t.args){const t=e.evaluate(n);if(null!==t)return t}return null}}};t.MiscOperators=r},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ObjectOperators=void 0;const r=n(19),i=n(1),o=Object.prototype.hasOwnProperty;var s;function a(e,t,n){var i;const a=e.evaluate(t[0]);if(\"string\"!=typeof a)throw new Error(\"expected the name of an attribute\");const l=e.evaluate(t[1]);if(l&&\"object\"==typeof l){if(r.Env.isEnv(l)){const e=null!==(i=l.lookup(a))&&void 0!==i?i:null;return n===s.get?e:null!==e}if(o.call(l,a))return n!==s.get||l[a]}return n===s.get&&null}!function(e){e[e.get=0]=\"get\",e[e.has=1]=\"has\"}(s||(s={}));const l={in:{call:(e,t)=>{const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return(\"string\"==typeof n&&\"string\"==typeof r||!!Array.isArray(r))&&r.includes(n)}},get:{call:(e,t)=>a(e,t.args,s.get)},has:{call:(e,t)=>a(e,t.args,s.has)},\"dynamic-properties\":{isDynamicOperator:()=>!0,call:(e,t)=>e.scope===i.ExprScope.Dynamic?e.env:t}};t.ObjectOperators=l},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.StringOperators=void 0;const r={concat:{call:(e,t)=>\"\".concat(...t.args.map(t=>String(e.evaluate(t))))},downcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleLowerCase()},upcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleUpperCase()},\"~=\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return\"string\"==typeof n&&\"string\"==typeof r&&n.includes(r)}},\"^=\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return\"string\"==typeof n&&\"string\"==typeof r&&n.startsWith(r)}},\"$=\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return\"string\"==typeof n&&\"string\"==typeof r&&n.endsWith(r)}}};t.StringOperators=r},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TypeOperators=void 0;t.TypeOperators={typeof:{call:(e,t)=>typeof e.evaluate(t.args[0])}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.VectorOperators=void 0;const r=n(0),i=n(1);function o(e,t,n){let i;switch(n){case\"vector2\":i=r.Vector2;break;case\"vector3\":i=r.Vector3;break;case\"vector4\":i=r.Vector4}for(const n of t.args){const t=e.evaluate(n);if(t instanceof i)return t}throw new Error(`expected a \"${n}\"`)}function s(e,t,n){let i,o;switch(n){case\"vector2\":i=r.Vector2,o=2;break;case\"vector3\":i=r.Vector3,o=3;break;case\"vector4\":i=r.Vector4,o=4}for(const n of t.args){const t=e.evaluate(n);if(t instanceof i)return t;if(Array.isArray(t)&&t.length===o&&t.every(e=>\"number\"==typeof e))return(new i).fromArray(t)}throw new Error(`expected a \"${n}\"`)}const a={\"make-vector\":{call:(e,t)=>{if(void 0!==t._value)return t._value;if(t.args.length<2)throw new Error(\"not enough arguments\");if(t.args.length>4)throw new Error(\"too many arguments\");const n=t.args.map(t=>e.evaluate(t));let o;switch(n.forEach((e,t)=>{if(\"number\"!=typeof e)throw new Error(`expected vector component at index ${t} to have type \"number\"`)}),n.length){case 2:o=(new r.Vector2).fromArray(n);break;case 3:o=(new r.Vector3).fromArray(n);break;case 4:o=(new r.Vector4).fromArray(n);break;default:throw new Error(\"too many arguments\")}return t.args.every(e=>e instanceof i.NumberLiteralExpr)&&(t._value=o),o}},vector2:{call:(e,t)=>o(e,t,\"vector2\")},vector3:{call:(e,t)=>o(e,t,\"vector3\")},vector4:{call:(e,t)=>o(e,t,\"vector4\")},\"to-vector2\":{call:(e,t)=>s(e,t,\"vector2\")},\"to-vector3\":{call:(e,t)=>s(e,t,\"vector3\")},\"to-vector4\":{call:(e,t)=>s(e,t,\"vector4\")}};t.VectorOperators=a},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExprInstantiator=void 0;const r=n(19),i=n(1),o=new r.Env;t.ExprInstantiator=class{visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const n=t.env.lookup(e.name);return i.LiteralExpr.fromValue(void 0!==n?n:null)}visitHasAttributeExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const n=void 0!==t.env.lookup(e.name);return i.LiteralExpr.fromValue(n)}visitCallExpr(e,t){const n=e.args.map(e=>e.accept(this,t));return n.some((t,n)=>t!==e.args[n])?new i.CallExpr(e.op,n):e}visitMatchExpr(e,t){const n=e.value.accept(this,t);if(n instanceof i.LiteralExpr){const r=n.value;for(const[n,i]of e.branches){if(Array.isArray(n)&&n.includes(r))return i.accept(this,t);if(n===r)return i.accept(this,t)}return e.fallback.accept(this,t)}let r=e.value!==n;const o=e.branches.map(([e,n])=>{const i=n.accept(this,t);return i!==n&&(r=!0),[e,i]}),s=e.fallback.accept(this,t);return s!==e.fallback&&(r=!0),r?new i.MatchExpr(n,o,s):e}visitCaseExpr(e,t){const n=[];let r=!1;for(const[s,a]of e.branches){const e=s.accept(this,t),l=e.dependencies();if(s.isDynamic()||0!==l.properties.size)e!==s&&(r=!0),n.push([e,a]);else if(Boolean(e.evaluate(o,i.ExprScope.Condition)))return a.accept(this,t)}if(0===n.length)return e.fallback.accept(this,t);n.length!==e.branches.length&&(r=!0),n.forEach(e=>{const n=e[1].accept(this,t);n!==e[1]&&(r=!0),e[1]=n});const s=e.fallback.accept(this,t);return s!==e.fallback&&(r=!0),r?new i.CaseExpr(n,s):e}visitStepExpr(e,t){const n=e.input.accept(this,t),r=e.defaultValue.accept(this,t),o=e.stops.map(([e,n])=>[e,n.accept(this,t)]);return new i.StepExpr(n,r,o)}visitInterpolateExpr(e,t){const n=e.input.accept(this,t),r=e.stops.map(([e,n])=>[e,n.accept(this,t)]);return new i.InterpolateExpr(e.mode,n,r)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExprParser=void 0;const r=n(1);var i,o;function s(e){switch(e){case i.Tab:case i.Lf:case i.Cr:case i.Space:return!0;default:return!1}}function a(e){return e>=i._0&&e<=i._9}function l(e){return e>=i.a&&e<=i.z||e>=i.A&&e<=i.Z}function c(e){return function(e){return l(e)||a(e)}(e)||e===i._||e===i.Dollar||e===i.Dot||e===i.LBracket||e===i.RBracket}function u(e){switch(e){case o.Eof:return\"eof\";case o.Error:return\"error\";case o.Identifier:return\"identifier\";case o.Number:return\"number\";case o.String:return\"string\";case o.Comma:return\",\";case o.LParen:return\"(\";case o.RParen:return\")\";case o.LBracket:return\"[\";case o.RBracket:return\"]\";case o.Exclaim:return\"!\";case o.TildeEqual:return\"~=\";case o.CaretEqual:return\"^=\";case o.DollarEqual:return\"$=\";case o.EqualEqual:return\"==\";case o.ExclaimEqual:return\"!=\";case o.Less:return\"<\";case o.Greater:return\">\";case o.LessEqual:return\"<=\";case o.GreaterEqual:return\">=\";case o.BarBar:return\"||\";case o.AmpAmp:return\"&&\";default:throw new Error(\"invalid token \"+e)}}!function(e){e[e.Tab=9]=\"Tab\",e[e.Lf=10]=\"Lf\",e[e.Cr=13]=\"Cr\",e[e.Space=32]=\"Space\",e[e.LParen=40]=\"LParen\",e[e.RParen=41]=\"RParen\",e[e.Comma=44]=\"Comma\",e[e.Dot=46]=\"Dot\",e[e.LBracket=91]=\"LBracket\",e[e.Backslash=92]=\"Backslash\",e[e.RBracket=93]=\"RBracket\",e[e._0=48]=\"_0\",e[e._9=57]=\"_9\",e[e._=95]=\"_\",e[e.A=64]=\"A\",e[e.Z=90]=\"Z\",e[e.a=97]=\"a\",e[e.z=122]=\"z\",e[e.DoubleQuote=34]=\"DoubleQuote\",e[e.SingleQuote=39]=\"SingleQuote\",e[e.Exclaim=33]=\"Exclaim\",e[e.Equal=61]=\"Equal\",e[e.Caret=94]=\"Caret\",e[e.Tilde=126]=\"Tilde\",e[e.Dollar=36]=\"Dollar\",e[e.Less=60]=\"Less\",e[e.Greater=62]=\"Greater\",e[e.Bar=124]=\"Bar\",e[e.Amp=38]=\"Amp\"}(i||(i={})),function(e){e[e.Eof=0]=\"Eof\",e[e.Error=1]=\"Error\",e[e.Identifier=2]=\"Identifier\",e[e.Number=3]=\"Number\",e[e.String=4]=\"String\",e[e.Comma=5]=\"Comma\",e[e.LParen=6]=\"LParen\",e[e.RParen=7]=\"RParen\",e[e.LBracket=8]=\"LBracket\",e[e.RBracket=9]=\"RBracket\",e[e.Exclaim=10]=\"Exclaim\",e[e.TildeEqual=11]=\"TildeEqual\",e[e.CaretEqual=12]=\"CaretEqual\",e[e.DollarEqual=13]=\"DollarEqual\",e[e.EqualEqual=14]=\"EqualEqual\",e[e.ExclaimEqual=15]=\"ExclaimEqual\",e[e.Less=16]=\"Less\",e[e.Greater=17]=\"Greater\",e[e.LessEqual=18]=\"LessEqual\",e[e.GreaterEqual=19]=\"GreaterEqual\",e[e.BarBar=20]=\"BarBar\",e[e.AmpAmp=21]=\"AmpAmp\"}(o||(o={}));class h{constructor(e){this.code=e,this.m_token=o.Error,this.m_index=0,this.m_char=i.Lf}token(){return this.m_token}text(){var e;return null!==(e=this.m_text)&&void 0!==e?e:\"\"}next(){if(this.m_token=this.yylex(),this.m_token===o.Error)throw new Error(\"unexpected character \"+this.m_char);return this.m_token}yyinp(){var e;this.m_char=null!==(e=this.code.codePointAt(this.m_index++))&&void 0!==e?e:0}yylex(){for(this.m_text=void 0;s(this.m_char);)this.yyinp();if(0===this.m_char)return o.Eof;const e=this.m_char;switch(this.yyinp(),e){case i.LParen:return o.LParen;case i.RParen:return o.RParen;case i.LBracket:return o.LBracket;case i.RBracket:return o.RBracket;case i.Comma:return o.Comma;case i.SingleQuote:case i.DoubleQuote:{const t=this.m_index-1;for(;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error(\"Unfinished string literal\");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),o.String}case i.Exclaim:return this.m_char===i.Equal?(this.yyinp(),o.ExclaimEqual):o.Exclaim;case i.Caret:return this.m_char===i.Equal?(this.yyinp(),o.CaretEqual):o.Error;case i.Tilde:return this.m_char===i.Equal?(this.yyinp(),o.TildeEqual):o.Error;case i.Equal:return this.m_char===i.Equal?(this.yyinp(),o.EqualEqual):o.Error;case i.Less:return this.m_char===i.Equal?(this.yyinp(),o.LessEqual):o.Less;case i.Greater:return this.m_char===i.Equal?(this.yyinp(),o.GreaterEqual):o.Greater;case i.Bar:return this.m_char===i.Bar?(this.yyinp(),o.BarBar):o.Error;case i.Amp:return this.m_char===i.Amp?(this.yyinp(),o.AmpAmp):o.Error;default:{const t=this.m_index-2;if(l(e)||e===i._||e===i.Dollar&&c(this.m_char)){for(;c(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),o.Identifier}if(a(e)){for(;a(this.m_char);)this.yyinp();if(this.m_char===i.Dot)for(this.yyinp();a(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),o.Number}if(e===i.Dollar)return this.m_char===i.Equal?(this.yyinp(),o.DollarEqual):o.Error}}return o.Error}}function d(e){switch(e){case o.TildeEqual:return\"~=\";case o.CaretEqual:return\"^=\";case o.DollarEqual:return\"$=\";case o.EqualEqual:return\"==\";case o.ExclaimEqual:return\"!=\";default:return}}function p(e){switch(e){case o.Less:return\"<\";case o.Greater:return\">\";case o.LessEqual:return\"<=\";case o.GreaterEqual:return\">=\";default:return}}t.ExprParser=class{constructor(e){this.lex=new h(e),this.lex.next()}parse(){return this.parseLogicalOr()}yyexpect(e){if(this.lex.token()!==e)throw new Error(`Syntax error: Expected token '${u(e)}' but found '${u(this.lex.token())}'`);this.lex.next()}parsePrimary(){switch(this.lex.token()){case o.Identifier:{const e=this.lex.text();switch(e){case\"has\":this.lex.next(),this.yyexpect(o.LParen);const t=this.lex.text();return this.yyexpect(o.Identifier),this.yyexpect(o.RParen),new r.HasAttributeExpr(t);case\"length\":this.lex.next(),this.yyexpect(o.LParen);const n=this.parseLogicalOr();return this.yyexpect(o.RParen),new r.CallExpr(\"length\",[n]);default:const i=new r.VarExpr(e);return this.lex.next(),i}}case o.LParen:{this.lex.next();const e=this.parseLogicalOr();return this.yyexpect(o.RParen),e}default:return this.parseLiteral()}}parseLiteral(){switch(this.lex.token()){case o.Number:{const e=new r.NumberLiteralExpr(parseFloat(this.lex.text()));return this.lex.next(),e}case o.String:{const e=new r.StringLiteralExpr(this.lex.text());return this.lex.next(),e}default:throw new Error(\"Syntax error\")}}parseUnary(){return this.lex.token()===o.Exclaim?(this.lex.next(),new r.CallExpr(\"!\",[this.parseUnary()])):this.parsePrimary()}parseRelational(){let e=this.parseUnary();for(;;)if(this.lex.token()===o.Identifier&&\"in\"===this.lex.text()){this.lex.next(),this.yyexpect(o.LBracket);const t=[this.parseLiteral()];for(;this.lex.token()===o.Comma;)this.lex.next(),t.push(this.parseLiteral());this.yyexpect(o.RBracket),e=new r.CallExpr(\"in\",[e,r.LiteralExpr.fromValue(t.map(({value:e})=>e))])}else{const t=p(this.lex.token());if(void 0===t)break;this.lex.next();const n=this.parseUnary();e=new r.CallExpr(t,[e,n])}return e}parseEquality(){let e=this.parseRelational();for(;;){let t=d(this.lex.token());if(void 0===t)break;\"~=\"===t&&(t=\"in\"),this.lex.next();const n=this.parseRelational();e=new r.CallExpr(t,[e,n])}return e}parseLogicalAnd(){const e=this.parseEquality();if(this.lex.token()!==o.AmpAmp)return e;const t=[e];do{this.lex.next(),t.push(this.parseEquality())}while(this.lex.token()===o.AmpAmp);return new r.CallExpr(\"all\",t)}parseLogicalOr(){const e=this.parseLogicalAnd();if(this.lex.token()!==o.BarBar)return e;const t=[e];do{this.lex.next(),t.push(this.parseLogicalAnd())}while(this.lex.token()===o.BarBar);return new r.CallExpr(\"any\",t)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isJsonExprReference=void 0,t.isJsonExprReference=function(e){return Array.isArray(e)&&2===e.length&&\"ref\"===e[0]&&\"string\"==typeof e[1]}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerServiceProtocol=void 0,function(e){let t,n;e.WORKER_SERVICE_MANAGER_SERVICE_ID=\"worker-service-manager\",function(e){e.Initialized=\"initialized\",e.Request=\"request\",e.Response=\"response\"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&\"string\"==typeof e.service&&\"string\"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService=\"create-service\",e.DestroyService=\"destroy-service\"}(n=e.Requests||(e.Requests={})),e.isUnknownServiceError=function(e){return e.message.includes(\"unknown targetServiceType requested: \")},e.isRequestMessage=function(e){return e&&\"string\"==typeof e.service&&\"string\"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&\"string\"==typeof e.service&&\"string\"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerTilerProtocol=void 0,function(e){let t;!function(e){e.RegisterIndex=\"register-index\",e.UpdateIndex=\"update-index\",e.TileRequest=\"tile-request\"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&\"string\"==typeof e.type&&e.type===t.RegisterIndex},e.isUpdateIndexRequest=function(e){return e&&\"string\"==typeof e.type&&e.type===t.UpdateIndex},e.isTileRequest=function(e){return e&&\"string\"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerDecoderProtocol=t.RequestController=void 0;t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,n;!function(e){e.Configuration=\"configuration\"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&\"string\"==typeof e.service&&\"string\"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest=\"decode-tile-request\",e.TileInfoRequest=\"tile-info-request\"}(n=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&\"string\"==typeof e.type&&e.type===n.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&\"string\"==typeof e.type&&e.type===n.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isGeoBoxExtentLike=void 0,t.isGeoBoxExtentLike=function(e){return e&&\"object\"==typeof e&&\"number\"==typeof e.latitudeSpan&&\"number\"==typeof e.longitudeSpan}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isGeoPolygonLike=void 0;const r=n(40);t.isGeoPolygonLike=function(e){if(!e||!Array.isArray(e.coordinates)&&e.coordinates.length>2)return!1;let t=!0;return e.coordinates.forEach(n=>{r.isGeoCoordLike(e)||(t=!1)}),t}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoPolygon=t.isAntimeridianCrossing=void 0;const r=n(0),i=n(8),o=n(4),s=n(40);function a(e,t){return Math.max(e,t)-Math.min(e,t)}function l(e,t){return e>0&&t<0&&a(e,t)>180}t.isAntimeridianCrossing=function(e,t){return Math.sign(e)===-Math.sign(t)&&a(e,t)>180};t.GeoPolygon=class{constructor(e,t=!1,n=!1){this.m_coordinates=e.map(e=>s.geoCoordLikeToGeoCoordinatesLike(e)),t&&this.sortCCW(),n&&this.wrapCoordinatesAround()}get coordinates(){return this.m_coordinates}getGeoBoundingBox(){const e=this.getCentroid();if(void 0===e)return i.GeoBox.fromCoordinates(this.coordinates[0],this.coordinates[0]);const{east:t,west:n}=this.getEastAndWest(e),{north:r,south:s}=this.getNorthAndSouth();return i.GeoBox.fromCoordinates(new o.GeoCoordinates(s,n),new o.GeoCoordinates(r,t))}getCentroid(){const e=this.getArea();if(0===e)return;let t,n=0,r=0,i=this.m_coordinates.length-1;return this.m_coordinates.forEach((e,o)=>{const s=this.m_coordinates[i];t=e.latitude*s.longitude-s.latitude*e.longitude,n+=(e.latitude+s.latitude)*t,r+=(e.longitude+s.longitude)*t,i=o}),t=6*e,new o.GeoCoordinates(n/t,e<0?r/t-180:r/t)}sortCCW(){const e=this.getPolyAverageCenter();e&&this.m_coordinates.sort((t,n)=>{const i=new r.Vector2(t.latitude-e.latitude,t.longitude-e.longitude).normalize();return new r.Vector2(n.latitude-e.latitude,n.longitude-e.longitude).normalize().angle()-i.angle()})}wrapCoordinatesAround(){const e=this.m_coordinates.findIndex((e,t)=>{const n=0===t?this.m_coordinates.length-1:t-1;return l(this.m_coordinates[n].longitude,e.longitude)});if(e<0)return;let t=!0;for(let n=0;n<this.m_coordinates.length;n++){const r=(e+n)%this.m_coordinates.length,i=this.m_coordinates[r].longitude,o=this.m_coordinates[(r+1)%this.m_coordinates.length].longitude;t&&(this.m_coordinates[r].longitude+=360),l(o,i)?t=!1:l(i,o)&&(t=!0)}}getPolyAverageCenter(){const e=this.m_coordinates.reduce((e,t)=>new o.GeoCoordinates(e.latitude+t.latitude,e.longitude+t.longitude));return new o.GeoCoordinates(e.latitude/this.m_coordinates.length,e.longitude/this.m_coordinates.length)}getArea(){let e=0,t=this.m_coordinates.length-1;return this.m_coordinates.forEach((n,r)=>{const i=this.m_coordinates[t];e+=n.latitude*i.longitude,e-=n.longitude*i.latitude,t=r}),e/=2}getEastAndWest(e){let t=e.longitude,n=e.longitude,i=this.m_coordinates.length-1;return this.m_coordinates.forEach((o,s)=>{const a=this.m_coordinates[i];i=s;const l=new r.Vector2(o.latitude-e.latitude,o.longitude-e.longitude).normalize(),c=new r.Vector2(a.latitude-e.latitude,a.longitude-e.longitude).normalize();let u=1===Math.sign(c.angle()-l.angle());c.y>=0&&l.y<0&&(u=!0);const h=o.longitude;h<e.longitude?u?t=Math.min(t,h):n=Math.min(n,h):u?n=Math.max(n,h):t=Math.max(t,h)}),{east:n,west:t}}getNorthAndSouth(){let e=o.MIN_LATITUDE,t=o.MAX_LATITUDE;return this.m_coordinates.forEach((n,r)=>{e=Math.max(e,n.latitude),t=Math.min(t,n.latitude)}),{north:e,south:t}}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.identityProjection=void 0;const r=n(0),i=n(8),o=n(4),s=n(10),a=n(6),l=n(11),c=n(12);class u extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,n){return n||(n=new r.Box3),n.min.x=-Math.PI,n.min.y=.5*-Math.PI,n.min.z=e,n.max.x=Math.PI,n.max.y=.5*Math.PI,n.max.z=t,n}projectPoint(e,t){var n;return t||(t={x:0,y:0,z:0}),t.x=r.MathUtils.degToRad(e.longitude),t.y=r.MathUtils.degToRad(e.latitude),t.z=null!==(n=e.altitude)&&void 0!==n?n:0,t}unprojectPoint(e){return o.GeoCoordinates.fromRadians(e.y,e.x,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){t||(t=new r.Box3);const n=this.projectPoint(new o.GeoCoordinates(e.south,e.west,e.minAltitude)),i=this.projectPoint(new o.GeoCoordinates(e.north,e.east,e.maxAltitude));return s.isBox3Like(t)?(t.min.x=n.x,t.min.y=n.y,t.min.z=n.z,t.max.x=i.x,t.max.y=i.y,t.max.z=i.z):l.isOrientedBox3Like(t)&&(a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(n.x+i.x),t.position.y=.5*(n.y+i.y),t.position.z=.5*(n.z+i.z),t.extents.x=.5*(i.x-n.x),t.extents.y=.5*(i.y-n.y),t.extents.z=Math.max(Number.EPSILON,.5*(i.z-n.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return i.GeoBox.fromCoordinates(t,n)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}t.identityProjection=new u(1)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.sphereProjection=void 0;const r=n(0),i=n(4),o=n(9),s=n(10),a=n(6),l=n(11),c=n(13),u=n(20),h=n(12);function d(e){const t=1/Math.PI,n=Math.floor(2*(e*t+1));return r.MathUtils.clamp(n,0,4)}function p(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function f(e,t,n){var i;const o=.5*(n+(null!==(i=e.maxAltitude)&&void 0!==i?i:0)),s=r.MathUtils.degToRad(e.west),a=r.MathUtils.degToRad(e.east),l=d(s),c=d(a);let u=Math.cos(s),h=u,p=Math.sin(s),f=p;for(let e=l+1;e<=c;e++){const t=(e+1&1)*((2&e)-1);u=Math.min(t,u),h=Math.max(t,h);const n=(1&e)*((2&e)-1);p=Math.min(n,p),f=Math.max(n,f)}const m=Math.cos(a);u=Math.min(m,u),h=Math.max(m,h);const g=Math.sin(a);p=Math.min(g,p),f=Math.max(g,f);const v=(h+u)*o,y=(h-u)*o,x=(f+p)*o,_=(f-p)*o,b=r.MathUtils.degToRad(e.south),w=r.MathUtils.degToRad(e.north),M=Math.sin(w),S=Math.sin(b),T=(M+S)*o,E=(M-S)*o;return t.min.x=v-y,t.min.y=x-_,t.min.z=T-E,t.max.x=v+y,t.max.y=x+_,t.max.z=T+E,t}class m extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Spherical}worldExtent(e,t,n=new r.Box3){const i=this.unitScale+t;return n.min.x=-i,n.min.y=-i,n.min.z=-i,n.max.x=i,n.max.y=i,n.max.z=i,n}projectPoint(e,t=a.MathUtils.newVector3(0,0,0)){return function(e,t,n){var i;const o=n+(null!==(i=e.altitude)&&void 0!==i?i:0),s=r.MathUtils.degToRad(e.latitude),a=r.MathUtils.degToRad(e.longitude),l=Math.cos(s);return t.x=o*l*Math.cos(a),t.y=o*l*Math.sin(a),t.z=o*Math.sin(s),t}(e,t,this.unitScale)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,n=Math.sqrt(t),r=e.z/n;if(isNaN(r))return i.GeoCoordinates.fromRadians(0,0,-this.unitScale);const o=Math.sqrt(t+e.z*e.z);return i.GeoCoordinates.fromRadians(Math.atan(r),Math.atan2(e.y,e.x),o-this.unitScale)}unprojectAltitude(e){const t=e.x*e.x+e.y*e.y+e.z*e.z;return Math.sqrt(t)-c.EarthConstants.EQUATORIAL_RADIUS}projectBox(e,t=new r.Box3){var n,i;if(s.isBox3Like(t))return f(e,t,this.unitScale);if(l.isOrientedBox3Like(t)){if(e.longitudeSpan>=90){const n=f(e,new r.Box3,this.unitScale);return a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(n.max.x+n.min.x),t.position.y=.5*(n.max.y+n.min.y),t.position.z=.5*(n.max.z+n.min.z),t.extents.x=.5*(n.max.x-n.min.x),t.extents.y=.5*(n.max.y-n.min.y),t.extents.z=.5*(n.max.z-n.min.z),t}const{south:o,west:s,north:l,east:c,center:u}=e,h=u.longitude,d=u.latitude,p=Math.cos(r.MathUtils.degToRad(o)),m=Math.sin(r.MathUtils.degToRad(o)),g=Math.cos(r.MathUtils.degToRad(s)),v=Math.sin(r.MathUtils.degToRad(s)),y=Math.cos(r.MathUtils.degToRad(l)),x=Math.sin(r.MathUtils.degToRad(l)),_=Math.cos(r.MathUtils.degToRad(c)),b=Math.sin(r.MathUtils.degToRad(c)),w=Math.cos(r.MathUtils.degToRad(h)),M=Math.sin(r.MathUtils.degToRad(h)),S=Math.cos(r.MathUtils.degToRad(d)),T=Math.sin(r.MathUtils.degToRad(d));let E,L,A;a.MathUtils.newVector3(w*S,M*S,T,t.zAxis),a.MathUtils.newVector3(-M,w,0,t.xAxis),a.MathUtils.newVector3(-w*T,-M*T,S,t.yAxis),o>=0?(E=Math.abs(p*(w*(v-b)+M*(_-g))),L=S*m-T*p,A=S*x-T*y*(w*_+M*b)):(l<=0?(E=Math.abs(y*(w*(v-b)+M*(_-g))),A=S*x-T*y):(E=Math.abs(w*(v-b)+M*(_-g)),A=S*x-T*y*(M*b+w*_)),L=S*m-T*p*(w*_+M*b));const P=.5*(this.unitScale+(null!==(n=e.maxAltitude)&&void 0!==n?n:0)),C=.5*(this.unitScale+(null!==(i=e.minAltitude)&&void 0!==i?i:0)),R=S*(w*_+M*b),I=Math.min(y*R+x*T,p*R+m*T);return a.MathUtils.newVector3(E*P,(A-L)*P,P-I*C,t.extents),a.MathUtils.newVector3(0,(L+A)*P,P+P,t.position),function(e,t,n,r){const i=e.x*r.x+t.x*r.y+n.x*r.z,o=e.y*r.x+t.y*r.y+n.y*r.z,s=e.z*r.x+t.z*r.y+n.z*r.z;r.x=i,r.y=o,r.z=s}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error(\"Invalid bounding box\")}unprojectBox(e){throw new Error(\"Method not implemented.\")}getScaleFactor(e){return 1}groundDistance(e){return p(e)-this.unitScale}scalePointToSurface(e){const t=this.unitScale/(p(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}surfaceNormal(e,t){void 0===t&&(t={x:0,y:0,z:0});const n=1/(p(e)||1);return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t}reprojectPoint(e,t,n){if(e===u.mercatorProjection||e===u.webMercatorProjection){const{x:r,y:i,z:o}=t,s=this.unitScale,a=r/s-Math.PI,l=i/s-Math.PI,c=Math.exp(l),h=c*c,d=2*c/(h+1),p=(h-1)/(h+1),f=s+o;return void 0===n&&(n={}),n.x=Math.cos(a)*d*f,n.y=Math.sin(a)*d*f,n.z=p*f,e===u.webMercatorProjection&&(n.z=-n.z),n}return super.reprojectPoint(e,t,n)}localTangentSpace(e,t){let n;o.isGeoCoordinatesLike(e)?(this.projectPoint(e,t.position),n=e):(a.MathUtils.copyVector3(e,t.position),n=this.unprojectPoint(e));const i=r.MathUtils.degToRad(n.latitude),s=r.MathUtils.degToRad(n.longitude),l=Math.cos(s),c=Math.sin(s),u=Math.cos(i),h=Math.sin(i);return a.MathUtils.newVector3(l*u,c*u,h,t.zAxis),a.MathUtils.newVector3(-c,l,0,t.xAxis),a.MathUtils.newVector3(-l*h,-c*h,u,t.yAxis),t}}t.sphereProjection=new m(c.EarthConstants.EQUATORIAL_RADIUS)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.QuadTree=void 0;const r=n(22);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(r.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const n of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(n,t)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.hereTilingScheme=void 0;const r=n(41),i=n(44),o=n(14);t.hereTilingScheme=new o.TilingScheme(i.halfQuadTreeSubdivisionScheme,r.normalizedEquirectangularProjection)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.webMercatorTilingScheme=void 0;const r=n(20),i=n(21),o=n(14);t.webMercatorTilingScheme=new o.TilingScheme(i.quadTreeSubdivisionScheme,r.webMercatorProjection)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.mercatorTilingScheme=void 0;const r=n(20),i=n(21),o=n(14);t.mercatorTilingScheme=new o.TilingScheme(i.quadTreeSubdivisionScheme,r.mercatorProjection)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.polarTilingScheme=void 0;const r=n(42),i=n(21),o=n(14);t.polarTilingScheme=new o.TilingScheme(i.quadTreeSubdivisionScheme,r.transverseMercatorProjection)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isVector2Like=void 0,t.isVector2Like=function(e){return e&&\"number\"==typeof e.x&&\"number\"==typeof e.y}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isVector3Like=void 0,t.isVector3Like=function(e){return e&&\"number\"==typeof e.x&&\"number\"==typeof e.y&&\"number\"==typeof e.z}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isTransformLike=void 0,t.isTransformLike=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.OrientedBox3=void 0;const r=n(0);function i(e,t,n,r,i){const o=n.dot(t),s=n.dot(e);if(Math.abs(s)<1e-20)return Math.abs(o)<=r;const a=1/s,l=(o+r)*a,c=(o-r)*a;return l>c?(c>i.min&&(i.min=c),l<i.max&&(i.max=l)):(l>i.min&&(i.min=l),c<i.max&&(i.max=c)),i.min<=i.max&&i.max>=0}const o=new r.Vector3,s={min:-1/0,max:1/0};class a{constructor(e,t,n){this.position=new r.Vector3,this.xAxis=new r.Vector3(1,0,0),this.yAxis=new r.Vector3(0,1,0),this.zAxis=new r.Vector3(0,0,1),this.extents=new r.Vector3,void 0!==e&&this.position.copy(e),void 0!==t&&t.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==n&&this.extents.copy(n)}clone(){const e=new a;return e.copy(this),e}copy(e){this.position.copy(e.position),this.xAxis.copy(e.xAxis),this.yAxis.copy(e.yAxis),this.zAxis.copy(e.zAxis),this.extents.copy(e.extents)}getCenter(e=new r.Vector3){return e.copy(this.position)}getSize(e=new r.Vector3){return e.copy(this.extents).multiplyScalar(2)}getRotationMatrix(e=new r.Matrix4){return e.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(e){const t=Array.isArray(e)?e:e.planes;for(const e of t){const t=Math.abs(e.normal.dot(this.xAxis)*this.extents.x)+Math.abs(e.normal.dot(this.yAxis)*this.extents.y)+Math.abs(e.normal.dot(this.zAxis)*this.extents.z);if(e.distanceToPoint(this.position)+t<0)return!1}return!0}intersectsRay(e){if(s.min=-1/0,s.max=1/0,o.copy(this.position).sub(e.origin),i(e.direction,o,this.xAxis,this.extents.x,s)&&i(e.direction,o,this.yAxis,this.extents.y,s)&&i(e.direction,o,this.zAxis,this.extents.z,s))return s.min>0?s.min:s.max}contains(e){const t=e.x-this.position.x,n=e.y-this.position.y,r=e.z-this.position.z,i=Math.abs(t*this.xAxis.x+n*this.xAxis.y+r*this.xAxis.z),o=Math.abs(t*this.yAxis.x+n*this.yAxis.y+r*this.yAxis.z),s=Math.abs(t*this.zAxis.x+n*this.zAxis.y+r*this.zAxis.z);return!(i>this.extents.x||o>this.extents.y||s>this.extents.z)}distanceToPoint(e){return Math.sqrt(this.distanceToPointSquared(e))}distanceToPointSquared(e){const t=new r.Vector3;t.subVectors(e,this.position);const n=[t.dot(this.xAxis),t.dot(this.yAxis),t.dot(this.zAxis)];let i=0;for(let e=0;e<3;++e){const t=n[e],r=this.extents.getComponent(e);if(t<-r){const e=r+t;i+=e*e}else if(t>r){const e=t-r;i+=e*e}}return i}}t.OrientedBox3=a},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ThemeVisitor=void 0;const r=n(1);t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=t=>!r.isJsonExpr(t)&&!!e(t);if(void 0!==this.theme.styles)for(const e in this.theme.styles)if(void 0!==this.theme.styles[e])for(const n of this.theme.styles[e])if(t(n))return!0;return!1}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.makeDecodedTechnique=t.StyleSetEvaluator=void 0;const r=n(2),i=n(1),o=n(126),s=n(28),a=n(127),l=n(29),c=r.LoggerManager.instance.create(\"StyleSetEvaluator\"),u=a.AttrScope.TechniqueGeometry;class h{classify(e){if(e._whenExpr){const t=this.switchStyle(e);e._whenExpr=e._whenExpr.accept(this,void 0),this._style=t}}visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){return e}visitHasAttributeExpr(e,t){return e}visitMatchExpr(e,t){return e}visitCaseExpr(e,t){return e}visitCallExpr(e,t){if(\"all\"===e.op){const t=e.args.map(t=>t.accept(this,e)).filter(e=>void 0!==e);return new i.CallExpr(e.op,t)}if(t){const t=this.matchVarStringComparison(e);if(t){if(void 0===this._style.layer&&\"$layer\"===t.name)return void(this._style.layer=t.value);if(void 0===this._style._geometryType&&\"$geometryType\"===t.name)return void(this._style._geometryType=t.value)}}return e}visitStepExpr(e,t){return e}visitInterpolateExpr(e,t){return e}matchVarStringComparison(e){if(\"==\"===e.op){const t=e.args[0],n=e.args[1];if(t instanceof i.VarExpr&&n instanceof i.StringLiteralExpr)return{name:t.name,value:n.value};if(n instanceof i.VarExpr&&t instanceof i.StringLiteralExpr)return{name:n.name,value:t.value}}}switchStyle(e){const t=this._style;return this._style=e,t}}class d{constructor(e,t){this.key=\"\",this.set(e,t)}set(e,t,n){let r=!1;if(void 0===e){const t=void 0!==n?n.lookup(\"$layer\"):void 0;e=\"string\"==typeof t?t:void 0}if(this.layer!==e&&(this.layer=e,r=!0),void 0===t){const e=void 0!==n?n.lookup(\"$geometryType\"):void 0;t=\"string\"==typeof e?e:void 0}return this.geometryType!==t&&(this.geometryType=t,r=!0),r&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=this.layer+\":\":void 0!==this.geometryType?this.key=\":\"+this.geometryType:this.key=\"all\",this.cachedStyleSet=void 0}}function p(e){const t={};for(const n in e){if(!e.hasOwnProperty(n))continue;let r=e[n];\"object\"==typeof r&&(r.isVector2||r.isVector3||r.isVector4)&&(r=i.LiteralExpr.fromValue(r)),i.Expr.isExpr(r)&&(r=r.toJSON()),t[n]=r}return t}t.StyleSetEvaluator=class{constructor(e){var t;this.m_options=e,this.m_techniques=[],this.m_exprPool=new o.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new h,this.m_subStyleSetCache=new Map,this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new d,this.m_emptyEnv=new i.Env,this.m_featureDependencies=[],this.m_nextArrayBufferId=0,this.m_definitions=this.m_options.definitions,this.styleSet=(t=this.m_options.styleSet,this.m_definitions,t.map(e=>function(e,t){return Object.assign({},e)}(e))),function(e){let t=0,n=0;for(const r of e)r._styleSetIndex=n++,void 0!==r.technique&&void 0===r.renderOrder&&(r.renderOrder=t++)}(this.styleSet),this.compileStyleSet()}getMatchingTechniques(e,t,n){if(this.m_previousResult&&this.m_previousEnv&&this.m_featureDependencies.every(t=>{var n;return(null===(n=this.m_previousEnv)||void 0===n?void 0:n.lookup(t))===e.lookup(t)}))return this.m_previousResult;const r=[];this.m_cachedResults.clear();const i=this.m_tmpOptimizedSubSetKey;i.set(t,n,e),this.m_layer=i.layer,this.m_geometryType=i.geometryType,this.m_zoomLevel=e.lookup(\"$zoom\");const o=this.getOptimizedStyleSet(i);for(const t of o)if(this.processStyle(e,t,r))break;return this.m_previousResult=r,this.m_previousEnv=e,r}wantsLayer(e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,void 0)).length>0}wantsFeature(e,t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,t)).length>0}get expressionEvaluatorCache(){return this.m_cachedResults}resetTechniques(){for(const e of this.m_techniques)e._index=void 0;this.m_techniques.length=0,this.m_previousResult=void 0,this.m_previousEnv=void 0}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(p)}getOptimizedStyleSet(e){if(void 0!==e.cachedStyleSet)return e.cachedStyleSet;let t=this.m_subStyleSetCache.get(e.key);return void 0!==t?(e.cachedStyleSet=t,t):(t=this.createPreFilteredStyleSet(e),this.m_subStyleSetCache.set(e.key,t),e.cachedStyleSet=t,t)}createPreFilteredStyleSet(e){const{layer:t,geometryType:n}=e;return this.styleSet.filter(e=>(void 0===t||void 0===e.layer||e.layer===t)&&(void 0===n||void 0===e._geometryType||e._geometryType===n))}compileStyleSet(){this.m_featureDependencies=[\"$layer\",\"$geometryType\",\"$zoom\"],this.styleSet.forEach(e=>this.compileStyle(e)),this.styleSet.forEach(e=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e.layer,e._geometryType))})}compileStyle(e){if(this.checkStyleDynamicAttributes(e),void 0!==e.when)try{e._whenExpr=Array.isArray(e.when)?i.Expr.fromJSON(e.when,this.m_definitions,this.m_definitionExprCache):i.Expr.parse(e.when),this.m_styleConditionClassifier.classify(e),void 0!==e._whenExpr&&(e._whenExpr=e._whenExpr.intern(this.m_exprPool));const t=e._whenExpr.dependencies();null==t||t.properties.forEach(e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)}),i.isJsonExpr(e.minZoomLevel)&&(e._minZoomLevelExpr=i.Expr.fromJSON(e.minZoomLevel).intern(this.m_exprPool)),i.isJsonExpr(e.maxZoomLevel)&&(e._maxZoomLevelExpr=i.Expr.fromJSON(e.maxZoomLevel).intern(this.m_exprPool))}catch(t){c.log(\"failed to evaluate expression\",JSON.stringify(e.when),\"error\",String(t))}}processStyle(e,t,n){if(!this.checkZoomLevel(e,t))return!1;if(void 0!==this.m_layer&&void 0!==t.layer&&t.layer!==this.m_layer)return!1;if(void 0!==this.m_geometryType&&void 0!==t._geometryType&&t._geometryType!==this.m_geometryType)return!1;if(t._whenExpr)try{if(!t._whenExpr.evaluate(e,i.ExprScope.Condition,this.m_cachedResults))return!1}catch(e){return c.error(`failed to evaluate expression '${JSON.stringify(t.when)}': ${e}`),!1}return void 0!==t.technique&&(\"none\"!==t.technique&&n.push(this.getTechniqueForStyleMatch(e,t)),!0===t.final)}checkZoomLevel(e,t){var n,r;if(void 0===t.minZoomLevel&&void 0===t.maxZoomLevel)return!0;const o=this.m_zoomLevel;if(void 0===o)return!0;if(void 0!==t.minZoomLevel){let r=t.minZoomLevel;if(!1===(null===(n=t._minZoomLevelExpr)||void 0===n?void 0:n.isDynamic()))try{r=t._minZoomLevelExpr.evaluate(e,i.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._minZoomLevelExpr)}': ${e}`)}if(\"number\"==typeof r&&o<r)return!1}if(void 0!==t.maxZoomLevel){let n=t.maxZoomLevel;if(!1===(null===(r=t._maxZoomLevelExpr)||void 0===r?void 0:r.isDynamic()))try{n=t._maxZoomLevelExpr.evaluate(e,i.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._maxZoomLevelExpr)}': ${e}`)}if(\"number\"==typeof n&&o>=n)return!1}return!0}getTechniqueForStyleMatch(e,t){let n;if(void 0!==t._dynamicTechniques){const r=this.evaluateTechniqueProperties(t,e),i=this.getDynamicTechniqueKey(t,r);n=t._dynamicTechniques.get(i),void 0===n&&(n=this.createTechnique(t,i,r),t._dynamicTechniques.set(i,n))}else n=t._staticTechnique,void 0===n&&(t._staticTechnique=n=this.createTechnique(t,\"\"+t._styleSetIndex,[]));return void 0===n._index&&(n._index=this.m_techniques.length,this.m_techniques.push(n)),n}getDynamicTechniqueKey(e,t){const n=t.map(([e,t])=>void 0===t?\"U\":\"object\"==typeof t?JSON.stringify(t,(e,t)=>{if(t instanceof ArrayBuffer){let e=t.id;return void 0===e&&(e=t.id=this.m_nextArrayBufferId++),e}return t}):JSON.stringify(t)).join(\":\");return`${e._styleSetIndex}:${n}`}checkStyleDynamicAttributes(e){var t;if(void 0!==e._dynamicTechniqueAttributes||\"none\"===e.technique)return;e._dynamicTechniqueAttributes=[],e._dynamicFeatureAttributes=[],e._dynamicForwardedAttributes=[],e._staticAttributes=[];const n=e._dynamicFeatureAttributes,r=e._dynamicTechniqueAttributes,o=e._dynamicForwardedAttributes,l=e._staticAttributes,h=(t,h)=>{if(void 0!==h){if(i.isJsonExpr(h)?h=i.Expr.fromJSON(h,this.m_definitions,this.m_definitionExprCache).intern(this.m_exprPool):s.isInterpolatedPropertyDefinition(h)&&(h=i.Expr.fromJSON(s.interpolatedPropertyDefinitionToJsonExpr(h)).intern(this.m_exprPool)),i.Expr.isExpr(h)){const n=h.dependencies();n.featureState&&(\"enabled\"!==t?c.log(\"feature-state is not supported in this context\"):e._usesFeatureState=!0),0!==n.properties.size||h.isDynamic()||(h=h.evaluate(this.m_emptyEnv))}if(i.Expr.isExpr(h)){const i=function(e,t){var n,r;return\"extruded-polygon\"===e.technique&&\"color\"===t&&!1!==e.vertexColors?u:null!==(r=null===(n=a.getTechniqueAttributeDescriptor(e.technique,t))||void 0===n?void 0:n.scope)&&void 0!==r?r:u}(e,t),s=h.dependencies();switch(s.properties.forEach(e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)}),i){case a.AttrScope.FeatureGeometry:n.push([t,h]);break;case a.AttrScope.TechniqueGeometry:r.push([t,h]);break;case a.AttrScope.TechniqueRendering:0===s.properties.size?o.push([t,h]):r.push([t,h])}}else null!=h&&l.push([t,h])}},d=new Map([[\"category\",\"_category\"],[\"secondaryCategory\",\"_secondaryCategory\"]]);for(const n in e){if(!e.hasOwnProperty(n))continue;if(n.startsWith(\"_\"))continue;if([\"when\",\"technique\",\"layer\",\"attr\",\"description\"].includes(n))continue;h(null!==(t=d.get(n))&&void 0!==t?t:n,e[n])}if(void 0!==e.attr)for(const t in e.attr)e.attr.hasOwnProperty(t)&&h(t,e.attr[t]);r.length>0&&(e._dynamicTechniques=new Map)}evaluateTechniqueProperties(e,t){return void 0===e._dynamicTechniqueAttributes?[]:e._dynamicTechniqueAttributes.map(([e,n])=>{try{return[e,n.evaluate(t,i.ExprScope.Value,this.m_cachedResults)]}catch(t){return c.error(`failed to evaluate expression '${n.toJSON()}': ${t}`),[e,null]}})}createTechnique(e,t,n){var r,i;const o={};if(o.name=e.technique,void 0!==e._staticAttributes)for(const[t,n]of e._staticAttributes)null!==n&&(o[t]=n);for(const[e,t]of n)null!==t&&(o[e]=t);if(void 0!==e._dynamicFeatureAttributes)for(const[t,n]of e._dynamicFeatureAttributes)o[t]=n;if(void 0!==e._dynamicForwardedAttributes)for(const[t,n]of e._dynamicForwardedAttributes)o[t]=n;return o._index=this.m_techniques.length,o._styleSetIndex=e._styleSetIndex,void 0!==e.styleSet&&(o._styleSet=e.styleSet),void 0!==e._usesFeatureState&&(o._usesFeatureState=e._usesFeatureState),l.setTechniqueRenderOrderOrPriority(o,null!==(r=this.m_options.priorities)&&void 0!==r?r:[],null!==(i=this.m_options.labelPriorities)&&void 0!==i?i:[]),this.m_techniques.push(o),o}},t.makeDecodedTechnique=p},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExprPool=void 0;const r=n(1);t.ExprPool=class{constructor(){this.m_booleanLiterals=new Map,this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiterals=new Map,this.m_arrayLiterals=[],this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_matchExprs=[],this.m_caseExprs=[],this.m_interpolateExprs=[],this.m_stepExprs=[],this.m_callExprs=new Map}add(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return r.NullLiteralExpr.instance}visitBooleanLiteralExpr(e,t){const n=this.m_booleanLiterals.get(e.value);return n||(this.m_booleanLiterals.set(e.value,e),e)}visitNumberLiteralExpr(e,t){const n=this.m_numberLiterals.get(e.value);return n||(this.m_numberLiterals.set(e.value,e),e)}visitStringLiteralExpr(e,t){const n=this.m_stringLiterals.get(e.value);return n||(this.m_stringLiterals.set(e.value,e),e)}visitObjectLiteralExpr(e,t){const n=this.m_objectLiterals.get(e.value);if(n)return n;if(Array.isArray(e.value)){const t=e.value,n=this.m_arrayLiterals.find(e=>{const n=e.value;return n.length===t.length&&t.every((e,t)=>e===n[t])});if(void 0!==n)return n;this.m_arrayLiterals.push(e)}return this.m_objectLiterals.set(e.value,e),e}visitVarExpr(e,t){const n=this.m_varExprs.get(e.name);return n||(this.m_varExprs.set(e.name,e),e)}visitHasAttributeExpr(e,t){const n=this.m_hasAttributeExprs.get(e.name);return n||(this.m_hasAttributeExprs.set(e.name,e),e)}visitMatchExpr(e,t){const n=e.value.accept(this,t),i=e.branches.map(([e,n])=>[e,n.accept(this,t)]),o=e.fallback.accept(this,t);for(const e of this.m_matchExprs){if(e.value!==n)continue;if(e.fallback!==o)continue;if(e.branches.length!==i.length)continue;let t=!0;for(let n=0;n<i.length;n++)if(i[n][0]!==e.branches[n][0]||i[n][1]!==e.branches[n][1]){t=!1;break}if(t)return e}const s=new r.MatchExpr(n,i,o);return this.m_matchExprs.push(s),s}visitCaseExpr(e,t){const n=e.branches.map(([e,n])=>[e.accept(this,t),n.accept(this,t)]),i=e.fallback.accept(this,t);for(const e of this.m_caseExprs){if(e.fallback!==i)continue;if(e.branches.length!==n.length)continue;let t=!0;for(let r=0;r<n.length;r++)if(n[r][0]!==e.branches[r][0]||n[r][1]!==e.branches[r][1]){t=!1;break}if(t)return e}const o=new r.CaseExpr(n,i);return this.m_caseExprs.push(o),o}visitCallExpr(e,t){const n=e.args.map(e=>e.accept(this,t));this.m_callExprs.has(e.op)||this.m_callExprs.set(e.op,[]);const i=this.m_callExprs.get(e.op);for(const e of i){if(e.args.length!==n.length)continue;let t=0;for(;t<e.args.length&&e.args[t]===n[t];++t);if(t===e.args.length)return e}const o=new r.CallExpr(e.op,n);return o.descriptor=e.descriptor,i.push(o),o}visitStepExpr(e,t){if(this.m_stepExprs.includes(e))return e;const n=e.input.accept(this,t),i=e.defaultValue.accept(this,t),o=e.stops.map(e=>{const n=e[0],r=e[1].accept(this,t);return r===e[1]?e:[n,r]});for(const e of this.m_stepExprs)if(e.input===n&&e.defaultValue===i&&o.length===e.stops.length&&o.every(([t,n],r)=>t===e.stops[r][0]&&n===e.stops[r][1]))return e;const s=new r.StepExpr(n,i,o);return this.m_stepExprs.push(s),s}visitInterpolateExpr(e,t){if(this.m_interpolateExprs.includes(e))return e;const n=e.input.accept(this,t),i=e.stops.map(e=>{const n=e[0],r=e[1].accept(this,t);return r===e[1]?e:[n,r]});for(const t of this.m_interpolateExprs)if(t.input===n&&t.mode[0]===e.mode[0]&&t.mode[1]===e.mode[1]&&i.length===t.stops.length&&i.every(([e,n],r)=>e===t.stops[r][0]&&n===t.stops[r][1]))return t;const o=new r.InterpolateExpr(e.mode,n,i);return this.m_interpolateExprs.push(o),o}}},function(e,t,n){\"use strict\";var r;function i(...e){const t={attrDescriptors:{}};for(const n of e)void 0!==n.attrTransparencyColor&&(t.attrTransparencyColor=n.attrTransparencyColor),void 0!==n.attrDescriptors&&(t.attrDescriptors=Object.assign(Object.assign({},t.attrDescriptors),n.attrDescriptors));return t}Object.defineProperty(t,\"__esModule\",{value:!0}),t.getTechniqueAutomaticAttrs=t.getTechniqueAttributeDescriptor=t.getTechniqueDescriptor=t.AttrScope=void 0,function(e){e[e.FeatureGeometry=0]=\"FeatureGeometry\",e[e.TechniqueGeometry=1]=\"TechniqueGeometry\",e[e.TechniqueRendering=2]=\"TechniqueRendering\"}(r=t.AttrScope||(t.AttrScope={}));const o={attrTransparencyColor:\"color\",attrDescriptors:{constantHeight:r.FeatureGeometry,enabled:r.FeatureGeometry,fadeFar:r.TechniqueRendering,fadeNear:r.TechniqueRendering,transparent:{scope:r.TechniqueRendering,automatic:!0},side:{scope:r.TechniqueRendering,automatic:!0}}},s=i(o,{attrDescriptors:{color:{scope:r.TechniqueRendering,automatic:!0},size:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0}}}),a=i(o,s),l=i(o,s),c=i(o,{attrDescriptors:{text:r.FeatureGeometry,label:r.FeatureGeometry,useAbbreviation:r.FeatureGeometry,useIsoCode:r.FeatureGeometry,poiName:r.FeatureGeometry,imageTexture:r.FeatureGeometry,iconColor:r.TechniqueRendering,iconBrightness:r.TechniqueRendering,backgroundColor:r.TechniqueRendering,backgroundSize:r.TechniqueRendering,backgroundOpacity:r.TechniqueRendering,color:r.TechniqueRendering,opacity:r.TechniqueRendering,size:r.TechniqueRendering}}),u={attrDescriptors:{polygonOffset:{scope:r.TechniqueRendering,automatic:!0},polygonOffsetFactor:{scope:r.TechniqueRendering,automatic:!0},polygonOffsetUnits:{scope:r.TechniqueRendering,automatic:!0},depthTest:{scope:r.TechniqueRendering,automatic:!0},transparent:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0},color:{scope:r.TechniqueRendering,automatic:!0},lineColor:r.TechniqueRendering,lineFadeFar:r.TechniqueRendering,lineFadeNear:r.TechniqueRendering}},h=i(o,u,{attrDescriptors:{lineWidth:r.TechniqueRendering,secondaryWidth:r.TechniqueRendering,secondaryColor:r.TechniqueRendering,dashSize:r.TechniqueRendering,gapSize:r.TechniqueRendering,outlineColor:{scope:r.TechniqueRendering,automatic:!0},caps:{scope:r.TechniqueRendering,automatic:!0},drawRangeStart:{scope:r.TechniqueRendering,automatic:!0},drawRangeEnd:{scope:r.TechniqueRendering,automatic:!0},dashes:{scope:r.TechniqueRendering,automatic:!0},dashColor:{scope:r.TechniqueRendering,automatic:!0}}}),d=i(o,{attrDescriptors:{color:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0},lineWidth:r.FeatureGeometry}}),p=i(o,u,{attrDescriptors:{wireframe:{scope:r.TechniqueRendering,automatic:!0},color:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0},transparent:{scope:r.TechniqueRendering,automatic:!0},lineWidth:r.TechniqueRendering,map:{scope:r.TechniqueRendering,automatic:!0}}}),f=i(o,{attrDescriptors:{color:{scope:r.TechniqueRendering,automatic:!0},vertexColors:{scope:r.TechniqueRendering,automatic:!0},wireframe:{scope:r.TechniqueRendering,automatic:!0},roughness:{scope:r.TechniqueRendering,automatic:!0},metalness:{scope:r.TechniqueRendering,automatic:!0},alphaTest:{scope:r.TechniqueRendering,automatic:!0},depthTest:{scope:r.TechniqueRendering,automatic:!0},transparent:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0},emissive:{scope:r.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:r.TechniqueRendering,automatic:!0},refractionRatio:{scope:r.TechniqueRendering,automatic:!0},normalMapType:{scope:r.TechniqueRendering,automatic:!0},map:{scope:r.TechniqueRendering,automatic:!0},normalMap:{scope:r.TechniqueRendering,automatic:!0},displacementMap:{scope:r.TechniqueRendering,automatic:!0},roughnessMap:{scope:r.TechniqueRendering,automatic:!0},emissiveMap:{scope:r.TechniqueRendering,automatic:!0},bumpMap:{scope:r.TechniqueRendering,automatic:!0},metalnessMap:{scope:r.TechniqueRendering,automatic:!0},alphaMap:{scope:r.TechniqueRendering,automatic:!0}}}),m={\"extruded-polygon\":i(o,f,{attrDescriptors:{height:r.FeatureGeometry,floorHeight:r.FeatureGeometry,color:r.FeatureGeometry,defaultColor:r.FeatureGeometry,defaultHeight:r.FeatureGeometry,boundaryWalls:r.FeatureGeometry,footprint:r.FeatureGeometry,maxSlope:r.FeatureGeometry,animateExtrusion:r.TechniqueRendering,lineWidth:r.TechniqueRendering,lineFadeNear:r.TechniqueRendering,lineFadeFar:r.TechniqueRendering,lineColor:r.TechniqueRendering}}),\"line-marker\":c,\"labeled-icon\":c,\"solid-line\":h,\"dashed-line\":h,terrain:f,standard:f,squares:a,circles:l,line:d,segments:d,fill:p,text:i(o,{attrDescriptors:{text:r.FeatureGeometry,label:r.FeatureGeometry,useAbbreviation:r.FeatureGeometry,useIsoCode:r.FeatureGeometry,backgroundColor:r.TechniqueRendering,backgroundSize:r.TechniqueRendering,backgroundOpacity:r.TechniqueRendering,color:r.TechniqueRendering,opacity:r.TechniqueRendering,priority:r.TechniqueRendering,size:r.TechniqueRendering}}),shader:i(o,{attrDescriptors:{params:r.TechniqueRendering}})};function g(e){return\"string\"!=typeof e&&(e=e.name),m[e]}t.getTechniqueDescriptor=g,t.getTechniqueAttributeDescriptor=function(e,t){const n=g(e),r=null==n?void 0:n.attrDescriptors,i=null==r?void 0:r[t];if(void 0!==typeof i)return\"object\"==typeof i?i:{scope:i}};const v=new Map;t.getTechniqueAutomaticAttrs=function(e){var t;if(\"string\"!=typeof e&&(e=e.name),v.has(e))return v.get(e);const n=[],r=null===(t=g(e))||void 0===t?void 0:t.attrDescriptors;if(void 0===r)return n;for(const e in r){if(!r.hasOwnProperty(e))continue;const t=r[e];void 0!==t&&\"number\"!=typeof t&&(!0===t.automatic&&n.push(e))}return v.set(e,n),n}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.addPolygonEdges=void 0;const r=n(0),i=new r.Vector2,o=new r.Vector2,s=new r.Vector2,a=new r.Vector2;t.addPolygonEdges=function(e,t,n,r,l,c,u,h){for(let d=0;d<l.length;++d)if(l[d])if(!0===c){const c=t+2*d,p=c+1,f=t+(d+1)%l.length*2,m=f+1;!0===u&&e.push(c,f),e.push(p,m);const g=(0===d?l.length:d)-1;if(l[g])if(void 0!==h){const t=r[d*n],u=r[d*n+1],f=r[(d+1)%l.length*n],m=r[(d+1)%l.length*n+1];i.set(t,u),o.set(f,m),s.set(r[g*n],r[g*n+1]),a.set(i.x,i.y),a.sub(s).normalize().dot(o.sub(i).normalize())<=h&&e.push(c,p)}else e.push(c,p)}else{const n=t+d,r=t+(d+1)%l.length;e.push(n,r)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ThreeBufferUtils=void 0;const r=n(39);!function(e){function t(e){if(e instanceof Int8Array)return\"int8\";if(e instanceof Uint8Array)return\"uint8\";if(e instanceof Int16Array)return\"int16\";if(e instanceof Uint16Array)return\"uint16\";if(e instanceof Int32Array)return\"int32\";if(e instanceof Uint32Array)return\"uint32\";if(e instanceof Float32Array)return\"float\";throw new Error(\"Unsupported buffer type \"+name)}function n(e){const n=e.array;return{name:e.name,buffer:n.buffer,type:t(n),itemCount:e.itemSize,normalized:e.normalized}}e.getBufferElementType=t,e.fromThreeBufferAttribute=n,e.fromThreeInterleavedBufferAttribute=function(e){throw new Error(\"Not implemented yet\")},e.fromThreeBufferGeometry=function(e,t){const i=[],o=Object.getOwnPropertyNames(e.attributes);for(const t of o){const r=n(e.attributes[t]);r.name=t,i.push(r)}const s=null!==e.index?n(e.index):void 0;let a=0;if(void 0!==s)a=null===e.index?0:e.index.count;else{const t=e.attributes.position;if(void 0===t)throw new Error(\"Missing position attibute to deduce item count\");a=t.count}return{type:r.GeometryType.Unspecified,vertexAttributes:i,index:s,groups:[{start:0,count:a,technique:t}]}}}(t.ThreeBufferUtils||(t.ThreeBufferUtils={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ThemedTileDecoder=void 0;const r=n(32),i=n(2).LoggerManager.instance.create(\"ThemedTileDecoder\");t.ThemedTileDecoder=class{constructor(){this.m_storageLevelOffset=0}dispose(){}decodeTile(e,t,n){return void 0===this.m_styleSetEvaluator?(i.info(\"cannot decode tile, as there is not style available\"),Promise.resolve(void 0)):this.decodeThemedTile(e,t,this.m_styleSetEvaluator,n)}getTileInfo(e,t,n){return Promise.resolve(void 0)}configure(e,t){void 0!==(null==e?void 0:e.styleSet)&&(this.m_styleSetEvaluator=new r.StyleSetEvaluator(e)),void 0!==(null==e?void 0:e.languages)&&(this.languages=e.languages),void 0!==t&&void 0!==t.storageLevelOffset&&(this.m_storageLevelOffset=t.storageLevelOffset)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TileDecoderService=void 0;const r=n(5),i=n(3),o=n(2),s=n(23),a=o.LoggerManager.instance.create(\"TileDecoderService\");class l extends s.WorkerService{constructor(e,t){super(e),this.serviceId=e,this.m_decoder=t,this.m_decoder.connect()}static start(e,t){return new l(e,t)}handleRequest(e){return r.WorkerDecoderProtocol.isDecodeTileRequest(e)?this.handleDecodeTileRequest(e):r.WorkerDecoderProtocol.isTileInfoRequest(e)?this.handleTileInfoRequest(e):super.handleRequest(e)}handleMessage(e){r.WorkerDecoderProtocol.isConfigurationMessage(e)?this.handleConfigurationMessage(e):a.error(`[${this.serviceId}]: invalid message ${e.type}`)}async handleDecodeTileRequest(e){const t=i.TileKey.fromMortonCode(e.tileKey),n=r.getProjection(e.projection),o=await this.m_decoder.decodeTile(e.data,t,n),s=[],a=e=>{void 0!==e&&e.buffer.byteLength>0&&!s.includes(e.buffer)&&s.push(e.buffer)};return null==o||o.geometries.forEach(e=>{var t,n,r;if(null===(t=e.vertexAttributes)||void 0===t||t.forEach(e=>a(e)),null===(n=e.interleavedVertexAttributes)||void 0===n||n.forEach(e=>a(e)),a(e.index),a(e.edgeIndex),Array.isArray(e.objInfos)&&1===e.objInfos.length&&\"object\"==typeof e.objInfos[0]&&(null===(r=e.objInfos[0])||void 0===r?void 0:r.hasOwnProperty(\"displacementMap\"))){const t=e.objInfos[0];a(t.displacementMap)}Array.isArray(e.attachments)&&e.attachments.forEach(e=>{a(e.index),a(e.edgeIndex)})}),null==o||o.techniques.forEach(e=>{r.addBuffersToTransferList(e,s)}),{response:o,transferList:s}}handleTileInfoRequest(e){const t=i.TileKey.fromMortonCode(e.tileKey),n=r.getProjection(e.projection);return this.m_decoder.getTileInfo(e.data,t,n).then(e=>({response:e,transferList:void 0!==e&&void 0!==e.transferList?e.transferList:[]}))}handleConfigurationMessage(e){this.m_decoder.configure(e,e.options)}}t.TileDecoderService=l},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TilerService=void 0;const r=n(5),i=n(3),o=n(51),s=n(23);class a extends s.WorkerService{constructor(e){super(e),this.serviceId=e,this.tiler=new o.GeoJsonTiler}static start(e){return new a(e)}handleRequest(e){return r.WorkerTilerProtocol.isRegisterIndexRequest(e)?this.handleRegisterIndexRequest(e):r.WorkerTilerProtocol.isUpdateIndexRequest(e)?this.handleUpdateIndexRequest(e):r.WorkerTilerProtocol.isTileRequest(e)?this.handleTileRequest(e):super.handleRequest(e)}async handleTileRequest(e){const t=i.TileKey.fromMortonCode(e.tileKey);return{response:await this.tiler.getTile(e.index,t)||{}}}async handleRegisterIndexRequest(e){const t=\"string\"==typeof e.input?new URL(e.input):e.input;return await this.tiler.registerIndex(e.id,t),{response:{}}}async handleUpdateIndexRequest(e){const t=\"string\"==typeof e.input?new URL(e.input):e.input;return this.tiler.updateIndex(e.id,t),{response:{}}}}t.TilerService=a},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerServiceManager=void 0;const r=n(5),i=n(23);class o extends i.WorkerService{constructor(e=r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID){super(e),this.m_factories=new Map,this.m_services=new Map}static getInstance(){return void 0===this.m_service&&(this.m_service=new o(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)),this.m_service}register(e){this.m_factories.set(e.serviceType,e.factory)}handleRequest(e){if(e.type===r.WorkerServiceProtocol.Requests.CreateService){if(void 0!==this.m_services.get(e.targetServiceId))throw Error(`error - service with targetServiceId='${e.targetServiceId}' already running, ignoring CreateService request`);const t=this.m_factories.get(e.targetServiceType);if(void 0===t)throw Error(`unknown targetServiceType requested: '${e.targetServiceType}'`);const n=t(e.targetServiceId);this.m_services.set(e.targetServiceId,n)}if(e.type===r.WorkerServiceProtocol.Requests.DestroyService){const t=this.m_services.get(e.targetServiceId);if(void 0===t)throw Error(`unknown targetServiceId '${e.targetServiceId}'`);t.destroy(),this.m_services.delete(e.targetServiceId)}return Promise.resolve({response:{}})}}t.WorkerServiceManager=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoJsonDataAdapter=void 0;const r=n(136),i=n(3),o=n(0),s=n(24),a=new o.Vector3;function l(e,t,n){return i.webMercatorProjection.projectPoint(i.GeoCoordinates.fromGeoPoint(e),a),s.world2tile(4096,t,a,!1,n)}function c(e,t){return{untiledPositions:e.map(e=>i.GeoCoordinates.fromGeoPoint(e)),positions:e.map(e=>l(e,t,new o.Vector2))}}function u(e,t){return\"LineString\"===e.type?[c(e.coordinates,t)]:e.coordinates.map(e=>c(e,t))}function h(e,t){return{rings:e.map((e,n)=>{const r=0===n,{positions:i}=c(e,t),s=o.ShapeUtils.area(i)>0;return(r&&!s||!r&&s)&&i.reverse(),i})}}function d(e,t){return\"Polygon\"===e.type?[h(e.coordinates,t)]:e.coordinates.map(e=>h(e,t))}function p(e,t){return\"Point\"===e.type?[l(e.coordinates,t,new o.Vector3)]:e.coordinates.map(e=>l(e,t,new o.Vector3))}t.GeoJsonDataAdapter=class{canProcess(e){return e&&\"FeatureCollection\"===e.type&&Array.isArray(e.features)}process(e,t,n,i=\"geojson\"){if(Array.isArray(e.features)&&0!==e.features.length)for(const o of e.features)switch(o.geometry.type){case\"LineString\":case\"MultiLineString\":{let e=u(o.geometry,t);const s=[],a=100;e.forEach(e=>{r.clipLineString(e.positions,-a,-a,4096+a,4096+a).forEach(e=>{s.push({positions:e})})}),e=s,e.length>0&&n.processLineFeature(i,4096,s,o.properties,o.id);break}case\"Polygon\":case\"MultiPolygon\":{const e=d(o.geometry,t);n.processPolygonFeature(i,4096,e,o.properties,o.id);break}case\"Point\":case\"MultiPoint\":{const e=p(o.geometry,t);n.processPointFeature(i,4096,e,o.properties,o.id);break}}}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.wrapLineString=t.clipLineString=void 0;const r=n(3),i=n(2),o=n(0);class s{constructor(e,t,n,r,i){this.isInside=i,this.p0=new o.Vector2(e,t),this.p1=new o.Vector2(n,r)}inside(e){return this.isInside(e)}computeIntersection(e,t){const n=new o.Vector2;return i.Math2D.intersectLines(e.x,e.y,t.x,t.y,this.p0.x,this.p0.y,this.p1.x,this.p1.y,n),n}clipLine(e){const t=e,n=[];e=[],n.push(e);const r=t=>{0!==e.length&&e[e.length-1].equals(t)||e.push(t)};for(let i=0;i<t.length;++i){const o=t[i],s=i>0?t[i-1]:void 0;this.inside(o)?(void 0===s||this.inside(s)||(e.length>0&&(e=[],n.push(e)),r(this.computeIntersection(s,o))),r(o)):void 0!==s&&this.inside(s)&&r(this.computeIntersection(s,o))}return 0===n[n.length-1].length&&(n.length=n.length-1),n}clipLines(e){const t=[];return e.forEach(e=>{this.clipLine(e).forEach(e=>{t.push(e)})}),t}}function a(e,t,n){for(const n of t)e=n.clipLines(e);const i=new o.Vector3,s=[];return e.forEach(e=>{if(0===e.length)return;const t=e.map(({x:e,y:t})=>{i.set(e,t,0);const o=r.webMercatorProjection.unprojectPoint(i);return o.longitude+=n,o});s.push(t)}),s.length>0?s:void 0}t.clipLineString=function(e,t,n,r,i){const o=new s(t,n,t,i,e=>e.x>t),a=new s(t,i,r,i,e=>e.y<i),l=new s(r,i,r,n,e=>e.x<r),c=new s(r,n,t,n,e=>e.y>n);let u=o.clipLine(e);return u=a.clipLines(u),u=l.clipLines(u),u=c.clipLines(u),u},t.wrapLineString=function(e){const t=new o.Vector3,n=[e.map(e=>{const{x:n,y:i}=r.webMercatorProjection.projectPoint(e,t);return new o.Vector2(n,i)})];return{left:a(n,u,360),middle:a(n,c,0),right:a(n,h,-360)}};const l=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE,c=[new s(0,l,0,0,e=>e.x>0),new s(l+0,0,l+0,l,e=>e.x<l+0)],u=[new s(-l-0,l,-l-0,0,e=>e.x>-l-0),new s(0,0,0,l,e=>e.x<0)],h=[new s(l-0,l,l-0,0,e=>e.x>l-0),new s(2*l+0,0,2*l+0,l,e=>e.x<2*l+0)]},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoJsonVtDataAdapter=void 0;const r=n(3),i=n(0),o=n(24);var s;!function(e){e[e.Unknown=0]=\"Unknown\",e[e.Point=1]=\"Point\",e[e.LineString=2]=\"LineString\",e[e.Polygon=3]=\"Polygon\"}(s||(s={}));const a=new i.Vector3;t.GeoJsonVtDataAdapter=class{canProcess(e){if(o.isArrayBufferLike(e))return!1;const t=e;return void 0!==t.features&&void 0!==t.source&&void 0!==t.x&&void 0!==t.y&&void 0!==t.z}process(e,t,n){for(const l of e.features)switch(l.type){case s.Point:for(const t of l.geometry){const r=t[0],o=t[1],s=new i.Vector3(r,o,0);n.processPointFeature(e.layer,4096,[s],l.tags,l.id)}break;case s.LineString:{const s=l.geometry;let c;const u=[];s.forEach(e=>{const t=null==c?void 0:c.positions[c.positions.length-1],[n,r]=e[0];if((null==t?void 0:t.x)===n&&(null==t?void 0:t.y)===r)for(let t=1;t<e.length;++t){const[n,r]=e[t];null==c||c.positions.push(new i.Vector2(n,r))}else{const t=e.map(([e,t])=>new i.Vector2(e,t));u.push({positions:t}),c=u[u.length-1]}}),u.forEach(e=>{e.untiledPositions=e.positions.map(e=>(o.tile2world(4096,t,e,!1,a),r.webMercatorProjection.unprojectPoint(a)))}),n.processLineFeature(e.layer,4096,u,l.tags,l.id);break}case s.Polygon:{const t=[];let r;for(const e of l.geometry){const n=[];for(const[t,r]of e){const e=new i.Vector2(t,r);n.push(e)}i.ShapeUtils.area(n)>0&&(r={rings:[]},t.push(r)),null==r||r.rings.push(n)}n.processPolygonFeature(e.layer,4096,t,l.tags,l.id);break}case s.Unknown:}}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.OmvDataAdapter=t.asGeometryType=void 0;const r=n(32),i=n(2),o=n(139),s=n(0),a=n(140),l=n(15),c=n(141),u=n(24),h=n(142),d=n(143),p=n(52),f=[\"stringValue\",\"floatValue\",\"doubleValue\",\"intValue\",\"uintValue\",\"sintValue\",\"boolValue\"],m=i.LoggerManager.instance.create(\"OmvDataAdapter\",{enabled:!1});function g(e,t,n){if(void 0!==t.id&&null!==t.id)return t.id;if(e.hasOwnProperty(\"id\")){const t=e.id;if(\"number\"==typeof t)return t;if(t)return void 0!==n&&t.greaterThan(Number.MAX_SAFE_INTEGER)&&n.error(\"Invalid ID: Larger than largest available Number in feature: \",e),t.toNumber()}}function v(e,t){const n=new d.FeatureAttributes,r={};return n.accept(e,t,{visitAttribute:(e,t)=>(r[e]=function(e){const t=Object.prototype.hasOwnProperty;for(const n of f)if(t.call(e,n)){const t=e[n];if(void 0===t)throw new Error(\"unpexted undefined value\");return o.isLong(t)?t.toNumber():t}throw new Error(\"not happening\")}(t),!0)}),r}function y(e){if(void 0===e)return l.OmvGeometryType.UNKNOWN;switch(e.type){case p.com.mapbox.pb.Tile.GeomType.UNKNOWN:return l.OmvGeometryType.UNKNOWN;case p.com.mapbox.pb.Tile.GeomType.POINT:return l.OmvGeometryType.POINT;case p.com.mapbox.pb.Tile.GeomType.LINESTRING:return l.OmvGeometryType.LINESTRING;case p.com.mapbox.pb.Tile.GeomType.POLYGON:return l.OmvGeometryType.POLYGON;default:return l.OmvGeometryType.UNKNOWN}}function x(e,t){e.forEach(e=>{e.x===t-1&&(e.x=t)})}function _(e,t){switch(t){case l.FeatureModifierId.default:return new a.OmvGenericFeatureModifier(e);default:return i.assert(!1),new a.OmvGenericFeatureModifier(e)}}t.asGeometryType=y;t.OmvDataAdapter=class{constructor(){this.m_geometryCommands=new d.GeometryCommands,this.m_roundUpCoordinatesIfNeeded=!1}get dataFilter(){return this.m_dataFilter}configure(e,t){var n;if(void 0!==e.filterDescription){if(null!==e.filterDescription){const t=e.filterDescription,n=e.featureModifiers;this.m_dataFilter=new a.OmvGenericFeatureFilter(t);const r=[];void 0!==n?n.forEach(e=>{r.push(_(t,e))}):r.push(_(t,l.FeatureModifierId.default)),this.m_featureModifiers=r}else this.m_dataFilter=void 0,this.m_featureModifiers=void 0;const n=new h.StyleSetDataFilter(t);this.m_dataFilter=this.m_dataFilter?new a.ComposedDataFilter([n,this.m_dataFilter]):n}if(void 0!==e.politicalView){const t=e.politicalView;let n=this.m_featureModifiers;if(n&&(n=n.filter(e=>!(e instanceof c.OmvPoliticalViewFeatureModifier))),0!==t.length){i.assert(2===t.length,\"The political view must be specified as two letters ISO 3166-1 standard!\");const e=new c.OmvPoliticalViewFeatureModifier(t);n?n.push(e):n=[e]}this.m_featureModifiers=n&&n.length>0?n:void 0}this.m_roundUpCoordinatesIfNeeded=null!==(n=e.roundUpCoordinatesIfNeeded)&&void 0!==n&&n}canProcess(e){return u.isArrayBufferLike(e)}process(e,t,n){const{tileKey:r}=t,i=new Uint8Array(e),o=p.com.mapbox.pb.Tile.decode(i);this.m_tileKey=r,this.m_processor=n,d.visitOmv(o,this)}visitLayer(e){this.m_layer=e;const t=this.m_tileKey.level,n=e.name;return!(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsLayer(n,t))}visitPointFeature(e){var t,n,r;if(void 0===e.geometry)return;const i=null===(t=this.m_featureModifiers)||void 0===t?void 0:t[0].doProcessPointFeature,o=this.filterAndModifyFeature(e,null===(n=this.m_dataFilter)||void 0===n?void 0:n.wantsPointFeature,i);if(!o)return;const a=this.m_layer.name,l=null!==(r=this.m_layer.extent)&&void 0!==r?r:4096,c=[];this.m_geometryCommands.accept(e.geometry,{type:\"Point\",visitCommand:e=>{d.isMoveToCommand(e)&&c.push(new s.Vector3(e.position.x,e.position.y,0))}}),0!==c.length&&this.m_processor.processPointFeature(a,l,c,o,g(e,o,m))}visitLineFeature(e){var t,n,r;if(void 0===e.geometry)return;const i=null===(t=this.m_featureModifiers)||void 0===t?void 0:t[0].doProcessLineFeature,o=this.filterAndModifyFeature(e,null===(n=this.m_dataFilter)||void 0===n?void 0:n.wantsLineFeature,i);if(!o)return;const s=this.m_layer.name,a=null!==(r=this.m_layer.extent)&&void 0!==r?r:4096,l=[];let c;this.m_geometryCommands.accept(e.geometry,{type:\"Line\",visitCommand:e=>{d.isMoveToCommand(e)?(c=[e.position],l.push({positions:c})):d.isLineToCommand(e)&&c.push(e.position)}}),0!==l.length&&(this.mustRoundUpCoordinates&&function(e,t){e.forEach(e=>x(e.positions,t))}(l,a),this.m_processor.processLineFeature(s,a,l,o,g(e,o,m)))}visitPolygonFeature(e){var t,n,r;if(void 0===e.geometry)return;const i=null===(t=this.m_featureModifiers)||void 0===t?void 0:t[0].doProcessPolygonFeature,o=this.filterAndModifyFeature(e,null===(n=this.m_dataFilter)||void 0===n?void 0:n.wantsPolygonFeature,i);if(!o)return;const a=this.m_layer.name,l=null!==(r=this.m_layer.extent)&&void 0!==r?r:4096,c=[];let u,h,p;this.m_geometryCommands.accept(e.geometry,{type:\"Polygon\",visitCommand:e=>{if(d.isMoveToCommand(e))h=[e.position];else if(d.isLineToCommand(e))h.push(e.position);else if(d.isClosePathCommand(e)&&void 0!==h&&h.length>0){const e=Math.sign(s.ShapeUtils.area(h));void 0===p&&(p=e),e===p&&(u={rings:[]},c.push(u)),h.push(h[0].clone()),null==u||u.rings.push(h)}}}),0!==c.length&&(this.mustRoundUpCoordinates&&function(e,t){e.forEach(e=>e.rings.forEach(e=>x(e,t)))}(c,l),function(e){const t=e[0];if(void 0===t||0===t.rings.length)return;if(!(s.ShapeUtils.area(t.rings[0])>0))for(const t of e)for(const e of t.rings)e.reverse()}(c),this.m_processor.processPolygonFeature(a,l,c,o,g(e,o,m)))}filterAndModifyFeature(e,t,n){var o;const s=this.m_tileKey.level,a=this.m_layer.name,l=y(e);if(this.m_dataFilter&&!1===t.apply(this.m_dataFilter,[a,l,s]))return;const c=v(this.m_layer,e),u=new r.MapEnv(c);return void 0===(null===(o=this.m_featureModifiers)||void 0===o?void 0:o.find(e=>(i.assert(void 0!==n),!n.apply(e,[a,u,this.m_tileKey.level]))))?c:void 0}get mustRoundUpCoordinates(){return this.m_roundUpCoordinatesIfNeeded&&this.m_tileKey.level<5&&this.m_tileKey.column===this.m_tileKey.columnCount()-1}}},function(e,t){e.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function r(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function i(e){return!0===(e&&e.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,\"__isLong__\",{value:!0}),r.isLong=i;var o={},s={};function a(e,t){var n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=s[e])?r:(n=c(e,(0|e)<0?-1:0,!0),i&&(s[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=o[e])?r:(n=c(e,e<0?-1:0,!1),i&&(o[e]=n),n)}function l(e,t){if(isNaN(e))return t?y:v;if(t){if(e<0)return y;if(e>=f)return M}else{if(e<=-m)return S;if(e+1>=m)return w}return e<0?l(-e,t).neg():c(e%p|0,e/p|0,t)}function c(e,t,n){return new r(e,t,n)}r.fromInt=a,r.fromNumber=l,r.fromBits=c;var u=Math.pow;function h(e,t,n){if(0===e.length)throw Error(\"empty string\");if(\"NaN\"===e||\"Infinity\"===e||\"+Infinity\"===e||\"-Infinity\"===e)return v;if(\"number\"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError(\"radix\");var r;if((r=e.indexOf(\"-\"))>0)throw Error(\"interior hyphen\");if(0===r)return h(e.substring(1),t,n).neg();for(var i=l(u(n,8)),o=v,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+a),n);if(a<8){var d=l(u(n,a));o=o.mul(d).add(l(c))}else o=(o=o.mul(i)).add(l(c))}return o.unsigned=t,o}function d(e,t){return\"number\"==typeof e?l(e,t):\"string\"==typeof e?h(e,t):c(e.low,e.high,\"boolean\"==typeof t?t:e.unsigned)}r.fromString=h,r.fromValue=d;var p=4294967296,f=p*p,m=f/2,g=a(1<<24),v=a(0);r.ZERO=v;var y=a(0,!0);r.UZERO=y;var x=a(1);r.ONE=x;var _=a(1,!0);r.UONE=_;var b=a(-1);r.NEG_ONE=b;var w=c(-1,2147483647,!1);r.MAX_VALUE=w;var M=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=M;var S=c(0,-2147483648,!1);r.MIN_VALUE=S;var T=r.prototype;T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError(\"radix\");if(this.isZero())return\"0\";if(this.isNegative()){if(this.eq(S)){var t=l(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return\"-\"+this.neg().toString(e)}for(var i=l(u(e,6),this.unsigned),o=this,s=\"\";;){var a=o.div(i),c=(o.sub(a.mul(i)).toInt()>>>0).toString(e);if((o=a).isZero())return c+s;for(;c.length<6;)c=\"0\"+c;s=\"\"+c+s}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return i(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(e){if(i(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(x)},T.neg=T.negate,T.add=function(e){i(e)||(e=d(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,o=65535&this.low,s=e.high>>>16,a=65535&e.high,l=e.low>>>16,u=0,h=0,p=0,f=0;return p+=(f+=o+(65535&e.low))>>>16,h+=(p+=r+l)>>>16,u+=(h+=n+a)>>>16,u+=t+s,c((p&=65535)<<16|(f&=65535),(u&=65535)<<16|(h&=65535),this.unsigned)},T.subtract=function(e){return i(e)||(e=d(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){if(this.isZero())return v;if(i(e)||(e=d(e)),n)return c(n.mul(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned);if(e.isZero())return v;if(this.eq(S))return e.isOdd()?S:v;if(e.eq(S))return this.isOdd()?S:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,o=this.low>>>16,s=65535&this.low,a=e.high>>>16,u=65535&e.high,h=e.low>>>16,p=65535&e.low,f=0,m=0,y=0,x=0;return y+=(x+=s*p)>>>16,m+=(y+=o*p)>>>16,y&=65535,m+=(y+=s*h)>>>16,f+=(m+=r*p)>>>16,m&=65535,f+=(m+=o*h)>>>16,m&=65535,f+=(m+=s*u)>>>16,f+=t*p+r*h+o*u+s*a,c((y&=65535)<<16|(x&=65535),(f&=65535)<<16|(m&=65535),this.unsigned)},T.mul=T.multiply,T.divide=function(e){if(i(e)||(e=d(e)),e.isZero())throw Error(\"division by zero\");var t,r,o;if(n)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?n.div_u:n.div_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:v;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return _;o=y}else{if(this.eq(S))return e.eq(x)||e.eq(b)?S:e.eq(S)?x:(t=this.shr(1).div(e).shl(1)).eq(v)?e.isNegative()?x:b:(r=this.sub(e.mul(t)),o=t.add(r.div(e)));if(e.eq(S))return this.unsigned?y:v;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=v}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),a=s<=48?1:u(2,s-48),h=l(t),p=h.mul(e);p.isNegative()||p.gt(r);)p=(h=l(t-=a,this.unsigned)).mul(e);h.isZero()&&(h=x),o=o.add(h),r=r.sub(p)}return o},T.div=T.divide,T.modulo=function(e){return i(e)||(e=d(e)),n?c((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return c(~this.low,~this.high,this.unsigned)},T.and=function(e){return i(e)||(e=d(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return i(e)||(e=d(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return i(e)||(e=d(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){if(i(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.OmvGenericFeatureModifier=t.ComposedDataFilter=t.OmvGenericFeatureFilter=t.OmvFeatureFilterDescriptionBuilder=void 0;const r=n(5),i=n(15);t.OmvFeatureFilterDescriptionBuilder=class{constructor(e){this.m_processLayersDefault=!0,this.m_processPointsDefault=!0,this.m_processLinesDefault=!0,this.m_processPolygonsDefault=!0,this.m_layersToProcess=new Array,this.m_layersToIgnore=new Array,this.m_pointsToProcess=new Array,this.m_ignoredPoints=new Array,this.m_linesToProcess=new Array,this.m_linesToIgnore=new Array,this.m_polygonsToProcess=new Array,this.m_polygonsToIgnore=new Array,this.m_kindsToProcess=[],this.m_kindsToIgnore=[],e&&(this.m_processLayersDefault=void 0===e.processLayersDefault||e.processLayersDefault,this.m_processPointsDefault=void 0===e.processPointsDefault||e.processPointsDefault,this.m_processLinesDefault=void 0===e.processLinesDefault||e.processLinesDefault,this.m_processPolygonsDefault=void 0===e.processPolygonsDefault||e.processPolygonsDefault)}processLayer(e,t=i.OmvFilterString.StringMatch.Match,n=0,r=1/0){this.m_layersToProcess.push({name:{value:e,match:t},minLevel:n,maxLevel:r})}ignoreLayer(e,t=i.OmvFilterString.StringMatch.Match,n=0,r=1/0){this.m_layersToIgnore.push({name:{value:e,match:t},minLevel:n,maxLevel:r})}processPoint(e){this.addItem(this.m_pointsToProcess,e)}processPoints(e){this.addItems(this.m_pointsToProcess,e)}ignorePoint(e){this.addItem(this.m_ignoredPoints,e)}ignorePoints(e){this.addItems(this.m_ignoredPoints,e)}processLine(e){this.addItem(this.m_linesToProcess,e)}processLines(e){this.addItems(this.m_linesToProcess,e)}ignoreLine(e){this.addItem(this.m_linesToIgnore,e)}ignoreLines(e){this.addItems(this.m_linesToIgnore,e)}processPolygon(e){this.addItem(this.m_polygonsToProcess,e)}processPolygons(e){this.addItems(this.m_polygonsToProcess,e)}ignorePolygon(e){this.addItem(this.m_polygonsToIgnore,e)}ignorePolygons(e){this.addItems(this.m_polygonsToIgnore,e)}processKinds(e){this.m_kindsToProcess=this.m_kindsToProcess.concat(e)}ignoreKinds(e){this.m_kindsToIgnore=this.m_kindsToIgnore.concat(e)}createDescription(){return{processLayersDefault:this.m_processLayersDefault,processPointsDefault:this.m_processPointsDefault,processLinesDefault:this.m_processLinesDefault,processPolygonsDefault:this.m_processPolygonsDefault,layersToProcess:this.m_layersToProcess,layersToIgnore:this.m_layersToIgnore,pointsToProcess:this.m_pointsToProcess,pointsToIgnore:this.m_ignoredPoints,linesToProcess:this.m_linesToProcess,linesToIgnore:this.m_linesToIgnore,polygonsToProcess:this.m_polygonsToProcess,polygonsToIgnore:this.m_polygonsToIgnore,kindsToProcess:this.m_kindsToProcess,kindsToIgnore:this.m_kindsToIgnore}}addItem(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const n={layerName:{value:t.layer,match:void 0===t.matchLayer?i.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomType?Array.isArray(t.geomType)?t.geomType:[t.geomType]:void 0,classes:[{value:t.featureClass,match:void 0===t.matchClass?i.OmvFilterString.StringMatch.Match:t.matchClass}],minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(n)}addItems(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const n={layerName:{value:t.layer,match:void 0===t.matchLayer?i.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomTypes?Array.isArray(t.geomTypes)?t.geomTypes:[t.geomTypes]:void 0,classes:t.featureClasses,minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(n)}};class o{constructor(e){this.description=e,this.description.kindsToProcess.length>0&&(this.enabledKinds=new r.GeometryKindSet(this.description.kindsToProcess)),this.description.kindsToIgnore.length>0&&(this.disabledKinds=new r.GeometryKindSet(this.description.kindsToIgnore))}static matchLayer(e,t,n){for(const r of t)if(!(n<r.minLevel||n>r.maxLevel)&&i.OmvFilterString.matchString(e,r.name))return!0;return!1}wantsLayer(e,t){return!!o.matchLayer(e,this.description.layersToProcess,t)||!o.matchLayer(e,this.description.layersToIgnore,t)&&this.description.processLayersDefault}wantsPointFeature(e,t,n){return this.wantsFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,n,this.description.processPointsDefault)}wantsLineFeature(e,t,n){return this.wantsFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,n,this.description.processLinesDefault)}wantsPolygonFeature(e,t,n){return this.wantsFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,n,this.description.processPolygonsDefault)}wantsKind(e){return void 0===e||(!(void 0!==this.disabledKinds&&this.disabledKinds.hasOrIntersects(e))||void 0!==this.enabledKinds&&this.enabledKinds.hasOrIntersects(e))}get hasKindFilter(){return void 0!==this.enabledKinds||void 0!==this.disabledKinds}wantsFeature(e,t,n,r,o,s){for(const t of e)if(!(o<t.minLevel||o>t.maxLevel)&&i.OmvFilterString.matchString(n,t.layerName)&&void 0!==t.geometryTypes&&t.geometryTypes.includes(r))return!0;for(const e of t)if(i.OmvFilterString.matchString(n,e.layerName)&&void 0!==e.geometryTypes&&e.geometryTypes.includes(r))return!1;return s}}t.OmvGenericFeatureFilter=o;t.ComposedDataFilter=class{constructor(e){this.filters=e}get hasKindFilter(){return this.filters.reduce((e,t)=>e||t.hasKindFilter,!0)}wantsLayer(e,t){return this.filters.reduce((n,r)=>n&&r.wantsLayer(e,t),!0)}wantsPointFeature(e,t,n){return this.filters.reduce((r,i)=>r&&i.wantsPointFeature(e,t,n),!0)}wantsLineFeature(e,t,n){return this.filters.reduce((r,i)=>r&&i.wantsLineFeature(e,t,n),!0)}wantsPolygonFeature(e,t,n){return this.filters.reduce((r,i)=>r&&i.wantsPolygonFeature(e,t,n),!0)}wantsKind(e){return this.filters.reduce((t,n)=>t&&n.wantsKind(e),!0)}};class s{constructor(e){this.description=e}static matchItems(e,t,n){for(const r of n)if(void 0!==r.classes){if(!i.OmvFilterString.matchString(e,r.layerName))continue;for(const e of r.classes)if(i.OmvFilterString.matchString(t,e))return!0}return!1}static matchAttribute(e,t,n){for(const r of n)if(void 0!==r.featureAttribute&&i.OmvFilterString.matchString(e,r.layerName)&&t.lookup(r.featureAttribute.key)===r.featureAttribute.value)return!0;return!1}doProcessPointFeature(e,t){return this.doProcessFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,this.description.processPointsDefault)}doProcessLineFeature(e,t){return this.doProcessFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,this.description.processLinesDefault)}doProcessPolygonFeature(e,t){return this.doProcessFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,this.description.processPolygonsDefault)}doProcessFeature(e,t,n,r,i){if(void 0===n||0===e.length&&0===t.length)return i;let o;const a=r.lookup(\"class\");return null!=a&&(o=a.toString()),!(!o||!s.matchItems(n,o,e))||(!o||!s.matchItems(n,o,t))&&(!!s.matchAttribute(n,r,e)||!s.matchAttribute(n,r,t)&&i)}}t.OmvGenericFeatureModifier=s},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.OmvPoliticalViewFeatureModifier=void 0;const r=n(2).LoggerManager.instance.create(\"OmvPoliticalViewFeatureModifier\");t.OmvPoliticalViewFeatureModifier=class{constructor(e){this.m_countryCode=e}doProcessPointFeature(e,t,n){return!0}doProcessLineFeature(e,t,n){return this.rewriteEnvironment(e,t),!0}doProcessPolygonFeature(e,t,n){return!0}rewriteEnvironment(e,t){this.isPoliticalViewLayer(e)&&this.updateEnvironment(t,this.m_countryCode,\"kind\")}updateEnvironment(e,t,n){const r=this.getAlternativePov(e,t,n);void 0!==r&&(e.entries[n]=r)}getAlternativePov(e,t,n){r.log(\"Get alternate POV: \",JSON.stringify(e));const i=t,o=e.lookup(`${n}:${i}`);return r.log(\"Lookup POV: \",`${n}:${i}`,o),\"string\"==typeof o&&o.length>0?(r.log(\"Found POV: \",`${n}:${i}`,o),o):void 0}isPoliticalViewLayer(e){return\"boundaries\"===e}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.StyleSetDataFilter=void 0;t.StyleSetDataFilter=class{constructor(e){this.styleSetEvaluator=e,this.hasKindFilter=!1}wantsLayer(e,t){return this.styleSetEvaluator.wantsLayer(e)}wantsPointFeature(e){return this.styleSetEvaluator.wantsFeature(e,\"point\")}wantsLineFeature(e){return this.styleSetEvaluator.wantsFeature(e,\"line\")}wantsPolygonFeature(e){return this.styleSetEvaluator.wantsFeature(e,\"polygon\")}wantsKind(){return!0}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeometryCommands=t.FeatureAttributes=t.visitOmvLayer=t.visitOmv=t.isClosePathCommand=t.isLineToCommand=t.isMoveToCommand=t.CommandKind=void 0;const r=n(0),i=n(52);var o;function s(e,t){if((!t.visitLayer||t.visitLayer(e))&&e.features)for(const n of e.features)switch(n.type){case i.com.mapbox.pb.Tile.GeomType.UNKNOWN:break;case i.com.mapbox.pb.Tile.GeomType.POINT:t.visitPointFeature&&t.visitPointFeature(n);break;case i.com.mapbox.pb.Tile.GeomType.LINESTRING:t.visitLineFeature&&t.visitLineFeature(n);break;case i.com.mapbox.pb.Tile.GeomType.POLYGON:t.visitPolygonFeature&&t.visitPolygonFeature(n)}t.endVisitLayer&&t.endVisitLayer(e)}!function(e){e[e.MoveTo=1]=\"MoveTo\",e[e.LineTo=2]=\"LineTo\",e[e.ClosePath=7]=\"ClosePath\"}(o=t.CommandKind||(t.CommandKind={})),t.isMoveToCommand=function(e){return e.kind===o.MoveTo},t.isLineToCommand=function(e){return e.kind===o.LineTo},t.isClosePathCommand=function(e){return e.kind===o.ClosePath},t.visitOmv=function(e,t){if(e.layers)for(const n of e.layers)t.visitLayer&&!t.visitLayer(n)||s(n,t),t.endVisitLayer&&t.endVisitLayer(n)},t.visitOmvLayer=s;t.FeatureAttributes=class{accept(e,t,n){const{keys:r,values:i}=e,o=t.tags;if(o&&r&&i)for(let e=0;e<o.length;e+=2){const t=r[o[e]],s=i[o[e+1]];if(!n.visitAttribute(t,s))break}}};t.GeometryCommands=class{accept(e,t){if(!e)return;const n=e.length;let i=0,s=0;const a=[],l=[],c=[];for(let u=0;u<n;){const n=7&e[u],h=e[u]>>3;if(++u,n===o.MoveTo||n===o.LineTo)for(let o=0;o<h;++o){const o=e[u++],h=e[u++];i+=o>>1^-(1&o),s+=h>>1^-(1&h),\"Polygon\"===t.type&&(a.push(i),l.push(s));const d=new r.Vector2(i,s);c.push({kind:n,position:d})}else{for(const e of c)t.visitCommand(e);t.visitCommand({kind:n}),a.length=0,l.length=0,c.length=0}}if(c.length>0)for(const e of c)t.visitCommand(e)}}},function(e,t,n){\"use strict\";e.exports=n(145)},function(e,t,n){\"use strict\";var r=t;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build=\"minimal\",r.Writer=n(53),r.BufferWriter=n(155),r.Reader=n(54),r.BufferReader=n(156),r.util=n(7),r.rpc=n(157),r.roots=n(159),r.configure=i,i()},function(e,t){var n;n=function(){return this}();try{n=n||new Function(\"return this\")()}catch(e){\"object\"==typeof window&&(n=window)}e.exports=n},function(e,t,n){\"use strict\";e.exports=function(e,t){var n=new Array(arguments.length-1),r=0,i=2,o=!0;for(;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,s){n[r]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,s(e))}}))}},function(e,t,n){\"use strict\";var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&\"=\"===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var i=new Array(64),o=new Array(123),s=0;s<64;)o[i[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;r.encode=function(e,t,n){for(var r,o=null,s=[],a=0,l=0;t<n;){var c=e[t++];switch(l){case 0:s[a++]=i[c>>2],r=(3&c)<<4,l=1;break;case 1:s[a++]=i[r|c>>4],r=(15&c)<<2,l=2;break;case 2:s[a++]=i[r|c>>6],s[a++]=i[63&c],l=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return l&&(s[a++]=i[r],s[a++]=61,1===l&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join(\"\")):String.fromCharCode.apply(String,s.slice(0,a))};r.decode=function(e,t,n){for(var r,i=n,s=0,a=0;a<e.length;){var l=e.charCodeAt(a++);if(61===l&&s>1)break;if(void 0===(l=o[l]))throw Error(\"invalid encoding\");switch(s){case 0:r=l,s=1;break;case 1:t[n++]=r<<2|(48&l)>>4,r=l,s=2;break;case 2:t[n++]=(15&r)<<4|(60&l)>>2,r=l,s=3;break;case 3:t[n++]=(3&r)<<6|l,s=0}}if(1===s)throw Error(\"invalid encoding\");return n-i},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,n){\"use strict\";function r(){this._listeners={}}e.exports=r,r.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},r.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},r.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},function(e,t,n){\"use strict\";function r(e){return\"undefined\"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function o(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function a(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:o,e.writeFloatBE=r?o:i,e.readFloatLE=r?s:a,e.readFloatBE=r?a:s}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){var r=e(t,n),i=2*(r>>31)+1,o=r>>>23&255,s=8388607&r;return 255===o?s?NaN:i*(1/0):0===o?1401298464324817e-60*i*s:i*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,o),e.readFloatLE=n.bind(null,s),e.readFloatBE=n.bind(null,a)}(),\"undefined\"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function o(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function a(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:o,e.writeDoubleBE=r?o:i,e.readDoubleLE=r?s:a,e.readDoubleBE=r?a:s}():function(){function t(e,t,n,r,i,o){var s=r<0?1:0;if(s&&(r=-r),0===r)e(0,i,o+t),e(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(r>17976931348623157e292)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+n);else{var a;if(r<22250738585072014e-324)e((a=r/5e-324)>>>0,i,o+t),e((s<<31|a/4294967296)>>>0,i,o+n);else{var l=Math.floor(Math.log(r)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=r*Math.pow(2,-l))>>>0,i,o+t),e((s<<31|l+1023<<20|1048576*a&1048575)>>>0,i,o+n)}}}function n(e,t,n,r,i){var o=e(r,i+t),s=e(r,i+n),a=2*(s>>31)+1,l=s>>>20&2047,c=4294967296*(1048575&s)+o;return 2047===l?c?NaN:a*(1/0):0===l?5e-324*a*c:a*Math.pow(2,l-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=n.bind(null,s,0,4),e.readDoubleBE=n.bind(null,a,4,0)}(),e}function i(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function o(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=r(r)},function(module,exports,__webpack_require__){\"use strict\";function inquire(moduleName){try{var mod=eval(\"quire\".replace(/^/,\"re\"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,n){\"use strict\";var r=t;r.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},r.read=function(e,t,n){if(n-t<1)return\"\";for(var r,i=null,o=[],s=0;t<n;)(r=e[t++])<128?o[s++]=r:r>191&&r<224?o[s++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(r>>10),o[s++]=56320+(1023&r)):o[s++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join(\"\")):String.fromCharCode.apply(String,o.slice(0,s))},r.write=function(e,t,n){for(var r,i,o=n,s=0;s<e.length;++s)(r=e.charCodeAt(s))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-o}},function(e,t,n){\"use strict\";e.exports=function(e,t,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(n){if(n<1||n>i)return e(n);s+n>r&&(o=e(r),s=0);var a=t.call(o,s,s+=n);return 7&s&&(s=1+(7|s)),a}}},function(e,t,n){\"use strict\";e.exports=i;var r=n(7);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var s=i.zeroHash=\"\\0\\0\\0\\0\\0\\0\\0\\0\";i.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(e){if(\"number\"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===s?o:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},function(e,t,n){\"use strict\";e.exports=o;var r=n(53);(o.prototype=Object.create(r.prototype)).constructor=o;var i=n(7);function o(){r.call(this)}function s(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}o._configure=function(){o.alloc=i._Buffer_allocUnsafe,o.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&\"set\"===i.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},o.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,\"base64\"));var t=e.length>>>0;return this.uint32(t),t&&this._push(o.writeBytesBuffer,t,e),this},o.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(s,t,e),this},o._configure()},function(e,t,n){\"use strict\";e.exports=o;var r=n(54);(o.prototype=Object.create(r.prototype)).constructor=o;var i=n(7);function o(e){r.call(this,e)}o._configure=function(){i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice)},o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString(\"utf-8\",this.pos,this.pos=Math.min(this.pos+e,this.len))},o._configure()},function(e,t,n){\"use strict\";t.Service=n(158)},function(e,t,n){\"use strict\";e.exports=i;var r=n(7);function i(e,t,n){if(\"function\"!=typeof e)throw TypeError(\"rpcImpl must be a function\");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,n,i,o,s){if(!o)throw TypeError(\"request must be specified\");var a=this;if(!s)return r.asPromise(e,a,t,n,i,o);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?\"encodeDelimited\":\"encode\"](o).finish(),(function(e,n){if(e)return a.emit(\"error\",e,t),s(e);if(null!==n){if(!(n instanceof i))try{n=i[a.responseDelimited?\"decodeDelimited\":\"decode\"](n)}catch(e){return a.emit(\"error\",e,t),s(e)}return a.emit(\"data\",n,t),s(null,n)}a.end(!0)}))}catch(e){return a.emit(\"error\",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error(\"already ended\"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit(\"end\").off()),this}},function(e,t,n){\"use strict\";e.exports={}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.DecodeInfo=void 0;const r=n(3),i=n(0);t.DecodeInfo=class{constructor(e,t,n=0){this.targetProjection=e,this.tileKey=t,this.storageLevelOffset=n,this.projectedBoundingBox=new r.OrientedBox3,this.tileBounds=new i.Box3,this.tileSize=new i.Vector3,this.center=new i.Vector3,this.geoBox=this.tilingScheme.getGeoBox(t),this.targetProjection.projectBox(this.geoBox,this.projectedBoundingBox),this.projectedBoundingBox.getCenter(this.center),this.tilingScheme.getWorldBox(t,this.tileBounds),this.tileBounds.getSize(this.tileSize),this.tileSizeOnScreen=256*Math.pow(2,-this.storageLevelOffset),this.columnCount=r.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionX(this.tileKey.level),this.rowCount=r.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionY(this.tileKey.level)}get tilingScheme(){return r.webMercatorTilingScheme}get sourceProjection(){return this.tilingScheme.projection}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.VectorTileDataEmitter=void 0;const r=n(5),i=n(48),o=n(162),s=n(163),a=n(164),l=n(3),c=n(165),u=n(166),h=n(167),d=n(2),p=n(168),f=n(0),m=n(24),g=n(169),v=d.LoggerManager.instance.create(\"OmvDecodedTileEmitter\"),y=new f.Vector3,x=new f.Vector3,_=new f.Vector3,b=new f.Vector3,w=new f.Vector2,M=new f.Vector2,S=new f.Vector3,T=new f.Vector3,E=new f.Vector3,L=new f.Vector2,A=new f.Vector2,P=new f.Vector2,C=new f.Vector3,R=new f.Vector3,I=new f.Vector3,O=new f.Vector3,D=new f.Vector3,N=new f.Line3,z=Math.PI/8;function B(e,t,n=\"index\"){const r=t>65535?\"uint32\":\"uint16\";return{itemCount:1,name:n,buffer:(\"uint32\"===r?new Uint32Array(e):new Uint16Array(e)).buffer,type:r}}class F{constructor(e){this.type=e,this.positions=[],this.normals=[],this.textureCoordinates=[],this.colors=[],this.extrusionAxis=[],this.indices=[],this.edgeIndices=[],this.groups=[],this.texts=[],this.pathLengths=[],this.stringCatalog=[],this.imageTextures=[],this.featureStarts=[],this.edgeFeatureStarts=[],this.objInfos=[],this.offsetDirections=[]}addText(e){let t=this.stringCatalog.indexOf(e);return t<0&&(t=this.stringCatalog.length,this.stringCatalog.push(e)),t}}var G;!function(e){e[e.Simple=0]=\"Simple\",e[e.Complex=1]=\"Complex\"}(G||(G={}));const U=new f.Color;t.VectorTileDataEmitter=class{constructor(e,t,n={}){var r,i,o;this.m_decodeInfo=e,this.m_styleSetEvaluator=t,this.m_options=n,this.m_meshBuffers=new Map,this.m_geometries=[],this.m_textGeometries=[],this.m_textPathGeometries=[],this.m_pathGeometries=[],this.m_poiGeometries=[],this.m_simpleLines=[],this.m_solidLines=[],this.m_sources=[],this.m_maxGeometryHeight=0,this.m_minGeometryHeight=0,this.m_options.gatherFeatureAttributes=null!==(r=n.gatherFeatureAttributes)&&void 0!==r&&r,this.m_options.skipShortLabels=null===(i=n.skipShortLabels)||void 0===i||i,this.m_options.enableElevationOverlay=null!==(o=n.enableElevationOverlay)&&void 0!==o&&o}get projection(){return this.m_decodeInfo.targetProjection}get center(){return this.m_decodeInfo.center}processPointFeature(e,t,n,o,s){var a;const c=o.env;this.processFeatureCommon(c);const{tileKey:u,columnCount:h,rowCount:d}=this.m_decodeInfo,p=u.column+1<h?t-1:t,f=u.row+1<d?t-1:t,g=n.filter(e=>e.x>=0&&e.x<=p&&e.y>=0&&e.y<=f);if(0!==g.length)for(const e of s){if(void 0===e)continue;const n=e._index,s=this.findOrCreateMeshBuffers(n,r.GeometryType.Point);if(void 0===s)continue;const{positions:u,texts:h,imageTextures:d,objInfos:p,offsetDirections:f}=s,v=r.isTextTechnique(e)||r.isPoiTechnique(e);let y;const x=r.isPoiTechnique(e);if(x){const t=e;if(y=i.evaluateTechniqueAttr(o,t.imageTexture),void 0!==t.poiName)y=i.evaluateTechniqueAttr(o,t.poiName);else if(\"string\"==typeof t.poiNameField){y=c.lookup(t.poiNameField)}else if(\"string\"==typeof t.imageTextureField){const e=c.lookup(t.imageTextureField);y=r.composeTechniqueTextureName(e,t)}}const _=r.scaleHeight(o,e,this.m_decodeInfo.tileKey.level),b=r.getFeatureId(c.entries);for(const n of g){if(v){const t=e,n=r.getFeatureText(o,t,this.m_options.languages);void 0!==n&&n.length>0?h.push(s.addText(n)):h.push(-1)}v?m.webMercatorTile2TargetWorld(t,this.m_decodeInfo,n,S,_):m.webMercatorTile2TargetTile(t,this.m_decodeInfo,n,S,_);const i=this.projection.type===l.ProjectionType.Planar?S.z:n.z;i>this.m_maxGeometryHeight?this.m_maxGeometryHeight=i:i<this.m_minGeometryHeight&&(this.m_minGeometryHeight=i),u.push(S.x,S.y,S.z),p.push(this.m_options.gatherFeatureAttributes?c.entries:b),f.push(null!==(a=c.lookup(\"offset_direction\"))&&void 0!==a?a:0),x&&(void 0===y?d.push(-1):d.push(s.addText(y)))}}}processLineFeature(e,t,n,o,s){const a=o.env;this.processFeatureCommon(a);const l=[],c=[],h=[],p=[],g=this.m_decodeInfo.projectedBoundingBox;let y;const x=2*g.extents.x,_=2*g.extents.y,b=Math.max(x,_);let w,M;const L=void 0!==n[0].untiledPositions;let A=!1,P=!1;for(const e of s)if(void 0!==e){if(w){const t=this.getTextureCoordinateType(e);d.assert(void 0===t||M===t)}else w=this.getComputeTexCoordsFunc(e),M=this.getTextureCoordinateType(e);A=A||r.isSpecialDashesLineTechnique(e),P=P||!A}for(const e of n){const n=[];let r=0;if(L&&(this.m_decodeInfo.targetProjection.projectPoint(e.untiledPositions[0],T),e.untiledPositions.forEach(e=>{this.m_decodeInfo.targetProjection.projectPoint(e,S),r+=S.distanceTo(T),T.copy(S),this.m_decodeInfo.targetProjection.projectPoint(e.normalized(),S),n.push(S.x,S.y,S.z,r)})),A){y=[];let i=0;const o=e.positions.length;if(o>1){let s=0;for(let a=0;a<o-1;a++){const o=[],l=[],u=[],d=[],f=e.positions[a],g=e.positions[a+1];if(m.webMercatorTile2TargetWorld(t,this.m_decodeInfo,f,S,!1),l.push(S.x,S.y,S.z),m.webMercatorTile2TargetWorld(t,this.m_decodeInfo,g,E,!1),l.push(E.x,E.y,E.z),w&&(w(f,t).toArray(u,u.length),w(g,t).toArray(u,u.length)),L){let e=this.findRelativePositionInLine(S,n)/r;d.push(e),e=this.findRelativePositionInLine(E,n)/r,d.push(e)}else{d.push(s);const e=S.distanceTo(E);i+=e,s+=e,d.push(s)}S.sub(this.m_decodeInfo.center),o.push(S.x,S.y,S.z),E.sub(this.m_decodeInfo.center),o.push(E.x,E.y,E.z),y.push(o),c.push(l),h.push(u),p.push(d)}}if(!L&&i>0)for(const e of p)e.forEach((t,n)=>{e[n]=t/i})}if(P){const i=[],o=[],s=[],a=[];e.positions.forEach(e=>{if(m.webMercatorTile2TargetWorld(t,this.m_decodeInfo,e,S,!1),o.push(S.x,S.y,S.z),w&&w(e,t).toArray(s,s.length),L){const e=this.findRelativePositionInLine(S,n)/r;a.push(e)}S.sub(this.m_decodeInfo.center),i.push(S.x,S.y,S.z)}),l.push(i),c.push(o),h.push(s),p.push(a)}}const C=this.m_decodeInfo.tileKey.level>=11;for(const e of s){if(void 0===e)continue;const t=e._index,n=e.name;if(r.isLineTechnique(e)||r.isSolidLineTechnique(e)){const n=r.isLineTechnique(e)?this.m_simpleLines:this.m_solidLines,i=r.isLineTechnique(e)?G.Simple:G.Complex;A&&(d.assert(void 0!==y,\"OmvDecodedTileEmitter#processLineFeature: Internal error - No localLineSegments\"),this.applyLineTechnique(n,e,t,i,a.entries,y,o,this.getTextureCoordinateType(e)?h:void 0,p)),l.length>0&&this.applyLineTechnique(n,e,t,i,a.entries,l,o,this.getTextureCoordinateType(e)?h:void 0,L?p:void 0)}else if(r.isTextTechnique(e)||r.isPoiTechnique(e)||r.isLineMarkerTechnique(e)){const n=e,s=r.getFeatureText(o,n,this.m_options.languages);if(void 0===s||0===s.length)continue;let l=[];if(this.m_options.skipShortLabels){const e=b/this.m_decodeInfo.tileSizeOnScreen,t=5*s.length*e*.5,n=t*t;l=this.splitJaggyLines(c,n,z)}else l=c;if(0===l.length)continue;if(r.isTextTechnique(e)){if(void 0===s)continue;for(const e of l){const n=d.Math2D.computeSquaredLineLength(e);this.m_textPathGeometries.push({technique:t,path:e,pathLengthSqr:n,text:String(s),objInfos:this.m_options.gatherFeatureAttributes?a.entries:r.getFeatureId(a.entries)})}}else{const n=e;let c=i.evaluateTechniqueAttr(o,n.imageTexture);if(\"string\"==typeof n.imageTextureField){c=a.lookup(n.imageTextureField),\"string\"==typeof n.imageTexturePrefix&&(c=n.imageTexturePrefix+c),\"string\"==typeof n.imageTexturePostfix&&(c+=n.imageTexturePostfix)}for(const e of l)this.m_poiGeometries.push({technique:t,positions:{name:\"position\",type:\"float\",buffer:new Float64Array(e).buffer,itemCount:3},texts:[0],stringCatalog:[s,c],imageTextures:[1],objInfos:this.m_options.gatherFeatureAttributes?[a.entries]:[r.getFeatureId(a.entries)]})}}else if(r.isLabelRejectionLineTechnique(e))for(const e of c){const t=[];for(let n=0;n<e.length;n+=3)t.push((new f.Vector3).fromArray(e,n));this.m_pathGeometries.push({path:t})}else if(r.isExtrudedLineTechnique(e)){const n=this.findOrCreateMeshBuffers(t,r.GeometryType.ExtrudedLine);if(void 0===n)continue;const{positions:s,indices:c,groups:h,featureStarts:d,objInfos:p}=n,f=c.length,m=i.evaluateTechniqueAttr(o,e.lineWidth);if(void 0===m)continue;const g=i.evaluateTechniqueAttr(o,e.caps,\"Circle\"),v=C&&\"Circle\"===g;l.forEach(e=>{u.triangulateLine(e,m,s,c,v),d.push(f),p.push(this.m_options.gatherFeatureAttributes?a.entries:r.getFeatureId(a.entries))});const y=c.length-f;h.push({start:f,count:y,technique:t})}else v.warn(`OmvDecodedTileEmitter#processLineFeature: Invalid line technique\\n                     ${n} for layer: ${a.entries.$layer} `)}}processPolygonFeature(e,t,n,i,s){const a=i.env;this.processFeatureCommon(a);s.forEach(e=>{if(void 0===e)return;const s=e._index;if(void 0===s)throw new Error(\"OmvDecodedTileEmitter#processPolygonFeature: Internal error - No technique index\");let c;const u=a.lookup(\"bbox\");if(Array.isArray(u)){const[e,t,n,r]=u,i=new l.GeoBox(new l.GeoCoordinates(t,e),new l.GeoCoordinates(r,n));c=new f.Box3,l.webMercatorProjection.projectBox(i,c)}const h=[],d=r.isExtrudedPolygonTechnique(e),p=r.isFillTechnique(e),v=r.isStandardTechnique(e),y=d||p||v||r.isShaderTechnique(e)&&\"mesh\"===e.primitive,x=this.getComputeTexCoordsFunc(e,c),_=y&&!d;for(const e of n){const n=[];for(let r=0;r<e.rings.length;r++){const i=0===r;let s=e.rings[r];if(_){s.some(e=>e.x<0||e.x>t||e.y<0||e.y>t)&&(s=o.clipPolygon(s,t))}const a=f.ShapeUtils.area(s);if(i&&0===a)break;if(0!==a){let e;void 0!==x&&(e=s.map(e=>x(e,t))),n.push(new g.Ring(s,e,t,_))}}n.length>0&&h.push(n)}const b=r.isSolidLineTechnique(e)||r.isLineTechnique(e);if(y)this.applyPolygonTechnique(h,e,s,i,t);else if(b){const n=\"line\"===e.name?this.m_simpleLines:this.m_solidLines,o=\"line\"===e.name?G.Simple:G.Complex,l=r.isSpecialDashesLineTechnique(e);h.forEach(r=>{const c=[],u=l?[]:void 0;r.forEach(e=>{const n=e.points.length;let r=[],i=0,o=0,s=l?[]:void 0;for(let a=0;a<n;++a){l&&r.length>0&&(r=[],s=[]);const h=(a+1)%n,d=e.points[a],p=e.points[h],f=e.isProperEdge(a);if(f||0===r.length){if(f&&0===r.length&&(m.webMercatorTile2TargetTile(t,this.m_decodeInfo,w.copy(d),S,!1),r.push(S.x,S.y,S.z),l)){m.webMercatorTile2TargetTile(t,this.m_decodeInfo,w.copy(p),E,!1),r.push(E.x,E.y,E.z),s.push(o);const e=S.distanceTo(E);i+=e,o+=e,s.push(o)}}else c.push(r),r=[];f&&!l&&(m.webMercatorTile2TargetTile(t,this.m_decodeInfo,w.copy(p),S,!1),r.push(S.x,S.y,S.z)),l&&r.length>0&&i>0&&(s.forEach((e,t)=>{s[t]=e/i}),c.push(r),u.push(s))}!l&&r.length>0&&c.push(r)}),0!==c.length&&this.applyLineTechnique(n,e,s,o,a.entries,c,i,void 0,u)})}})}getDecodedTile(){this.createGeometries(),this.processSimpleLines(this.m_simpleLines),this.processLines(this.m_solidLines);const e={techniques:this.m_styleSetEvaluator.decodedTechniques,geometries:this.m_geometries,decodeTime:void 0};return this.m_textGeometries.length>0&&(e.textGeometries=this.m_textGeometries),this.m_poiGeometries.length>0&&(e.poiGeometries=this.m_poiGeometries),this.m_textPathGeometries.length>0&&(e.textPathGeometries=this.m_textPathGeometries),this.m_pathGeometries.length>0&&(e.pathGeometries=this.m_pathGeometries),0!==this.m_sources.length&&(e.copyrightHolderIds=this.m_sources),e.maxGeometryHeight=this.m_maxGeometryHeight,e.minGeometryHeight=this.m_minGeometryHeight,e}splitJaggyLines(e,t,n){const r=[],i=(e,t,n)=>{let r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(let a=t;a<n;a+=3){const t=e[a],n=e[a+1];t<r&&(r=t),t>i&&(i=t),n<o&&(o=n),n>s&&(s=n)}return(i-r)*(i-r)+(s-o)*(s-o)},o=e.slice();for(;o.length>0;){const e=o.pop();if(void 0===e||e.length<6)continue;let s=-1;for(let t=0;t<e.length-3;t+=3){L.set(e[t],e[t+1]),A.set(e[t+3],e[t+4]);const r=A.sub(L).normalize();if(t>0){const e=Math.atan2(P.x*r.y-r.x*P.y,r.dot(P));if(Math.abs(e)>n){s=t;break}}P.set(r.x,r.y)}if(s>0){const n=i(e,0,s+3),a=i(e,s,e.length);n>t&&r.push(e.slice(0,s+3)),a>t&&o.push(e.slice(s))}else{i(e,0,e.length)>t&&r.push(e)}}return r}getTextureCoordinateType(e){return(r.isFillTechnique(e)||r.isSolidLineTechnique(e)||r.isExtrudedPolygonTechnique(e))&&this.m_options.enableElevationOverlay?r.TextureCoordinateType.TileSpace:r.textureCoordinateType(e)}getComputeTexCoordsFunc(e,t){switch(this.getTextureCoordinateType(e)){case r.TextureCoordinateType.TileSpace:return(e,t)=>{const n=e.clone().divideScalar(t);return n.y=1-n.y,n};case r.TextureCoordinateType.EquirectangularSpace:return(e,t)=>{const n=m.tile2world(t,this.m_decodeInfo,e,!1,T),r=l.normalizedEquirectangularProjection.reprojectPoint(l.webMercatorProjection,n);return new f.Vector2(r.x,r.y)};case r.TextureCoordinateType.FeatureSpace:if(!t)return;return(e,n)=>{const r=m.tile2world(n,this.m_decodeInfo,e,!1,T),i=new f.Vector2(r.x,r.y);return t&&(i.x-=t.min.x,i.y-=t.min.y,i.x/=t.max.x-t.min.x,i.y/=t.max.y-t.min.y),i.y=1-i.y,i};default:return}}applyLineTechnique(e,t,n,i=G.Complex,o,s,a,l,u){let h;const d=e.find(e=>e.technique===n),p=void 0!==l;if(void 0===d){h=new c.LineGroup(p,void 0,i===G.Simple);const t={type:i===G.Complex?r.GeometryType.SolidLine:r.GeometryType.Line,technique:n,lines:h};this.m_options.gatherFeatureAttributes&&(t.objInfos=[o],t.featureStarts=[0]),e.push(t)}else h=d.lines,this.m_options.gatherFeatureAttributes&&d.objInfos&&d.featureStarts&&(d.objInfos.push(o),d.featureStarts.push(h.indices.length));let f=0;s.forEach(e=>{h.add(this.m_decodeInfo.center,e,this.projection,u?u[f]:void 0,l?l[f]:void 0),f++})}applyPolygonTechnique(e,t,n,o,c){var u,g;if(0===e.length)return;const E=r.isExtrudedPolygonTechnique(t),L=E?r.GeometryType.ExtrudedPolygon:r.GeometryType.Polygon,A=this.findOrCreateMeshBuffers(n,L);if(void 0===A)return;const P=t,C=t,R=!0===P.boundaryWalls,I=r.isFillTechnique(t),O=this.getTextureCoordinateType(t);let D=i.evaluateTechniqueAttr(o,P.height),N=i.evaluateTechniqueAttr(o,P.floorHeight);if(void 0===D){const e=o.env.lookup(\"height\"),t=i.evaluateTechniqueAttr(o,P.defaultHeight);D=void 0!==e?e:void 0!==t?t:0}if(void 0===N){const e=o.env.lookup(\"min_height\");N=void 0===e||I?0:e}D=Math.max(N+h.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT,D);const z=this.m_decodeInfo.tileKey.level,F=E&&r.scaleHeight(o,P,z);this.m_decodeInfo.tileBounds.getCenter(y);const{positions:G,normals:k,textureCoordinates:V,colors:H,extrusionAxis:j,indices:W,edgeIndices:q,groups:X}=A,Y=this.m_decodeInfo.targetProjection.type===l.ProjectionType.Spherical,Z=E?null!==(u=P.lineWidth)&&void 0!==u?u:0:I&&null!==(g=C.lineWidth)&&void 0!==g?g:0,J=\"number\"!=typeof Z||Z>0;let K;if(r.isExtrudedPolygonTechnique(t)&&d.getOptionValue(t.vertexColors,!1)){let e=i.evaluateTechniqueAttr(o,t.color);if(void 0===e){const t=o.env.lookup(\"color\");this.isColorStringValid(t)&&(e=String(t))}void 0===e&&(e=i.evaluateTechniqueAttr(o,t.defaultColor,0)),void 0===e&&(e=0),U.set(e),K=U}for(const t of e){const e=W.length,r=q.length,i=[],u=G.length/3,h=t[0],d=h.vertexStride,g=d+2;for(let e=0;e<h.points.length;++e){const t=h.points[e];i.push(t.x,-t.y),void 0!==h.textureCoords&&i.push(h.textureCoords[e].x,h.textureCoords[e].y);const n=(e+1)%h.points.length,r=h.isProperEdge(e);i.push(r?n:-1,R||r?n:-1)}const y=[];let L=1;for(;L<t.length;){const e=i.length/g;y.push(e);const n=t[L++];for(let t=0;t<n.points.length;++t){const r=(t+1)%n.points.length,o=n.points[t];i.push(o.x,-o.y),void 0!==n.textureCoords&&i.push(n.textureCoords[t].x,n.textureCoords[t].y);const s=n.isProperEdge(t);i.push(s?e+r:-1,R||s?e+r:-1)}}try{const e=p.default(i,y,g),t=i.length/g;if(Y){const t=new f.BufferGeometry,n=[],r=[],o=[],u=[];for(let e=0;e<i.length;e+=g){const t=m.tile2world(c,this.m_decodeInfo,w.set(i[e],i[e+1]),!0,T);n.push(t.x,t.y,0),void 0!==O&&r.push(i[e+2],i[e+3]),o.push(i[e+d]),u.push(i[e+d+1])}const h=new f.BufferAttribute(new Float32Array(n),3);let p;t.setAttribute(\"position\",h),void 0!==O&&(p=new f.BufferAttribute(new Float32Array(r),2),t.setAttribute(\"uv\",p));const v=new f.BufferAttribute(new Float32Array(o),1);t.setAttribute(\"edge\",v);const y=new f.BufferAttribute(new Float32Array(u),1);t.setAttribute(\"wall\",v);const x=B(e,h.count-1),_=\"uint32\"===x.type?new f.Uint32BufferAttribute(x.buffer,1):new f.Uint16BufferAttribute(x.buffer,1);t.setIndex(_);const b=this.m_decodeInfo.tileKey.level;if(b>=3&&b<9){const e=Math.pow(2,9-b),{geoBox:n}=this.m_decodeInfo;new s.EdgeLengthGeometrySubdivisionModifier(e,n,s.SubdivisionMode.NoDiagonals,l.webMercatorProjection).modify(t)}new a.SphericalGeometrySubdivisionModifier(f.MathUtils.degToRad(10),l.webMercatorProjection).modify(t),i.length=0,e.length=0;for(let e=0;e<h.array.length;e+=3){const t=m.world2tile(c,this.m_decodeInfo,S.set(h.array[e],h.array[e+1],0),!0,M);i.push(t.x,t.y),void 0!==O&&(i.push(p.array[e/3*2]),i.push(p.array[e/3*2+1])),i.push(v.array[e/3]),i.push(y.array[e/3])}const E=t.getIndex();null!==E&&e.push(...E.array)}x.set(0,0,1);for(let e=0;e<i.length;e+=g){m.webMercatorTile2TargetWorld(c,this.m_decodeInfo,w.set(i[e],i[e+1]),S,!1,!0);const t=F?this.m_decodeInfo.targetProjection.getScaleFactor(S):1;this.m_maxGeometryHeight=Math.max(this.m_maxGeometryHeight,t*D),this.m_minGeometryHeight=Math.min(this.m_minGeometryHeight,t*D),Y&&x.set(S.x,S.y,S.z).normalize(),S.sub(this.center),_.copy(x).multiplyScalar(N*t),G.push(S.x+_.x,S.y+_.y,S.z+_.z),void 0!==O&&V.push(i[e+2],i[e+3]),this.m_options.enableElevationOverlay&&k.push(...x.toArray()),E&&(b.copy(x).multiplyScalar(D*t),G.push(S.x+b.x,S.y+b.y,S.z+b.z),j.push(0,0,0,0,b.x-_.x,b.y-_.y,b.z-_.z,1),void 0!==O&&V.push(i[e+2],i[e+3]),this.m_options.enableElevationOverlay&&k.push(...x.toArray()),void 0!==K&&H.push(K.r,K.g,K.b,K.r,K.g,K.b))}for(let t=0;t<e.length;t+=3)if(E){const n=u+2*e[t+0]+1,r=u+2*e[t+1]+1,i=u+2*e[t+2]+1;W.push(n,r,i)}else{const n=u+e[t+0],r=u+e[t+1],i=u+e[t+2];W.push(n,r,i)}J&&this.addEdges(u,t,g,d,G,i,q,E,P.footprint,P.maxSlope),E&&this.addWalls(u,t,g,d,i,W)}catch(e){v.error(\"cannot triangulate geometry\",e)}this.m_options.gatherFeatureAttributes&&(A.objInfos.push(o.env.entries),A.featureStarts.push(e),A.edgeFeatureStarts.push(r));const C=W.length-e;C>0&&X.push({start:e,count:C,technique:n})}}createGeometries(){this.m_meshBuffers.forEach((e,t)=>{if(0===e.positions.length)return;if(!this.m_styleSetEvaluator.techniques||this.m_styleSetEvaluator.techniques.length<=t)throw new Error(\"Invalid technique index\");const n=this.m_styleSetEvaluator.techniques[t];if(void 0===n)return;if(e.texts.length>0){const i={positions:{name:\"position\",type:\"float\",buffer:new Float64Array(e.positions).buffer,itemCount:3},texts:e.texts,technique:t,stringCatalog:e.stringCatalog,objInfos:e.objInfos};if(r.isTextTechnique(n))this.m_textGeometries.push(i);else{d.assert(r.isPoiTechnique(n));const t=i;t.imageTextures=e.imageTextures,t.offsetDirections=e.offsetDirections,this.m_poiGeometries.push(t)}return}const i=new Float32Array(e.positions);0===e.groups.length&&e.groups.push({start:0,count:i.length/3,technique:t});const o=[{name:\"position\",buffer:i.buffer,itemCount:3,type:\"float\"}],s={type:e.type,vertexAttributes:o,groups:e.groups};if(e.normals.length>0){const t=new Float32Array(e.normals);d.assert(t.length===i.length,\"length of normals buffer is different than the length of the position buffer\"),o.push({name:\"normal\",buffer:t.buffer,itemCount:3,type:\"float\"})}if(e.colors.length>0){const t=new Float32Array(e.colors);d.assert(t.length===i.length,\"length of colors buffer is different than the length of the position buffer\"),o.push({name:\"color\",buffer:t.buffer,itemCount:3,type:\"float\"})}const a=e.positions.length/3;if(e.textureCoordinates.length>0){const t=e.textureCoordinates.length/2;d.assert(t===a,\"length of textureCoordinates buffer is different than the length of theposition buffer\");const n=new Float32Array(e.textureCoordinates);o.push({name:\"uv\",buffer:n.buffer,itemCount:2,type:\"float\"})}if(e.extrusionAxis.length>0){const t=new Float32Array(e.extrusionAxis);d.assert(t.length/4==i.length/3,\"length of extrusionAxis buffer is different than the length of the position buffer\"),o.push({name:\"extrusionAxis\",buffer:t.buffer,itemCount:4,type:\"float\"})}e.indices.length>0&&(s.index=B(e.indices,a-1)),e.edgeIndices.length>0&&(s.edgeIndex=B(e.edgeIndices,a-1,\"edgeIndex\")),s.featureStarts=e.featureStarts,s.edgeFeatureStarts=e.edgeFeatureStarts,s.objInfos=e.objInfos,this.m_geometries.push(s)})}processLines(e){e.forEach(e=>{const{vertices:t,indices:n}=e.lines,i=e.technique,o=new Float32Array(t).buffer,s=B(n,t.length/e.lines.stride-1),a={type:\"float\",stride:e.lines.stride,buffer:o,attributes:e.lines.vertexAttributes},l={type:r.GeometryType.SolidLine,index:s,interleavedVertexAttributes:[a],groups:[{start:0,count:n.length,technique:i}],vertexAttributes:[],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(l)})}processSimpleLines(e){e.forEach(e=>{const{vertices:t,indices:n}=e.lines,i=e.technique,o={buffer:new Float32Array(t).buffer,itemCount:3,type:\"float\",name:\"position\"},s={type:r.GeometryType.Line,index:B(n,t.length/o.itemCount-1),vertexAttributes:[o],groups:[{start:0,count:n.length,technique:i}],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(s)})}findOrCreateMeshBuffers(e,t){let n=this.m_meshBuffers.get(e);return void 0!==n?n.type!==t?void v.error(`MeshBuffer has been created with wrong type \"${r.GeometryType[t]}\"\\n                instead of \"${r.GeometryType[n.type]}\"`):n:(n=new F(t),this.m_meshBuffers.set(e,n),n)}processFeatureCommon(e){const t=e.lookup(\"source\");\"string\"==typeof t&&\"\"!==t&&(this.m_sources.includes(t)||this.m_sources.push(t))}isColorStringValid(e){return\"string\"==typeof e&&e.length>0}addEdges(e,t,n,r,i,o,s,a,l,c){const u=new f.Vector3,h=new f.Vector3;let d,p,m=0,g=0;for(;m<t;){for(;m!==d;){void 0===d&&(d=m),m<t&&(g=Math.max(g,m));const f=o[m*n+r];if(f<0)break;if(a)if(!0===l&&s.push(e+2*m,e+2*f),s.push(e+2*m+1,e+2*f+1),void 0!==c){if(void 0!==p){const t=3*(e+2*p),n=3*(e+2*m),r=3*(e+2*f);u.set(i[n]-i[t],i[n+1]-i[t+1],i[n+2]-i[t+2]).normalize(),h.set(i[r]-i[n],i[r+1]-i[n+1],i[r+2]-i[n+2]).normalize(),u.dot(h)<=c&&s.push(e+2*m,e+2*m+1)}}else s.push(e+2*m,e+2*m+1);else s.push(e+m,e+f);p=m,m=f}m=g+1,d=void 0,p=void 0}}addWalls(e,t,n,r,i,o){let s,a=0,l=0;for(;a<t;){for(;a!==s;){void 0===s&&(s=a),a<t&&(l=Math.max(l,a));const c=i[a*n+r+1];if(c<0)break;o.push(e+2*a,e+2*a+1,e+2*c+1,e+2*c+1,e+2*c,e+2*a),a=c}a=l+1,s=void 0}}findRelativePositionInLine(e,t){let n=1/0,r=0;for(let i=0;i<t.length;i+=4){N.set(C.set(t[i],t[i+1],t[i+2]),R.set(t[i+4],t[i+5],t[i+6])),N.closestPointToPoint(e,!0,I);const o=I.distanceTo(e);o<n&&(O.copy(I),D.copy(C),n=o,r=t[i+3])}return r+O.distanceTo(D)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.clipPolygon=t.ClippingEdge=void 0;const r=n(0);class i{clipPolygon(e,t){const n=e;e=[];const r=t=>{const n=e[e.length-1];(!(null==n?void 0:n.equals(t))||!0===t.isClipped&&!(null==n?void 0:n.isClipped)||!t.isClipped&&!0===(null==n?void 0:n.isClipped))&&e.push(t)};for(let e=0;e<n.length;++e){const i=n[e],o=n[(e+n.length-1)%n.length];if(this.inside(i,t)){if(!this.inside(o,t)){const e=this.computeIntersection(o,i,t);e.isClipped=!0,r(e)}r(i)}else if(this.inside(o,t)){const e=this.computeIntersection(o,i,t);e.isClipped=!0,r(e)}}return e}}t.ClippingEdge=i;const o=[new class extends i{inside(e){return e.y>=0}computeIntersection(e,t){const{x:n,y:i}=e,{x:o,y:s}=t;return new r.Vector2((n*s-i*o)/-(i-s),0).round()}},new class extends i{inside(e,t){return e.x<=t}computeIntersection(e,t,n){const{x:i,y:o}=e,{x:s,y:a}=t;return new r.Vector2(n,(i*a-o*s-(o-a)*-n)/(i-s)).round()}},new class extends i{inside(e,t){return e.y<=t}computeIntersection(e,t,n){const{x:i,y:o}=e,{x:s,y:a}=t;return new r.Vector2((i*a-o*s-(i-s)*n)/-(o-a),n).round()}},new class extends i{inside(e){return e.x>=0}computeIntersection(e,t){const{x:n,y:i}=e,{x:o,y:s}=t;return new r.Vector2(0,(n*s-i*o)/(n-o)).round()}}];t.clipPolygon=function(e,t){if(0===e.length)return e;e[0].equals(e[e.length-1])||(e=[...e,e[0]]);for(const n of o)e=n.clipPolygon(e,t);return e.length<3?[]:e}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.EdgeLengthGeometrySubdivisionModifier=t.SubdivisionMode=void 0;const r=n(3),i=n(2),o=n(0),s=n(55),a=[new o.Vector3,new o.Vector3];var l;!function(e){e[e.All=0]=\"All\",e[e.NoDiagonals=1]=\"NoDiagonals\"}(l=t.SubdivisionMode||(t.SubdivisionMode={}));class c extends s.SubdivisionModifier{constructor(e,t,n=l.All,o){super(),this.subdivision=e,this.geoBox=t,this.subdivisionMode=n,this.projection=o,i.assert(o.type===r.ProjectionType.Planar,\"EdgeLengthGeometrySubdivisionModifier only supports planar projections\");const s=o.projectPoint(t.northEast,a[0]),c=o.projectPoint(t.southWest,a[1]);this.m_projectedBox={min:{x:Math.min(s.x,c.x),y:Math.min(s.y,c.y),z:Math.min(s.z,c.z)},max:{x:Math.max(s.x,c.x),y:Math.max(s.y,c.y),z:Math.max(s.z,c.z)}},this.m_maxLengthX=(this.m_projectedBox.max.x-this.m_projectedBox.min.x)/e,this.m_maxLengthY=(this.m_projectedBox.max.y-this.m_projectedBox.min.y)/e,this.subdivisionMode===l.All&&(this.m_maxLengthX*=1.1,this.m_maxLengthY*=1.1),this.m_maxLength=Math.sqrt(this.m_maxLengthX*this.m_maxLengthX+this.m_maxLengthY*this.m_maxLengthY)}get maxLength(){return this.m_maxLength}get maxLengthX(){return this.m_maxLengthX}get maxLengthY(){return this.m_maxLengthY}shouldSplitTriangle(e,t,n){const r=this.shouldSplitEdge(e,t),i=this.shouldSplitEdge(t,n),o=this.shouldSplitEdge(n,e);if(!(r||i||o))return;const s=e.distanceTo(t),a=t.distanceTo(n),l=n.distanceTo(e),c=Math.max(r?s:0,i?a:0,o?l:0);if(s===c)return 0;if(a===c)return 1;if(l===c)return 2;throw new Error(\"Could not split triangle.\")}shouldSplitEdge(e,t){switch(this.subdivisionMode){case l.All:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY||e.distanceTo(t)>this.m_maxLength;case l.NoDiagonals:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY}}}t.EdgeLengthGeometrySubdivisionModifier=c},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.SphericalGeometrySubdivisionModifier=void 0;const r=n(3),i=n(0),o=n(55),s=[new i.Vector3,new i.Vector3,new i.Vector3];class a extends o.SubdivisionModifier{constructor(e,t=r.sphereProjection){super(),this.angle=e,this.projection=t}shouldSplitTriangle(e,t,n){const i=r.sphereProjection.reprojectPoint(this.projection,e,s[0]),o=r.sphereProjection.reprojectPoint(this.projection,t,s[1]),a=r.sphereProjection.reprojectPoint(this.projection,n,s[2]),l=i.angleTo(o),c=o.angleTo(a),u=a.angleTo(i),h=Math.max(l,Math.max(c,u));if(!(h<this.angle)){if(h===l)return 0;if(h===c)return 1;if(h===u)return 2;throw new Error(\"failed to split triangle\")}}}t.SphericalGeometrySubdivisionModifier=a},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.LineGroup=t.createSimpleLineGeometry=t.createLineGeometry=t.LineGeometry=void 0;const r=n(2),i=n(0),o=new i.Vector3,s=new i.Vector3,a=new i.Vector3,l=new i.Vector3,c=new i.Vector3,u={attributes:[{name:\"extrusionCoord\",itemSize:3,offset:0},{name:\"position\",itemSize:3,offset:3},{name:\"tangent\",itemSize:3,offset:6},{name:\"bitangent\",itemSize:4,offset:9}],stride:13},h={attributes:[{name:\"uv\",itemSize:2,offset:u.stride},{name:\"normal\",itemSize:3,offset:u.stride+2}],stride:5},d={attributes:[...u.attributes,...h.attributes],stride:u.stride+h.stride},p={attributes:[{name:\"extrusionCoord\",itemSize:2,offset:0},{name:\"position\",itemSize:3,offset:2},{name:\"positionLow\",itemSize:3,offset:5},{name:\"tangent\",itemSize:3,offset:8},{name:\"bitangent\",itemSize:4,offset:11}],stride:15},f={attributes:[...p.attributes,...h.attributes],stride:p.stride+h.stride};class m{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function g(e,t){return t?e?f:p:e?d:u}function v(e,t,n,i,u,h,d=new m,p=!1){if(0===t.length)return d;const f=g(void 0!==u,p).stride,v=t.length/3,y=new Array(v),x=new Array(t.length-3),_=d.vertices.length/f,b=void 0!==i&&i.length>0,w=void 0!==u&&u.length>0,M=void 0!==h&&h.length&&t.length;r.assert(!b||i.length===v),r.assert(!w||u.length/2===v),r.assert(!M||h.length===t.length);let S=.1;y[0]=S;for(let e=0;e<v-1;++e){let n=0;for(let r=0;r<3;++r){const i=t[3*(e+1)+r]-t[3*e+r];x[3*e+r]=i,n+=i*i}S+=Math.sqrt(n),y[e+1]=S}const T=b?Math.abs(i[i.length-1]-i[0]):1,E=y[y.length-1]/T;if(b)for(let e=0;e<v;++e)y[e]=i[e]*E+.1;let L=!0;for(let e=0;e<3;++e)L=L&&t[e]===t[t.length-3+e];const A=[],P=(r,i,f,m,g)=>{A.length=0,d.vertices.push(m,-1*g,E),A.push(m,1*g,E);for(let e=0;e<3;++e){if(p){const n=Math.fround(t[3*r+e]),i=t[3*r+e]-n;d.vertices.push(n,i),A.push(n,i)}else d.vertices.push(t[3*r+e]),A.push(t[3*r+e]);s.setComponent(e,t[3*r+e])}for(let e=0;e<3;++e)a.setComponent(e,x[i+e]),l.setComponent(e,x[f+e]);a.normalize(),d.vertices.push(a.x,a.y,a.z),A.push(a.x,a.y,a.z),s.add(e),n.surfaceNormal(s,s);const v=function(e,t,n,r){let i=0;t.equals(n)||(i=Math.acos(t.dot(n))*Math.sign(e.dot(o.copy(t).cross(n))),Number.isNaN(i)&&(i=0));return r.copy(t).add(n).normalize().cross(e).normalize(),i}(s,a,l.normalize(),c);d.vertices.push(c.x,c.y,c.z,v),A.push(c.x,c.y,c.z,v),w&&(d.vertices.push(u[2*r],u[2*r+1]),A.push(u[2*r],u[2*r+1]),d.vertices.push(s.x,s.y,s.z),A.push(s.x,s.y,s.z)),d.vertices.push(...A),M&&(d.vertexColors.push(h[3*r],h[3*r+1],h[3*r+2]),d.vertexColors.push(h[3*r],h[3*r+1],h[3*r+2]))};for(let e=0;e<v;++e){const t=L&&0===e?x.length-3:3*Math.max(0,e-1),n=L&&e===v-1?0:Math.min(3*e,x.length-3);e>0&&P(e,t,n,y[e-1],y[e]),e+1<v&&P(e,t,n,-1*y[Math.min(e,y.length-1)],y[Math.min(e+1,y.length-1)])}for(let e=0;e<v-1;++e){const t=_+4*e;d.indices.push(t,t+1,t+2,t+2,t+1,t+3)}return d}function y(e,t,n=new m){if(0===e.length)return n;const r=e.length/3;let i=n.vertices.length/3;const o=void 0!==t&&t.length&&e.length;for(let s=0;s<r;++s,i++){s>0&&n.indices.push(i),s<r-1&&n.indices.push(i);for(let r=0;r<3;++r)n.vertices.push(e[3*s+r]),o&&n.vertexColors.push(t[3*s+r])}return n}t.LineGeometry=m,t.createLineGeometry=v,t.createSimpleLineGeometry=y;class x{constructor(e=!1,t=!1,n=!1){this.hasNormalsAndUvs=e,this.highPrecision=t,this.isSimple=n,this.m_geometry=new m}static createGeometry(e,t,n,r,o=!1,s=!1,a=!1){if(a)return r.setAttribute(\"position\",new i.BufferAttribute(new Float32Array(e),3)),t.length===e.length&&r.setAttribute(\"color\",new i.BufferAttribute(new Float32Array(t),3)),r.setIndex(new i.BufferAttribute(new Uint32Array(n),1)),r;{const a=g(o,s),l=new i.InterleavedBuffer(new Float32Array(e),a.stride);return a.attributes.forEach(e=>{const t=new i.InterleavedBufferAttribute(l,e.itemSize,e.offset,!1);r.setAttribute(e.name,t)}),t.length===e.length&&r.setAttribute(\"color\",new i.BufferAttribute(new Float32Array(t),3)),r.setIndex(new i.BufferAttribute(new Uint32Array(n),1)),r}}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(e,t,n,i,o,s){return this.isSimple?y(t,s,this.m_geometry):(r.assert(!this.hasNormalsAndUvs||void 0!==o),v(e,t,n,i,o,s,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return g(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return g(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(e){return void 0===e&&(e=new i.BufferGeometry),x.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,e,this.hasNormalsAndUvs,this.highPrecision)}}t.LineGroup=x},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.reconstructLineWidth=t.reconstructLine=t.triangulateLine=t.numCirclePoints=void 0;const r=n(0),i=new r.Vector3(0,0,1),o=[0,1,2,1,3,2],s=[0,1,3,3,1,2,0,3,4,5,4,3],a=Math.PI/8;function l(e,t,n,r,i,o){const s=i.length/3;i.push(e,t,0);for(let l=0;l<9;++l){const c=a*l+Math.PI/2+n;i.push(e+r*Math.cos(c),t+r*Math.sin(c),0),o.push(s,s+l+1,s+(l+1)%9+1)}}t.numCirclePoints=function(e){return 9},t.triangulateLine=function(e,t,n,a,c=!0,u=c){if(e.length<3)return;const h=new r.Vector2;if(c){const r=3!==e.length?h.set(e[3]-e[0],e[4]-e[1]).angle():0;l(e[0],e[1],r,t,n,a)}const d=n.length/3,p=new r.Vector3,f=new r.Vector3,m=new r.Vector3,g=new r.Vector3,v=new r.Vector3,y=new r.Vector3,x=new r.Vector3,_=new r.Vector3,b=new r.Vector3,w=e.length/3;let M=0;for(let r=0;r<w;++r){let l=!1;if(f.set(e[3*r],e[3*r+1],e[3*r+2]),r+1<w){if(m.set(e[3*(r+1)],e[3*(r+1)+1],e[3*(r+1)+2]),g.copy(m).sub(f).normalize().cross(i),v.copy(g),r>0&&(v.add(p).multiplyScalar(1-.5*g.dot(p)),l=p.angleTo(g)>Math.PI/2,l)){const e=t/Math.cos(g.angleTo(p)/2);y.copy(g).add(p).normalize().multiplyScalar(-e).add(f),x.copy(p).multiplyScalar(t).add(f),_.copy(g).add(p).normalize().multiplyScalar(e).add(f),b.copy(g).multiplyScalar(t).add(f)}l?n.push(y.x,y.y,y.z,x.x,x.y,x.z,_.x,_.y,_.z,b.x,b.y,b.z):(y.copy(v).multiplyScalar(-t).add(f),x.copy(v).multiplyScalar(t).add(f),n.push(y.x,y.y,y.z,x.x,x.y,x.z)),p.copy(g)}else y.copy(p).multiplyScalar(-t).add(f),x.copy(p).multiplyScalar(t).add(f),n.push(y.x,y.y,y.z,x.x,x.y,x.z);r!==w-1&&((l?s:o).forEach(e=>a.push(d+M+e)),M+=l?4:2)}if(u){const r=2!==e.length?h.set(e[3*(w-3)]-e[3*(w-2)],e[3*(w-3)+1]-e[3*(w-2)+1]).angle():Math.PI;l(e[3*(w-2)],e[3*(w-2)+1],r,t,n,a)}},t.reconstructLine=function(e,t){const n=new Float32Array(e.length/2);for(let r=3*t,i=2*r;r<n.length;r+=3,i+=6)n[r]=e[i]+.5*(e[i+3]-e[i]),n[r+1]=e[i+1]+.5*(e[i+3+1]-e[i+1]),n[r+2]=e[i+2]+.5*(e[i+3+2]-e[i+2]);return n},t.reconstructLineWidth=function(e,t){const n=e[2*t+3]-e[2*t],r=e[2*t+3+1]-e[2*t+1],i=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(n*n+r*r+i*i)}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExtrusionFeatureDefs=void 0,function(e){e.DEFAULT_RATIO_MIN=0,e.DEFAULT_RATIO_MAX=1,e.MIN_BUILDING_HEIGHT=.1}(t.ExtrusionFeatureDefs||(t.ExtrusionFeatureDefs={}))},function(e,t,n){\"use strict\";function r(e,t,n){n=n||2;var r,a,l,c,u,p,f,g=t&&t.length,v=g?t[0]*n:e.length,y=i(e,0,v,n,!0),x=[];if(!y||y.next===y.prev)return x;if(g&&(y=function(e,t,n,r){var s,a,l,c,u,p=[];for(s=0,a=t.length;s<a;s++)l=t[s]*r,c=s<a-1?t[s+1]*r:e.length,(u=i(e,l,c,r,!1))===u.next&&(u.steiner=!0),p.push(m(u));for(p.sort(h),s=0;s<p.length;s++)d(p[s],n),n=o(n,n.next);return n}(e,t,y,n)),e.length>80*n){r=l=e[0],a=c=e[1];for(var _=n;_<v;_+=n)(u=e[_])<r&&(r=u),(p=e[_+1])<a&&(a=p),u>l&&(l=u),p>c&&(c=p);f=0!==(f=Math.max(l-r,c-a))?1/f:0}return s(y,x,n,r,a,f),x}function i(e,t,n,r,i){var o,s;if(i===A(e,t,n,r)>0)for(o=t;o<n;o+=r)s=T(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=T(o,e[o],e[o+1],s);return s&&x(s,s.next)&&(E(s),s=s.next),s}function o(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!x(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{if(E(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function s(e,t,n,r,i,h,d){if(e){!d&&h&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=f(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(s>1)}(i)}(e,r,i,h);for(var p,m,g=e;e.prev!==e.next;)if(p=e.prev,m=e.next,h?l(e,r,i,h):a(e))t.push(p.i/n),t.push(e.i/n),t.push(m.i/n),E(e),e=m.next,g=m.next;else if((e=m)===g){d?1===d?s(e=c(o(e),t,n),t,n,r,i,h,2):2===d&&u(e,t,n,r,i,h):s(o(e),t,n,r,i,h,1);break}}}function a(e){var t=e.prev,n=e,r=e.next;if(y(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(g(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&y(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function l(e,t,n,r){var i=e.prev,o=e,s=e.next;if(y(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,l=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,c=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=f(a,l,t,n,r),d=f(c,u,t,n,r),p=e.prevZ,m=e.nextZ;p&&p.z>=h&&m&&m.z<=d;){if(p!==e.prev&&p!==e.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function c(e,t,n){var r=e;do{var i=r.prev,s=r.next.next;!x(i,s)&&_(i,r,r.next,s)&&M(i,s)&&M(s,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(s.i/n),E(r),E(r.next),r=e=s),r=r.next}while(r!==e);return o(r)}function u(e,t,n,r,i,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&v(l,c)){var u=S(l,c);return l=o(l,l.next),u=o(u,u.next),s(l,t,n,r,i,a),void s(u,t,n,r,i,a)}c=c.next}l=l.next}while(l!==e)}function h(e,t){return e.x-t.x}function d(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s){if(s=a,a===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===s)return n;var l,c=n,u=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&g(o<h?i:s,o,u,h,o<h?s:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),M(r,e)&&(l<d||l===d&&(r.x>n.x||r.x===n.x&&p(n,r)))&&(n=r,d=l)),r=r.next}while(r!==c);return n}(e,t)){var n=S(t,e);o(t,t.next),o(n,n.next)}}function p(e,t){return y(e.prev,e,t.prev)<0&&y(t.next,e,e.next)<0}function f(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function g(e,t,n,r,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&_(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(M(e,t)&&M(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(y(e.prev,e,t.prev)||y(e,t.prev,t))||x(e,t)&&y(e.prev,e,e.next)>0&&y(t.prev,t,t.next)>0)}function y(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function _(e,t,n,r){var i=w(y(e,t,n)),o=w(y(e,t,r)),s=w(y(n,r,e)),a=w(y(n,r,t));return i!==o&&s!==a||(!(0!==i||!b(e,n,t))||(!(0!==o||!b(e,r,t))||(!(0!==s||!b(n,e,r))||!(0!==a||!b(n,t,r)))))}function b(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function w(e){return e>0?1:e<0?-1:0}function M(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function S(e,t){var n=new L(e.i,e.x,e.y),r=new L(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function T(e,t,n,r){var i=new L(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function L(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,n,r){for(var i=0,o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}e.exports=r,e.exports.default=r,r.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,s=Math.abs(A(e,0,o,n));if(i)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;s-=Math.abs(A(e,c,u,n))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*n,p=r[a+1]*n,f=r[a+2]*n;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},r.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[i][o][s]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.Ring=void 0;const r=n(0);t.Ring=class{constructor(e,t,n=4096,i=!1){if(this.points=e,this.textureCoords=t,this.extents=n,this.hasClipInfo=i,void 0!==t&&t.length!==e.length)throw new Error(\"the array of texture coordinates must have the same number of elements of the array of points\");this.vertexStride=2,void 0!==t&&(this.vertexStride=this.vertexStride+2),this.area=r.ShapeUtils.area(this.points),this.winding=this.area<0}toArray(e=[],t=0){var n;return this.points.forEach((n,r)=>n.toArray(e,t+this.vertexStride*r)),null===(n=this.textureCoords)||void 0===n||n.forEach((n,r)=>n.toArray(e,t+this.vertexStride*r+2)),e}isProperEdge(e){const t=this.extents,n=(e+1)%this.points.length,r=this.points[e],i=this.points[n];if(this.hasClipInfo){if(r.x!==i.x&&r.y!==i.y)return!0;if(!(r.x%this.extents==0||r.y%this.extents==0))return!0;if(!(i.x%this.extents==0||i.y%this.extents==0))return!0;const e=!0===r.isClipped,t=!0===i.isClipped;return!e&&!t}return!(r.x<=0&&i.x<=0||r.x>=t&&i.x>=t||r.y<=0&&i.y<=0||r.y>=t&&i.y>=t)}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoJsonTilerService=void 0;const r=n(50),i=n(15);t.GeoJsonTilerService=class{static start(){r.WorkerServiceManager.getInstance().register({serviceType:i.GEOJSON_TILER_SERVICE_TYPE,factory:e=>r.TilerService.start(e)})}}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},function(e,t,n){\"use strict\";function r(e,t,n,r,i,o){var s=i-n,a=o-r;if(0!==s||0!==a){var l=((e-n)*s+(t-r)*a)/(s*s+a*a);l>1?(n=i,r=o):l>0&&(n+=s*l,r+=a*l)}return(s=e-n)*s+(a=t-r)*a}function i(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if(\"Point\"===n||\"MultiPoint\"===n||\"LineString\"===n)o(e,t);else if(\"Polygon\"===n||\"MultiLineString\"===n)for(var r=0;r<t.length;r++)o(e,t[r]);else if(\"MultiPolygon\"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)o(e,t[r][i])}(i),i}function o(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function s(e,t,n,r){if(t.geometry){var o=t.geometry.coordinates,u=t.geometry.type,h=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),d=[],p=t.id;if(n.promoteId?p=t.properties[n.promoteId]:n.generateId&&(p=r||0),\"Point\"===u)a(o,d);else if(\"MultiPoint\"===u)for(var f=0;f<o.length;f++)a(o[f],d);else if(\"LineString\"===u)l(o,d,h,!1);else if(\"MultiLineString\"===u){if(n.lineMetrics){for(f=0;f<o.length;f++)d=[],l(o[f],d,h,!1),e.push(i(p,\"LineString\",d,t.properties));return}c(o,d,h,!1)}else if(\"Polygon\"===u)c(o,d,h,!0);else{if(\"MultiPolygon\"!==u){if(\"GeometryCollection\"===u){for(f=0;f<t.geometry.geometries.length;f++)s(e,{id:p,geometry:t.geometry.geometries[f],properties:t.properties},n,r);return}throw new Error(\"Input data is not a valid GeoJSON object.\")}for(f=0;f<o.length;f++){var m=[];c(o[f],m,h,!0),d.push(m)}}e.push(i(p,u,d,t.properties))}}function a(e,t){t.push(u(e[0])),t.push(h(e[1])),t.push(0)}function l(e,t,n,i){for(var o,s,a=0,l=0;l<e.length;l++){var c=u(e[l][0]),d=h(e[l][1]);t.push(c),t.push(d),t.push(0),l>0&&(a+=i?(o*d-c*s)/2:Math.sqrt(Math.pow(c-o,2)+Math.pow(d-s,2))),o=c,s=d}var p=t.length-3;t[2]=1,function e(t,n,i,o){for(var s,a=o,l=i-n>>1,c=i-n,u=t[n],h=t[n+1],d=t[i],p=t[i+1],f=n+3;f<i;f+=3){var m=r(t[f],t[f+1],u,h,d,p);if(m>a)s=f,a=m;else if(m===a){var g=Math.abs(f-l);g<c&&(s=f,c=g)}}a>o&&(s-n>3&&e(t,n,s,o),t[s+2]=a,i-s>3&&e(t,s,i,o))}(t,0,p,n),t[p+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function c(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];l(e[i],o,n,r),t.push(o)}}function u(e){return e/360+.5}function h(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function d(e,t,n,r,o,s,a,l){if(r/=t,s>=(n/=t)&&a<r)return e;if(a<n||s>=r)return null;for(var c=[],u=0;u<e.length;u++){var h=e[u],d=h.geometry,m=h.type,v=0===o?h.minX:h.minY,y=0===o?h.maxX:h.maxY;if(v>=n&&y<r)c.push(h);else if(!(y<n||v>=r)){var x=[];if(\"Point\"===m||\"MultiPoint\"===m)p(d,x,n,r,o);else if(\"LineString\"===m)f(d,x,n,r,o,!1,l.lineMetrics);else if(\"MultiLineString\"===m)g(d,x,n,r,o,!1);else if(\"Polygon\"===m)g(d,x,n,r,o,!0);else if(\"MultiPolygon\"===m)for(var _=0;_<d.length;_++){var b=[];g(d[_],b,n,r,o,!0),b.length&&x.push(b)}if(x.length){if(l.lineMetrics&&\"LineString\"===m){for(_=0;_<x.length;_++)c.push(i(h.id,m,x[_],h.tags));continue}\"LineString\"!==m&&\"MultiLineString\"!==m||(1===x.length?(m=\"LineString\",x=x[0]):m=\"MultiLineString\"),\"Point\"!==m&&\"MultiPoint\"!==m||(m=3===x.length?\"Point\":\"MultiPoint\"),c.push(i(h.id,m,x,h.tags))}}}return c.length?c:null}function p(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var s=e[o+i];s>=n&&s<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function f(e,t,n,r,i,o,s){for(var a,l,c=m(e),u=0===i?y:x,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],g=e[d+2],_=e[d+3],b=e[d+4],w=0===i?p:f,M=0===i?_:b,S=!1;s&&(a=Math.sqrt(Math.pow(p-_,2)+Math.pow(f-b,2))),w<n?M>n&&(l=u(c,p,f,_,b,n),s&&(c.start=h+a*l)):w>r?M<r&&(l=u(c,p,f,_,b,r),s&&(c.start=h+a*l)):v(c,p,f,g),M<n&&w>=n&&(l=u(c,p,f,_,b,n),S=!0),M>r&&w<=r&&(l=u(c,p,f,_,b,r),S=!0),!o&&S&&(s&&(c.end=h+a*l),t.push(c),c=m(e)),s&&(h+=a)}var T=e.length-3;p=e[T],f=e[T+1],g=e[T+2],(w=0===i?p:f)>=n&&w<=r&&v(c,p,f,g),T=c.length-3,o&&T>=3&&(c[T]!==c[0]||c[T+1]!==c[1])&&v(c,c[0],c[1],c[2]),c.length&&t.push(c)}function m(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function g(e,t,n,r,i,o){for(var s=0;s<e.length;s++)f(e[s],t,n,r,i,o,!1)}function v(e,t,n,r){e.push(t),e.push(n),e.push(r)}function y(e,t,n,r,i,o){var s=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*s),e.push(1),s}function x(e,t,n,r,i,o){var s=(o-n)/(i-n);return e.push(t+(r-t)*s),e.push(o),e.push(1),s}function _(e,t){for(var n=[],r=0;r<e.length;r++){var o,s=e[r],a=s.type;if(\"Point\"===a||\"MultiPoint\"===a||\"LineString\"===a)o=b(s.geometry,t);else if(\"MultiLineString\"===a||\"Polygon\"===a){o=[];for(var l=0;l<s.geometry.length;l++)o.push(b(s.geometry[l],t))}else if(\"MultiPolygon\"===a)for(o=[],l=0;l<s.geometry.length;l++){for(var c=[],u=0;u<s.geometry[l].length;u++)c.push(b(s.geometry[l][u],t));o.push(c)}n.push(i(s.id,a,o,s.tags))}return n}function b(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function w(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,s=e.x,a=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(M(c[r],c[r+1],t,o,s,a));else for(r=0;r<c.length;r++){var h=[];for(i=0;i<c[r].length;i+=2)h.push(M(c[r][i],c[r][i+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function M(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function S(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,T(s,e[a],o,i);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function T(e,t,n,r){var i=t.geometry,o=t.type,s=[];if(\"Point\"===o||\"MultiPoint\"===o)for(var a=0;a<i.length;a+=3)s.push(i[a]),s.push(i[a+1]),e.numPoints++,e.numSimplified++;else if(\"LineString\"===o)E(s,i,e,n,!1,!1);else if(\"MultiLineString\"===o||\"Polygon\"===o)for(a=0;a<i.length;a++)E(s,i[a],e,n,\"Polygon\"===o,0===a);else if(\"MultiPolygon\"===o)for(var l=0;l<i.length;l++){var c=i[l];for(a=0;a<c.length;a++)E(s,c[a],e,n,!0,0===a)}if(s.length){var u=t.tags||null;if(\"LineString\"===o&&r.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=i.start/i.size,u.mapbox_clip_end=i.end/i.size}var d={geometry:s,type:\"Polygon\"===o||\"MultiPolygon\"===o?3:\"LineString\"===o||\"MultiLineString\"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function E(e,t,n,r,i,o){var s=r*r;if(r>0&&t.size<(i?s:r))n.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>s)&&(n.numSimplified++,a.push(t[l]),a.push(t[l+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var s=e[r],a=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=s,e[i-1-r]=a}}(a,o),e.push(a)}}function L(e,t){return new A(e,t)}function A(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time(\"preprocess data\"),t.maxZoom<0||t.maxZoom>24)throw new Error(\"maxZoom should be in the 0-24 range\");if(t.promoteId&&t.generateId)throw new Error(\"promoteId and generateId cannot be used together.\");var r=function(e,t){var n=[];if(\"FeatureCollection\"===e.type)for(var r=0;r<e.features.length;r++)s(n,e.features[r],t,r);else\"Feature\"===e.type?s(n,e,t):s(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd(\"preprocess data\"),console.log(\"index: maxZoom: %d, maxPoints: %d\",t.indexMaxZoom,t.indexMaxPoints),console.time(\"generate tiles\"),this.stats={},this.total=0),(r=function(e,t){var n=t.buffer/t.extent,r=e,i=d(e,1,-1-n,n,0,-1,2,t),o=d(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=d(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=_(i,1).concat(r)),o&&(r=r.concat(_(o,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log(\"features: %d, points: %d\",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd(\"generate tiles\"),console.log(\"tiles generated:\",this.total,JSON.stringify(this.stats)))}function P(e,t,n){return 32*((1<<e)*n+t)+e}n.r(t),n.d(t,\"default\",(function(){return L})),A.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},A.prototype.splitTile=function(e,t,n,r,i,o,s){for(var a=[e,t,n,r],l=this.options,c=l.debug;a.length;){r=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();var u=1<<t,h=P(t,n,r),p=this.tiles[h];if(!p&&(c>1&&console.time(\"creation\"),p=this.tiles[h]=S(e,t,n,r,l),this.tileCoords.push({z:t,x:n,y:r}),c)){c>1&&(console.log(\"tile z%d-%d-%d (features: %d, points: %d, simplified: %d)\",t,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd(\"creation\"));var f=\"z\"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,i){if(t===l.maxZoom||t===i)continue;var m=1<<i-t;if(n!==Math.floor(o/m)||r!==Math.floor(s/m))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){c>1&&console.time(\"clipping\");var g,v,y,x,_,b,w=.5*l.buffer/l.extent,M=.5-w,T=.5+w,E=1+w;g=v=y=x=null,_=d(e,u,n-w,n+T,0,p.minX,p.maxX,l),b=d(e,u,n+M,n+E,0,p.minX,p.maxX,l),e=null,_&&(g=d(_,u,r-w,r+T,1,p.minY,p.maxY,l),v=d(_,u,r+M,r+E,1,p.minY,p.maxY,l),_=null),b&&(y=d(b,u,r-w,r+T,1,p.minY,p.maxY,l),x=d(b,u,r+M,r+E,1,p.minY,p.maxY,l),b=null),c>1&&console.timeEnd(\"clipping\"),a.push(g||[],t+1,2*n,2*r),a.push(v||[],t+1,2*n,2*r+1),a.push(y||[],t+1,2*n+1,2*r),a.push(x||[],t+1,2*n+1,2*r+1)}}},A.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var s=1<<e,a=P(e,t=(t%s+s)%s,n);if(this.tiles[a])return w(this.tiles[a],i);o>1&&console.log(\"drilling down to z%d-%d-%d\",e,t,n);for(var l,c=e,u=t,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[P(c,u,h)];return l&&l.source?(o>1&&console.log(\"found parent tile z%d-%d-%d\",c,u,h),o>1&&console.time(\"drilling down\"),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd(\"drilling down\"),this.tiles[a]?w(this.tiles[a],i):null):null}}]);";
!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=184)}([function(e,t,i){"use strict";i.r(t),i.d(t,"ACESFilmicToneMapping",(function(){return ie})),i.d(t,"AddEquation",(function(){return S})),i.d(t,"AddOperation",(function(){return $})),i.d(t,"AdditiveAnimationBlendMode",(function(){return qt})),i.d(t,"AdditiveBlending",(function(){return w})),i.d(t,"AlphaFormat",(function(){return Ve})),i.d(t,"AlwaysDepth",(function(){return G})),i.d(t,"AlwaysStencilFunc",(function(){return Mi})),i.d(t,"AmbientLight",(function(){return Du})),i.d(t,"AmbientLightProbe",(function(){return ed})),i.d(t,"AnimationClip",(function(){return Oh})),i.d(t,"AnimationLoader",(function(){return zh})),i.d(t,"AnimationMixer",(function(){return Ld})),i.d(t,"AnimationObjectGroup",(function(){return Ad})),i.d(t,"AnimationUtils",(function(){return xh})),i.d(t,"ArcCurve",(function(){return Kh})),i.d(t,"ArrayCamera",(function(){return qa})),i.d(t,"ArrowHelper",(function(){return _m})),i.d(t,"Audio",(function(){return ud})),i.d(t,"AudioAnalyser",(function(){return vd})),i.d(t,"AudioContext",(function(){return $u})),i.d(t,"AudioListener",(function(){return hd})),i.d(t,"AudioLoader",(function(){return Ju})),i.d(t,"AxesHelper",(function(){return xm})),i.d(t,"AxisHelper",(function(){return _p})),i.d(t,"BackSide",(function(){return f})),i.d(t,"BasicDepthPacking",(function(){return ri})),i.d(t,"BasicShadowMap",(function(){return h})),i.d(t,"BinaryTextureLoader",(function(){return Tp})),i.d(t,"Bone",(function(){return Rl})),i.d(t,"BooleanKeyframeTrack",(function(){return Eh})),i.d(t,"BoundingBoxHelper",(function(){return xp})),i.d(t,"Box2",(function(){return kd})),i.d(t,"Box3",(function(){return hn})),i.d(t,"Box3Helper",(function(){return pm})),i.d(t,"BoxBufferGeometry",(function(){return Ts})),i.d(t,"BoxGeometry",(function(){return Ts})),i.d(t,"BoxHelper",(function(){return mm})),i.d(t,"BufferAttribute",(function(){return Ur})),i.d(t,"BufferGeometry",(function(){return rs})),i.d(t,"BufferGeometryLoader",(function(){return ku})),i.d(t,"ByteType",(function(){return Se})),i.d(t,"Cache",(function(){return Fh})),i.d(t,"Camera",(function(){return Cs})),i.d(t,"CameraHelper",(function(){return hm})),i.d(t,"CanvasRenderer",(function(){return Ep})),i.d(t,"CanvasTexture",(function(){return ac})),i.d(t,"CatmullRomCurve3",(function(){return tu})),i.d(t,"CineonToneMapping",(function(){return te})),i.d(t,"CircleBufferGeometry",(function(){return cc})),i.d(t,"CircleGeometry",(function(){return cc})),i.d(t,"ClampToEdgeWrapping",(function(){return de})),i.d(t,"Clock",(function(){return rd})),i.d(t,"Color",(function(){return Or})),i.d(t,"ColorKeyframeTrack",(function(){return Ph})),i.d(t,"CompressedTexture",(function(){return oc})),i.d(t,"CompressedTextureLoader",(function(){return Gh})),i.d(t,"ConeBufferGeometry",(function(){return uc})),i.d(t,"ConeGeometry",(function(){return uc})),i.d(t,"CubeCamera",(function(){return Rs})),i.d(t,"CubeReflectionMapping",(function(){return se})),i.d(t,"CubeRefractionMapping",(function(){return oe})),i.d(t,"CubeTexture",(function(){return Ds})),i.d(t,"CubeTextureLoader",(function(){return Hh})),i.d(t,"CubeUVReflectionMapping",(function(){return ce})),i.d(t,"CubeUVRefractionMapping",(function(){return he})),i.d(t,"CubicBezierCurve",(function(){return su})),i.d(t,"CubicBezierCurve3",(function(){return ou})),i.d(t,"CubicInterpolant",(function(){return bh})),i.d(t,"CullFaceBack",(function(){return a})),i.d(t,"CullFaceFront",(function(){return l})),i.d(t,"CullFaceFrontBack",(function(){return c})),i.d(t,"CullFaceNone",(function(){return o})),i.d(t,"Curve",(function(){return Xh})),i.d(t,"CurvePath",(function(){return mu})),i.d(t,"CustomBlending",(function(){return T})),i.d(t,"CustomToneMapping",(function(){return ne})),i.d(t,"CylinderBufferGeometry",(function(){return hc})),i.d(t,"CylinderGeometry",(function(){return hc})),i.d(t,"Cylindrical",(function(){return Nd})),i.d(t,"DataTexture",(function(){return Dl})),i.d(t,"DataTexture2DArray",(function(){return no})),i.d(t,"DataTexture3D",(function(){return ro})),i.d(t,"DataTextureLoader",(function(){return Wh})),i.d(t,"DataUtils",(function(){return Mm})),i.d(t,"DecrementStencilOp",(function(){return di})),i.d(t,"DecrementWrapStencilOp",(function(){return pi})),i.d(t,"DefaultLoadingManager",(function(){return Uh})),i.d(t,"DepthFormat",(function(){return Ge})),i.d(t,"DepthStencilFormat",(function(){return je})),i.d(t,"DepthTexture",(function(){return lc})),i.d(t,"DirectionalLight",(function(){return Ru})),i.d(t,"DirectionalLightHelper",(function(){return am})),i.d(t,"DiscreteInterpolant",(function(){return Th})),i.d(t,"DodecahedronBufferGeometry",(function(){return mc})),i.d(t,"DodecahedronGeometry",(function(){return mc})),i.d(t,"DoubleSide",(function(){return g})),i.d(t,"DstAlphaFactor",(function(){return V})),i.d(t,"DstColorFactor",(function(){return N})),i.d(t,"DynamicBufferAttribute",(function(){return cp})),i.d(t,"DynamicCopyUsage",(function(){return Ri})),i.d(t,"DynamicDrawUsage",(function(){return Si})),i.d(t,"DynamicReadUsage",(function(){return Ai})),i.d(t,"EdgesGeometry",(function(){return yc})),i.d(t,"EdgesHelper",(function(){return wp})),i.d(t,"EllipseCurve",(function(){return Zh})),i.d(t,"EqualDepth",(function(){return W})),i.d(t,"EqualStencilFunc",(function(){return yi})),i.d(t,"EquirectangularReflectionMapping",(function(){return ae})),i.d(t,"EquirectangularRefractionMapping",(function(){return le})),i.d(t,"Euler",(function(){return Zn})),i.d(t,"EventDispatcher",(function(){return Fi})),i.d(t,"ExtrudeBufferGeometry",(function(){return Xc})),i.d(t,"ExtrudeGeometry",(function(){return Xc})),i.d(t,"FaceColors",(function(){return Jm})),i.d(t,"FileLoader",(function(){return kh})),i.d(t,"FlatShading",(function(){return v})),i.d(t,"Float16BufferAttribute",(function(){return Wr})),i.d(t,"Float32Attribute",(function(){return vp})),i.d(t,"Float32BufferAttribute",(function(){return qr})),i.d(t,"Float64Attribute",(function(){return yp})),i.d(t,"Float64BufferAttribute",(function(){return Xr})),i.d(t,"FloatType",(function(){return Le})),i.d(t,"Fog",(function(){return tl})),i.d(t,"FogExp2",(function(){return el})),i.d(t,"Font",(function(){return Xu})),i.d(t,"FontLoader",(function(){return Ku})),i.d(t,"FrontSide",(function(){return p})),i.d(t,"Frustum",(function(){return Vs})),i.d(t,"GLBufferAttribute",(function(){return Od})),i.d(t,"GLSL1",(function(){return Oi})),i.d(t,"GLSL3",(function(){return Ii})),i.d(t,"GammaEncoding",(function(){return Jt})),i.d(t,"GreaterDepth",(function(){return X})),i.d(t,"GreaterEqualDepth",(function(){return q})),i.d(t,"GreaterEqualStencilFunc",(function(){return bi})),i.d(t,"GreaterStencilFunc",(function(){return xi})),i.d(t,"GridHelper",(function(){return im})),i.d(t,"Group",(function(){return Xa})),i.d(t,"HalfFloatType",(function(){return Re})),i.d(t,"HemisphereLight",(function(){return vu})),i.d(t,"HemisphereLightHelper",(function(){return tm})),i.d(t,"HemisphereLightProbe",(function(){return Qu})),i.d(t,"IcosahedronBufferGeometry",(function(){return Kc})),i.d(t,"IcosahedronGeometry",(function(){return Kc})),i.d(t,"ImageBitmapLoader",(function(){return Wu})),i.d(t,"ImageLoader",(function(){return jh})),i.d(t,"ImageUtils",(function(){return $i})),i.d(t,"ImmediateRenderObject",(function(){return Hd})),i.d(t,"IncrementStencilOp",(function(){return ui})),i.d(t,"IncrementWrapStencilOp",(function(){return mi})),i.d(t,"InstancedBufferAttribute",(function(){return Bu})),i.d(t,"InstancedBufferGeometry",(function(){return Nu})),i.d(t,"InstancedInterleavedBuffer",(function(){return Dd})),i.d(t,"InstancedMesh",(function(){return kl})),i.d(t,"Int16Attribute",(function(){return mp})),i.d(t,"Int16BufferAttribute",(function(){return zr})),i.d(t,"Int32Attribute",(function(){return fp})),i.d(t,"Int32BufferAttribute",(function(){return jr})),i.d(t,"Int8Attribute",(function(){return hp})),i.d(t,"Int8BufferAttribute",(function(){return Nr})),i.d(t,"IntType",(function(){return Ae})),i.d(t,"InterleavedBuffer",(function(){return nl})),i.d(t,"InterleavedBufferAttribute",(function(){return sl})),i.d(t,"Interpolant",(function(){return wh})),i.d(t,"InterpolateDiscrete",(function(){return Bt})),i.d(t,"InterpolateLinear",(function(){return kt})),i.d(t,"InterpolateSmooth",(function(){return zt})),i.d(t,"InvertStencilOp",(function(){return fi})),i.d(t,"JSONLoader",(function(){return Pp})),i.d(t,"KeepStencilOp",(function(){return ci})),i.d(t,"KeyframeTrack",(function(){return Sh})),i.d(t,"LOD",(function(){return Tl})),i.d(t,"LatheBufferGeometry",(function(){return Yc})),i.d(t,"LatheGeometry",(function(){return Yc})),i.d(t,"Layers",(function(){return Kn})),i.d(t,"LensFlare",(function(){return Cp})),i.d(t,"LessDepth",(function(){return j})),i.d(t,"LessEqualDepth",(function(){return H})),i.d(t,"LessEqualStencilFunc",(function(){return _i})),i.d(t,"LessStencilFunc",(function(){return vi})),i.d(t,"Light",(function(){return gu})),i.d(t,"LightProbe",(function(){return Fu})),i.d(t,"Line",(function(){return Xl})),i.d(t,"Line3",(function(){return jd})),i.d(t,"LineBasicMaterial",(function(){return zl})),i.d(t,"LineCurve",(function(){return au})),i.d(t,"LineCurve3",(function(){return lu})),i.d(t,"LineDashedMaterial",(function(){return yh})),i.d(t,"LineLoop",(function(){return $l})),i.d(t,"LinePieces",(function(){return Ym})),i.d(t,"LineSegments",(function(){return Yl})),i.d(t,"LineStrip",(function(){return Km})),i.d(t,"LinearEncoding",(function(){return Yt})),i.d(t,"LinearFilter",(function(){return _e})),i.d(t,"LinearInterpolant",(function(){return Mh})),i.d(t,"LinearMipMapLinearFilter",(function(){return Me})),i.d(t,"LinearMipMapNearestFilter",(function(){return we})),i.d(t,"LinearMipmapLinearFilter",(function(){return be})),i.d(t,"LinearMipmapNearestFilter",(function(){return xe})),i.d(t,"LinearToneMapping",(function(){return Q})),i.d(t,"Loader",(function(){return Nh})),i.d(t,"LoaderUtils",(function(){return Uu})),i.d(t,"LoadingManager",(function(){return Vh})),i.d(t,"LogLuvEncoding",(function(){return ei})),i.d(t,"LoopOnce",(function(){return Vt})),i.d(t,"LoopPingPong",(function(){return Nt})),i.d(t,"LoopRepeat",(function(){return Ut})),i.d(t,"LuminanceAlphaFormat",(function(){return ke})),i.d(t,"LuminanceFormat",(function(){return Be})),i.d(t,"MOUSE",(function(){return r})),i.d(t,"Material",(function(){return Er})),i.d(t,"MaterialLoader",(function(){return Vu})),i.d(t,"Math",(function(){return Xi})),i.d(t,"MathUtils",(function(){return Xi})),i.d(t,"Matrix3",(function(){return Ki})),i.d(t,"Matrix4",(function(){return Nn})),i.d(t,"MaxEquation",(function(){return C})),i.d(t,"Mesh",(function(){return bs})),i.d(t,"MeshBasicMaterial",(function(){return Ir})),i.d(t,"MeshDepthMaterial",(function(){return ka})),i.d(t,"MeshDistanceMaterial",(function(){return za})),i.d(t,"MeshFaceMaterial",(function(){return ep})),i.d(t,"MeshLambertMaterial",(function(){return gh})),i.d(t,"MeshMatcapMaterial",(function(){return vh})),i.d(t,"MeshNormalMaterial",(function(){return fh})),i.d(t,"MeshPhongMaterial",(function(){return mh})),i.d(t,"MeshPhysicalMaterial",(function(){return dh})),i.d(t,"MeshStandardMaterial",(function(){return uh})),i.d(t,"MeshToonMaterial",(function(){return ph})),i.d(t,"MinEquation",(function(){return A})),i.d(t,"MirroredRepeatWrapping",(function(){return me})),i.d(t,"MixOperation",(function(){return Y})),i.d(t,"MultiMaterial",(function(){return tp})),i.d(t,"MultiplyBlending",(function(){return M})),i.d(t,"MultiplyOperation",(function(){return K})),i.d(t,"NearestFilter",(function(){return pe})),i.d(t,"NearestMipMapLinearFilter",(function(){return ye})),i.d(t,"NearestMipMapNearestFilter",(function(){return ge})),i.d(t,"NearestMipmapLinearFilter",(function(){return ve})),i.d(t,"NearestMipmapNearestFilter",(function(){return fe})),i.d(t,"NeverDepth",(function(){return z})),i.d(t,"NeverStencilFunc",(function(){return gi})),i.d(t,"NoBlending",(function(){return _})),i.d(t,"NoColors",(function(){return $m})),i.d(t,"NoToneMapping",(function(){return J})),i.d(t,"NormalAnimationBlendMode",(function(){return Wt})),i.d(t,"NormalBlending",(function(){return x})),i.d(t,"NotEqualDepth",(function(){return Z})),i.d(t,"NotEqualStencilFunc",(function(){return wi})),i.d(t,"NumberKeyframeTrack",(function(){return Ah})),i.d(t,"Object3D",(function(){return cr})),i.d(t,"ObjectLoader",(function(){return zu})),i.d(t,"ObjectSpaceNormalMap",(function(){return ai})),i.d(t,"OctahedronBufferGeometry",(function(){return $c})),i.d(t,"OctahedronGeometry",(function(){return $c})),i.d(t,"OneFactor",(function(){return R})),i.d(t,"OneMinusDstAlphaFactor",(function(){return U})),i.d(t,"OneMinusDstColorFactor",(function(){return B})),i.d(t,"OneMinusSrcAlphaFactor",(function(){return F})),i.d(t,"OneMinusSrcColorFactor",(function(){return O})),i.d(t,"OrthographicCamera",(function(){return Cu})),i.d(t,"PCFShadowMap",(function(){return u})),i.d(t,"PCFSoftShadowMap",(function(){return d})),i.d(t,"PMREMGenerator",(function(){return km})),i.d(t,"ParametricBufferGeometry",(function(){return Jc})),i.d(t,"ParametricGeometry",(function(){return Jc})),i.d(t,"Particle",(function(){return np})),i.d(t,"ParticleBasicMaterial",(function(){return op})),i.d(t,"ParticleSystem",(function(){return rp})),i.d(t,"ParticleSystemMaterial",(function(){return ap})),i.d(t,"Path",(function(){return pu})),i.d(t,"PerspectiveCamera",(function(){return Ls})),i.d(t,"Plane",(function(){return mr})),i.d(t,"PlaneBufferGeometry",(function(){return Bs})),i.d(t,"PlaneGeometry",(function(){return Bs})),i.d(t,"PlaneHelper",(function(){return fm})),i.d(t,"PointCloud",(function(){return ip})),i.d(t,"PointCloudMaterial",(function(){return sp})),i.d(t,"PointLight",(function(){return Au})),i.d(t,"PointLightHelper",(function(){return $d})),i.d(t,"Points",(function(){return nc})),i.d(t,"PointsMaterial",(function(){return Jl})),i.d(t,"PolarGridHelper",(function(){return nm})),i.d(t,"PolyhedronBufferGeometry",(function(){return dc})),i.d(t,"PolyhedronGeometry",(function(){return dc})),i.d(t,"PositionalAudio",(function(){return gd})),i.d(t,"PropertyBinding",(function(){return Pd})),i.d(t,"PropertyMixer",(function(){return yd})),i.d(t,"QuadraticBezierCurve",(function(){return cu})),i.d(t,"QuadraticBezierCurve3",(function(){return hu})),i.d(t,"Quaternion",(function(){return on})),i.d(t,"QuaternionKeyframeTrack",(function(){return Lh})),i.d(t,"QuaternionLinearInterpolant",(function(){return Ch})),i.d(t,"REVISION",(function(){return n})),i.d(t,"RGBADepthPacking",(function(){return si})),i.d(t,"RGBAFormat",(function(){return Ne})),i.d(t,"RGBAIntegerFormat",(function(){return Ke})),i.d(t,"RGBA_ASTC_10x10_Format",(function(){return yt})),i.d(t,"RGBA_ASTC_10x5_Format",(function(){return ft})),i.d(t,"RGBA_ASTC_10x6_Format",(function(){return gt})),i.d(t,"RGBA_ASTC_10x8_Format",(function(){return vt})),i.d(t,"RGBA_ASTC_12x10_Format",(function(){return _t})),i.d(t,"RGBA_ASTC_12x12_Format",(function(){return xt})),i.d(t,"RGBA_ASTC_4x4_Format",(function(){return at})),i.d(t,"RGBA_ASTC_5x4_Format",(function(){return lt})),i.d(t,"RGBA_ASTC_5x5_Format",(function(){return ct})),i.d(t,"RGBA_ASTC_6x5_Format",(function(){return ht})),i.d(t,"RGBA_ASTC_6x6_Format",(function(){return ut})),i.d(t,"RGBA_ASTC_8x5_Format",(function(){return dt})),i.d(t,"RGBA_ASTC_8x6_Format",(function(){return mt})),i.d(t,"RGBA_ASTC_8x8_Format",(function(){return pt})),i.d(t,"RGBA_BPTC_Format",(function(){return wt})),i.d(t,"RGBA_ETC2_EAC_Format",(function(){return ot})),i.d(t,"RGBA_PVRTC_2BPPV1_Format",(function(){return nt})),i.d(t,"RGBA_PVRTC_4BPPV1_Format",(function(){return it})),i.d(t,"RGBA_S3TC_DXT1_Format",(function(){return $e})),i.d(t,"RGBA_S3TC_DXT3_Format",(function(){return Je})),i.d(t,"RGBA_S3TC_DXT5_Format",(function(){return Qe})),i.d(t,"RGBDEncoding",(function(){return ni})),i.d(t,"RGBEEncoding",(function(){return Qt})),i.d(t,"RGBEFormat",(function(){return ze})),i.d(t,"RGBFormat",(function(){return Ue})),i.d(t,"RGBIntegerFormat",(function(){return Ze})),i.d(t,"RGBM16Encoding",(function(){return ii})),i.d(t,"RGBM7Encoding",(function(){return ti})),i.d(t,"RGB_ETC1_Format",(function(){return rt})),i.d(t,"RGB_ETC2_Format",(function(){return st})),i.d(t,"RGB_PVRTC_2BPPV1_Format",(function(){return tt})),i.d(t,"RGB_PVRTC_4BPPV1_Format",(function(){return et})),i.d(t,"RGB_S3TC_DXT1_Format",(function(){return Ye})),i.d(t,"RGFormat",(function(){return qe})),i.d(t,"RGIntegerFormat",(function(){return Xe})),i.d(t,"RawShaderMaterial",(function(){return hh})),i.d(t,"Ray",(function(){return Un})),i.d(t,"Raycaster",(function(){return Id})),i.d(t,"RectAreaLight",(function(){return Ou})),i.d(t,"RedFormat",(function(){return He})),i.d(t,"RedIntegerFormat",(function(){return We})),i.d(t,"ReinhardToneMapping",(function(){return ee})),i.d(t,"RepeatWrapping",(function(){return ue})),i.d(t,"ReplaceStencilOp",(function(){return hi})),i.d(t,"ReverseSubtractEquation",(function(){return P})),i.d(t,"RingBufferGeometry",(function(){return Qc})),i.d(t,"RingGeometry",(function(){return Qc})),i.d(t,"SRGB8_ALPHA8_ASTC_10x10_Format",(function(){return Ot})),i.d(t,"SRGB8_ALPHA8_ASTC_10x5_Format",(function(){return Lt})),i.d(t,"SRGB8_ALPHA8_ASTC_10x6_Format",(function(){return Rt})),i.d(t,"SRGB8_ALPHA8_ASTC_10x8_Format",(function(){return Dt})),i.d(t,"SRGB8_ALPHA8_ASTC_12x10_Format",(function(){return It})),i.d(t,"SRGB8_ALPHA8_ASTC_12x12_Format",(function(){return Ft})),i.d(t,"SRGB8_ALPHA8_ASTC_4x4_Format",(function(){return bt})),i.d(t,"SRGB8_ALPHA8_ASTC_5x4_Format",(function(){return Mt})),i.d(t,"SRGB8_ALPHA8_ASTC_5x5_Format",(function(){return Tt})),i.d(t,"SRGB8_ALPHA8_ASTC_6x5_Format",(function(){return St})),i.d(t,"SRGB8_ALPHA8_ASTC_6x6_Format",(function(){return Et})),i.d(t,"SRGB8_ALPHA8_ASTC_8x5_Format",(function(){return Pt})),i.d(t,"SRGB8_ALPHA8_ASTC_8x6_Format",(function(){return At})),i.d(t,"SRGB8_ALPHA8_ASTC_8x8_Format",(function(){return Ct})),i.d(t,"Scene",(function(){return il})),i.d(t,"SceneUtils",(function(){return Ap})),i.d(t,"ShaderChunk",(function(){return ks})),i.d(t,"ShaderLib",(function(){return Gs})),i.d(t,"ShaderMaterial",(function(){return As})),i.d(t,"ShadowMaterial",(function(){return ch})),i.d(t,"Shape",(function(){return fu})),i.d(t,"ShapeBufferGeometry",(function(){return eh})),i.d(t,"ShapeGeometry",(function(){return eh})),i.d(t,"ShapePath",(function(){return qu})),i.d(t,"ShapeUtils",(function(){return Hc})),i.d(t,"ShortType",(function(){return Ee})),i.d(t,"Skeleton",(function(){return Fl})),i.d(t,"SkeletonHelper",(function(){return Yd})),i.d(t,"SkinnedMesh",(function(){return Ll})),i.d(t,"SmoothShading",(function(){return y})),i.d(t,"Sphere",(function(){return Cn})),i.d(t,"SphereBufferGeometry",(function(){return th})),i.d(t,"SphereGeometry",(function(){return th})),i.d(t,"Spherical",(function(){return Ud})),i.d(t,"SphericalHarmonics3",(function(){return Iu})),i.d(t,"SplineCurve",(function(){return uu})),i.d(t,"SpotLight",(function(){return Mu})),i.d(t,"SpotLightHelper",(function(){return qd})),i.d(t,"Sprite",(function(){return xl})),i.d(t,"SpriteMaterial",(function(){return ol})),i.d(t,"SrcAlphaFactor",(function(){return I})),i.d(t,"SrcAlphaSaturateFactor",(function(){return k})),i.d(t,"SrcColorFactor",(function(){return D})),i.d(t,"StaticCopyUsage",(function(){return Li})),i.d(t,"StaticDrawUsage",(function(){return Ti})),i.d(t,"StaticReadUsage",(function(){return Pi})),i.d(t,"StereoCamera",(function(){return nd})),i.d(t,"StreamCopyUsage",(function(){return Di})),i.d(t,"StreamDrawUsage",(function(){return Ei})),i.d(t,"StreamReadUsage",(function(){return Ci})),i.d(t,"StringKeyframeTrack",(function(){return Rh})),i.d(t,"SubtractEquation",(function(){return E})),i.d(t,"SubtractiveBlending",(function(){return b})),i.d(t,"TOUCH",(function(){return s})),i.d(t,"TangentSpaceNormalMap",(function(){return oi})),i.d(t,"TetrahedronBufferGeometry",(function(){return ih})),i.d(t,"TetrahedronGeometry",(function(){return ih})),i.d(t,"TextBufferGeometry",(function(){return nh})),i.d(t,"TextGeometry",(function(){return nh})),i.d(t,"Texture",(function(){return Qi})),i.d(t,"TextureLoader",(function(){return qh})),i.d(t,"TorusBufferGeometry",(function(){return rh})),i.d(t,"TorusGeometry",(function(){return rh})),i.d(t,"TorusKnotBufferGeometry",(function(){return sh})),i.d(t,"TorusKnotGeometry",(function(){return sh})),i.d(t,"Triangle",(function(){return Tr})),i.d(t,"TriangleFanDrawMode",(function(){return Kt})),i.d(t,"TriangleStripDrawMode",(function(){return Zt})),i.d(t,"TrianglesDrawMode",(function(){return Xt})),i.d(t,"TubeBufferGeometry",(function(){return oh})),i.d(t,"TubeGeometry",(function(){return oh})),i.d(t,"UVMapping",(function(){return re})),i.d(t,"Uint16Attribute",(function(){return pp})),i.d(t,"Uint16BufferAttribute",(function(){return Gr})),i.d(t,"Uint32Attribute",(function(){return gp})),i.d(t,"Uint32BufferAttribute",(function(){return Hr})),i.d(t,"Uint8Attribute",(function(){return up})),i.d(t,"Uint8BufferAttribute",(function(){return Br})),i.d(t,"Uint8ClampedAttribute",(function(){return dp})),i.d(t,"Uint8ClampedBufferAttribute",(function(){return kr})),i.d(t,"Uniform",(function(){return Rd})),i.d(t,"UniformsLib",(function(){return zs})),i.d(t,"UniformsUtils",(function(){return Ps})),i.d(t,"UnsignedByteType",(function(){return Te})),i.d(t,"UnsignedInt248Type",(function(){return Fe})),i.d(t,"UnsignedIntType",(function(){return Ce})),i.d(t,"UnsignedShort4444Type",(function(){return De})),i.d(t,"UnsignedShort5551Type",(function(){return Oe})),i.d(t,"UnsignedShort565Type",(function(){return Ie})),i.d(t,"UnsignedShortType",(function(){return Pe})),i.d(t,"VSMShadowMap",(function(){return m})),i.d(t,"Vector2",(function(){return Zi})),i.d(t,"Vector3",(function(){return an})),i.d(t,"Vector4",(function(){return tn})),i.d(t,"VectorKeyframeTrack",(function(){return Dh})),i.d(t,"Vertex",(function(){return lp})),i.d(t,"VertexColors",(function(){return Qm})),i.d(t,"VideoTexture",(function(){return sc})),i.d(t,"WebGL1Renderer",(function(){return Qa})),i.d(t,"WebGLCubeRenderTarget",(function(){return Os})),i.d(t,"WebGLMultipleRenderTargets",(function(){return rn})),i.d(t,"WebGLMultisampleRenderTarget",(function(){return sn})),i.d(t,"WebGLRenderTarget",(function(){return nn})),i.d(t,"WebGLRenderTargetCube",(function(){return Sp})),i.d(t,"WebGLRenderer",(function(){return Ja})),i.d(t,"WebGLUtils",(function(){return Wa})),i.d(t,"WireframeGeometry",(function(){return ah})),i.d(t,"WireframeHelper",(function(){return bp})),i.d(t,"WrapAroundEnding",(function(){return Ht})),i.d(t,"XHRLoader",(function(){return Mp})),i.d(t,"ZeroCurvatureEnding",(function(){return Gt})),i.d(t,"ZeroFactor",(function(){return L})),i.d(t,"ZeroSlopeEnding",(function(){return jt})),i.d(t,"ZeroStencilOp",(function(){return li})),i.d(t,"sRGBEncoding",(function(){return $t}));
/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const n="129",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,h=0,u=1,d=2,m=3,p=0,f=1,g=2,v=1,y=2,_=0,x=1,w=2,b=3,M=4,T=5,S=100,E=101,P=102,A=103,C=104,L=200,R=201,D=202,O=203,I=204,F=205,V=206,U=207,N=208,B=209,k=210,z=0,G=1,j=2,H=3,W=4,q=5,X=6,Z=7,K=0,Y=1,$=2,J=0,Q=1,ee=2,te=3,ie=4,ne=5,re=300,se=301,oe=302,ae=303,le=304,ce=306,he=307,ue=1e3,de=1001,me=1002,pe=1003,fe=1004,ge=1004,ve=1005,ye=1005,_e=1006,xe=1007,we=1007,be=1008,Me=1008,Te=1009,Se=1010,Ee=1011,Pe=1012,Ae=1013,Ce=1014,Le=1015,Re=1016,De=1017,Oe=1018,Ie=1019,Fe=1020,Ve=1021,Ue=1022,Ne=1023,Be=1024,ke=1025,ze=Ne,Ge=1026,je=1027,He=1028,We=1029,qe=1030,Xe=1031,Ze=1032,Ke=1033,Ye=33776,$e=33777,Je=33778,Qe=33779,et=35840,tt=35841,it=35842,nt=35843,rt=36196,st=37492,ot=37496,at=37808,lt=37809,ct=37810,ht=37811,ut=37812,dt=37813,mt=37814,pt=37815,ft=37816,gt=37817,vt=37818,yt=37819,_t=37820,xt=37821,wt=36492,bt=37840,Mt=37841,Tt=37842,St=37843,Et=37844,Pt=37845,At=37846,Ct=37847,Lt=37848,Rt=37849,Dt=37850,Ot=37851,It=37852,Ft=37853,Vt=2200,Ut=2201,Nt=2202,Bt=2300,kt=2301,zt=2302,Gt=2400,jt=2401,Ht=2402,Wt=2500,qt=2501,Xt=0,Zt=1,Kt=2,Yt=3e3,$t=3001,Jt=3007,Qt=3002,ei=3003,ti=3004,ii=3005,ni=3006,ri=3200,si=3201,oi=0,ai=1,li=0,ci=7680,hi=7681,ui=7682,di=7683,mi=34055,pi=34056,fi=5386,gi=512,vi=513,yi=514,_i=515,xi=516,wi=517,bi=518,Mi=519,Ti=35044,Si=35048,Ei=35040,Pi=35045,Ai=35049,Ci=35041,Li=35046,Ri=35050,Di=35042,Oi="100",Ii="300 es";class Fi{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}}const Vi=[];for(let e=0;e<256;e++)Vi[e]=(e<16?"0":"")+e.toString(16);let Ui=1234567;const Ni=Math.PI/180,Bi=180/Math.PI;function ki(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Vi[255&e]+Vi[e>>8&255]+Vi[e>>16&255]+Vi[e>>24&255]+"-"+Vi[255&t]+Vi[t>>8&255]+"-"+Vi[t>>16&15|64]+Vi[t>>24&255]+"-"+Vi[63&i|128]+Vi[i>>8&255]+"-"+Vi[i>>16&255]+Vi[i>>24&255]+Vi[255&n]+Vi[n>>8&255]+Vi[n>>16&255]+Vi[n>>24&255]).toUpperCase()}function zi(e,t,i){return Math.max(t,Math.min(i,e))}function Gi(e,t){return(e%t+t)%t}function ji(e,t,i){return(1-i)*e+i*t}function Hi(e){return 0==(e&e-1)&&0!==e}function Wi(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function qi(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Xi=Object.freeze({__proto__:null,DEG2RAD:Ni,RAD2DEG:Bi,generateUUID:ki,clamp:zi,euclideanModulo:Gi,mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:ji,damp:function(e,t,i,n){return ji(e,t,1-Math.exp(-i*n))},pingpong:function(e,t=1){return t-Math.abs(Gi(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Ui=e%2147483647),Ui=16807*Ui%2147483647,(Ui-1)/2147483646},degToRad:function(e){return e*Ni},radToDeg:function(e){return e*Bi},isPowerOfTwo:Hi,ceilPowerOfTwo:Wi,floorPowerOfTwo:qi,setQuaternionFromProperEuler:function(e,t,i,n,r){const s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),c=s((t+n)/2),h=o((t+n)/2),u=s((t-n)/2),d=o((t-n)/2),m=s((n-t)/2),p=o((n-t)/2);switch(r){case"XYX":e.set(a*h,l*u,l*d,a*c);break;case"YZY":e.set(l*d,a*h,l*u,a*c);break;case"ZXZ":e.set(l*u,l*d,a*h,a*c);break;case"XZX":e.set(a*h,l*p,l*m,a*c);break;case"YXY":e.set(l*m,a*h,l*p,a*c);break;case"ZYZ":e.set(l*p,l*m,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class Zi{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*n+e.x,this.y=r*n+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Zi.prototype.isVector2=!0;class Ki{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,r,s,o,a,l){const c=this.elements;return c[0]=e,c[1]=n,c[2]=o,c[3]=t,c[4]=r,c[5]=a,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],m=i[8],p=n[0],f=n[3],g=n[6],v=n[1],y=n[4],_=n[7],x=n[2],w=n[5],b=n[8];return r[0]=s*p+o*v+a*x,r[3]=s*f+o*y+a*w,r[6]=s*g+o*_+a*b,r[1]=l*p+c*v+h*x,r[4]=l*f+c*y+h*w,r[7]=l*g+c*_+h*b,r[2]=u*p+d*v+m*x,r[5]=u*f+d*y+m*w,r[8]=u*g+d*_+m*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-i*r*c+i*o*a+n*r*l-n*s*a}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=c*s-o*l,u=o*a-c*r,d=l*r-s*a,m=t*h+i*u+n*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return e[0]=h*p,e[1]=(n*l-c*i)*p,e[2]=(o*i-n*s)*p,e[3]=u*p,e[4]=(c*t-n*a)*p,e[5]=(n*r-o*t)*p,e[6]=d*p,e[7]=(i*a-l*t)*p,e[8]=(s*t-i*r)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*s+l*o)+s+e,-n*l,n*a,-n*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.elements,r=n[0],s=n[3],o=n[6],a=n[1],l=n[4],c=n[7];return n[0]=t*r+i*a,n[3]=t*s+i*l,n[6]=t*o+i*c,n[1]=-i*r+t*a,n[4]=-i*s+t*l,n[7]=-i*o+t*c,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let Yi;Ki.prototype.isMatrix3=!0;class $i{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Yi&&(Yi=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Yi.width=e.width,Yi.height=e.height;const i=Yi.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Yi}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let Ji=0;class Qi extends Fi{constructor(e=Qi.DEFAULT_IMAGE,t=Qi.DEFAULT_MAPPING,i=de,n=de,r=_e,s=be,o=Ne,a=Te,l=1,c=Yt){super(),Object.defineProperty(this,"id",{value:Ji++}),this.uuid=ki(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Zi(0,0),this.repeat=new Zi(1,1),this.center=new Zi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ki,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=ki()),!t&&void 0===e.images[n.uuid]){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(en(n[e].image)):t.push(en(n[e]))}else t=en(n);e.images[n.uuid]={uuid:n.uuid,url:t}}i.image=n.uuid}return t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==re)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ue:e.x=e.x-Math.floor(e.x);break;case de:e.x=e.x<0?0:1;break;case me:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ue:e.y=e.y-Math.floor(e.y);break;case de:e.y=e.y<0?0:1;break;case me:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function en(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?$i.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Qi.DEFAULT_IMAGE=void 0,Qi.DEFAULT_MAPPING=re,Qi.prototype.isTexture=!0;class tn{constructor(e=0,t=0,i=0,n=1){this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*t+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*t+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*t+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const s=e.elements,o=s[0],a=s[4],l=s[8],c=s[1],h=s[5],u=s[9],d=s[2],m=s[6],p=s[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-m)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+m)<.1&&Math.abs(o+h+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const e=(o+1)/2,s=(h+1)/2,f=(p+1)/2,g=(a+c)/4,v=(l+d)/4,y=(u+m)/4;return e>s&&e>f?e<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(e),n=g/i,r=v/i):s>f?s<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(s),i=g/n,r=y/n):f<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(f),i=v/r,n=y/r),this.set(i,n,r,t),this}let f=Math.sqrt((m-u)*(m-u)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(f)<.001&&(f=1),this.x=(m-u)/f,this.y=(l-d)/f,this.z=(c-a)/f,this.w=Math.acos((o+h+p-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}tn.prototype.isVector4=!0;class nn extends Fi{constructor(e,t,i){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new tn(0,0,e,t),this.scissorTest=!1,this.viewport=new tn(0,0,e,t),i=i||{},this.texture=new Qi(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:_e,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){this.width===e&&this.height===t&&this.depth===i||(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}nn.prototype.isWebGLRenderTarget=!0;class rn extends nn{constructor(e,t,i){super(e,t);const n=this.texture;this.texture=[];for(let e=0;e<i;e++)this.texture[e]=n.clone()}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}rn.prototype.isWebGLMultipleRenderTargets=!0;class sn extends nn{constructor(e,t,i){super(e,t,i),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}sn.prototype.isWebGLMultisampleRenderTarget=!0;class on{constructor(e=0,t=0,i=0,n=1){this._x=e,this._y=t,this._z=i,this._w=n}static slerp(e,t,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,n)}static slerpFlat(e,t,i,n,r,s,o){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const u=r[s+0],d=r[s+1],m=r[s+2],p=r[s+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===o)return e[t+0]=u,e[t+1]=d,e[t+2]=m,void(e[t+3]=p);if(h!==p||a!==u||l!==d||c!==m){let e=1-o;const t=a*u+l*d+c*m+h*p,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,t*i);e=Math.sin(e*s)/r,o=Math.sin(o*s)/r}const r=o*i;if(a=a*e+u*r,l=l*e+d*r,c=c*e+m*r,h=h*e+p*r,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=e,l*=e,c*=e,h*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,r,s){const o=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=r[s],u=r[s+1],d=r[s+2],m=r[s+3];return e[t]=o*m+c*h+a*d-l*u,e[t+1]=a*m+c*u+l*h-o*d,e[t+2]=l*m+c*d+o*u-a*h,e[t+3]=c*m-o*h-a*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,n=e._y,r=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(n/2),h=o(r/2),u=a(i/2),d=a(n/2),m=a(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h-u*d*m;break;case"YXZ":this._x=u*c*h+l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h+u*d*m;break;case"ZXY":this._x=u*c*h-l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h-u*d*m;break;case"ZYX":this._x=u*c*h-l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h+u*d*m;break;case"YZX":this._x=u*c*h+l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h-u*d*m;break;case"XZY":this._x=u*c*h-l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],s=t[1],o=t[5],a=t[9],l=t[2],c=t[6],h=t[10],u=i+o+h;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(s-n)*e}else if(i>o&&i>h){const e=2*Math.sqrt(1+i-o-h);this._w=(c-a)/e,this._x=.25*e,this._y=(n+s)/e,this._z=(r+l)/e}else if(o>h){const e=2*Math.sqrt(1+o-i-h);this._w=(r-l)/e,this._x=(n+s)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+h-i-o);this._w=(s-n)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(zi(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,s=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+s*o+n*l-r*a,this._y=n*c+s*a+r*o-i*l,this._z=r*c+s*l+i*a-n*o,this._w=s*c-i*o-n*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,r=this._z,s=this._w;let o=s*e._w+i*e._x+n*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){this.copy(e).slerp(t,i)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}on.prototype.isQuaternion=!0;class an{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(cn.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(cn.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,s=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*n-o*i,c=a*i+o*t-r*n,h=a*n+r*i-s*t,u=-r*t-s*i-o*n;return this.x=l*a+u*-r+c*-o-h*-s,this.y=c*a+u*-s+h*-r-l*-o,this.z=h*a+u*-o+l*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,s=t.x,o=t.y,a=t.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return ln.copy(this).projectOnVector(e),this.sub(ln)}reflect(e){return this.sub(ln.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(zi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}an.prototype.isVector3=!0;const ln=new an,cn=new on;class hn{constructor(e=new an(1/0,1/0,1/0),t=new an(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],h=e[a+2];l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(t,i,n),this.max.set(r,s,o),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),h=e.getZ(a);l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(t,i,n),this.max.set(r,s,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=dn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new an),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new an),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),mn.copy(t.boundingBox),mn.applyMatrix4(e.matrixWorld),this.union(mn));const i=e.children;for(let e=0,t=i.length;e<t;e++)this.expandByObject(i[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new an),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,dn),dn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(xn),wn.subVectors(this.max,xn),pn.subVectors(e.a,xn),fn.subVectors(e.b,xn),gn.subVectors(e.c,xn),vn.subVectors(fn,pn),yn.subVectors(gn,fn),_n.subVectors(pn,gn);let t=[0,-vn.z,vn.y,0,-yn.z,yn.y,0,-_n.z,_n.y,vn.z,0,-vn.x,yn.z,0,-yn.x,_n.z,0,-_n.x,-vn.y,vn.x,0,-yn.y,yn.x,0,-_n.y,_n.x,0];return!!Tn(t,pn,fn,gn,wn)&&(t=[1,0,0,0,1,0,0,0,1],!!Tn(t,pn,fn,gn,wn)&&(bn.crossVectors(vn,yn),t=[bn.x,bn.y,bn.z],Tn(t,pn,fn,gn,wn)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new an),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return dn.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(dn).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(un[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),un[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),un[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),un[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),un[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),un[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),un[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),un[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(un)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}hn.prototype.isBox3=!0;const un=[new an,new an,new an,new an,new an,new an,new an,new an],dn=new an,mn=new hn,pn=new an,fn=new an,gn=new an,vn=new an,yn=new an,_n=new an,xn=new an,wn=new an,bn=new an,Mn=new an;function Tn(e,t,i,n,r){for(let s=0,o=e.length-3;s<=o;s+=3){Mn.fromArray(e,s);const o=r.x*Math.abs(Mn.x)+r.y*Math.abs(Mn.y)+r.z*Math.abs(Mn.z),a=t.dot(Mn),l=i.dot(Mn),c=n.dot(Mn);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const Sn=new hn,En=new an,Pn=new an,An=new an;class Cn{constructor(e=new an,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):Sn.setFromPoints(e).getCenter(i);let n=0;for(let t=0,r=e.length;t<r;t++)n=Math.max(n,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new an),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new hn),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){An.subVectors(e,this.center);const t=An.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=.5*(e-this.radius);this.center.add(An.multiplyScalar(i/e)),this.radius+=i}return this}union(e){return Pn.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(En.copy(e.center).add(Pn)),this.expandByPoint(En.copy(e.center).sub(Pn)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ln=new an,Rn=new an,Dn=new an,On=new an,In=new an,Fn=new an,Vn=new an;class Un{constructor(e=new an,t=new an(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new an),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ln)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new an),t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ln.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ln.copy(this.direction).multiplyScalar(t).add(this.origin),Ln.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){Rn.copy(e).add(t).multiplyScalar(.5),Dn.copy(t).sub(e).normalize(),On.copy(this.origin).sub(Rn);const r=.5*e.distanceTo(t),s=-this.direction.dot(Dn),o=On.dot(this.direction),a=-On.dot(Dn),l=On.lengthSq(),c=Math.abs(1-s*s);let h,u,d,m;if(c>0)if(h=s*a-o,u=s*o-a,m=r*c,h>=0)if(u>=-m)if(u<=m){const e=1/c;h*=e,u*=e,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+l}else u=r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u=-r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u<=-m?(h=Math.max(0,-(-s*r+o)),u=h>0?-r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l):u<=m?(h=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+l):(h=Math.max(0,-(s*r+o)),u=h>0?r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(Dn).multiplyScalar(u).add(Rn),d}intersectSphere(e,t){Ln.subVectors(e.center,this.origin);const i=Ln.dot(this.direction),n=Ln.dot(Ln)-i*i,r=e.radius*e.radius;if(n>r)return null;const s=Math.sqrt(r-n),o=i-s,a=i+s;return o<0&&a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,s=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,s=(e.min.y-u.y)*c),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),h>=0?(o=(e.min.z-u.z)*h,a=(e.max.z-u.z)*h):(o=(e.max.z-u.z)*h,a=(e.min.z-u.z)*h),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,Ln)}intersectTriangle(e,t,i,n,r){In.subVectors(t,e),Fn.subVectors(i,e),Vn.crossVectors(In,Fn);let s,o=this.direction.dot(Vn);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}On.subVectors(this.origin,e);const a=s*this.direction.dot(Fn.crossVectors(On,Fn));if(a<0)return null;const l=s*this.direction.dot(In.cross(On));if(l<0)return null;if(a+l>o)return null;const c=-s*On.dot(Vn);return c<0?null:this.at(c/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Nn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,r,s,o,a,l,c,h,u,d,m,p,f){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=m,g[11]=p,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Nn).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/Bn.setFromMatrixColumn(e,0).length(),r=1/Bn.setFromMatrixColumn(e,1).length(),s=1/Bn.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,n=e.y,r=e.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){const e=s*c,i=s*h,n=o*c,r=o*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-o*a,t[2]=r-e*l,t[6]=n+i*l,t[10]=s*a}else if("YXZ"===e.order){const e=a*c,i=a*h,n=l*c,r=l*h;t[0]=e+r*o,t[4]=n*o-i,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-o,t[2]=i*o-n,t[6]=r+e*o,t[10]=s*a}else if("ZXY"===e.order){const e=a*c,i=a*h,n=l*c,r=l*h;t[0]=e-r*o,t[4]=-s*h,t[8]=n+i*o,t[1]=i+n*o,t[5]=s*c,t[9]=r-e*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){const e=s*c,i=s*h,n=o*c,r=o*h;t[0]=a*c,t[4]=n*l-i,t[8]=e*l+r,t[1]=a*h,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){const e=s*a,i=s*l,n=o*a,r=o*l;t[0]=a*c,t[4]=r-e*h,t[8]=n*h+i,t[1]=h,t[5]=s*c,t[9]=-o*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-r*h}else if("XZY"===e.order){const e=s*a,i=s*l,n=o*a,r=o*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=s*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=o*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(zn,e,Gn)}lookAt(e,t,i){const n=this.elements;return Wn.subVectors(e,t),0===Wn.lengthSq()&&(Wn.z=1),Wn.normalize(),jn.crossVectors(i,Wn),0===jn.lengthSq()&&(1===Math.abs(i.z)?Wn.x+=1e-4:Wn.z+=1e-4,Wn.normalize(),jn.crossVectors(i,Wn)),jn.normalize(),Hn.crossVectors(Wn,jn),n[0]=jn.x,n[4]=Hn.x,n[8]=Wn.x,n[1]=jn.y,n[5]=Hn.y,n[9]=Wn.y,n[2]=jn.z,n[6]=Hn.z,n[10]=Wn.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],m=i[2],p=i[6],f=i[10],g=i[14],v=i[3],y=i[7],_=i[11],x=i[15],w=n[0],b=n[4],M=n[8],T=n[12],S=n[1],E=n[5],P=n[9],A=n[13],C=n[2],L=n[6],R=n[10],D=n[14],O=n[3],I=n[7],F=n[11],V=n[15];return r[0]=s*w+o*S+a*C+l*O,r[4]=s*b+o*E+a*L+l*I,r[8]=s*M+o*P+a*R+l*F,r[12]=s*T+o*A+a*D+l*V,r[1]=c*w+h*S+u*C+d*O,r[5]=c*b+h*E+u*L+d*I,r[9]=c*M+h*P+u*R+d*F,r[13]=c*T+h*A+u*D+d*V,r[2]=m*w+p*S+f*C+g*O,r[6]=m*b+p*E+f*L+g*I,r[10]=m*M+p*P+f*R+g*F,r[14]=m*T+p*A+f*D+g*V,r[3]=v*w+y*S+_*C+x*O,r[7]=v*b+y*E+_*L+x*I,r[11]=v*M+y*P+_*R+x*F,r[15]=v*T+y*A+_*D+x*V,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],o=e[5],a=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*a*h-n*l*h-r*o*u+i*l*u+n*o*d-i*a*d)+e[7]*(+t*a*d-t*l*u+r*s*u-n*s*d+n*l*c-r*a*c)+e[11]*(+t*l*h-t*o*d-r*s*h+i*s*d+r*o*c-i*l*c)+e[15]*(-n*o*c-t*a*h+t*o*u+n*s*h-i*s*u+i*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],m=e[12],p=e[13],f=e[14],g=e[15],v=h*f*l-p*u*l+p*a*d-o*f*d-h*a*g+o*u*g,y=m*u*l-c*f*l-m*a*d+s*f*d+c*a*g-s*u*g,_=c*p*l-m*h*l+m*o*d-s*p*d-c*o*g+s*h*g,x=m*h*a-c*p*a-m*o*u+s*p*u+c*o*f-s*h*f,w=t*v+i*y+n*_+r*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/w;return e[0]=v*b,e[1]=(p*u*r-h*f*r-p*n*d+i*f*d+h*n*g-i*u*g)*b,e[2]=(o*f*r-p*a*r+p*n*l-i*f*l-o*n*g+i*a*g)*b,e[3]=(h*a*r-o*u*r-h*n*l+i*u*l+o*n*d-i*a*d)*b,e[4]=y*b,e[5]=(c*f*r-m*u*r+m*n*d-t*f*d-c*n*g+t*u*g)*b,e[6]=(m*a*r-s*f*r-m*n*l+t*f*l+s*n*g-t*a*g)*b,e[7]=(s*u*r-c*a*r+c*n*l-t*u*l-s*n*d+t*a*d)*b,e[8]=_*b,e[9]=(m*h*r-c*p*r-m*i*d+t*p*d+c*i*g-t*h*g)*b,e[10]=(s*p*r-m*o*r+m*i*l-t*p*l-s*i*g+t*o*g)*b,e[11]=(c*o*r-s*h*r-c*i*l+t*h*l+s*i*d-t*o*d)*b,e[12]=x*b,e[13]=(c*p*n-m*h*n+m*i*u-t*p*u-c*i*f+t*h*f)*b,e[14]=(m*o*n-s*p*n-m*i*a+t*p*a+s*i*f-t*o*f)*b,e[15]=(s*h*n-c*o*n+c*i*a-t*h*a-s*i*u+t*o*u)*b,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,o=e.y,a=e.z,l=r*s,c=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,c*o+i,c*a-n*s,0,l*a-n*o,c*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,s){return this.set(1,i,r,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,s=t._y,o=t._z,a=t._w,l=r+r,c=s+s,h=o+o,u=r*l,d=r*c,m=r*h,p=s*c,f=s*h,g=o*h,v=a*l,y=a*c,_=a*h,x=i.x,w=i.y,b=i.z;return n[0]=(1-(p+g))*x,n[1]=(d+_)*x,n[2]=(m-y)*x,n[3]=0,n[4]=(d-_)*w,n[5]=(1-(u+g))*w,n[6]=(f+v)*w,n[7]=0,n[8]=(m+y)*b,n[9]=(f-v)*b,n[10]=(1-(u+p))*b,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=Bn.set(n[0],n[1],n[2]).length();const s=Bn.set(n[4],n[5],n[6]).length(),o=Bn.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],kn.copy(this);const a=1/r,l=1/s,c=1/o;return kn.elements[0]*=a,kn.elements[1]*=a,kn.elements[2]*=a,kn.elements[4]*=l,kn.elements[5]*=l,kn.elements[6]*=l,kn.elements[8]*=c,kn.elements[9]*=c,kn.elements[10]*=c,t.setFromRotationMatrix(kn),i.x=r,i.y=s,i.z=o,this}makePerspective(e,t,i,n,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,n,r,s){const o=this.elements,a=1/(t-e),l=1/(i-n),c=1/(s-r),h=(t+e)*a,u=(i+n)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}Nn.prototype.isMatrix4=!0;const Bn=new an,kn=new Nn,zn=new an(0,0,0),Gn=new an(1,1,1),jn=new an,Hn=new an,Wn=new an,qn=new Nn,Xn=new on;class Zn{constructor(e=0,t=0,i=0,n=Zn.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,i){const n=e.elements,r=n[0],s=n[4],o=n[8],a=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(zi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-zi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(zi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-zi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(zi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-zi(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return qn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qn,t,i)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return Xn.setFromEuler(this),this.setFromQuaternion(Xn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new an(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Zn.prototype.isEuler=!0,Zn.DefaultOrder="XYZ",Zn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Kn{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let Yn=0;const $n=new an,Jn=new on,Qn=new Nn,er=new an,tr=new an,ir=new an,nr=new on,rr=new an(1,0,0),sr=new an(0,1,0),or=new an(0,0,1),ar={type:"added"},lr={type:"removed"};class cr extends Fi{constructor(){super(),Object.defineProperty(this,"id",{value:Yn++}),this.uuid=ki(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cr.DefaultUp.clone();const e=new an,t=new Zn,i=new on,n=new an(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Nn},normalMatrix:{value:new Ki}}),this.matrix=new Nn,this.matrixWorld=new Nn,this.matrixAutoUpdate=cr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Kn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Jn.setFromAxisAngle(e,t),this.quaternion.multiply(Jn),this}rotateOnWorldAxis(e,t){return Jn.setFromAxisAngle(e,t),this.quaternion.premultiply(Jn),this}rotateX(e){return this.rotateOnAxis(rr,e)}rotateY(e){return this.rotateOnAxis(sr,e)}rotateZ(e){return this.rotateOnAxis(or,e)}translateOnAxis(e,t){return $n.copy(e).applyQuaternion(this.quaternion),this.position.add($n.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rr,e)}translateY(e){return this.translateOnAxis(sr,e)}translateZ(e){return this.translateOnAxis(or,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Qn.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?er.copy(e):er.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),tr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Qn.lookAt(tr,er,this.up):Qn.lookAt(er,tr,this.up),this.quaternion.setFromRotationMatrix(Qn),n&&(Qn.extractRotation(n.matrixWorld),Jn.setFromRotationMatrix(Qn),this.quaternion.premultiply(Jn.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ar)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(lr)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(lr)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Qn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Qn.multiply(e.parent.matrixWorld)),e.applyMatrix4(Qn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getWorldPosition(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new an),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new on),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tr,e,ir),e}getWorldScale(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new an),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tr,nr,e),e}getWorldDirection(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new an),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){const t=s(e.geometries),n=s(e.materials),r=s(e.textures),o=s(e.images),a=s(e.shapes),l=s(e.skeletons),c=s(e.animations);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=n,i;function s(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}}cr.DefaultUp=new an(0,1,0),cr.DefaultMatrixAutoUpdate=!0,cr.prototype.isObject3D=!0;const hr=new an,ur=new an,dr=new Ki;class mr{constructor(e=new an(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=hr.subVectors(i,t).cross(ur.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new an),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new an);const i=e.delta(hr),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new an),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||dr.getNormalMatrix(e),n=this.coplanarPoint(hr).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}mr.prototype.isPlane=!0;const pr=new an,fr=new an,gr=new an,vr=new an,yr=new an,_r=new an,xr=new an,wr=new an,br=new an,Mr=new an;class Tr{constructor(e=new an,t=new an,i=new an){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new an),n.subVectors(i,t),pr.subVectors(e,t),n.cross(pr);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){pr.subVectors(n,t),fr.subVectors(i,t),gr.subVectors(e,t);const s=pr.dot(pr),o=pr.dot(fr),a=pr.dot(gr),l=fr.dot(fr),c=fr.dot(gr),h=s*l-o*o;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new an),0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*a-o*c)*u,m=(s*c-o*a)*u;return r.set(1-d-m,m,d)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,vr),vr.x>=0&&vr.y>=0&&vr.x+vr.y<=1}static getUV(e,t,i,n,r,s,o,a){return this.getBarycoord(e,t,i,n,vr),a.set(0,0),a.addScaledVector(r,vr.x),a.addScaledVector(s,vr.y),a.addScaledVector(o,vr.z),a}static isFrontFacing(e,t,i,n){return pr.subVectors(i,t),fr.subVectors(e,t),pr.cross(fr).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return pr.subVectors(this.c,this.b),fr.subVectors(this.a,this.b),.5*pr.cross(fr).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new an),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Tr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new mr),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Tr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return Tr.getUV(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return Tr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Tr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new an);const i=this.a,n=this.b,r=this.c;let s,o;yr.subVectors(n,i),_r.subVectors(r,i),wr.subVectors(e,i);const a=yr.dot(wr),l=_r.dot(wr);if(a<=0&&l<=0)return t.copy(i);br.subVectors(e,n);const c=yr.dot(br),h=_r.dot(br);if(c>=0&&h<=c)return t.copy(n);const u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),t.copy(i).addScaledVector(yr,s);Mr.subVectors(e,r);const d=yr.dot(Mr),m=_r.dot(Mr);if(m>=0&&d<=m)return t.copy(r);const p=d*l-a*m;if(p<=0&&l>=0&&m<=0)return o=l/(l-m),t.copy(i).addScaledVector(_r,o);const f=c*m-d*h;if(f<=0&&h-c>=0&&d-m>=0)return xr.subVectors(r,n),o=(h-c)/(h-c+(d-m)),t.copy(n).addScaledVector(xr,o);const g=1/(f+p+u);return s=p*g,o=u*g,t.copy(i).addScaledVector(yr,s).addScaledVector(_r,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Sr=0;class Er extends Fi{constructor(){super(),Object.defineProperty(this,"id",{value:Sr++}),this.uuid=ki(),this.name="",this.type="Material",this.fog=!0,this.blending=x,this.side=p,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=I,this.blendDst=F,this.blendEquation=S,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=H,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Mi,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ci,this.stencilZFail=ci,this.stencilZPass=ci,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===v;continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==x&&(i.blending=this.blending),this.side!==p&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Er.prototype.isMaterial=!0;const Pr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ar={h:0,s:0,l:0},Cr={h:0,s:0,l:0};function Lr(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function Rr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Dr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Or{constructor(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=Gi(e,1),t=zi(t,0,1),i=zi(i,0,1),0===t)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=Lr(r,n,e+1/3),this.g=Lr(r,n,e),this.b=Lr(r,n,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(e[1])/360,n=parseInt(e[2],10)/100,r=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Pr[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Rr(e.r),this.g=Rr(e.g),this.b=Rr(e.b),this}copyLinearToSRGB(e){return this.r=Dr(e.r),this.g=Dr(e.g),this.b=Dr(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,i=this.g,n=this.b,r=Math.max(t,i,n),s=Math.min(t,i,n);let o,a;const l=(s+r)/2;if(s===r)o=0,a=0;else{const e=r-s;switch(a=l<=.5?e/(r+s):e/(2-r-s),r){case t:o=(i-n)/e+(i<n?6:0);break;case i:o=(n-t)/e+2;break;case n:o=(t-i)/e+4}o/=6}return e.h=o,e.s=a,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,i){return this.getHSL(Ar),Ar.h+=e,Ar.s+=t,Ar.l+=i,this.setHSL(Ar.h,Ar.s,Ar.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Ar),e.getHSL(Cr);const i=ji(Ar.h,Cr.h,t),n=ji(Ar.s,Cr.s,t),r=ji(Ar.l,Cr.l,t);return this.setHSL(i,n,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Or.NAMES=Pr,Or.prototype.isColor=!0,Or.prototype.r=1,Or.prototype.g=1,Or.prototype.b=1;class Ir extends Er{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Or(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=K,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this}}Ir.prototype.isMeshBasicMaterial=!0;const Fr=new an,Vr=new Zi;class Ur{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=Ti,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new Or),t[i++]=r.r,t[i++]=r.g,t[i++]=r.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new Zi),t[i++]=r.x,t[i++]=r.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new an),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new tn),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z,t[i++]=r.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)Vr.fromBufferAttribute(this,t),Vr.applyMatrix3(e),this.setXY(t,Vr.x,Vr.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)Fr.fromBufferAttribute(this,t),Fr.applyMatrix3(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Fr.x=this.getX(t),Fr.y=this.getY(t),Fr.z=this.getZ(t),Fr.applyMatrix4(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Fr.x=this.getX(t),Fr.y=this.getY(t),Fr.z=this.getZ(t),Fr.applyNormalMatrix(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Fr.x=this.getX(t),Fr.y=this.getY(t),Fr.z=this.getZ(t),Fr.transformDirection(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Ti&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}Ur.prototype.isBufferAttribute=!0;class Nr extends Ur{constructor(e,t,i){super(new Int8Array(e),t,i)}}class Br extends Ur{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class kr extends Ur{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class zr extends Ur{constructor(e,t,i){super(new Int16Array(e),t,i)}}class Gr extends Ur{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class jr extends Ur{constructor(e,t,i){super(new Int32Array(e),t,i)}}class Hr extends Ur{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Wr extends Ur{constructor(e,t,i){super(new Uint16Array(e),t,i)}}Wr.prototype.isFloat16BufferAttribute=!0;class qr extends Ur{constructor(e,t,i){super(new Float32Array(e),t,i)}}class Xr extends Ur{constructor(e,t,i){super(new Float64Array(e),t,i)}}function Zr(e){if(0===e.length)return-1/0;let t=e[0];for(let i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t}const Kr={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Yr(e,t){return new Kr[e](t)}let $r=0;const Jr=new Nn,Qr=new cr,es=new an,ts=new hn,is=new hn,ns=new an;class rs extends Fi{constructor(){super(),Object.defineProperty(this,"id",{value:$r++}),this.uuid=ki(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Zr(e)>65535?Hr:Gr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new Ki).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Jr.makeRotationFromQuaternion(e),this.applyMatrix4(Jr),this}rotateX(e){return Jr.makeRotationX(e),this.applyMatrix4(Jr),this}rotateY(e){return Jr.makeRotationY(e),this.applyMatrix4(Jr),this}rotateZ(e){return Jr.makeRotationZ(e),this.applyMatrix4(Jr),this}translate(e,t,i){return Jr.makeTranslation(e,t,i),this.applyMatrix4(Jr),this}scale(e,t,i){return Jr.makeScale(e,t,i),this.applyMatrix4(Jr),this}lookAt(e){return Qr.lookAt(e),Qr.updateMatrix(),this.applyMatrix4(Qr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(es).negate(),this.translate(es.x,es.y,es.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new qr(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new hn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new an(-1/0,-1/0,-1/0),new an(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];ts.setFromBufferAttribute(i),this.morphTargetsRelative?(ns.addVectors(this.boundingBox.min,ts.min),this.boundingBox.expandByPoint(ns),ns.addVectors(this.boundingBox.max,ts.max),this.boundingBox.expandByPoint(ns)):(this.boundingBox.expandByPoint(ts.min),this.boundingBox.expandByPoint(ts.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Cn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new an,1/0);if(e){const i=this.boundingSphere.center;if(ts.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];is.setFromBufferAttribute(i),this.morphTargetsRelative?(ns.addVectors(ts.min,is.min),ts.expandByPoint(ns),ns.addVectors(ts.max,is.max),ts.expandByPoint(ns)):(ts.expandByPoint(is.min),ts.expandByPoint(is.max))}ts.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)ns.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(ns));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],o=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)ns.fromBufferAttribute(s,t),o&&(es.fromBufferAttribute(e,t),ns.add(es)),n=Math.max(n,i.distanceToSquared(ns))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,n=t.position.array,r=t.normal.array,s=t.uv.array,o=n.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Ur(new Float32Array(4*o),4));const a=t.tangent.array,l=[],c=[];for(let e=0;e<o;e++)l[e]=new an,c[e]=new an;const h=new an,u=new an,d=new an,m=new Zi,p=new Zi,f=new Zi,g=new an,v=new an;function y(e,t,i){h.fromArray(n,3*e),u.fromArray(n,3*t),d.fromArray(n,3*i),m.fromArray(s,2*e),p.fromArray(s,2*t),f.fromArray(s,2*i),u.sub(h),d.sub(h),p.sub(m),f.sub(m);const r=1/(p.x*f.y-f.x*p.y);isFinite(r)&&(g.copy(u).multiplyScalar(f.y).addScaledVector(d,-p.y).multiplyScalar(r),v.copy(d).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[i].add(g),c[e].add(v),c[t].add(v),c[i].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:i.length}]);for(let e=0,t=_.length;e<t;++e){const t=_[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)y(i[e+0],i[e+1],i[e+2])}const x=new an,w=new an,b=new an,M=new an;function T(e){b.fromArray(r,3*e),M.copy(b);const t=l[e];x.copy(t),x.sub(b.multiplyScalar(b.dot(t))).normalize(),w.crossVectors(M,t);const i=w.dot(c[e])<0?-1:1;a[4*e]=x.x,a[4*e+1]=x.y,a[4*e+2]=x.z,a[4*e+3]=i}for(let e=0,t=_.length;e<t;++e){const t=_[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)T(i[e+0]),T(i[e+1]),T(i[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new Ur(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const n=new an,r=new an,s=new an,o=new an,a=new an,l=new an,c=new an,h=new an;if(e)for(let u=0,d=e.count;u<d;u+=3){const d=e.getX(u+0),m=e.getX(u+1),p=e.getX(u+2);n.fromBufferAttribute(t,d),r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,p),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,p),o.add(c),a.add(c),l.add(c),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)n.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===e.attributes[n])continue;const r=i[n].array,s=e.attributes[n],o=s.array,a=s.itemSize*t,l=Math.min(o.length,r.length-a);for(let e=0,t=a;e<l;e++,t++)r[t]=o[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ns.fromBufferAttribute(e,t),ns.normalize(),e.setXYZ(t,ns.x,ns.y,ns.z)}toNonIndexed(){function e(e,t){const i=e.array,n=e.itemSize,r=e.normalized,s=new i.constructor(t.length*n);let o=0,a=0;for(let e=0,r=t.length;e<r;e++){o=t[e]*n;for(let e=0;e<n;e++)s[a++]=i[o++]}return new Ur(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new rs,i=this.index.array,n=this.attributes;for(const r in n){const s=e(n[r],i);t.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],o=r[n];for(let t=0,n=o.length;t<n;t++){const n=e(o[t],i);s.push(n)}t.morphAttributes[n]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,i=s.length;e<i;e++){const i=s[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const t in i){const n=i[t];e.data.attributes[t]=n.toJSON(e.data)}const n={};let r=!1;for(const t in this.morphAttributes){const i=this.morphAttributes[t],s=[];for(let t=0,n=i.length;t<n;t++){const n=i[t];s.push(n.toJSON(e.data))}s.length>0&&(n[t]=s,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new rs).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const n=e.attributes;for(const e in n){const i=n[e];this.setAttribute(e,i.clone(t))}const r=e.morphAttributes;for(const e in r){const i=[],n=r[e];for(let e=0,r=n.length;e<r;e++)i.push(n[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}rs.prototype.isBufferGeometry=!0;const ss=new Nn,os=new Un,as=new Cn,ls=new an,cs=new an,hs=new an,us=new an,ds=new an,ms=new an,ps=new an,fs=new an,gs=new an,vs=new Zi,ys=new Zi,_s=new Zi,xs=new an,ws=new an;class bs extends cr{constructor(e=new rs,t=new Ir){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),as.copy(i.boundingSphere),as.applyMatrix4(r),!1===e.ray.intersectsSphere(as))return;if(ss.copy(r).invert(),os.copy(e.ray).applyMatrix4(ss),null!==i.boundingBox&&!1===os.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,m=u.length;i<m;i++){const m=u[i],p=n[m.materialIndex];for(let i=Math.max(m.start,d.start),n=Math.min(m.start+m.count,d.start+d.count);i<n;i+=3){const n=r.getX(i),u=r.getX(i+1),d=r.getX(i+2);s=Ms(this,p,e,os,o,a,l,c,h,n,u,d),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{for(let i=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);i<u;i+=3){const u=r.getX(i),d=r.getX(i+1),m=r.getX(i+2);s=Ms(this,n,e,os,o,a,l,c,h,u,d,m),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}}else if(void 0!==o)if(Array.isArray(n))for(let i=0,r=u.length;i<r;i++){const r=u[i],m=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(r.start+r.count,d.start+d.count);i<n;i+=3){s=Ms(this,m,e,os,o,a,l,c,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,t.push(s))}}else{for(let i=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);i<r;i+=3){s=Ms(this,n,e,os,o,a,l,c,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Ms(e,t,i,n,r,s,o,a,l,c,h,u){ls.fromBufferAttribute(r,c),cs.fromBufferAttribute(r,h),hs.fromBufferAttribute(r,u);const d=e.morphTargetInfluences;if(t.morphTargets&&s&&d){ps.set(0,0,0),fs.set(0,0,0),gs.set(0,0,0);for(let e=0,t=s.length;e<t;e++){const t=d[e],i=s[e];0!==t&&(us.fromBufferAttribute(i,c),ds.fromBufferAttribute(i,h),ms.fromBufferAttribute(i,u),o?(ps.addScaledVector(us,t),fs.addScaledVector(ds,t),gs.addScaledVector(ms,t)):(ps.addScaledVector(us.sub(ls),t),fs.addScaledVector(ds.sub(cs),t),gs.addScaledVector(ms.sub(hs),t)))}ls.add(ps),cs.add(fs),hs.add(gs)}e.isSkinnedMesh&&(e.boneTransform(c,ls),e.boneTransform(h,cs),e.boneTransform(u,hs));const m=function(e,t,i,n,r,s,o,a){let l;if(l=t.side===f?n.intersectTriangle(o,s,r,!0,a):n.intersectTriangle(r,s,o,t.side!==g,a),null===l)return null;ws.copy(a),ws.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(ws);return c<i.near||c>i.far?null:{distance:c,point:ws.clone(),object:e}}(e,t,i,n,ls,cs,hs,xs);if(m){a&&(vs.fromBufferAttribute(a,c),ys.fromBufferAttribute(a,h),_s.fromBufferAttribute(a,u),m.uv=Tr.getUV(xs,ls,cs,hs,vs,ys,_s,new Zi)),l&&(vs.fromBufferAttribute(l,c),ys.fromBufferAttribute(l,h),_s.fromBufferAttribute(l,u),m.uv2=Tr.getUV(xs,ls,cs,hs,vs,ys,_s,new Zi));const e={a:c,b:h,c:u,normal:new an,materialIndex:0};Tr.getNormal(ls,cs,hs,e.normal),m.face=e}return m}bs.prototype.isMesh=!0;class Ts extends rs{constructor(e=1,t=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const o=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],h=[];let u=0,d=0;function m(e,t,i,n,r,s,m,p,f,g,v){const y=s/f,_=m/g,x=s/2,w=m/2,b=p/2,M=f+1,T=g+1;let S=0,E=0;const P=new an;for(let s=0;s<T;s++){const o=s*_-w;for(let a=0;a<M;a++){const u=a*y-x;P[e]=u*n,P[t]=o*r,P[i]=b,l.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[i]=p>0?1:-1,c.push(P.x,P.y,P.z),h.push(a/f),h.push(1-s/g),S+=1}}for(let e=0;e<g;e++)for(let t=0;t<f;t++){const i=u+t+M*e,n=u+t+M*(e+1),r=u+(t+1)+M*(e+1),s=u+(t+1)+M*e;a.push(i,n,s),a.push(n,r,s),E+=6}o.addGroup(d,E,v),d+=E,u+=S}m("z","y","x",-1,-1,i,t,e,s,r,0),m("z","y","x",1,-1,i,t,-e,s,r,1),m("x","z","y",1,1,e,i,t,n,s,2),m("x","z","y",1,-1,e,i,-t,n,s,3),m("x","y","z",1,-1,e,t,i,n,r,4),m("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new qr(l,3)),this.setAttribute("normal",new qr(c,3)),this.setAttribute("uv",new qr(h,2))}}function Ss(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function Es(e){const t={};for(let i=0;i<e.length;i++){const n=Ss(e[i]);for(const e in n)t[e]=n[e]}return t}const Ps={clone:Ss,merge:Es};class As extends Er{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ss(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}As.prototype.isShaderMaterial=!0;class Cs extends cr{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Nn,this.projectionMatrix=new Nn,this.projectionMatrixInverse=new Nn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new an),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Cs.prototype.isCamera=!0;class Ls extends Cs{constructor(e=50,t=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Bi*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Ni*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Bi*Math.atan(Math.tan(.5*Ni*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Ni*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,o=s.fullHeight;r+=s.offsetX*n/e,t-=s.offsetY*i/o,n*=s.width/e,i*=s.height/o}const o=this.filmOffset;0!==o&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Ls.prototype.isPerspectiveCamera=!0;class Rs extends cr{constructor(e,t,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new Ls(90,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new an(1,0,0)),this.add(n);const r=new Ls(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new an(-1,0,0)),this.add(r);const s=new Ls(90,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new an(0,1,0)),this.add(s);const o=new Ls(90,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new an(0,-1,0)),this.add(o);const a=new Ls(90,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new an(0,0,1)),this.add(a);const l=new Ls(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new an(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,o,a,l]=this.children,c=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=u,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(h),e.xr.enabled=c}}class Ds extends Qi{constructor(e,t,i,n,r,s,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:se,i,n,r,s,o=void 0!==o?o:Ue,a,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Ds.prototype.isCubeTexture=!0;class Os extends nn{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),super(e,e,t),t=t||{},this.texture=new Ds(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:_e,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Ne,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Ts(5,5,5),r=new As({name:"CubemapFromEquirect",uniforms:Ss(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:f,blending:_});r.uniforms.tEquirect.value=t;const s=new bs(n,r),o=t.minFilter;t.minFilter===be&&(t.minFilter=_e);return new Rs(1,10,this).update(e,s),t.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,n){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,i,n);e.setRenderTarget(r)}}Os.prototype.isWebGLCubeRenderTarget=!0;const Is=new Cn,Fs=new an;class Vs{constructor(e=new mr,t=new mr,i=new mr,n=new mr,r=new mr,s=new mr){this.planes=[e,t,i,n,r,s]}set(e,t,i,n,r,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],m=i[10],p=i[11],f=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(o-n,h-a,p-u,y-f).normalize(),t[1].setComponents(o+n,h+a,p+u,y+f).normalize(),t[2].setComponents(o+r,h+l,p+d,y+g).normalize(),t[3].setComponents(o-r,h-l,p-d,y-g).normalize(),t[4].setComponents(o-s,h-c,p-m,y-v).normalize(),t[5].setComponents(o+s,h+c,p+m,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Is.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Is)}intersectsSprite(e){return Is.center.set(0,0,0),Is.radius=.7071067811865476,Is.applyMatrix4(e.matrixWorld),this.intersectsSphere(Is)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(i)<n)return!1}return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(Fs.x=n.normal.x>0?e.max.x:e.min.x,Fs.y=n.normal.y>0?e.max.y:e.min.y,Fs.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Fs)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Us(){let e=null,t=!1,i=null,n=null;function r(t,s){i(t,s),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function Ns(e,t){const i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=n.get(t);void 0===s?n.set(t,function(t,n){const r=t.array,s=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,r,s),t.onUploadCallback();let a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?t.isFloat16BufferAttribute?i?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(!function(t,n,r){const s=n.array,o=n.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,s):(i?e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,t,r),s.version=t.version)}}}class Bs extends rs{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const r=e/2,s=t/2,o=Math.floor(i),a=Math.floor(n),l=o+1,c=a+1,h=e/o,u=t/a,d=[],m=[],p=[],f=[];for(let e=0;e<c;e++){const t=e*u-s;for(let i=0;i<l;i++){const n=i*h-r;m.push(n,-t,0),p.push(0,0,1),f.push(i/o),f.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const i=t+l*e,n=t+l*(e+1),r=t+1+l*(e+1),s=t+1+l*e;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new qr(m,3)),this.setAttribute("normal",new qr(p,3)),this.setAttribute("uv",new qr(f,2))}}const ks={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), rawDiffuseColor, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), rawDiffuseColor, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSNMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition.xyz / vWorldPosition.w;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\tfloat ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );\n\tvec3 f0 = vec3( pow( ior - 1.0, 2.0 ) / pow( ior + 1.0, 2.0 ) );\n\tvec3 f90 = vec3( 1.0 );\n\tvec3 f_transmission = totalTransmission * getIBLVolumeRefraction(\n\t\tnormal, v, viewDir, roughnessFactor, diffuseColor.rgb, f0, f90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance);\n\tdiffuseColor.rgb = mix( diffuseColor.rgb, f_transmission, totalTransmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec4 vWorldPosition;\n\tvec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {\n\t\tvec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length(vec3(modelMatrix[0].xyz));\n\t\tmodelScale.y = length(vec3(modelMatrix[1].xyz));\n\t\tmodelScale.z = length(vec3(modelMatrix[2].xyz));\n\t\treturn normalize(refractionVector) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness(float roughness, float ior) {\n\t\treturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\n\t}\n\tvec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {\n\t\tfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\n\t\treturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;\n\t}\n\tvec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {\n\t\tif (attenuationDistance == 0.0) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\n\t\t\tvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec3 getIBLVolumeRefraction(vec3 n, vec3 v, vec3 viewDir, float perceptualRoughness, vec3 baseColor, vec3 f0, vec3 f90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec3 attenuationColor, float attenuationDistance) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);\n\t\tvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);\n\t\tfloat NdotV = saturate(dot(n, viewDir));\n\t\tvec2 brdf = integrateSpecularBRDF(NdotV, perceptualRoughness);\n\t\tvec3 specularColor = f0 * brdf.x + f90 * brdf.y;\n\t\treturn (1.0 - specularColor) * attenuatedColor * baseColor;\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform vec3 attenuationColor;\n\tuniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef USE_TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t\tfloat thicknessFactor = thickness;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\tvec3 rawDiffuseColor = diffuseColor.rgb;\n\t#include <transmission_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#ifdef USE_TRANSMISSION\n\tvarying vec4 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition;\n#endif\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},zs={common:{diffuse:{value:new Or(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ki},uv2Transform:{value:new Ki},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Zi(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Or(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Or(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ki}},sprite:{diffuse:{value:new Or(16777215)},opacity:{value:1},center:{value:new Zi(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ki}}},Gs={basic:{uniforms:Es([zs.common,zs.specularmap,zs.envmap,zs.aomap,zs.lightmap,zs.fog]),vertexShader:ks.meshbasic_vert,fragmentShader:ks.meshbasic_frag},lambert:{uniforms:Es([zs.common,zs.specularmap,zs.envmap,zs.aomap,zs.lightmap,zs.emissivemap,zs.fog,zs.lights,{emissive:{value:new Or(0)}}]),vertexShader:ks.meshlambert_vert,fragmentShader:ks.meshlambert_frag},phong:{uniforms:Es([zs.common,zs.specularmap,zs.envmap,zs.aomap,zs.lightmap,zs.emissivemap,zs.bumpmap,zs.normalmap,zs.displacementmap,zs.fog,zs.lights,{emissive:{value:new Or(0)},specular:{value:new Or(1118481)},shininess:{value:30}}]),vertexShader:ks.meshphong_vert,fragmentShader:ks.meshphong_frag},standard:{uniforms:Es([zs.common,zs.envmap,zs.aomap,zs.lightmap,zs.emissivemap,zs.bumpmap,zs.normalmap,zs.displacementmap,zs.roughnessmap,zs.metalnessmap,zs.fog,zs.lights,{emissive:{value:new Or(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ks.meshphysical_vert,fragmentShader:ks.meshphysical_frag},toon:{uniforms:Es([zs.common,zs.aomap,zs.lightmap,zs.emissivemap,zs.bumpmap,zs.normalmap,zs.displacementmap,zs.gradientmap,zs.fog,zs.lights,{emissive:{value:new Or(0)}}]),vertexShader:ks.meshtoon_vert,fragmentShader:ks.meshtoon_frag},matcap:{uniforms:Es([zs.common,zs.bumpmap,zs.normalmap,zs.displacementmap,zs.fog,{matcap:{value:null}}]),vertexShader:ks.meshmatcap_vert,fragmentShader:ks.meshmatcap_frag},points:{uniforms:Es([zs.points,zs.fog]),vertexShader:ks.points_vert,fragmentShader:ks.points_frag},dashed:{uniforms:Es([zs.common,zs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ks.linedashed_vert,fragmentShader:ks.linedashed_frag},depth:{uniforms:Es([zs.common,zs.displacementmap]),vertexShader:ks.depth_vert,fragmentShader:ks.depth_frag},normal:{uniforms:Es([zs.common,zs.bumpmap,zs.normalmap,zs.displacementmap,{opacity:{value:1}}]),vertexShader:ks.normal_vert,fragmentShader:ks.normal_frag},sprite:{uniforms:Es([zs.sprite,zs.fog]),vertexShader:ks.sprite_vert,fragmentShader:ks.sprite_frag},background:{uniforms:{uvTransform:{value:new Ki},t2D:{value:null}},vertexShader:ks.background_vert,fragmentShader:ks.background_frag},cube:{uniforms:Es([zs.envmap,{opacity:{value:1}}]),vertexShader:ks.cube_vert,fragmentShader:ks.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ks.equirect_vert,fragmentShader:ks.equirect_frag},distanceRGBA:{uniforms:Es([zs.common,zs.displacementmap,{referencePosition:{value:new an},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ks.distanceRGBA_vert,fragmentShader:ks.distanceRGBA_frag},shadow:{uniforms:Es([zs.lights,zs.fog,{color:{value:new Or(0)},opacity:{value:1}}]),vertexShader:ks.shadow_vert,fragmentShader:ks.shadow_frag}};function js(e,t,i,n,r){const s=new Or(0);let o,a,l=0,c=null,h=0,u=null;function d(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),l=t,d(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,d(s,l)},render:function(i,r){let m=!1,g=!0===r.isScene?r.background:null;g&&g.isTexture&&(g=t.get(g));const v=e.xr,y=v.getSession&&v.getSession();y&&"additive"===y.environmentBlendMode&&(g=null),null===g?d(s,l):g&&g.isColor&&(d(g,1),m=!0),(e.autoClear||m)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===ce)?(void 0===a&&(a=new bs(new Ts(1,1,1),new As({name:"BackgroundCubeMaterial",uniforms:Ss(Gs.cube.uniforms),vertexShader:Gs.cube.vertexShader,fragmentShader:Gs.cube.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a)),a.material.uniforms.envMap.value=g,a.material.uniforms.flipEnvMap.value=g.isCubeTexture&&g._needsFlipEnvMap?-1:1,c===g&&h===g.version&&u===e.toneMapping||(a.material.needsUpdate=!0,c=g,h=g.version,u=e.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null)):g&&g.isTexture&&(void 0===o&&(o=new bs(new Bs(2,2),new As({name:"BackgroundMaterial",uniforms:Ss(Gs.background.uniforms),vertexShader:Gs.background.vertexShader,fragmentShader:Gs.background.fragmentShader,side:p,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),o.material.uniforms.uvTransform.value.copy(g.matrix),c===g&&h===g.version&&u===e.toneMapping||(o.material.needsUpdate=!0,c=g,h=g.version,u=e.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null))}}}function Hs(e,t,i,n){const r=e.getParameter(34921),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||null!==s,a={},l=d(null);let c=l;function h(t){return n.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function u(t){return n.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function d(e){const t=[],i=[],n=[];for(let e=0;e<r;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function m(){const e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function p(e){f(e,0)}function f(i,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(s[i]=1,0===o[i]&&(e.enableVertexAttribArray(i),o[i]=1),a[i]!==r){(n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),a[i]=r}}function g(){const t=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function v(t,i,r,s,o,a){!0!==n.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,i,r,s,o,a):e.vertexAttribIPointer(t,i,r,o,a)}function y(){_(),c!==l&&(c=l,h(c.object))}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,y,_){let x=!1;if(o){const t=function(t,i,r){const o=!0===r.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[o];void 0===h&&(h=d(n.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[o]=h);return h}(y,u,l);c!==t&&(c=t,h(c.object)),x=function(e,t){const i=c.attributes,n=e.attributes;let r=0;for(const e in n){const t=i[e],s=n[e];if(void 0===t)return!0;if(t.attribute!==s)return!0;if(t.data!==s.data)return!0;r++}return c.attributesNum!==r||c.index!==t}(y,_),x&&function(e,t){const i={},n=e.attributes;let r=0;for(const e in n){const t=n[e],s={};s.attribute=t,t.data&&(s.data=t.data),i[e]=s,r++}c.attributes=i,c.attributesNum=r,c.index=t}(y,_)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===u.id&&c.wireframe===e||(c.geometry=y.id,c.program=u.id,c.wireframe=e,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==_&&i.update(_,34963),x&&(!function(r,s,o,a){if(!1===n.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;m();const l=a.attributes,c=o.getAttributes(),h=s.defaultAttributeValues;for(const t in c){const n=c[t];if(n>=0){const s=l[t];if(void 0!==s){const t=s.normalized,r=s.itemSize,o=i.get(s);if(void 0===o)continue;const l=o.buffer,c=o.type,h=o.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,o=i.stride,u=s.offset;i&&i.isInstancedInterleavedBuffer?(f(n,i.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)):p(n),e.bindBuffer(34962,l),v(n,r,c,t,o*h,u*h)}else s.isInstancedBufferAttribute?(f(n,s.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)):p(n),e.bindBuffer(34962,l),v(n,r,c,t,0,0)}else if("instanceMatrix"===t){const t=i.get(r.instanceMatrix);if(void 0===t)continue;const s=t.buffer,o=t.type;f(n+0,1),f(n+1,1),f(n+2,1),f(n+3,1),e.bindBuffer(34962,s),e.vertexAttribPointer(n+0,4,o,!1,64,0),e.vertexAttribPointer(n+1,4,o,!1,64,16),e.vertexAttribPointer(n+2,4,o,!1,64,32),e.vertexAttribPointer(n+3,4,o,!1,64,48)}else if("instanceColor"===t){const t=i.get(r.instanceColor);if(void 0===t)continue;const s=t.buffer,o=t.type;f(n,1),e.bindBuffer(34962,s),e.vertexAttribPointer(n,3,o,!1,12,0)}else if(void 0!==h){const i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:e.vertexAttrib1fv(n,i)}}}}g()}(r,l,u,y),null!==_&&e.bindBuffer(34963,i.get(_).buffer))},reset:y,resetDefaultState:_,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const i=t[e];for(const e in i)u(i[e].object),delete i[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const i=t[e];for(const e in i)u(i[e].object),delete i[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const i=a[t];if(void 0===i[e.id])continue;const n=i[e.id];for(const e in n)u(n[e].object),delete n[e];delete i[e.id]}},initAttributes:m,enableAttribute:p,disableUnusedAttributes:g}}function Ws(e,t,i,n){const r=n.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,n){e.drawArrays(s,t,n),i.update(n,s,1)},this.renderInstances=function(n,o,a){if(0===a)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,n,o,a),i.update(o,s,a)}}function qs(e,t,i){let n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=e.getParameter(34930),u=e.getParameter(35660),d=e.getParameter(3379),m=e.getParameter(34076),p=e.getParameter(34921),f=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=u>0,_=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){const i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:m,maxAttributes:p,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:s?e.getParameter(36183):0}}function Xs(e){const t=this;let i=null,n=0,r=!1,s=!1;const o=new mr,a=new Ki,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function h(e,i,n,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=n+4*s,r=i.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=n;t!==s;++t,i+=4)o.copy(e[t]).applyMatrix4(r,a),o.normal.toArray(c,i),c[i+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,s){const o=0!==e.length||t||0!==n||r;return r=t,i=h(e,s,0),n=e.length,o},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(t,o,a){const u=t.clippingPlanes,d=t.clipIntersection,m=t.clipShadows,p=e.get(t);if(!r||null===u||0===u.length||s&&!m)s?h(null):c();else{const e=s?0:n,t=4*e;let r=p.clippingState||null;l.value=r,r=h(u,o,t,a);for(let e=0;e!==t;++e)r[e]=i[e];p.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Zs(e){let t=new WeakMap;function i(e,t){return t===ae?e.mapping=se:t===le&&(e.mapping=oe),e}function n(e){const i=e.target;i.removeEventListener("dispose",n);const r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===ae||s===le){if(t.has(r)){return i(t.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const o=e.getRenderTarget(),a=new Os(s.height/2);return a.fromEquirectangularTexture(e,r),t.set(r,a),e.setRenderTarget(o),r.addEventListener("dispose",n),i(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}function Ks(e){const t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(e){const t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Ys(e,t,i,n){const r={},s=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(t.remove(l),s.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(e){const i=[],n=e.index,r=e.attributes.position;let o=0;if(null!==n){const e=n.array;o=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],r=e[t+1],s=e[t+2];i.push(n,r,r,s,s,n)}}else{const e=r.array;o=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}const a=new(Zr(i)>65535?Hr:Gr)(i,1);a.version=o;const l=s.get(e);l&&t.remove(l),s.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,i.memory.geometries++),t},update:function(e){const i=e.attributes;for(const e in i)t.update(i[e],34962);const n=e.morphAttributes;for(const e in n){const i=n[e];for(let e=0,n=i.length;e<n;e++)t.update(i[e],34962)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return s.get(e)}}}function $s(e,t,i,n){const r=n.isWebGL2;let s,o,a;this.setMode=function(e){s=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(s,n,o,t*a),i.update(n,s,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,u;if(r)h=e,u="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,o,n*a,c),i.update(l,s,c)}}function Js(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Qs(e,t){return e[0]-t[0]}function eo(e,t){return Math.abs(t[1])-Math.abs(e[1])}function to(e){const t={},i=new Float32Array(8),n=[];for(let e=0;e<8;e++)n[e]=[e,0];return{update:function(r,s,o,a){const l=r.morphTargetInfluences,c=void 0===l?0:l.length;let h=t[s.id];if(void 0===h){h=[];for(let e=0;e<c;e++)h[e]=[e,0];t[s.id]=h}for(let e=0;e<c;e++){const t=h[e];t[0]=e,t[1]=l[e]}h.sort(eo);for(let e=0;e<8;e++)e<c&&h[e][1]?(n[e][0]=h[e][0],n[e][1]=h[e][1]):(n[e][0]=Number.MAX_SAFE_INTEGER,n[e][1]=0);n.sort(Qs);const u=o.morphTargets&&s.morphAttributes.position,d=o.morphNormals&&s.morphAttributes.normal;let m=0;for(let e=0;e<8;e++){const t=n[e],r=t[0],o=t[1];r!==Number.MAX_SAFE_INTEGER&&o?(u&&s.getAttribute("morphTarget"+e)!==u[r]&&s.setAttribute("morphTarget"+e,u[r]),d&&s.getAttribute("morphNormal"+e)!==d[r]&&s.setAttribute("morphNormal"+e,d[r]),i[e]=o,m+=o):(u&&!0===s.hasAttribute("morphTarget"+e)&&s.deleteAttribute("morphTarget"+e),d&&!0===s.hasAttribute("morphNormal"+e)&&s.deleteAttribute("morphNormal"+e),i[e]=0)}const p=s.morphTargetsRelative?1:1-m;a.getUniforms().setValue(e,"morphTargetBaseInfluence",p),a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function io(e,t,i,n){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){const o=n.render.frame,a=e.geometry,l=t.get(e,a);return r.get(l)!==o&&(t.update(l),r.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}Gs.physical={uniforms:Es([Gs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Zi(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Or(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Zi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Or(0)}}]),vertexShader:ks.meshphysical_vert,fragmentShader:ks.meshphysical_frag};class no extends Qi{constructor(e=null,t=1,i=1,n=1){super(null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=pe,this.minFilter=pe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}no.prototype.isDataTexture2DArray=!0;class ro extends Qi{constructor(e=null,t=1,i=1,n=1){super(null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=pe,this.minFilter=pe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ro.prototype.isDataTexture3D=!0;const so=new Qi,oo=new no,ao=new ro,lo=new Ds,co=[],ho=[],uo=new Float32Array(16),mo=new Float32Array(9),po=new Float32Array(4);function fo(e,t,i){const n=e[0];if(n<=0||n>0)return e;const r=t*i;let s=co[r];if(void 0===s&&(s=new Float32Array(r),co[r]=s),0!==t){n.toArray(s,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(s,r)}return s}function go(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function vo(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function yo(e,t){let i=ho[t];void 0===i&&(i=new Int32Array(t),ho[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function _o(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function xo(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(go(i,t))return;e.uniform2fv(this.addr,t),vo(i,t)}}function wo(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(go(i,t))return;e.uniform3fv(this.addr,t),vo(i,t)}}function bo(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(go(i,t))return;e.uniform4fv(this.addr,t),vo(i,t)}}function Mo(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(go(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),vo(i,t)}else{if(go(i,n))return;po.set(n),e.uniformMatrix2fv(this.addr,!1,po),vo(i,n)}}function To(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(go(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),vo(i,t)}else{if(go(i,n))return;mo.set(n),e.uniformMatrix3fv(this.addr,!1,mo),vo(i,n)}}function So(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(go(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),vo(i,t)}else{if(go(i,n))return;uo.set(n),e.uniformMatrix4fv(this.addr,!1,uo),vo(i,n)}}function Eo(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Po(e,t){const i=this.cache;go(i,t)||(e.uniform2iv(this.addr,t),vo(i,t))}function Ao(e,t){const i=this.cache;go(i,t)||(e.uniform3iv(this.addr,t),vo(i,t))}function Co(e,t){const i=this.cache;go(i,t)||(e.uniform4iv(this.addr,t),vo(i,t))}function Lo(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Ro(e,t){const i=this.cache;go(i,t)||(e.uniform2uiv(this.addr,t),vo(i,t))}function Do(e,t){const i=this.cache;go(i,t)||(e.uniform3uiv(this.addr,t),vo(i,t))}function Oo(e,t){const i=this.cache;go(i,t)||(e.uniform4uiv(this.addr,t),vo(i,t))}function Io(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(t||so,r)}function Fo(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||ao,r)}function Vo(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(t||lo,r)}function Uo(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||oo,r)}function No(e,t){e.uniform1fv(this.addr,t)}function Bo(e,t){const i=fo(t,this.size,2);e.uniform2fv(this.addr,i)}function ko(e,t){const i=fo(t,this.size,3);e.uniform3fv(this.addr,i)}function zo(e,t){const i=fo(t,this.size,4);e.uniform4fv(this.addr,i)}function Go(e,t){const i=fo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function jo(e,t){const i=fo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Ho(e,t){const i=fo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Wo(e,t){e.uniform1iv(this.addr,t)}function qo(e,t){e.uniform2iv(this.addr,t)}function Xo(e,t){e.uniform3iv(this.addr,t)}function Zo(e,t){e.uniform4iv(this.addr,t)}function Ko(e,t){e.uniform1uiv(this.addr,t)}function Yo(e,t){e.uniform2uiv(this.addr,t)}function $o(e,t){e.uniform3uiv(this.addr,t)}function Jo(e,t){e.uniform4uiv(this.addr,t)}function Qo(e,t,i){const n=t.length,r=yo(i,n);e.uniform1iv(this.addr,r);for(let e=0;e!==n;++e)i.safeSetTexture2D(t[e]||so,r[e])}function ea(e,t,i){const n=t.length,r=yo(i,n);e.uniform1iv(this.addr,r);for(let e=0;e!==n;++e)i.safeSetTextureCube(t[e]||lo,r[e])}function ta(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return _o;case 35664:return xo;case 35665:return wo;case 35666:return bo;case 35674:return Mo;case 35675:return To;case 35676:return So;case 5124:case 35670:return Eo;case 35667:case 35671:return Po;case 35668:case 35672:return Ao;case 35669:case 35673:return Co;case 5125:return Lo;case 36294:return Ro;case 36295:return Do;case 36296:return Oo;case 35678:case 36198:case 36298:case 36306:case 35682:return Io;case 35679:case 36299:case 36307:return Fo;case 35680:case 36300:case 36308:case 36293:return Vo;case 36289:case 36303:case 36311:case 36292:return Uo}}(t.type)}function ia(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return No;case 35664:return Bo;case 35665:return ko;case 35666:return zo;case 35674:return Go;case 35675:return jo;case 35676:return Ho;case 5124:case 35670:return Wo;case 35667:case 35671:return qo;case 35668:case 35672:return Xo;case 35669:case 35673:return Zo;case 5125:return Ko;case 36294:return Yo;case 36295:return $o;case 36296:return Jo;case 35678:case 36198:case 36298:case 36306:case 35682:return Qo;case 35680:case 36300:case 36308:case 36293:return ea}}(t.type)}function na(e){this.id=e,this.seq=[],this.map={}}ia.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),vo(t,e)},na.prototype.setValue=function(e,t,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(e,t[s.id],i)}};const ra=/(\w+)(\])?(\[|\.)?/g;function sa(e,t){e.seq.push(t),e.map[t.id]=t}function oa(e,t,i){const n=e.name,r=n.length;for(ra.lastIndex=0;;){const s=ra.exec(n),o=ra.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){sa(i,void 0===c?new ta(a,e,t):new ia(a,e,t));break}{let e=i.map[a];void 0===e&&(e=new na(a),sa(i,e)),i=e}}}function aa(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){const i=e.getActiveUniform(t,n);oa(i,e.getUniformLocation(t,i.name),this)}}function la(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}aa.prototype.setValue=function(e,t,i,n){const r=this.map[t];void 0!==r&&r.setValue(e,i,n)},aa.prototype.setOptional=function(e,t,i){const n=t[i];void 0!==n&&this.setValue(e,i,n)},aa.upload=function(e,t,i,n){for(let r=0,s=t.length;r!==s;++r){const s=t[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(e,o.value,n)}},aa.seqWithValue=function(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const r=e[n];r.id in t&&i.push(r)}return i};let ca=0;function ha(e){switch(e){case Yt:return["Linear","( value )"];case $t:return["sRGB","( value )"];case Qt:return["RGBE","( value )"];case ti:return["RGBM","( value, 7.0 )"];case ii:return["RGBM","( value, 16.0 )"];case ni:return["RGBD","( value, 256.0 )"];case Jt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case ei:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function ua(e,t,i){const n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(n&&""===r)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+r+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function da(e,t){const i=ha(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function ma(e,t){const i=ha(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function pa(e,t){let i;switch(t){case Q:i="Linear";break;case ee:i="Reinhard";break;case te:i="OptimizedCineon";break;case ie:i="ACESFilmic";break;case ne:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function fa(e){return""!==e}function ga(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function va(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const ya=/^[ \t]*#include +<([\w\d./]+)>/gm;function _a(e){return e.replace(ya,xa)}function xa(e,t){const i=ks[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return _a(i)}const wa=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ba=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ma(e){return e.replace(ba,Sa).replace(wa,Ta)}function Ta(e,t,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Sa(e,t,i,n)}function Sa(e,t,i,n){let r="";for(let e=parseInt(t);e<parseInt(i);e++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function Ea(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Pa(e,t,i,n){const r=e.getContext(),s=i.defines;let o=i.vertexShader,a=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===u?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===d?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===m&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case se:case oe:t="ENVMAP_TYPE_CUBE";break;case ce:case he:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),h=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case oe:case he:t="ENVMAP_MODE_REFRACTION"}return t}(i),p=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case K:t="ENVMAP_BLENDING_MULTIPLY";break;case Y:t="ENVMAP_BLENDING_MIX";break;case $:t="ENVMAP_BLENDING_ADD"}return t}(i),f=e.gammaFactor>0?e.gammaFactor:1,g=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission>0)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(fa).join("\n")}(i),v=function(e){const t=[];for(const i in e){const n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(s),y=r.createProgram();let _,x,w=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(_=[v].filter(fa).join("\n"),_.length>0&&(_+="\n"),x=[g,v].filter(fa).join("\n"),x.length>0&&(x+="\n")):(_=[Ea(i),"#define SHADER_NAME "+i.shaderName,v,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(fa).join("\n"),x=[g,Ea(i),"#define SHADER_NAME "+i.shaderName,v,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==J?"#define TONE_MAPPING":"",i.toneMapping!==J?ks.tonemapping_pars_fragment:"",i.toneMapping!==J?pa("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",ks.encodings_pars_fragment,i.map?da("mapTexelToLinear",i.mapEncoding):"",i.matcap?da("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?da("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?da("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?da("lightMapTexelToLinear",i.lightMapEncoding):"",ma("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(fa).join("\n")),o=_a(o),o=ga(o,i),o=va(o,i),a=_a(a),a=ga(a,i),a=va(a,i),o=Ma(o),a=Ma(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(w="#version 300 es\n",_=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,x=["#define varying in",i.glslVersion===Ii?"":"out highp vec4 pc_fragColor;",i.glslVersion===Ii?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const b=w+x+a,M=la(r,35633,w+_+o),T=la(r,35632,b);if(r.attachShader(y,M),r.attachShader(y,T),void 0!==i.index0AttributeName?r.bindAttribLocation(y,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(y).trim(),t=r.getShaderInfoLog(M).trim(),i=r.getShaderInfoLog(T).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(y,35714)){n=!1;const t=ua(r,M,"vertex"),i=ua(r,T,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(y,35715),"gl.getProgramInfoLog",e,t,i)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:_},fragmentShader:{log:i,prefix:x}})}let S,E;return r.deleteShader(M),r.deleteShader(T),this.getUniforms=function(){return void 0===S&&(S=new aa(r,y)),S},this.getAttributes=function(){return void 0===E&&(E=function(e,t){const i={},n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){const n=e.getActiveAttrib(t,r).name;i[n]=e.getAttribLocation(t,n)}return i}(r,y)),E},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(y),this.program=void 0},this.name=i.shaderName,this.id=ca++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=T,this}function Aa(e,t,i,n,r,s){const o=[],a=n.isWebGL2,l=n.logarithmicDepthBuffer,c=n.floatVertexTextures,h=n.maxVertexUniforms,u=n.vertexTextures;let d=n.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function v(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Yt,t}return{getParameters:function(r,o,p,y,_){const x=y.fog,w=r.isMeshStandardMaterial?y.environment:null,b=t.get(r.envMap||w),M=m[r.type],T=_.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(c)return 1024;{const e=h,i=Math.floor((e-20)/4),n=Math.min(i,t.length);return n<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+n+"."),0):n}}(_):0;let S,E;if(null!==r.precision&&(d=n.getMaxPrecision(r.precision),d!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",d,"instead.")),M){const e=Gs[M];S=e.vertexShader,E=e.fragmentShader}else S=r.vertexShader,E=r.fragmentShader;const P=e.getRenderTarget();return{isWebGL2:a,shaderID:M,shaderName:r.type,vertexShader:S,fragmentShader:E,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:d,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:u,outputEncoding:null!==P?v(P.texture):e.outputEncoding,map:!!r.map,mapEncoding:v(r.map),matcap:!!r.matcap,matcapEncoding:v(r.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:v(b),envMapCubeUV:!!b&&(b.mapping===ce||b.mapping===he),lightMap:!!r.lightMap,lightMapEncoding:v(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:v(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===ai,tangentSpaceNormalMap:r.normalMapType===oi,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmission:!!r.transmission,transmissionMap:!!r.transmissionMap,thicknessMap:!!r.thicknessMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&_.geometry&&_.geometry.attributes.color&&4===_.geometry.attributes.color.itemSize,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmission||r.transmissionMap||r.thicknessMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmission||r.transmissionMap||r.thicknessMap||!r.displacementMap),fog:!!x,useFog:r.fog,fogExp2:x&&x.isFogExp2,flatShading:!!r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===_.isSkinnedMesh&&T>0,maxBones:T,useVertexTexture:c,morphTargets:r.morphTargets,morphNormals:r.morphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:J,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===g,flipSided:r.side===f,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||i.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<p.length;e++)i.push(t[p[e]]);i.push(e.outputEncoding),i.push(e.gammaFactor)}return i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=m[e.type];let i;if(t){const e=Gs[t];i=Ps.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let n;for(let e=0,t=o.length;e<t;e++){const t=o[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new Pa(e,i,t,r),o.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){const t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}},programs:o}}function Ca(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function La(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ra(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Da(e){const t=[];let i=0;const n=[],r=[],s=[],o={id:-1};function a(n,r,s,a,l,c){let h=t[i];const u=e.get(s);return void 0===h?(h={id:n.id,object:n,geometry:r,material:s,program:u.program||o,groupOrder:a,renderOrder:n.renderOrder,z:l,group:c},t[i]=h):(h.id=n.id,h.object=n,h.geometry=r,h.material=s,h.program=u.program||o,h.groupOrder=a,h.renderOrder=n.renderOrder,h.z=l,h.group=c),i++,h}return{opaque:n,transmissive:r,transparent:s,init:function(){i=0,n.length=0,r.length=0,s.length=0},push:function(e,t,i,o,l,c){const h=a(e,t,i,o,l,c);i.transmission>0?r.push(h):!0===i.transparent?s.push(h):n.push(h)},unshift:function(e,t,i,o,l,c){const h=a(e,t,i,o,l,c);i.transmission>0?r.unshift(h):!0===i.transparent?s.unshift(h):n.unshift(h)},finish:function(){for(let e=i,n=t.length;e<n;e++){const i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){n.length>1&&n.sort(e||La),r.length>1&&r.sort(t||Ra),s.length>1&&s.sort(t||Ra)}}}function Oa(e){let t=new WeakMap;return{get:function(i,n){let r;return!1===t.has(i)?(r=new Da(e),t.set(i,[r])):n>=t.get(i).length?(r=new Da(e),t.get(i).push(r)):r=t.get(i)[n],r},dispose:function(){t=new WeakMap}}}function Ia(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new an,color:new Or};break;case"SpotLight":i={position:new an,direction:new an,color:new Or,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new an,color:new Or,distance:0,decay:0};break;case"HemisphereLight":i={direction:new an,skyColor:new Or,groundColor:new Or};break;case"RectAreaLight":i={color:new Or,position:new an,halfWidth:new an,halfHeight:new an}}return e[t.id]=i,i}}}let Fa=0;function Va(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ua(e,t){const i=new Ia,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zi};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zi,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)r.probe.push(new an);const s=new an,o=new Nn,a=new Nn;return{setup:function(s){let o=0,a=0,l=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let c=0,h=0,u=0,d=0,m=0,p=0,f=0,g=0;s.sort(Va);for(let e=0,t=s.length;e<t;e++){const t=s[e],v=t.color,y=t.intensity,_=t.distance,x=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=v.r*y,a+=v.g*y,l+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[c]=i,r.directionalShadowMap[c]=x,r.directionalShadowMatrix[c]=t.shadow.matrix,p++}r.directional[c]=e,c++}else if(t.isSpotLight){const e=i.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=_,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.spotShadow[u]=i,r.spotShadowMap[u]=x,r.spotShadowMatrix[u]=t.shadow.matrix,g++}r.spot[u]=e,u++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[d]=e,d++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[h]=i,r.pointShadowMap[h]=x,r.pointShadowMatrix[h]=t.shadow.matrix,f++}r.point[h]=e,h++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),r.hemi[m]=e,m++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=zs.LTC_FLOAT_1,r.rectAreaLTC2=zs.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=zs.LTC_HALF_1,r.rectAreaLTC2=zs.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=a,r.ambient[2]=l;const v=r.hash;v.directionalLength===c&&v.pointLength===h&&v.spotLength===u&&v.rectAreaLength===d&&v.hemiLength===m&&v.numDirectionalShadows===p&&v.numPointShadows===f&&v.numSpotShadows===g||(r.directional.length=c,r.spot.length=u,r.rectArea.length=d,r.point.length=h,r.hemi.length=m,r.directionalShadow.length=p,r.directionalShadowMap.length=p,r.pointShadow.length=f,r.pointShadowMap.length=f,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=p,r.pointShadowMatrix.length=f,r.spotShadowMatrix.length=g,v.directionalLength=c,v.pointLength=h,v.spotLength=u,v.rectAreaLength=d,v.hemiLength=m,v.numDirectionalShadows=p,v.numPointShadows=f,v.numSpotShadows=g,r.version=Fa++)},setupView:function(e,t){let i=0,n=0,l=0,c=0,h=0;const u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[i];e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),i++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=r.point[n];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const e=r.hemi[h];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),e.direction.normalize(),h++}}},state:r}}function Na(e,t){const i=new Ua(e,t),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(){i.setup(n)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function Ba(e,t){let i=new WeakMap;return{get:function(n,r=0){let s;return!1===i.has(n)?(s=new Na(e,t),i.set(n,[s])):r>=i.get(n).length?(s=new Na(e,t),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function(){i=new WeakMap}}}class ka extends Er{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=ri,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}ka.prototype.isMeshDepthMaterial=!0;class za extends Er{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new an,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}za.prototype.isMeshDistanceMaterial=!0;function Ga(e,t,i){let n=new Vs;const r=new Zi,s=new Zi,o=new tn,a=[],l=[],c={},h=i.maxTextureSize,d={0:f,1:p,2:g},v=new As({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Zi},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const x=new rs;x.setAttribute("position",new Ur(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new bs(x,v),b=this;function M(i,n){const r=t.update(w);v.uniforms.shadow_pass.value=i.map.texture,v.uniforms.resolution.value=i.mapSize,v.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,r,v,w,null),y.uniforms.shadow_pass.value=i.mapPass.texture,y.uniforms.resolution.value=i.mapSize,y.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,r,y,w,null)}function T(e){const t=e<<0;let i=a[t];return void 0===i&&(i=new ka({depthPacking:si,morphTargets:e}),a[t]=i),i}function S(e){const t=e<<0;let i=l[t];return void 0===i&&(i=new za({morphTargets:e}),l[t]=i),i}function E(t,i,n,r,s,o,a){let l=null,h=T,u=t.customDepthMaterial;if(!0===r.isPointLight&&(h=S,u=t.customDistanceMaterial),void 0===u){let e=!1;!0===n.morphTargets&&(e=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0),l=h(e)}else l=u;if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){const e=l.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=l.clone(),i[t]=r),l=r}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=a===m?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=s,l.farDistance=o),l}function P(i,r,s,o,a){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===m)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=t.update(i),r=i.material;if(Array.isArray(r)){const t=n.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=r[c.materialIndex];if(h&&h.visible){const t=E(i,n,h,o,s.near,s.far,a);e.renderBufferDirect(s,null,n,t,i,c)}}}else if(r.visible){const t=E(i,n,r,o,s.near,s.far,a);e.renderBufferDirect(s,null,n,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)P(l[e],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=u,this.render=function(t,i,a){if(!1===b.enabled)return;if(!1===b.autoUpdate&&!1===b.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(_),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const p=u.getFrameExtents();if(r.multiply(p),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/p.x),r.x=s.x*p.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/p.y),r.y=s.y*p.y,u.mapSize.y=s.y)),null===u.map&&!u.isPointLightShadow&&this.type===m){const e={minFilter:_e,magFilter:_e,format:Ne};u.map=new nn(r.x,r.y,e),u.map.texture.name=c.name+".shadowMap",u.mapPass=new nn(r.x,r.y,e),u.camera.updateProjectionMatrix()}if(null===u.map){const e={minFilter:pe,magFilter:pe,format:Ne};u.map=new nn(r.x,r.y,e),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const f=u.getViewportCount();for(let e=0;e<f;e++){const t=u.getViewport(e);o.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(o),u.updateMatrices(c,e),n=u.getFrustum(),P(i,a,u.camera,c,this.type)}u.isPointLightShadow||this.type!==m||M(u,a),u.needsUpdate=!1}b.needsUpdate=!1,e.setRenderTarget(l,c,u)}}function ja(e,t,i){const n=i.isWebGL2;const r=new function(){let t=!1;const i=new tn;let n=null;const r=new tn(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,s,o,a){!0===a&&(t*=o,n*=o,s*=o),i.set(t,n,s,o),!1===r.equals(i)&&(e.clearColor(t,n,s,o),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},s=new function(){let t=!1,i=null,n=null,r=null;return{setTest:function(e){e?ye(2929):_e(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case z:e.depthFunc(512);break;case G:e.depthFunc(519);break;case j:e.depthFunc(513);break;case H:e.depthFunc(515);break;case W:e.depthFunc(514);break;case q:e.depthFunc(518);break;case X:e.depthFunc(516);break;case Z:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,i=null,n=null,r=null}}},c=new function(){let t=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?ye(2960):_e(2960))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,o){n===t&&r===i&&s===o||(e.stencilFunc(t,i,o),n=t,r=i,s=o)},setOp:function(t,i,n){o===t&&a===i&&l===n||(e.stencilOp(t,i,n),o=t,a=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null}}};let h={},u=null,d={},m=null,p=!1,v=null,y=null,K=null,Y=null,$=null,J=null,Q=null,ee=!1,te=null,ie=null,ne=null,re=null,se=null;const oe=e.getParameter(35661);let ae=!1,le=0;const ce=e.getParameter(7938);-1!==ce.indexOf("WebGL")?(le=parseFloat(/^WebGL (\d)/.exec(ce)[1]),ae=le>=1):-1!==ce.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL ES (\d)/.exec(ce)[1]),ae=le>=2);let he=null,ue={};const de=e.getParameter(3088),me=e.getParameter(2978),pe=(new tn).fromArray(de),fe=(new tn).fromArray(me);function ge(t,i,n){const r=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<n;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,r);return s}const ve={};function ye(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function _e(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}ve[3553]=ge(3553,3553,1),ve[34067]=ge(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),c.setClear(0),ye(2929),s.setFunc(H),Me(!1),Te(a),ye(2884),be(_);const xe={[S]:32774,[E]:32778,[P]:32779};if(n)xe[A]=32775,xe[C]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(xe[A]=e.MIN_EXT,xe[C]=e.MAX_EXT)}const we={[L]:0,[R]:1,[D]:768,[I]:770,[k]:776,[N]:774,[V]:772,[O]:769,[F]:771,[B]:775,[U]:773};function be(t,i,n,r,s,o,a,l){if(t!==_){if(!1===p&&(ye(3042),p=!0),t===T)s=s||i,o=o||n,a=a||r,i===y&&s===$||(e.blendEquationSeparate(xe[i],xe[s]),y=i,$=s),n===K&&r===Y&&o===J&&a===Q||(e.blendFuncSeparate(we[n],we[r],we[o],we[a]),K=n,Y=r,J=o,Q=a),v=t,ee=null;else if(t!==v||l!==ee){if(y===S&&$===S||(e.blendEquation(32774),y=S,$=S),l)switch(t){case x:e.blendFuncSeparate(1,771,1,771);break;case w:e.blendFunc(1,1);break;case b:e.blendFuncSeparate(0,0,769,771);break;case M:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case x:e.blendFuncSeparate(770,771,1,771);break;case w:e.blendFunc(770,1);break;case b:e.blendFunc(0,769);break;case M:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}K=null,Y=null,J=null,Q=null,v=t,ee=l}}else!0===p&&(_e(3042),p=!1)}function Me(t){te!==t&&(t?e.frontFace(2304):e.frontFace(2305),te=t)}function Te(t){t!==o?(ye(2884),t!==ie&&(t===a?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):_e(2884),ie=t}function Se(t,i,n){t?(ye(32823),re===i&&se===n||(e.polygonOffset(i,n),re=i,se=n)):_e(32823)}function Ee(t){void 0===t&&(t=33984+oe-1),he!==t&&(e.activeTexture(t),he=t)}return{buffers:{color:r,depth:s,stencil:c},enable:ye,disable:_e,bindFramebuffer:function(t,i){return null===i&&null!==u&&(i=u),d[t]!==i&&(e.bindFramebuffer(t,i),d[t]=i,n&&(36009===t&&(d[36160]=i),36160===t&&(d[36009]=i)),!0)},bindXRFramebuffer:function(t){t!==u&&(e.bindFramebuffer(36160,t),u=t)},useProgram:function(t){return m!==t&&(e.useProgram(t),m=t,!0)},setBlending:be,setMaterial:function(e,t){e.side===g?_e(2884):ye(2884);let i=e.side===f;t&&(i=!i),Me(i),e.blending===x&&!1===e.transparent?be(_):be(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);const n=e.stencilWrite;c.setTest(n),n&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Se(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?ye(32926):_e(32926)},setFlipSided:Me,setCullFace:Te,setLineWidth:function(t){t!==ne&&(ae&&e.lineWidth(t),ne=t)},setPolygonOffset:Se,setScissorTest:function(e){e?ye(3089):_e(3089)},activeTexture:Ee,bindTexture:function(t,i){null===he&&Ee();let n=ue[he];void 0===n&&(n={type:void 0,texture:void 0},ue[he]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||ve[t]),n.type=t,n.texture=i)},unbindTexture:function(){const t=ue[he];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===pe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),pe.copy(t))},viewport:function(t){!1===fe.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),fe.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},he=null,ue={},u=null,d={},m=null,p=!1,v=null,y=null,K=null,Y=null,$=null,J=null,Q=null,ee=!1,te=null,ie=null,ne=null,re=null,se=null,pe.set(0,0,e.canvas.width,e.canvas.height),fe.set(0,0,e.canvas.width,e.canvas.height),r.reset(),s.reset(),c.reset()}}}function Ha(e,t,i,n,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,d=new WeakMap;let m,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function f(e,t){return p?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(e,t,i,n){let r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=t?qi:Math.floor,s=n(r*e.width),o=n(r*e.height);void 0===m&&(m=f(s,o));const a=i?f(s,o):m;a.width=s,a.height=o;return a.getContext("2d").drawImage(e,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return Hi(e.width)&&Hi(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==pe&&e.minFilter!==_e}function _(t,i,r,s){e.generateMipmap(t);n.get(i).__maxMipLevel=Math.log2(Math.max(r,s))}function x(i,n,r){if(!1===a)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let s=n;return 6403===n&&(5126===r&&(s=33326),5131===r&&(s=33325),5121===r&&(s=33321)),6407===n&&(5126===r&&(s=34837),5131===r&&(s=34843),5121===r&&(s=32849)),6408===n&&(5126===r&&(s=34836),5131===r&&(s=34842),5121===r&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||t.get("EXT_color_buffer_float"),s}function w(e){return e===pe||e===fe||e===ve?9728:9729}function b(t){const i=t.target;i.removeEventListener("dispose",b),function(t){const i=n.get(t);if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture),n.remove(t)}(i),i.isVideoTexture&&d.delete(i),o.memory.textures--}function M(t){const i=t.target;i.removeEventListener("dispose",M),function(t){const i=t.texture,r=n.get(t),s=n.get(i);if(!t)return;void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,r=i.length;t<r;t++){const r=n.get(i[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),o.memory.textures--),n.remove(i[t])}n.remove(i),n.remove(t)}(i)}let T=0;function S(e,t){const r=n.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){const i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void R(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,r.__webglTexture)}function E(t,r){const o=n.get(t);t.version>0&&o.__version!==t.version?function(t,n,r){if(6!==n.image.length)return;L(t,n),i.activeTexture(33984+r),i.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);const o=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=o||l?l?n.image[e].image:n.image[e]:g(n.image[e],!1,!0,c);const u=h[0],d=v(u)||a,m=s.convert(n.format),p=s.convert(n.type),f=x(n.internalFormat,m,p);let w;if(C(34067,n,d),o){for(let e=0;e<6;e++){w=h[e].mipmaps;for(let t=0;t<w.length;t++){const r=w[t];n.format!==Ne&&n.format!==Ue?null!==m?i.compressedTexImage2D(34069+e,t,f,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+e,t,f,r.width,r.height,0,m,p,r.data)}}t.__maxMipLevel=w.length-1}else{w=n.mipmaps;for(let e=0;e<6;e++)if(l){i.texImage2D(34069+e,0,f,h[e].width,h[e].height,0,m,p,h[e].data);for(let t=0;t<w.length;t++){const n=w[t].image[e].image;i.texImage2D(34069+e,t+1,f,n.width,n.height,0,m,p,n.data)}}else{i.texImage2D(34069+e,0,f,m,p,h[e]);for(let t=0;t<w.length;t++){const n=w[t];i.texImage2D(34069+e,t+1,f,m,p,n.image[e])}}t.__maxMipLevel=w.length}y(n,d)&&_(34067,n,u.width,u.height);t.__version=n.version,n.onUpdate&&n.onUpdate(n)}(o,t,r):(i.activeTexture(33984+r),i.bindTexture(34067,o.__webglTexture))}const P={[ue]:10497,[de]:33071,[me]:33648},A={[pe]:9728,[fe]:9984,[ve]:9986,[_e]:9729,[xe]:9985,[be]:9987};function C(i,s,o){if(o?(e.texParameteri(i,10242,P[s.wrapS]),e.texParameteri(i,10243,P[s.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,P[s.wrapR]),e.texParameteri(i,10240,A[s.magFilter]),e.texParameteri(i,10241,A[s.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),s.wrapS===de&&s.wrapT===de||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,w(s.magFilter)),e.texParameteri(i,10241,w(s.minFilter)),s.minFilter!==pe&&s.minFilter!==_e&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(s.type===Le&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&s.type===Re&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(e.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function L(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",b),t.__webglTexture=e.createTexture(),o.memory.textures++)}function R(t,n,r){let o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),L(t,n),i.activeTexture(33984+r),i.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!a&&(e.wrapS!==de||e.wrapT!==de||e.minFilter!==pe&&e.minFilter!==_e)}(n)&&!1===v(n.image),c=g(n.image,l,!1,h),u=v(c)||a,d=s.convert(n.format);let m,p=s.convert(n.type),f=x(n.internalFormat,d,p);C(o,n,u);const w=n.mipmaps;if(n.isDepthTexture)f=6402,a?f=n.type===Le?36012:n.type===Ce?33190:n.type===Fe?35056:33189:n.type===Le&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===Ge&&6402===f&&n.type!==Pe&&n.type!==Ce&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Pe,p=s.convert(n.type)),n.format===je&&6402===f&&(f=34041,n.type!==Fe&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Fe,p=s.convert(n.type))),i.texImage2D(3553,0,f,c.width,c.height,0,d,p,null);else if(n.isDataTexture)if(w.length>0&&u){for(let e=0,t=w.length;e<t;e++)m=w[e],i.texImage2D(3553,e,f,m.width,m.height,0,d,p,m.data);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,f,c.width,c.height,0,d,p,c.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(let e=0,t=w.length;e<t;e++)m=w[e],n.format!==Ne&&n.format!==Ue?null!==d?i.compressedTexImage2D(3553,e,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,e,f,m.width,m.height,0,d,p,m.data);t.__maxMipLevel=w.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,f,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,f,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(w.length>0&&u){for(let e=0,t=w.length;e<t;e++)m=w[e],i.texImage2D(3553,e,f,d,p,m);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,f,d,p,c),t.__maxMipLevel=0;y(n,u)&&_(o,n,c.width,c.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function D(t,r,o,a,l){const c=s.convert(o.format),h=s.convert(o.type),u=x(o.internalFormat,c,h);32879===l||35866===l?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):i.texImage2D(l,0,u,r.width,r.height,0,c,h,null),i.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,l,n.get(o).__webglTexture,0),i.bindFramebuffer(36160,null)}function O(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===Le?r=36012:t.type===Ce&&(r=33190));const n=F(i);e.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else e.renderbufferStorage(36161,r,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const t=F(i);e.renderbufferStorageMultisample(36161,t,35056,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=s.convert(t.format),o=s.convert(t.type),a=x(t.internalFormat,r,o);if(n){const t=F(i);e.renderbufferStorageMultisample(36161,t,a,i.width,i.height)}else e.renderbufferStorage(36161,a,i.width,i.height)}e.bindRenderbuffer(36161,null)}function I(t){const r=n.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),S(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Ge)e.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==je)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=e.createRenderbuffer(),O(r.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),O(r.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}function F(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(u,e.samples):0}let V=!1,U=!1;this.allocateTextureUnit=function(){const e=T;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=S,this.setTexture2DArray=function(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?R(r,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?R(r,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(t){const l=t.texture,c=n.get(t),h=n.get(l);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(h.__webglTexture=e.createTexture(),h.__version=l.version,o.memory.textures++);const u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,m=!0===t.isWebGLMultisampleRenderTarget,p=l.isDataTexture3D||l.isDataTexture2DArray,f=v(t)||a;if(!a||l.format!==Ue||l.type!==Le&&l.type!==Re||(l.format=Ne,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers){const i=t.texture;for(let t=0,r=i.length;t<r;t++){const r=n.get(i[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(m)if(a){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const n=s.convert(l.format),r=s.convert(l.type),o=x(l.internalFormat,n,r),a=F(t);e.renderbufferStorageMultisample(36161,a,o,t.width,t.height),i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),O(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){i.bindTexture(34067,h.__webglTexture),C(34067,l,f);for(let e=0;e<6;e++)D(c.__webglFramebuffer[e],t,l,36064,34069+e);y(l,f)&&_(34067,l,t.width,t.height),i.bindTexture(34067,null)}else if(d){const e=t.texture;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=n.get(s);i.bindTexture(3553,o.__webglTexture),C(3553,s,f),D(c.__webglFramebuffer,t,s,36064+r,3553),y(s,f)&&_(3553,s,t.width,t.height)}i.bindTexture(3553,null)}else{let e=3553;if(p)if(a){e=l.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");i.bindTexture(e,h.__webglTexture),C(e,l,f),D(c.__webglFramebuffer,t,l,36064,e),y(l,f)&&_(3553,l,t.width,t.height),i.bindTexture(3553,null)}t.depthBuffer&&I(t)},this.updateRenderTargetMipmap=function(e){const t=v(e)||a,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(y(o,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,r=n.get(o).__webglTexture;i.bindTexture(t,r),_(t,o,e.width,e.height),i.bindTexture(t,null)}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const r=t.width,s=t.height;let o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024);const a=n.get(t);i.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,a.__webglFramebuffer),e.blitFramebuffer(0,0,r,s,0,0,r,s,o,9728),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===V&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),V=!0),e=e.texture),S(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),e=e.texture),E(e,t)}}function Wa(e,t,i){const n=i.isWebGL2;return{convert:function(e){let i;if(e===Te)return 5121;if(e===De)return 32819;if(e===Oe)return 32820;if(e===Ie)return 33635;if(e===Se)return 5120;if(e===Ee)return 5122;if(e===Pe)return 5123;if(e===Ae)return 5124;if(e===Ce)return 5125;if(e===Le)return 5126;if(e===Re)return n?5131:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(e===Ve)return 6406;if(e===Ue)return 6407;if(e===Ne)return 6408;if(e===Be)return 6409;if(e===ke)return 6410;if(e===Ge)return 6402;if(e===je)return 34041;if(e===He)return 6403;if(e===We)return 36244;if(e===qe)return 33319;if(e===Xe)return 33320;if(e===Ze)return 36248;if(e===Ke)return 36249;if(e===Ye||e===$e||e===Je||e===Qe){if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===Ye)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===$e)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Je)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Qe)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===it||e===nt){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===et)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===it)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===nt)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===rt)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===st||e===ot)&&(i=t.get("WEBGL_compressed_texture_etc"),null!==i)){if(e===st)return i.COMPRESSED_RGB8_ETC2;if(e===ot)return i.COMPRESSED_RGBA8_ETC2_EAC}return e===at||e===lt||e===ct||e===ht||e===ut||e===dt||e===mt||e===pt||e===ft||e===gt||e===vt||e===yt||e===_t||e===xt||e===bt||e===Mt||e===Tt||e===St||e===Et||e===Pt||e===At||e===Ct||e===Lt||e===Rt||e===Dt||e===Ot||e===It||e===Ft?(i=t.get("WEBGL_compressed_texture_astc"),null!==i?e:null):e===wt?(i=t.get("EXT_texture_compression_bptc"),null!==i?e:null):e===Fe?n?34042:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class qa extends Ls{constructor(e=[]){super(),this.cameras=e}}qa.prototype.isArrayCamera=!0;class Xa extends cr{constructor(){super(),this.type="Group"}}Xa.prototype.isGroup=!0;const Za={type:"move"};class Ka{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Xa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Xa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new an,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new an),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Xa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new an,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new an),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(n=t.getPose(e.targetRaySpace,i),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Za))),l&&e.hand){s=!0;for(const n of e.hand.values()){const e=t.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const e=new Xa;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[n.jointName]=e,l.add(e)}const r=l.joints[n.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=n.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Ya extends Fi{constructor(e,t){super();const i=this,n=e.state;let r=null,s=1,o=null,a="local-floor",l=null;const c=[],h=new Map,u=new Ls;u.layers.enable(1),u.viewport=new tn;const d=new Ls;d.layers.enable(2),d.viewport=new tn;const m=[u,d],p=new qa;p.layers.enable(1),p.layers.enable(2);let f=null,g=null;function v(e){const t=h.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function y(){h.forEach((function(e,t){e.disconnect(t)})),h.clear(),f=null,g=null,n.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),T.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function _(e){const t=r.inputSources;for(let e=0;e<c.length;e++)h.set(t[e],c[e]);for(let t=0;t<e.removed.length;t++){const i=e.removed[t],n=h.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),h.delete(i))}for(let t=0;t<e.added.length;t++){const i=e.added[t],n=h.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new Ka,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new Ka,c[e]=t),t.getGripSpace()},this.getHand=function(e){let t=c[e];return void 0===t&&(t=new Ka,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return r},this.setSession=async function(e){if(r=e,null!==r){r.addEventListener("select",v),r.addEventListener("selectstart",v),r.addEventListener("selectend",v),r.addEventListener("squeeze",v),r.addEventListener("squeezestart",v),r.addEventListener("squeezeend",v),r.addEventListener("end",y),r.addEventListener("inputsourceschange",_);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const n={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:s},l=new XRWebGLLayer(r,t,n);r.updateRenderState({baseLayer:l}),o=await r.requestReferenceSpace(a),T.setContext(r),T.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const x=new an,w=new an;function b(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;p.near=d.near=u.near=e.near,p.far=d.far=u.far=e.far,f===p.near&&g===p.far||(r.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,g=p.far);const t=e.parent,i=p.cameras;b(p,t);for(let e=0;e<i.length;e++)b(i[e],t);e.matrixWorld.copy(p.matrixWorld),e.matrix.copy(p.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const n=e.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(!0);2===i.length?function(e,t,i){x.setFromMatrixPosition(t.matrixWorld),w.setFromMatrixPosition(i.matrixWorld);const n=x.distanceTo(w),r=t.projectionMatrix.elements,s=i.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*h,m=o*u,p=n/(-h+u),f=p*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+p,v=a+p,y=d-f,_=m+(n-f),b=l*a/v*g,M=c*a/v*g;e.projectionMatrix.makePerspective(y,_,b,M,g,v)}(p,u,d):p.projectionMatrix.copy(u.projectionMatrix)},this.getCamera=function(){return p};let M=null;const T=new Us;T.setAnimationLoop((function(e,t){if(l=t.getViewerPose(o),null!==l){const e=l.views,t=r.renderState.baseLayer;n.bindXRFramebuffer(t.framebuffer);let i=!1;e.length!==p.cameras.length&&(p.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n],s=t.getViewport(r),o=m[n];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===n&&p.matrix.copy(o.matrix),!0===i&&p.cameras.push(o)}}const i=r.inputSources;for(let e=0;e<c.length;e++){const n=c[e],r=i[e];n.update(r,t,o)}M&&M(e,t)})),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}}function $a(e){function t(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap);const n=e.get(i).envMap;if(n){t.envMap.value=n,t.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,t.reflectivity.value=i.reflectivity,t.refractionRatio.value=i.refractionRatio;const r=e.get(n).__maxMipLevel;void 0!==r&&(t.maxMipLevel.value=r)}let r,s;i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(r=i.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uv2Transform.value.copy(s.matrix))}function i(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale,i.side===f&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale),i.side===f&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias);e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,n,r,s,o){n.isMeshBasicMaterial?t(e,n):n.isMeshLambertMaterial?(t(e,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,n)):n.isMeshToonMaterial?(t(e,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshPhongMaterial?(t(e,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshStandardMaterial?(t(e,n),n.isMeshPhysicalMaterial?function(e,t,n){i(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===f&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap);t.transmission>0&&(e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height));e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap);e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)}(e,n,o):i(e,n)):n.isMeshMatcapMaterial?(t(e,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDepthMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDistanceMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,n)):n.isMeshNormalMaterial?(t(e,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,n)):n.isPointsMaterial?function(e,t,i,n){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,n,r,s):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,n):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Ja(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let u=null,d=null;const m=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Yt,this.physicallyCorrectLights=!1,this.toneMapping=J,this.toneMappingExposure=1;const f=this;let g=!1,v=0,y=0,_=null,x=-1,w=null;const b=new tn,M=new tn;let T=null,S=t.width,E=t.height,P=1,A=null,C=null;const L=new tn(0,0,S,E),R=new tn(0,0,S,E);let D=!1;const O=[],I=new Vs;let F=!1,V=!1,U=null;const N=new Nn,B=new an,k={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===_?P:1}let G,j,H,W,q,X,Z,K,Y,$,Q,ee,te,ie,ne,re,se,oe,ae,le,ce,he,ue=i;function me(e,i){for(let n=0;n<e.length;n++){const r=e[n],s=t.getContext(r,i);if(null!==s)return s}return null}try{const e={alpha:n,depth:r,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(t.addEventListener("webglcontextlost",ve,!1),t.addEventListener("webglcontextrestored",ye,!1),null===ue){const t=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&t.shift(),ue=me(t,e),null===ue)throw me(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ue.getShaderPrecisionFormat&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function fe(){G=new Ks(ue),j=new qs(ue,G,e),G.init(j),ce=new Wa(ue,G,j),H=new ja(ue,G,j),O[0]=1029,W=new Js(ue),q=new Ca,X=new Ha(ue,G,H,q,j,ce,W),Z=new Zs(f),K=new Ns(ue,j),he=new Hs(ue,G,K,j),Y=new Ys(ue,K,W,he),$=new io(ue,Y,K,W),oe=new to(ue),ne=new Xs(q),Q=new Aa(f,Z,G,j,he,ne),ee=new $a(q),te=new Oa(q),ie=new Ba(G,j),se=new js(f,Z,H,$,a),re=new Ga(f,$,j),ae=new Ws(ue,G,W,j),le=new $s(ue,G,W,j),W.programs=Q.programs,f.capabilities=j,f.extensions=G,f.properties=q,f.renderLists=te,f.shadowMap=re,f.state=H,f.info=W}fe();const ge=new Ya(f,ue);function ve(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const e=W.autoReset,t=re.enabled,i=re.autoUpdate,n=re.needsUpdate,r=re.type;fe(),W.autoReset=e,re.enabled=t,re.autoUpdate=i,re.needsUpdate=n,re.type=r}function _e(e){const t=e.target;t.removeEventListener("dispose",_e),function(e){(function(e){const t=q.get(e).programs;void 0!==t&&t.forEach((function(e){Q.releaseProgram(e)}))})(e),q.remove(e)}(t)}this.xr=ge,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){const e=G.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=G.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(e){void 0!==e&&(P=e,this.setSize(S,E,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Zi),e.set(S,E)},this.setSize=function(e,i,n){ge.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(S=e,E=i,t.width=Math.floor(e*P),t.height=Math.floor(i*P),!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Zi),e.set(S*P,E*P).floor()},this.setDrawingBufferSize=function(e,i,n){S=e,E=i,P=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new tn),e.copy(b)},this.getViewport=function(e){return e.copy(L)},this.setViewport=function(e,t,i,n){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,i,n),H.viewport(b.copy(L).multiplyScalar(P).floor())},this.getScissor=function(e){return e.copy(R)},this.setScissor=function(e,t,i,n){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,i,n),H.scissor(M.copy(R).multiplyScalar(P).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(e){H.setScissorTest(D=e)},this.setOpaqueSort=function(e){A=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Or),e.copy(se.getClearColor())},this.setClearColor=function(){se.setClearColor.apply(se,arguments)},this.getClearAlpha=function(){return se.getClearAlpha()},this.setClearAlpha=function(){se.setClearAlpha.apply(se,arguments)},this.clear=function(e,t,i){let n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===i||i)&&(n|=1024),ue.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ve,!1),t.removeEventListener("webglcontextrestored",ye,!1),te.dispose(),ie.dispose(),q.dispose(),Z.dispose(),$.dispose(),he.dispose(),ge.dispose(),ge.removeEventListener("sessionstart",we),ge.removeEventListener("sessionend",Me),U&&(U.dispose(),U=null),Se.stop()},this.renderBufferImmediate=function(e,t){he.initAttributes();const i=q.get(e);e.hasPositions&&!i.position&&(i.position=ue.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=ue.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=ue.createBuffer()),e.hasColors&&!i.color&&(i.color=ue.createBuffer());const n=t.getAttributes();e.hasPositions&&(ue.bindBuffer(34962,i.position),ue.bufferData(34962,e.positionArray,35048),he.enableAttribute(n.position),ue.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(ue.bindBuffer(34962,i.normal),ue.bufferData(34962,e.normalArray,35048),he.enableAttribute(n.normal),ue.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(ue.bindBuffer(34962,i.uv),ue.bufferData(34962,e.uvArray,35048),he.enableAttribute(n.uv),ue.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(ue.bindBuffer(34962,i.color),ue.bufferData(34962,e.colorArray,35048),he.enableAttribute(n.color),ue.vertexAttribPointer(n.color,3,5126,!1,0,0)),he.disableUnusedAttributes(),ue.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,r,s){null===t&&(t=k);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=De(e,t,n,r);H.setMaterial(n,o);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===n.wireframe&&(l=Y.getWireframeAttribute(i),u=2),(n.morphTargets||n.morphNormals)&&oe.update(r,i,n,a),he.setup(r,n,a,i,l);let d=ae;null!==l&&(h=K.get(l),d=le,d.setIndex(h));const m=null!==l?l.count:c.count,p=i.drawRange.start*u,f=i.drawRange.count*u,g=null!==s?s.start*u:0,v=null!==s?s.count*u:1/0,y=Math.max(p,g),_=Math.min(m,p+f,g+v)-1,x=Math.max(0,_-y+1);if(0!==x){if(r.isMesh)!0===n.wireframe?(H.setLineWidth(n.wireframeLinewidth*z()),d.setMode(1)):d.setMode(4);else if(r.isLine){let e=n.linewidth;void 0===e&&(e=1),H.setLineWidth(e*z()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(y,x,r.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(y,x,e)}else d.render(y,x)}},this.compile=function(e,t){d=ie.get(e),d.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){Ae(i[n],e,t)}else Ae(i,e,t)}))};let xe=null;function we(){Se.stop()}function Me(){Se.start()}const Se=new Us;function Ee(e,t,i){const n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=s.object,a=s.geometry,l=null===n?s.material:n,c=s.group;if(i.isArrayCamera){const e=i.cameras;for(let i=0,n=e.length;i<n;i++){const n=e[i];o.layers.test(n.layers)&&(H.viewport(b.copy(n.viewport)),d.setupLightsView(n),Pe(o,t,n,a,l,c))}}else Pe(o,t,i,a,l,c)}}function Pe(e,t,i,n,r,s){if(e.onBeforeRender(f,t,i,n,r,s),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const n=De(i,t,r,e);H.setMaterial(r),he.reset(),function(e,t){e.render((function(e){f.renderBufferImmediate(e,t)}))}(e,n)}else f.renderBufferDirect(i,t,n,r,e,s);e.onAfterRender(f,t,i,n,r,s)}function Ae(e,t,i){!0!==t.isScene&&(t=k);const n=q.get(e),r=d.state.lights,s=d.state.shadowsArray,o=r.state.version,a=Q.getParameters(e,r.state,s,t,i),l=Q.getProgramCacheKey(a);let c=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=Z.get(e.envMap||n.environment),void 0===c&&(e.addEventListener("dispose",_e),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===o)return Ce(e,a),h}else a.uniforms=Q.getUniforms(e),e.onBuild(a,f),e.onBeforeCompile(a,f),h=Q.acquireProgram(a,l),c.set(l,h),n.uniforms=a.uniforms;const u=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(u.clippingPlanes=ne.uniform),Ce(e,a),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=o,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const m=h.getUniforms(),p=aa.seqWithValue(m.seq,u);return n.currentProgram=h,n.uniformsList=p,h}function Ce(e,t){const i=q.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.skinning=t.skinning,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas}function De(e,t,i,n){!0!==t.isScene&&(t=k),X.resetTextureUnits();const r=t.fog,s=i.isMeshStandardMaterial?t.environment:null,o=null===_?f.outputEncoding:_.texture.encoding,a=Z.get(i.envMap||s),l=!0===i.vertexColors&&n.geometry&&n.geometry.attributes.color&&4===n.geometry.attributes.color.itemSize,c=q.get(i),h=d.state.lights;if(!0===F&&(!0===V||e!==w)){const t=e===w&&i.id===x;ne.setState(i,e,t)}let u=!1;i.version===c.__version?c.needsLights&&c.lightsStateVersion!==h.state.version||c.outputEncoding!==o||n.isInstancedMesh&&!1===c.instancing?u=!0:n.isInstancedMesh||!0!==c.instancing?n.isSkinnedMesh&&!1===c.skinning?u=!0:n.isSkinnedMesh||!0!==c.skinning?c.envMap!==a||i.fog&&c.fog!==r?u=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===ne.numPlanes&&c.numIntersection===ne.numIntersection?c.vertexAlphas!==l&&(u=!0):u=!0:u=!0:u=!0:(u=!0,c.__version=i.version);let m=c.currentProgram;!0===u&&(m=Ae(i,t,n));let p=!1,g=!1,v=!1;const y=m.getUniforms(),b=c.uniforms;if(H.useProgram(m.program)&&(p=!0,g=!0,v=!0),i.id!==x&&(x=i.id,g=!0),p||w!==e){if(y.setValue(ue,"projectionMatrix",e.projectionMatrix),j.logarithmicDepthBuffer&&y.setValue(ue,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,g=!0,v=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=y.map.cameraPosition;void 0!==t&&t.setValue(ue,B.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&y.setValue(ue,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||n.isSkinnedMesh)&&y.setValue(ue,"viewMatrix",e.matrixWorldInverse)}if(n.isSkinnedMesh){y.setOptional(ue,n,"bindMatrix"),y.setOptional(ue,n,"bindMatrixInverse");const e=n.skeleton;e&&(j.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),y.setValue(ue,"boneTexture",e.boneTexture,X),y.setValue(ue,"boneTextureSize",e.boneTextureSize)):y.setOptional(ue,e,"boneMatrices"))}var M,T;return(g||c.receiveShadow!==n.receiveShadow)&&(c.receiveShadow=n.receiveShadow,y.setValue(ue,"receiveShadow",n.receiveShadow)),g&&(y.setValue(ue,"toneMappingExposure",f.toneMappingExposure),c.needsLights&&(T=v,(M=b).ambientLightColor.needsUpdate=T,M.lightProbe.needsUpdate=T,M.directionalLights.needsUpdate=T,M.directionalLightShadows.needsUpdate=T,M.pointLights.needsUpdate=T,M.pointLightShadows.needsUpdate=T,M.spotLights.needsUpdate=T,M.spotLightShadows.needsUpdate=T,M.rectAreaLights.needsUpdate=T,M.hemisphereLights.needsUpdate=T),r&&i.fog&&ee.refreshFogUniforms(b,r),ee.refreshMaterialUniforms(b,i,P,E,U),aa.upload(ue,c.uniformsList,b,X)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(aa.upload(ue,c.uniformsList,b,X),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&y.setValue(ue,"center",n.center),y.setValue(ue,"modelViewMatrix",n.modelViewMatrix),y.setValue(ue,"normalMatrix",n.normalMatrix),y.setValue(ue,"modelMatrix",n.matrixWorld),m}Se.setAnimationLoop((function(e){xe&&xe(e)})),"undefined"!=typeof window&&Se.setContext(window),this.setAnimationLoop=function(e){xe=e,ge.setAnimationLoop(e),null===e?Se.stop():Se.start()},ge.addEventListener("sessionstart",we),ge.addEventListener("sessionend",Me),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ge.enabled&&!0===ge.isPresenting&&(!0===ge.cameraAutoUpdate&&ge.updateCamera(t),t=ge.getCamera()),!0===e.isScene&&e.onBeforeRender(f,e,t,_),d=ie.get(e,p.length),d.init(),p.push(d),N.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(N),V=this.localClippingEnabled,F=ne.init(this.clippingPlanes,V,t),u=te.get(e,m.length),u.init(),m.push(u),function e(t,i,n,r){if(!1===t.visible)return;if(t.layers.test(i.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(i);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||I.intersectsSprite(t)){r&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(N);const e=$.update(t),i=t.material;i.visible&&u.push(t,e,i,n,B.z,null)}}else if(t.isImmediateRenderObject)r&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(N),u.push(t,null,t.material,n,B.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==W.render.frame&&(t.skeleton.update(),t.skeleton.frame=W.render.frame),!t.frustumCulled||I.intersectsObject(t))){r&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(N);const e=$.update(t),i=t.material;if(Array.isArray(i)){const r=e.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i[o.materialIndex];a&&a.visible&&u.push(t,e,a,n,B.z,o)}}else i.visible&&u.push(t,e,i,n,B.z,null)}const s=t.children;for(let t=0,o=s.length;t<o;t++)e(s[t],i,n,r)}(e,t,0,f.sortObjects),u.finish(),!0===f.sortObjects&&u.sort(A,C),!0===F&&ne.beginShadows();const i=d.state.shadowsArray;re.render(i,e,t),d.setupLights(),d.setupLightsView(t),!0===F&&ne.endShadows(),!0===this.info.autoReset&&this.info.reset(),se.render(u,e);const n=u.opaque,r=u.transmissive,s=u.transparent;n.length>0&&Ee(n,e,t),r.length>0&&function(e,t,i,n){null===U&&(U=new nn(1024,1024,{generateMipmaps:!0,minFilter:be,magFilter:pe,wrapS:de,wrapT:de}));const r=f.getRenderTarget();f.setRenderTarget(U),f.clear(),Ee(e,i,n),X.updateRenderTargetMipmap(U),f.setRenderTarget(r),Ee(t,i,n)}(n,r,e,t),s.length>0&&Ee(s,e,t),null!==_&&(X.updateRenderTargetMipmap(_),X.updateMultisampleRenderTarget(_)),!0===e.isScene&&e.onAfterRender(f,e,t),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1),he.resetDefaultState(),x=-1,w=null,p.pop(),d=p.length>0?p[p.length-1]:null,m.pop(),u=m.length>0?m[m.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return _},this.setRenderTarget=function(e,t=0,i=0){_=e,v=t,y=i,e&&void 0===q.get(e).__webglFramebuffer&&X.setupRenderTarget(e);let n=null,r=!1,s=!1;if(e){const i=e.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(s=!0);const o=q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=o[t],r=!0):n=e.isWebGLMultisampleRenderTarget?q.get(e).__webglMultisampledFramebuffer:o,b.copy(e.viewport),M.copy(e.scissor),T=e.scissorTest}else b.copy(L).multiplyScalar(P).floor(),M.copy(R).multiplyScalar(P).floor(),T=D;if(H.bindFramebuffer(36160,n)&&j.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const i=e.texture;if(O.length!==i.length||36064!==O[0]){for(let e=0,t=i.length;e<t;e++)O[e]=36064+e;O.length=i.length,t=!0}}else 1===O.length&&36064===O[0]||(O[0]=36064,O.length=1,t=!0);else 1===O.length&&1029===O[0]||(O[0]=1029,O.length=1,t=!0);t&&(j.isWebGL2?ue.drawBuffers(O):G.get("WEBGL_draw_buffers").drawBuffersWEBGL(O))}if(H.viewport(b),H.scissor(M),H.setScissorTest(T),r){const n=q.get(e.texture);ue.framebufferTexture2D(36160,36064,34069+t,n.__webglTexture,i)}else if(s){const n=q.get(e.texture),r=t||0;ue.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}},this.readRenderTargetPixels=function(e,t,i,n,r,s,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){H.bindFramebuffer(36160,a);try{const o=e.texture,a=o.format,l=o.type;if(a!==Ne&&ce.convert(a)!==ue.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Re&&(G.has("EXT_color_buffer_half_float")||j.isWebGL2&&G.has("EXT_color_buffer_float"));if(!(l===Te||ce.convert(l)===ue.getParameter(35738)||l===Le&&(j.isWebGL2||G.has("OES_texture_float")||G.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ue.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&ue.readPixels(t,i,n,r,ce.convert(a),ce.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==_?q.get(_).__webglFramebuffer:null;H.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){const n=Math.pow(2,-i),r=Math.floor(t.image.width*n),s=Math.floor(t.image.height*n);let o=ce.convert(t.format);j.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),X.setTexture2D(t,0),ue.copyTexImage2D(3553,i,o,e.x,e.y,r,s,0),H.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){const r=t.image.width,s=t.image.height,o=ce.convert(i.format),a=ce.convert(i.type);X.setTexture2D(i,0),ue.pixelStorei(37440,i.flipY),ue.pixelStorei(37441,i.premultiplyAlpha),ue.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?ue.texSubImage2D(3553,n,e.x,e.y,r,s,o,a,t.image.data):t.isCompressedTexture?ue.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ue.texSubImage2D(3553,n,e.x,e.y,o,a,t.image),0===n&&i.generateMipmaps&&ue.generateMipmap(3553),H.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n,r=0){if(f.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const{width:s,height:o,data:a}=i.image,l=ce.convert(n.format),c=ce.convert(n.type);let h;if(n.isDataTexture3D)X.setTexture3D(n,0),h=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");X.setTexture2DArray(n,0),h=35866}ue.pixelStorei(37440,n.flipY),ue.pixelStorei(37441,n.premultiplyAlpha),ue.pixelStorei(3317,n.unpackAlignment);const u=ue.getParameter(3314),d=ue.getParameter(32878),m=ue.getParameter(3316),p=ue.getParameter(3315),g=ue.getParameter(32877);ue.pixelStorei(3314,s),ue.pixelStorei(32878,o),ue.pixelStorei(3316,e.min.x),ue.pixelStorei(3315,e.min.y),ue.pixelStorei(32877,e.min.z),ue.texSubImage3D(h,r,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,l,c,a),ue.pixelStorei(3314,u),ue.pixelStorei(32878,d),ue.pixelStorei(3316,m),ue.pixelStorei(3315,p),ue.pixelStorei(32877,g),0===r&&n.generateMipmaps&&ue.generateMipmap(h),H.unbindTexture()},this.initTexture=function(e){X.setTexture2D(e,0),H.unbindTexture()},this.resetState=function(){v=0,y=0,_=null,H.reset(),he.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Qa extends Ja{}Qa.prototype.isWebGL1Renderer=!0;class el{constructor(e,t=25e-5){this.name="",this.color=new Or(e),this.density=t}clone(){return new el(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}el.prototype.isFogExp2=!0;class tl{constructor(e,t=1,i=1e3){this.name="",this.color=new Or(e),this.near=t,this.far=i}clone(){return new tl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}tl.prototype.isFog=!0;class il extends cr{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}il.prototype.isScene=!0;class nl{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Ti,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ki()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ki()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ki()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}nl.prototype.isInterleavedBuffer=!0;const rl=new an;class sl{constructor(e,t,i,n){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)rl.x=this.getX(t),rl.y=this.getY(t),rl.z=this.getZ(t),rl.applyMatrix4(e),this.setXYZ(t,rl.x,rl.y,rl.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)rl.x=this.getX(t),rl.y=this.getY(t),rl.z=this.getZ(t),rl.applyNormalMatrix(e),this.setXYZ(t,rl.x,rl.y,rl.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)rl.x=this.getX(t),rl.y=this.getY(t),rl.z=this.getZ(t),rl.transformDirection(e),this.setXYZ(t,rl.x,rl.y,rl.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new Ur(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new sl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}sl.prototype.isInterleavedBufferAttribute=!0;class ol extends Er{constructor(e){super(),this.type="SpriteMaterial",this.color=new Or(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let al;ol.prototype.isSpriteMaterial=!0;const ll=new an,cl=new an,hl=new an,ul=new Zi,dl=new Zi,ml=new Nn,pl=new an,fl=new an,gl=new an,vl=new Zi,yl=new Zi,_l=new Zi;class xl extends cr{constructor(e){if(super(),this.type="Sprite",void 0===al){al=new rs;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new nl(e,5);al.setIndex([0,1,2,0,2,3]),al.setAttribute("position",new sl(t,3,0,!1)),al.setAttribute("uv",new sl(t,2,3,!1))}this.geometry=al,this.material=void 0!==e?e:new ol,this.center=new Zi(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),cl.setFromMatrixScale(this.matrixWorld),ml.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),hl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&cl.multiplyScalar(-hl.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;wl(pl.set(-.5,-.5,0),hl,s,cl,n,r),wl(fl.set(.5,-.5,0),hl,s,cl,n,r),wl(gl.set(.5,.5,0),hl,s,cl,n,r),vl.set(0,0),yl.set(1,0),_l.set(1,1);let o=e.ray.intersectTriangle(pl,fl,gl,!1,ll);if(null===o&&(wl(fl.set(-.5,.5,0),hl,s,cl,n,r),yl.set(0,1),o=e.ray.intersectTriangle(pl,gl,fl,!1,ll),null===o))return;const a=e.ray.origin.distanceTo(ll);a<e.near||a>e.far||t.push({distance:a,point:ll.clone(),uv:Tr.getUV(ll,pl,fl,gl,vl,yl,_l,new Zi),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function wl(e,t,i,n,r,s){ul.subVectors(e,i).addScalar(.5).multiply(n),void 0!==r?(dl.x=s*ul.x-r*ul.y,dl.y=r*ul.x+s*ul.y):dl.copy(ul),e.copy(t),e.x+=dl.x,e.y+=dl.y,e.applyMatrix4(ml)}xl.prototype.isSprite=!0;const bl=new an,Ml=new an;class Tl extends cr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,i=t.length;e<i;e++){const i=t[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const i=this.levels;let n;for(n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){bl.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(bl);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){bl.setFromMatrixPosition(e.matrixWorld),Ml.setFromMatrixPosition(this.matrixWorld);const i=bl.distanceTo(Ml)/e.zoom;let n,r;for(t[0].object.visible=!0,n=1,r=t.length;n<r&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let e=0,n=i.length;e<n;e++){const n=i[e];t.object.levels.push({object:n.object.uuid,distance:n.distance})}return t}}const Sl=new an,El=new tn,Pl=new tn,Al=new an,Cl=new Nn;class Ll extends bs{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Nn,this.bindMatrixInverse=new Nn}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new tn,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,n=this.geometry;El.fromBufferAttribute(n.attributes.skinIndex,e),Pl.fromBufferAttribute(n.attributes.skinWeight,e),Sl.fromBufferAttribute(n.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const n=Pl.getComponent(e);if(0!==n){const r=El.getComponent(e);Cl.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),t.addScaledVector(Al.copy(Sl).applyMatrix4(Cl),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}Ll.prototype.isSkinnedMesh=!0;class Rl extends cr{constructor(){super(),this.type="Bone"}}Rl.prototype.isBone=!0;class Dl extends Qi{constructor(e,t,i,n,r,s,o,a,l,c,h,u){super(null,s,o,a,l,c,n,r,h,u),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==l?l:pe,this.minFilter=void 0!==c?c:pe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Dl.prototype.isDataTexture=!0;const Ol=new Nn,Il=new Nn;class Fl{constructor(e=[],t=[]){this.uuid=ki(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Nn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Nn;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=e.length;n<r;n++){const r=e[n]?e[n].matrixWorld:Il;Ol.multiplyMatrices(r,t[n]),Ol.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Fl(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Wi(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Dl(t,e,e,Ne,Le);return this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const n=e.bones[i];let r=t[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new Rl),this.bones.push(r),this.boneInverses.push((new Nn).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){const r=t[n];e.bones.push(r.uuid);const s=i[n];e.boneInverses.push(s.toArray())}return e}}const Vl=new Nn,Ul=new Nn,Nl=[],Bl=new bs;class kl extends bs{constructor(e,t,i){super(e,t),this.instanceMatrix=new Ur(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,n=this.count;if(Bl.geometry=this.geometry,Bl.material=this.material,void 0!==Bl.material)for(let r=0;r<n;r++){this.getMatrixAt(r,Vl),Ul.multiplyMatrices(i,Vl),Bl.matrixWorld=Ul,Bl.raycast(e,Nl);for(let e=0,i=Nl.length;e<i;e++){const i=Nl[e];i.instanceId=r,i.object=this,t.push(i)}Nl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Ur(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}kl.prototype.isInstancedMesh=!0;class zl extends Er{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Or(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}zl.prototype.isLineBasicMaterial=!0;const Gl=new an,jl=new an,Hl=new Nn,Wl=new Un,ql=new Cn;class Xl extends cr{constructor(e=new rs,t=new zl){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)Gl.fromBufferAttribute(t,e-1),jl.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=Gl.distanceTo(jl);e.setAttribute("lineDistance",new qr(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),ql.copy(i.boundingSphere),ql.applyMatrix4(n),ql.radius+=r,!1===e.ray.intersectsSphere(ql))return;Hl.copy(n).invert(),Wl.copy(e.ray).applyMatrix4(Hl);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new an,c=new an,h=new an,u=new an,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n){for(let i=Math.max(0,s.start),o=Math.min(n.count,s.start+s.count)-1;i<o;i+=d){const s=n.getX(i),o=n.getX(i+1);l.fromBufferAttribute(r,s),c.fromBufferAttribute(r,o);if(Wl.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(u);d<e.near||d>e.far||t.push({distance:d,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(r.count,s.start+s.count)-1;i<n;i+=d){l.fromBufferAttribute(r,i),c.fromBufferAttribute(r,i+1);if(Wl.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(u);n<e.near||n>e.far||t.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Xl.prototype.isLine=!0;const Zl=new an,Kl=new an;class Yl extends Xl{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)Zl.fromBufferAttribute(t,e),Kl.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+Zl.distanceTo(Kl);e.setAttribute("lineDistance",new qr(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Yl.prototype.isLineSegments=!0;class $l extends Xl{constructor(e,t){super(e,t),this.type="LineLoop"}}$l.prototype.isLineLoop=!0;class Jl extends Er{constructor(e){super(),this.type="PointsMaterial",this.color=new Or(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}Jl.prototype.isPointsMaterial=!0;const Ql=new Nn,ec=new Un,tc=new Cn,ic=new an;class nc extends cr{constructor(e=new rs,t=new Jl){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),tc.copy(i.boundingSphere),tc.applyMatrix4(n),tc.radius+=r,!1===e.ray.intersectsSphere(tc))return;Ql.copy(n).invert(),ec.copy(e.ray).applyMatrix4(Ql);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position;if(null!==r){for(let i=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);i<l;i++){const s=r.getX(i);ic.fromBufferAttribute(o,s),rc(ic,s,a,n,e,t,this)}}else{for(let i=Math.max(0,s.start),r=Math.min(o.count,s.start+s.count);i<r;i++)ic.fromBufferAttribute(o,i),rc(ic,i,a,n,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function rc(e,t,i,n,r,s,o){const a=ec.distanceSqToPoint(e);if(a<i){const i=new an;ec.closestPointToPoint(e,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:t,face:null,object:o})}}nc.prototype.isPoints=!0;class sc extends Qi{constructor(e,t,i,n,r,s,o,a,l){super(e,t,i,n,r,s,o,a,l),this.format=void 0!==o?o:Ue,this.minFilter=void 0!==s?s:_e,this.magFilter=void 0!==r?r:_e,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}sc.prototype.isVideoTexture=!0;class oc extends Qi{constructor(e,t,i,n,r,s,o,a,l,c,h,u){super(null,s,o,a,l,c,n,r,h,u),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}oc.prototype.isCompressedTexture=!0;class ac extends Qi{constructor(e,t,i,n,r,s,o,a,l){super(e,t,i,n,r,s,o,a,l),this.needsUpdate=!0}}ac.prototype.isCanvasTexture=!0;class lc extends Qi{constructor(e,t,i,n,r,s,o,a,l,c){if((c=void 0!==c?c:Ge)!==Ge&&c!==je)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Ge&&(i=Pe),void 0===i&&c===je&&(i=Fe),super(null,n,r,s,o,a,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:pe,this.minFilter=void 0!==a?a:pe,this.flipY=!1,this.generateMipmaps=!1}}lc.prototype.isDepthTexture=!0;class cc extends rs{constructor(e=1,t=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);const r=[],s=[],o=[],a=[],l=new an,c=new Zi;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let r=0,h=3;r<=t;r++,h+=3){const u=i+r/t*n;l.x=e*Math.cos(u),l.y=e*Math.sin(u),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[h]/e+1)/2,c.y=(s[h+1]/e+1)/2,a.push(c.x,c.y)}for(let e=1;e<=t;e++)r.push(e,e+1,0);this.setIndex(r),this.setAttribute("position",new qr(s,3)),this.setAttribute("normal",new qr(o,3)),this.setAttribute("uv",new qr(a,2))}}class hc extends rs{constructor(e=1,t=1,i=1,n=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;n=Math.floor(n),r=Math.floor(r);const c=[],h=[],u=[],d=[];let m=0;const p=[],f=i/2;let g=0;function v(i){const r=m,s=new Zi,p=new an;let v=0;const y=!0===i?e:t,_=!0===i?1:-1;for(let e=1;e<=n;e++)h.push(0,f*_,0),u.push(0,_,0),d.push(.5,.5),m++;const x=m;for(let e=0;e<=n;e++){const t=e/n*a+o,i=Math.cos(t),r=Math.sin(t);p.x=y*r,p.y=f*_,p.z=y*i,h.push(p.x,p.y,p.z),u.push(0,_,0),s.x=.5*i+.5,s.y=.5*r*_+.5,d.push(s.x,s.y),m++}for(let e=0;e<n;e++){const t=r+e,n=x+e;!0===i?c.push(n,n+1,t):c.push(n+1,n,t),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}!function(){const s=new an,v=new an;let y=0;const _=(t-e)/i;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=n;e++){const t=e/n,r=t*a+o,l=Math.sin(r),p=Math.cos(r);v.x=y*l,v.y=-g*i+f,v.z=y*p,h.push(v.x,v.y,v.z),s.set(l,_,p).normalize(),u.push(s.x,s.y,s.z),d.push(t,1-g),c.push(m++)}p.push(c)}for(let e=0;e<n;e++)for(let t=0;t<r;t++){const i=p[t][e],n=p[t+1][e],r=p[t+1][e+1],s=p[t][e+1];c.push(i,n,s),c.push(n,r,s),y+=6}l.addGroup(g,y,0),g+=y}(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new qr(h,3)),this.setAttribute("normal",new qr(u,3)),this.setAttribute("uv",new qr(d,2))}}class uc extends hc{constructor(e=1,t=1,i=8,n=1,r=!1,s=0,o=2*Math.PI){super(0,e,t,i,n,r,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:o}}}class dc extends rs{constructor(e,t,i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};const r=[],s=[];function o(e,t,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const o=e.clone().lerp(i,n/r),a=t.clone().lerp(i,n/r),l=r-n;for(let e=0;e<=l;e++)s[n][e]=0===e&&n===r?o:o.clone().lerp(a,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const i=Math.floor(t/2);t%2==0?(a(s[e][i+1]),a(s[e+1][i]),a(s[e][i])):(a(s[e][i+1]),a(s[e+1][i+1]),a(s[e+1][i]))}}function a(e){r.push(e.x,e.y,e.z)}function l(t,i){const n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function c(e,t,i,n){n<0&&1===e.x&&(s[t]=e.x-1),0===i.x&&0===i.z&&(s[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){const i=new an,n=new an,r=new an;for(let s=0;s<t.length;s+=3)l(t[s+0],i),l(t[s+1],n),l(t[s+2],r),o(i,n,r,e)}(n),function(e){const t=new an;for(let i=0;i<r.length;i+=3)t.x=r[i+0],t.y=r[i+1],t.z=r[i+2],t.normalize().multiplyScalar(e),r[i+0]=t.x,r[i+1]=t.y,r[i+2]=t.z}(i),function(){const e=new an;for(let i=0;i<r.length;i+=3){e.x=r[i+0],e.y=r[i+1],e.z=r[i+2];const n=h(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(n,1-o)}var t;(function(){const e=new an,t=new an,i=new an,n=new an,o=new Zi,a=new Zi,l=new Zi;for(let u=0,d=0;u<r.length;u+=9,d+=6){e.set(r[u+0],r[u+1],r[u+2]),t.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),n.copy(e).add(t).add(i).divideScalar(3);const m=h(n);c(o,d+0,e,m),c(a,d+2,t,m),c(l,d+4,i,m)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],i=s[e+2],n=s[e+4],r=Math.max(t,i,n),o=Math.min(t,i,n);r>.9&&o<.1&&(t<.2&&(s[e+0]+=1),i<.2&&(s[e+2]+=1),n<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new qr(r,3)),this.setAttribute("normal",new qr(r.slice(),3)),this.setAttribute("uv",new qr(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}}class mc extends dc{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}}const pc=new an,fc=new an,gc=new an,vc=new Tr;class yc extends rs{constructor(e,t){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0===e.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const i=Math.pow(10,4),n=Math.cos(Ni*t),r=e.getIndex(),s=e.getAttribute("position"),o=r?r.count:s.count,a=[0,0,0],l=["a","b","c"],c=new Array(3),h={},u=[];for(let e=0;e<o;e+=3){r?(a[0]=r.getX(e),a[1]=r.getX(e+1),a[2]=r.getX(e+2)):(a[0]=e,a[1]=e+1,a[2]=e+2);const{a:t,b:o,c:d}=vc;if(t.fromBufferAttribute(s,a[0]),o.fromBufferAttribute(s,a[1]),d.fromBufferAttribute(s,a[2]),vc.getNormal(gc),c[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,c[1]=`${Math.round(o.x*i)},${Math.round(o.y*i)},${Math.round(o.z*i)}`,c[2]=`${Math.round(d.x*i)},${Math.round(d.y*i)},${Math.round(d.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,i=c[e],r=c[t],s=vc[l[e]],o=vc[l[t]],d=`${i}_${r}`,m=`${r}_${i}`;m in h&&h[m]?(gc.dot(h[m].normal)<=n&&(u.push(s.x,s.y,s.z),u.push(o.x,o.y,o.z)),h[m]=null):d in h||(h[d]={index0:a[e],index1:a[t],normal:gc.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:i}=h[e];pc.fromBufferAttribute(s,t),fc.fromBufferAttribute(s,i),u.push(pc.x,pc.y,pc.z),u.push(fc.x,fc.y,fc.z)}this.setAttribute("position",new qr(u,3))}}const _c=function(e,t,i){i=i||2;const n=t&&t.length,r=n?t[0]*i:e.length;let s=xc(e,0,r,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,h,u,d,m;if(n&&(s=function(e,t,i,n){const r=[];let s,o,a,l,c;for(s=0,o=t.length;s<o;s++)a=t[s]*n,l=s<o-1?t[s+1]*n:e.length,c=xc(e,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(Rc(c));for(r.sort(Pc),s=0;s<r.length;s++)Ac(r[s],i),i=wc(i,i.next);return i}(e,t,s,i)),e.length>80*i){a=c=e[0],l=h=e[1];for(let t=i;t<r;t+=i)u=e[t],d=e[t+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);m=Math.max(c-a,h-l),m=0!==m?1/m:0}return bc(s,o,i,a,l,m),o};function xc(e,t,i,n,r){let s,o;if(r===function(e,t,i,n){let r=0;for(let s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}(e,t,i,n)>0)for(s=t;s<i;s+=n)o=zc(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=zc(s,e[s],e[s+1],o);return o&&Fc(o,o.next)&&(Gc(o),o=o.next),o}function wc(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!Fc(n,n.next)&&0!==Ic(n.prev,n,n.next))n=n.next;else{if(Gc(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function bc(e,t,i,n,r,s,o){if(!e)return;!o&&s&&function(e,t,i,n){let r=e;do{null===r.z&&(r.z=Lc(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ,n);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(e,n,r,s);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,s?Tc(e,n,r,s):Mc(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),Gc(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?bc(e=Sc(wc(e),t,i),t,i,n,r,s,2):2===o&&Ec(e,t,i,n,r,s):bc(wc(e),t,i,n,r,s,1);break}}function Mc(e){const t=e.prev,i=e,n=e.next;if(Ic(t,i,n)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(Dc(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Ic(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Tc(e,t,i,n){const r=e.prev,s=e,o=e.next;if(Ic(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,h=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=Lc(a,l,t,i,n),d=Lc(c,h,t,i,n);let m=e.prevZ,p=e.nextZ;for(;m&&m.z>=u&&p&&p.z<=d;){if(m!==e.prev&&m!==e.next&&Dc(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&Ic(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,p!==e.prev&&p!==e.next&&Dc(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Ic(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;m&&m.z>=u;){if(m!==e.prev&&m!==e.next&&Dc(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&Ic(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&Dc(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Ic(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Sc(e,t,i){let n=e;do{const r=n.prev,s=n.next.next;!Fc(r,s)&&Vc(r,n,n.next,s)&&Bc(r,s)&&Bc(s,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(s.i/i),Gc(n),Gc(n.next),n=e=s),n=n.next}while(n!==e);return wc(n)}function Ec(e,t,i,n,r,s){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&Oc(o,e)){let a=kc(o,e);return o=wc(o,o.next),a=wc(a,a.next),bc(o,t,i,n,r,s),void bc(a,t,i,n,r,s)}e=e.next}o=o.next}while(o!==e)}function Pc(e,t){return e.x-t.x}function Ac(e,t){if(t=function(e,t){let i=t;const n=e.x,r=e.y;let s,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const e=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>o){if(o=e,e===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(n===o)return s;const a=s,l=s.x,c=s.y;let h,u=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&Dc(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),Bc(i,e)&&(h<u||h===u&&(i.x>s.x||i.x===s.x&&Cc(s,i)))&&(s=i,u=h)),i=i.next}while(i!==a);return s}(e,t)){const i=kc(t,e);wc(t,t.next),wc(i,i.next)}}function Cc(e,t){return Ic(e.prev,e,t.prev)<0&&Ic(t.next,e,e.next)<0}function Lc(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Rc(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Dc(e,t,i,n,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function Oc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Vc(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Bc(e,t)&&Bc(t,e)&&function(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(Ic(e.prev,e,t.prev)||Ic(e,t.prev,t))||Fc(e,t)&&Ic(e.prev,e,e.next)>0&&Ic(t.prev,t,t.next)>0)}function Ic(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Fc(e,t){return e.x===t.x&&e.y===t.y}function Vc(e,t,i,n){const r=Nc(Ic(e,t,i)),s=Nc(Ic(e,t,n)),o=Nc(Ic(i,n,e)),a=Nc(Ic(i,n,t));return r!==s&&o!==a||(!(0!==r||!Uc(e,i,t))||(!(0!==s||!Uc(e,n,t))||(!(0!==o||!Uc(i,e,n))||!(0!==a||!Uc(i,t,n)))))}function Uc(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Nc(e){return e>0?1:e<0?-1:0}function Bc(e,t){return Ic(e.prev,e,e.next)<0?Ic(e,t,e.next)>=0&&Ic(e,e.prev,t)>=0:Ic(e,t,e.prev)<0||Ic(e,e.next,t)<0}function kc(e,t){const i=new jc(e.i,e.x,e.y),n=new jc(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function zc(e,t,i,n){const r=new jc(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Gc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jc(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Hc{static area(e){const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i}static isClockWise(e){return Hc.area(e)<0}static triangulateShape(e,t){const i=[],n=[],r=[];Wc(e),qc(i,e);let s=e.length;t.forEach(Wc);for(let e=0;e<t.length;e++)n.push(s),s+=t[e].length,qc(i,t[e]);const o=_c(i,n);for(let e=0;e<o.length;e+=3)r.push(o.slice(e,e+3));return r}}function Wc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function qc(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class Xc extends rs{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],r=[];for(let t=0,i=e.length;t<i;t++){s(e[t])}function s(e){const s=[],o=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,u=void 0!==t.bevelSize?t.bevelSize:h-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,m=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:Zc;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let g,v,y,_,x,w=!1;p&&(g=p.getSpacedPoints(a),w=!0,c=!1,v=p.computeFrenetFrames(a,!1),y=new an,_=new an,x=new an),c||(m=0,h=0,u=0,d=0);const b=e.extractPoints(o);let M=b.shape;const T=b.holes;if(!Hc.isClockWise(M)){M=M.reverse();for(let e=0,t=T.length;e<t;e++){const t=T[e];Hc.isClockWise(t)&&(T[e]=t.reverse())}}const S=Hc.triangulateShape(M,T),E=M;for(let e=0,t=T.length;e<t;e++){const t=T[e];M=M.concat(t)}function P(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}const A=M.length,C=S.length;function L(e,t,i){let n,r,s;const o=e.x-t.x,a=e.y-t.y,l=i.x-e.x,c=i.y-e.y,h=o*o+a*a,u=o*c-a*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),m=t.x-a/u,p=t.y+o/u,f=((i.x-c/d-m)*c-(i.y+l/d-p)*l)/(o*c-a*l);n=m+o*f-e.x,r=p+a*f-e.y;const g=n*n+r*r;if(g<=2)return new Zi(n,r);s=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(n=-a,r=o,s=Math.sqrt(h)):(n=o,r=a,s=Math.sqrt(h/2))}return new Zi(n/s,r/s)}const R=[];for(let e=0,t=E.length,i=t-1,n=e+1;e<t;e++,i++,n++)i===t&&(i=0),n===t&&(n=0),R[e]=L(E[e],E[i],E[n]);const D=[];let O,I=R.concat();for(let e=0,t=T.length;e<t;e++){const t=T[e];O=[];for(let e=0,i=t.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),O[e]=L(t[e],t[n],t[r]);D.push(O),I=I.concat(O)}for(let e=0;e<m;e++){const t=e/m,i=h*Math.cos(t*Math.PI/2),n=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=P(E[e],R[e],n);U(t.x,t.y,-i)}for(let e=0,t=T.length;e<t;e++){const t=T[e];O=D[e];for(let e=0,r=t.length;e<r;e++){const r=P(t[e],O[e],n);U(r.x,r.y,-i)}}}const F=u+d;for(let e=0;e<A;e++){const t=c?P(M[e],I[e],F):M[e];w?(_.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(_).add(y),U(x.x,x.y,x.z)):U(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<A;t++){const i=c?P(M[t],I[t],F):M[t];w?(_.copy(v.normals[e]).multiplyScalar(i.x),y.copy(v.binormals[e]).multiplyScalar(i.y),x.copy(g[e]).add(_).add(y),U(x.x,x.y,x.z)):U(i.x,i.y,l/a*e)}for(let e=m-1;e>=0;e--){const t=e/m,i=h*Math.cos(t*Math.PI/2),n=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=P(E[e],R[e],n);U(t.x,t.y,l+i)}for(let e=0,t=T.length;e<t;e++){const t=T[e];O=D[e];for(let e=0,r=t.length;e<r;e++){const r=P(t[e],O[e],n);w?U(r.x,r.y+g[a-1].y,g[a-1].x+i):U(r.x,r.y,l+i)}}}function V(e,t){let i=e.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=e.length-1);for(let e=0,i=a+2*m;e<i;e++){const i=A*e,s=A*(e+1);B(t+n+i,t+r+i,t+r+s,t+n+s)}}}function U(e,t,i){s.push(e),s.push(t),s.push(i)}function N(e,t,r){k(e),k(t),k(r);const s=n.length/3,o=f.generateTopUV(i,n,s-3,s-2,s-1);z(o[0]),z(o[1]),z(o[2])}function B(e,t,r,s){k(e),k(t),k(s),k(t),k(r),k(s);const o=n.length/3,a=f.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);z(a[0]),z(a[1]),z(a[3]),z(a[1]),z(a[2]),z(a[3])}function k(e){n.push(s[3*e+0]),n.push(s[3*e+1]),n.push(s[3*e+2])}function z(e){r.push(e.x),r.push(e.y)}!function(){const e=n.length/3;if(c){let e=0,t=A*e;for(let e=0;e<C;e++){const i=S[e];N(i[2]+t,i[1]+t,i[0]+t)}e=a+2*m,t=A*e;for(let e=0;e<C;e++){const i=S[e];N(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<C;e++){const t=S[e];N(t[2],t[1],t[0])}for(let e=0;e<C;e++){const t=S[e];N(t[0]+A*a,t[1]+A*a,t[2]+A*a)}}i.addGroup(e,n.length/3-e,0)}(),function(){const e=n.length/3;let t=0;V(E,t),t+=E.length;for(let e=0,i=T.length;e<i;e++){const i=T[e];V(i,t),t+=i.length}i.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new qr(n,3)),this.setAttribute("uv",new qr(r,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){const n=e[t];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,e)}}const Zc={generateTopUV:function(e,t,i,n,r){const s=t[3*i],o=t[3*i+1],a=t[3*n],l=t[3*n+1],c=t[3*r],h=t[3*r+1];return[new Zi(s,o),new Zi(a,l),new Zi(c,h)]},generateSideWallUV:function(e,t,i,n,r,s){const o=t[3*i],a=t[3*i+1],l=t[3*i+2],c=t[3*n],h=t[3*n+1],u=t[3*n+2],d=t[3*r],m=t[3*r+1],p=t[3*r+2],f=t[3*s],g=t[3*s+1],v=t[3*s+2];return Math.abs(a-h)<Math.abs(o-c)?[new Zi(o,1-l),new Zi(c,1-u),new Zi(d,1-p),new Zi(f,1-v)]:[new Zi(a,1-l),new Zi(h,1-u),new Zi(m,1-p),new Zi(g,1-v)]}};class Kc extends dc{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}}class Yc extends rs{constructor(e,t=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=zi(n,0,2*Math.PI);const r=[],s=[],o=[],a=1/t,l=new an,c=new Zi;for(let r=0;r<=t;r++){const h=i+r*a*n,u=Math.sin(h),d=Math.cos(h);for(let i=0;i<=e.length-1;i++)l.x=e[i].x*u,l.y=e[i].y,l.z=e[i].x*d,s.push(l.x,l.y,l.z),c.x=r/t,c.y=i/(e.length-1),o.push(c.x,c.y)}for(let i=0;i<t;i++)for(let t=0;t<e.length-1;t++){const n=t+i*e.length,s=n,o=n+e.length,a=n+e.length+1,l=n+1;r.push(s,o,l),r.push(o,a,l)}if(this.setIndex(r),this.setAttribute("position",new qr(s,3)),this.setAttribute("uv",new qr(o,2)),this.computeVertexNormals(),n===2*Math.PI){const i=this.attributes.normal.array,n=new an,r=new an,s=new an,o=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)n.x=i[a+0],n.y=i[a+1],n.z=i[a+2],r.x=i[o+a+0],r.y=i[o+a+1],r.z=i[o+a+2],s.addVectors(n,r).normalize(),i[a+0]=i[o+a+0]=s.x,i[a+1]=i[o+a+1]=s.y,i[a+2]=i[o+a+2]=s.z}}}class $c extends dc{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}}class Jc extends rs{constructor(e,t,i){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i};const n=[],r=[],s=[],o=[],a=1e-5,l=new an,c=new an,h=new an,u=new an,d=new an;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const m=t+1;for(let n=0;n<=i;n++){const m=n/i;for(let i=0;i<=t;i++){const n=i/t;e(n,m,c),r.push(c.x,c.y,c.z),n-a>=0?(e(n-a,m,h),u.subVectors(c,h)):(e(n+a,m,h),u.subVectors(h,c)),m-a>=0?(e(n,m-a,h),d.subVectors(c,h)):(e(n,m+a,h),d.subVectors(h,c)),l.crossVectors(u,d).normalize(),s.push(l.x,l.y,l.z),o.push(n,m)}}for(let e=0;e<i;e++)for(let i=0;i<t;i++){const t=e*m+i,r=e*m+i+1,s=(e+1)*m+i+1,o=(e+1)*m+i;n.push(t,r,o),n.push(r,s,o)}this.setIndex(n),this.setAttribute("position",new qr(r,3)),this.setAttribute("normal",new qr(s,3)),this.setAttribute("uv",new qr(o,2))}}class Qc extends rs{constructor(e=.5,t=1,i=8,n=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},i=Math.max(3,i);const o=[],a=[],l=[],c=[];let h=e;const u=(t-e)/(n=Math.max(1,n)),d=new an,m=new Zi;for(let e=0;e<=n;e++){for(let e=0;e<=i;e++){const n=r+e/i*s;d.x=h*Math.cos(n),d.y=h*Math.sin(n),a.push(d.x,d.y,d.z),l.push(0,0,1),m.x=(d.x/t+1)/2,m.y=(d.y/t+1)/2,c.push(m.x,m.y)}h+=u}for(let e=0;e<n;e++){const t=e*(i+1);for(let e=0;e<i;e++){const n=e+t,r=n,s=n+i+1,a=n+i+2,l=n+1;o.push(r,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new qr(a,3)),this.setAttribute("normal",new qr(l,3)),this.setAttribute("uv",new qr(c,2))}}class eh extends rs{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(o,a,t),o+=a,a=0;function l(e){const o=n.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===Hc.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){const t=h[e];!0===Hc.isClockWise(t)&&(h[e]=t.reverse())}const u=Hc.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){const t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];n.push(t.x,t.y,0),r.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){const t=u[e],n=t[0]+o,r=t[1]+o,s=t[2]+o;i.push(n,r,s),a+=3}}this.setIndex(i),this.setAttribute("position",new qr(n,3)),this.setAttribute("normal",new qr(r,3)),this.setAttribute("uv",new qr(s,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class th extends rs{constructor(e=1,t=8,i=6,n=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const a=Math.min(s+o,Math.PI);let l=0;const c=[],h=new an,u=new an,d=[],m=[],p=[],f=[];for(let d=0;d<=i;d++){const g=[],v=d/i;let y=0;0==d&&0==s?y=.5/t:d==i&&a==Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){const a=i/t;h.x=-e*Math.cos(n+a*r)*Math.sin(s+v*o),h.y=e*Math.cos(s+v*o),h.z=e*Math.sin(n+a*r)*Math.sin(s+v*o),m.push(h.x,h.y,h.z),u.copy(h).normalize(),p.push(u.x,u.y,u.z),f.push(a+y,1-v),g.push(l++)}c.push(g)}for(let e=0;e<i;e++)for(let n=0;n<t;n++){const t=c[e][n+1],r=c[e][n],o=c[e+1][n],l=c[e+1][n+1];(0!==e||s>0)&&d.push(t,r,l),(e!==i-1||a<Math.PI)&&d.push(r,o,l)}this.setIndex(d),this.setAttribute("position",new qr(m,3)),this.setAttribute("normal",new qr(p,3)),this.setAttribute("uv",new qr(f,2))}}class ih extends dc{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}}class nh extends Xc{constructor(e,t={}){const i=t.font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new rs;const n=i.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(n,t),this.type="TextGeometry"}}class rh extends rs{constructor(e=1,t=.4,i=8,n=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],o=[],a=[],l=[],c=new an,h=new an,u=new an;for(let s=0;s<=i;s++)for(let d=0;d<=n;d++){const m=d/n*r,p=s/i*Math.PI*2;h.x=(e+t*Math.cos(p))*Math.cos(m),h.y=(e+t*Math.cos(p))*Math.sin(m),h.z=t*Math.sin(p),o.push(h.x,h.y,h.z),c.x=e*Math.cos(m),c.y=e*Math.sin(m),u.subVectors(h,c).normalize(),a.push(u.x,u.y,u.z),l.push(d/n),l.push(s/i)}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*e+t-1,r=(n+1)*(e-1)+t-1,o=(n+1)*(e-1)+t,a=(n+1)*e+t;s.push(i,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new qr(o,3)),this.setAttribute("normal",new qr(a,3)),this.setAttribute("uv",new qr(l,2))}}class sh extends rs{constructor(e=1,t=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],l=[],c=[],h=new an,u=new an,d=new an,m=new an,p=new an,f=new an,g=new an;for(let o=0;o<=i;++o){const y=o/i*r*Math.PI*2;v(y,r,s,e,d),v(y+.01,r,s,e,m),f.subVectors(m,d),g.addVectors(m,d),p.crossVectors(f,g),g.crossVectors(p,f),p.normalize(),g.normalize();for(let e=0;e<=n;++e){const r=e/n*Math.PI*2,s=-t*Math.cos(r),m=t*Math.sin(r);h.x=d.x+(s*g.x+m*p.x),h.y=d.y+(s*g.y+m*p.y),h.z=d.z+(s*g.z+m*p.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(o/i),c.push(e/n)}}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),r=(n+1)*e+(t-1),s=(n+1)*e+t,a=(n+1)*(e-1)+t;o.push(i,r,a),o.push(r,s,a)}function v(e,t,i,n,r){const s=Math.cos(e),o=Math.sin(e),a=i/t*e,l=Math.cos(a);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*o*.5,r.z=n*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new qr(a,3)),this.setAttribute("normal",new qr(l,3)),this.setAttribute("uv",new qr(c,2))}}class oh extends rs{constructor(e,t=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r};const s=e.computeFrenetFrames(t,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new an,a=new an,l=new Zi;let c=new an;const h=[],u=[],d=[],m=[];function p(r){c=e.getPointAt(r/t,c);const l=s.normals[r],d=s.binormals[r];for(let e=0;e<=n;e++){const t=e/n*Math.PI*2,r=Math.sin(t),s=-Math.cos(t);a.x=s*l.x+r*d.x,a.y=s*l.y+r*d.y,a.z=s*l.z+r*d.z,a.normalize(),u.push(a.x,a.y,a.z),o.x=c.x+i*a.x,o.y=c.y+i*a.y,o.z=c.z+i*a.z,h.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let i=0;i<=n;i++)l.x=e/t,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),r=(n+1)*e+(t-1),s=(n+1)*e+t,o=(n+1)*(e-1)+t;m.push(i,r,o),m.push(r,s,o)}}()}(),this.setIndex(m),this.setAttribute("position",new qr(h,3)),this.setAttribute("normal",new qr(u,3)),this.setAttribute("uv",new qr(d,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}}class ah extends rs{constructor(e){if(super(),this.type="WireframeGeometry",!0===e.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const t=[],i=[0,0],n={},r=new an;if(null!==e.index){const s=e.attributes.position,o=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,t=a.length;e<t;++e){const t=a[e],r=t.start;for(let e=r,s=r+t.count;e<s;e+=3)for(let t=0;t<3;t++){const r=o.getX(e+t),s=o.getX(e+(t+1)%3);i[0]=Math.min(r,s),i[1]=Math.max(r,s);const a=i[0]+","+i[1];void 0===n[a]&&(n[a]={index1:i[0],index2:i[1]})}}for(const e in n){const i=n[e];r.fromBufferAttribute(s,i.index1),t.push(r.x,r.y,r.z),r.fromBufferAttribute(s,i.index2),t.push(r.x,r.y,r.z)}}else{const i=e.attributes.position;for(let e=0,n=i.count/3;e<n;e++)for(let n=0;n<3;n++){const s=3*e+n;r.fromBufferAttribute(i,s),t.push(r.x,r.y,r.z);const o=3*e+(n+1)%3;r.fromBufferAttribute(i,o),t.push(r.x,r.y,r.z)}}this.setAttribute("position",new qr(t,3))}}var lh=Object.freeze({__proto__:null,BoxGeometry:Ts,BoxBufferGeometry:Ts,CircleGeometry:cc,CircleBufferGeometry:cc,ConeGeometry:uc,ConeBufferGeometry:uc,CylinderGeometry:hc,CylinderBufferGeometry:hc,DodecahedronGeometry:mc,DodecahedronBufferGeometry:mc,EdgesGeometry:yc,ExtrudeGeometry:Xc,ExtrudeBufferGeometry:Xc,IcosahedronGeometry:Kc,IcosahedronBufferGeometry:Kc,LatheGeometry:Yc,LatheBufferGeometry:Yc,OctahedronGeometry:$c,OctahedronBufferGeometry:$c,ParametricGeometry:Jc,ParametricBufferGeometry:Jc,PlaneGeometry:Bs,PlaneBufferGeometry:Bs,PolyhedronGeometry:dc,PolyhedronBufferGeometry:dc,RingGeometry:Qc,RingBufferGeometry:Qc,ShapeGeometry:eh,ShapeBufferGeometry:eh,SphereGeometry:th,SphereBufferGeometry:th,TetrahedronGeometry:ih,TetrahedronBufferGeometry:ih,TextGeometry:nh,TextBufferGeometry:nh,TorusGeometry:rh,TorusBufferGeometry:rh,TorusKnotGeometry:sh,TorusKnotBufferGeometry:sh,TubeGeometry:oh,TubeBufferGeometry:oh,WireframeGeometry:ah});class ch extends Er{constructor(e){super(),this.type="ShadowMaterial",this.color=new Or(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}ch.prototype.isShadowMaterial=!0;class hh extends As{constructor(e){super(e),this.type="RawShaderMaterial"}}hh.prototype.isRawShaderMaterial=!0;class uh extends Er{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Or(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}}uh.prototype.isMeshStandardMaterial=!0;class dh extends uh{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Zi(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=zi(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Or(1,1,1),this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Or).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this}}dh.prototype.isMeshPhysicalMaterial=!0;class mh extends Er{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Or(16777215),this.specular=new Or(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=K,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}mh.prototype.isMeshPhongMaterial=!0;class ph extends Er{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Or(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}ph.prototype.isMeshToonMaterial=!0;class fh extends Er{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}fh.prototype.isMeshNormalMaterial=!0;class gh extends Er{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Or(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=K,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}gh.prototype.isMeshLambertMaterial=!0;class vh extends Er{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Or(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}vh.prototype.isMeshMatcapMaterial=!0;class yh extends zl{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}yh.prototype.isLineDashedMaterial=!0;var _h=Object.freeze({__proto__:null,ShadowMaterial:ch,SpriteMaterial:ol,RawShaderMaterial:hh,ShaderMaterial:As,PointsMaterial:Jl,MeshPhysicalMaterial:dh,MeshStandardMaterial:uh,MeshPhongMaterial:mh,MeshToonMaterial:ph,MeshNormalMaterial:fh,MeshLambertMaterial:gh,MeshDepthMaterial:ka,MeshDistanceMaterial:za,MeshBasicMaterial:Ir,MeshMatcapMaterial:vh,LineDashedMaterial:yh,LineBasicMaterial:zl,Material:Er});const xh={arraySlice:function(e,t,i){return xh.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){const n=e.length,r=new e.constructor(n);for(let s=0,o=0;o!==n;++s){const n=i[s]*t;for(let i=0;i!==t;++i)r[o++]=e[n+i]}return r},flattenJSON:function(e,t,i,n){let r=1,s=e[0];for(;void 0!==s&&void 0===s[n];)s=e[r++];if(void 0===s)return;let o=s[n];if(void 0!==o)if(Array.isArray(o))do{o=s[n],void 0!==o&&(t.push(s.time),i.push.apply(i,o)),s=e[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[n],void 0!==o&&(t.push(s.time),o.toArray(i,i.length)),s=e[r++]}while(void 0!==s);else do{o=s[n],void 0!==o&&(t.push(s.time),i.push(o)),s=e[r++]}while(void 0!==s)},subclip:function(e,t,i,n,r=30){const s=e.clone();s.name=t;const o=[];for(let e=0;e<s.tracks.length;++e){const t=s.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const s=t.times[e]*r;if(!(s<i||s>=n)){l.push(t.times[e]);for(let i=0;i<a;++i)c.push(t.values[e*a+i])}}0!==l.length&&(t.times=xh.convertArray(l,t.times.constructor),t.values=xh.convertArray(c,t.values.constructor),o.push(t))}s.tracks=o;let a=1/0;for(let e=0;e<s.tracks.length;++e)a>s.tracks[e].times[0]&&(a=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,i=e,n=30){n<=0&&(n=30);const r=i.tracks.length,s=t/n;for(let t=0;t<r;++t){const n=i.tracks[t],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const o=e.tracks.find((function(e){return e.name===n.name&&e.ValueTypeName===r}));if(void 0===o)continue;let a=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const e=a,t=l-a;d=xh.arraySlice(n.values,e,t)}else if(s>=n.times[u]){const e=u*l+a,t=e+l-a;d=xh.arraySlice(n.values,e,t)}else{const e=n.createInterpolant(),t=a,i=l-a;e.evaluate(s),d=xh.arraySlice(e.resultBuffer,t,i)}if("quaternion"===r){(new on).fromArray(d).normalize().conjugate().toArray(d)}const m=o.times.length;for(let e=0;e<m;++e){const t=e*h+c;if("quaternion"===r)on.multiplyQuaternionsFlat(o.values,t,d,0,o.values,t);else{const e=h-2*c;for(let i=0;i<e;++i)o.values[t+i]-=d[i]}}}return e.blendMode=qt,e}};class wh{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let s;i:{n:if(!(e<n)){for(let s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,r)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}s=t.length;break i}if(e>=r)break e;{const o=t[1];e<o&&(i=2,r=o);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===s)break;if(n=r,r=t[--i-1],e>=r)break t}s=i,i=0}}for(;i<s;){const n=i+s>>>1;e<t[n]?s=n:i=n+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,r,e)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let e=0;e!==n;++e)t[e]=i[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}wh.prototype.beforeStart_=wh.prototype.copySampleValue_,wh.prototype.afterEnd_=wh.prototype.copySampleValue_;class bh extends wh{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Gt,endingEnd:Gt}}intervalChanged_(e,t,i){const n=this.parameterPositions;let r=e-2,s=e+1,o=n[r],a=n[s];if(void 0===o)switch(this.getSettings_().endingStart){case jt:r=e,o=2*t-i;break;case Ht:r=n.length-2,o=t+n[r]-n[r+1];break;default:r=e,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case jt:s=e,a=2*i-t;break;case Ht:s=1,a=i+n[1]-n[0];break;default:s=e-1,a=t}const l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,m=(i-t)/(n-t),p=m*m,f=p*m,g=-u*f+2*u*p-u*m,v=(1+u)*f+(-1.5-2*u)*p+(-.5+u)*m+1,y=(-1-d)*f+(1.5+d)*p+.5*m,_=d*f-d*p;for(let e=0;e!==o;++e)r[e]=g*s[c+e]+v*s[l+e]+y*s[a+e]+_*s[h+e];return r}}class Mh extends wh{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(i-t)/(n-t),h=1-c;for(let e=0;e!==o;++e)r[e]=s[l+e]*h+s[a+e]*c;return r}}class Th extends wh{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class Sh{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=xh.convertArray(t,this.TimeBufferType),this.values=xh.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:xh.convertArray(e.times,Array),values:xh.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Th(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Mh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new bh(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Bt:t=this.InterpolantFactoryMethodDiscrete;break;case kt:t=this.InterpolantFactoryMethodLinear;break;case zt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Bt;case this.InterpolantFactoryMethodLinear:return kt;case this.InterpolantFactoryMethodSmooth:return zt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==s&&i[s]>t;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=xh.arraySlice(i,r,s),this.values=xh.arraySlice(this.values,r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==r;t++){const n=i[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,s),e=!1;break}s=n}if(void 0!==n&&xh.isTypedArray(n))for(let t=0,i=n.length;t!==i;++t){const i=n[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e}optimize(){const e=xh.arraySlice(this.times),t=xh.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===zt,r=e.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(n)r=!0;else{const e=o*i,n=e-i,s=e+i;for(let o=0;o!==i;++o){const i=t[e+o];if(i!==t[n+o]||i!==t[s+o]){r=!0;break}}}if(r){if(o!==s){e[s]=e[o];const n=o*i,r=s*i;for(let e=0;e!==i;++e)t[r+e]=t[n+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*i,n=s*i,o=0;o!==i;++o)t[n+o]=t[e+o];++s}return s!==e.length?(this.times=xh.arraySlice(e,0,s),this.values=xh.arraySlice(t,0,s*i)):(this.times=e,this.values=t),this}clone(){const e=xh.arraySlice(this.times,0),t=xh.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Sh.prototype.TimeBufferType=Float32Array,Sh.prototype.ValueBufferType=Float32Array,Sh.prototype.DefaultInterpolation=kt;class Eh extends Sh{}Eh.prototype.ValueTypeName="bool",Eh.prototype.ValueBufferType=Array,Eh.prototype.DefaultInterpolation=Bt,Eh.prototype.InterpolantFactoryMethodLinear=void 0,Eh.prototype.InterpolantFactoryMethodSmooth=void 0;class Ph extends Sh{}Ph.prototype.ValueTypeName="color";class Ah extends Sh{}Ah.prototype.ValueTypeName="number";class Ch extends wh{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-t)/(n-t);let l=e*o;for(let e=l+o;l!==e;l+=4)on.slerpFlat(r,0,s,l-o,s,l,a);return r}}class Lh extends Sh{InterpolantFactoryMethodLinear(e){return new Ch(this.times,this.values,this.getValueSize(),e)}}Lh.prototype.ValueTypeName="quaternion",Lh.prototype.DefaultInterpolation=kt,Lh.prototype.InterpolantFactoryMethodSmooth=void 0;class Rh extends Sh{}Rh.prototype.ValueTypeName="string",Rh.prototype.ValueBufferType=Array,Rh.prototype.DefaultInterpolation=Bt,Rh.prototype.InterpolantFactoryMethodLinear=void 0,Rh.prototype.InterpolantFactoryMethodSmooth=void 0;class Dh extends Sh{}Dh.prototype.ValueTypeName="vector";class Oh{constructor(e,t=-1,i,n=Wt){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=ki(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,r=i.length;e!==r;++e)t.push(Ih(i[e]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=i.length;e!==n;++e)t.push(Sh.toJSON(i[e]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const r=t.length,s=[];for(let e=0;e<r;e++){let o=[],a=[];o.push((e+r-1)%r,e,(e+1)%r),a.push(0,1,0);const l=xh.getKeyframeOrder(o);o=xh.sortedArray(o,1,l),a=xh.sortedArray(a,1,l),n||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new Ah(".morphTargetInfluences["+t[e].name+"]",o,a).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.name.match(r);if(s&&s.length>1){const e=s[1];let t=n[e];t||(n[e]=t=[]),t.push(i)}}const s=[];for(const e in n)s.push(this.CreateFromMorphTargetSequence(e,n[e],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,n,r){if(0!==i.length){const s=[],o=[];xh.flattenJSON(i,s,o,n),0!==s.length&&r.push(new e(t,s,o))}},n=[],r=e.name||"default",s=e.fps||30,o=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let i=0;i<r[t].morphTargets.length;i++)e[r[t].morphTargets[i]]=-1;for(const i in e){const e=[],s=[];for(let n=0;n!==r[t].morphTargets.length;++n){const n=r[t];e.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new Ah(".morphTargetInfluence["+i+"]",e,s))}a=e.length*(s||1)}else{const s=".bones["+t[e].name+"]";i(Dh,s+".position",r,"pos",n),i(Lh,s+".quaternion",r,"rot",n),i(Dh,s+".scale",r,"scl",n)}}if(0===n.length)return null;return new this(r,a,n,o)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Ih(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ah;case"vector":case"vector2":case"vector3":case"vector4":return Dh;case"color":return Ph;case"quaternion":return Lh;case"bool":case"boolean":return Eh;case"string":return Rh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];xh.flattenJSON(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Fh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Vh{constructor(e,t,i){const n=this;let r=!1,s=0,o=0,a=void 0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++,!1===r&&void 0!==n.onStart&&n.onStart(e,s,o),r=!0},this.itemEnd=function(e){s++,void 0!==n.onProgress&&n.onProgress(e,s,o),s===o&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}}const Uh=new Vh;class Nh{constructor(e){this.manager=void 0!==e?e:Uh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise((function(n,r){i.load(e,n,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Bh={};class kh extends Nh{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Fh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;if(void 0!==Bh[e])return void Bh[e].push({onLoad:t,onProgress:i,onError:n});const o=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(o){const i=o[1],s=!!o[2];let a=o[3];a=decodeURIComponent(a),s&&(a=atob(a));try{let n;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);n="blob"===s?new Blob([e.buffer],{type:i}):e.buffer;break;case"document":const t=new DOMParser;n=t.parseFromString(a,i);break;case"json":n=JSON.parse(a);break;default:n=a}setTimeout((function(){t&&t(n),r.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{Bh[e]=[],Bh[e].push({onLoad:t,onProgress:i,onError:n}),a=new XMLHttpRequest,a.open("GET",e,!0),a.addEventListener("load",(function(t){const i=this.response,n=Bh[e];if(delete Bh[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Fh.add(e,i);for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onLoad&&t.onLoad(i)}r.manager.itemEnd(e)}else{for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}}),!1),a.addEventListener("progress",(function(t){const i=Bh[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onProgress&&n.onProgress(t)}}),!1),a.addEventListener("error",(function(t){const i=Bh[e];delete Bh[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),a.addEventListener("abort",(function(t){const i=Bh[e];delete Bh[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return r.manager.itemStart(e),a}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class zh extends Nh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new kh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}parse(e){const t=[];for(let i=0;i<e.length;i++){const n=Oh.parse(e[i]);t.push(n)}return t}}class Gh extends Nh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=[],o=new oc,a=new kh(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const i=r.parse(e,!0);s[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(o.minFilter=_e),o.image=s,o.format=i.format,o.needsUpdate=!0,t&&t(o))}),i,n)}if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)c(t);else a.load(e,(function(e){const i=r.parse(e,!0);if(i.isCubemap){const e=i.mipmaps.length/i.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<i.mipmapCount;e++)s[t].mipmaps.push(i.mipmaps[t*i.mipmapCount+e]),s[t].format=i.format,s[t].width=i.width,s[t].height=i.height}o.image=s}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=_e),o.format=i.format,o.needsUpdate=!0,t&&t(o)}),i,n);return o}}class jh extends Nh{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Fh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),Fh.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}class Hh extends Nh{constructor(e){super(e)}load(e,t,i,n){const r=new Ds,s=new jh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(i){s.load(e[i],(function(e){r.images[i]=e,o++,6===o&&(r.needsUpdate=!0,t&&t(r))}),void 0,n)}for(let t=0;t<e.length;++t)a(t);return r}}class Wh extends Nh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new Dl,o=new kh(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,(function(e){const i=r.parse(e);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:de,s.wrapT=void 0!==i.wrapT?i.wrapT:de,s.magFilter=void 0!==i.magFilter?i.magFilter:_e,s.minFilter=void 0!==i.minFilter?i.minFilter:_e,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(s.encoding=i.encoding),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=be),1===i.mipmapCount&&(s.minFilter=_e),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,t&&t(s,i))}),i,n),s}}class qh extends Nh{constructor(e){super(e)}load(e,t,i,n){const r=new Qi,s=new jh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(i){r.image=i;const n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=n?Ue:Ne,r.needsUpdate=!0,void 0!==t&&t(r)}),i,n),r}}class Xh{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const r=i.length;let s;s=t||e*i[r-1];let o,a=0,l=r-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),o=i[n]-s,o<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(e,t){let i=e-1e-4,n=e+1e-4;i<0&&(i=0),n>1&&(n=1);const r=this.getPoint(i),s=this.getPoint(n),o=t||(r.isVector2?new Zi:new an);return o.copy(s).sub(r).normalize(),o}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new an,n=[],r=[],s=[],o=new an,a=new Nn;for(let t=0;t<=e;t++){const i=t/e;n[t]=this.getTangentAt(i,new an),n[t].normalize()}r[0]=new an,s[0]=new an;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],o),s[0].crossVectors(n[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),s[t]=s[t-1].clone(),o.crossVectors(n[t-1],n[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(zi(n[t-1].dot(n[t]),-1,1));r[t].applyMatrix4(a.makeRotationAxis(o,e))}s[t].crossVectors(n[t],r[t])}if(!0===t){let t=Math.acos(zi(r[0].dot(r[e]),-1,1));t/=e,n[0].dot(o.crossVectors(r[0],r[e]))>0&&(t=-t);for(let i=1;i<=e;i++)r[i].applyMatrix4(a.makeRotationAxis(n[i],t*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Zh extends Xh{constructor(e=0,t=0,i=1,n=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const i=t||new Zi,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const o=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Zh.prototype.isEllipseCurve=!0;class Kh extends Zh{constructor(e,t,i,n,r,s){super(e,t,i,i,n,r,s),this.type="ArcCurve"}}function Yh(){let e=0,t=0,i=0,n=0;function r(r,s,o,a){e=r,t=o,i=-3*r+3*s-2*o-a,n=2*r-2*s+o+a}return{initCatmullRom:function(e,t,i,n,s){r(t,i,s*(i-e),s*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,s,o,a){let l=(t-e)/s-(i-e)/(s+o)+(i-t)/o,c=(i-t)/o-(n-t)/(o+a)+(n-i)/a;l*=o,c*=o,r(t,i,l,c)},calc:function(r){const s=r*r;return e+t*r+i*s+n*(s*r)}}}Kh.prototype.isArcCurve=!0;const $h=new an,Jh=new Yh,Qh=new Yh,eu=new Yh;class tu extends Xh{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new an){const i=t,n=this.points,r=n.length,s=(r-(this.closed?0:1))*e;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=n[(l-1)%r]:($h.subVectors(n[0],n[1]).add(n[0]),o=$h);const h=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?a=n[(l+2)%r]:($h.subVectors(n[r-1],n[r-2]).add(n[r-1]),a=$h),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(a),e);i<1e-4&&(i=1),t<1e-4&&(t=i),n<1e-4&&(n=i),Jh.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,t,i,n),Qh.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,t,i,n),eu.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,t,i,n)}else"catmullrom"===this.curveType&&(Jh.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),Qh.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),eu.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return i.set(Jh.calc(c),Qh.calc(c),eu.calc(c)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new an).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function iu(e,t,i,n,r){const s=.5*(n-t),o=.5*(r-i),a=e*e;return(2*i-2*n+s+o)*(e*a)+(-3*i+3*n-2*s-o)*a+s*e+i}function nu(e,t,i,n){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function ru(e,t,i,n,r){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,r)}tu.prototype.isCatmullRomCurve3=!0;class su extends Xh{constructor(e=new Zi,t=new Zi,i=new Zi,n=new Zi){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new Zi){const i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(ru(e,n.x,r.x,s.x,o.x),ru(e,n.y,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}su.prototype.isCubicBezierCurve=!0;class ou extends Xh{constructor(e=new an,t=new an,i=new an,n=new an){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new an){const i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(ru(e,n.x,r.x,s.x,o.x),ru(e,n.y,r.y,s.y,o.y),ru(e,n.z,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}ou.prototype.isCubicBezierCurve3=!0;class au extends Xh{constructor(e=new Zi,t=new Zi){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Zi){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new Zi;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}au.prototype.isLineCurve=!0;class lu extends Xh{constructor(e=new an,t=new an){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new an){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class cu extends Xh{constructor(e=new Zi,t=new Zi,i=new Zi){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Zi){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(nu(e,n.x,r.x,s.x),nu(e,n.y,r.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}cu.prototype.isQuadraticBezierCurve=!0;class hu extends Xh{constructor(e=new an,t=new an,i=new an){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new an){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(nu(e,n.x,r.x,s.x),nu(e,n.y,r.y,s.y),nu(e,n.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}hu.prototype.isQuadraticBezierCurve3=!0;class uu extends Xh{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Zi){const i=t,n=this.points,r=(n.length-1)*e,s=Math.floor(r),o=r-s,a=n[0===s?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(iu(o,a.x,l.x,c.x,h.x),iu(o,a.y,l.y,c.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Zi).fromArray(i))}return this}}uu.prototype.isSplineCurve=!0;var du=Object.freeze({__proto__:null,ArcCurve:Kh,CatmullRomCurve3:tu,CubicBezierCurve:su,CubicBezierCurve3:ou,EllipseCurve:Zh,LineCurve:au,LineCurve3:lu,QuadraticBezierCurve:cu,QuadraticBezierCurve3:hu,SplineCurve:uu});class mu extends Xh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new au(t,e))}getPoint(e){const t=e*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=t){const e=i[n]-t,r=this.curves[n],s=r.getLength(),o=0===s?0:1-e/s;return r.getPointAt(o)}n++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],o=s&&s.isEllipseCurve?2*e:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let e=0;e<a.length;e++){const n=a[e];i&&i.equals(n)||(t.push(n),i=n)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new du[i.type]).fromJSON(i))}return this}}class pu extends mu{constructor(e){super(),this.type="Path",this.currentPoint=new Zi,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new au(this.currentPoint.clone(),new Zi(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const r=new cu(this.currentPoint.clone(),new Zi(e,t),new Zi(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,s){const o=new su(this.currentPoint.clone(),new Zi(e,t),new Zi(i,n),new Zi(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new uu(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,i,n,r,s),this}absarc(e,t,i,n,r,s){return this.absellipse(e,t,i,i,n,r,s),this}ellipse(e,t,i,n,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,r,s,o,a),this}absellipse(e,t,i,n,r,s,o,a){const l=new Zh(e,t,i,n,r,s,o,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class fu extends pu{constructor(e){super(e),this.uuid=ki(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new pu).fromJSON(i))}return this}}class gu extends cr{constructor(e,t=1){super(),this.type="Light",this.color=new Or(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}gu.prototype.isLight=!0;class vu extends gu{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.groundColor=new Or(t)}copy(e){return gu.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}vu.prototype.isHemisphereLight=!0;const yu=new Nn,_u=new an,xu=new an;class wu{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Zi(512,512),this.map=null,this.mapPass=null,this.matrix=new Nn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Vs,this._frameExtents=new Zi(1,1),this._viewportCount=1,this._viewports=[new tn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;_u.setFromMatrixPosition(e.matrixWorld),t.position.copy(_u),xu.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(xu),t.updateMatrixWorld(),yu.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yu),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class bu extends wu{constructor(){super(new Ls(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,i=2*Bi*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;i===t.fov&&n===t.aspect&&r===t.far||(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}bu.prototype.isSpotLightShadow=!0;class Mu extends gu{constructor(e,t,i=0,n=Math.PI/3,r=0,s=1){super(e,t),this.type="SpotLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new bu}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Mu.prototype.isSpotLight=!0;const Tu=new Nn,Su=new an,Eu=new an;class Pu extends wu{constructor(){super(new Ls(90,1,.5,500)),this._frameExtents=new Zi(4,2),this._viewportCount=6,this._viewports=[new tn(2,1,1,1),new tn(0,1,1,1),new tn(3,1,1,1),new tn(1,1,1,1),new tn(3,0,1,1),new tn(1,0,1,1)],this._cubeDirections=[new an(1,0,0),new an(-1,0,0),new an(0,0,1),new an(0,0,-1),new an(0,1,0),new an(0,-1,0)],this._cubeUps=[new an(0,1,0),new an(0,1,0),new an(0,1,0),new an(0,1,0),new an(0,0,1),new an(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Su.setFromMatrixPosition(e.matrixWorld),i.position.copy(Su),Eu.copy(i.position),Eu.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Eu),i.updateMatrixWorld(),n.makeTranslation(-Su.x,-Su.y,-Su.z),Tu.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Tu)}}Pu.prototype.isPointLightShadow=!0;class Au extends gu{constructor(e,t,i=0,n=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Pu}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Au.prototype.isPointLight=!0;class Cu extends Cs{constructor(e=-1,t=1,i=1,n=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,s=i+e,o=n+t,a=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Cu.prototype.isOrthographicCamera=!0;class Lu extends wu{constructor(){super(new Cu(-5,5,5,-5,.5,500))}}Lu.prototype.isDirectionalLightShadow=!0;class Ru extends gu{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.shadow=new Lu}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Ru.prototype.isDirectionalLight=!0;class Du extends gu{constructor(e,t){super(e,t),this.type="AmbientLight"}}Du.prototype.isAmbientLight=!0;class Ou extends gu{constructor(e,t,i=10,n=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=n}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}Ou.prototype.isRectAreaLight=!0;class Iu{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new an)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*n),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*i),t.addScaledVector(s[4],i*n*1.092548),t.addScaledVector(s[5],n*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],i*r*1.092548),t.addScaledVector(s[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*n),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*i),t.addScaledVector(s[4],.858086*i*n),t.addScaledVector(s[5],.858086*n*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*i*r),t.addScaledVector(s[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){const i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}Iu.prototype.isSphericalHarmonics3=!0;class Fu extends gu{constructor(e=new Iu,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Fu.prototype.isLightProbe=!0;class Vu extends Nh{constructor(e){super(e),this.textures={}}load(e,t,i,n){const r=this,s=new kh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}parse(e){const t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const n=new _h[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&void 0!==n.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=(new Or).setHex(e.sheen)),void 0!==e.emissive&&void 0!==n.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==n.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(n.transmission=e.transmission),void 0!==e.thickness&&(n.thickness=e.thickness),void 0!==e.attenuationDistance&&(n.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.shadowSide&&(n.shadowSide=e.shadowSide),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.alphaToCoverage&&(n.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(n.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.vertexTangents&&(n.vertexTangents=e.vertexTangents),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const r=e.uniforms[t];switch(n.uniforms[t]={},r.type){case"t":n.uniforms[t].value=i(r.value);break;case"c":n.uniforms[t].value=(new Or).setHex(r.value);break;case"v2":n.uniforms[t].value=(new Zi).fromArray(r.value);break;case"v3":n.uniforms[t].value=(new an).fromArray(r.value);break;case"v4":n.uniforms[t].value=(new tn).fromArray(r.value);break;case"m3":n.uniforms[t].value=(new Ki).fromArray(r.value);break;case"m4":n.uniforms[t].value=(new Nn).fromArray(r.value);break;default:n.uniforms[t].value=r.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)n.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=i(e.map)),void 0!==e.matcap&&(n.matcap=i(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),n.normalScale=(new Zi).fromArray(t)}return void 0!==e.displacementMap&&(n.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=i(e.specularMap)),void 0!==e.envMap&&(n.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(n.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Zi).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(n.transmissionMap=i(e.transmissionMap)),void 0!==e.thicknessMap&&(n.thicknessMap=i(e.thicknessMap)),n}setTextures(e){return this.textures=e,this}}class Uu{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}class Nu extends rs{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Nu.prototype.isInstancedBufferGeometry=!0;class Bu extends Ur{constructor(e,t,i,n){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=n||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Bu.prototype.isInstancedBufferAttribute=!0;class ku extends Nh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new kh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}parse(e){const t={},i={};function n(e,n){if(void 0!==t[n])return t[n];const r=e.interleavedBuffers[n],s=function(e,t){if(void 0!==i[t])return i[t];const n=e.arrayBuffers[t],r=new Uint32Array(n).buffer;return i[t]=r,r}(e,r.buffer),o=Yr(r.type,s),a=new nl(o,r.stride);return a.uuid=r.uuid,t[n]=a,a}const r=e.isInstancedBufferGeometry?new Nu:new rs,s=e.data.index;if(void 0!==s){const e=Yr(s.type,s.array);r.setIndex(new Ur(e,1))}const o=e.data.attributes;for(const t in o){const i=o[t];let s;if(i.isInterleavedBufferAttribute){const t=n(e.data,i.data);s=new sl(t,i.itemSize,i.offset,i.normalized)}else{const e=Yr(i.type,i.array);s=new(i.isInstancedBufferAttribute?Bu:Ur)(e,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),void 0!==i.updateRange&&(s.updateRange.offset=i.updateRange.offset,s.updateRange.count=i.updateRange.count),r.setAttribute(t,s)}const a=e.data.morphAttributes;if(a)for(const t in a){const i=a[t],s=[];for(let t=0,r=i.length;t<r;t++){const r=i[t];let o;if(r.isInterleavedBufferAttribute){const t=n(e.data,r.data);o=new sl(t,r.itemSize,r.offset,r.normalized)}else{const e=Yr(r.type,r.array);o=new Ur(e,r.itemSize,r.normalized)}void 0!==r.name&&(o.name=r.name),s.push(o)}r.morphAttributes[t]=s}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];r.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new an;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new Cn(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class zu extends Nh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=""===this.path?Uu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const o=new kh(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){let s=null;try{s=JSON.parse(i)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(s,t):console.error("THREE.ObjectLoader: Can't load "+e)}),i,n)}parse(e,t){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,i),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in s)if(s[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}parseShapes(e){const t={};if(void 0!==e)for(let i=0,n=e.length;i<n;i++){const n=(new fu).fromJSON(e[i]);t[n.uuid]=n}return t}parseSkeletons(e,t){const i={},n={};if(t.traverse((function(e){e.isBone&&(n[e.uuid]=e)})),void 0!==e)for(let t=0,r=e.length;t<r;t++){const r=(new Fl).fromJSON(e[t],n);i[r.uuid]=r}return i}parseGeometries(e,t){const i={};let n;if(void 0!==e){const r=new ku;for(let s=0,o=e.length;s<o;s++){let o;const a=e[s];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new lh[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":o=new lh[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new lh[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new lh[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new lh[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new lh[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new lh[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new lh[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new lh[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new lh[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new lh[a.type]((new du[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new lh[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new lh[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":n=[];for(let e=0,i=a.shapes.length;e<i;e++){const i=t[a.shapes[e]];n.push(i)}o=new lh[a.type](n,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":n=[];for(let e=0,i=a.shapes.length;e<i;e++){const i=t[a.shapes[e]];n.push(i)}const e=a.options.extrudePath;void 0!==e&&(a.options.extrudePath=(new du[e.type]).fromJSON(e)),o=new lh[a.type](n,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),!0===o.isBufferGeometry&&void 0!==a.userData&&(o.userData=a.userData),i[a.uuid]=o}}return i}parseMaterials(e,t){const i={},n={};if(void 0!==e){const r=new Vu;r.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];if("MultiMaterial"===s.type){const e=[];for(let t=0;t<s.materials.length;t++){const n=s.materials[t];void 0===i[n.uuid]&&(i[n.uuid]=r.parse(n)),e.push(i[n.uuid])}n[s.uuid]=e}else void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(e){const t={};if(void 0!==e)for(let i=0;i<e.length;i++){const n=e[i],r=Oh.parse(n);t[r.uuid]=r}return t}parseImages(e,t){const i=this,n={};let r;function s(e){if("string"==typeof e){const t=e;return function(e){return i.manager.itemStart(e),r.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:Yr(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const i=new Vh(t);r=new jh(i),r.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],r=i.url;if(Array.isArray(r)){n[i.uuid]=[];for(let e=0,t=r.length;e<t;e++){const t=s(r[e]);null!==t&&(t instanceof HTMLImageElement?n[i.uuid].push(t):n[i.uuid].push(new Dl(t.data,t.width,t.height)))}}else{const e=s(i.url);null!==e&&(n[i.uuid]=e)}}}return n}parseTextures(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const n={};if(void 0!==e)for(let r=0,s=e.length;r<s;r++){const s=e[r];let o;void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const a=t[s.image];Array.isArray(a)?(o=new Ds(a),6===a.length&&(o.needsUpdate=!0)):(o=a&&a.data?new Dl(a.data,a.width,a.height):new Qi(a),a&&(o.needsUpdate=!0)),o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=i(s.mapping,Gu)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=i(s.wrap[0],ju),o.wrapT=i(s.wrap[1],ju)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=i(s.minFilter,Hu)),void 0!==s.magFilter&&(o.magFilter=i(s.magFilter,Hu)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),n[s.uuid]=o}return n}parseObject(e,t,i,n){let r,s,o;function a(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(i[r])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":r=new il,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new Or(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new tl(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new el(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new Ls(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new Cu(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new Du(e.color,e.intensity);break;case"DirectionalLight":r=new Ru(e.color,e.intensity);break;case"PointLight":r=new Au(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new Ou(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Mu(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new vu(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=(new Fu).fromJSON(e);break;case"SkinnedMesh":s=a(e.geometry),o=l(e.material),r=new Ll(s,o),void 0!==e.bindMode&&(r.bindMode=e.bindMode),void 0!==e.bindMatrix&&r.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(r.skeleton=e.skeleton);break;case"Mesh":s=a(e.geometry),o=l(e.material),r=new bs(s,o);break;case"InstancedMesh":s=a(e.geometry),o=l(e.material);const t=e.count,i=e.instanceMatrix,n=e.instanceColor;r=new kl(s,o,t),r.instanceMatrix=new Ur(new Float32Array(i.array),16),void 0!==n&&(r.instanceColor=new Ur(new Float32Array(n.array),n.itemSize));break;case"LOD":r=new Tl;break;case"Line":r=new Xl(a(e.geometry),l(e.material));break;case"LineLoop":r=new $l(a(e.geometry),l(e.material));break;case"LineSegments":r=new Yl(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":r=new nc(a(e.geometry),l(e.material));break;case"Sprite":r=new xl(l(e.material));break;case"Group":r=new Xa;break;case"Bone":r=new Rl;break;default:r=new cr}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(r.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)r.add(this.parseObject(s[e],t,i,n))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const i=t[e];r.animations.push(n[i])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const i=t[e],n=r.getObjectByProperty("uuid",i.object);void 0!==n&&r.addLevel(n,i.distance)}}return r}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const i=t[e.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(i,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const Gu={UVMapping:re,CubeReflectionMapping:se,CubeRefractionMapping:oe,EquirectangularReflectionMapping:ae,EquirectangularRefractionMapping:le,CubeUVReflectionMapping:ce,CubeUVRefractionMapping:he},ju={RepeatWrapping:ue,ClampToEdgeWrapping:de,MirroredRepeatWrapping:me},Hu={NearestFilter:pe,NearestMipmapNearestFilter:fe,NearestMipmapLinearFilter:ve,LinearFilter:_e,LinearMipmapNearestFilter:xe,LinearMipmapLinearFilter:be};class Wu extends Nh{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Fh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){Fh.add(e,i),t&&t(i),r.manager.itemEnd(e)})).catch((function(t){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}Wu.prototype.isImageBitmapLoader=!0;class qu{constructor(){this.type="ShapePath",this.color=new Or,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new pu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,s){return this.currentPath.bezierCurveTo(e,t,i,n,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function i(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i],r=new fu;r.curves=n.curves,t.push(r)}return t}function n(e,t){const i=t.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=t[r],o=t[s],a=o.x-i.x,l=o.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=t[s],a=-a,o=t[r],l=-l),e.y<i.y||e.y>o.y)continue;if(e.y===i.y){if(e.x===i.x)return!0}else{const t=l*(e.x-i.x)-a*(e.y-i.y);if(0===t)return!0;if(t<0)continue;n=!n}}else{if(e.y!==i.y)continue;if(o.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=o.x)return!0}}return n}const r=Hc.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===t)return i(s);let o,a,l;const c=[];if(1===s.length)return a=s[0],l=new fu,l.curves=a.curves,c.push(l),c;let h=!r(s[0].getPoints());h=e?!h:h;const u=[],d=[];let m,p,f=[],g=0;d[g]=void 0,f[g]=[];for(let t=0,i=s.length;t<i;t++)a=s[t],m=a.getPoints(),o=r(m),o=e?!o:o,o?(!h&&d[g]&&g++,d[g]={s:new fu,p:m},d[g].s.curves=a.curves,h&&g++,f[g]=[]):f[g].push({h:a,p:m[0]});if(!d[0])return i(s);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)u[e]=[];for(let i=0,r=d.length;i<r;i++){const r=f[i];for(let s=0;s<r.length;s++){const o=r[s];let a=!0;for(let r=0;r<d.length;r++)n(o.p,d[r].p)&&(i!==r&&t.push({froms:i,tos:r,hole:s}),a?(a=!1,u[r].push(o)):e=!0);a&&u[i].push(o)}}t.length>0&&(e||(f=u))}for(let e=0,t=d.length;e<t;e++){l=d[e].s,c.push(l),p=f[e];for(let e=0,t=p.length;e<t;e++)l.holes.push(p[e].h)}return c}}class Xu{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){const i=[],n=function(e,t,i){const n=Array.from(e),r=t/i.resolution,s=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,o=[];let a=0,l=0;for(let e=0;e<n.length;e++){const t=n[e];if("\n"===t)a=0,l-=s;else{const e=Zu(t,r,a,l,i);a+=e.offsetX,o.push(e.path)}}return o}(e,t,this.data);for(let e=0,t=n.length;e<t;e++)Array.prototype.push.apply(i,n[e].toShapes());return i}}function Zu(e,t,i,n,r){const s=r.glyphs[e]||r.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".");const o=new qu;let a,l,c,h,u,d,m,p;if(s.o){const e=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let r=0,s=e.length;r<s;){switch(e[r++]){case"m":a=e[r++]*t+i,l=e[r++]*t+n,o.moveTo(a,l);break;case"l":a=e[r++]*t+i,l=e[r++]*t+n,o.lineTo(a,l);break;case"q":c=e[r++]*t+i,h=e[r++]*t+n,u=e[r++]*t+i,d=e[r++]*t+n,o.quadraticCurveTo(u,d,c,h);break;case"b":c=e[r++]*t+i,h=e[r++]*t+n,u=e[r++]*t+i,d=e[r++]*t+n,m=e[r++]*t+i,p=e[r++]*t+n,o.bezierCurveTo(u,d,m,p,c,h)}}}return{offsetX:s.ha*t,path:o}}Xu.prototype.isFont=!0;class Ku extends Nh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new kh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(e){let i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}const n=r.parse(i);t&&t(n)}),i,n)}parse(e){return new Xu(e)}}let Yu;const $u={getContext:function(){return void 0===Yu&&(Yu=new(window.AudioContext||window.webkitAudioContext)),Yu},setContext:function(e){Yu=e}};class Ju extends Nh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new kh(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(i){try{const e=i.slice(0);$u.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}}class Qu extends Fu{constructor(e,t,i=1){super(void 0,i);const n=(new Or).set(e),r=(new Or).set(t),s=new an(n.r,n.g,n.b),o=new an(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}Qu.prototype.isHemisphereLightProbe=!0;class ed extends Fu{constructor(e,t=1){super(void 0,t);const i=(new Or).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}ed.prototype.isAmbientLightProbe=!0;const td=new Nn,id=new Nn;class nd{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ls,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ls,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const i=e.projectionMatrix.clone(),n=t.eyeSep/2,r=n*t.near/t.focus,s=t.near*Math.tan(Ni*t.fov*.5)/t.zoom;let o,a;id.elements[12]=-n,td.elements[12]=n,o=-s*t.aspect+r,a=s*t.aspect+r,i.elements[0]=2*t.near/(a-o),i.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(i),o=-s*t.aspect-r,a=s*t.aspect-r,i.elements[0]=2*t.near/(a-o),i.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(id),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(td)}}class rd{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=sd(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=sd();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function sd(){return("undefined"==typeof performance?Date:performance).now()}const od=new an,ad=new on,ld=new an,cd=new an;class hd extends cr{constructor(){super(),this.type="AudioListener",this.context=$u.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new rd}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(od,ad,ld),cd.set(0,0,-1).applyQuaternion(ad),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(od.x,e),t.positionY.linearRampToValueAtTime(od.y,e),t.positionZ.linearRampToValueAtTime(od.z,e),t.forwardX.linearRampToValueAtTime(cd.x,e),t.forwardY.linearRampToValueAtTime(cd.y,e),t.forwardZ.linearRampToValueAtTime(cd.z,e),t.upX.linearRampToValueAtTime(i.x,e),t.upY.linearRampToValueAtTime(i.y,e),t.upZ.linearRampToValueAtTime(i.z,e)}else t.setPosition(od.x,od.y,od.z),t.setOrientation(cd.x,cd.y,cd.z,i.x,i.y,i.z)}}class ud extends cr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const dd=new an,md=new on,pd=new an,fd=new an;class gd extends ud{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(dd,md,pd),fd.set(0,0,1).applyQuaternion(md);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(dd.x,e),t.positionY.linearRampToValueAtTime(dd.y,e),t.positionZ.linearRampToValueAtTime(dd.z,e),t.orientationX.linearRampToValueAtTime(fd.x,e),t.orientationY.linearRampToValueAtTime(fd.y,e),t.orientationZ.linearRampToValueAtTime(fd.z,e)}else t.setPosition(dd.x,dd.y,dd.z),t.setOrientation(fd.x,fd.y,fd.z)}}class vd{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class yd{constructor(e,t,i){let n,r,s;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,r=e*n+n;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==n;++e)i[r+e]=i[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(i,r,0,e,n)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(i[e]!==i[e+t]){o.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let e=i,r=n;e!==r;++e)t[e]=t[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)e[t+n]=e[i+n]}_slerp(e,t,i,n){on.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){const s=this._workIndex*r;on.multiplyQuaternionsFlat(e,s,e,t,e,i),on.slerpFlat(e,t,e,t,e,s,n)}_lerp(e,t,i,n,r){const s=1-n;for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]*s+e[i+o]*n}}_lerpAdditive(e,t,i,n,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[i+s]*n}}}const _d=new RegExp("[\\[\\]\\.:\\/]","g"),xd="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",wd=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),bd=/(WCOD+)?/.source.replace("WCOD",xd),Md=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Td=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Sd=new RegExp("^"+wd+bd+Md+Td+"$"),Ed=["material","materials","bones"];class Pd{constructor(e,t,i){this.path=t,this.parsedPath=i||Pd.parseTrackName(t),this.node=Pd.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Pd.Composite(e,t,i):new Pd(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_d,"")}static parseTrackName(e){const t=Sd.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=i.nodeName.substring(n+1);-1!==Ed.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let n=0;n<e.length;n++){const r=e[n];if(r.name===t||r.uuid===t)return r;const s=i(r.children);if(s)return s}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=Pd.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const s=e[n];if(void 0===s){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Pd.Composite=class{constructor(e,t,i){const n=i||Pd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Pd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Pd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Pd.prototype.GetterByBindingType=[Pd.prototype._getValue_direct,Pd.prototype._getValue_array,Pd.prototype._getValue_arrayElement,Pd.prototype._getValue_toArray],Pd.prototype.SetterByBindingTypeAndVersioning=[[Pd.prototype._setValue_direct,Pd.prototype._setValue_direct_setNeedsUpdate,Pd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Pd.prototype._setValue_array,Pd.prototype._setValue_array_setNeedsUpdate,Pd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Pd.prototype._setValue_arrayElement,Pd.prototype._setValue_arrayElement_setNeedsUpdate,Pd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Pd.prototype._setValue_fromArray,Pd.prototype._setValue_fromArray_setNeedsUpdate,Pd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ad{constructor(){this.uuid=ki(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,s=r.length;let o=void 0,a=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=t[u];if(void 0===d){d=a++,t[u]=d,e.push(h);for(let e=0,t=s;e!==t;++e)r[e].push(new Pd(h,i[e],n[e]))}else if(d<l){o=e[d];const a=--l,c=e[a];t[c.uuid]=d,e[d]=c,t[u]=a,e[a]=h;for(let e=0,t=s;e!==t;++e){const t=r[e],s=t[a];let o=t[d];t[d]=s,void 0===o&&(o=new Pd(h,i[e],n[e])),t[a]=o}}else e[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=t[a];if(void 0!==l&&l>=r){const s=r++,c=e[s];t[c.uuid]=l,e[l]=c,t[a]=s,e[s]=o;for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[s],r=t[l];t[l]=n,t[s]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,s=e.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<r){const o=--r,a=e[o],c=--s,h=e[c];t[a.uuid]=l,e[l]=a,t[h.uuid]=o,e[o]=h,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[o],r=t[c];t[l]=n,t[o]=r,t.pop()}}else{const r=--s,o=e[r];r>0&&(t[o.uuid]=l),e[l]=o,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const i=this._bindingsIndicesByPath;let n=i[e];const r=this._bindings;if(void 0!==n)return r[n];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,h=new Array(l);n=r.length,i[e]=n,s.push(e),o.push(t),r.push(h);for(let i=c,n=a.length;i!==n;++i){const n=a[i];h[i]=new Pd(n,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){const n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];t[e[o]]=i,s[i]=a,s.pop(),r[i]=r[o],r.pop(),n[i]=n[o],n.pop()}}}Ad.prototype.isAnimationObjectGroup=!0;class Cd{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const r=t.tracks,s=r.length,o=new Array(s),a={endingStart:Gt,endingEnd:Gt};for(let e=0;e!==s;++e){const t=r[e].createInterpolant(null);o[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ut,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,n=e._clip.duration,r=n/i,s=i/n;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,r=n.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const n=(e-r)*i;if(n<0||0===i)return;this._startTime=null,t=i*n}t*=this._updateTimeScale(e);const s=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case qt:for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(s),t[i].accumulateAdditive(o);break;case Wt:default:for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(s),t[i].accumulate(n,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,r=this._loopCount;const s=i===Nt;if(0===e)return-1===r?n:s&&1==(1&r)?t-n:n;if(i===Vt){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=t||n<0){const i=Math.floor(n/t);n-=t*i,r+=Math.abs(i);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1==(1&r))return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=jt,n.endingEnd=jt):(n.endingStart=e?this.zeroSlopeAtStart?jt:Gt:Ht,n.endingEnd=t?this.zeroSlopeAtEnd?jt:Gt:Ht)}_scheduleFading(e,t,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=t,o[1]=r+e,a[1]=i,this}}class Ld extends Fi{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,s=e._propertyBindings,o=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==r;++e){const r=n[e],l=r.name;let h=c[l];if(void 0!==h)s[e]=h;else{if(h=s[e],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const n=t&&t._propertyBindings[e].binding.parsedPath;h=new yd(Pd.create(i,l,n),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),s[e]=h}o[e].resultBuffer=h.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null;delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[t];void 0===s&&(s={},n[t]=s),s[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,o=s[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete o[r],0===Object.keys(o).length&&delete s[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new Mh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const n=t||this._root,r=n.uuid;let s="string"==typeof e?Oh.findByName(n,e):e;const o=null!==s?s.uuid:e,a=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:Wt),void 0!==a){const e=a.actionByRoot[r];if(void 0!==e&&e.blendMode===i)return e;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Cd(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(e,t){const i=t||this._root,n=i.uuid,r="string"==typeof e?Oh.findByName(i,e):e,s=r?r.uuid:e,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let o=0;o!==i;++o){t[o]._update(n,e,r,s)}const o=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)o[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const e=r.knownActions;for(let i=0,n=e.length;i!==n;++i){const n=e[i];this._deactivateAction(n);const r=n._cacheIndex,s=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const e in i){const n=i[e].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[t];if(void 0!==n)for(const e in n){const t=n[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}Ld.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Rd{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Rd(void 0===this.value.clone?this.value:this.value.clone())}}class Dd extends nl{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}Dd.prototype.isInstancedInterleavedBuffer=!0;class Od{constructor(e,t,i,n,r){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Od.prototype.isGLBufferAttribute=!0;class Id{constructor(e,t,i=0,n=1/0){this.ray=new Un(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new Kn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,i=[]){return Vd(e,this,i,t),i.sort(Fd),i}intersectObjects(e,t=!1,i=[]){for(let n=0,r=e.length;n<r;n++)Vd(e[n],this,i,t);return i.sort(Fd),i}}function Fd(e,t){return e.distance-t.distance}function Vd(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){const n=e.children;for(let e=0,r=n.length;e<r;e++)Vd(n[e],t,i,!0)}}class Ud{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(zi(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Nd{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const Bd=new Zi;class kd{constructor(e=new Zi(1/0,1/0),t=new Zi(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Bd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Zi),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Zi),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Zi),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Zi),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Bd.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}kd.prototype.isBox2=!0;const zd=new an,Gd=new an;class jd{constructor(e=new an,t=new an){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new an),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new an),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new an),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){zd.subVectors(e,this.start),Gd.subVectors(this.end,this.start);const i=Gd.dot(Gd);let n=Gd.dot(zd)/i;return t&&(n=zi(n,0,1)),n}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new an),this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class Hd extends cr{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}Hd.prototype.isImmediateRenderObject=!0;const Wd=new an;class qd extends cr{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const i=new rs,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,i=32;e<i;e++,t++){const r=e/i*Math.PI*2,s=t/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new qr(n,3));const r=new zl({fog:!1,toneMapped:!1});this.cone=new Yl(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Wd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Wd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Xd=new an,Zd=new Nn,Kd=new Nn;class Yd extends Yl{constructor(e){const t=function e(t){const i=[];t&&t.isBone&&i.push(t);for(let n=0;n<t.children.length;n++)i.push.apply(i,e(t.children[n]));return i}(e),i=new rs,n=[],r=[],s=new Or(0,0,1),o=new Or(0,1,0);for(let e=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}i.setAttribute("position",new qr(n,3)),i.setAttribute("color",new qr(r,3));super(i,new zl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");Kd.copy(this.root.matrixWorld).invert();for(let e=0,i=0;e<t.length;e++){const r=t[e];r.parent&&r.parent.isBone&&(Zd.multiplyMatrices(Kd,r.matrixWorld),Xd.setFromMatrixPosition(Zd),n.setXYZ(i,Xd.x,Xd.y,Xd.z),Zd.multiplyMatrices(Kd,r.parent.matrixWorld),Xd.setFromMatrixPosition(Zd),n.setXYZ(i+1,Xd.x,Xd.y,Xd.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}class $d extends bs{constructor(e,t,i){super(new th(t,4,2),new Ir({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Jd=new an,Qd=new Or,em=new Or;class tm extends cr{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new $c(t);n.rotateY(.5*Math.PI),this.material=new Ir({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),s=new Float32Array(3*r.count);n.setAttribute("color",new Ur(s,3)),this.add(new bs(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Qd.copy(this.light.color),em.copy(this.light.groundColor);for(let e=0,i=t.count;e<i;e++){const n=e<i/2?Qd:em;t.setXYZ(e,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(Jd.setFromMatrixPosition(this.light.matrixWorld).negate())}}class im extends Yl{constructor(e=10,t=10,i=4473924,n=8947848){i=new Or(i),n=new Or(n);const r=t/2,s=e/t,o=e/2,a=[],l=[];for(let e=0,c=0,h=-o;e<=t;e++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const t=e===r?i:n;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new rs;c.setAttribute("position",new qr(a,3)),c.setAttribute("color",new qr(l,3));super(c,new zl({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class nm extends Yl{constructor(e=10,t=16,i=8,n=64,r=4473924,s=8947848){r=new Or(r),s=new Or(s);const o=[],a=[];for(let i=0;i<=t;i++){const n=i/t*(2*Math.PI),l=Math.sin(n)*e,c=Math.cos(n)*e;o.push(0,0,0),o.push(l,0,c);const h=1&i?r:s;a.push(h.r,h.g,h.b),a.push(h.r,h.g,h.b)}for(let t=0;t<=i;t++){const l=1&t?r:s,c=e-e/i*t;for(let e=0;e<n;e++){let t=e/n*(2*Math.PI),i=Math.sin(t)*c,r=Math.cos(t)*c;o.push(i,0,r),a.push(l.r,l.g,l.b),t=(e+1)/n*(2*Math.PI),i=Math.sin(t)*c,r=Math.cos(t)*c,o.push(i,0,r),a.push(l.r,l.g,l.b)}}const l=new rs;l.setAttribute("position",new qr(o,3)),l.setAttribute("color",new qr(a,3));super(l,new zl({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const rm=new an,sm=new an,om=new an;class am extends cr{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);let n=new rs;n.setAttribute("position",new qr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new zl({fog:!1,toneMapped:!1});this.lightPlane=new Xl(n,r),this.add(this.lightPlane),n=new rs,n.setAttribute("position",new qr([0,0,0,0,0,1],3)),this.targetLine=new Xl(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){rm.setFromMatrixPosition(this.light.matrixWorld),sm.setFromMatrixPosition(this.light.target.matrixWorld),om.subVectors(sm,rm),this.lightPlane.lookAt(sm),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(sm),this.targetLine.scale.z=om.length()}}const lm=new an,cm=new Cs;class hm extends Yl{constructor(e){const t=new rs,i=new zl({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={},o=new Or(16755200),a=new Or(16711680),l=new Or(43775),c=new Or(16777215),h=new Or(3355443);function u(e,t,i){d(e,i),d(t,i)}function d(e,t){n.push(0,0,0),r.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(n.length/3-1)}u("n1","n2",o),u("n2","n4",o),u("n4","n3",o),u("n3","n1",o),u("f1","f2",o),u("f2","f4",o),u("f4","f3",o),u("f3","f1",o),u("n1","f1",o),u("n2","f2",o),u("n3","f3",o),u("n4","f4",o),u("p","n1",a),u("p","n2",a),u("p","n3",a),u("p","n4",a),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",c),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),t.setAttribute("position",new qr(n,3)),t.setAttribute("color",new qr(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const e=this.geometry,t=this.pointMap;cm.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),um("c",t,e,cm,0,0,-1),um("t",t,e,cm,0,0,1),um("n1",t,e,cm,-1,-1,-1),um("n2",t,e,cm,1,-1,-1),um("n3",t,e,cm,-1,1,-1),um("n4",t,e,cm,1,1,-1),um("f1",t,e,cm,-1,-1,1),um("f2",t,e,cm,1,-1,1),um("f3",t,e,cm,-1,1,1),um("f4",t,e,cm,1,1,1),um("u1",t,e,cm,.7,1.1,-1),um("u2",t,e,cm,-.7,1.1,-1),um("u3",t,e,cm,0,2,-1),um("cf1",t,e,cm,-1,0,1),um("cf2",t,e,cm,1,0,1),um("cf3",t,e,cm,0,-1,1),um("cf4",t,e,cm,0,1,1),um("cn1",t,e,cm,-1,0,-1),um("cn2",t,e,cm,1,0,-1),um("cn3",t,e,cm,0,-1,-1),um("cn4",t,e,cm,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function um(e,t,i,n,r,s,o){lm.set(r,s,o).unproject(n);const a=t[e];if(void 0!==a){const e=i.getAttribute("position");for(let t=0,i=a.length;t<i;t++)e.setXYZ(a[t],lm.x,lm.y,lm.z)}}const dm=new hn;class mm extends Yl{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new rs;r.setIndex(new Ur(i,1)),r.setAttribute("position",new Ur(n,3)),super(r,new zl({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&dm.setFromObject(this.object),dm.isEmpty())return;const t=dm.min,i=dm.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Yl.prototype.copy.call(this,e),this.object=e.object,this}}class pm extends Yl{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new rs;n.setIndex(new Ur(i,1)),n.setAttribute("position",new qr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new zl({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class fm extends Xl{constructor(e,t=1,i=16776960){const n=i,r=new rs;r.setAttribute("position",new qr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new zl({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=new rs;s.setAttribute("position",new qr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new bs(s,new Ir({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?f:p,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const gm=new an;let vm,ym;class _m extends cr{constructor(e=new an(0,0,1),t=new an(0,0,0),i=1,n=16776960,r=.2*i,s=.2*r){super(),this.type="ArrowHelper",void 0===vm&&(vm=new rs,vm.setAttribute("position",new qr([0,0,0,0,1,0],3)),ym=new hc(0,.5,1,5,1),ym.translate(0,-.5,0)),this.position.copy(t),this.line=new Xl(vm,new zl({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new bs(ym,new Ir({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{gm.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(gm,t)}}setLength(e,t=.2*e,i=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class xm extends Yl{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new rs;i.setAttribute("position",new qr(t,3)),i.setAttribute("color",new qr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new zl({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const wm=new Float32Array(1),bm=new Int32Array(wm.buffer);class Mm{static toHalfFloat(e){wm[0]=e;const t=bm[0];let i=t>>16&32768,n=t>>12&2047;const r=t>>23&255;return r<103?i:r>142?(i|=31744,i|=(255==r?0:1)&&8388607&t,i):r<113?(n|=2048,i|=(n>>114-r)+(n>>113-r&1),i):(i|=r-112<<10|n>>1,i+=1&n,i)}}const Tm=Math.pow(2,8),Sm=[.125,.215,.35,.446,.526,.582],Em=5+Sm.length,Pm={[Yt]:0,[$t]:1,[Qt]:2,[ti]:3,[ii]:4,[ni]:5,[Jt]:6},Am=new Ir({side:f,depthWrite:!1,depthTest:!1}),Cm=new bs(new Ts,Am),Lm=new Cu,{_lodPlanes:Rm,_sizeLods:Dm,_sigmas:Om}=Gm(),Im=new Or;let Fm=null;const Vm=(1+Math.sqrt(5))/2,Um=1/Vm,Nm=[new an(1,1,1),new an(-1,1,1),new an(1,1,-1),new an(-1,1,-1),new an(0,Vm,Um),new an(0,Vm,-Um),new an(Um,0,Vm),new an(-Um,0,Vm),new an(Vm,Um,0),new an(-Vm,Um,0)];function Bm(e){const t=Math.max(e.r,e.g,e.b),i=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);e.multiplyScalar(Math.pow(2,-i));return(i+128)/255}class km{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(e),i=new an(0,1,0);return new hh({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:Pm[Yt]},outputEncoding:{value:Pm[Yt]}},vertexShader:Xm(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${Zm()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:_,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){Fm=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=qm(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Wm(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Rm.length;e++)Rm[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Fm),e.scissorTest=!1,Hm(e,0,0,e.width,e.height)}_fromTexture(e){Fm=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:pe,minFilter:pe,generateMipmaps:!1,type:Te,format:ze,encoding:zm(e)?e.encoding:Qt,depthBuffer:!1},i=jm(t);return i.depthBuffer=!e,this._pingPongRenderTarget=jm(t),i}_compileMaterial(e){const t=new bs(Rm[0],e);this._renderer.compile(t,Lm)}_sceneToCubeUV(e,t,i,n){const r=new Ls(90,1,t,i),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,h=a.toneMapping;a.getClearColor(Im),a.toneMapping=J,a.outputEncoding=Yt,a.autoClear=!1;let u=!1;const d=e.background;if(d){if(d.isColor){Am.color.copy(d).convertSRGBToLinear(),e.background=null;const t=Bm(Am.color);Am.opacity=t,u=!0}}else{Am.color.copy(Im).convertSRGBToLinear();const e=Bm(Am.color);Am.opacity=e,u=!0}for(let t=0;t<6;t++){const i=t%3;0==i?(r.up.set(0,s[t],0),r.lookAt(o[t],0,0)):1==i?(r.up.set(0,0,s[t]),r.lookAt(0,o[t],0)):(r.up.set(0,s[t],0),r.lookAt(0,0,o[t])),Hm(n,i*Tm,t>2?Tm:0,Tm,Tm),a.setRenderTarget(n),u&&a.render(Cm,r),a.render(e,r)}a.toneMapping=h,a.outputEncoding=c,a.autoClear=l}_textureToCubeUV(e,t){const i=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=qm()):null==this._equirectShader&&(this._equirectShader=Wm());const n=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new bs(Rm[0],n),s=n.uniforms;s.envMap.value=e,e.isCubeTexture||s.texelSize.value.set(1/e.image.width,1/e.image.height),s.inputEncoding.value=Pm[e.encoding],s.outputEncoding.value=Pm[t.texture.encoding],Hm(t,0,0,3*Tm,2*Tm),i.setRenderTarget(t),i.render(r,Lm)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<Em;t++){const i=Math.sqrt(Om[t]*Om[t]-Om[t-1]*Om[t-1]),n=Nm[(t-1)%Nm.length];this._blur(e,t-1,t,i,n)}t.autoClear=i}_blur(e,t,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,n,"latitudinal",r),this._halfBlur(s,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new bs(Rm[n],l),h=l.uniforms,u=Dm[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,m=r/d,p=isFinite(r)?1+Math.floor(3*m):20;p>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const f=[];let g=0;for(let e=0;e<20;++e){const t=e/m,i=Math.exp(-t*t/2);f.push(i),0==e?g+=i:e<p&&(g+=2*i)}for(let e=0;e<f.length;e++)f[e]=f[e]/g;h.envMap.value=e.texture,h.samples.value=p,h.weights.value=f,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o),h.dTheta.value=d,h.mipInt.value=8-i,h.inputEncoding.value=Pm[e.texture.encoding],h.outputEncoding.value=Pm[e.texture.encoding];const v=Dm[n];Hm(t,3*Math.max(0,Tm-2*v),(0===n?0:2*Tm)+2*v*(n>4?n-8+4:0),3*v,2*v),a.setRenderTarget(t),a.render(c,Lm)}}function zm(e){return void 0!==e&&e.type===Te&&(e.encoding===Yt||e.encoding===$t||e.encoding===Jt)}function Gm(){const e=[],t=[],i=[];let n=8;for(let r=0;r<Em;r++){const s=Math.pow(2,n);t.push(s);let o=1/s;r>4?o=Sm[r-8+4-1]:0==r&&(o=0),i.push(o);const a=1/(s-1),l=-a/2,c=1+a/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],u=6,d=6,m=3,p=2,f=1,g=new Float32Array(m*d*u),v=new Float32Array(p*d*u),y=new Float32Array(f*d*u);for(let e=0;e<u;e++){const t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];g.set(n,m*d*e),v.set(h,p*d*e);const r=[e,e,e,e,e,e];y.set(r,f*d*e)}const _=new rs;_.setAttribute("position",new Ur(g,m)),_.setAttribute("uv",new Ur(v,p)),_.setAttribute("faceIndex",new Ur(y,f)),e.push(_),n>4&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function jm(e){const t=new nn(3*Tm,3*Tm,e);return t.texture.mapping=ce,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Hm(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function Wm(){const e=new Zi(1,1);return new hh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Pm[Yt]},outputEncoding:{value:Pm[Yt]}},vertexShader:Xm(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${Zm()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:_,depthTest:!1,depthWrite:!1})}function qm(){return new hh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Pm[Yt]},outputEncoding:{value:Pm[Yt]}},vertexShader:Xm(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${Zm()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:_,depthTest:!1,depthWrite:!1})}function Xm(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Zm(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}const Km=0,Ym=1,$m=0,Jm=1,Qm=2;function ep(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function tp(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function ip(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new nc(e,t)}function np(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new xl(e)}function rp(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new nc(e,t)}function sp(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Jl(e)}function op(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Jl(e)}function ap(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Jl(e)}function lp(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new an(e,t,i)}function cp(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Ur(e,t).setUsage(Si)}function hp(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Nr(e,t)}function up(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Br(e,t)}function dp(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new kr(e,t)}function mp(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new zr(e,t)}function pp(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Gr(e,t)}function fp(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new jr(e,t)}function gp(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Hr(e,t)}function vp(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new qr(e,t)}function yp(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Xr(e,t)}function _p(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new xm(e)}function xp(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new mm(e,t)}function wp(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Yl(new yc(e.geometry),new zl({color:void 0!==t?t:16777215}))}function bp(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Yl(new ah(e.geometry),new zl({color:void 0!==t?t:16777215}))}function Mp(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new kh(e)}function Tp(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Wh(e)}function Sp(e,t,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Os(e,i)}function Ep(){console.error("THREE.CanvasRenderer has been removed")}function Pp(){console.error("THREE.JSONLoader has been removed.")}Xh.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Xh.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},pu.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},im.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Yd.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Nh.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Uu.extractUrlBase(e)},Nh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},kd.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},kd.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},kd.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},kd.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},hn.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},hn.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},hn.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},hn.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},hn.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Cn.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Vs.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},jd.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Ki.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Ki.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Ki.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Ki.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Ki.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Ki.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Nn.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Nn.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Nn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new an).setFromMatrixColumn(this,3)},Nn.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Nn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Nn.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Nn.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Nn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Nn.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Nn.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Nn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Nn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Nn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Nn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Nn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Nn.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Nn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Nn.prototype.makeFrustum=function(e,t,i,n,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,i,r,s)},Nn.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},mr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},on.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},on.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Un.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Un.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Un.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Tr.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Tr.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Tr.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Tr.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Tr.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Tr.barycoordFromPoint=function(e,t,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Tr.getBarycoord(e,t,i,n,r)},Tr.normal=function(e,t,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Tr.getNormal(e,t,i,n)},fu.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},fu.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Xc(this,e)},fu.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new eh(this,e)},Zi.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},Zi.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Zi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},an.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},an.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},an.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},an.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},an.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},an.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},an.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},an.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},an.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},tn.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},tn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},cr.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},cr.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},cr.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},cr.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},cr.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(cr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),bs.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(bs.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Xt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Ll.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Ls.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(gu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Ur.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Si},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Si)}}}),Ur.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Si:Ti),this},Ur.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Ur.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},rs.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},rs.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Ur(arguments[1],arguments[2])))},rs.prototype.addDrawCall=function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},rs.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},rs.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},rs.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},rs.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(rs.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),nl.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Si:Ti),this},nl.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Xc.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Xc.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Xc.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},il.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Rd.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Er.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Or}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===v}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(As.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Ja.prototype.clearTarget=function(e,t,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,n)},Ja.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Ja.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Ja.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Ja.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Ja.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Ja.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Ja.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Ja.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Ja.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Ja.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Ja.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Ja.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Ja.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Ja.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Ja.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Ja.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Ja.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Ja.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Ja.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Ja.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Ja.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Ja.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Ja.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Ja.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Ja.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?$t:Yt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Ga.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(nn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),ud.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new Ju).load(e,(function(e){t.setBuffer(e)})),this},vd.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Rs.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Rs.prototype.clear=function(e,t,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,i,n)},$i.crossOrigin=void 0,$i.loadTexture=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new qh;r.setCrossOrigin(this.crossOrigin);const s=r.load(e,i,void 0,n);return t&&(s.mapping=t),s},$i.loadTextureCube=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Hh;r.setCrossOrigin(this.crossOrigin);const s=r.load(e,i,void 0,n);return t&&(s.mapping=t),s},$i.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},$i.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Ap={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Cp(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=n)},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(201),t),r(i(221),t)},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(12),t),r(i(187),t),r(i(20),t),r(i(7),t),r(i(55),t),r(i(188),t),r(i(91),t),r(i(56),t),r(i(21),t),r(i(92),t),r(i(189),t),r(i(14),t),r(i(39),t),r(i(93),t),r(i(190),t),r(i(94),t),r(i(95),t),r(i(40),t),r(i(191),t),r(i(96),t),r(i(192),t),r(i(41),t),r(i(97),t),r(i(98),t),r(i(29),t),r(i(193),t),r(i(194),t),r(i(195),t),r(i(196),t),r(i(197),t),r(i(198),t),r(i(22),t),r(i(23),t),r(i(13),t),r(i(199),t),r(i(200),t)},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(30),t),r(i(6),t),r(i(63),t),r(i(104),t),r(i(105),t),r(i(240),t),r(i(106),t),r(i(62),t),r(i(241),t),r(i(242),t),r(i(243),t),r(i(244),t),r(i(245),t),r(i(107),t),r(i(246),t),r(i(109),t),r(i(247),t),r(i(43),t)},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(248),t),r(i(110),t),r(i(249),t),r(i(250),t),r(i(254),t),r(i(255),t),r(i(256),t),r(i(257),t),r(i(258),t),r(i(31),t),r(i(64),t),r(i(259),t),r(i(10),t),r(i(260),t),r(i(261),t),r(i(262),t),r(i(11),t),r(i(263),t)},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(99),t),r(i(264),t),r(i(112),t),r(i(125),t),r(i(32),t),r(i(71),t),r(i(80),t),r(i(126),t),r(i(128),t),r(i(131),t),r(i(317),t),r(i(73),t),r(i(318),t),r(i(159),t),r(i(319),t),r(i(67),t),r(i(133),t),r(i(322),t),r(i(66),t),r(i(155),t),r(i(25),t),r(i(158),t),r(i(323),t),r(i(324),t),r(i(135),t),r(i(45),t),r(i(138),t),r(i(137),t),r(i(74),t),r(i(140),t),r(i(15),t),r(i(325),t),r(i(141),t),r(i(70),t),r(i(75),t),r(i(143),t),r(i(154),t),r(i(35),t),r(i(37),t),r(i(47),t),r(i(153),t),r(i(326),t),r(i(36),t),r(i(24),t),r(i(327),t),r(i(161),t),r(i(9),t),r(i(156),t),r(i(130),t),r(i(132),t),r(i(72),t)},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.InterpolateExpr=t.StepExpr=t.CaseExpr=t.MatchExpr=t.CallExpr=t.HasAttributeExpr=t.ObjectLiteralExpr=t.StringLiteralExpr=t.NumberLiteralExpr=t.BooleanLiteralExpr=t.NullLiteralExpr=t.LiteralExpr=t.VarExpr=t.Expr=t.ExprScope=t.isJsonExpr=t.ExprDependencies=void 0;const s=i(0),o=i(224),a=i(238),l=i(239),c=i(62),h=i(61),u=i(42);r(i(44),t);const d=new o.ExprEvaluator,m=new a.ExprInstantiator;class p{constructor(){this.properties=new Set}}t.ExprDependencies=p;class f{static of(e){const t=new p;return e.accept(this.instance,t),t}visitNullLiteralExpr(e,t){}visitBooleanLiteralExpr(e,t){}visitNumberLiteralExpr(e,t){}visitStringLiteralExpr(e,t){}visitObjectLiteralExpr(e,t){}visitVarExpr(e,t){t.properties.add(e.name)}visitHasAttributeExpr(e,t){t.properties.add(e.name)}visitCallExpr(e,t){switch(e.args.forEach(e=>e.accept(this,t)),e.op){case"dynamic-properties":t.volatile=!0;break;case"feature-state":t.featureState=!0,t.properties.add("$state"),t.properties.add("$id");break;case"id":t.properties.add("$id");break;case"zoom":case"world-ppi-scale":case"world-discrete-ppi-scale":t.properties.add("$zoom");break;case"geometry-type":t.properties.add("$geometryType")}}visitMatchExpr(e,t){e.value.accept(this,t),e.branches.forEach(([e,i])=>i.accept(this,t)),e.fallback.accept(this,t)}visitCaseExpr(e,t){e.branches.forEach(([e,i])=>{e.accept(this,t),i.accept(this,t)}),e.fallback.accept(this,t)}visitStepExpr(e,t){e.input.accept(this,t),e.defaultValue.accept(this,t),e.stops.forEach(([e,i])=>i.accept(this,t))}visitInterpolateExpr(e,t){e.input.accept(this,t),e.stops.forEach(([e,i])=>i.accept(this,t))}}function g(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]}var v;f.instance=new f,t.isJsonExpr=g,function(e){e[e.Value=0]="Value",e[e.Condition=1]="Condition",e[e.Dynamic=2]="Dynamic"}(v=t.ExprScope||(t.ExprScope={}));class y{static isExpr(e){return e instanceof y}static parse(e){return new l.ExprParser(e).parse()}static fromJSON(e,t,i){return O(e,void 0!==t?{definitions:t,lockedNames:new Set,cache:null!=i?i:new Map}:void 0)}evaluate(e,t=v.Value,i){return this.accept(d,new o.ExprEvaluatorContext(d,e,t,i))}instantiate(e){return this.accept(m,e)}dependencies(){return this.m_dependencies||(this.m_dependencies=f.of(this)),this.m_dependencies}intern(e){return e.add(this)}toJSON(){return(new D).serialize(this)}isDynamic(){return void 0===this.m_isDynamic&&(this.m_isDynamic=this.exprIsDynamic()),this.m_isDynamic}}t.Expr=y;class _ extends y{constructor(e){super(),this.name=e}accept(e,t){return e.visitVarExpr(this,t)}exprIsDynamic(){return!1}}t.VarExpr=_;class x extends y{static fromValue(e){switch(typeof e){case"boolean":return new b(e);case"number":return new M(e);case"string":return new T(e);case"object":return null===e?w.instance:new S(e);default:throw new Error(`failed to create a literal from '${e}'`)}}exprIsDynamic(){return!1}}t.LiteralExpr=x;class w extends x{constructor(){super(),this.value=null}accept(e,t){return e.visitNullLiteralExpr(this,t)}exprIsDynamic(){return!1}}t.NullLiteralExpr=w,w.instance=new w;class b extends x{constructor(e){super(),this.value=e}accept(e,t){return e.visitBooleanLiteralExpr(this,t)}}t.BooleanLiteralExpr=b;class M extends x{constructor(e){super(),this.value=e}accept(e,t){return e.visitNumberLiteralExpr(this,t)}}t.NumberLiteralExpr=M;class T extends x{constructor(e){super(),this.value=e}get promotedValue(){var e,t,i;return void 0===this.m_promotedValue&&(this.m_promotedValue=null!==(t=null!==(e=u.RGBA.parse(this.value))&&void 0!==e?e:h.Pixels.parse(this.value))&&void 0!==t?t:null),null!==(i=this.m_promotedValue)&&void 0!==i?i:void 0}accept(e,t){return e.visitStringLiteralExpr(this,t)}}t.StringLiteralExpr=T;class S extends x{constructor(e){super(),this.value=e}get isArrayLiteral(){return Array.isArray(this.value)}accept(e,t){return e.visitObjectLiteralExpr(this,t)}}t.ObjectLiteralExpr=S;class E extends y{constructor(e){super(),this.name=e}accept(e,t){return e.visitHasAttributeExpr(this,t)}exprIsDynamic(){return!1}}t.HasAttributeExpr=E;class P extends y{constructor(e,t){super(),this.op=e,this.args=t}get children(){return this.args}accept(e,t){return e.visitCallExpr(this,t)}exprIsDynamic(){var e;const t=null!==(e=this.descriptor)&&void 0!==e?e:o.ExprEvaluator.getOperator(this.op);return!!(t&&t.isDynamicOperator&&t.isDynamicOperator(this))||this.args.some(e=>e.isDynamic())}}t.CallExpr=P;class A extends y{constructor(e,t,i){super(),this.value=e,this.branches=t,this.fallback=i}static isValidMatchLabel(e){switch(typeof e){case"number":case"string":return!0;case"object":if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every(e=>typeof e===t);default:return!1}}accept(e,t){return e.visitMatchExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()||this.branches.some(([e,t])=>t.isDynamic())||this.fallback.isDynamic()}}t.MatchExpr=A;class C extends y{constructor(e,t){super(),this.branches=e,this.fallback=t}accept(e,t){return e.visitCaseExpr(this,t)}exprIsDynamic(){return this.branches.some(([e,t])=>e.isDynamic()||t.isDynamic())||this.fallback.isDynamic()}}t.CaseExpr=C;class L extends y{constructor(e,t,i){super(),this.input=e,this.defaultValue=t,this.stops=i}accept(e,t){return e.visitStepExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.defaultValue.isDynamic()||this.stops.some(([e,t])=>t.isDynamic())}}t.StepExpr=L;class R extends y{constructor(e,t,i){super(),this.mode=e,this.input=t,this.stops=i}accept(e,t){return e.visitInterpolateExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.stops.some(([e,t])=>t.isDynamic())}}t.InterpolateExpr=R;class D{serialize(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value instanceof s.Vector2?["make-vector",e.value.x,e.value.y]:e.value instanceof s.Vector3?["make-vector",e.value.x,e.value.y,e.value.z]:e.value instanceof s.Vector4?["make-vector",e.value.x,e.value.y,e.value.z,e.value.w]:["literal",e.value]}visitVarExpr(e,t){return["get",e.name]}visitHasAttributeExpr(e,t){return["has",e.name]}visitCallExpr(e,t){return[e.op,...e.args.map(e=>this.serialize(e))]}visitMatchExpr(e,t){const i=[];for(const[t,n]of e.branches)i.push(t,this.serialize(n));return["match",this.serialize(e.value),...i,this.serialize(e.fallback)]}visitCaseExpr(e,t){const i=[];for(const[t,n]of e.branches)i.push(this.serialize(t),this.serialize(n));return["case",...i,this.serialize(e.fallback)]}visitStepExpr(e,t){const i=["step"];return i.push(this.serialize(e.input)),i.push(this.serialize(e.defaultValue)),e.stops.forEach(([e,t])=>{i.push(e),i.push(this.serialize(t))}),i}visitInterpolateExpr(e,t){const i=["interpolate",e.mode];return i.push(this.serialize(e.input)),e.stops.forEach(([e,t])=>{i.push(e),i.push(this.serialize(t))}),i}}function O(e,t){if(Array.isArray(e))return function e(t,i){const n=t[0];if("string"!=typeof n)throw new Error("expected a builtin function name");switch(n){case"!has":case"!in":return new P("!",[e([n.slice(1),...t.slice(1)])]);case"ref":return function(e,t){if("string"!=typeof e[1])throw new Error("expected the name of an attribute");if(void 0===t)throw new Error("ref used with no definitions");const i=e[1];if(t.lockedNames.has(i))throw new Error(`circular referene to '${i}'`);if(!(i in t.definitions))throw new Error(`definition '${i}' not found`);const n=t.cache.get(i);if(void 0!==n)return n;let r,s=t.definitions[i];if(c.isInterpolatedPropertyDefinition(s.value))return y.fromJSON(c.interpolatedPropertyDefinitionToJsonExpr(s.value));if(!g(s.value))return y.fromJSON(s.value);s=s.value;if(!g(s))throw new Error("unsupported definition "+i);t.lockedNames.add(i);try{r=O(s,t)}finally{t.lockedNames.delete(i)}return t.cache.set(i,r),r}(t,i);case"get":return function(e,t){if(void 0!==e[2])return I("get",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new _(i)}(t,i);case"has":return function(e,t){if(void 0!==e[2])return I("has",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new E(i)}(t,i);case"literal":return function(e){const t=e[1];if(null===t||"object"!=typeof t)throw new Error("expected an object or array literal");return new S(t)}(t);case"match":return function(e,t){if(e.length<4)throw new Error("not enough arguments");if(!(e.length%2))throw new Error("fallback is missing in 'match' expression");const i=O(e[1],t),n=[];for(let i=2;i<e.length-1;i+=2){const r=e[i];if(!A.isValidMatchLabel(r))throw new Error(`'${JSON.stringify(r)}' is not a valid label for 'match'`);const s=O(e[i+1],t);n.push([r,s])}const r=O(e[e.length-1],t);return new A(i,n,r)}(t,i);case"case":return function(e,t){if(e.length<3)throw new Error("not enough arguments");if(e.length%2)throw new Error("fallback is missing in 'case' expression");const i=[];for(let n=1;n<e.length-1;n+=2){const r=O(e[n],t),s=O(e[n+1],t);i.push([r,s])}const n=O(e[e.length-1],t);return new C(i,n)}(t,i);case"interpolate":return function(e,t){const i=e[1];if(!function(e){if(!Array.isArray(e))return!1;switch(e[0]){case"discrete":case"linear":case"cubic":case"exponential":return!0;default:return!1}}(i))throw new Error("expected an interpolation type");if("exponential"===i[0]&&"number"!=typeof i[1])throw new Error("expected the base of the exponential interpolation");const n=void 0!==e[2]?O(e[2],t):void 0;if(!y.isExpr(n))throw new Error("expected the input of the interpolation");if(3===e.length||!(e.length%2))throw new Error("invalid number of samples");const r=[];for(let i=3;i<e.length-1;i+=2){const n=e[i],s=O(e[i+1],t);r.push([n,s])}return new R(i,n,r)}(t,i);case"step":return function(e,t){if(e.length<2)throw new Error("expected the input of the 'step' operator");if(e.length<3||!(e.length%2))throw new Error("not enough arguments");const i=O(e[1],t),n=O(e[2],t),r=[];for(let i=3;i<e.length;i+=2){const n=e[i],s=O(e[i+1],t);r.push([n,s])}return new L(i,n,r)}(t,i);default:return I(n,t,i)}}(e,t);if(null===e)return w.instance;if("boolean"==typeof e)return new b(e);if("number"==typeof e)return new M(e);if("string"==typeof e)return new T(e);throw new Error("failed to create expression from: "+JSON.stringify(e))}function I(e,t,i){return new P(e,t.slice(1).map(e=>O(e,i)))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoCoordinates=t.MIN_LONGITUDE=t.MAX_LONGITUDE=t.MIN_LATITUDE=t.MAX_LATITUDE=void 0;const n=i(0),r=i(20),s=i(55),o=i(56);t.MAX_LATITUDE=90,t.MIN_LATITUDE=-90,t.MAX_LONGITUDE=180,t.MIN_LONGITUDE=-180;const a=new n.Vector3,l=new n.Vector3;class c{constructor(e,t,i){this.latitude=e,this.longitude=t,this.altitude=i}static fromDegrees(e,t,i){return new c(e,t,i)}static fromRadians(e,t,i){return new c(n.MathUtils.radToDeg(e),n.MathUtils.radToDeg(t),i)}static fromLatLng(e){return new c(e.lat,e.lng)}static fromGeoPoint(e){return new c(e[1],e[0],e[2])}static fromObject(e){if(s.isGeoPointLike(e))return c.fromGeoPoint(e);if(r.isGeoCoordinatesLike(e))return c.fromDegrees(e.latitude,e.longitude,e.altitude);if(o.isLatLngLike(e))return c.fromDegrees(e.lat,e.lng);throw new Error("Invalid input coordinate format.")}static lerp(e,t,i,n=!1,r=!1){var s,o;if(n){if(e.lng<t.lng){const n=e.clone();return n.longitude+=360,this.lerp(t,n,1-i)}{const n=t.clone();return n.longitude+=360,this.lerp(e,n,i)}}const h=a.set(e.lat,e.lng,null!==(s=e.altitude)&&void 0!==s?s:0),u=l.set(t.lat,t.lng,null!==(o=t.altitude)&&void 0!==o?o:0);h.lerp(u,i);const d=new c(h.x,h.y,h.z);return r?d.normalized():d}get latitudeInRadians(){return n.MathUtils.degToRad(this.latitude)}get longitudeInRadians(){return n.MathUtils.degToRad(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;return isNaN(e)||isNaN(t)?this:((t<-180||t>180)&&(t=function(e,t){const i=e%t;return i<0===t<0?i:i+t}(t+180,360)-180),e=n.MathUtils.clamp(e,-90,90),new c(e,t,this.altitude))}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new c(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}minLongitudeSpanTo(e){const t=Math.min(this.longitude,e.longitude),i=Math.max(this.longitude,e.longitude);return Math.min(i-t,360+t-i)}}t.GeoCoordinates=c},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(284),t),r(i(76),t),r(i(27),t),r(i(146),t),r(i(287),t),r(i(290),t),r(i(147),t),r(i(79),t),r(i(26),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileOffsetUtils=t.MapViewUtils=void 0;const n=i(2),r=i(21),s=i(1),o=i(0),a=i(32),l=i(113),c=s.LoggerManager.instance.create("MapViewUtils"),h=new o.Vector3(0,0,1),u=new o.Plane(h.clone()),d=new o.Sphere(void 0,r.EarthConstants.EQUATORIAL_RADIUS),m=new o.Raycaster,p={x:new o.Vector3,y:new o.Vector3,z:new o.Vector3},f={x:new o.Vector3,y:new o.Vector3,z:new o.Vector3},g={box3:[new o.Box3],obox3:[new n.OrientedBox3],quaternions:[new o.Quaternion,new o.Quaternion],vector2:[new o.Vector2,new o.Vector2],vector3:[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3],matrix4:[new o.Matrix4,new o.Matrix4],transforms:[{xAxis:new o.Vector3,yAxis:new o.Vector3,zAxis:new o.Vector3,position:new o.Vector3}]},v=new o.PerspectiveCamera;!function(e){function t(t,i,r,s,l,h){var u,d,m;const p=a.CameraUtils.getPrincipalPoint(t.camera,g.vector2[0]),f=e.rayCastWorldCoordinates(t,p.x,p.y);if(null===f)return;let v;if("number"==typeof i)v=g.vector2[1].set(i,r);else{const e=i;v=null!==(u=e.center)&&void 0!==u?u:p,s=null!==(d=e.deltaAzimuth)&&void 0!==d?d:0,l=null!==(m=e.deltaTilt)&&void 0!==m?m:0,h=e.maxTiltAngle}const y=v.x===p.x&&v.y===p.y?f:e.rayCastWorldCoordinates(t,v.x,v.y);if(null===y)return;!function(e,t,i){const n=e.camera,r=e.projection.surfaceNormal(t,g.vector3[0]),s=g.quaternions[0].setFromAxisAngle(r,i);n.quaternion.premultiply(s),n.position.sub(t),n.position.applyQuaternion(s),n.position.add(t)}(t,y,-s);const _=new o.Vector3(1,0,0).applyQuaternion(t.camera.quaternion);!function(t,i,n,r){const s=t.camera,o=s.position.clone(),a=s.quaternion.clone(),l=g.quaternions[0].setFromAxisAngle(r,n);s.quaternion.premultiply(l),s.position.sub(i),s.position.applyQuaternion(l),s.position.add(i),null===e.rayCastWorldCoordinates(t,0,0)&&(c.warn("Target got invalidated during rotation."),s.position.copy(o),s.quaternion.copy(a))}(t,y,function(e,t,i,r,s,a,l){const c=e.camera,h=e.projection,u=P(h,c,s,l);if(u+i<0)return-u;if(i<=0)return i;if(s.equals(a)||t<0)return n.MathUtils.clamp(i+u,0,r)-u;const d=P(h,c,a,l),m=o.MathUtils.degToRad(89);if(d>m)return 0;let p=0;if(h===n.sphereProjection){const e=h.surfaceNormal(a,g.vector3[0]).projectOnPlane(l).normalize(),t=h.surfaceNormal(s,g.vector3[1]);p=e.angleTo(t)}const f=o.MathUtils.degToRad(90),v=f+p-(2*f-(2*f-(f+p-d+(f+u)))-f-r);return n.MathUtils.clamp(i+d,0,Math.min(v,m))-d}(t,v.y-p.y,l,h,f,y,_),_)}function i(e,t,i){const s=g.vector3[0].copy(e.position),a=e.getWorldDirection(g.vector3[1]);m.set(s,a),void 0!==i&&(u.constant-=i,d.radius+=i);const l=new o.Vector3,c=t.type===n.ProjectionType.Planar?m.ray.intersectPlane(u,l):m.ray.intersectSphere(d,l);return void 0!==i&&(u.constant=0,d.radius=r.EarthConstants.EQUATORIAL_RADIUS),c}function h(t,i,r){const s={target:t,distance:i},l=r.worldMaxBounds,c=r.camera,h=r.projection;if(!l)return s;const u=l.getSize(g.vector3[1]),d=r.renderer.getSize(g.vector2[0]),m=a.CameraUtils.convertScreenToWorldSize(r.focalLength,s.distance,d.height),p=m*c.aspect,f=Math.max(p/u.x,m/u.y),v=new o.Vector3(p/2,m/2,0),y={target:s.target.clone(),distance:s.distance};if(h.type===n.ProjectionType.Planar){if(f>1)y.distance/=f,c.getWorldDirection(c.position).multiplyScalar(-y.distance).add(l.getCenter(y.target));else{if(g.box3[0].copy(l).expandByVector(v.multiplyScalar(-1)).clampPoint(s.target,y.target).setZ(s.target.z),y.target.equals(s.target))return s;c.position.x+=y.target.x-s.target.x,c.position.y+=y.target.y-s.target.y}return y}if(f>1)l.getCenter(y.target),y.target.setLength(s.target.length()),y.distance/=f;else{const e=g.obox3[0];e.copy(l),e.position.setLength(s.target.length()),e.extents.sub(v);const t=e.getRotationMatrix(g.matrix4[0]),i=g.vector3[1].copy(y.target).sub(e.position).applyMatrix4(g.matrix4[1].copy(t).transpose()).setZ(0),n=g.vector3[2].copy(i).clamp(g.vector3[3].copy(e.extents).multiplyScalar(-1),e.extents);if(n.equals(i))return s;y.target.copy(n).applyMatrix4(t).add(e.position);const r=e.position.lengthSq(),o=y.target.distanceToSquared(e.position),a=Math.sqrt(r)-Math.sqrt(r-o);y.target.addScaledVector(e.zAxis,-a),y.target.setLength(s.target.length())}return e.panCameraAroundGlobe(r,g.vector3[1].copy(y.target),g.vector3[2].copy(s.target)),c.getWorldDirection(c.position).multiplyScalar(-y.distance).add(y.target),y}function y(e,t,i,s,a,l=new o.Vector3){const c=o.MathUtils.degToRad(s),h=Math.cos(c)*t,u=o.MathUtils.degToRad(i);a.projectPoint(e,l);const d=t*Math.sin(c);if(a.type===n.ProjectionType.Planar)l.x=l.x+Math.sin(u)*d,l.y=l.y-Math.cos(u)*d,l.z=l.z+h;else if(a.type===n.ProjectionType.Spherical){f.z.copy(l).normalize(),f.y.set(0,0,1).projectOnPlane(f.z).normalize(),g.quaternions[0].setFromAxisAngle(f.z,u-Math.PI),f.y.applyQuaternion(g.quaternions[0]),f.y.setLength(d);const e=t*Math.cos(c);l.add(f.y).add(f.z.setLength(e));const i=r.EarthConstants.EQUATORIAL_RADIUS+h,n=Math.sin(c)*t,s=Math.sqrt(i*i+n*n);l.setLength(s)}return l}function _(e,t){const i=t.clone().normalize();for(const n of e)if(n.angleTo(t)>Math.PI/2){const e=n.length();n.projectOnPlane(i).setLength(e)}}function x(e,t,i){const n=g.vector3[0].copy(t).sub(i.position).length(),r=a.CameraUtils.getPrincipalPoint(i);let s=n;const o=(e,t)=>Math.abs(e)>1?Math.abs((e-t)/(.99*Math.sign(e)-t)):1;for(const t of e){const e=-g.vector3[0].copy(t).applyMatrix4(i.matrixWorldInverse).z,a=g.vector3[0].applyMatrix4(i.projectionMatrix),l=Math.max(o(a.x,r.x),o(a.y,r.y));if(l>1){const t=n-e,i=Math.abs(e)*l+t;s=Math.max(s,i)}}return s}function w(e,t,i,s){const a=g.vector3[0].set(t,i,0);e.camera.updateMatrixWorld();const l=g.vector3[1].copy(e.camera.position);g.matrix4[0].extractRotation(e.camera.matrixWorld),g.matrix4[1].multiplyMatrices(g.matrix4[0],g.matrix4[1].copy(e.camera.projectionMatrix).invert());const c=a.applyMatrix4(g.matrix4[1]);m.set(l,c.normalize()),void 0!==s&&(u.constant-=s,d.radius+=s);const h=new o.Vector3,p=e.projection.type===n.ProjectionType.Planar?m.ray.intersectPlane(u,h):m.ray.intersectSphere(d,h);return void 0!==s&&(u.constant=0,d.radius=r.EarthConstants.EQUATORIAL_RADIUS),p}function b(e,t,i){e.camera.position.x+=t,e.camera.position.y+=i}function M(e,t,i){g.quaternions[0].setFromUnitVectors(t.normalize(),i.normalize()).invert(),g.matrix4[0].makeRotationFromQuaternion(g.quaternions[0]),e.camera.applyMatrix4(g.matrix4[0]),e.camera.updateMatrixWorld()}function T(e,t,i,n,r=new o.Quaternion){const s=g.transforms[0];return e.localTangentSpace(t,s),g.matrix4[0].makeBasis(s.xAxis,s.yAxis,s.zAxis),r.setFromRotationMatrix(g.matrix4[0]),g.quaternions[0].setFromAxisAngle(g.vector3[1].set(0,0,1),o.MathUtils.degToRad(i)),g.quaternions[1].setFromAxisAngle(g.vector3[1].set(1,0,0),o.MathUtils.degToRad(n)),r.multiply(g.quaternions[0]),r.multiply(g.quaternions[1]),r}function S(t,i){if(i.type===n.ProjectionType.Planar){const e=t.getWorldDirection(g.vector3[0]).normalize(),n=i.surfaceNormal(t.position,g.vector3[1]).negate(),r=e.dot(n);return Math.acos(o.MathUtils.clamp(r,-1,1))}{s.assert(i.type===n.ProjectionType.Spherical);const r=e.getGeoTargetFromCamera(t,i);return null!==r?e.extractTiltAngleFromLocation(i,t,r):(c.warn("MapView camera is pointing in the void, using maxTilt: ",e.MAX_TILT_RAD),e.MAX_TILT_RAD)}}function E(e,t){g.vector3[1].setFromMatrixPosition(t.matrixWorld),e.projection.localTangentSpace(g.vector3[1],{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]}),g.matrix4[1].makeBasis(f.x,f.y,f.z),g.matrix4[0].copy(g.matrix4[1]).invert().multiply(t.matrixWorld),p.x.setFromMatrixColumn(g.matrix4[0],0),p.y.setFromMatrixColumn(g.matrix4[0],1),p.z.setFromMatrixColumn(g.matrix4[0],2);let i=0,n=0,r=0;const s=p.z.dot(g.vector3[1].set(0,0,1));return s<1-Number.EPSILON?s>-1+Number.EPSILON?(i=Math.atan2(p.z.x,-p.z.y),n=Math.acos(p.z.z),r=Math.atan2(p.x.z,p.y.z)):(i=-Math.atan2(-p.y.x,p.x.x),n=180,r=0):(i=Math.atan2(-p.y.x,p.x.x),n=0,r=0),{yaw:i,pitch:n,roll:r}}function P(e,t,i,n){e.localTangentSpace(i,{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]});const r=g.vector3[2].copy(t.position).sub(g.vector3[0]);n&&(r.projectOnPlane(n),f.z.projectOnPlane(n).normalize());const s=r.length();if(s<1e-5)return c.error("Can not calculate tilt for the zero length vector!"),0;r.divideScalar(s);const a=r.dot(f.z);return a>=1-Number.EPSILON?0:Math.acos(o.MathUtils.clamp(a,-1,1))}function A(e,t){const i=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*i/256}e.MAX_TILT_DEG=89,e.MAX_TILT_RAD=e.MAX_TILT_DEG*o.MathUtils.DEG2RAD,e.zoomOnTargetPosition=function(i,r,s,o,a=e.MAX_TILT_RAD){const{elevationProvider:l,camera:c,projection:u}=i,d=l?l.getHeight(u.unprojectPoint(c.position),4):void 0,m=w(i,r,s,d),p=e.getTargetAndDistance(u,c,l).target,f=A(i,o);if(i.geoMaxBounds){if(h(p,f,i).distance!==f)return o>=i.zoomLevel}if(c.getWorldDirection(c.position).multiplyScalar(-f).add(p),u.type===n.ProjectionType.Spherical){const e=S(c,u)-a;e>0&&t(i,{deltaTilt:e,maxTiltAngle:a})}const g=w(i,r,s,d);return!m||!g||(u.type===n.ProjectionType.Planar?(m.sub(g),b(i,m.x,m.y)):u.type===n.ProjectionType.Spherical&&M(i,m,g),!0)},e.orbitAroundScreenPoint=t,e.getGeoTargetFromCamera=function(e,t,n){const r=i(e,t,n);return null!==r?t.unprojectPoint(r):null},e.getWorldTargetFromCamera=i,e.constrainTargetAndDistanceToViewBounds=h,e.getTargetAndDistance=function(t,s,o){const a=E({projection:t},s).pitch,l=o?o.getHeight(t.unprojectPoint(s.position),4):void 0,c=!o||void 0!==l,h=a<e.MAX_TILT_RAD?i(s,t,l):null;if(null!==h){return{target:h,distance:s.position.distanceTo(h),final:c}}{const i=t.groundDistance(s.position),o=Math.max(i-(null!=l?l:0),0),h=t.type===n.ProjectionType.Planar?o/Math.cos(Math.min(a,e.MAX_TILT_RAD)):Math.sqrt(Math.pow(o+r.EarthConstants.EQUATORIAL_RADIUS,2)-Math.pow(r.EarthConstants.EQUATORIAL_RADIUS,2)),u=s.getWorldDirection(g.vector3[0]);u.multiplyScalar(h);const d=g.vector3[1];return d.copy(s.position).add(u),{target:d,distance:h,final:c}}},e.getCameraPositionFromTargetCoordinates=y,e.wrapGeoPointsToScreen=function(e,t){let i=0;void 0===t&&(t=n.GeoCoordinates.fromObject(e[0]),i=1);let r=t.latitude,s=t.latitude,o=n.MathUtils.normalizeLongitudeDeg(t.longitude),a=0,l=t.longitude,c=t.longitude;const h=[];h.push(new n.GeoCoordinates(r,o));for(let t=i;t<e.length;t++){const i=n.GeoCoordinates.fromObject(e[t]);i.latitude>r?r=i.latitude:i.latitude<s&&(s=i.latitude);let u=n.MathUtils.normalizeLongitudeDeg(i.longitude);const d=n.MathUtils.angleDistanceDeg(o,u);u=o-d,d<0&&-d>a/2?(l=Math.max(l,o-d),a=l-c,o=(l+c)/2):d>0&&d>a/2&&(c=Math.min(c,u),a=l-c,o=(l+c)/2),h.push(new n.GeoCoordinates(i.latitude,u))}return h},e.wrapWorldPointsToView=_,e.geoBoxToGeoPoints=function(e){const t=e.center;return[new n.GeoCoordinates(e.north,e.west),new n.GeoCoordinates(e.north,e.east),new n.GeoCoordinates(t.latitude,e.west),new n.GeoCoordinates(t.latitude,e.east),new n.GeoCoordinates(e.south,e.west),new n.GeoCoordinates(e.south,e.east),new n.GeoCoordinates(e.north,t.longitude),new n.GeoCoordinates(e.south,t.longitude)]},e.getFitBoundsDistance=x,e.getFitBoundsLookAtParams=function(e,t,i,r){const{tilt:s,heading:o,projection:a}=r,l=r.minDistance,c=r.camera.clone();return T(a,e,-o,s,c.quaternion),y(e,l,-o,s,a,c.position),c.updateMatrixWorld(!0),a.type===n.ProjectionType.Spherical&&_(i,c.position),{target:e,distance:x(i,t,c),heading:o,tilt:s}},e.getCameraCoordinatesFromTargetCoordinates=function(e,t,i,n,r){return r.projection.unprojectPoint(y(e,t,i,n,r.projection,g.vector3[1]))},e.rayCastWorldCoordinates=w,e.panCameraAboveFlatMap=b,e.panCameraAroundGlobe=M,e.rotate=function(t,i,s=0,a=Math.PI/4){if(t.camera.rotateOnWorldAxis(t.projection.type===n.ProjectionType.Spherical?g.vector3[0].copy(t.camera.position).normalize():g.vector3[0].set(0,0,1),o.MathUtils.degToRad(-i)),t.camera.updateMatrixWorld(),0===s)return;const l=e.extractAttitude(t,t.camera).pitch;let c=o.MathUtils.clamp(l+o.MathUtils.degToRad(s),0,a);if(t.projection.type===n.ProjectionType.Spherical){const e=Math.asin(r.EarthConstants.EQUATORIAL_RADIUS*Math.sin(Math.PI-a)/t.camera.position.length());c=Math.min(c,e)}t.camera.rotateX(c-l)},e.getCameraRotationAtTarget=T,e.setRotation=function(e,t,i){T(e.projection,e.geoCenter,t,i,e.camera.quaternion)},e.extractCameraTilt=S,e.extractAttitude=E,e.extractSphericalCoordinatesFromLocation=function(e,t,i){e.projection.localTangentSpace(i,{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]});let n=0,r=0;return g.vector3[1].copy(t.position).sub(g.vector3[0]).normalize(),g.vector3[1].dot(f.z)>1-Number.EPSILON?(r=Math.PI-E(e,t).yaw,r=Math.atan2(Math.sin(r),Math.cos(r)),n=0,{tilt:n,azimuth:r}):(n=g.vector3[1].angleTo(f.z),g.vector3[1].copy(t.position).sub(g.vector3[0]).projectOnPlane(f.z).normalize(),r=g.vector3[1].angleTo(f.y),g.vector3[1].cross(f.y).dot(f.z)<0&&(r=-r),{tilt:n,azimuth:r})},e.extractTiltAngleFromLocation=P,e.getCameraFrustumPlanes=function(e){const t=e.near,i=e.far;let n=t*Math.tan(o.MathUtils.degToRad(.5*e.fov))/e.zoom,r=2*n,s=e.aspect*r,a=-.5*s;const l=e.view;if(null!==l&&l.enabled){const e=l.fullWidth,t=l.fullHeight;a+=l.offsetX*s/e,n-=l.offsetY*r/t,s*=l.width/e,r*=l.height/t}return a+=0!==e.filmOffset?t*e.filmOffset/e.getFilmWidth():0,{left:a,right:a+s,top:n,bottom:n-r,near:t,far:i}},e.rayCastGeoCoordinates=function(e,t,i){const n=w(e,t,i);return n?e.projection.unprojectPoint(n):null},e.calculateDistanceToGroundFromZoomLevel=function(e,t){const i=E(e,e.camera).pitch,n=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*n/256*Math.cos(i)},e.calculateDistanceFromZoomLevel=A,e.calculateZoomLevelFromDistance=function(e,t){const i=256*t/e.focalLength;return function(e){const t=Math.ceil(e);return t-e<1e-6?t:e}(o.MathUtils.clamp(Math.log2(r.EarthConstants.EQUATORIAL_CIRCUMFERENCE/i),e.minZoomLevel,e.maxZoomLevel))},e.calculateDepthFromClipDistance=function(e,t){const i=t,n=i.far-i.near,r=e*i.far;return(1-i.near/r)*(i.far/n)},e.cameraToWorldDistance=function(e,t){return e*t.far},e.calculateVerticalFovByHorizontalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)/t)},e.calculateHorizontalFovByVerticalFov=function(e,t){return v.fov=o.MathUtils.radToDeg(e),v.aspect=t,a.CameraUtils.getHorizontalFov(v)},e.calculateFocalLengthByVerticalFov=function(e,t){return a.CameraUtils.setPrincipalPoint(v,new o.Vector2),a.CameraUtils.setVerticalFov(v,e,t),a.CameraUtils.getFocalLength(v)},e.calculateFovByFocalLength=function(e,t){return a.CameraUtils.setPrincipalPoint(v,new o.Vector2),a.CameraUtils.setFocalLength(v,e,t),v.fov},e.calculateScreenSizeByFocalLength=a.CameraUtils.convertWorldToScreenSize,e.calculateWorldSizeByFocalLength=a.CameraUtils.convertScreenToWorldSize,e.estimateObject3dSize=l.Object3DUtils.estimateSize,e.mapViewIsLoading=function(e){let t=0;for(const i of e.visibleTileSet.dataSourceTileList){t+=i.numTilesLoading;for(const e of i.visibleTiles)e.allGeometryLoaded||t++}let i=t>0;return void 0!==e.textElementsRenderer&&(i=i||e.textElementsRenderer.loading),i=i||!e.poiTableManager.finishedLoading||!e.visibleTileSet.allVisibleTilesLoaded,i},e.closeToFrustum=function(e,t,i=1e-13){const n=(new o.Vector3).copy(e).project(t);return Math.abs(n.x)-i<1&&Math.abs(n.y)-i<1&&Math.abs(n.z)-i<1},e.getBrowserLanguages=s.DOMUtils.getBrowserLanguages}(t.MapViewUtils||(t.MapViewUtils={})),function(e){e.getKeyForTileKeyAndOffset=n.TileKeyUtils.getKeyForTileKeyAndOffset,e.extractOffsetAndMortonKeyFromKey=n.TileKeyUtils.extractOffsetAndMortonKeyFromKey,e.getParentKeyFromKey=n.TileKeyUtils.getParentKeyFromKey}(t.TileOffsetUtils||(t.TileOffsetUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RawShaderMaterial=void 0;const n=i(1),r=i(0),s=i(11);class o extends r.RawShaderMaterial{constructor(e){const t=!0===(null==e?void 0:e.rendererCapabilities.isWebGL2),i=e?Object.assign(Object.assign({},e),{glslVersion:t?r.GLSL3:r.GLSL1,vertexShader:t&&e.vertexShader?n.convertVertexShaderToWebGL2(e.vertexShader):e.vertexShader,fragmentShader:t&&e.fragmentShader?n.convertFragmentShaderToWebGL2(e.fragmentShader):e.fragmentShader}):void 0;i&&delete i.rendererCapabilities,super(i),this.invalidateFog(),this.setOpacity(null==i?void 0:i.opacity)}invalidateFog(){void 0!==this.defines&&this.fog!==s.getShaderMaterialDefine(this,"USE_FOG")&&s.setShaderMaterialDefine(this,"USE_FOG",this.fog)}setOpacity(e){var t;void 0!==e&&(this.opacity=e,(null===(t=this.uniforms)||void 0===t?void 0:t.opacity)&&(this.uniforms.opacity.value=e))}}t.RawShaderMaterial=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShaderDefine=t.setShaderDefine=t.getShaderMaterialDefine=t.setShaderMaterialDefine=t.disableBlending=t.enableBlending=t.enforceBlending=t.insertShaderInclude=t.DEFINE_BOOL_FALSE=t.DEFINE_BOOL_TRUE=void 0;const n=i(1),r=i(0);function s(e){!0!==e.transparent&&!0!==e.forcedBlending&&(e.blending=r.CustomBlending,!0===e.premultipliedAlpha?(e.blendSrc=r.OneFactor,e.blendDst=r.OneMinusSrcAlphaFactor,e.blendSrcAlpha=r.OneFactor,e.blendDstAlpha=r.OneMinusSrcAlphaFactor):(e.blendSrc=r.SrcAlphaFactor,e.blendDst=r.OneMinusSrcAlphaFactor,e.blendSrcAlpha=r.OneFactor,e.blendDstAlpha=r.OneMinusSrcAlphaFactor))}function o(e,t,i=!1){return void 0===e.defines?i:l(e.defines,t)}function a(e,i,n){let r=!1;return"number"==typeof n?(r=e[i]!==n,e[i]=n):!0===n?(r=e[i]!==t.DEFINE_BOOL_TRUE,e[i]=t.DEFINE_BOOL_TRUE):!1===n&&void 0!==e[i]&&(delete e[i],r=!0),r}function l(e,i){const n=e[i];return n!==t.DEFINE_BOOL_FALSE&&(n===t.DEFINE_BOOL_TRUE||n)}t.DEFINE_BOOL_TRUE="",t.DEFINE_BOOL_FALSE=void 0,t.insertShaderInclude=function(e,t,i,n){const r=!0===n?"\t":"";return e.replace(`#include <${t}>`,`#include <${t}>\n${r}#include <${i}>`)},t.enforceBlending=function(e){e.transparent||(s(e),e.forcedBlending=!0)},t.enableBlending=s,t.disableBlending=function(e){!0!==e.transparent&&!0!==e.forcedBlending&&(e.blending=r.NormalBlending)},t.setShaderMaterialDefine=function(e,t,i){n.assert(void 0!==e.defines,"Do not use this function in ShaderMaterial derived c-tor.");const r=i!==o(e,t);return!!r&&(a(e.defines,t,i),e.needsUpdate=r,!0)},t.getShaderMaterialDefine=o,t.setShaderDefine=a,t.getShaderDefine=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoBox=void 0;const n=i(0),r=i(7);class s{constructor(e,t){this.southWest=e,this.northEast=t,this.west>this.east&&(this.northEast.longitude+=360)}static fromCoordinates(e,t){return new s(e,t)}static fromCenterAndExtents(e,t){return new s(new r.GeoCoordinates(e.latitude-t.latitudeSpan/2,e.longitude-t.longitudeSpan/2),new r.GeoCoordinates(e.latitude+t.latitudeSpan/2,e.longitude+t.longitudeSpan/2))}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:i}=this,{minAltitude:n,altitudeSpan:s}=this;let o;if(void 0!==n&&void 0!==s&&(o=n+.5*s),t<=i)return new r.GeoCoordinates(e,.5*(t+i),o);let a=.5*(360+i+t);return a>360&&(a-=360),new r.GeoCoordinates(e,a,o)}get latitudeSpanInRadians(){return n.MathUtils.degToRad(this.latitudeSpan)}get longitudeSpanInRadians(){return n.MathUtils.degToRad(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,i=this.minAltitude===e.altitude,n=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!!(t?i:n)&&this.containsHelper(e)}clone(){return new s(this.southWest.clone(),this.northEast.clone())}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:i}=this;let n=e.longitude;if(i>r.MAX_LONGITUDE)for(;n<t;)n+=360;if(n>i)for(;n>t+360;)n-=360;return n>=t&&n<i}}t.GeoBox=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils=void 0;const n=i(0);!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function i(e,i){const n=(e=t(e))-(i=t(i));return n>180?n-360:n<=-180?n+360:n}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,i,n){return void 0===n?{x:e,y:t,z:i}:(n.x=e,n.y=t,n.z=i,n)},e.copyVector3=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.degToRad=n.MathUtils.degToRad,e.radToDeg=n.MathUtils.radToDeg,e.clamp=n.MathUtils.clamp,e.normalizeAngleDeg=t,e.normalizeLongitudeDeg=function(e){return(e=t(e))>180&&(e-=360),e},e.angleDistanceDeg=i,e.interpolateAnglesDeg=function(e,t,n){return(e+i(t,e)*n)%360}}(t.MathUtils||(t.MathUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Projection=t.ProjectionType=void 0;const n=i(20),r=i(13);!function(e){e[e.Planar=0]="Planar",e[e.Spherical=1]="Spherical"}(t.ProjectionType||(t.ProjectionType={}));t.Projection=class{constructor(e){this.unitScale=e}localTangentSpace(e,t){return n.isGeoCoordinatesLike(e)?this.projectPoint(e,t.position):r.MathUtils.copyVector3(e,t.position),r.MathUtils.newVector3(1,0,0,t.xAxis),r.MathUtils.newVector3(0,1,0,t.yAxis),r.MathUtils.newVector3(0,0,1,t.zAxis),t}reprojectPoint(e,t,i){return e===this?void 0===i?{x:t.x,y:t.y,z:t.z}:(i.x=t.x,i.y=t.y,i.z=t.z,i):this.projectPoint(e.unprojectPoint(t),i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapView=t.MapViewPowerPreference=t.MapViewEventNames=t.TileTaskGroups=void 0;const n=i(3),r=i(2),s=i(1),o=i(0),a=i(99),l=i(46),c=i(125),h=i(32),u=i(71),d=i(126),m=i(128),p=i(131),f=i(73),g=i(133),v=i(66),y=i(134),_=i(136),x=i(276),w=i(74),b=i(140),M=i(277),T=i(280),S=i(281),E=i(75),P=i(143),A=i(154),C=i(155),L=i(308),R=i(35),D=i(309),O=i(47),I=i(310),F=i(9),V=i(156);var U;s.LoggerManager.instance.setLogLevelForAll(s.LogLevel.Error),function(e){e.FETCH_AND_DECODE="fetch",e.CREATE="create"}(t.TileTaskGroups||(t.TileTaskGroups={})),function(e){e.Update="update",e.Resize="resize",e.Render="render",e.AfterRender="didrender",e.FirstFrame="first-render",e.FrameComplete="frame-complete",e.ThemeLoaded="theme-loaded",e.AnimationStarted="animation-started",e.AnimationFinished="animation-finished",e.MovementStarted="movement-started",e.MovementFinished="movement-finished",e.DataSourceConnect="datasource-connect",e.CopyrightChanged="copyright-changed",e.ContextLost="webglcontext-lost",e.ContextRestored="webglcontext-restored",e.CameraPositionChanged="camera-changed",e.Dispose="dispose"}(U=t.MapViewEventNames||(t.MapViewEventNames={}));const N=s.LoggerManager.instance.create("MapView"),B={vector2:[new o.Vector2],vector3:[new o.Vector3,new o.Vector3,new o.Vector3],rayCaster:new o.Raycaster,groundPlane:new o.Plane,groundSphere:new o.Sphere(void 0,r.EarthConstants.EQUATORIAL_RADIUS),matrix4:[new o.Matrix4,new o.Matrix4],transform:[{position:new o.Vector3,xAxis:new o.Vector3,yAxis:new o.Vector3,zAxis:new o.Vector3}],color:new o.Color};var k;!function(e){e.Default="default",e.LowPower="low-power",e.HighPerformance="high-performance"}(k=t.MapViewPowerPreference||(t.MapViewPowerPreference={}));const z={projection:r.mercatorProjection,addBackgroundDatasource:!0,maxVisibleDataSourceTiles:100,extendedFrustumCulling:!0,tileCacheSize:200,resourceComputationType:V.ResourceComputationType.EstimationInMb,quadTreeSearchDistanceUp:3,quadTreeSearchDistanceDown:2,pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1,target:new r.GeoCoordinates(25,0),zoomLevel:5,tilt:0,heading:0,theme:{},maxTilesPerFrame:0};class G extends g.EventDispatcher{constructor(e){var t,i;super(),this.UPDATE_EVENT={type:U.Update},this.RENDER_EVENT={type:U.Render},this.DID_RENDER_EVENT={type:U.AfterRender},this.FIRST_FRAME_EVENT={type:U.FirstFrame},this.FRAME_COMPLETE_EVENT={type:U.FrameComplete},this.THEME_LOADED_EVENT={type:U.ThemeLoaded},this.ANIMATION_STARTED_EVENT={type:U.AnimationStarted},this.ANIMATION_FINISHED_EVENT={type:U.AnimationFinished},this.MOVEMENT_STARTED_EVENT={type:U.MovementStarted},this.MOVEMENT_FINISHED_EVENT={type:U.MovementFinished},this.CONTEXT_LOST_EVENT={type:U.ContextLost},this.CONTEXT_RESTORED_EVENT={type:U.ContextRestored},this.COPYRIGHT_CHANGED_EVENT={type:U.CopyrightChanged},this.DISPOSE_EVENT={type:U.Dispose},this.m_renderLabels=!0,this.m_visibleTileSetLock=!1,this.m_tileWrappingEnabled=!0,this.m_zoomLevel=1,this.m_minZoomLevel=1,this.m_maxZoomLevel=20,this.m_minCameraHeight=20,this.m_rteCamera=new o.PerspectiveCamera,this.m_yaw=0,this.m_pitch=0,this.m_roll=0,this.m_targetDistance=0,this.m_targetGeoPos=r.GeoCoordinates.fromObject(z.target),this.m_targetWorldPos=new o.Vector3,this.m_viewRanges={near:.1,far:4e6,minimum:.1,maximum:4e6},this.m_scene=new o.Scene,this.m_overlayScene=new o.Scene,this.m_sceneRoot=new o.Object3D,this.m_overlaySceneRoot=new o.Object3D,this.m_mapAnchors=new b.MapAnchors,this.m_animationCount=0,this.m_drawing=!1,this.m_updatePending=!1,this.m_frameNumber=0,this.m_forceCameraAspect=void 0,this.m_taskSchedulerTimeout=void 0,this.m_tileDataSources=[],this.m_connectedDataSources=new Set,this.m_failedDataSources=new Set,this.m_enablePolarDataSource=!0,this.m_raycaster=new o.Raycaster,this.m_plane=new o.Plane(new o.Vector3(0,0,1)),this.m_sphere=new o.Sphere(void 0,r.EarthConstants.EQUATORIAL_RADIUS),this.m_firstFrameRendered=!1,this.m_firstFrameComplete=!1,this.m_initialTextPlacementDone=!1,this.m_userImageCache=new w.MapViewImageCache,this.m_env=new n.MapEnv({}),this.m_poiManager=new P.PoiManager(this),this.m_poiTableManager=new A.PoiTableManager(this),this.m_lastTileIds="",this.m_copyrightInfo=[],this.m_disposed=!1,this.onWebGLContextLost=e=>{this.dispatchEvent(this.CONTEXT_LOST_EVENT),N.warn("WebGL context lost",e)},this.onWebGLContextRestored=e=>{this.dispatchEvent(this.CONTEXT_RESTORED_EVENT),void 0!==this.m_renderer&&(this.textElementsRenderer.restoreRenderers(this.m_renderer),this.getTheme().then(e=>{this.m_sceneEnvironment.updateClearColor(e.clearColor,e.clearAlpha),this.update()})),N.warn("WebGL context restored",e)},this.m_options=Object.assign({},e),this.m_uriResolver=this.m_options.uriResolver,void 0!==this.m_options.minZoomLevel&&(this.m_minZoomLevel=this.m_options.minZoomLevel),void 0!==this.m_options.maxZoomLevel&&(this.m_maxZoomLevel=this.m_options.maxZoomLevel),void 0!==this.m_options.minCameraHeight&&(this.m_minCameraHeight=this.m_options.minCameraHeight),void 0!==this.m_options.maxBounds&&(this.m_geoMaxBounds=this.m_options.maxBounds),void 0!==this.m_options.decoderUrl&&(m.ConcurrentDecoderFacade.defaultScriptUrl=this.m_uriResolver?this.m_uriResolver.resolveUri(this.m_options.decoderUrl):this.m_options.decoderUrl),void 0!==this.m_options.decoderCount&&(m.ConcurrentDecoderFacade.defaultWorkerCount=this.m_options.decoderCount),this.m_visibleTileSetOptions=Object.assign(Object.assign({},z),{clipPlanesEvaluator:void 0!==e.clipPlanesEvaluator?e.clipPlanesEvaluator:u.createDefaultClipPlanesEvaluator()}),void 0!==e.projection&&(this.m_visibleTileSetOptions.projection=e.projection),void 0!==e.extendedFrustumCulling&&(this.m_visibleTileSetOptions.extendedFrustumCulling=e.extendedFrustumCulling),void 0!==e.maxVisibleDataSourceTiles&&(this.m_visibleTileSetOptions.maxVisibleDataSourceTiles=e.maxVisibleDataSourceTiles),void 0!==e.tileCacheSize&&(this.m_visibleTileSetOptions.tileCacheSize=e.tileCacheSize),void 0!==e.resourceComputationType&&(this.m_visibleTileSetOptions.resourceComputationType=e.resourceComputationType),void 0!==e.quadTreeSearchDistanceUp&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceUp=e.quadTreeSearchDistanceUp),void 0!==e.quadTreeSearchDistanceDown&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceDown=e.quadTreeSearchDistanceDown),void 0!==e.enablePolarDataSource&&(this.m_enablePolarDataSource=e.enablePolarDataSource),this.m_pixelRatio=e.pixelRatio,this.m_options.maxFps=null!==(t=this.m_options.maxFps)&&void 0!==t?t:0,this.m_options.enableStatistics=!0===this.m_options.enableStatistics,this.m_languages=this.m_options.languages,this.m_politicalView=this.m_options.politicalView,this.handleRequestAnimationFrame=this.renderLoop.bind(this),void 0!==this.m_options.tileWrappingEnabled&&(this.m_tileWrappingEnabled=this.m_options.tileWrappingEnabled),this.setupStats(this.m_options.enableStatistics),this.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.m_renderer=new(null!==(i=o.WebGL1Renderer)&&void 0!==i?i:o.WebGLRenderer)({canvas:this.canvas,context:this.m_options.context,antialias:this.nativeWebglAntialiasEnabled,alpha:this.m_options.alpha,preserveDrawingBuffer:!0===this.m_options.preserveDrawingBuffer,powerPreference:void 0===this.m_options.powerPreference?k.Default:this.m_options.powerPreference}),this.m_renderer.autoClear=!1,this.m_renderer.debug.checkShaderErrors=!1,this.m_renderer.info.autoReset=!1,this.m_tileObjectRenderer=new I.TileObjectRenderer(this.m_env,this.m_renderer),this.setupRenderer(this.m_tileObjectRenderer),this.m_options.fovCalculation=void 0===this.m_options.fovCalculation?v.DEFAULT_FOV_CALCULATION:this.m_options.fovCalculation,this.m_options.fovCalculation.fov=o.MathUtils.clamp(this.m_options.fovCalculation.fov,v.MIN_FOV_DEG,v.MAX_FOV_DEG);const{width:l,height:h}=this.getCanvasClientSize(),p=l/h;this.m_camera=new o.PerspectiveCamera(this.m_options.fovCalculation.fov,p,.1,4e6),this.m_camera.up.set(0,0,1),this.setFovOnCamera(this.m_options.fovCalculation,h),this.projection.projectPoint(this.m_targetGeoPos,this.m_targetWorldPos),this.m_scene.add(this.m_camera),this.m_screenProjector=new L.ScreenProjector(this.m_camera),this.m_taskScheduler=new T.MapViewTaskScheduler(this.maxFps),this.m_tileGeometryManager=new x.TileGeometryManager(this),void 0!==e.enableMixedLod&&(this.m_enableMixedLod=e.enableMixedLod),void 0!==e.lodMinTilePixelSize&&(this.m_lodMinTilePixelSize=e.lodMinTilePixelSize),this.m_visibleTiles=this.createVisibleTileSet(),this.m_sceneEnvironment=new M.MapViewEnvironment(this,e),this.setupCamera(),this.m_pickHandler=new E.PickHandler(this,this.m_rteCamera,!0===this.m_options.enablePickTechnique),this.m_movementDetector=new c.CameraMovementDetector(this.m_options.movementThrottleTimeout,()=>this.movementStarted(),()=>this.movementFinished());const f=this.m_options.customAntialiasSettings;if(this.mapRenderingManager=new d.MapRenderingManager(l,h,this.m_options.dynamicPixelRatio,f),this.m_animatedExtrusionHandler=new a.AnimatedExtrusionHandler(this),this.m_enablePolarDataSource){const t=void 0!==e.polarStyleSetName?e.polarStyleSetName:"polar";this.m_polarDataSource=new C.PolarTileDataSource({styleSetName:t,geometryLevelOffset:e.polarGeometryLevelOffset}),this.updatePolarDataSource()}this.m_taskScheduler.addEventListener(U.Update,()=>{this.update()}),void 0!==e.throttlingEnabled&&(this.m_taskScheduler.throttlingEnabled=e.throttlingEnabled),this.m_themeManager=new S.MapViewThemeManager(this,this.m_uriResolver),this.m_textElementsRenderer=this.createTextRenderer(),this.setTheme(s.getOptionValue(this.m_options.theme,z.theme)),this.update()}get lights(){return this.m_sceneEnvironment.lights}get taskQueue(){return this.m_taskScheduler.taskQueue}get renderLabels(){return this.m_renderLabels}set renderLabels(e){this.m_renderLabels=e}get delayLabelsUntilMovementFinished(){return this.textElementsRenderer.delayLabelsUntilMovementFinished}set delayLabelsUntilMovementFinished(e){this.textElementsRenderer.delayLabelsUntilMovementFinished=e}get textElementsRenderer(){return this.m_textElementsRenderer}get cameraMovementDetector(){return this.m_movementDetector}get animatedExtrusionHandler(){return this.m_animatedExtrusionHandler}get tileGeometryManager(){return this.m_tileGeometryManager}get enableMixedLod(){return this.m_enableMixedLod}set enableMixedLod(e){this.m_enableMixedLod!==e&&(this.m_enableMixedLod=e,this.createVisibleTileSet(),this.update())}get tileWrappingEnabled(){return this.m_tileWrappingEnabled}set tileWrappingEnabled(e){this.projection.type!==r.ProjectionType.Spherical?(e!==this.m_tileWrappingEnabled&&(this.m_tileWrappingEnabled=e,this.createVisibleTileSet()),this.update()):N.warn("Setting this with spherical projection has no affect. Was this intended?")}dispose(e=!0){this.DISPOSE_EVENT.time=Date.now(),this.dispatchEvent(this.DISPOSE_EVENT),this.m_disposed=!0,this.m_movementFinishedUpdateTimerId&&(clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=void 0),void 0!==this.m_animationFrameHandle&&(cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=void 0),this.canvas.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onWebGLContextRestored);for(const e of this.m_tileDataSources)e.dispose();this.m_visibleTiles.clearTileCache(),this.m_textElementsRenderer.clearRenderStates(),this.m_renderer.dispose(),e&&this.m_renderer.forceContextLoss(),this.m_themeManager.dispose(),this.m_tileGeometryManager.clear(),this.m_movementDetector.dispose(),m.ConcurrentDecoderFacade.destroyIfTerminated(),p.ConcurrentTilerFacade.destroyIfTerminated(),this.m_taskScheduler.clearQueuedTasks(),super.dispose()}get disposed(){return this.m_disposed}get resourceComputationType(){return this.m_visibleTiles.resourceComputationType}set resourceComputationType(e){this.m_visibleTiles.resourceComputationType=e}getCacheSize(){return this.m_visibleTiles.getDataSourceCacheSize()}setCacheSize(e,t){this.m_visibleTiles.setDataSourceCacheSize(e),t=void 0!==t?t:e/2,this.m_visibleTiles.setNumberOfVisibleTiles(Math.floor(t)),this.m_themeManager.updateCache(),this.m_textElementsRenderer.invalidateCache(),this.update()}get extendedFrustumCulling(){return void 0===this.m_options.extendedFrustumCulling||this.m_visibleTileSetOptions.extendedFrustumCulling}set extendedFrustumCulling(e){this.m_visibleTileSetOptions.extendedFrustumCulling=e}get lockVisibleTileSet(){return this.m_visibleTileSetLock}set lockVisibleTileSet(e){this.m_visibleTileSetLock=e}get pointOfView(){return this.m_pointOfView}set pointOfView(e){this.m_pointOfView=e,this.update()}loadPostEffects(e){fetch(e).then(e=>e.json()).then(e=>{this.m_postEffects=e,this.setPostEffects()})}get postEffects(){return this.m_postEffects}set postEffects(e){this.m_postEffects=e,this.setPostEffects()}get theme(){return this.m_themeManager.theme}set theme(e){this.setTheme(e)}async setTheme(e){const t=await this.m_themeManager.setTheme(e);return this.THEME_LOADED_EVENT.time=Date.now(),this.dispatchEvent(this.THEME_LOADED_EVENT),this.update(),t}async getTheme(){return await this.m_themeManager.getTheme()}get uriResolver(){return this.m_uriResolver}get forceCameraAspect(){return this.m_forceCameraAspect}set forceCameraAspect(e){this.m_forceCameraAspect=e}get languages(){return this.m_languages}set languages(e){this.m_languages=e,this.m_tileDataSources.forEach(e=>{e.setLanguages(this.m_languages)}),this.update()}get politicalView(){return this.m_politicalView}set politicalView(e){this.m_politicalView!==e&&(this.m_politicalView=e,this.m_tileDataSources.forEach(t=>{t.setPoliticalView(e)}))}get copyrightInfo(){return this.m_copyrightInfo}set disableFading(e){this.m_textElementsRenderer.disableFading=e}get disableFading(){return this.m_textElementsRenderer.disableFading}get frameNumber(){return this.m_frameNumber}resetFrameNumber(){this.m_frameNumber=0,this.m_previousFrameTimeStamp=void 0}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get canvas(){return this.m_options.canvas}get collisionDebugCanvas(){return this.m_collisionDebugCanvas}get scene(){return this.m_scene}get overlayScene(){return this.m_overlayScene}get sceneEnvironment(){return this.m_sceneEnvironment}get camera(){return this.m_camera}get renderer(){return this.m_renderer}get clearColor(){const e=this.m_renderer.getClearColor(B.color);return void 0!==e?e.getHex():0}set clearColor(e){this.m_renderer.setClearColor(e)}get clearAlpha(){const e=this.m_renderer.getClearAlpha();return void 0!==e?e:0}set clearAlpha(e){this.m_renderer.setClearAlpha(e)}get projection(){return this.m_visibleTileSetOptions.projection}set projection(e){const t=this.tilt,i=this.heading;this.m_visibleTileSetOptions.projection=e,this.updatePolarDataSource(),this.clearTileCache(),this.textElementsRenderer.clearRenderStates(),this.m_visibleTiles=this.createVisibleTileSet(),this.geoMaxBounds=this.geoMaxBounds,this.lookAtImpl({tilt:t,heading:i})}get clipPlanesEvaluator(){return this.m_visibleTileSetOptions.clipPlanesEvaluator}set clipPlanesEvaluator(e){this.m_visibleTileSetOptions.clipPlanesEvaluator=e}get focalLength(){var e;return null!==(e=h.CameraUtils.getFocalLength(this.m_camera))&&void 0!==e?e:0}get target(){return this.m_targetGeoPos}get worldTarget(){return this.m_targetWorldPos}get targetDistance(){return this.m_targetDistance}get viewRanges(){return this.m_viewRanges}get geoCenter(){return this.projection.unprojectPoint(this.m_camera.position).normalized()}set geoCenter(e){if(void 0!==e.altitude)this.projection.projectPoint(e,this.m_camera.position);else{const t=this.geoCenter.altitude;this.projection.projectPoint(new r.GeoCoordinates(e.latitude,e.longitude,t),this.m_camera.position)}this.update()}get mapAnchors(){return this.m_mapAnchors}get worldCenter(){return this.m_camera.position}get pickHandler(){return this.m_pickHandler}get imageCache(){return this.m_themeManager.imageCache}get userImageCache(){return this.m_userImageCache}get poiManager(){return this.m_poiManager}get poiTableManager(){return this.m_poiTableManager}get minCameraHeight(){return this.m_minCameraHeight}get minZoomLevel(){return this.m_minZoomLevel}set minZoomLevel(e){this.m_minZoomLevel=e,this.update()}get maxZoomLevel(){return this.m_maxZoomLevel}set maxZoomLevel(e){this.m_maxZoomLevel=e,this.update()}get geoMaxBounds(){return this.m_geoMaxBounds}set geoMaxBounds(e){this.m_geoMaxBounds=e,this.m_worldMaxBounds=this.m_geoMaxBounds?this.projection.projectBox(this.m_geoMaxBounds,this.projection.type===r.ProjectionType.Planar?new o.Box3:new r.OrientedBox3):void 0}get worldMaxBounds(){return this.m_worldMaxBounds}get zoomLevel(){return this.m_zoomLevel}set zoomLevel(e){this.lookAtImpl({zoomLevel:e})}get tilt(){return o.MathUtils.radToDeg(this.m_pitch)}set tilt(e){this.lookAtImpl({tilt:e})}get heading(){return-o.MathUtils.radToDeg(this.m_yaw)}set heading(e){this.lookAtImpl({heading:e})}get env(){return this.m_env}get storageLevel(){return o.MathUtils.clamp(Math.floor(this.m_zoomLevel),this.m_minZoomLevel,this.m_maxZoomLevel)}get viewportHeight(){return this.canvas.height}get nativeWebglAntialiasEnabled(){return void 0===this.m_options.enableNativeWebglAntialias?this.pixelRatio<2:this.m_options.enableNativeWebglAntialias}get dataSources(){return this.m_tileDataSources}setFovCalculation(e){this.m_options.fovCalculation=e,this.updateCameras()}getDataSourceByName(e){return this.m_tileDataSources.find(t=>t.name===e)}getDataSourcesByStyleSetName(e){return this.m_tileDataSources.filter(t=>t.styleSetName===e)}isDataSourceEnabled(e){return e.enabled&&e.ready()&&this.m_connectedDataSources.has(e.name)&&e.isVisible(this.zoomLevel)}async addDataSource(e){var t,i;if(void 0!==this.getDataSourceByName(e.name))throw new Error(`A DataSource with the name "${e.name}" already exists in this MapView.`);e.attach(this),e.setEnableElevationOverlay(void 0!==this.m_elevationProvider);const n=this.m_tileDataSources.find(e=>!0===e.addGroundPlane&&!(e instanceof l.BackgroundDataSource));!0===e.addGroundPlane&&void 0!==n&&console.warn(`The DataSources ${e.name} and ${n.name} both have a ground plane added, this will cause problems with the fallback logic, see HARP-14728 & HARP-15488.`),this.m_tileDataSources.push(e),null===(t=this.m_sceneEnvironment)||void 0===t||t.updateBackgroundDataSource();try{await e.connect();if(!this.m_tileDataSources.includes(e))return;e.addEventListener(U.Update,()=>{this.update()});const t=await this.getTheme();e.setLanguages(this.m_languages),void 0!==t&&void 0!==t.styles&&await e.setTheme(t),this.m_connectedDataSources.add(e.name),this.dispatchEvent({type:U.DataSourceConnect,dataSourceName:e.name}),this.update()}catch(t){N.error(`Failed to connect to datasource ${e.name}: ${null!==(i=t.message)&&void 0!==i?i:t}`),this.m_failedDataSources.add(e.name),this.dispatchEvent({type:U.DataSourceConnect,dataSourceName:e.name,error:t})}}removeDataSource(e){const t=this.m_tileDataSources.indexOf(e);-1!==t&&(e.detach(this),this.m_visibleTiles.removeDataSource(e),this.m_tileDataSources.splice(t,1),this.m_connectedDataSources.delete(e.name),this.m_failedDataSources.delete(e.name),this.m_sceneEnvironment.updateBackgroundDataSource(),this.update())}get visibleTileSet(){return this.m_visibleTiles}addOverlayText(e){this.m_textElementsRenderer.addOverlayText(e),this.update()}clearOverlayText(){this.m_textElementsRenderer.clearOverlayText()}lookAt(e,t,i,n){if(r.isGeoCoordinatesLike(e)){const r={target:e,zoomLevel:void 0!==t?F.MapViewUtils.calculateZoomLevelFromDistance(this,t):void 0,tilt:i,heading:n};this.lookAtImpl(r)}else"object"==typeof e&&this.lookAtImpl(e)}setCameraGeolocationAndZoom(e,t,i=0,n=0){this.geoCenter=e;let s=Math.min(F.MapViewUtils.MAX_TILT_DEG,n);if(this.projection.type===r.ProjectionType.Spherical){const e=Math.asin(r.EarthConstants.EQUATORIAL_RADIUS/(F.MapViewUtils.calculateDistanceToGroundFromZoomLevel(this,t)+r.EarthConstants.EQUATORIAL_RADIUS)),i=o.MathUtils.radToDeg(e);s=Math.min(s,i)}F.MapViewUtils.zoomOnTargetPosition(this,0,0,t),F.MapViewUtils.setRotation(this,i,s),this.update()}setDynamicProperty(e,t){if(e.startsWith("$"))throw new Error(`failed to update the value of the dynamic property '${e}'`);this.m_env.entries[e]=t,this.update()}removeDynamicProperty(e){if(e.startsWith("$"))throw new Error(`failed to remove the dynamic property '${e}'`);delete this.m_env.entries[e],this.update()}get animating(){return this.m_animationCount>0}beginAnimation(){0==this.m_animationCount++&&(this.update(),this.ANIMATION_STARTED_EVENT.time=Date.now(),this.dispatchEvent(this.ANIMATION_STARTED_EVENT))}endAnimation(){this.m_animationCount>0&&--this.m_animationCount,0===this.m_animationCount&&(this.ANIMATION_FINISHED_EVENT.time=Date.now(),this.dispatchEvent(this.ANIMATION_FINISHED_EVENT))}get cameraIsMoving(){return this.m_movementDetector.cameraIsMoving}get isDynamicFrame(){return this.cameraIsMoving||this.animating||this.m_updatePending||this.m_animatedExtrusionHandler.isAnimating}get pixelToWorld(){if(void 0===this.m_pixelToWorld){s.assert(void 0!==this.m_options.fovCalculation);const e=this.m_targetDistance,t=h.CameraUtils.getFocalLength(this.m_camera);s.assert(void 0!==t),this.m_pixelToWorld=h.CameraUtils.convertScreenToWorldSize(t,e,1)}return this.m_pixelToWorld}get worldToPixel(){return 1/this.pixelToWorld}get pixelRatio(){return void 0!==this.m_pixelRatio?this.m_pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1}set pixelRatio(e){this.m_pixelRatio=e,this.renderer.getPixelRatio()!==this.pixelRatio&&this.renderer.setPixelRatio(this.pixelRatio)}set maxFps(e){this.m_options.maxFps=e,this.m_taskScheduler.maxFps=e}get maxFps(){return this.m_options.maxFps}set dynamicPixelRatio(e){this.mapRenderingManager.lowResPixelRatio=e}get dynamicPixelRatio(){return this.mapRenderingManager.lowResPixelRatio}getScreenPosition(e){r.isVector3Like(e)?B.vector3[0].copy(e):this.projection.projectPoint(r.GeoCoordinates.fromObject(e),B.vector3[0]);const t=this.m_screenProjector.project(B.vector3[0]);if(void 0!==t){const{width:e,height:i}=this.getCanvasClientSize();t.x=t.x+e/2,t.y=i-(t.y+i/2)}return t}getWorldPositionAt(e,t,i){this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_camera);const n=this.projection.type===r.ProjectionType.Spherical?this.m_raycaster.ray.intersectSphere(this.m_sphere,B.vector3[0]):this.m_raycaster.ray.intersectPlane(this.m_plane,B.vector3[0]);if(null===n&&!0===i){const e=this.m_camera.getWorldDirection(B.vector3[0]).dot(this.m_raycaster.ray.direction);return B.vector3[0].copy(this.m_raycaster.ray.direction).multiplyScalar(this.m_camera.far/e).add(this.m_camera.position)}return n}getGeoCoordinatesAt(e,t,i){const n=this.getWorldPositionAt(e,t,i);if(!n)return null;const s=this.projection.unprojectPoint(n);return this.tileWrappingEnabled||this.projection.type!==r.ProjectionType.Planar||(s.longitude=o.MathUtils.clamp(s.longitude,-180,180)),s}getNormalizedScreenCoordinates(e,t){const{width:i,height:n}=this.getCanvasClientSize();return new o.Vector3(e/i*2-1,-t/n*2+1,0)}intersectMapObjects(e,t,i){return this.m_pickHandler.intersectMapObjects(e,t,i)}resize(e,t){this.m_renderer.setSize(e,t,!1),this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),void 0!==this.mapRenderingManager&&this.mapRenderingManager.setSize(e,t),void 0!==this.collisionDebugCanvas&&(this.collisionDebugCanvas.width=e,this.collisionDebugCanvas.height=t),this.updateCameras(),this.update(),this.dispatchEvent({type:U.Resize,size:{width:e,height:t}})}renderSync(e){void 0===e&&(e=s.PerformanceTimer.now()),this.render(e)}update(){this.disposed?N.warn("update(): MapView has been disposed of."):(this.dispatchEvent(this.UPDATE_EVENT),this.m_updatePending||(this.m_updatePending=!0,this.startRenderLoop()))}get updatePending(){return this.m_updatePending}requestUpdateIfNeeded(){this.update()}clearTileCache(e,t){if(void 0!==this.m_visibleTiles){if(void 0!==e){const i=this.getDataSourceByName(e);i&&(this.m_visibleTiles.clearTileCache(i,t),i.clearCache())}else this.m_visibleTiles.clearTileCache(void 0,t),this.m_tileDataSources.forEach(e=>e.clearCache());void 0!==this.m_elevationProvider&&this.m_elevationProvider.clearCache()}}forEachVisibleTile(e){this.m_visibleTiles.forEachVisibleTile(e)}forEachCachedTile(e){this.m_visibleTiles.forEachCachedTile(e)}markTilesDirty(e,t){this.m_visibleTiles.markTilesDirty(e,t),this.update()}async setElevationSource(e,t,i){this.m_elevationSource&&this.m_elevationSource!==e&&this.removeDataSource(this.m_elevationSource);this.m_tileDataSources.includes(e)||await this.addDataSource(e),this.m_elevationSource=e,this.m_elevationRangeSource=t,this.m_elevationRangeSource.ready()||await this.m_elevationRangeSource.connect(),this.m_elevationProvider=i,this.dataSources.forEach(e=>{e.setEnableElevationOverlay(!0)}),this.m_tileGeometryManager.setTileUpdateCallback(e=>{_.overlayOnElevation(e)}),this.clearTileCache()}clearElevationSource(e){this.removeDataSource(e),this.m_elevationSource=void 0,this.m_elevationRangeSource=void 0,this.m_elevationProvider=void 0,this.dataSources.forEach(e=>{e.setEnableElevationOverlay(!1)}),this.m_tileGeometryManager.setTileUpdateCallback(void 0),this.clearTileCache()}get fog(){return this.m_sceneEnvironment.fog}setPostEffects(){this.mapRenderingManager.bloom.enabled=!1,this.mapRenderingManager.outline.enabled=!1,this.mapRenderingManager.vignette.enabled=!1,this.mapRenderingManager.sepia.enabled=!1,void 0!==this.m_postEffects&&(void 0!==this.m_postEffects.bloom&&(this.mapRenderingManager.bloom=this.m_postEffects.bloom),void 0!==this.m_postEffects.outline&&(this.mapRenderingManager.outline.enabled=this.m_postEffects.outline.enabled,this.mapRenderingManager.updateOutline(this.m_postEffects.outline)),void 0!==this.m_postEffects.vignette&&(this.mapRenderingManager.vignette=this.m_postEffects.vignette),void 0!==this.m_postEffects.sepia&&(this.mapRenderingManager.sepia=this.m_postEffects.sepia))}get elevationProvider(){return this.m_elevationProvider}get throttlingEnabled(){return!0===this.m_taskScheduler.throttlingEnabled}set throttlingEnabled(e){this.m_taskScheduler.throttlingEnabled=e}get shadowsEnabled(){return!0===this.m_options.enableShadows}set shadowsEnabled(e){void 0!==this.m_renderer.shadowMap&&e!==this.m_renderer.shadowMap.enabled&&(this.m_options.enableShadows=e,this.m_renderer.shadowMap.enabled=e,this.m_renderer.shadowMap.type=o.PCFSoftShadowMap,this.clearTileCache())}extractAttitude(){const e=this.m_camera,t=this.projection,i=B.vector3[1],n=B.transform[0],r=B.matrix4[1];i.setFromMatrixPosition(e.matrixWorld),t.localTangentSpace(this.m_targetGeoPos,n),r.makeBasis(n.xAxis,n.yAxis,n.zAxis),B.matrix4[0].copy(r).invert().multiply(e.matrixWorld),n.xAxis.setFromMatrixColumn(B.matrix4[0],0),n.yAxis.setFromMatrixColumn(B.matrix4[0],1),n.zAxis.setFromMatrixColumn(B.matrix4[0],2);let s=0,o=0,a=0;const l=n.zAxis.dot(i.set(0,0,1));return l<1-1e-10?l>1e-10-1?(s=Math.atan2(n.zAxis.x,-n.zAxis.y),o=Math.acos(n.zAxis.z),a=Math.atan2(n.xAxis.x,n.yAxis.z)):(s=-Math.atan2(-n.yAxis.x,n.xAxis.x),o=180,a=0):(s=Math.atan2(-n.yAxis.x,n.xAxis.x),o=0,a=0),{yaw:s,pitch:o,roll:a}}lookAtImpl(e){const t=Math.min(s.getOptionValue(e.tilt,this.tilt),F.MapViewUtils.MAX_TILT_DEG),i=s.getOptionValue(e.heading,this.heading),n=void 0!==e.zoomLevel?F.MapViewUtils.calculateDistanceFromZoomLevel(this,o.MathUtils.clamp(e.zoomLevel,this.m_minZoomLevel,this.m_maxZoomLevel)):void 0!==e.distance?e.distance:this.m_targetDistance;let a;if(void 0!==e.bounds){let s;if(e.bounds instanceof r.GeoBox)a=e.target?r.GeoCoordinates.fromObject(e.target):e.bounds.center,s=F.MapViewUtils.geoBoxToGeoPoints(e.bounds);else if(e.bounds instanceof r.GeoPolygon)a=e.bounds.getCentroid(),s=e.bounds.coordinates;else if(r.isGeoBoxExtentLike(e.bounds)){a=e.target?r.GeoCoordinates.fromObject(e.target):this.target;const t=r.GeoBox.fromCenterAndExtents(a,e.bounds);s=F.MapViewUtils.geoBoxToGeoPoints(t)}else{if(!Array.isArray(e.bounds))throw Error("#lookAt: Invalid 'bounds' value");s=e.bounds,void 0!==e.target&&(a=r.GeoCoordinates.fromObject(e.target))}e.bounds instanceof r.GeoBox||e.bounds instanceof r.GeoPolygon||!this.m_tileWrappingEnabled||this.projection.type!==r.ProjectionType.Planar||(s=F.MapViewUtils.wrapGeoPointsToScreen(s,a));const l=s.map(e=>this.projection.projectPoint(r.GeoCoordinates.fromObject(e),new o.Vector3)),c=new o.Vector3;if(void 0===a){(new o.Box3).setFromPoints(l).getCenter(c),this.projection.scalePointToSurface(c),a=this.projection.unprojectPoint(c)}else this.projection.projectPoint(a,c);return void 0!==e.zoomLevel||void 0!==e.distance?this.lookAtImpl({tilt:t,heading:i,distance:n,target:a}):this.lookAtImpl(F.MapViewUtils.getFitBoundsLookAtParams(a,c,l,{tilt:t,heading:i,minDistance:F.MapViewUtils.calculateDistanceFromZoomLevel(this,this.maxZoomLevel),projection:this.projection,camera:this.camera}))}a=void 0!==e.target?r.GeoCoordinates.fromObject(e.target):this.target,F.MapViewUtils.getCameraRotationAtTarget(this.projection,a,-i,t,this.camera.quaternion),F.MapViewUtils.getCameraPositionFromTargetCoordinates(a,n,-i,t,this.projection,this.camera.position),this.camera.updateMatrixWorld(!0),this.updateLookAtSettings(),this.update()}updatePolarDataSource(){const e=this.m_polarDataSource;if(!0===this.m_enablePolarDataSource&&void 0!==e){const t=this.getDataSourceByName(e.name);this.projection.type===r.ProjectionType.Spherical?void 0===t&&this.addDataSource(e):void 0!==t&&this.removeDataSource(e)}}updateCameras(e){var t;this.m_camera.updateMatrixWorld(!1),this.updateLookAtSettings();const{width:i,height:n}=this.m_renderer.getSize(B.vector2[0]);this.m_camera.aspect=void 0!==this.m_forceCameraAspect?this.m_forceCameraAspect:i/n,this.setFovOnCamera(this.m_options.fovCalculation,n);const r=this.projection.getScaleFactor(this.camera.position),s=r*this.m_tileDataSources.reduce((e,t)=>Math.max(e,t.maxGeometryHeight),0),o=r*this.m_tileDataSources.reduce((e,t)=>Math.min(e,t.minGeometryHeight),0);Object.assign(this.m_viewRanges,void 0===e?this.m_visibleTiles.updateClipPlanes(s,o):e),this.m_camera.near=this.m_viewRanges.near,this.m_camera.far=this.m_viewRanges.far,this.m_camera.updateProjectionMatrix(),this.m_rteCamera.copy(this.m_camera),this.m_rteCamera.position.setScalar(0),this.m_rteCamera.updateMatrixWorld(!0),null===(t=this.m_textElementsRenderer)||void 0===t||t.updateCamera(),this.m_screenProjector.update(this.camera,i,n),this.m_pixelToWorld=void 0,this.m_sceneEnvironment.update()}updateLookAtSettings(){let{target:e,distance:t,final:i}=F.MapViewUtils.getTargetAndDistance(this.projection,this.camera,this.elevationProvider);i||this.update(),this.geoMaxBounds&&({target:e,distance:t}=F.MapViewUtils.constrainTargetAndDistanceToViewBounds(e,t,this)),this.m_targetWorldPos.copy(e),this.m_targetGeoPos=this.projection.unprojectPoint(this.m_targetWorldPos),this.m_targetDistance=t,this.m_zoomLevel=F.MapViewUtils.calculateZoomLevelFromDistance(this,this.m_targetDistance);const{yaw:n,pitch:r,roll:s}=this.extractAttitude();this.m_yaw=n,this.m_pitch=r,this.m_roll=s}updateEnv(){this.m_env.entries.$zoom=this.m_zoomLevel,this.m_env.entries.$pixelToMeters=this.pixelToWorld,this.m_env.entries.$frameNumber=this.m_frameNumber}ndcToView(e,t){return t.set(e.x,e.y,e.z).applyMatrix4(this.camera.projectionMatrixInverse).applyMatrix4(this.m_rteCamera.matrixWorld),t}renderLoop(e){if(!0!==this.m_options.synchronousRendering&&!this.disposed){if(0===this.maxFps)this.render(e);else{const t=3,i=1e3/this.maxFps;e>=(void 0===this.m_previousFrameTimeStamp?0:this.m_previousFrameTimeStamp)+i-t&&this.render(e)}this.m_updatePending||this.animating?this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame):this.m_animationFrameHandle=void 0}}startRenderLoop(){void 0!==this.m_animationFrameHandle||this.m_options.synchronousRendering||(this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame))}getEnabledTileDataSources(){const e=[];for(const t of this.m_tileDataSources)this.isDataSourceEnabled(t)&&e.push(t);return e}render(e){if(this.m_drawing)return;if(this.disposed)return void N.warn("render(): MapView has been disposed of.");let t;this.RENDER_EVENT.time=e,this.dispatchEvent(this.RENDER_EVENT),this.m_tileObjectRenderer.prepareRender(),++this.m_frameNumber;const i=R.PerformanceStatistics.instance,n=i.enabled;if(n){if(t=i.currentFrame,void 0!==this.m_previousFrameTimeStamp){const i=e-this.m_previousFrameTimeStamp;t.setValue("render.fps",1e3/i)}i.storeAndClearFrameInfo(),t=t,t.setValue("renderCount.frameNumber",this.m_frameNumber)}let r,o,a,l,c,h;if(this.m_previousFrameTimeStamp=e,this.m_renderer.info.reset(),this.m_updatePending=!1,this.m_thisFrameTilesChanged=void 0,this.m_drawing=!0,this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),this.updateCameras(),this.updateEnv(),this.m_renderer.clear(),this.m_sceneRoot.children.length=0,this.m_overlaySceneRoot.children.length=0,n&&(r=s.PerformanceTimer.now()),!this.lockVisibleTileSet){const e=this.m_visibleTiles.updateRenderList(this.storageLevel,Math.floor(this.zoomLevel),this.getEnabledTileDataSources(),this.m_frameNumber,this.m_elevationRangeSource);e.viewRangesChanged&&this.updateCameras(e.viewRanges)}n&&(o=s.PerformanceTimer.now());const u=this.m_visibleTiles.dataSourceTileList;if(u.forEach(({zoomLevel:e,renderedTiles:t})=>{t.forEach(t=>{this.m_tileObjectRenderer.render(t,e,this.zoomLevel,this.m_camera.position,this.m_sceneRoot),t.frameNumLastVisible=this.m_frameNumber})}),this.m_initialTextPlacementDone||this.m_firstFrameComplete||this.isDynamicFrame||this.m_themeManager.isUpdating()||!this.m_poiTableManager.finishedLoading||!this.m_visibleTiles.allVisibleTilesLoaded||this.m_connectedDataSources.size+this.m_failedDataSources.size!==this.m_tileDataSources.length||this.m_textElementsRenderer.loading||(this.m_initialTextPlacementDone=!0),this.m_mapAnchors.update(this.projection,this.camera.position,this.m_sceneRoot,this.m_overlaySceneRoot),this.m_animatedExtrusionHandler.update(this.zoomLevel),void 0!==t&&(t.addValue("renderCount.numTilesRendered",0),t.addValue("renderCount.numTilesVisible",0),t.addValue("renderCount.numTilesLoading",0),u.forEach(({zoomLevel:e,renderedTiles:i,visibleTiles:n,numTilesLoading:r})=>{t.addValue("renderCount.numTilesRendered",i.size),t.addValue("renderCount.numTilesVisible",n.length),t.addValue("renderCount.numTilesLoading",r)})),this.m_movementDetector.checkCameraMoved(this,e)){const{latitude:e,longitude:t,altitude:i}=this.geoCenter;this.dispatchEvent({type:U.CameraPositionChanged,latitude:e,longitude:t,altitude:i,yaw:this.m_yaw,pitch:this.m_pitch,roll:this.m_roll,tilt:this.tilt,heading:this.heading,zoom:this.zoomLevel})}const d=void 0!==this.m_pointOfView?this.m_pointOfView:this.m_rteCamera;if(this.renderLabels&&!this.m_pointOfView&&this.m_textElementsRenderer.placeText(u,e),n&&(a=s.PerformanceTimer.now()),this.mapRenderingManager.render(this.m_renderer,this.m_scene,d,!this.isDynamicFrame),n&&(l=s.PerformanceTimer.now()),this.renderLabels&&!this.m_pointOfView&&this.m_textElementsRenderer.renderText(this.m_viewRanges.maximum),this.m_overlaySceneRoot.children.length>0&&this.m_renderer.render(this.m_overlayScene,d),n&&(c=s.PerformanceTimer.now()),this.m_firstFrameRendered||(this.m_firstFrameRendered=!0,n&&i.appResults.set("firstFrame",e),this.FIRST_FRAME_EVENT.time=e,this.dispatchEvent(this.FIRST_FRAME_EVENT)),this.m_visibleTiles.disposePendingTiles(),this.m_drawing=!1,this.checkCopyrightUpdates(),void 0!==this.m_taskSchedulerTimeout&&clearTimeout(this.m_taskSchedulerTimeout),this.m_taskSchedulerTimeout=setTimeout(()=>{this.m_taskSchedulerTimeout=void 0,this.m_taskScheduler.processPending(e)},0),void 0!==t){h=s.PerformanceTimer.now();const n=h-e;t.setValue("render.setupTime",r-e),t.setValue("render.cullTime",o-r),t.setValue("render.textPlacementTime",a-o),t.setValue("render.drawTime",l-a),t.setValue("render.textDrawTime",c-l),t.setValue("render.cleanupTime",h-c),t.setValue("render.frameRenderTime",n),t.setValue("render.fullFrameTime",n),t.setValue("render.geometryCreationTime",0),i.addWebGLInfo(this.m_renderer.info),i.addMemoryInfo()}this.DID_RENDER_EVENT.time=e,this.dispatchEvent(this.DID_RENDER_EVENT),!this.textElementsRenderer.loading&&this.m_visibleTiles.allVisibleTilesLoaded&&this.m_initialTextPlacementDone&&!this.m_animatedExtrusionHandler.isAnimating&&(!1===this.m_firstFrameComplete&&(this.m_firstFrameComplete=!0,n&&i.appResults.set("firstFrameComplete",e)),this.FRAME_COMPLETE_EVENT.time=e,this.dispatchEvent(this.FRAME_COMPLETE_EVENT))}setupCamera(){s.assert(void 0!==this.m_visibleTiles),this.m_options.target=r.GeoCoordinates.fromObject(s.getOptionValue(this.m_options.target,z.target)),this.m_options.target.altitude=0,this.m_options.tilt=s.getOptionValue(this.m_options.tilt,z.tilt),this.m_options.heading=s.getOptionValue(this.m_options.heading,z.heading),this.m_options.zoomLevel=s.getOptionValue(this.m_options.zoomLevel,z.zoomLevel),this.lookAtImpl(this.m_options);const{width:e,height:t}=this.getCanvasClientSize();this.resize(e,t)}createVisibleTileSet(){s.assert(void 0!==this.m_tileGeometryManager),this.m_visibleTiles&&(this.m_visibleTiles.clearTileCache(),this.m_visibleTiles.disposePendingTiles());const e=void 0===this.m_enableMixedLod?this.projection.type===r.ProjectionType.Spherical:this.m_enableMixedLod;return this.m_visibleTiles=new V.VisibleTileSet(new y.FrustumIntersection(this.m_camera,this,this.m_visibleTileSetOptions.extendedFrustumCulling,this.m_tileWrappingEnabled,e,this.m_lodMinTilePixelSize),this.m_tileGeometryManager,this.m_visibleTileSetOptions,this.taskQueue),this.m_visibleTiles}movementStarted(){this.m_textElementsRenderer.movementStarted(),this.MOVEMENT_STARTED_EVENT.time=Date.now(),this.dispatchEvent(this.MOVEMENT_STARTED_EVENT)}movementFinished(){this.m_textElementsRenderer.movementFinished(),this.MOVEMENT_FINISHED_EVENT.time=Date.now(),this.dispatchEvent(this.MOVEMENT_FINISHED_EVENT),this.animating||(void 0!==this.m_movementFinishedUpdateTimerId&&clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=setTimeout(()=>{this.m_movementFinishedUpdateTimerId=void 0,this.update()},0))}checkIfTilesChanged(){if(void 0!==this.m_thisFrameTilesChanged)return this.m_thisFrameTilesChanged;const e=this.m_visibleTiles.dataSourceTileList,t=[];t.length=0,e.forEach(({dataSource:e,renderedTiles:i})=>{i.forEach(i=>{t.push(e.name+"-"+i.tileKey.mortonCode())})}),t.sort();const i=t.join("#");return i!==this.m_lastTileIds?(this.m_lastTileIds=i,this.m_thisFrameTilesChanged=!0):this.m_thisFrameTilesChanged=!1,this.m_thisFrameTilesChanged}checkCopyrightUpdates(){if(!this.checkIfTilesChanged())return;const e=this.getRenderedTilesCopyrightInfo();if(e!==this.m_copyrightInfo){if(e.length===this.m_copyrightInfo.length){let t=!0;for(let i=0;i<e.length;i++){const n=e[i],r=this.m_copyrightInfo[i];if(n.label!==r.label){t=!1;break}}if(t)return}this.m_copyrightInfo=e,this.dispatchEvent(this.COPYRIGHT_CHANGED_EVENT)}}getRenderedTilesCopyrightInfo(){let e=[];for(const t of this.m_visibleTiles.dataSourceTileList)for(const i of t.renderedTiles.values()){const t=i.copyrightInfo;void 0!==t&&0!==t.length&&(e=f.CopyrightInfo.mergeArrays(e,t))}return e}setupStats(e){new R.PerformanceStatistics(e,1e3)}setupRenderer(e){var t;this.m_scene.add(this.m_sceneRoot),this.m_overlayScene.add(this.m_overlaySceneRoot),this.shadowsEnabled=null!==(t=this.m_options.enableShadows)&&void 0!==t&&t,e.setupRenderer()}createTextRenderer(){return new O.TextElementsRenderer(new D.MapViewState(this,this.checkIfTilesChanged.bind(this)),()=>{this.update()},this.m_screenProjector,this.m_poiManager,this.m_renderer,[this.imageCache,this.userImageCache],this.m_options)}async resetTextRenderer(e,t,i){await this.m_textElementsRenderer.updateFontCatalogs(e),await this.m_textElementsRenderer.updateTextStyles(t,i),this.update()}setFovOnCamera(e,t){const i=o.MathUtils.degToRad(e.fov);if("fixed"===e.type)return void h.CameraUtils.setVerticalFov(this.m_camera,i,t);let n=h.CameraUtils.getFocalLength(this.m_camera);void 0===n&&(h.CameraUtils.setVerticalFov(this.m_camera,i,t),n=h.CameraUtils.getFocalLength(this.m_camera)),h.CameraUtils.setFocalLength(this.m_camera,n,t)}getCanvasClientSize(){const{clientWidth:e,clientHeight:t}=this.canvas;if(0===e||0===t||"number"!=typeof e||"number"!=typeof t){const e=this.m_renderer.getPixelRatio();return{width:Math.round(this.canvas.width/e),height:Math.round(this.canvas.height/e)}}return{width:e,height:t}}}t.MapView=G},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementType=void 0,function(e){e[e.PoiLabel=0]="PoiLabel",e[e.PathLabel=1]="PathLabel",e[e.LineMarker=2]="LineMarker"}(t.TextElementType||(t.TextElementType={}))},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(166),t),r(i(167),t),r(i(28),t),r(i(335),t),r(i(169),t),r(i(336),t)},function(e,t,i){"use strict";(function(e){var n=t;function r(e,t,i){for(var n=Object.keys(t),r=0;r<n.length;++r)void 0!==e[n[r]]&&i||(e[n[r]]=t[n[r]]);return e}function s(e){function t(e,i){if(!(this instanceof t))return new t(e,i);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),i&&r(this,i)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=i(368),n.base64=i(369),n.EventEmitter=i(370),n.float=i(371),n.inquire=i(372),n.utf8=i(373),n.pool=i(374),n.LongBits=i(375),n.isNode=Boolean(void 0!==e&&e&&e.process&&e.process.versions&&e.process.versions.node),n.global=n.isNode&&e||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var i=e[t];return!(null==i||!e.hasOwnProperty(t))&&("object"!=typeof i||(Array.isArray(i)?i.length:Object.keys(i).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var i=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(i.lo,i.hi,t):i.toNumber(Boolean(t))},n.merge=r,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var e=Object.keys(this),i=e.length-1;i>-1;--i)if(1===t[e[i]]&&void 0!==this[e[i]]&&null!==this[e[i]])return e[i]}},n.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,i){return new e(t,i)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}).call(this,i(367))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=void 0,t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EarthConstants=void 0;class n{}t.EarthConstants=n,n.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,n.EQUATORIAL_RADIUS=6378137,n.MIN_ELEVATION=-433,n.MAX_ELEVATION=8848,n.MAX_BUILDING_HEIGHT=828},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBox3Like=void 0,t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrientedBox3Like=void 0,t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tile=t.getFeatureDataSize=void 0;const n=i(2),r=i(1),s=i(0),o=i(114),a=i(113),l=i(266),c=i(45),h=i(35),u=i(37),d=i(312),m=i(313),p=i(314),f=r.LoggerManager.instance.create("Tile");t.getFeatureDataSize=function(e){let t=100;return void 0!==e.starts&&(t+=8*e.starts.length),void 0!==e.objInfos&&(t+=16*e.objInfos.length),t};t.Tile=class{constructor(e,t,i=0,r){this.dataSource=e,this.tileKey=t,this.objects=[],this.dependencies=[],this.frameNumLastRequested=-1,this.frameNumVisible=-1,this.frameNumLastVisible=-1,this.numFramesVisible=0,this.visibilityCounter=-1,this.levelOffset=0,this.skipRendering=!1,this.delayRendering=!1,this.m_boundingBox=new n.OrientedBox3,this.m_disposed=!1,this.m_forceHasGeometry=void 0,this.m_textElementGroups=new m.TextElementGroupPriorityList,this.m_pathBlockingElements=[],this.m_worldCenter=new s.Vector3,this.m_visibleArea=0,this.m_elevationRange={minElevation:0,maxElevation:0},this.m_ownedTextures=new WeakSet,this.geoBox=this.dataSource.getTilingScheme().getGeoBox(this.tileKey),this.updateBoundingBox(),this.m_worldCenter.copy(this.boundingBox.position),this.m_localTangentSpace=null!=r&&r,this.m_textStyleCache=new p.TileTextStyleCache(this),this.m_offset=i,this.m_uniqueKey=n.TileKeyUtils.getKeyForTileKeyAndOffset(this.tileKey,this.offset),e.useGeometryLoader&&(this.m_tileGeometryLoader=new l.TileGeometryLoader(this,this.mapView.taskQueue),this.attachGeometryLoadedCallback())}get isVisible(){try{return this.frameNumLastRequested>=this.dataSource.mapView.frameNumber-1}catch(e){return f.debug(e),!1}}set isVisible(e){this.frameNumLastRequested=e?this.dataSource.mapView.frameNumber:-1,e||!this.m_tileGeometryLoader||this.m_tileGeometryLoader.isSettled||this.m_tileGeometryLoader.cancel()}get projection(){return this.dataSource.projection}get mapView(){return this.dataSource.mapView}get localTangentSpace(){return this.m_localTangentSpace}get memoryUsage(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo.heapSize}get center(){return this.m_worldCenter}get uniqueKey(){return this.m_uniqueKey}get offset(){return this.m_offset}set offset(e){this.m_offset!==e&&(this.m_uniqueKey=n.TileKeyUtils.getKeyForTileKeyAndOffset(this.tileKey,e)),this.m_offset=e}getResourceInfo(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo}invalidateResourceInfo(){this.m_resourceInfo=void 0}addOwnedTexture(e){this.m_ownedTextures.add(e)}get userTextElements(){let e=this.m_textElementGroups.groups.get(u.TextElement.HIGHEST_PRIORITY);return void 0===e&&(e=new d.TextElementGroup(u.TextElement.HIGHEST_PRIORITY),this.m_textElementGroups.groups.set(e.priority,e)),e}addUserTextElement(e){e.priority=u.TextElement.HIGHEST_PRIORITY,this.addTextElement(e)}removeUserTextElement(e){return e.priority=u.TextElement.HIGHEST_PRIORITY,this.removeTextElement(e)}addTextElement(e){this.textElementGroups.add(e),!1===this.m_textElementsChanged&&(this.m_textElementGroups=this.textElementGroups.clone()),this.textElementsChanged=!0}addBlockingElement(e){this.m_pathBlockingElements.push(e)}removeTextElement(e){const t=this.textElementGroups;return!!t.remove(e)&&(!1===this.m_textElementsChanged&&(this.m_textElementGroups=t.clone()),this.textElementsChanged=!0,!0)}get textElementGroups(){return this.m_textElementGroups}get textElementsChanged(){var e;return null!==(e=this.m_textElementsChanged)&&void 0!==e&&e}set textElementsChanged(e){this.m_textElementsChanged=e}hasTextElements(){return this.m_textElementGroups.count()>0}get blockingElements(){return this.m_pathBlockingElements}willRender(e){return!this.skipRendering&&!this.delayRendering}didRender(){}get visibleArea(){return this.m_visibleArea}set visibleArea(e){this.m_visibleArea=e,void 0!==this.tileLoader&&(this.tileLoader.priority=e)}get elevationRange(){return this.m_elevationRange}set elevationRange(e){var t;e.minElevation===this.m_elevationRange.minElevation&&e.maxElevation===this.m_elevationRange.maxElevation&&e.calculationStatus===this.m_elevationRange.calculationStatus||(this.m_elevationRange.minElevation=e.minElevation,this.m_elevationRange.maxElevation=e.maxElevation,this.m_elevationRange.calculationStatus=e.calculationStatus,this.elevateGeoBox(),void 0===this.m_maxGeometryHeight&&void 0===this.m_minGeometryHeight||(r.assert(void 0===(null===(t=this.decodedTile)||void 0===t?void 0:t.boundingBox)),this.updateBoundingBox()))}get decodedTile(){return this.m_decodedTile}set decodedTile(e){var t,i;if(this.m_decodedTile=e,this.invalidateResourceInfo(),void 0===e)return;0===e.geometries.length&&this.forceHasGeometry(!0),this.m_maxGeometryHeight=e.boundingBox?void 0:null!==(t=e.maxGeometryHeight)&&void 0!==t?t:0,this.m_minGeometryHeight=e.boundingBox?void 0:null!==(i=e.minGeometryHeight)&&void 0!==i?i:0,this.elevateGeoBox(),this.updateBoundingBox(e.boundingBox);const n=h.PerformanceStatistics.instance;n.enabled&&void 0!==e.decodeTime&&(n.currentFrame.addValue("decode.decodingTime",e.decodeTime),n.currentFrame.addValue("decode.decodedTiles",1)),void 0!==e.copyrightHolderIds&&(this.copyrightInfo=e.copyrightHolderIds.map(e=>({id:e}))),this.dataSource.requestUpdate()}shouldDisposeObjectGeometry(e){return!0}shouldDisposeObjectMaterial(e){return!0}shouldDisposeTexture(e){return this.m_ownedTextures.has(e)}get disposed(){return this.m_disposed}get allGeometryLoaded(){var e,t;return null!==(t=null===(e=this.m_tileGeometryLoader)||void 0===e?void 0:e.isFinished)&&void 0!==t?t:this.hasGeometry}get hasGeometry(){return void 0===this.m_forceHasGeometry?0!==this.objects.length:this.m_forceHasGeometry}forceHasGeometry(e){this.m_forceHasGeometry=e}resetVisibilityCounter(){this.visibilityCounter=-1}get tileLoader(){return this.m_tileLoader}set tileLoader(e){this.m_tileLoader=e}async load(){const e=this.tileLoader;if(void 0===e)return await Promise.resolve();if(this.m_tileGeometryLoader){const e=this.m_tileGeometryLoader.isSettled;this.m_tileGeometryLoader.reset(),e&&this.attachGeometryLoadedCallback()}return await e.loadAndDecode().then(t=>{var i;r.assert(t===c.TileLoaderState.Ready);const s=e.decodedTile;this.decodedTile=s,null===(i=null==s?void 0:s.dependencies)||void 0===i||i.forEach(e=>{this.dependencies.push(n.TileKey.fromMortonCode(e))})}).catch(e=>{e===c.TileLoaderState.Failed?this.dispose():e!==c.TileLoaderState.Canceled&&f.error("Unknown error"+e)})}get textStyleCache(){return this.m_textStyleCache}clear(){const e=e=>{Object.getOwnPropertyNames(e).forEach(t=>{const i=e[t];if(void 0!==i&&i instanceof s.Texture){const e=i;this.shouldDisposeTexture(e)&&e.dispose()}}),e.dispose()},t=t=>{if(this.shouldDisposeObjectGeometry(t)&&(void 0!==t.geometry&&t.geometry.dispose(),void 0!==t.geometries))for(const e of t.geometries)e.dispose();void 0!==t.material&&this.shouldDisposeObjectMaterial(t)&&(t.material instanceof Array?t.material.forEach(t=>{void 0!==t&&e(t)}):e(t.material))};this.objects.forEach(e=>{e.traverse(e=>{t(e)}),t(e)}),this.objects.length=0,this.preparedTextPaths&&(this.preparedTextPaths=[]),this.m_textStyleCache.clear(),this.clearTextElements(),this.invalidateResourceInfo()}clearTextElements(){this.hasTextElements()&&(this.textElementsChanged=!0,this.m_pathBlockingElements.splice(0),this.textElementGroups.forEach(e=>{e.dispose()}),this.textElementGroups.clear())}addDisposeCallback(e){this.m_disposeCallback=r.chainCallbacks(this.m_disposeCallback,e)}dispose(){var e;this.m_disposed||(this.m_tileLoader&&(this.m_tileLoader.cancel(),this.m_tileLoader=void 0),this.clear(),this.frameNumLastRequested=0,this.m_disposed=!0,null===(e=this.m_tileGeometryLoader)||void 0===e||e.dispose(),this.m_disposeCallback&&this.m_disposeCallback(this))}computeWorldOffsetX(){return this.projection.worldExtent(0,0).max.x*this.offset}update(e){for(const t of this.objects)t instanceof o.LodMesh&&t.setLevelOfDetail(e-this.tileKey.level)}get boundingBox(){return this.m_boundingBox}updateGeometry(e,t,i){if(!this.m_tileGeometryLoader)return!1;if(this.m_tileGeometryLoader.isSettled)return!0;if(this.dataSource.isDetached())return this.m_tileGeometryLoader.cancel(),!0;if(this.tileLoader){if(!this.tileLoader.isFinished)return!0;if(!this.decodedTile)return this.m_tileGeometryLoader.finish(),!0}return void 0!==e&&(this.m_tileGeometryLoader.priority=e),this.m_tileGeometryLoader.update(t,i),!0}get loadedGeometryKinds(){var e;return null===(e=this.m_tileGeometryLoader)||void 0===e?void 0:e.availableGeometryKinds}loadingFinished(){}attachGeometryLoadedCallback(){r.assert(void 0!==this.m_tileGeometryLoader),this.m_tileGeometryLoader.waitFinished().then(()=>{this.loadingFinished(),this.removeDecodedTile()}).catch(()=>{this.disposed||this.dataSource.isDetached()||this.mapView.visibleTileSet.disposeTile(this)})}removeDecodedTile(){this.m_decodedTile=void 0,this.invalidateResourceInfo()}updateBoundingBox(e){e?(this.m_boundingBox.copy(e),this.m_worldCenter.copy(this.boundingBox.position)):this.projection.projectBox(this.geoBox,this.boundingBox)}elevateGeoBox(){var e,t;this.geoBox.southWest.altitude=this.m_elevationRange.minElevation+(null!==(e=this.m_minGeometryHeight)&&void 0!==e?e:0),this.geoBox.northEast.altitude=this.m_elevationRange.maxElevation+(null!==(t=this.m_maxGeometryHeight)&&void 0!==t?t:0)}computeResourceInfo(){let e=0,t=0,i=0;const n={heapSize:0,gpuSize:0},r=new Map;for(const e of this.objects)e.visible&&t++,a.Object3DUtils.estimateSize(e,n,r);for(const e of this.textElementGroups.groups)i+=e[1].elements.length;e+=312*i,void 0!==this.m_decodedTile&&void 0!==this.m_decodedTile.tileInfo&&(n.heapSize+=this.m_decodedTile.tileInfo.numBytes),this.m_resourceInfo={heapSize:n.heapSize+e,gpuSize:n.gpuSize,num3dObjects:t,numTextElements:i,numUserTextElements:0}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateColorProperty=t.applyBaseColorToMaterial=t.applySecondaryColorToMaterial=t.evaluateBaseColorProperty=t.buildMetricValueEvaluator=t.getMaterialConstructor=t.BASE_TECHNIQUE_NON_MATERIAL_PROPS=t.buildObject=t.usesObject3D=t.getBufferAttribute=t.createMaterial=void 0;const n=i(3),r=i(120),s=i(4),o=i(1),a=i(0),l=i(268),c=i(123),h=i(69),u=i(70),d=i(124),m=o.LoggerManager.instance.create("DecodedTileHelpers");function p(e,t,i,n){const r=(new a.TextureLoader).load(e,t,void 0,i);n&&r.addEventListener("dispose",()=>{URL.revokeObjectURL(e)})}function f(e,t,i){const n=e.dataTextureProperties;if(n){const i=n.type?d.toTextureDataType(n.type):void 0,r=function(e,t){if(void 0===t)return new Uint8Array(e);switch(t){case a.UnsignedByteType:return new Uint8Array(e);case a.ByteType:return new Int8Array(e);case a.ShortType:return new Int16Array(e);case a.UnsignedShortType:return new Uint16Array(e);case a.IntType:return new Int32Array(e);case a.UnsignedIntType:return new Uint32Array(e);case a.FloatType:return new Float32Array(e);case a.HalfFloatType:return new Uint16Array(e)}throw new Error("Unsupported texture data type")}(e.buffer,i);t(new a.DataTexture(r,n.width,n.height,n.format?d.toPixelFormat(n.format):void 0,i))}else i("no data texture properties provided.")}function g(e,t,i){const r=i.technique;let s=r[t];if(void 0===s)return;return new Promise((o,l)=>{const c=i=>{!function(e,t){t&&(void 0!==t.wrapS&&(e.wrapS=d.toWrappingMode(t.wrapS)),void 0!==t.wrapT&&(e.wrapT=d.toWrappingMode(t.wrapT)),void 0!==t.magFilter&&(e.magFilter=d.toTextureFilter(t.magFilter)),void 0!==t.minFilter&&(e.minFilter=d.toTextureFilter(t.minFilter)),void 0!==t.flipY&&(e.flipY=t.flipY),void 0!==t.repeatU&&(e.repeat.x=t.repeatU),void 0!==t.repeatV&&(e.repeat.y=t.repeatV))}(i,r[t+"Properties"]),e[t]=i,e.needsUpdate=!0,o(i)},h=e=>{m.error("#createMaterial: Failed to load texture: ",e),l(e)};if(!n.Expr.isExpr(s)||(s=n.getPropertyValue(s,i.env),s))if("string"==typeof s)p(s,c,h,!1);else if(n.isTextureBuffer(s))if("image/raw"===s.type)f(s,c,h);else{const e=new Blob([s.buffer],{type:s.type});p(URL.createObjectURL(e),c,h,!0)}else"object"!=typeof s||"IMG"!==s.nodeName&&"CANVAS"!==s.nodeName||c(new a.CanvasTexture(s));else c(new a.Texture)})}function v(e,t){if(void 0!==e.name)switch(e.name){case"extruded-line":if(!n.isExtrudedLineTechnique(e))throw new Error("Invalid extruded-line technique");return"standard"===e.shading?s.MapMeshStandardMaterial:s.MapMeshBasicMaterial;case"standard":case"terrain":case"extruded-polygon":return s.MapMeshStandardMaterial;case"dashed-line":case"solid-line":return s.SolidLineMaterial;case"fill":return t?s.MapMeshStandardMaterial:s.MapMeshBasicMaterial;case"squares":return a.PointsMaterial;case"circles":return s.CirclePointsMaterial;case"line":case"segments":return a.LineBasicMaterial;case"shader":return a.ShaderMaterial;case"text":case"labeled-icon":case"line-marker":case"label-rejection-line":return}}function y(e,t){return null==e?e:("string"==typeof e&&(e.endsWith("px")?(t="Pixel",e=Number.parseFloat(e)):e.endsWith("m")&&(e=Number.parseFloat(e))),"Pixel"===t?t=>{var i;return(null!==(i=t.env.lookup("$pixelToMeters"))&&void 0!==i?i:1)*n.getPropertyValue(e,t.env)}:e)}function _(e,t,i){let r=b(t,i);void 0!==r&&(n.ColorUtils.hasAlphaInHex(r)&&(m.warn("Used RGBA value for technique color without transparency support!"),r=n.ColorUtils.removeAlphaFromHex(r)),e.setHex(r))}function x(e,t,i,r,o){const l=b(r,o);if(void 0===l)return;const{r:c,g:h,b:u,a:d}=n.ColorUtils.getRgbaFromHex(l),m=i;let p=d;void 0!==m.opacity&&(p*=w(m.opacity,o)),p=a.MathUtils.clamp(p,0,1),e instanceof s.RawShaderMaterial?e.setOpacity(p):e.opacity=p,t.setRGB(c,h,u);p>=1?s.disableBlending(e):s.enableBlending(e)}function w(e,t){return void 0!==t&&n.Expr.isExpr(e)&&(e=n.getPropertyValue(e,t)),e}function b(e,t){if(null!=(e=w(e,t))){if("number"==typeof e)return e;if("string"==typeof e){const t=n.parseStringEncodedColor(e);if(void 0!==t)return t}m.error(`Unsupported color format: '${e}'`)}}function M(e){var t;return null===(t=r.getTechniqueDescriptor(e))||void 0===t?void 0:t.attrTransparencyColor}t.createMaterial=function(e,t,i){const l=t.technique,c=v(l,!0===t.shadowsEnabled),u={};if(void 0===c)return;c.prototype instanceof s.RawShaderMaterial&&(u.rendererCapabilities=e,c!==s.HighPrecisionLineMaterial&&(u.fog=t.fog)),!0===t.shadowsEnabled&&"fill"===l.name&&(u.removeDiffuseLight=!0);const d=new c(u);return void 0!==l.id&&(d.name=l.id),n.isExtrudedPolygonTechnique(l)&&(d.flatShading=!0),d.depthTest=n.isExtrudedPolygonTechnique(l)&&!1!==l.depthTest,n.supportsTextures(l)&&n.TEXTURE_PROPERTY_KEYS.forEach(e=>{const n=g(d,e,t);n&&(null==i||i(n))}),n.isShaderTechnique(l)?function(e,t){e.transparent?s.enableBlending(t):s.disableBlending(t);const i=e.params,r=M(e),o=r&&r in e.params;if(Object.getOwnPropertyNames(i).filter(e=>{if(r===e||o&&n.TRANSPARENCY_PROPERTY_KEYS.includes(e)){return false}const t=e;if(t==="name"){return false}return true}).forEach(e=>{!function(e,t,i,n){const r=e;if(r[t]instanceof a.Color)_(e[t],i,n);else{const e=w(i,n);null!==e&&(r[t]=e)}}(t,e,i[e])}),o){const n=r;x(t,t[n],e,i[n])}}(l,d):h.MapMaterialAdapter.create(d,function(e){var t;const i=r.getTechniqueAutomaticAttrs(e);switch(e.name){case"dashed-line":case"solid-line":{const n=o.pick(e,i);return n.lineWidth=y(null!==(t=e.lineWidth)&&void 0!==t?t:0,e.metricUnit),n.outlineWidth=y(e.outlineWidth,e.metricUnit),n.dashSize=y(e.dashSize,e.metricUnit),n.gapSize=y(e.gapSize,e.metricUnit),n.offset=y(e.offset,e.metricUnit),n}case"fill":return o.pick(e,i);case"standard":case"terrain":case"extruded-polygon":{const t=o.pick(e,i);return!0!==e.vertexColors&&(t.color=e.color),t}case"circles":case"squares":return o.pick(e,i);case"extruded-line":return o.pick(e,["color","wireframe","transparent","opacity","polygonOffset","polygonOffsetFactor","polygonOffsetUnits",...i]);case"line":case"segments":return o.pick(e,i);default:return{}}}(l)),d},t.getBufferAttribute=function(e){switch(e.type){case"float":return new a.BufferAttribute(new Float32Array(e.buffer),e.itemCount);case"uint8":return new a.BufferAttribute(new Uint8Array(e.buffer),e.itemCount,e.normalized);case"uint16":return new a.BufferAttribute(new Uint16Array(e.buffer),e.itemCount,e.normalized);case"uint32":return new a.BufferAttribute(new Uint32Array(e.buffer),e.itemCount,e.normalized);case"int8":return new a.BufferAttribute(new Int8Array(e.buffer),e.itemCount,e.normalized);case"int16":return new a.BufferAttribute(new Int16Array(e.buffer),e.itemCount,e.normalized);case"int32":return new a.BufferAttribute(new Int32Array(e.buffer),e.itemCount,e.normalized);default:throw new Error("unsupported buffer of type "+e.type)}},t.usesObject3D=function(e){const t=e.name;return void 0!==t&&"text"!==t&&"labeled-icon"!==t&&"line-marker"!==t&&"label-rejection-line"!==t},t.buildObject=function(e,t,i,r,s){switch(o.assert(void 0!==e.name),e.name){case"extruded-line":case"standard":case"extruded-polygon":case"fill":return s?new l.DisplacedMesh(t,i,()=>({min:r.elevationRange.minElevation,max:r.elevationRange.maxElevation})):new a.Mesh(t,i);case"terrain":return new a.Mesh(t,i);case"dashed-line":case"solid-line":return s?new l.DisplacedMesh(t,i,()=>({min:r.elevationRange.minElevation,max:r.elevationRange.maxElevation}),c.SolidLineMesh.raycast):new c.SolidLineMesh(t,i);case"circles":return new u.Circles(t,i);case"squares":return new u.Squares(t,i);case"line":case"segments":return new a.LineSegments(t,i);case"shader":switch(o.assert(n.isShaderTechnique(e),"Invalid technique"),e.primitive){case"line":return new a.Line(t,i);case"segments":return new a.LineSegments(t,i);case"point":return new a.Points(t,i);case"mesh":return new a.Mesh(t,i)}}return o.assert(!1,"Invalid technique"),new a.Object3D},t.BASE_TECHNIQUE_NON_MATERIAL_PROPS=["name","id","renderOrder","transient"],t.getMaterialConstructor=v,t.buildMetricValueEvaluator=y,t.evaluateBaseColorProperty=function(e,t){const i=function(e){const t=M(e);if(void 0!==t){if(n.isShaderTechnique(e)){const i=e.params;return i[t]}return e[t]}return}(e);if(void 0!==i)return b(i,t)},t.applySecondaryColorToMaterial=_,t.applyBaseColorToMaterial=x,t.evaluateColorProperty=b},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeUtils=void 0,function(e){let t;e.whiteSpaceRanges=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]],e.isWhiteSpace=function(t){for(const i of e.whiteSpaceRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.newLineRanges=[[10,13],[133,133],[8232,8233]],e.isNewLine=function(t){for(const i of e.newLineRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.nonPrintableRanges=[[0,31],[127,159]],e.isPrintable=function(t){for(const i of e.nonPrintableRanges)if(t>=i[0]&&t<=i[1])return!1;return!0},function(e){e[e.Neutral=0]="Neutral",e[e.Weak=.5]="Weak",e[e.LTR=1]="LTR",e[e.RTL=-1]="RTL"}(t=e.Direction||(e.Direction={})),e.rtlBlocks=["Hebrew","Alphabetic Presentation Forms","Arabic","Arabic Supplement","Arabic Extended-A","Arabic Presentation Forms-A","Arabic Presentation Forms-B","Arabic Mathematical Alphabetic Symbols","Indic Siyaq Numbers","Rumi Numeral Symbols","Syriac","Syriac Supplement","Samaritan","Mandaic","Thaana","Mende Kikakui","NKo","Adlam","Hanifi Rohingya"],e.neutralBidirectionalRanges=[[32,47],[58,64],[91,96],[123,126]],e.weakBidirectionalRanges=[[48,57],[1632,1641],[1776,1785]],e.getDirection=function(i,n){for(const n of e.weakBidirectionalRanges)if(i>=n[0]&&i<=n[1])return t.Weak;for(const n of e.neutralBidirectionalRanges)if(i>=n[0]&&i<=n[1])return t.Neutral;return void 0!==e.rtlBlocks.find(e=>e===n)?t.RTL:t.LTR},e.rtlMirroredCodePoints=[40,41,60,62,91,93,123,125],e.isRtlMirrored=function(t){return void 0!==e.rtlMirroredCodePoints.find(e=>e===t)}}(t.UnicodeUtils||(t.UnicodeUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolvePlacementAndAlignment=t.TextLayoutStyle=t.TextRenderStyle=t.DefaultTextStyle=t.vPlacementFromAlignment=t.hPlacementFromAlignment=t.vAlignFromPlacement=t.hAlignFromPlacement=t.WrappingMode=t.HorizontalPlacement=t.VerticalPlacement=t.HorizontalAlignment=t.VerticalAlignment=t.FontVariant=t.FontStyle=t.FontUnit=void 0;const n=i(0);var r,s,o,a,l,c,h;function u(e){return e}function d(e){return e}!function(e){e[e.Em=0]="Em",e[e.Pixel=1]="Pixel",e[e.Point=2]="Point",e[e.Percent=3]="Percent"}(r=t.FontUnit||(t.FontUnit={})),function(e){e[e.Regular=0]="Regular",e[e.Bold=1]="Bold",e[e.Italic=2]="Italic",e[e.BoldItalic=3]="BoldItalic"}(s=t.FontStyle||(t.FontStyle={})),function(e){e[e.Regular=0]="Regular",e[e.AllCaps=1]="AllCaps",e[e.SmallCaps=2]="SmallCaps"}(o=t.FontVariant||(t.FontVariant={})),function(e){e[e.Above=0]="Above",e[e.Center=-.5]="Center",e[e.Below=-1]="Below"}(a=t.VerticalAlignment||(t.VerticalAlignment={})),function(e){e[e.Left=0]="Left",e[e.Center=-.5]="Center",e[e.Right=-1]="Right"}(l=t.HorizontalAlignment||(t.HorizontalAlignment={})),function(e){e[e.Top=0]="Top",e[e.Center=-.5]="Center",e[e.Bottom=-1]="Bottom"}(t.VerticalPlacement||(t.VerticalPlacement={})),function(e){e[e.Left=-1]="Left",e[e.Center=-.5]="Center",e[e.Right=0]="Right"}(t.HorizontalPlacement||(t.HorizontalPlacement={})),function(e){e[e.None=0]="None",e[e.Character=1]="Character",e[e.Word=2]="Word"}(c=t.WrappingMode||(t.WrappingMode={})),t.hAlignFromPlacement=u,t.vAlignFromPlacement=d,t.hPlacementFromAlignment=function(e){return e},t.vPlacementFromAlignment=function(e){return e},function(e){e.DEFAULT_FONT_NAME="",e.DEFAULT_FONT_SIZE={unit:Object.freeze(r.Pixel),size:Object.freeze(16),backgroundSize:Object.freeze(0)},e.DEFAULT_FONT_STYLE=s.Regular,e.DEFAULT_FONT_VARIANT=o.Regular,e.DEFAULT_ROTATION=0,e.DEFAULT_COLOR=new n.Color(0),e.DEFAULT_OPACITY=1,e.DEFAULT_BACKGROUND_COLOR=new n.Color(0),e.DEFAULT_BACKGROUND_OPACITY=0,e.DEFAULT_TRACKING=0,e.DEFAULT_LEADING=0,e.DEFAULT_MAX_LINES=1/0,e.DEFAULT_LINE_WIDTH=1/0,e.DEFAULT_CANVAS_ROTATION=0,e.DEFAULT_LINE_ROTATION=0,e.DEFAULT_WRAPPING_MODE=c.Word,e.DEFAULT_VERTICAL_ALIGNMENT=a.Above,e.DEFAULT_HORIZONTAL_ALIGNMENT=l.Left,e.DEFAULT_PLACEMENTS=[]}(h=t.DefaultTextStyle||(t.DefaultTextStyle={}));class m{constructor(e={}){this.m_params={fontName:void 0!==e.fontName?e.fontName:h.DEFAULT_FONT_NAME,fontSize:void 0!==e.fontSize?Object.assign({},e.fontSize):{unit:h.DEFAULT_FONT_SIZE.unit,size:h.DEFAULT_FONT_SIZE.size,backgroundSize:h.DEFAULT_FONT_SIZE.backgroundSize},fontStyle:void 0!==e.fontStyle?e.fontStyle:h.DEFAULT_FONT_STYLE,fontVariant:void 0!==e.fontVariant?e.fontVariant:h.DEFAULT_FONT_VARIANT,rotation:void 0!==e.rotation?e.rotation:h.DEFAULT_ROTATION,color:void 0!==e.color?e.color.clone():h.DEFAULT_COLOR.clone(),opacity:void 0!==e.opacity?e.opacity:h.DEFAULT_OPACITY,backgroundColor:void 0!==e.backgroundColor?e.backgroundColor.clone():h.DEFAULT_BACKGROUND_COLOR.clone(),backgroundOpacity:void 0!==e.backgroundOpacity?e.backgroundOpacity:h.DEFAULT_BACKGROUND_OPACITY}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get fontName(){return this.m_params.fontName}set fontName(e){this.m_params.fontName=e}get fontSize(){return this.m_params.fontSize}set fontSize(e){this.m_params.fontSize=Object.assign({},e)}get fontStyle(){return this.m_params.fontStyle}set fontStyle(e){this.m_params.fontStyle=e}get fontVariant(){return this.m_params.fontVariant}set fontVariant(e){this.m_params.fontVariant=e}get rotation(){return this.m_params.rotation}set rotation(e){this.m_params.rotation=e}get color(){return this.m_params.color}set color(e){this.m_params.color.copy(e)}get backgroundColor(){return this.m_params.backgroundColor}set backgroundColor(e){this.m_params.backgroundColor.copy(e)}get opacity(){return this.m_params.opacity}set opacity(e){this.m_params.opacity=e}get backgroundOpacity(){return this.m_params.backgroundOpacity}set backgroundOpacity(e){this.m_params.backgroundOpacity=e}clone(e={}){return new m(Object.assign(Object.assign({},this.m_params),e))}copy(e){return this.m_params.fontName=e.fontName,this.m_params.fontSize=Object.assign({},e.fontSize),this.m_params.fontStyle=e.fontStyle,this.m_params.fontVariant=e.fontVariant,this.m_params.rotation=e.rotation,this.m_params.color.copy(e.color),this.m_params.backgroundColor.copy(e.backgroundColor),this.m_params.opacity=e.opacity,this.m_params.backgroundOpacity=e.backgroundOpacity,this}}t.TextRenderStyle=m;class p{constructor(e={}){const{horizontalAlignment:t,verticalAlignment:i,placements:n}=f(e.horizontalAlignment,e.verticalAlignment,e.placements);this.m_params={tracking:void 0!==e.tracking?e.tracking:h.DEFAULT_TRACKING,leading:void 0!==e.leading?e.leading:h.DEFAULT_LEADING,maxLines:void 0!==e.maxLines?e.maxLines:h.DEFAULT_MAX_LINES,lineWidth:void 0!==e.lineWidth?e.lineWidth:h.DEFAULT_LINE_WIDTH,canvasRotation:void 0!==e.canvasRotation?e.canvasRotation:h.DEFAULT_CANVAS_ROTATION,lineRotation:void 0!==e.lineRotation?e.lineRotation:h.DEFAULT_LINE_ROTATION,wrappingMode:void 0!==e.wrappingMode?e.wrappingMode:h.DEFAULT_WRAPPING_MODE,verticalAlignment:i,horizontalAlignment:t,placements:n}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get tracking(){return this.m_params.tracking}set tracking(e){this.m_params.tracking=e}get leading(){return this.m_params.leading}set leading(e){this.m_params.leading=e}get maxLines(){return this.m_params.maxLines}set maxLines(e){this.m_params.maxLines=e}get lineWidth(){return this.m_params.lineWidth}set lineWidth(e){this.m_params.lineWidth=e}get canvasRotation(){return this.m_params.canvasRotation}set canvasRotation(e){this.m_params.canvasRotation=e}get lineRotation(){return this.m_params.lineRotation}set lineRotation(e){this.m_params.lineRotation=e}get wrappingMode(){return this.m_params.wrappingMode}set wrappingMode(e){this.m_params.wrappingMode=e}get verticalAlignment(){return this.m_params.verticalAlignment}set verticalAlignment(e){this.m_params.verticalAlignment=e}get horizontalAlignment(){return this.m_params.horizontalAlignment}set horizontalAlignment(e){this.m_params.horizontalAlignment=e}get placements(){return this.m_params.placements}set placements(e){const{horizontalAlignment:t,verticalAlignment:i,placements:n}=f(this.horizontalAlignment,this.verticalAlignment,e);this.m_params.horizontalAlignment=t,this.m_params.verticalAlignment=i,this.m_params.placements=n}clone(e={}){return new p(Object.assign(Object.assign({},this.m_params),e))}copy(e){return this.params=Object.assign({},e.params),this}}function f(e,t,i){var n;const r=null!==(n=null==i?void 0:i.map(e=>Object.assign({},e)))&&void 0!==n?n:h.DEFAULT_PLACEMENTS.map(e=>Object.assign({},e));return{horizontalAlignment:r.length>0?r[0].h:null!=e?e:h.DEFAULT_HORIZONTAL_ALIGNMENT,verticalAlignment:r.length>0?r[0].v:null!=t?t:h.DEFAULT_VERTICAL_ALIGNMENT,placements:r}}t.TextLayoutStyle=p,t.resolvePlacementAndAlignment=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GEOJSON_TILER_SERVICE_TYPE=t.VECTOR_TILE_DECODER_SERVICE_TYPE=t.OmvGeometryType=t.OmvFilterString=t.FeatureModifierId=void 0,function(e){e[e.default=0]="default"}(t.FeatureModifierId||(t.FeatureModifierId={})),function(e){let t;!function(e){e[e.Any=0]="Any",e[e.Match=1]="Match",e[e.StartsWith=2]="StartsWith",e[e.Contains=3]="Contains",e[e.EndsWith=4]="EndsWith"}(t=e.StringMatch||(e.StringMatch={})),e.matchString=function(t,i){switch(i.match){case e.StringMatch.Any:return!0;case e.StringMatch.Match:return t===i.value;case e.StringMatch.StartsWith:return i.value.startsWith(t);case e.StringMatch.EndsWith:return i.value.endsWith(t);default:return t.includes(i.value)}}}(t.OmvFilterString||(t.OmvFilterString={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.POINT=1]="POINT",e[e.LINESTRING=2]="LINESTRING",e[e.POLYGON=3]="POLYGON"}(t.OmvGeometryType||(t.OmvGeometryType={})),t.VECTOR_TILE_DECODER_SERVICE_TYPE="vector-tile-decoder",t.GEOJSON_TILER_SERVICE_TYPE="geojson-tiler"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilingScheme=void 0;const n=i(94),r=i(97),s=i(98);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new n.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new s.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return r.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return r.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorUtils=void 0;const n=i(1),r=i(0),s=i(42),o=new r.Color;!function(e){e.getHexFromRgba=function(e,t,i,r){return n.assert(r>=0&&r<=1),255-Math.floor(255*r)<<24^255*e<<16^255*t<<8^255*i<<0},e.getHexFromRgb=function(e,t,i){return n.assert(e>=0&&e<=1),n.assert(t>=0&&t<=1),n.assert(i>=0&&i<=1),255*e<<16^255*t<<8^255*i<<0},e.getHexFromHsl=function(e,t,i){return n.assert(e>=0&&e<=1),n.assert(t>=0&&t<=1),n.assert(i>=0&&i<=1),o.setHSL(e,t,i).getHex()},e.getRgbaFromHex=function(e,t=new s.RGBA){return n.assert(0==(0&e),"Wrong hex format"),t.r=(e>>16&255)/255,t.g=(e>>8&255)/255,t.b=(e>>0&255)/255,t.a=(255-(e>>24&255))/255,t},e.hasAlphaInHex=function(e){return n.assert(0==(0&e),"Wrong hex format"),e>>24!=0},e.getAlphaFromHex=function(e){return n.assert(0==(0&e),"Wrong hex format"),(255-(e>>24)&255)/255},e.removeAlphaFromHex=function(e){return n.assert(0==(0&e),"Wrong hex format"),16777215&e}}(t.ColorUtils||(t.ColorUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtrusionFeatureDefs=void 0,function(e){e.DEFAULT_RATIO_MIN=0,e.DEFAULT_RATIO_MAX=1,e.MIN_BUILDING_HEIGHT=.1}(t.ExtrusionFeatureDefs||(t.ExtrusionFeatureDefs={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraUtils=void 0;const n=i(1),r=i(0),s=i(66);function o(e,t,i){return n.assert(e>0,"Focal length must be larger than 0"),Math.atan((1-t)*i*.5/e)}function a(e,t,i){return n.assert(e>0,"Focal length must be larger than 0"),0===t?2*Math.atan(.5*i/e):o(e,t,i)+o(e,-t,i)}function l(e){return e.userData.fovs}function c(e,t,i,n,l){const c=n*e.aspect;let u=a(i,t.x,c);if(u<s.MIN_FOV_RAD||u>s.MAX_FOV_RAD){u=r.MathUtils.clamp(u,s.MIN_FOV_RAD,s.MAX_FOV_RAD);l=a(h(u,c,t.x),t.y,n)}if(e.fov=r.MathUtils.radToDeg(l),0===(d=t).x&&0===d.y)delete e.userData.fovs;else{const r=n*e.aspect;e.userData.fovs={top:o(i,t.y,n),right:o(i,t.x,r),horizontal:u}}var d;e.userData.focalLength=i}function h(e,t,i){const r=t/2;if(0===i)return r/Math.tan(e/2);const s=i**2;if(Math.abs(e-Math.PI/2)<1e-6)return r*Math.sqrt(1-s);const o=Math.tan(e),a=r*(1+Math.sign(o)*Math.sqrt(1+o**2*(1-s)))/o;return n.assert(a>=0,"Focal length must be larger than 0"),a}!function(e){function t(e){var t;return null===(t=e.userData)||void 0===t?void 0:t.focalLength}function i(e){return r.MathUtils.degToRad(e.fov)}function n(e,t,n){t=r.MathUtils.clamp(t,s.MIN_FOV_RAD,s.MAX_FOV_RAD);const a=o(e);return c(e,a,h(t,n,a.y),n,t),i(e)}function o(e,t=new r.Vector2){return t.x=-e.projectionMatrix.elements[8],t.y=-e.projectionMatrix.elements[9],t}function u(e){var t,i;return null!==(i=null===(t=l(e))||void 0===t?void 0:t.horizontal)&&void 0!==i?i:2*Math.atan(Math.tan(r.MathUtils.degToRad(e.fov)/2)*e.aspect)}function d(e){var t,i;return null!==(i=null===(t=l(e))||void 0===t?void 0:t.top)&&void 0!==i?i:r.MathUtils.degToRad(e.fov/2)}function m(e){var t,i;return null!==(i=null===(t=l(e))||void 0===t?void 0:t.right)&&void 0!==i?i:u(e)/2}e.getFocalLength=t,e.setFocalLength=function(e,i,r){const l=o(e),h=a(i,l.y,r);return h<s.MIN_FOV_RAD||h>s.MAX_FOV_RAD?n(e,h,r):c(e,l,i,r,h),t(e)},e.getVerticalFov=i,e.setVerticalFov=n,e.convertWorldToScreenSize=function(e,t,i){return e*i/t},e.convertScreenToWorldSize=function(e,t,i){return t*i/e},e.getPrincipalPoint=o,e.setPrincipalPoint=function(e,t){const i=e.aspect;e.setViewOffset(i,1,-r.MathUtils.clamp(t.x,-.999999,.999999)*i/2,1*r.MathUtils.clamp(t.y,-.999999,.999999)/2,i,1)},e.getHorizontalFov=u,e.getTopFov=d,e.getBottomFov=function(e){return r.MathUtils.degToRad(e.fov)-d(e)},e.getRightFov=m,e.getLeftFov=function(e){var t;return void 0!==(null===(t=l(e))||void 0===t?void 0:t.right)?u(e)-m(e):u(e)/2}}(t.CameraUtils||(t.CameraUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapObjectAdapter=void 0;const n=i(3),r=i(69);class s{constructor(e,t){var i;this.m_lastUpdateFrameNumber=-1,this.m_notCompletlyTransparent=!0,this.object=e,this.technique=t.technique,this.kind=t.kind,this.dataSource=t.dataSource,this.m_pickability=null!==(i=t.pickability)&&void 0!==i?i:n.Pickability.onlyVisible,this.m_notCompletlyTransparent=this.getObjectMaterials().some(e=>e.opacity>0),this.level=t.level}static get(e){var t;return(null===(t=e.userData)||void 0===t?void 0:t.mapAdapter)instanceof s?e.userData.mapAdapter:void 0}static install(e){return e.object.userData||(e.object.userData={}),e.object.userData.mapAdapter=e}static create(e,t){return s.install(new s(e,t))}static ensureUpdated(e,t){var i,n;return null!==(n=null===(i=s.get(e))||void 0===i?void 0:i.ensureUpdated(t))&&void 0!==n&&n}toJSON(){return{kind:this.kind,technique:this.technique}}ensureUpdated(e){return this.m_lastUpdateFrameNumber!==e.frameNumber&&(this.m_lastUpdateFrameNumber=e.frameNumber,this.updateMaterials(e))}isVisible(){return this.object.visible&&this.m_notCompletlyTransparent}isPickable(){return this.pickability===n.Pickability.onlyVisible&&this.isVisible()||this.m_pickability===n.Pickability.all}get pickability(){return this.m_pickability}updateMaterials(e){let t=!1;const i=this.getObjectMaterials();for(const n of i){const i=r.MapMaterialAdapter.ensureUpdated(n,e);t=t||i}return t&&(this.m_notCompletlyTransparent=i.some(e=>e.opacity>0)),t}getObjectMaterials(){const e=this.object;return Array.isArray(e.material)?e.material:void 0!==e.material?[e.material]:[]}}t.MapObjectAdapter=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderPass=t.RenderPass=t.Pass=void 0;const n=i(0);class r{constructor(){this.enabled=!1,this.renderToScreen=!1}setSize(e,t){}render(e,t,i,n,r,s){}}t.Pass=r;t.RenderPass=class extends r{constructor(){super()}render(e,t,i,n,r){e.setRenderTarget(this.renderToScreen?null:n),e.render(t,i)}};t.ShaderPass=class extends r{constructor(e,t="tDiffuse"){super(),this.textureID=t,e instanceof n.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=n.UniformsUtils.clone(e.uniforms),this.material=new n.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new s(this.material)}render(e,t,i,n,r,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,e.setRenderTarget(this.renderToScreen?null:n),this.fsQuad.render(e)}};class s{constructor(e){this.m_camera=new n.OrthographicCamera(-1,1,1,-1,0,1);const t=new n.PlaneBufferGeometry(2,2);this.m_mesh=new n.Mesh(t,e)}get material(){return this.m_mesh.material}set material(e){this.m_mesh.material=e}render(e){e.render(this.m_mesh,this.m_camera)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceStatistics=t.FrameStatsArray=t.FrameStats=t.Statistics=t.MultiStageTimer=t.computeArrayAverage=t.computeArrayStats=t.SampledTimer=t.SimpleTimer=t.RingBuffer=void 0;const n=i(1),r=n.LoggerManager.instance.create("Statistics");class s{constructor(e){this.capacity=e,this.buffer=new Array(e),this.capacity=e,this.head=this.tail=this.size=0}clear(){this.head=this.tail=this.size=0}enqOne(e){let t=this.head+1;t>=this.capacity&&(t=0),this.size<this.capacity&&this.size++,this.buffer[this.head]=e,this.head=t,this.size===this.capacity&&(this.tail=this.head)}enq(...e){for(const t of e)this.enqOne(t)}deq(){if(0===this.size)throw new Error("Ringbuffer underrun");const e=this.buffer[this.tail];let t=this.tail+1;return t>=this.capacity&&(t=0),this.size>0&&this.size--,this.tail=t,e}get top(){if(0===this.size)throw new Error("Ringbuffer underrun");return this.buffer[this.tail]}get bottom(){if(0===this.size)throw new Error("Ringbuffer underrun");let e=this.head-1;return e<0&&(e=this.capacity-1),this.buffer[e]}iterator(){return new s.Iterator(this)}asArray(){const e=new Array;for(let t=0;t<this.size;t++)e.push(this.buffer[(this.tail+t)%this.capacity]);return e}}t.RingBuffer=s,function(e){e.Iterator=class{constructor(e,t=0){this.m_buffer=e,this.m_index=t}get value(){return this.m_buffer.buffer[(this.m_buffer.tail+this.m_index)%this.m_buffer.capacity]}next(){return this.m_index++,this.m_index<this.m_buffer.size}}}(s=t.RingBuffer||(t.RingBuffer={}));class o{constructor(e,t){this.statistics=e,this.name=t,this.running=!1}get value(){return this.m_currentValue}setValue(e){this.m_currentValue=e}reset(){this.m_currentValue=void 0}start(){if(!this.statistics.enabled)return-1;if(this.running)throw new Error("Timer '"+this.name+"' is already running");return this.running=!0,this.m_currentValue=n.PerformanceTimer.now()}stop(){var e;if(!this.statistics.enabled)return-1;if(this.running){const t=n.PerformanceTimer.now()-(null!==(e=this.m_currentValue)&&void 0!==e?e:0);return this.m_currentValue=t,this.setValue(t),this.running=!1,t}throw new Error("Timer '"+this.name+"' has not been started")}now(){var e;if(!this.statistics.enabled)return-1;if(this.running){return n.PerformanceTimer.now()-(null!==(e=this.m_currentValue)&&void 0!==e?e:0)}throw new Error("Timer '"+this.name+"' has not been started")}}t.SimpleTimer=o;class a extends o{constructor(e,t){super(e,t),this.statistics=e,this.name=t,this.numResets=0,this.maxNumSamples=1e3,this.samples=new s(this.maxNumSamples)}reset(){super.reset(),this.getStats(),this.samples.clear(),this.numResets++}setValue(e){super.setValue(e),void 0!==e&&this.samples.enqOne(e)}getStats(){return l(this.samples.asArray())}}function l(e){if(0===e.length)return;e.sort((e,t)=>e-t);const t=e[0],i=e[e.length-1];let n,r,s,o,a,l,c;if(1===e.length)r=s=o=a=l=c=n=e[0];else if(2===e.length)n=.5*e[0]+.5*e[1],r=s=o=a=l=c=e[1];else{const t=Math.floor(e.length/2);n=e.length%2==0?.5*e[t-1]+.5*e[t]:e[t];r=e[Math.round(.75*e.length)-1];s=e[Math.round(.9*e.length)-1];o=e[Math.round(.95*e.length)-1];a=e[Math.round(.97*e.length)-1];l=e[Math.round(.99*e.length)-1];c=e[Math.round(.999*e.length)-1]}let h=0;for(let t=0,i=e.length;t<i;t++)h+=e[t];return{min:t,max:i,avg:h/e.length,median:n,median75:r,median90:s,median95:o,median97:a,median99:l,median999:c,numSamples:e.length}}t.SampledTimer=a,t.computeArrayStats=l,t.computeArrayAverage=function(e){if(0===e.length)return;let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i];return t/e.length};t.MultiStageTimer=class{constructor(e,t,i){if(this.statistics=e,this.name=t,this.stages=i,i.length<1)throw new Error("MultiStageTimer needs stages");i.forEach(t=>{if(!e.hasTimer(t))throw new Error("Unknown timer: "+t)})}get value(){return this.statistics.getTimer(this.stages[this.stages.length-1]).value}reset(){this.statistics.enabled&&this.stages.forEach(e=>{this.statistics.getTimer(e).reset()})}start(){var e;return this.stage=this.stages[0],null!==(e=this.statistics.getTimer(this.stages[0]).value)&&void 0!==e?e:-1}stop(){return this.stage=void 0,void 0!==this.value?this.value:-1}get stage(){return this.currentStage}set stage(e){this.currentStage!==e&&(this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).stop(),this.currentStage=e,this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).start())}};t.Statistics=class{constructor(e,t=!1){this.name=e,this.enabled=t,this.timers=new Map,this.nullTimer=new o(this,"<null>")}createTimer(e,t=!0){const i=t?new a(this,e):new o(this,e);return this.addTimer(i)}addTimer(e){if(void 0!==this.timers.get(e.name))throw new Error("Duplicate timer name: '"+e.name+"'");return this.timers.set(e.name,e),e}getTimer(e){if(!this.enabled)return this.nullTimer;const t=this.timers.get(e);return void 0===t?this.nullTimer:t}hasTimer(e){return void 0!==this.timers.get(e)}reset(){this.timers.forEach(e=>{e.reset()})}log(e,t){void 0===e&&void 0===this.name||r.log(void 0!==e?e:this.name);let i=0;this.timers.forEach(e=>{i=Math.max(i,e.name.length)});const n=e=>void 0!==e?e.toFixed(5):"?";this.timers.forEach(e=>{let t=e.name+": "+" ".repeat(i-e.name.length);if(t+=n(e.value),e instanceof a){const i=e.getStats();void 0!==i&&(t+=`  [ min=${n(i.min)}, max=${n(i.max)}, avg=${n(i.avg)}, med=${n(i.median)}, med95=${n(i.median95)}, med99=${n(i.median99)}, N=${n(i.numSamples)} ]`)}r.log(t)}),void 0!==t&&r.log(t)}};class c{constructor(){this.entries=new Map,this.messages=void 0}getValue(e){return this.entries.get(e)}setValue(e,t){this.entries.set(e,t)}addValue(e,t){const i=this.entries.get(e);this.entries.set(e,t+(void 0===i?0:i))}addMessage(e){void 0===this.messages&&(this.messages=[]),this.messages.push(e)}reset(){this.entries.forEach((e,t)=>{this.entries.set(t,0)}),this.messages=void 0}}t.FrameStats=c;class h{constructor(e=0){this.capacity=e,this.frameEntries=new Map,this.messages=new s(e)}get length(){return this.messages.size}reset(){this.frameEntries.forEach((e,t)=>{e.clear()}),this.messages.clear()}addFrame(e){const t=this.length,i=this.frameEntries;e.entries.forEach((e,n)=>{let r=i.get(n);if(void 0===r){r=new s(this.capacity);for(let e=0;e<t;e++)r.enqOne(0);this.frameEntries.set(n,r)}r.enqOne(e)}),this.messages.enq(e.messages)}log(){let e=0;this.frameEntries.forEach((t,i)=>{e=Math.max(e,i.length)});const t=e=>void 0!==e?e.toFixed(5):"?";this.frameEntries.forEach((i,n)=>{let s=n+": "+" ".repeat(e-n.length);const o=l(i.asArray());void 0!==o&&(s+=`  [ min=${t(o.min)}, max=${t(o.max)}, avg=${t(o.avg)}, med=${t(o.median)}, med95=${t(o.median95)}, med99=${t(o.median99)}, N=${t(o.numSamples)} ]`),r.log(s)})}}t.FrameStatsArray=h;class u{constructor(e=!0,t=1e3){this.enabled=e,this.maxNumFrames=t,this.currentFrame=new c,this.appResults=new Map,this.configs=new Map,u.m_instance=this,this.m_frameEvents=new h(t)}get isFull(){return this.m_frameEvents.length>=this.maxNumFrames}static get instance(){return void 0===u.m_instance&&(u.m_instance=new u(!1,0)),u.m_instance}get frameEvents(){return this.m_frameEvents}clear(){this.clearFrames(),this.configs.clear(),this.appResults.clear()}clearFrames(){this.m_frameEvents.reset(),this.currentFrame.reset()}addWebGLInfo(e){void 0!==e.render&&(this.currentFrame.setValue("gl.numCalls",null===e.render.calls?0:e.render.calls),this.currentFrame.setValue("gl.numPoints",null===e.render.points?0:e.render.points),this.currentFrame.setValue("gl.numLines",null===e.render.lines?0:e.render.lines),this.currentFrame.setValue("gl.numTriangles",null===e.render.triangles?0:e.render.triangles)),void 0!==e.memory&&(this.currentFrame.setValue("gl.numGeometries",null===e.memory.geometries?0:e.memory.geometries),this.currentFrame.setValue("gl.numTextures",null===e.memory.textures?0:e.memory.textures)),void 0!==e.programs&&this.currentFrame.setValue("gl.numPrograms",null===e.programs?0:e.programs.length)}addMemoryInfo(){if(void 0!==window&&void 0!==window.performance){const e=window.performance.memory;void 0!==e&&(this.currentFrame.setValue("memory.totalJSHeapSize",e.totalJSHeapSize),this.currentFrame.setValue("memory.usedJSHeapSize",e.usedJSHeapSize),this.currentFrame.setValue("memory.jsHeapSizeLimit",e.jsHeapSizeLimit))}}storeAndClearFrameInfo(){return!(this.m_frameEvents.length>=this.maxNumFrames)&&(this.m_frameEvents.addFrame(this.currentFrame),this.currentFrame.reset(),!0)}log(e,t){r.log(void 0!==e?e:"PerformanceStatistics");this.appResults.forEach((e,t)=>{r.log(t,e)});this.configs.forEach((e,t)=>{r.log(t,e)}),this.m_frameEvents.log(),void 0!==t&&r.log(t)}getAsPlainObject(e=!1){const t={},i={},n={},r={configs:i,appResults:t,frames:n};this.appResults.forEach((e,i)=>{t[i]=e});if(this.configs.forEach((e,t)=>{i[t]=e}),e)for(const[e,t]of this.m_frameEvents.frameEntries)n[e]=t.bottom;else for(const[e,t]of this.m_frameEvents.frameEntries)n[e]=t.asArray();return r.messages=this.m_frameEvents.messages.asArray(),r}getLastFrameStatistics(){return this.getAsPlainObject(!0)}getAsSimpleFrameStatistics(e=!1){const t=new Map,i=new Map,n=new Map,r={configs:t,appResults:i,frames:n,messages:this.m_frameEvents.messages.asArray()};this.appResults.forEach((e,t)=>{i.set(t,e)});if(this.configs.forEach((e,i)=>{t.set(i,e)}),e)for(const[e,t]of this.m_frameEvents.frameEntries)n.set(e,t.bottom);else for(const[e,t]of this.m_frameEvents.frameEntries)n.set(e,t.asArray());return r}}t.PerformanceStatistics=u,u.m_instance=void 0},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeLoader=t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH=void 0,i(16);const n=i(3),r=i(105),s=i(1),o=i(142);t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH=4;class a{static async load(e,t){var i;if(t=null!=t?t:{},"string"==typeof e){const i=t.uriResolver,n=void 0!==i?i.resolveUri(e):e,r=await fetch(n,{signal:t.signal});if(!r.ok)throw new Error("ThemeLoader#load: cannot load theme: "+r.statusText);(e=await r.json()).url=s.resolveReferenceUri(s.getAppBaseUrl(),n),e=this.resolveUrls(e,t)}else void 0===e.url?(e.url=s.getAppBaseUrl(),e=this.resolveUrls(e,t)):e=this.convertFlatTheme(e);if(null==e)throw new Error("ThemeLoader#load: loaded resource is not valid JSON");a.checkTechniqueSupport(e);const n=s.getOptionValue(t.resolveDefinitions,!1);if(e=await a.resolveBaseThemes(e,t),n){const n=new s.ContextLogger(null!==(i=t.logger)&&void 0!==i?i:console,`when processing Theme ${e.url}:`);a.resolveThemeReferences(e,n)}return e}static isThemeLoaded(e){return void 0===e.extends&&!Array.isArray(e.styles)}static async loadAsync(e){return await a.load(e)}static resolveUrls(e,t){if(void 0===(e=a.convertFlatTheme(e)).url)return e;const i=s.composeUriResolvers(null==t?void 0:t.uriResolver,new s.RelativeUriResolver(e.url)),n=void 0===t||!(!1===t.resolveIncludeUris);if(e.extends&&n&&(e.extends=(Array.isArray(e.extends)?e.extends:[e.extends]).map(n=>"string"==typeof n?i.resolveUri(n):void 0!==n.url?n:(n.url=e.url,this.resolveUrls(n,t)))),!a.convertFlatTheme(e))return e;return(void 0===t||!(!1===t.resolveResourceUris))&&a.resolveResources(e,i),e}static checkTechniqueSupport(e){if(void 0!==e.styles)for(const t in e.styles)if(e.styles.hasOwnProperty(t))for(const i of e.styles[t])i.technique}static resolveThemeReferences(e,t){if(void 0!==e.styles)for(const i in e.styles)e.styles.hasOwnProperty(i)&&(t.pushAttr("styles"),t.pushAttr(i),e.styles[i]=a.resolveStyleSet(e.styles[i],e.definitions,t),t.pop(),t.pop());return e}static resolveStyleSet(e,t,i){const n=[];for(let r=0;r<e.length;++r){const s=e[r];i.pushIndex(r);const o=a.resolveStyle(s,t,i);void 0!==o?n.push(o):i.warn("invalid style, ignored"),i.pop()}return n}static resolveStyle(e,t,i){if(Array.isArray(e.when)){i.pushAttr("when");const n=this.resolveExpressionReferences(e.when,t,i);if(i.pop(),void 0===n)return;e.when=n}if(void 0!==e.attr){const n=e.attr;i.pushAttr("attr");for(const e in n){if(!n.hasOwnProperty(e))continue;const r=n[e];if(!Array.isArray(r))continue;i.pushAttr(e);const s=this.resolveExpressionReferences(r,t,i);i.pop(),void 0!==s?n[e]=s:delete n[e]}i.pop()}return e}static resolveExpressionReferences(e,t,i){let s=!1;const o=function e(o){if(r.isJsonExprReference(o)){const e=o[1],r=t&&t[e];return void 0===r?(i.warn(`invalid reference '${e}' - not found`),void(s=!0)):n.isJsonExpr(r)?r:r.value}if(Array.isArray(o)){const t=[...o];for(let i=1;i<t.length;++i)t[i]=e(t[i]);return t}return o}(e);if(!s)return o}static async resolveBaseThemes(e,i){if(i=null!=i?i:{},void 0===e.extends)return e;const n=s.getOptionValue(i.maxInheritanceDepth,t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH);if(n<=0)throw new Error("maxInheritanceDepth reached when attempting to load base theme");const r=Array.isArray(e.extends)?e.extends:[e.extends];delete e.extends;let o={};for(const e of r){const t=await a.load(e,Object.assign(Object.assign({},i),{resolveDefinitions:!1,maxInheritanceDepth:n-1}));o=a.mergeThemes(t,o)}return a.mergeThemes(e,o)}static mergeThemes(e,t){const i=Object.assign(Object.assign({},t.definitions),e.definitions);let n;if(t.styles&&e.styles){const i=Object.keys(t.styles),r=Object.keys(e.styles);n={},i.forEach(i=>{const s=r.indexOf(i);if(-1!==s){const o=t.styles[i],a=[],l=new Map;o.forEach(e=>{"string"==typeof e.id&&l.set(e.id,a.length),a.push(e)});e.styles[i].forEach(e=>{if("string"==typeof e.extends&&l.has(e.extends)){const t=l.get(e.extends),i=a[t];return a[t]=Object.assign(Object.assign({},i),e),void(a[t].extends=void 0)}if("string"==typeof e.id&&l.has(e.id)){const t=l.get(e.id);a[t]=e}else a.push(e)}),n[i]=a,r.splice(s,1)}else n[i]=t.styles[i]}),r.forEach(t=>{n[t]=e.styles[t]})}else t.styles?n=Object.assign({},t.styles):e.styles&&(n=Object.assign({},e.styles));return Object.assign(Object.assign(Object.assign(Object.assign({},t),e),a.mergeImageTextures(e,t)),{definitions:i,styles:n})}static mergeImageTextures(e,t){const i=Object.assign(Object.assign({},t.images),e.images);let n=[];return!t.imageTextures&&e.imageTextures?n=e.imageTextures:t.imageTextures&&!e.imageTextures?n=t.imageTextures:t.imageTextures&&e.imageTextures&&(n=e.imageTextures.slice(),t.imageTextures.forEach(e=>{n.find(({name:t})=>t===e.name)||n.push(e)})),{images:i,imageTextures:n}}static convertFlatTheme(e){if(Array.isArray(e.styles)){const t={};e.styles.forEach(e=>{if(n.isJsonExpr(e))throw new Error("invalid usage of theme reference");const i=e.styleSet;if(void 0===i)throw new Error("missing reference to style set");t[i]||(t[i]=[]),t[i].push(e)}),e.styles=t}return e}static resolveResources(e,t){if(e.sky&&"cubemap"===e.sky.type)for(let i=0;i<o.SKY_CUBEMAP_FACE_COUNT;++i){const n=e.sky[o.SkyCubemapFaceId[i]];void 0!==n&&(e.sky[o.SkyCubemapFaceId[i]]=t.resolveUri(n))}if(e.images)for(const i of Object.keys(e.images)){const n=e.images[i];n.url=t.resolveUri(n.url),void 0!==n.atlas&&(n.atlas=t.resolveUri(n.atlas))}if(e.fontCatalogs)for(const i of e.fontCatalogs)i.url=t.resolveUri(i.url);if(e.poiTables)for(const i of e.poiTables)i.url=t.resolveUri(i.url);if(void 0!==e.styles)for(const i in e.styles){if(!e.styles.hasOwnProperty(i))continue;const n=e.styles[i];for(const e of n)e.attr&&["map","normalMap","displacementMap","roughnessMap"].forEach(i=>{const n=e.attr[i];n&&"string"==typeof n&&(e.attr[i]=t.resolveUri(n))})}}}t.ThemeLoader=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElement=t.LoadingState=t.poiIsRenderable=void 0;const n=i(8),r=i(0),s=i(17);t.poiIsRenderable=function(e){return void 0!==e.buffer},function(e){e[e.Requested=0]="Requested",e[e.Loaded=1]="Loaded",e[e.Initialized=2]="Initialized"}(t.LoadingState||(t.LoadingState={}));class o{constructor(e,t,i,o,a=0,l=0,c=0,h,u,d,m,p,f,g,v){this.text=e,this.points=t,this.renderParams=i,this.layoutParams=o,this.priority=a,this.xOffset=l,this.yOffset=c,this.featureId=h,this.style=u,this.fadeNear=d,this.fadeFar=m,this.tileOffset=p,this.offsetDirection=f,this.dataSourceName=g,this.dataSourceOrder=v,this.visible=!0,this.distanceScale=.5,this.renderOrder=0,this.elevated=!1,i instanceof n.TextRenderStyle&&(this.renderStyle=i),o instanceof n.TextLayoutStyle&&(this.layoutStyle=o),this.type=t instanceof r.Vector3?s.TextElementType.PoiLabel:s.TextElementType.PathLabel}get position(){if(this.points instanceof Array){return this.points[0]}return this.points}get path(){if(this.points instanceof Array)return this.points}get textMayOverlap(){return!0===this.mayOverlap}set textMayOverlap(e){this.mayOverlap=e}get textReservesSpace(){return!1!==this.reserveSpace}set textReservesSpace(e){this.reserveSpace=e}get poiInfo(){return this.m_poiInfo}set poiInfo(e){if(this.m_poiInfo=e,void 0!==e){void 0!==this.path&&(this.type=s.TextElementType.LineMarker);const t=void 0!==this.renderOrder?this.renderOrder:0;e.renderOrder=t}}get renderStyle(){return this.m_renderStyle}set renderStyle(e){this.m_renderStyle=e}get layoutStyle(){return this.m_layoutStyle}set layoutStyle(e){this.m_layoutStyle=e}hasFeatureId(){return void 0!==this.featureId&&("number"==typeof this.featureId?0!==this.featureId:this.featureId.length>0)}dispose(){var e;const t=null===(e=this.poiInfo)||void 0===e?void 0:e.buffer;t&&t.decreaseRefCount()}}t.TextElement=o,o.HIGHEST_PRIORITY=Number.MAX_SAFE_INTEGER},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(84),t),r(i(50),t),r(i(168),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorProjection=t.mercatorProjection=t.MercatorConstants=void 0;const n=i(0),r=i(12),s=i(7),o=i(20),a=i(22),l=i(13),c=i(23),h=i(21),u=i(14);class d extends u.Projection{constructor(){super(...arguments),this.type=u.ProjectionType.Planar}static clamp(e,t,i){return Math.min(Math.max(t,e),i)}static latitudeClamp(e){return d.clamp(e,-m.MAXIMUM_LATITUDE,m.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return d.latitudeProject(d.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/this.unitScale-.5))}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){var i;let n;return n=e instanceof s.GeoCoordinates?e:new s.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(n.longitude+180)/360*this.unitScale,t.y=(.5*d.latitudeClampProject(n.latitudeInRadians)+.5)*this.unitScale,t.z=null!==(i=n.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return s.GeoCoordinates.fromRadians(d.unprojectLatitude(2*(e.y/this.unitScale-.5)),e.x/this.unitScale*2*Math.PI-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){var i;const r=this.projectPoint(e.center),s=(.5*d.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*this.unitScale,o=(.5*d.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*this.unitScale,h=.5*(s+o);r.y=h;const u=s-o,m=e.longitudeSpan/360*this.unitScale;if(t||(t=new n.Box3),a.isBox3Like(t)){t.min.x=r.x-.5*m,t.min.y=r.y-.5*u,t.max.x=r.x+.5*m,t.max.y=r.y+.5*u;const i=e.altitudeSpan;void 0!==i?(t.min.z=r.z-.5*i,t.max.z=r.z+.5*i):(t.min.z=0,t.max.z=0)}else{if(!c.isOrientedBox3Like(t))throw new Error("invalid bounding box");l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,1,0,t.yAxis),l.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=r.x,t.position.y=r.y,t.position.z=r.z,t.extents.x=.5*m,t.extents.y=.5*u,t.extents.z=Math.max(Number.EPSILON,.5*(null!==(i=e.altitudeSpan)&&void 0!==i?i:0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}reprojectPoint(e,i,n){return e===this||e!==t.webMercatorProjection&&e!==t.mercatorProjection?super.reprojectPoint(e,i,n):(void 0===n&&(n={}),n.x=i.x,n.y=this.unitScale-i.y,n.z=i.z,n)}}class m{}t.MercatorConstants=m,m.MAXIMUM_LATITUDE=1.4844222297453322,t.mercatorProjection=new d(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE),t.webMercatorProjection=new class extends d{projectPoint(e,t){var i;let n;n=e instanceof s.GeoCoordinates?e:new s.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(n.longitude+180)/360*this.unitScale;const r=Math.sin(d.latitudeClamp(n.latitudeInRadians));return t.y=(.5-Math.log((1+r)/(1-r))/(4*Math.PI))*this.unitScale,t.z=null!==(i=n.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){const t=e.x/this.unitScale-.5,i=.5-e.y/this.unitScale,n=360*t,r=90-360*Math.atan(Math.exp(2*-i*Math.PI))/Math.PI;return new s.GeoCoordinates(r,n,e.z)}projectBox(e,t){const i=super.projectBox(e,t);if(a.isBox3Like(i)){const e=i.max.y;i.max.y=this.unitScale-i.min.y,i.min.y=this.unitScale-e}else c.isOrientedBox3Like(i)&&(l.MathUtils.newVector3(1,0,0,i.xAxis),l.MathUtils.newVector3(0,-1,0,i.yAxis),l.MathUtils.newVector3(0,0,-1,i.zAxis),i.position.y=this.unitScale-i.position.y);return i}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return new r.GeoBox(new s.GeoCoordinates(i.latitude,t.longitude,t.altitude),new s.GeoCoordinates(t.latitude,i.longitude,i.altitude))}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}localTangentSpace(e,t){return o.isGeoCoordinatesLike(e)?this.projectPoint(e,t.position):l.MathUtils.copyVector3(e,t.position),l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,-1,0,t.yAxis),l.MathUtils.newVector3(0,0,-1,t.zAxis),t}}(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quadTreeSubdivisionScheme=void 0;t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileKey=void 0;const n=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class r{constructor(e,t,i){this.row=e,this.column=t,this.level=i}static fromRowColumnLevel(e,t,i){return new r(e,t,i)}static fromQuadKey(e){const t=e.length;let i=0,n=0;for(let r=0;r<e.length;++r){const s=1<<r,o=parseInt(e.charAt(t-r-1),10);1&o&&(n|=s),2&o&&(i|=s)}return r.fromRowColumnLevel(i,n,t)}static fromMortonCode(e){let t=0,i=0,n=0,s=e;for(;s>1;){const e=1<<t;1&s&&(n|=e),2&s&&(i|=e),t++,s=(s-(3&s))/4}const o=r.fromRowColumnLevel(i,n,t);return o.m_mortonCode=e,o}static fromHereTile(e){const t=r.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,i,n,s){return r.fromRowColumnLevel(Math.floor(i/(s/r.rowsAtLevel(e))),Math.floor(t/(n/r.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}parent(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return r.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let i=this.row,n=this.column;return e>=0?(i<<=e,n<<=e):(i>>>=-e,n>>>=-e),r.fromRowColumnLevel(i,n,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,i=n[this.level<<1];for(let r=0;r<this.level;++r)1&e&&(i+=n[2*r]),1&t&&(i+=n[2*r+1]),e>>>=1,t>>>=1;this.m_mortonCode=i}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e="";for(let t=this.level;t>0;--t){const i=1<<t-1,n=0!=(this.column&i),r=0!=(this.row&i);e+=n&&r?"3":r?"2":n?"1":"0"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=r.fromQuadKey(0===e.length?"-":e),i=this.changedLevelBy(t.level);return r.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}addedSubHereTile(e){const t=r.fromHereTile(e),i=this.changedLevelBy(t.level);return r.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return r.rowsAtLevel(this.level)}columnCount(){return r.columnsAtLevel(this.level)}}t.TileKey=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RGBA=void 0;const n=i(0),r=i(30),s=i(43);class o{constructor(e=1,t=1,i=1,n=1){this.r=e,this.g=t,this.b=i,this.a=n}static parse(e){const t=s.parseStringEncodedColor(e);if(void 0!==t)return r.ColorUtils.getRgbaFromHex(t)}clone(){return new o(this.r,this.g,this.b,this.a)}getHex(){return r.ColorUtils.getHexFromRgba(this.r,this.g,this.b,this.a)}lerp(e,t){return this.r=n.MathUtils.lerp(this.r,e.r,t),this.g=n.MathUtils.lerp(this.g,e.g,t),this.b=n.MathUtils.lerp(this.b,e.b,t),this.a=n.MathUtils.lerp(this.a,e.a,t),this}toJSON(){return`rgba(${255*this.r<<0}, ${255*this.g<<0}, ${255*this.b<<0}, ${this.a})`}}t.RGBA=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseStringEncodedColor=t.parseStringEncodedNumeral=t.StringEncodedNumeralFormatMaxSize=t.StringEncodedNumeralFormats=t.StringEncodedColorFormats=t.StringEncodedMetricFormats=t.StringEncodedNumeralType=void 0;const n=i(1),r=i(223),s=i(30);var o;!function(e){e[e.Meters=0]="Meters",e[e.Pixels=1]="Pixels",e[e.Hex=2]="Hex"}(o=t.StringEncodedNumeralType||(t.StringEncodedNumeralType={}));const a={type:o.Meters,size:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))m$/,decoder:(e,t)=>{const i=a.regExp.exec(e);return!!i&&void 0!==(t[0]=Number(i[1]))}},l={type:o.Pixels,size:1,mask:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/,decoder:(e,t)=>{const i=l.regExp.exec(e);return null!==i&&(t[0]=Number(i[1]),!0)}},c={type:o.Hex,size:4,regExp:/^\#((?:[0-9A-Fa-f][0-9A-Fa-f]){4}|[0-9A-Fa-f]{4})$/,decoder:(e,t)=>{const i=c.regExp.exec(e);if(null===i)return!1;const r=i[1],s=r.length;return n.assert(4===s||8===s,"Matched incorrect hex color format"),4===s?(t[0]=parseInt(r.charAt(0)+r.charAt(0),16)/255,t[1]=parseInt(r.charAt(1)+r.charAt(1),16)/255,t[2]=parseInt(r.charAt(2)+r.charAt(2),16)/255,t[3]=4===s?parseInt(r.charAt(3)+r.charAt(3),16)/255:1):8===s&&(t[0]=parseInt(r.charAt(0)+r.charAt(1),16)/255,t[1]=parseInt(r.charAt(2)+r.charAt(3),16)/255,t[2]=parseInt(r.charAt(4)+r.charAt(5),16)/255,t[3]=8===s?parseInt(r.charAt(6)+r.charAt(7),16)/255:1),!0}};t.StringEncodedMetricFormats=[a,l];const h=t.StringEncodedMetricFormats.reduce((e,t)=>Math.max(e,t.size),0);t.StringEncodedColorFormats=[c];const u=t.StringEncodedColorFormats.reduce((e,t)=>Math.max(e,t.size),0);t.StringEncodedNumeralFormats=[...t.StringEncodedMetricFormats,...t.StringEncodedColorFormats],t.StringEncodedNumeralFormatMaxSize=Math.max(u,h);const d=new Array(t.StringEncodedNumeralFormatMaxSize);function m(e,t,i=1){const n=t.find(t=>!!t.decoder(e,d));if(void 0===n){const t=r.parseCSSColor(e);return Array.isArray(t)&&!t.some(e=>isNaN(e))?s.ColorUtils.getHexFromRgba(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}switch(null==n?void 0:n.type){case o.Pixels:return d[0]*i;case o.Hex:return s.ColorUtils.getHexFromRgba(d[0],d[1],d[2],d[3]);default:return d[0]}}t.parseStringEncodedNumeral=function(e,i=1){return m(e,t.StringEncodedNumeralFormats,i)},t.parseStringEncodedColor=function(e){return m(e,t.StringEncodedColorFormats)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapEnv=t.Env=void 0;class n{static isEnv(e){return e instanceof n}lookup(e){}unmap(){return{}}}t.Env=n;t.MapEnv=class extends n{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){if(this.entries.hasOwnProperty(e)){const t=this.entries[e];if(void 0!==t)return t}return this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileLoaderState=void 0,function(e){e[e.Initialized=0]="Initialized",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Decoding=3]="Decoding",e[e.Ready=4]="Ready",e[e.Canceled=5]="Canceled",e[e.Failed=6]="Failed"}(t.TileLoaderState||(t.TileLoaderState={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundDataSource=void 0;const n=i(2),r=i(67),s=i(68),o=i(24);class a extends r.DataSource{constructor(){super({name:"background"}),this.m_tilingScheme=a.DEFAULT_TILING_SCHEME,this.cacheable=!0,this.addGroundPlane=!0,this.enablePicking=!1}updateStorageLevelOffset(){let e;this.mapView.dataSources.forEach(t=>{if(t===this)return;t.getTilingScheme()===this.m_tilingScheme&&(e=void 0===e?t.storageLevelOffset:Math.max(e,t.storageLevelOffset))}),void 0===e&&(e=0),e!==this.storageLevelOffset&&(this.storageLevelOffset=e,this.mapView.clearTileCache(this.name))}async setTheme(e,t){this.mapView.clearTileCache(this.name)}setTilingScheme(e){const t=null!=e?e:a.DEFAULT_TILING_SCHEME;t!==this.m_tilingScheme&&(this.m_tilingScheme=t,this.updateStorageLevelOffset(),this.mapView.clearTileCache(this.name))}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new o.Tile(this,e);return t.forceHasGeometry(!0),s.addGroundPlane(t,a.GROUND_RENDER_ORDER),t}}t.BackgroundDataSource=a,a.GROUND_RENDER_ORDER=Number.MIN_SAFE_INTEGER,a.DEFAULT_TILING_SCHEME=n.webMercatorTilingScheme},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementsRenderer=t.DEFAULT_TEXT_DISTANCE_SCALE=t.DEFAULT_FONT_CATALOG_NAME=void 0;const n=i(8),r=i(1),s=i(0),o=i(81),a=i(136),l=i(75),c=i(148),h=i(149),u=i(294),d=i(151),m=(i(295),i(296)),p=i(297),f=i(37),g=i(298),v=i(299),y=i(17),_=i(153);i(303);var x;!function(e){e[e.PersistentLabels=0]="PersistentLabels",e[e.NewLabels=1]="NewLabels"}(x||(x={})),t.DEFAULT_FONT_CATALOG_NAME="default",t.DEFAULT_TEXT_DISTANCE_SCALE=.5;const w=r.LoggerManager.instance.create("TextElementsRenderer",{level:r.LogLevel.Log}),b=void 0,M=void 0,T=new s.Vector3,S=new s.Vector2,E=[],P=new s.Vector2,A={},C={},L={},R={vector2:[new s.Vector2]};class D{constructor(e,t){this.tile=e,this.group=t}}class O{constructor(e){this.lists=e}get priority(){return r.assert(this.lists.length>0),this.lists[0].group.priority}count(){let e=0;for(const t of this.lists)e+=t.group.elements.length;return e}}function I(e,t,i,n,r){C.path=n,C.pathOverflow=r,C.layer=e.renderOrder,C.letterCaseArray=e.glyphCaseArray,C.pickingData=e.userData?e:void 0,t.addText(e.glyphs,i,C)}function F(e){if(void 0===e)return!1;return r.PerformanceTimer.now()-e>10&&(w.debug("Placement time limit exceeded."),!0)}t.TextElementsRenderer=class{constructor(e,t,i,n,r,o,a,l,u,d){this.m_viewState=e,this.m_viewUpdateCallback=t,this.m_screenProjector=i,this.m_poiManager=n,this.m_renderer=r,this.m_imageCaches=o,this.m_loadPromisesCount=0,this.m_textCanvases=new Map,this.m_tmpVector=new s.Vector2,this.m_tmpVector3=new s.Vector3,this.m_cameraLookAt=new s.Vector3,this.m_overloaded=!1,this.m_cacheInvalidated=!1,this.m_forceNewLabelsPass=!1,this.m_addNewLabels=!0,this.m_textElementStateCache=new v.TextElementStateCache,this.m_camera=new s.OrthographicCamera(-1,1,1,-1),this.m_textStyleCache=new _.TextStyleCache,this.m_screenCollisions=new h.ScreenCollisions,this.m_options=Object.assign({},a),g.initializeDefaultOptions(this.m_options),d?this.m_screenCollisions=d:void 0!==this.m_options.collisionDebugCanvas&&null!==this.m_options.collisionDebugCanvas&&(this.m_screenCollisions=new h.ScreenCollisionsDebug(this.m_options.collisionDebugCanvas)),this.m_textCanvasFactory=null!=l?l:new p.TextCanvasFactory(this.m_renderer),this.m_textCanvasFactory.setGlyphCountLimits(this.m_options.minNumGlyphs,this.m_options.maxNumGlyphs),this.m_poiRenderer=null!=u?u:new c.PoiRenderer(this.m_renderer,this.m_poiManager,this.m_imageCaches),this.initializeCamera(),this.initializeDefaultFontCatalog(),this.m_textStyleCache.updateTextCanvases(this.m_textCanvases)}set disableFading(e){this.m_options.disableFading=e}get disableFading(){return!0===this.m_options.disableFading}get styleCache(){return this.m_textStyleCache}get delayLabelsUntilMovementFinished(){return!0===this.m_options.delayLabelsUntilMovementFinished}set delayLabelsUntilMovementFinished(e){this.m_options.delayLabelsUntilMovementFinished=e}get showReplacementGlyphs(){return!0===this.m_options.showReplacementGlyphs}set showReplacementGlyphs(e){this.m_options.showReplacementGlyphs=e,this.m_textCanvases.forEach(t=>{(null==t?void 0:t.fontCatalog)&&(t.fontCatalog.showReplacementGlyphs=e)})}restoreRenderers(e){this.m_renderer=e,this.m_poiRenderer=new c.PoiRenderer(this.m_renderer,this.m_poiManager,this.m_imageCaches)}async updateFontCatalogs(e){if(this.m_defaultFontCatalogConfig&&(e&&-1!==e.findIndex(e=>e.name===t.DEFAULT_FONT_CATALOG_NAME)?this.m_textCanvases.has(t.DEFAULT_FONT_CATALOG_NAME)&&this.m_textCanvases.delete(t.DEFAULT_FONT_CATALOG_NAME):(e||(e=[]),e.unshift(this.m_defaultFontCatalogConfig))),e&&e.length>0){for(const[t]of this.m_textCanvases)e.findIndex(e=>e.name===t)<0&&this.m_textCanvases.delete(t);for(const t of e)await this.addTextCanvas(t)}else this.m_textCanvases.clear();this.m_textStyleCache.updateTextCanvases(this.m_textCanvases)}async updateTextStyles(e,t){this.m_textStyleCache.updateTextStyles(e,t),await this.waitLoaded(),this.m_textStyleCache.updateTextCanvases(this.m_textCanvases)}renderText(e){let t;this.m_camera.far=e,this.updateGlyphDebugMesh(),this.m_poiRenderer.update();for(const e of this.m_poiRenderer.layers){for(const[,i]of this.m_textCanvases)null==i||i.render(this.m_camera,null==t?void 0:t.id,e.id,void 0,!1);this.m_poiRenderer.render(this.m_camera,e),t=e}for(const[,e]of this.m_textCanvases)null==e||e.render(this.m_camera,null==t?void 0:t.id,void 0,void 0,!1)}invalidateCache(){this.m_cacheInvalidated=!0}movementStarted(){this.delayLabelsUntilMovementFinished&&(this.m_addNewLabels=!1)}movementFinished(){this.invalidateCache(),this.delayLabelsUntilMovementFinished&&(this.m_addNewLabels=!0)}get overloaded(){return this.m_overloaded}placeText(e,t){const i=function(e){let t=!1;return e.forEach(({renderedTiles:e})=>{e.forEach(e=>{e.textElementsChanged&&(e.textElementsChanged=!1,t=!0)})}),t}(e);if(!(this.hasOverlayText()||i||function(e){for(let t=0;t<e.length;t++)for(const[i,n]of e[t].renderedTiles)if(n.hasTextElements())return!0;return!1}(e))&&!this.m_cacheInvalidated&&!this.m_viewState.renderedTilesChanged)return;const n=this.m_cacheInvalidated||i||this.m_viewState.renderedTilesChanged,r=n&&this.m_addNewLabels;r&&(this.m_textElementStateCache.clearVisited(),this.updateTextElements(e));const s=this.m_textElementStateCache.update(t,this.m_options.disableFading,r,this.m_viewState.zoomLevel);this.reset(),this.m_addNewLabels&&this.prepopulateScreenWithBlockingElements(e);const o=(n||s)&&this.m_addNewLabels;this.placeTextElements(t,o),this.placeOverlayTextElements()}addOverlayText(e){0!==e.length&&(this.m_overlayTextElements=void 0===this.m_overlayTextElements?e.slice():this.m_overlayTextElements.concat(e))}clearOverlayText(){this.m_overlayTextElements=[]}hasOverlayText(){return void 0!==this.m_overlayTextElements&&this.m_overlayTextElements.length>0}get overlayText(){return this.m_overlayTextElements}pickTextElements(e,t){const i=(i,n)=>{if(void 0===i)return;const r=i,s={type:n,point:e,distance:0,renderOrder:r.renderOrder,featureId:r.featureId,userData:r.userData,dataSourceName:r.dataSourceName,dataSourceOrder:r.dataSourceOrder,text:r.text};t.addResult(s)};for(const[,t]of this.m_textCanvases)null==t||t.pickText(e,e=>{i(e,l.PickObjectType.Text)});this.m_poiRenderer.pickTextElements(e,e=>{i(e,l.PickObjectType.Icon)})}get loading(){return this.m_loadPromisesCount>0}async waitLoaded(){if(void 0!==this.m_loadPromise)return await this.m_loadPromise}clearRenderStates(){this.m_textElementStateCache.clear()}getMemoryUsage(){const e={heapSize:0,gpuSize:0};for(const[,t]of this.m_textCanvases)null==t||t.getMemoryUsage(e);return this.m_poiRenderer.getMemoryUsage(e),e}async addDefaultTextCanvas(){!this.m_textCanvases.has(t.DEFAULT_FONT_CATALOG_NAME)&&this.m_defaultFontCatalogConfig&&(await this.addTextCanvas(this.m_defaultFontCatalogConfig),this.m_textStyleCache.updateTextCanvases(this.m_textCanvases))}reset(){this.m_cameraLookAt.copy(this.m_viewState.lookAtVector),this.m_screenCollisions.reset();for(const[,e]of this.m_textCanvases)null==e||e.clear();this.m_poiRenderer.reset()}prepopulateScreenWithBlockingElements(e){const t=[];e.forEach(e=>{const i=new s.Vector3,n=new s.Vector3;for(const r of e.renderedTiles.values())for(const e of r.blockingElements)if(!(e.points.length<2)){this.m_screenProjector.project3(e.points[0],i);for(let r=1;r<e.points.length;r++){this.m_screenProjector.project3(e.points[r],n);const s=e.screenSpaceLines[r-1];s.start.copy(i),s.end.copy(n);const o={minX:Math.min(i.x,n.x),maxX:Math.max(i.x,n.x),minY:Math.min(i.y,n.y),maxY:Math.max(i.y,n.y),line:s};t.push(o),i.copy(n)}}}),this.m_screenCollisions.allocateIBoxes(t)}placeTextElementGroup(e,t,i,s){var o;r.assert(e.visited);const l=[],c=this.m_viewState.hiddenGeometryKinds,h=this.m_viewState.projection,u=this.m_viewState.elevationProvider,m=null==u?void 0:u.getDisplacementMap(e.tileKey);for(const r of e.textElementStates){if(s===x.PersistentLabels)M&&++M.total;else if(void 0!==i&&t.numRenderedTextElements>=i)return w.debug("Placement label limit exceeded."),!1;if(!r.initialized){M&&++M.uninitialized;continue}if(void 0===r.viewDistance||r.viewDistance<0){M&&++M.tooFar;continue}const e=r.visible;if(s===x.PersistentLabels&&!e||s===x.NewLabels&&e)continue;const p=r.element,f=this.m_textStyleCache.getTextElementStyle(p.style),g=f.textCanvas;if(void 0!==c&&void 0!==p.kind&&c.hasOrIntersects(p.kind))continue;if(void 0!==u&&!p.elevated){if(!m){this.m_viewUpdateCallback(),this.m_forceNewLabelsPass=!0;continue}a.overlayTextElement(p,u,m,h)}const v=p.type;if(v===y.TextElementType.PathLabel&&d.isPathLabelTooSmall(p,this.m_screenProjector,E)){M&&M.numNotVisible++,!0===p.dbgPathTooSmall&&M&&M.numPathTooSmall++,r.reset();continue}const _=!0;if(g){if(!this.initializeGlyphs(p,f,_))continue;const e=g.getLayer(null!==(o=p.renderOrder)&&void 0!==o?o:n.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==e&&e.storage.drawCount+p.glyphs.length>e.storage.capacity){M&&++M.numCannotAdd,w.warn("layer glyph storage capacity exceeded.");continue}g.textRenderStyle=p.renderStyle,g.textLayoutStyle=p.layoutStyle}switch(v){case y.TextElementType.PoiLabel:this.addPoiLabel(r,g,t);break;case y.TextElementType.LineMarker:this.addLineMarkerLabel(r,l,g,t);break;case y.TextElementType.PathLabel:g&&this.addPathLabel(r,E,g,t)}}return!0}initializeGlyphs(e,t,i){if(e.loadingState===f.LoadingState.Initialized)return void 0!==e.glyphs;r.assert(void 0!==t.textCanvas);const s=t.textCanvas;if(void 0===e.loadingState)if(e.loadingState=f.LoadingState.Requested,void 0===e.renderStyle&&(e.renderStyle=new n.TextRenderStyle(Object.assign(Object.assign({},t.renderParams),e.renderParams))),void 0===e.layoutStyle&&(e.layoutStyle=new n.TextLayoutStyle(Object.assign(Object.assign({},t.layoutParams),e.layoutParams))),""===e.text)e.loadingState=f.LoadingState.Loaded;else{const t=s.fontCatalog.loadCharset(e.text,e.renderStyle).then(()=>{--this.m_loadPromisesCount,e.loadingState=f.LoadingState.Loaded,this.m_forceNewLabelsPass=this.m_forceNewLabelsPass||i,this.m_viewUpdateCallback()});0===this.m_loadPromisesCount&&(this.m_loadPromise=void 0),++this.m_loadPromisesCount,this.m_loadPromise=void 0===this.m_loadPromise?t:Promise.all([this.m_loadPromise,t])}return e.loadingState===f.LoadingState.Loaded&&(s.textRenderStyle=e.renderStyle,s.textLayoutStyle=e.layoutStyle,e.glyphCaseArray=[],e.bounds=void 0,e.glyphs=s.fontCatalog.getGlyphs(e.text,s.textRenderStyle,e.glyphCaseArray),e.loadingState=f.LoadingState.Initialized),void 0!==e.glyphs}initializeCamera(){this.m_camera.position.z=1,this.m_camera.near=0}updateCamera(){const{width:e,height:t}=this.m_renderer.getSize(R.vector2[0]);this.m_camera.left=e/-2,this.m_camera.right=e/2,this.m_camera.bottom=t/-2,this.m_camera.top=t/2,this.m_camera.updateProjectionMatrix(),this.m_camera.updateMatrixWorld(!1),this.m_screenCollisions.update(e,t)}initializeDefaultFontCatalog(){var e;this.m_options.fontCatalog&&(this.m_defaultFontCatalogConfig=(e=this.m_options.fontCatalog,{name:t.DEFAULT_FONT_CATALOG_NAME,url:e}),this.addDefaultTextCanvas())}async addTextCanvas(e){const t=(e,t)=>{if(this.m_textCanvases.has(e)){const i=this.m_textCanvasFactory.createTextCanvas(t,e);t.showReplacementGlyphs=this.showReplacementGlyphs,this.m_textCanvases.set(e,i)}},i=()=>{this.m_textCanvases.delete(e.name)};if(this.m_textCanvases.has(e.name))return Promise.resolve();{this.m_textCanvases.set(e.name,void 0);const n=u.loadFontCatalog(e,t,i).then(()=>{--this.m_loadPromisesCount,this.m_viewUpdateCallback()}).catch(e=>{w.info("rendering without font catalog, only icons possible",e),--this.m_loadPromisesCount});return 0===this.m_loadPromisesCount&&(this.m_loadPromise=void 0),++this.m_loadPromisesCount,this.m_loadPromise=void 0===this.m_loadPromise?n:Promise.all([this.m_loadPromise,n]),n}}updateGlyphDebugMesh(){const e=o.debugContext.getValue("DEBUG_GLYPHS");void 0!==e&&(e&&void 0===this.m_debugGlyphTextureCacheMesh&&this.initializeGlyphDebugMesh(),r.assert(void 0!==this.m_debugGlyphTextureCacheMesh),r.assert(void 0!==this.m_debugGlyphTextureCacheWireMesh),this.m_debugGlyphTextureCacheMesh.visible=e,this.m_debugGlyphTextureCacheWireMesh.visible=e)}initializeGlyphDebugMesh(){if(0===this.m_textCanvases.size)return;const e=this.m_textCanvases.values().next().value,t=e.fontCatalog,i=new s.PlaneGeometry(t.textureSize.width/2.5,t.textureSize.height/2.5,t.textureSize.width/t.maxWidth,t.textureSize.height/t.maxHeight),r=new s.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:t.texture});this.m_debugGlyphTextureCacheMesh=new s.Mesh(i,r),this.m_debugGlyphTextureCacheMesh.renderOrder=1e4,this.m_debugGlyphTextureCacheMesh.visible=!1,this.m_debugGlyphTextureCacheMesh.name="glyphDebug";const o=new s.WireframeGeometry(i),a=new s.LineBasicMaterial({transparent:!0,color:10066329,depthWrite:!1,depthTest:!1});this.m_debugGlyphTextureCacheWireMesh=new s.LineSegments(o,a),this.m_debugGlyphTextureCacheWireMesh.renderOrder=9999,this.m_debugGlyphTextureCacheWireMesh.visible=!1,this.m_debugGlyphTextureCacheWireMesh.name="glyphDebug",e.getLayer(n.DEFAULT_TEXT_CANVAS_LAYER).storage.scene.add(this.m_debugGlyphTextureCacheMesh,this.m_debugGlyphTextureCacheWireMesh)}updateTextElements(e){b&&b.clear(),this.m_textElementStateCache.clearTextCache(),this.m_cacheInvalidated=!1,this.checkIfOverloaded(e);const t=this.overloaded&&this.m_viewState.isDynamic?r.PerformanceTimer.now():void 0;e.forEach(e=>{this.updateTextElementsFromSource(e.dataSource,e.storageLevel,Array.from(e.renderedTiles.values()),t)}),b&&b.log()}updateTextElementsFromSource(e,t,i,n){b&&(b.tiles+=i.length);const s=i;s.sort((e,t)=>e.tileKey.mortonCode()-t.tileKey.mortonCode());const o=[];this.createSortedGroupsForSorting(e,t,s,o);let a=0;for(const e of o)if(this.selectTextElementsToUpdateByDistance(e),void 0!==n){if(r.PerformanceTimer.now()-n>5){w.debug("Update time limit exceeded.");break}if(a+=e.count(),a>=100){w.debug("Update label limit exceeded.");break}}}prepareTextElementGroup(e,t,i){if(0===e.elements.length)return;const[,n]=this.m_textElementStateCache.getOrSet(e,t,e=>{let{result:t,viewDistance:n}=d.checkReadyForPlacement(e.element,e.element.type===y.TextElementType.LineMarker?e.lineMarkerIndex:void 0,this.m_viewState,this.m_poiManager,i);return t!==d.PrePlacementResult.Ok||this.m_textElementStateCache.deduplicateElement(this.m_viewState.zoomLevel,e)||(t=d.PrePlacementResult.Duplicate,n=void 0),b&&(b.totalLabels++,b.results[t]++),n});b&&(++b.totalGroups,n||++b.newGroups)}createSortedGroupsForSorting(e,t,i,n){if(0===i.length)return;const r=[];for(const n of i)e.shouldRenderText(t,n.tileKey)&&r.push(n);const s=new Map;for(const e of r)for(const t of e.textElementGroups.groups.values()){if(0===t.elements.length)continue;const i=s.get(t.priority);void 0===i?s.set(t.priority,new O([new D(e,t)])):i.lists.push(new D(e,t))}if(0===s.size)return;for(const e of s){const t=e[1];n.push(t)}n.sort((e,t)=>t.priority-e.priority)}selectTextElementsToUpdateByDistance(e){const t=Math.max(this.m_options.maxDistanceRatioForTextLabels,this.m_options.maxDistanceRatioForPoiLabels),i=d.getMaxViewDistance(this.m_viewState,t);for(const t of e.lists)this.prepareTextElementGroup(t.group,t.tile.tileKey,i)}placeTextElements(e,t){const i={numRenderedTextElements:0,fadeAnimationRunning:!1,time:e},n=this.overloaded&&this.m_viewState.isDynamic?r.PerformanceTimer.now():void 0;if(M&&M.clear(),0===this.m_textElementStateCache.size)return void w.debug("Text element cache empty.");const s=this.m_forceNewLabelsPass||t;this.m_forceNewLabelsPass&&(this.m_forceNewLabelsPass=!1);const o=this.m_options.maxNumVisibleLabels,a=this.m_textElementStateCache.sortedGroupStates;let l=a[0].priority,c=0;for(let e=0;e<a.length;++e){const t=a[e];M&&++M.totalGroups;const r=t.priority;if(s&&l!==r){if(this.placeNewTextElements(c,e,i),F(n))break;l=r,c=e}if(!this.placeTextElementGroup(t,i,o,x.PersistentLabels))break;if(F(n))break}s&&this.placeNewTextElements(c,a.length,i),M&&(M.numRenderedTextElements=i.numRenderedTextElements,M.log()),i.fadeAnimationRunning&&this.m_viewUpdateCallback()}placeNewTextElements(e,t,i){const n=this.m_textElementStateCache.sortedGroupStates;for(let r=e;r<t&&this.placeTextElementGroup(n[r],i,this.m_options.maxNumVisibleLabels,x.NewLabels);++r);}placeOverlayTextElements(){var e;if(void 0===this.m_overlayTextElements||0===this.m_overlayTextElements.length)return;const t=this.m_tmpVector.set(this.m_screenProjector.width,this.m_screenProjector.height),i=-t.width/2,r=t.height/2;for(const o of this.m_overlayTextElements){const a=this.m_textStyleCache.getTextElementStyle(o.style),l=a.textCanvas;if(void 0===l)continue;const c=!1;if(this.initializeGlyphs(o,a,c),o.loadingState!==f.LoadingState.Initialized)continue;const h=l.getLayer(null!==(e=o.renderOrder)&&void 0!==e?e:n.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==h&&h.storage.drawCount+o.glyphs.length>h.storage.capacity)continue;let u;if(l.textRenderStyle=o.renderStyle,l.textLayoutStyle=o.layoutStyle,o.type!==y.TextElementType.PathLabel)S.x=i+o.position.x*t.width,S.y=r-o.position.y*t.height,void 0!==o.xOffset&&(S.x+=o.xOffset),void 0!==o.yOffset&&(S.y-=o.yOffset),T.x=S.x,T.y=S.y,T.z=0,I(o,l,T);else{S.x=i,S.y=r,void 0!==o.xOffset&&(S.x+=o.xOffset),void 0!==o.yOffset&&(S.y-=o.yOffset);const e=[];for(const i of o.path){const n=S.x+i.x*t.width,r=S.y-i.y*t.height;e.push(new s.Vector2(n,r))}u=new m.SimplePath;for(let t=0;t<e.length-1;++t)u.add(new s.LineCurve(e[t],e[t+1]));I(o,l,T,u,!0)}}}getDistanceScalingFactor(e,t,i){let n=i/t;return n=1+(n-1)*e.distanceScale,n=Math.max(n,this.m_options.labelDistanceScaleMin),n=Math.min(n,this.m_options.labelDistanceScaleMax),n}getDistanceFadingFactor(e,t,i){let n=1;const r=t.viewDistance;if(void 0!==r&&void 0!==e.fadeFar&&e.fadeFar>0){const t=void 0===e.fadeNear?0:e.fadeNear,o=e.fadeFar;o>t&&(n=1-s.MathUtils.clamp((r/i-t)/(o-t),0,1))}return n}addPointLabel(e,t,i,n,s){var o;const a=e.element,l=e.textRenderState,c=a.type===y.TextElementType.LineMarker,h=e.iconRenderState;r.assert(void 0!==h),S.x=P.x=i.x,S.y=P.y=i.y;const u=d.pointToPlaneDistance(t,this.m_viewState.worldCenter,this.m_cameraLookAt);if(void 0!==a.fadeFar&&(a.fadeFar<=0||a.fadeFar*this.m_viewState.maxVisibilityDist<u))return M&&++M.tooFar,!1;e.setViewDistance(u);const m=a.poiInfo;let p=!1;const f=void 0!==m&&r.MathUtils.isClamped(this.m_viewState.zoomLevel,m.iconMinZoomLevel,m.iconMaxZoomLevel)&&!1!==m.isValid,g=this.getDistanceScalingFactor(a,u,this.m_viewState.lookAtDistance),v=f&&this.m_poiRenderer.prepareRender(a,this.m_viewState.env);let _=!1;if(v){const e=d.placeIcon(h,m,P,g,this.m_viewState.env,this.m_screenCollisions);_=e===d.PlacementResult.Invisible,p=e===d.PlacementResult.Rejected,_&&h.reset()}else f&&!1!==m.isValid&&(this.m_forceNewLabelsPass=!0,this.m_viewUpdateCallback());const x=this.getDistanceFadingFactor(a,e,this.m_viewState.maxVisibilityDist);if(n&&function(e,t,i){const n=e.textRenderState,s=e.element,o=s.poiInfo;if(r.assert(s.type!==y.TextElementType.PathLabel),!(void 0!==n&&""!==s.text))return!1;if(!(void 0===o||r.MathUtils.isClamped(t.zoomLevel,o.textMinZoomLevel,o.textMaxZoomLevel)))return!1;const a=d.getMaxViewDistance(t,i.maxDistanceRatioForPoiLabels);return!!(!0===s.ignoreDistance||void 0===e.viewDistance||e.viewDistance<a&&e.viewDistance>0)&&(!o||!0===o.isValid||!0===o.iconIsOptional)}(e,this.m_viewState,this.m_options)){const t=!e.visible,i=p&&t?d.PlacementResult.Rejected:d.placePointLabel(e,S,g,n,this.m_viewState.env,this.m_screenCollisions,T,!c),r=i===d.PlacementResult.Invisible;if(r){if(M&&M.numPoiTextsInvisible++,!f||_)return e.reset(),!1;l.reset()}const h=!0===(null==m?void 0:m.iconIsOptional),u=p&&v&&!h||i===d.PlacementResult.Rejected;if(!p&&!_){const e=!0===(null===(o=a.poiInfo)||void 0===o?void 0:o.textIsOptional);p=u&&!e}u&&l.startFadeOut(s.time);!r&&(!u&&function(e,t){const i=e.element.poiInfo;return!t.cameraIsMoving||void 0===i||!0===i.renderTextDuringMovements}(e,this.m_viewState)||l.isFading())&&(u||l.startFadeIn(s.time,this.m_options.disableFading),s.fadeAnimationRunning=s.fadeAnimationRunning||l.isFading(),function(e,t,i,n,r){const s=e.element,o=e.textRenderState.opacity*n*s.renderStyle.opacity;if(0===o)return!1;A.letterCaseArray=s.glyphCaseArray,void 0===s.textBufferObject&&(s.textBufferObject=t.createTextBufferObject(s.glyphs,A));const a=s.renderStyle.backgroundOpacity>0&&t.textRenderStyle.fontSize.backgroundSize>0;return L.layer=s.renderOrder,L.position=i,L.scale=r,L.opacity=o,L.backgroundOpacity=a?L.opacity*s.renderStyle.backgroundOpacity:0,L.pickingData=s.userData?s:void 0,t.addTextBufferObject(s.textBufferObject,L),!0}(e,n,T,x,g)&&M&&M.numRenderedPoiTexts++)}if(v&&!_){p?h.startFadeOut(s.time):h.startFadeIn(s.time,this.m_options.disableFading),s.fadeAnimationRunning=s.fadeAnimationRunning||h.isFading();const t=h.opacity*x;if(t>0){const i=!1!==m.reserveSpace&&!p;this.m_poiRenderer.addPoi(m,P,this.m_screenCollisions,e.renderDistance,g,i,t,this.m_viewState.env),M&&M.numRenderedPoiIcons++}}return s.numRenderedTextElements++,!0}addPoiLabel(e,t,i){const n=d.getWorldPosition(e.element,this.m_viewState.projection,this.m_viewState.env,this.m_tmpVector3);return!!this.labelPotentiallyVisible(n,S)&&this.addPointLabel(e,n,S,t,i)}addLineMarkerLabel(e,t,i,n){var s;const o=e.element,a=o.poiInfo;if(!(null===(s=this.m_poiRenderer)||void 0===s?void 0:s.prepareRender(o,this.m_viewState.env)))return;let l;void 0!==a.shieldGroupIndex&&(l=t[a.shieldGroupIndex],void 0===l&&(l=[],t[a.shieldGroupIndex]=l));const c=a.technique,h=void 0!==c.minDistance?c.minDistance*c.minDistance:0;if(h>0&&void 0!==l){let t=0;const s=e.position;if(this.labelPotentiallyVisible(s,S)){let o=!1;for(let e=0;e<l.length;e+=2){if(o=r.Math2D.distSquared(l[e],l[e+1],S.x,S.y)<h,o)break}o||this.addPointLabel(e,s,S,i,n)&&(l.push(S.x,S.y),t++)}0===t&&e.reset()}else{const t=e.position;this.labelPotentiallyVisible(t,S)&&this.addPointLabel(e,t,S,i,n)}}addPathLabel(e,t,i,n){const r=d.getMaxViewDistance(this.m_viewState,this.m_options.maxDistanceRatioForTextLabels),o=e.element;if(!(!0===o.ignoreDistance||void 0===e.viewDistance||e.viewDistance<r))return M&&++M.tooFar,e.textRenderState.reset(),!1;if(void 0!==o.fadeFar&&(o.fadeFar<=0||o.fadeFar*this.m_viewState.maxVisibilityDist<e.renderDistance))return M&&++M.tooFar,e.textRenderState.reset(),!1;let a=new s.Path;S.copy(t[0]);for(let e=0;e<t.length-1;++e)a.add(new m.SimpleLineCurve(t[e],t[e+1]));if(a.getPoint(.5).x-a.getPoint(.51).x>0){S.copy(t[t.length-1]),a=new s.Path;for(let e=t.length-1;e>0;--e)a.add(new m.SimpleLineCurve(t[e],t[e-1]))}e.setViewDistance(d.computeViewDistance(o,void 0,this.m_viewState.worldCenter,this.m_cameraLookAt));const l=-e.renderDistance,c=this.getDistanceScalingFactor(o,l,this.m_viewState.lookAtDistance),h=i.textRenderStyle.fontSize.size;if(i.textRenderStyle.fontSize.size*=c,d.placePathLabel(e,a,S,i,this.m_screenCollisions)!==d.PlacementResult.Ok)return i.textRenderStyle.fontSize.size=h,M&&++M.numNotVisible,e.textRenderState.reset(),!1;e.textRenderState.startFadeIn(n.time,this.m_options.disableFading);let u=o.renderStyle.opacity;if(e.textRenderState.isFading()&&(u*=e.textRenderState.opacity,n.fadeAnimationRunning=!0),0===e.textRenderState.opacity)return i.textRenderStyle.fontSize.size=h,!1;const p=i.textRenderStyle.opacity,f=i.textRenderStyle.backgroundOpacity,g=this.getDistanceFadingFactor(o,e,this.m_viewState.maxVisibilityDist);return i.textRenderStyle.opacity=u*g,i.textRenderStyle.backgroundOpacity=i.textRenderStyle.opacity*o.renderStyle.backgroundOpacity,T.z=e.renderDistance,I(o,i,T,a),n.numRenderedTextElements++,i.textRenderStyle.fontSize.size=h,i.textRenderStyle.opacity=p,i.textRenderStyle.backgroundOpacity=f,!0}checkIfOverloaded(e){let t=0;e.forEach(e=>{for(const i of e.renderedTiles.values())t+=i.textElementGroups.count()});const i=t>2e4;return i&&!this.m_overloaded&&w.debug("Overloaded Mode enabled."),this.m_overloaded=i,this.m_overloaded}labelPotentiallyVisible(e,t){var i;const n=s.MathUtils.clamp(null!==(i=this.m_options.maxPoiDistanceToBorder)&&void 0!==i?i:0,0,1);return void 0!==this.m_screenProjector.projectAreaToScreen(e,n,n,t)}}},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(304),t),r(i(305),t),r(i(306),t),r(i(6),t),r(i(307),t),r(i(109),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getClampedGeoRect=t.harpToHGeoPolygon=t.harpGeoBoxToHGeoRect=t.hGeoRectToHarpGeoBox=t.getHarpBoundingBox=t.hToHarpGeoPolygon=void 0;const n=i(91),r=i(7),s=i(12),o=i(0);function a(e){return new s.GeoBox(new r.GeoCoordinates(e.getBottom(),e.getLeft()),new r.GeoCoordinates(e.getTop(),e.getRight()))}t.hToHarpGeoPolygon=function(e){const t=[];if(e.getExterior().eachLatLngAlt((e,i,n)=>{t.push(new r.GeoCoordinates(e,i,n))}),t.length>2)return new n.GeoPolygon(t,!0)},t.getHarpBoundingBox=function(e){return a(e.getBoundingBox())},t.hGeoRectToHarpGeoBox=a,t.harpGeoBoxToHGeoRect=function(e){return H.geo.Rect.fromPoints({lat:e.north,lng:e.west},{lat:e.south,lng:e.east})},t.harpToHGeoPolygon=function(e){if(void 0===e)return;const t=[];return function e(t){const i=[];t.push(t[0]);const n=t.length;for(let e=0;e<n-1;e++){const n=t[e],s=t[e+1];if(i.push(n),Math.abs(s.longitude-n.longitude)>=180){const e=(n.latitude+s.latitude)/2,t=(n.longitude+s.longitude)/2,o=(n.altitude+s.altitude)/2;i.push(new r.GeoCoordinates(e,t,o||void 0))}}return i.length!==t.length-1?e(i):i}(e.coordinates).map(e=>{t.push(e.latitude,e.longitude,e.altitude)}),new H.geo.Polygon(new H.geo.LineString(t))},t.getClampedGeoRect=function(e,t){const i=function(e){const t=Math.pow(2,e.level)-1;return{row:e.row===t,column:e.column===t}}(t);return new H.geo.Rect(0===t.row?90:o.MathUtils.clamp(e.north,-90,90),o.MathUtils.clamp(e.west,-180,180),i.row?-90:o.MathUtils.clamp(e.south,-90,90),i.column?180:o.MathUtils.clamp(e.east,-180,180))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDataSource=t.TileFactory=void 0;const n=i(5),r=i(36),s=i(1),o=i(168);t.TileFactory=class{constructor(e){this.m_modelConstructor=e}create(e,t){const i=new this.m_modelConstructor(e,t);return i.tileLoader=new o.TileLoader(e,t,e.dataProvider(),e.decoder),i}};class a extends n.DataSource{constructor(e,t){var i,r;if(super(t),this.m_tileFactory=e,this.m_options=t,this.logger=s.LoggerManager.instance.create("TileDataSource"),this.m_isReady=!1,t.decoder)this.m_decoder=t.decoder;else{if(!t.concurrentDecoderServiceName)throw new Error(`TileDataSource[${this.name}]: unable to create, missing decoder or concurrentDecoderServiceName`);this.m_decoder=n.ConcurrentDecoderFacade.getTileDecoder(t.concurrentDecoderServiceName,t.concurrentDecoderScriptUrl,t.concurrentDecoderWorkerCount,t.workerConnectionTimeout)}this.useGeometryLoader=!0,this.cacheable=!0,this.m_unregisterClearTileCache=null===(r=(i=this.dataProvider()).onDidInvalidate)||void 0===r?void 0:r.call(i,()=>this.mapView.markTilesDirty(this))}dispose(){var e;null===(e=this.m_unregisterClearTileCache)||void 0===e||e.call(this),this.decoder.dispose(),this.dataProvider().unregister(this)}ready(){return this.m_isReady&&this.m_options.dataProvider.ready()}get decoder(){return this.m_decoder}async connect(){await Promise.all([this.m_options.dataProvider.register(this),this.m_decoder.connect()]),this.m_isReady=!0;let e={};void 0!==this.m_options.storageLevelOffset&&(e={storageLevelOffset:this.m_options.storageLevelOffset}),this.m_decoder.configure({languages:this.languages},e)}setLanguages(e){this.languages=e,this.m_decoder.configure({languages:this.languages}),this.mapView.clearTileCache(this.name)}async setTheme(e,t){let i;e=await r.ThemeLoader.load(e),void 0!==this.styleSetName&&void 0!==e.styles&&(i=e.styles[this.styleSetName]),void 0!==t&&(this.languages=t),void 0!==i&&(this.m_decoder.configure({styleSet:i,definitions:e.definitions,priorities:e.priorities,labelPriorities:e.labelPriorities,languages:t}),this.mapView.clearTileCache(this.name))}dataProvider(){return this.m_options.dataProvider}getTilingScheme(){return this.m_options.tilingScheme}getTile(e,t=!1){const i=this.m_tileFactory.create(this,e);return i.copyrightInfo=this.m_options.copyrightInfo,void 0!==this.m_options.copyrightProvider&&this.m_options.copyrightProvider.getCopyrights(i.geoBox,e.level).then(e=>{i.copyrightInfo=void 0===i.copyrightInfo?e:[...i.copyrightInfo,...e],this.requestUpdate()}),t||i.load(),i}getTileInfo(e){return new Promise((t,i)=>{const r=new o.TileInfoLoader(this,e,this.m_options.dataProvider,this.decoder);r.loadAndDecode().then(e=>{e===n.TileLoaderState.Ready?t(r.tileInfo):i(new Error("TileDataSource#getInfoTile wrong final state: "+e))})})}}t.TileDataSource=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDecoderService=t.VectorTileDecoder=t.VectorTileDataProcessor=void 0;const n=i(3),r=i(48),s=i(354),o=i(1),a=i(177),l=i(359),c=i(360),h=i(381),u=i(28),d=i(382),m=o.LoggerManager.instance.create("VectorTileDecoder",{enabled:!1});class p{constructor(e,t,i,n,r={},s){var o,a;this.m_tileKey=e,this.m_projection=t,this.m_styleSetEvaluator=i,this.m_dataAdapter=n,this.m_options=r,this.m_dataFilter=s,r.storageLevelOffset=null!==(o=r.storageLevelOffset)&&void 0!==o?o:0,r.showMissingTechniques=null!==(a=r.showMissingTechniques)&&void 0!==a&&a}getDecodedTile(e){this.m_styleSetEvaluator.resetTechniques();const t=new h.DecodeInfo(this.m_projection,this.m_tileKey,this.m_options.storageLevelOffset);return this.m_decodedTileEmitter=new d.VectorTileDataEmitter(t,this.m_styleSetEvaluator,this.m_options),this.m_dataAdapter.process(e,t,this),this.m_decodedTileEmitter.getDecodedTile()}processPointFeature(e,t,i,r,s){o.assert(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,i,"point",r,s,this.m_decodedTileEmitter.processPointFeature,n.GeometryKind.Label)}processLineFeature(e,t,i,r,s){o.assert(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,i,"line",r,s,this.m_decodedTileEmitter.processLineFeature,n.GeometryKind.Line)}processPolygonFeature(e,t,i,r,s){o.assert(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,i,"polygon",r,s,this.m_decodedTileEmitter.processPolygonFeature,n.GeometryKind.Area)}processFeature(e,t,i,n,r,s,o,a){const l=this.createMapEnv(r,s,e,n),c=this.applyKindFilter(this.m_styleSetEvaluator.getMatchingTechniques(l,e,n),a);if(0===c.length)return void(this.m_options.showMissingTechniques&&m.log("VectorTileDataProcessor#processFeature: no techniques for object:",JSON.stringify(l.unmap())));const h={env:l,cachedExprResults:new Map};this.m_decodedTileEmitter&&o.apply(this.m_decodedTileEmitter,[e,t,i,h,c])}createMapEnv(e,t,i,n){const s=this.m_tileKey.level;return new r.MapEnv(Object.assign({$layer:i,$id:null!=t?t:null,$level:s,$zoom:Math.max(0,s-this.m_options.storageLevelOffset),$geometryType:n},e))}applyKindFilter(e,t){return void 0!==this.m_dataFilter&&this.m_dataFilter.hasKindFilter&&(e=e.filter(e=>{const i=void 0===e.kind?t:e.kind;return this.m_dataFilter.wantsKind(i)})),e}}t.VectorTileDataProcessor=p;class f extends s.ThemedTileDecoder{constructor(){super(),this.m_roundUpCoordinatesIfNeeded=!1,this.m_options={map:{},changed:!1},this.m_defaultDataAdapters=[],this.m_defaultDataAdapters.push(new c.OmvDataAdapter,new l.GeoJsonVtDataAdapter,new a.GeoJsonDataAdapter)}connect(){return Promise.resolve()}decodeThemedTile(e,t,i,n){const r=o.PerformanceTimer.now();if(!this.m_dataAdapter&&(this.m_dataAdapter=this.getDataAdapter(e),!this.m_dataAdapter))return Promise.reject(new Error("Unsupported data format."));const s=this.m_dataAdapter;if(o.assert(s.canProcess(e)),this.m_options.changed){if(s instanceof c.OmvDataAdapter){const e=this.m_options.map;s.configure(e,i),this.m_featureFilter=s.dataFilter}this.m_options.changed=!1}const a=new p(t,n,i,s,this.m_options.map,this.m_featureFilter).getDecodedTile(e);return a.decodeTime=o.PerformanceTimer.now()-r,Promise.resolve(a)}configure(e,t){super.configure(e,t),this.m_options.map=Object.assign(Object.assign(Object.assign({},this.m_options.map),e),t),this.m_options.changed=!0}getDataAdapter(e){for(const t of this.m_defaultDataAdapters)if(t.canProcess(e))return t}}t.VectorTileDecoder=f;t.VectorTileDecoderService=class{static start(){s.WorkerServiceManager.getInstance().register({serviceType:u.VECTOR_TILE_DECODER_SERVICE_TYPE,factory:e=>s.TileDecoderService.start(e,new f)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerService=void 0;const n=i(3),r=i(1).LoggerManager.instance.create("WorkerService",{enabled:!0});t.WorkerService=class{constructor(e){this.serviceId=e,this.m_pendingRequests=new Map,this.onMessage=e=>{if("string"==typeof e.data.service&&e.data.service===this.serviceId)try{if(n.WorkerServiceProtocol.isRequestMessage(e.data)){const t=e.data,i={service:t.service,messageId:t.messageId,responseSent:!1};this.m_pendingRequests.set(t.messageId,i),this.tryHandleRequest(t.request).then(e=>{this.doSendResponse(i,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,response:e.response},e.transferList)}).catch(e=>{this.doSendResponse(i,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,errorMessage:e.toString(),errorStack:e.stack})})}else this.tryHandleMessage(e.data)}catch(t){r.error(`[${this.serviceId}]: Unhandled exception when handling ${e.type}`)}},self.addEventListener("message",this.onMessage);const t={service:e,type:n.WorkerServiceProtocol.ServiceMessageName.Initialized};self.postMessage(t)}destroy(){this.cancelAllPendingRequests(),self.removeEventListener("message",this.onMessage)}handleMessage(e){r.error(`[${this.serviceId}]: Invalid message ${e.type}`)}handleRequest(e){throw new Error(`ServiceAdapter[${this.serviceId}]: Invalid request '${e.type}'`)}tryHandleMessage(e){try{this.handleMessage(e)}catch(t){r.error(`[${this.serviceId}]: Failed, handling message ${e.type}`)}}tryHandleRequest(e){try{return this.handleRequest(e)}catch(e){return r.error(`[${this.serviceId}]: Failure`,e),Promise.reject(e)}}doSendResponse(e,t,i){e.responseSent||(void 0!==i?self.postMessage(t,i):self.postMessage(t),e.responseSent=!0,this.m_pendingRequests.delete(e.messageId))}cancelAllPendingRequests(){this.m_pendingRequests.forEach(e=>{this.doSendResponse(e,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:e.messageId,errorMessage:"cancelled"})})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorTile2TargetTile=t.webMercatorTile2TargetWorld=t.world2tile=t.tile2world=t.createWorldTileTransformationCookie=t.tile2lat=t.lat2tile=t.isArrayBufferLike=void 0;const n=i(2),r=i(0);function s(e,t){return Math.round((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}function o(e,t){const{north:i,west:n}=t.geoBox,r=Math.log2(e),o=Math.pow(2,t.tileKey.level+r);return{extents:e,scale:o,top:s(i,t.tileKey.level+r),left:Math.round((n+180)/360*o)}}function a(e,t,i,r=!1,s){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=o(e,t));const{top:a,left:l,scale:c}=t.worldTileProjectionCookie,h=n.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return s.x=(l+i.x)/c*h,s.y=(a+(r?-i.y:i.y))/c*h,s.z=n.isVector3Like(i)?i.z:0,s}function l(e,t,i,s,o,l=!1){a(e,t,i,l,s),t.targetProjection.reprojectPoint(n.webMercatorProjection,s,s),i instanceof r.Vector3&&o&&(s.z*=t.targetProjection.getScaleFactor(s))}t.isArrayBufferLike=function(e){return"undefined"!=typeof SharedArrayBuffer?e instanceof ArrayBuffer||e instanceof SharedArrayBuffer:e instanceof ArrayBuffer},t.lat2tile=s,t.tile2lat=function(e,t){const i=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))},t.createWorldTileTransformationCookie=o,t.tile2world=a,t.world2tile=function(e,t,i,r=!1,s){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=o(e,t));const{top:a,left:l,scale:c}=t.worldTileProjectionCookie,h=n.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return s.x=Math.round(i.x/h*c-l),s.y=Math.round((r?-1:1)*(i.y/h*c-a)),n.isVector3Like(s)&&(s.z=i.z),s},t.webMercatorTile2TargetWorld=l,t.webMercatorTile2TargetTile=function(e,t,i,n,r,s=!1){l(e,t,i,n,r,s),n.sub(t.center)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraKeyTrackAnimation=t.ControlPoint=void 0;const n=i(2),r=i(5),s=i(1),o=i(0),a=s.LoggerManager.instance.create("CameraKeyTrackAnimation");t.ControlPoint=class{constructor(e){var t,i,r,s;this.timestamp=0,this.timestamp=e.timestamp,this.target=e.target?n.GeoCoordinates.fromObject(e.target):new n.GeoCoordinates(0,0),this.tilt=null!==(t=e.tilt)&&void 0!==t?t:0,this.heading=null!==(i=e.heading)&&void 0!==i?i:0,this.distance=null!==(r=e.distance)&&void 0!==r?r:0,this.name=null!==(s=e.name)&&void 0!==s?s:Date.now().toString()}};class l extends o.Object3D{constructor(e){super(),this.distance=0,this.name=e}}t.CameraKeyTrackAnimation=class{constructor(e,t){var i,n,r,s;this.m_mapView=e,this.m_options=t,this.m_dummy=new l("dummy"),this.m_azimuthAxis=new o.Vector3(0,0,1),this.m_altitudeAxis=new o.Vector3(1,0,0),this.m_running=!1,this.m_lastFrameTime=0;const c=void 0!==this.m_options.interpolation?this.m_options.interpolation:o.InterpolateSmooth;this.m_options.loop=null!==(i=this.m_options.loop)&&void 0!==i?i:o.LoopOnce,this.m_options.repetitions=null!==(n=this.m_options.repetitions)&&void 0!==n?n:1,this.m_options.rotateOnlyClockwise=null===(r=this.m_options.rotateOnlyClockwise)||void 0===r||r,this.m_name=(null!==(s=this.m_options.name)&&void 0!==s?s:"CameraKeyTrackAnimation")+Date.now();const h=this.m_options.controlPoints.map(e=>e.timestamp),u=[],d=[];this.m_options.controlPoints.map(e=>{const t=this.m_mapView.projection.projectPoint(e.target);u.push(t.x),u.push(t.y),u.push(t.z);const i=new o.Quaternion;i.setFromAxisAngle(this.m_azimuthAxis,o.MathUtils.degToRad(e.heading)),i.multiply((new o.Quaternion).setFromAxisAngle(this.m_altitudeAxis,o.MathUtils.degToRad(e.tilt))),d.push(i.x),d.push(i.y),d.push(i.z),d.push(i.w)});const m=new o.VectorKeyframeTrack(".position",h,u,c),p=new o.QuaternionKeyframeTrack(".quaternion",h,d,c),f=new o.NumberKeyframeTrack(".distance",h,this.m_options.controlPoints.map(e=>e.distance),c);this.m_animationClip=new o.AnimationClip("cameraflyoveranimation",-1,[m,p,f]),this.m_animationClip.validate()||a.error("Review the entered controlpoints for: ",this.m_name,", The Animation was provided with invalid track data"),this.m_animationClip.resetDuration(),this.m_animationClip.trim(),this.m_animationMixer=new o.AnimationMixer(this.m_dummy),this.m_animationAction=this.m_animationMixer.clipAction(this.m_animationClip),this.m_animationAction.setLoop(this.m_options.loop,this.m_options.repetitions),this.m_animationAction.clampWhenFinished=!0,this.m_animateCb=this.animate.bind(this),this.m_animationMixer.addEventListener("finished",this.stop.bind(this))}set loop(e){this.m_options.loop=e,this.m_animationAction.setLoop(this.m_options.loop,this.m_options.repetitions)}set repetitions(e){this.m_options.repetitions=e,this.m_animationAction.setLoop(this.m_options.loop,this.m_options.repetitions)}set rotateOnlyClockwise(e){this.m_options.rotateOnlyClockwise=e}start(e,t){this.m_running&&this.stop(),this.m_onFinished=t,this.m_animationAction.reset().play(),this.m_lastFrameTime=Date.now(),this.m_mapView.addEventListener(r.MapViewEventNames.Render,this.m_animateCb),this.m_mapView.beginAnimation(),this.m_running=!0}stop(){this.m_mapView.removeEventListener(r.MapViewEventNames.Render,this.m_animateCb),this.m_mapView.endAnimation(),void 0!==this.m_onFinished&&window.setTimeout(this.m_onFinished,0),this.m_running=!1}isRunning(){return this.m_running}updateCameraFromDummy(){let e=o.MathUtils.radToDeg(this.m_azimuthAxis.clone().applyQuaternion(this.m_dummy.quaternion).angleTo(this.m_azimuthAxis));e=o.MathUtils.clamp(e,0,r.MapViewUtils.MAX_TILT_DEG);const t=this.m_altitudeAxis.clone().applyQuaternion(this.m_dummy.quaternion);let i=t.angleTo(this.m_altitudeAxis);if(this.m_options.rotateOnlyClockwise){this.m_azimuthAxis.dot(t.normalize().cross(this.m_altitudeAxis))>=0&&(i=2*Math.PI-i)}const n=o.MathUtils.radToDeg(i),s=this.m_mapView.projection.unprojectPoint(this.m_dummy.position),l=Math.max(0,this.m_dummy.distance);(isNaN(e)||isNaN(n)||isNaN(l)||!s.isValid())&&a.error("Cannot update due to invalid data",e,n,l,s),this.m_mapView.lookAt({target:s,distance:l,tilt:e,heading:n})}animate(e){const t=(Date.now()-this.m_lastFrameTime)/1e3;this.m_animationMixer.update(t),this.m_lastFrameTime=Date.now(),this.updateCameraFromDummy()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPointLike=void 0,t.isGeoPointLike=function(e){if(Array.isArray(e)){const[t,i,n]=e;return"number"==typeof t&&"number"==typeof i&&(void 0===n||"number"==typeof n)}return!1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLatLngLike=void 0,t.isLatLngLike=function(e){return e&&"number"==typeof e.lat&&"number"==typeof e.lng}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerOptions=t.LogLevel=void 0,function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Log=2]="Log",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error",e[e.None=6]="None"}(t.LogLevel||(t.LogLevel={}));t.LoggerOptions=class{}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManager=void 0;const n=i(206);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new n.LoggerManagerImpl)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceTimer=void 0;class n{static now(){return n.nowFunc()}static getNowFunc(){return"undefined"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}t.PerformanceTimer=n,n.instance=new n,n.nowFunc=n.getNowFunc()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUrlHostAndProtocol=t.getUrlOrigin=t.baseUrl=t.resolveReferenceUri=void 0,t.resolveReferenceUri=function(e,t){if(n.test(t))return t;if(t.startsWith("/")){return s(e)+t}return t.startsWith("./")&&(t=t.substr(2)),r(e)+t};const n=new RegExp("^(((?:[a-z]+:)?//)|(file:/)|(data:))","i");function r(e){if(void 0===e)return"./";let t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),t=e.indexOf("?"),-1!==t&&(e=e.slice(0,t)),t=e.lastIndexOf("/"),-1===t?"./":e.substring(0,t+1)}function s(e){if(void 0===e)return"";const t=o(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function o(e){const t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),i=e.match(t);if(!i)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:i[1],host:i[2]}}t.baseUrl=r,t.getUrlOrigin=s,t.getUrlHostAndProtocol=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pixels=void 0;const n=/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/;class r{constructor(e){this.value=e}static parse(e){const t=n.exec(e);if(null!==t)return new r(Number(t[1]))}toJSON(){return this.value+"px"}}t.Pixels=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.interpolatedPropertyDefinitionToJsonExpr=t.isInterpolatedPropertyDefinition=t.InterpolationMode=void 0,function(e){e[e.Discrete=0]="Discrete",e[e.Linear=1]="Linear",e[e.Cubic=2]="Cubic",e[e.Exponential=3]="Exponential"}(t.InterpolationMode||(t.InterpolationMode={})),t.isInterpolatedPropertyDefinition=function(e){return!!(e&&void 0===e.interpolationMode&&Array.isArray(e.values)&&e.values.length>0&&void 0!==e.values[0]&&Array.isArray(e.zoomLevels)&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length)},t.interpolatedPropertyDefinitionToJsonExpr=function(e){if(void 0===e.interpolation||"Discrete"===e.interpolation){const t=["step",["zoom"],e.values[0]];for(let i=1;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}const t=["interpolate"];switch(e.interpolation){case"Linear":t.push(["linear"]);break;case"Cubic":t.push(["cubic"]);break;case"Exponential":t.push(["exponential",void 0!==e.exponent?e.exponent:2]);break;default:throw new Error(`interpolation mode '${e.interpolation}' is not supported`)}t.push(["zoom"]);for(let i=0;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setTechniqueRenderOrderOrPriority=t.composeTechniqueTextureName=t.addBuffersToTransferList=t.textureCoordinateType=t.supportsTextures=t.needsVertexNormals=t.isLabelRejectionLineTechnique=t.isShaderTechnique=t.isTextTechnique=t.isTerrainTechnique=t.isStandardTechnique=t.isExtrudedPolygonTechnique=t.isFillTechnique=t.isStandardExtrudedLineTechnique=t.isBasicExtrudedLineTechnique=t.isExtrudedLineTechnique=t.isSegmentsTechnique=t.isSpecialDashesLineTechnique=t.isSolidLineTechnique=t.isLineTechnique=t.isLineMarkerTechnique=t.isPoiTechnique=t.isSquaresTechnique=t.isCirclesTechnique=t.TRANSPARENCY_PROPERTY_KEYS=t.TEXTURE_PROPERTY_KEYS=void 0;const n=i(104);function r(e){return"labeled-icon"===e.name}function s(e){return"line-marker"===e.name}function o(e){return"extruded-line"===e.name}function a(e){return o(e)&&"standard"===e.shading}function l(e){return"fill"===e.name}function c(e){return"extruded-polygon"===e.name}function h(e){return"standard"===e.name}function u(e){return"terrain"===e.name}function d(e){return"text"===e.name}function m(e){return"shader"===e.name}function p(e){return l(e)||h(e)||c(e)||u(e)}t.TEXTURE_PROPERTY_KEYS=["map","normalMap","displacementMap","roughnessMap","emissiveMap","alphaMap","metalnessMap","bumpMap"],t.TRANSPARENCY_PROPERTY_KEYS=["opacity","transparent"],t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isPoiTechnique=r,t.isLineMarkerTechnique=s,t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=function(e){return"solid-line"===e.name||"dashed-line"===e.name},t.isSpecialDashesLineTechnique=function(e){return("solid-line"===e.name||"dashed-line"===e.name)&&void 0!==e.dashes&&"Square"!==e.dashes},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=o,t.isBasicExtrudedLineTechnique=function(e){return o(e)&&"basic"===e.shading},t.isStandardExtrudedLineTechnique=a,t.isFillTechnique=l,t.isExtrudedPolygonTechnique=c,t.isStandardTechnique=h,t.isTerrainTechnique=u,t.isTextTechnique=d,t.isShaderTechnique=m,t.isLabelRejectionLineTechnique=function(e){return"label-rejection-line"===e.name},t.needsVertexNormals=function(e){return c(e)||l(e)||h(e)||u(e)||a(e)},t.supportsTextures=p,t.textureCoordinateType=function(e){return p(e)||m(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,i){if(h(e)||c(e)||u(e))for(const r of t.TEXTURE_PROPERTY_KEYS){const t=e[r];n.isTextureBuffer(t)&&t.buffer instanceof ArrayBuffer&&i.push(t.buffer)}},t.composeTechniqueTextureName=function(e,t){let i=e;return"string"==typeof t.imageTexturePrefix&&(i=t.imageTexturePrefix+i),"string"==typeof t.imageTexturePostfix&&(i+=t.imageTexturePostfix),i},t.setTechniqueRenderOrderOrPriority=function(e,t,i){if(d(e)||r(e)||s(e)){if(i&&"string"==typeof e._category){const t=i.indexOf(e._category);-1!==t&&(e.priority=i.length-t)}}else if(t&&void 0!==e._styleSet){const i=i=>{const n=null==t?void 0:t.findIndex(t=>t.group===e._styleSet&&t.category===i);return void 0!==n&&-1!==n?10*(n+1):void 0};if("string"==typeof e._category){const t=i(e._category);void 0!==t&&(e.renderOrder=t)}if("string"==typeof e._secondaryCategory){const t=i(e._secondaryCategory);void 0!==t&&(e.secondaryRenderOrder=t)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshStandardMaterial=t.MapMeshDepthMaterial=t.MapMeshBasicMaterial=t.ExtrusionFeatureMixin=t.ExtrusionFeature=t.FadingFeatureMixin=t.FadingFeature=t.DisplacementFeatureMixin=t.hasExtrusionFeature=void 0;const n=i(1),r=i(0),s=i(31),o=i(251),a=i(252),l=i(253),c=i(11),h=new r.Texture;function u(e,t){return e*t.maximum}function d(e,t){void 0===t.defines&&(t.defines={}),e.shaderDefines=t.defines,void 0===e.shaderUniforms&&(e.shaderUniforms={})}function m(e,t){Object.assign(t.uniforms,e.shaderUniforms),e.shaderUniforms=t.uniforms}var p,f,g;t.hasExtrusionFeature=function(e){return"extrusionRatio"in e},function(e){function t(e){return null!==e.displacementMap}e.isEnabled=t,e.updateDisplacementFeature=function(e){n.assert(void 0!==e.shaderDefines),n.assert(void 0!==e.shaderUniforms);const i=t(e),r=c.setShaderDefine(e.shaderDefines,"USE_DISPLACEMENTMAP",i);if(e.needsUpdate=r,i){const t=e.displacementMap;t.needsUpdate=!0,e.shaderUniforms.displacementMap.value=t}else r&&(e.shaderUniforms.displacementMap.value=h)},e.onBeforeCompile=function(e,i){t(e)&&(n.assert(void 0!==e.shaderUniforms),m(e,i),i.vertexShader=i.vertexShader.replace("#include <skinbase_vertex>","#include <skinbase_vertex>\n#ifndef USE_ENVMAP\n    vec3 objectNormal = vec3( normal );\n#endif"),i.vertexShader=c.insertShaderInclude(i.vertexShader,"uv2_pars_vertex","displacementmap_pars_vertex"),i.vertexShader=c.insertShaderInclude(i.vertexShader,"skinning_vertex","displacementmap_vertex",!0))}}(p||(p={}));class v{constructor(){this.m_displacementMap=null}get displacementMap(){return this.m_displacementMap}set displacementMap(e){this.setDisplacementMap(e)}getDisplacementMap(){return this.m_displacementMap}setDisplacementMap(e){e!==this.m_displacementMap&&(this.m_displacementMap=e,p.updateDisplacementFeature(this))}addDisplacementProperties(){Object.defineProperty(this,"displacementMap",{get:()=>this.getDisplacementMap(),set:e=>{this.setDisplacementMap(e)}})}applyDisplacementParameters(e){d(this,this),n.assert(void 0!==this.shaderDefines),n.assert(void 0!==this.shaderUniforms);const t=this.shaderUniforms;t.displacementMap=new r.Uniform(h),t.displacementScale=new r.Uniform(1),t.displacementBias=new r.Uniform(0),void 0!==e&&void 0!==e.displacementMap&&this.setDisplacementMap(e.displacementMap),this.onBeforeCompile=n.chainCallbacks(this.onBeforeCompile,e=>{p.onBeforeCompile(this,e)}),this.needsUpdate=p.isEnabled(this)}copyDisplacementParameters(e){return this.setDisplacementMap(e.displacementMap),this}}t.DisplacementFeatureMixin=v,function(e){function t(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar&&e.fadeFar>0}e.DEFAULT_FADE_NEAR=-1,e.DEFAULT_FADE_FAR=-1,e.isEnabled=t,e.isDefined=function(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar},e.patchGlobalShaderChunks=function(){void 0===r.ShaderChunk.fading_pars_vertex&&Object.assign(r.ShaderChunk,a.default)},e.updateFadingFeature=function(i){n.assert(void 0!==i.shaderDefines),n.assert(void 0!==i.shaderUniforms);const r=t(i),s=c.setShaderDefine(i.shaderDefines,"FADING_MATERIAL",r);i.needsUpdate=s,n.assert(void 0!==i.shaderUniforms.fadeNear&&void 0!==i.shaderUniforms.fadeFar),r?(i.shaderUniforms.fadeNear.value=i.fadeNear,i.shaderUniforms.fadeFar.value=i.fadeFar,s&&c.enableBlending(i)):s&&(i.shaderUniforms.fadeNear.value=e.DEFAULT_FADE_NEAR,i.shaderUniforms.fadeFar.value=e.DEFAULT_FADE_FAR,c.disableBlending(i))},e.onBeforeCompile=function(e,i){t(e)&&(n.assert(void 0!==e.shaderUniforms),m(e,i),i.vertexShader=c.insertShaderInclude(i.vertexShader,"fog_pars_vertex","fading_pars_vertex"),i.vertexShader=c.insertShaderInclude(i.vertexShader,"fog_vertex","fading_vertex",!0),i.fragmentShader=c.insertShaderInclude(i.fragmentShader,"fog_pars_fragment","fading_pars_fragment"),i.fragmentShader=c.insertShaderInclude(i.fragmentShader,"fog_fragment","fading_fragment",!0))},e.addRenderHelper=function(t,i,r,s,o,a){t.onBeforeRender=n.chainCallbacks(t.onBeforeRender,(t,n,o,l,c,h)=>{const d=c;d.fadeNear=void 0===r||r===e.DEFAULT_FADE_NEAR?e.DEFAULT_FADE_NEAR:u(r,i),d.fadeFar=void 0===s||s===e.DEFAULT_FADE_FAR?e.DEFAULT_FADE_FAR:u(s,i),void 0!==a&&a(t,c)})}}(f=t.FadingFeature||(t.FadingFeature={}));class y{constructor(){this.m_fadeNear=f.DEFAULT_FADE_NEAR,this.m_fadeFar=f.DEFAULT_FADE_FAR}getFadeNear(){return this.m_fadeNear}setFadeNear(e){e!==this.m_fadeNear&&(this.m_fadeNear=e,f.updateFadingFeature(this))}getFadeFar(){return this.m_fadeFar}setFadeFar(e){e!==this.m_fadeFar&&(this.m_fadeFar=e,f.updateFadingFeature(this))}addFadingProperties(){Object.defineProperty(this,"fadeNear",{get:()=>this.getFadeNear(),set:e=>{this.setFadeNear(e)}}),Object.defineProperty(this,"fadeFar",{get:()=>this.getFadeFar(),set:e=>{this.setFadeFar(e)}})}applyFadingParameters(e){d(this,this),n.assert(void 0!==this.shaderDefines),n.assert(void 0!==this.shaderUniforms),this.shaderUniforms.fadeNear=new r.Uniform(f.DEFAULT_FADE_NEAR),this.shaderUniforms.fadeFar=new r.Uniform(f.DEFAULT_FADE_FAR),void 0!==e&&(void 0!==e.fadeNear&&this.setFadeNear(e.fadeNear),void 0!==e.fadeFar&&this.setFadeFar(e.fadeFar)),this.onBeforeCompile=n.chainCallbacks(this.onBeforeCompile,e=>{f.onBeforeCompile(this,e)}),this.needsUpdate=f.isEnabled(this)}copyFadingParameters(e){return this.setFadeNear(void 0===e.fadeNear?f.DEFAULT_FADE_NEAR:e.fadeNear),this.setFadeFar(void 0===e.fadeFar?f.DEFAULT_FADE_FAR:e.fadeFar),this}}t.FadingFeatureMixin=y,function(e){function t(e){return void 0!==e.extrusionRatio&&e.extrusionRatio>=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}e.isEnabled=t,e.patchGlobalShaderChunks=function(){void 0===r.ShaderChunk.extrusion_pars_vertex&&Object.assign(r.ShaderChunk,o.default)},e.updateExtrusionFeature=function(e){n.assert(void 0!==e.shaderDefines),n.assert(void 0!==e.shaderUniforms);const i=t(e),r=c.setShaderDefine(e.shaderDefines,"EXTRUSION_MATERIAL",i);e.needsUpdate=r,i?e.shaderUniforms.extrusionRatio.value=e.extrusionRatio:r&&(e.shaderUniforms.extrusionRatio.value=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX)},e.onBeforeCompile=function(e,i){t(e)&&(n.assert(void 0!==e.shaderUniforms),m(e,i),i.vertexShader=c.insertShaderInclude(i.vertexShader,"common","extrusion_pars_vertex"),i.vertexShader=c.insertShaderInclude(i.vertexShader,"begin_vertex","extrusion_vertex",!0),i.fragmentShader=c.insertShaderInclude(i.fragmentShader,"fog_pars_fragment","extrusion_pars_fragment"),i.fragmentShader=i.fragmentShader.replace("#include <normal_fragment_begin>","#include <extrusion_normal_fragment_begin>"),i.fragmentShader=c.insertShaderInclude(i.fragmentShader,"fog_fragment","extrusion_fragment",!0))}}(g=t.ExtrusionFeature||(t.ExtrusionFeature={}));class _{constructor(){this.m_extrusion=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}getExtrusionRatio(){return this.m_extrusion}setExtrusionRatio(e){e!==this.m_extrusion&&(this.m_extrusion=e,g.updateExtrusionFeature(this))}addExtrusionProperties(){Object.defineProperty(this,"extrusionRatio",{get:()=>this.getExtrusionRatio(),set:e=>{this.setExtrusionRatio(e)}})}applyExtrusionParameters(e){d(this,this),n.assert(void 0!==this.shaderDefines),n.assert(void 0!==this.shaderUniforms),e&&!0===e.zFightingWorkaround&&(this.shaderDefines.ZFIGHTING_WORKAROUND=""),this.shaderUniforms.extrusionRatio=new r.Uniform(s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),void 0!==e&&void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this.onBeforeCompile=n.chainCallbacks(this.onBeforeCompile,e=>{g.onBeforeCompile(this,e)}),this.needsUpdate=g.isEnabled(this)}copyExtrusionParameters(e){return void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this}}t.ExtrusionFeatureMixin=_;class x extends r.MeshBasicMaterial{constructor(e){super(e),f.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),g.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),this.addDisplacementProperties(),this.applyDisplacementParameters(e)}clone(){return(new x).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this.copyDisplacementParameters(e),this}get fadeNear(){return f.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return f.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get displacementMap(){return null}set displacementMap(e){}setDisplacementMap(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}addDisplacementProperties(){}applyDisplacementParameters(e){}copyDisplacementParameters(e){}}t.MapMeshBasicMaterial=x;class w extends r.MeshDepthMaterial{constructor(e){super(e),g.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!1}))}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshDepthMaterial=w;class b extends r.MeshStandardMaterial{constructor(e){super(e),f.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),g.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),!0===(null==e?void 0:e.removeDiffuseLight)&&(this.onBeforeCompile=n.chainCallbacks(this.onBeforeCompile,e=>{e.fragmentShader=r.ShaderChunk.meshphysical_frag.replace("#include <lights_physical_pars_fragment>",l.simpleLightingShadowChunk)}))}clone(){return(new b).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this}get fadeNear(){return f.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return f.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get removeDiffuseLight(){return!1}set removeDiffuseLight(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshStandardMaterial=b,n.applyMixinsWithoutProperties(x,[y]),n.applyMixinsWithoutProperties(b,[y]),n.applyMixinsWithoutProperties(x,[_]),n.applyMixinsWithoutProperties(b,[_]),n.applyMixinsWithoutProperties(w,[_]),n.applyMixinsWithoutProperties(x,[v])},function(e,t,i){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.LineCapsModes=void 0,function(e){e[e.CAPS_NONE=0]="CAPS_NONE",e[e.CAPS_SQUARE=1]="CAPS_SQUARE",e[e.CAPS_ROUND=2]="CAPS_ROUND",e[e.CAPS_TRIANGLE_IN=3]="CAPS_TRIANGLE_IN",e[e.CAPS_TRIANGLE_OUT=4]="CAPS_TRIANGLE_OUT"}(n=t.LineCapsModes||(t.LineCapsModes={})),t.default={extrude_line_vert_func:"\nvec3 extrudeLine(\n        in vec3 vertexPosition,\n        in float linePosition,\n        in float extrusionWidth,\n        in vec4 bitangent,\n        in vec3 tangent,\n        in float tanHalfAngle,\n        inout vec2 uv\n    ) {\n    vec3 result = vertexPosition;\n    // Retrieve the angle between this segment and the previous one (stored in the bitangent w\n    // component).\n    float angle = bitangent.w;\n    // Extrude according to the angle between segments to properly render narrow joints...\n    if (angle != 0.0) {\n        result += uv.y * extrusionWidth * bitangent.xyz / cos(angle / 2.0);\n        uv.x = linePosition + uv.x * extrusionWidth * uv.y * tanHalfAngle;\n    }\n    // ... or extrude in a simple manner for segments that keep the same direction.\n    else {\n        result += uv.y * extrusionWidth * bitangent.xyz + uv.x * extrusionWidth * tangent;\n        uv.x = linePosition + uv.x * extrusionWidth;\n    }\n    uv.y *= extrusionWidth;\n    return result;\n}\n",round_edges_and_add_caps:`\n#define CAPS_NONE ${n.CAPS_NONE}\n#define CAPS_SQUARE ${n.CAPS_SQUARE}\n#define CAPS_ROUND ${n.CAPS_ROUND}\n#define CAPS_TRIANGLE_IN ${n.CAPS_TRIANGLE_IN}\n#define CAPS_TRIANGLE_OUT ${n.CAPS_TRIANGLE_OUT}\n\nfloat roundEdgesAndAddCaps(in vec4 coords, in vec3 range) {\n    // Compute the line's width to length ratio.\n    float widthRatio = range.y / range.x;\n\n    // Compute the inner segment distance (same for all cap mode).\n    float dist = abs(coords.y);\n    float segmentBeginMask = clamp(ceil(coords.z - coords.x), 0.0, 1.0);\n    float segmentEndMask = clamp(ceil(coords.x - coords.w), 0.0, 1.0);\n    dist = max(dist, segmentBeginMask * length(vec2((coords.x - coords.z) / widthRatio, coords.y)));\n    dist = max(dist, segmentEndMask * length(vec2((coords.x - coords.w) / widthRatio, coords.y)));\n\n    #if CAPS_MODE != CAPS_ROUND\n    // Compute the caps mask.\n    float capRangeMask = clamp(1.0 - ceil(range.z - drawRange.y), 0.0, 1.0);\n    float beginCapMask = clamp(ceil(drawRange.x - coords.x), 0.0, 1.0);\n    float endCapMask = clamp(ceil(coords.x - drawRange.y), 0.0, 1.0);\n    float capMask = capRangeMask * max(beginCapMask, endCapMask);\n\n    // Compute the outer segment distance (specific for each cap mode).\n    float capDist = max(coords.x - drawRange.y, drawRange.x - coords.x) / widthRatio;\n    #if CAPS_MODE == CAPS_NONE\n    dist = mix(dist, max(abs(coords.y), (capDist + 0.1) / 0.1), capMask);\n    #elif CAPS_MODE == CAPS_SQUARE\n    dist = mix(dist, max(abs(coords.y), capDist), capMask);\n    #elif CAPS_MODE == CAPS_TRIANGLE_OUT\n    dist = mix(dist, abs(coords.y) + capDist, capMask);\n    #elif CAPS_MODE == CAPS_TRIANGLE_IN\n    dist = mix(dist, max(abs(coords.y), (capDist - abs(coords.y)) + capDist), capMask);\n    #endif\n    #endif // CAPS_MODE != CAPS_ROUND\n\n    return dist;\n}\n`,tile_clip_func:"\nvoid tileClip(vec2 tilePos, vec2 tileSize) {\n    if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\n        discard;\n    if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\n        discard;\n}\n",high_precision_vert_func:"\nvec3 subtractDblEyePos( const in vec3 pos ) {\n    vec3 t1 = positionLow - u_eyepos_lowpart;\n    vec3 e = t1 - positionLow;\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\n    vec3 high_delta = t1 + t2;\n    vec3 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_FOV_RAD=t.MIN_FOV_RAD=t.MAX_FOV_DEG=t.MIN_FOV_DEG=t.DEFAULT_FOV_CALCULATION=void 0;const n=i(0);t.DEFAULT_FOV_CALCULATION={type:"dynamic",fov:40},t.MIN_FOV_DEG=10,t.MAX_FOV_DEG=140,t.MIN_FOV_RAD=n.MathUtils.degToRad(t.MIN_FOV_DEG),t.MAX_FOV_RAD=n.MathUtils.degToRad(t.MAX_FOV_DEG)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataSource=void 0;const n=i(115),r=i(1),s=i(0),o=r.LoggerManager.instance.create("DataSource");class a extends s.EventDispatcher{constructor(e={}){super(),this.UPDATE_EVENT={type:"update"},this.enabled=!0,this.cacheable=!1,this.useGeometryLoader=!1,this.addGroundPlane=!1,this.minDataLevel=1,this.maxDataLevel=20,this.minDisplayLevel=1,this.maxDisplayLevel=20,this.allowOverlappingTiles=!0,this.enablePicking=!0,this.dataSourceOrder=0,this.exprPool=new n.ExprPool,this.m_maxGeometryHeight=0,this.m_minGeometryHeight=0,this.m_storageLevelOffset=0,this.m_featureStateMap=new Map;let{name:t}=e;const{styleSetName:i,languages:r,minZoomLevel:s,maxZoomLevel:o,minDataLevel:l,maxDataLevel:c,minDisplayLevel:h,maxDisplayLevel:u,storageLevelOffset:d,allowOverlappingTiles:m,enablePicking:p,minGeometryHeight:f,maxGeometryHeight:g,dataSourceOrder:v}=e;void 0!==t&&0!==t.length||(t="anonymous-datasource#"+ ++a.uniqueNameCounter),this.name=t,this.styleSetName=i,void 0!==r&&(this.languages=r),void 0!==l&&(this.minDataLevel=l),void 0!==c&&(this.maxDataLevel=c),void 0!==s&&(this.minZoomLevel=s),void 0!==o&&(this.maxZoomLevel=o),void 0!==h&&(this.minDisplayLevel=h),void 0!==u&&(this.maxDisplayLevel=u),void 0!==d&&(this.m_storageLevelOffset=d),void 0!==m&&(this.allowOverlappingTiles=m),void 0!==p&&(this.enablePicking=p),void 0!==f&&(this.minGeometryHeight=f),void 0!==g&&(this.maxGeometryHeight=g),v&&(this.dataSourceOrder=v)}getFeatureState(e){return this.m_featureStateMap.get(e)}clearFeatureState(){this.m_featureStateMap.clear()}setFeatureState(e,t){this.m_featureStateMap.set(e,t)}removeFeatureState(e){this.m_featureStateMap.delete(e)}get styleSetName(){return this.m_styleSetName}set styleSetName(e){e!==this.m_styleSetName&&(this.m_styleSetName=e,this.clearCache(),this.requestUpdate())}dispose(){}clearCache(){}isFullyCovering(){return this.addGroundPlane}ready(){return!0}get mapView(){if(void 0===this.m_mapView)throw new Error("This DataSource was not added to MapView");return this.m_mapView}get projection(){return this.mapView.projection}async connect(){}attach(e){this.m_mapView=e}detach(e){r.assert(this.m_mapView===e),this.m_mapView=void 0}isDetached(){return void 0===this.m_mapView}async setTheme(e,t){}setLanguages(e){this.languages=e}setPoliticalView(e){}updateTile(e){}shouldPreloadTiles(){return!1}get minZoomLevel(){return o.warn("DataSource.minZoomLevel is deprecated. Use minDataLevel and maxDataLevel instead."),this.minDataLevel}set minZoomLevel(e){o.warn("DataSource.minZoomLevel is deprecated. Use minDataLevel and minDisplayLevel instead."),this.minDataLevel=e}get maxZoomLevel(){return o.warn("DataSource.maxZoomLevel is deprecated. Use maxDataLevel and maxDisplayLevel instead."),this.maxDataLevel}set maxZoomLevel(e){o.warn("DataSource.maxZoomLevel is deprecated. Use maxDataLevel and maxDisplayLevel instead."),this.maxDataLevel=e}get maxGeometryHeight(){return this.m_maxGeometryHeight}set maxGeometryHeight(e){this.m_maxGeometryHeight=e}get minGeometryHeight(){return this.m_minGeometryHeight}set minGeometryHeight(e){this.m_minGeometryHeight=e}get storageLevelOffset(){return this.m_storageLevelOffset}set storageLevelOffset(e){this.m_storageLevelOffset=e}setEnableElevationOverlay(e){}getDataZoomLevel(e){return s.MathUtils.clamp(e+this.m_storageLevelOffset,this.minDataLevel,this.maxDataLevel)}isVisible(e){return e>=this.minDisplayLevel&&e<=this.maxDisplayLevel}canGetTile(e,t){return t.level<=e}shouldSubdivide(e,t){return t.level<=e}shouldRenderText(e,t){return!0}requestUpdate(){this.dispatchEvent(this.UPDATE_EVENT)}}t.DataSource=a,a.uniqueNameCounter=0},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addGroundPlane=void 0;const n=i(3),r=i(116),s=i(118),o=i(2),a=i(4),l=i(0),c=i(114),h=i(267),u=i(119),d=new l.Vector3;function m(e,t,i){const n=e.getAttribute("position"),r=n.array,s=new Float32Array(r.length);for(let e=0;e<n.array.length;e+=1)d.fromBufferAttribute(n,e),i.projection.reprojectPoint(t,d,d).sub(i.center),d.toArray(s,3*e);n.array=s,n.needsUpdate=!0}t.addGroundPlane=function(e,t,i=e.mapView.clearColor,d=1,p=!1,f=e.mapView.shadowsEnabled,g=!1!==e.mapView.enableMixedLod){const v=function(e,t,i,n,u,d){const{dataSource:p,projection:f}=e,g=p.getTilingScheme().projection,v=f.type===o.ProjectionType.Spherical,y=!v,_="number"==typeof n?function(e,t,i,n){return t?new a.MapMeshStandardMaterial({color:e,visible:!0,depthWrite:i,removeDiffuseLight:!0,opacity:n}):new a.MapMeshBasicMaterial({color:e,visible:!0,depthWrite:i,opacity:n})}(new l.Color(n),i,f.type===o.ProjectionType.Spherical,d):n,x=function(e,t,i,n){const{dataSource:r,projection:s}=e,o=r.getTilingScheme().projection,a=new l.Vector3,c=new l.BufferGeometry,u=h.projectTilePlaneCorners(e,o),d=[u.sw,u.se,u.nw,u.ne];if(t)for(const t of d)s.reprojectPoint(o,t,t).sub(e.center);const m=t?new Float32Array(12):new Float64Array(12),p=new l.BufferAttribute(m,3).copyVector3sArray(d);if(c.setAttribute("position",p),n){o.surfaceNormal(u.sw,a).negate();const e=new l.BufferAttribute(new Float32Array(12),3).copyVector3sArray(Array(4).fill(a));c.setAttribute("normal",e)}if(c.setIndex(new l.BufferAttribute(new Uint16Array([0,1,2,2,1,3]),1)),i){const e=new l.BufferAttribute(new Float32Array([0,0,1,0,0,1,1,1]),2);c.setAttribute("uv",e)}return c}(e,y,t,i);if(!v)return new l.Mesh(x,_);const w=[],b=new s.SphericalGeometrySubdivisionModifier(l.MathUtils.degToRad(10),g);if(!u)return b.modify(x),m(x,g,e),new l.Mesh(x,_);for(let t=0;t<4;++t){const i=Math.pow(2,t),n=x.clone();if(i>1){new r.EdgeLengthGeometrySubdivisionModifier(i,e.geoBox,r.SubdivisionMode.All,g).modify(n)}b.modify(n),m(n,g,e),w.push(n)}return new c.LodMesh(w,_)}(e,p,f,i,g,d);return v.receiveShadow=f,v.renderOrder=t,u.registerTileObject(e,v,n.GeometryKind.Background,{pickability:n.Pickability.transient}),e.objects.push(v),v}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMaterialAdapter=void 0;const n=i(3),r=i(4),s=i(0),o=i(25);function a(e){return n.TEXTURE_PROPERTY_KEYS.includes(e)}class l{constructor(e,t){this.m_lastUpdateFrameNumber=-1,this.tmpColor=new s.Color,this.material=e,this.styledProperties=t,this.currentStyledProperties={},this.m_dynamicProperties=[];for(const e in t){if(!t.hasOwnProperty(e))continue;const i=t[e];n.Expr.isExpr(i)||"function"==typeof i?this.m_dynamicProperties.push([e,i]):this.currentStyledProperties[e]=i}this.setupStaticProperties()}static get(e){var t;const i=null===(t=e.userData)||void 0===t?void 0:t.mapAdapter;return i instanceof l?i:void 0}static install(e){return e.material.userData||(e.material.userData={}),e.material.userData.mapAdapter=e}static create(e,t){return l.install(new l(e,t))}static ensureUpdated(e,t){var i,n;return null!==(n=null===(i=l.get(e))||void 0===i?void 0:i.ensureUpdated(t))&&void 0!==n&&n}toJSON(){return{styledProperties:this.styledProperties}}ensureUpdated(e){return this.m_lastUpdateFrameNumber!==e.frameNumber&&(this.m_lastUpdateFrameNumber=e.frameNumber,this.updateDynamicProperties(e))}setupStaticProperties(){var e,t;let i=!1;for(const e in this.styledProperties){if(!this.styledProperties.hasOwnProperty(e))continue;const t=this.currentStyledProperties[e];null!=t&&("color"===e||"opacity"===e?i=!0:a(e)||this.applyMaterialGenericProp(e,t))}if(i){const i=null!==(e=this.currentStyledProperties.color)&&void 0!==e?e:16711680,n=null!==(t=this.currentStyledProperties.opacity)&&void 0!==t?t:1;this.applyMaterialBaseColor(i,n)}}updateDynamicProperties(e){var t,i;let r=!1;if(this.m_dynamicProperties.length>0){let s=!1;for(const[t,i]of this.m_dynamicProperties){const o=n.Expr.isExpr(i)?n.getPropertyValue(i,e.env):i(e);o!==this.currentStyledProperties[t]&&(this.currentStyledProperties[t]=o,"color"===t||"opacity"===t?s=!0:a(t)?(this.applyMaterialTextureProp(t,o),r=!0):(this.applyMaterialGenericProp(t,o),r=!0))}if(s){const e=null!==(t=this.currentStyledProperties.color)&&void 0!==t?t:16711680,n=null!==(i=this.currentStyledProperties.opacity)&&void 0!==i?i:1;this.applyMaterialBaseColor(e,n),r=!0}}return r}applyMaterialTextureProp(e,t){const i=this.material;if(!i[e]||null===t)return;const n=i[e];let r;if("string"==typeof t)r=(new s.TextureLoader).load(t,t=>{i[e]=t});else if("object"==typeof t){const n=t,o="IMG"===n.nodeName,a="CANVAS"===n.nodeName;if(o||a)if(r=new s.CanvasTexture(n),o&&!n.complete){const t=()=>{i[e]=r,n.removeEventListener("load",t)};n.addEventListener("load",t)}else i[e]=r}r&&(r.wrapS=n.wrapS,r.wrapT=n.wrapT,r.magFilter=n.magFilter,r.minFilter=n.minFilter,r.flipY=n.flipY,r.repeat=n.repeat)}applyMaterialGenericProp(e,t){const i=this.material;if(i[e]instanceof s.Color){let e=t;if("number"!=typeof e){const t=o.evaluateColorProperty(e);if(void 0===t)return;e=t}const i=n.ColorUtils.removeAlphaFromHex(e);this.tmpColor.set(i),t=this.tmpColor}i[e]=t}applyMaterialBaseColor(e,t){if("number"!=typeof e){const t=o.evaluateColorProperty(e);if(void 0===t)return;e=t}const{r:i,g:a,b:l,a:c}=n.ColorUtils.getRgbaFromHex(null!=e?e:16711680),h=c*s.MathUtils.clamp(null!=t?t:1,0,1);this.material instanceof r.RawShaderMaterial?this.material.setOpacity(h):this.material.opacity=h,this.material.color.setRGB(i,a,l);h>=1?r.disableBlending(this.material):r.enableBlending(this.material)}}t.MapMaterialAdapter=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Squares=t.Circles=t.MapViewPoints=void 0;const n=i(0);class r extends n.Points{constructor(){super(...arguments),this.enableRayTesting=!0}raycast(e,t){if(!this.enableRayTesting)return;const i=this.geometry,r=this.matrixWorld,o=s(e.ray.origin.clone().add(e.ray.direction).project(e.camera),e),a=(i,n)=>{const a=function(e,t,i){const n=e.clone().applyMatrix4(t),r=n.distanceTo(i.ray.origin),o=n.project(i.camera),a=o.x<1&&o.x>-1&&o.y<1&&o.y>-1;if(a){return{absoluteScreenPosition:s(o,i),pointIsOnScreen:a,distance:r}}return{pointIsOnScreen:a}}(i,r,e);a.pointIsOnScreen&&this.testPoint(i,a.absoluteScreenPosition,o,n,a.distance,t)},l=new n.Vector3,c=i.index,h=i.attributes.position.array;if(null!==c){const e=c.array;for(let t=0,i=e.length;t<i;t++)a(l.fromArray(h,3*e[t]),t)}else for(let e=0,t=h.length/3;e<t;e++)a(l.fromArray(h,3*e),e)}}function s(e,t){return new n.Vector2(e.x+1,1-e.y).divideScalar(2).multiply(t.canvasSize).ceil()}t.MapViewPoints=r;t.Circles=class extends r{testPoint(e,t,i,n,r,s){const o=t.x-i.x,a=t.y-i.y;Math.sqrt(o*o+a*a)<=this.material.size/2&&s.push({point:e,distance:r,index:n,object:this})}};t.Squares=class extends r{testPoint(e,t,i,n,r,s){const o=t.x-i.x,a=t.y-i.y,l=this.material.size/2;Math.abs(o)<=l&&Math.abs(a)<=l&&s.push({point:e,distance:r,index:n,object:this})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDefaultClipPlanesEvaluator=t.TiltViewClipPlanesEvaluator=t.TopViewClipPlanesEvaluator=t.ElevationBasedClipPlanesEvaluator=void 0;const n=i(2),r=i(1),s=i(0),o=i(32),a=i(9);var l;!function(e){const t=[new s.Vector3,new s.Vector3],i=new s.Raycaster,r=new s.Sphere(new s.Vector3,n.EarthConstants.EQUATORIAL_RADIUS);function o(e,t){return e-t<1e-6?0:Math.sqrt(e*e-t*t)}e.getFarDistanceFromElevatedHorizon=function(t,i,n,r){const s=o(i,n),a=o(r,n),l=Math.asin(n/i),c=Math.abs(l-e.getNormalToFwdAngle(t));return Math.cos(c)*(s+a)},e.getProjNearPlaneTanDistance=function(e,i,n){const r=e.getWorldDirection(t[0]),s=t[1].copy(r).multiplyScalar(-n).sub(e.position),o=s.dot(r);return o/s.length()>Math.cos(i)?o:void 0},e.getProjSphereIntersectionDistance=function(e,n,s){i.setFromCamera(n,e),r.radius=s;const o=i.ray.intersectSphere(r,t[0]);return null!==o?o.sub(e.position).dot(e.getWorldDirection(t[1])):void 0},e.getNormalToFwdAngle=function(e){const i=t[0].copy(e.position).negate().normalize().dot(e.getWorldDirection(t[1]));return Math.acos(s.MathUtils.clamp(i,-1,1))}}(l||(l={}));class c{constructor(e,t){r.assert(e>=t),this.m_minElevation=t,this.m_maxElevation=e}set maxElevation(e){this.m_maxElevation=e,this.m_minElevation=Math.min(e,this.m_minElevation)}get maxElevation(){return this.m_maxElevation}set minElevation(e){this.m_minElevation=e,this.m_maxElevation=Math.max(e,this.m_maxElevation)}get minElevation(){return this.m_minElevation}}t.ElevationBasedClipPlanesEvaluator=c;class h extends c{constructor(e=n.EarthConstants.MAX_BUILDING_HEIGHT,t=0,i=1,o=.05,a=6){super(e,t),this.nearMin=i,this.nearFarMarginRatio=o,this.farMaxRatio=a,this.m_tmpVectors=[new s.Vector3,new s.Vector3,new s.Vector3],this.m_tmpQuaternion=new s.Quaternion,r.assert(i>0),r.assert(o>=0),r.assert(a>1);const l=o*i;this.m_minimumViewRange={near:i,far:i+l,minimum:this.nearMin,maximum:Math.max(i*a,i+l)}}evaluateClipPlanes(e,t,i){r.assert(e instanceof s.PerspectiveCamera,"Unsupported camera type.");const o=e;return t.type===n.ProjectionType.Spherical?this.evaluateDistanceSphericalProj(o,t,i):t.type===n.ProjectionType.Planar?this.evaluateDistancePlanarProj(o,t,i):(r.assert(!1,"Unsupported projection type"),Object.assign({},this.minimumViewRange))}get minimumViewRange(){return this.m_minimumViewRange}evaluateDistancePlanarProj(e,t,i){r.assert(t.type!==n.ProjectionType.Spherical);let s=this.nearMin,o=this.nearMin*this.farMaxRatio;const a=t.groundDistance(e.position),l=a*this.farMaxRatio;s=a-this.maxElevation,o=a-this.minElevation,s=Math.max(s,this.nearMin),o=Math.min(o,l);const c=this.nearFarMarginRatio*(s+o)/2;s=Math.max(s-c/2,this.nearMin),o=Math.max(o+c/2,s+c);return{near:s,far:o,minimum:this.nearMin,maximum:Math.max(l,o)}}evaluateDistanceSphericalProj(e,t,i){r.assert(t.type===n.ProjectionType.Spherical);const o=t.groundDistance(e.position);let c=o-this.maxElevation;const h=n.EarthConstants.EQUATORIAL_RADIUS,u=Math.max(1e-6,e.position.length()),d=Math.asin(h/u);let m=s.MathUtils.degToRad(e.fov/2);e.aspect>1&&(m=a.MapViewUtils.calculateHorizontalFovByVerticalFov(2*m,e.aspect));const p=h+this.maxElevation,f=l.getFarDistanceFromElevatedHorizon(e,u,h,p);let g=m>d?f:this.getFovBasedFarPlane(e,u,h,2*m,t);const v=o-this.minElevation,y=o*this.farMaxRatio;c=Math.max(c,this.nearMin),g=Math.max(g,v);const _=this.nearFarMarginRatio*(c+g)/2;c=Math.max(c-_/2,this.nearMin),g=Math.max(g+_/2,c+_);return{near:c,far:g,minimum:this.nearMin,maximum:y}}getFovBasedFarPlane(e,t,i,n,s){const o=e.position;e.matrixWorld.extractBasis(this.m_tmpVectors[0],this.m_tmpVectors[1],this.m_tmpVectors[2]),this.m_tmpQuaternion.setFromAxisAngle(this.m_tmpVectors[0],n/2);const a=this.m_tmpVectors[2],l=this.m_tmpVectors[1].copy(a).applyQuaternion(this.m_tmpQuaternion),c=o.dot(l);if(c<0){return s.groundDistance(e.position)*this.farMaxRatio}const h=o.dot(o)-c*c,u=i*i;r.assert(h<=u,"Please use this evaluator only for top view camera poses.");return c-Math.sqrt(u-h)}}t.TopViewClipPlanesEvaluator=h;class u extends h{constructor(){super(...arguments),this.m_tmpV2=new s.Vector2}evaluateDistancePlanarProj(e,t,i){r.assert(t.type!==n.ProjectionType.Spherical);const l=Object.assign({},this.minimumViewRange),c=Math.PI/2-1e-6,h=t.groundDistance(e.position),u=a.MapViewUtils.extractCameraTilt(e,t),d=o.CameraUtils.getTopFov(e),m=o.CameraUtils.getBottomFov(e),p=s.MathUtils.clamp(u+d,-c,c),f=s.MathUtils.clamp(u-m,-c,c),g=Math.max(0,(h-this.minElevation)/Math.cos(p)),v=Math.max(0,(h-this.maxElevation)/Math.cos(f));return l.near=v*Math.cos(m),l.far=g*Math.cos(d),this.applyViewRangeConstraints(l,e,t,i)}evaluateDistanceSphericalProj(e,t,i){r.assert(t.type===n.ProjectionType.Spherical);const s=Object.assign({},this.minimumViewRange);return s.near=this.computeNearDistSphericalProj(e,t),s.far=this.computeFarDistSphericalProj(e,t),this.applyViewRangeConstraints(s,e,t,i)}computeNearDistSphericalProj(e,t){r.assert(t.type===n.ProjectionType.Spherical);const i=t.groundDistance(e.position)-this.maxElevation;if(i<=0)return 0;const s=n.EarthConstants.EQUATORIAL_RADIUS+this.maxElevation,a=o.CameraUtils.getBottomFov(e),c=l.getProjNearPlaneTanDistance(e,a,s);if(void 0!==c)return c;o.CameraUtils.getPrincipalPoint(e,this.m_tmpV2);const h=this.m_tmpV2.y>0,u=l.getProjSphereIntersectionDistance(e,this.m_tmpV2.setComponent(1,-1),s),d=h?l.getProjSphereIntersectionDistance(e,this.m_tmpV2.setComponent(1,1),s):1/0,m=Math.min(null!=u?u:1/0,null!=d?d:1/0);return r.assert(m!==1/0,"No reference point for near distance found"),null!=m?m:i}computeFarDistSphericalProj(e,t){r.assert(t.type===n.ProjectionType.Spherical);const i=n.EarthConstants.EQUATORIAL_RADIUS,s=i+this.minElevation,a=i+this.maxElevation,c=e.position.length();o.CameraUtils.getPrincipalPoint(e,this.m_tmpV2);const h=this.m_tmpV2.x<=0?1:-1,u=this.m_tmpV2.y>0,d=l.getProjSphereIntersectionDistance(e,this.m_tmpV2.set(h,1),s),m=u?l.getProjSphereIntersectionDistance(e,this.m_tmpV2.set(h,-1),s):0,p=Math.max(null!=d?d:1/0,null!=m?m:1/0);return p!==1/0?p:l.getFarDistanceFromElevatedHorizon(e,c,i,a)}applyViewRangeConstraints(e,t,i,n){const{distance:r}=a.MapViewUtils.getTargetAndDistance(i,t,n),o=i.groundDistance(t.position)-this.minElevation,l=r*this.farMaxRatio;e.near=Math.max(e.near,this.nearMin),e.far=s.MathUtils.clamp(e.far,o,l);const c=this.nearFarMarginRatio*(e.near+e.far)/2;return e.near=Math.max(e.near-c/2,this.nearMin),e.far=Math.max(e.far+c/2,e.near+c),e.minimum=this.nearMin,e.maximum=l,e}}t.TiltViewClipPlanesEvaluator=u,t.createDefaultClipPlanesEvaluator=()=>new u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerLoader=void 0,i(16);const n=i(1),r=i(274),s=n.LoggerManager.instance.create("WorkerLoader");class o{static startWorker(e,t=1e4){return e.startsWith("blob:")?this.startWorkerImmediately(e,t):this.directlyFallbackToBlobBasedLoading?this.startWorkerBlob(e,t):this.startWorkerImmediately(e,t).catch(i=>{if("undefined"!=typeof window){const r=window.location.href,a=new URL(e,r).href;if(n.getUrlOrigin(a)===n.getUrlOrigin(r))throw i;return s.log("#startWorker: cross-origin worker construction failed, trying load with blob"),this.directlyFallbackToBlobBasedLoading=!0,o.startWorkerBlob(e,t)}throw i})}static startWorkerImmediately(e,t){try{const i=new Worker(e);return this.waitWorkerInitialized(i,t)}catch(e){return Promise.reject(e)}}static startWorkerBlob(e,t){return this.fetchScriptSourceToBlobUrl(e).then(e=>this.startWorkerImmediately(e,t))}static fetchScriptSourceToBlobUrl(e){let t=this.sourceLoaderCache.get(e);return void 0!==t||(t=fetch(e).then(e=>e.text()).catch(e=>{throw new Error("WorkerLoader#fetchScriptSourceToBlob: failed to load worker script: "+e)}).then(t=>{this.sourceLoaderCache.delete(e);const i=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(i)}),this.sourceLoaderCache.set(e,t)),t}static waitWorkerInitialized(e,t){return new Promise((i,n)=>{const s=t=>{const s=t.data;if(r.isWorkerBootstrapRequest(s)){const t=s.dependencies,i=[];for(const e of t){const t=this.dependencyUrlMapping[e];if(!t)return a(),void n(new Error(`#waitWorkerInitialized: Unable to resolve '${e}' as needed by worker script.`));i.push(t)}const r={type:"worker-bootstrap-response",resolvedDependencies:i};e.postMessage(r)}else a(),i(e),setTimeout(()=>{e.dispatchEvent(t)},0)},o=e=>{a();let t="Error during worker initialization";e.message&&(t=t+": "+e.message),"string"==typeof e.filename&&"number"==typeof e.lineno&&(t+=` in ${e.filename}:${e.lineno}`),n(new Error(t))},a=()=>{clearTimeout(l),e.removeEventListener("message",s),e.removeEventListener("error",o)};e.addEventListener("error",o),e.addEventListener("message",s);const l=setTimeout(()=>{a(),n(new Error("Timeout exceeded when waiting for first message from worker."))},t)})}}t.WorkerLoader=o,o.directlyFallbackToBlobBasedLoading=!1,o.sourceLoaderCache=new Map,o.dependencyUrlMapping={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightInfo=void 0;const n=i(1);!function(e){e.mergeArrays=function(e,t){const i=[];for(const r of[e,t])if(void 0!==r)for(const e of r){const t=i.find(t=>t.id===e.id||void 0!==t.label&&t.label===e.label);void 0===t?i.push(Object.assign({},e)):(t.year=n.MathUtils.max2(e.year,t.year),t.label=n.getOptionValue(e.label,t.label),t.link=n.getOptionValue(e.link,t.link))}return i},e.formatAsHtml=function(e){if(0===e.length)return"";const t=e.filter(e=>""!==e.label);return 0===t.length?"":"© "+t.map(e=>{var t;const i=null!==(t=e.label)&&void 0!==t?t:e.id,n=void 0!==e.year?`${e.year} ${i}`:i,r=e.link;return r?`<a href="${r}" target="_blank" rel="noreferrer noopener">${n}</a>`:""+n}).join(", ")}}(t.CopyrightInfo||(t.CopyrightInfo={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewImageCache=void 0;const n=i(1),r=i(137);t.MapViewImageCache=class{constructor(){this.m_name2Url=new Map,this.m_urlNameCount=new Map}addImage(e,t,i=!0){if("string"==typeof t){const n=t,r=this.registerImage(e,n);return i?r.loadImage():r}const n=t;return this.registerImage(e,void 0,n)}removeImage(e){const t=this.m_name2Url.get(e);if(void 0!==t){this.m_name2Url.delete(e);let i=1;if(e!==t){const e=this.m_urlNameCount.get(t);n.assert(void 0!==e),i=e,n.assert(i>0)}return i>1?this.m_urlNameCount.set(t,i-1):(this.m_urlNameCount.delete(t),r.ImageCache.instance.removeImage(t,this)),!0}return!1}findImageByName(e){const t=this.m_name2Url.get(e);if(void 0!==t)return r.ImageCache.instance.findImage(t)}clear(){r.ImageCache.instance.clear(this),this.m_name2Url.clear(),this.m_urlNameCount.clear()}registerImage(e,t,i){var s;if(this.hasName(e))throw new Error("duplicate name in cache");if(void 0===t&&(n.assert(void 0!==i),t=e),t!==e){const e=null!==(s=this.m_urlNameCount.get(t))&&void 0!==s?s:0;this.m_urlNameCount.set(t,e+1)}return this.m_name2Url.set(e,t),r.ImageCache.instance.registerImage(this,t,i)}hasName(e){return void 0!==this.m_name2Url.get(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickHandler=t.PickObjectType=void 0;const n=i(3),r=i(2),s=i(0),o=i(70),a=i(282),l=i(283),c=i(9);var h;!function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Area=3]="Area",e[e.Text=4]="Text",e[e.Icon=5]="Icon",e[e.Object3D=6]="Object3D"}(h=t.PickObjectType||(t.PickObjectType={}));const u=new s.Vector3,d=new r.OrientedBox3;function m(e,t,i,n,r){for(const s of e.dependencies){const o=s.mortonCode();if(n.has(o))continue;n.add(o);const a=r.visibleTileSet.getCachedTile(e.dataSource,s,e.offset,r.frameNumber);void 0!==a&&i.intersectObjects(a.objects,!0,t)}}t.PickHandler=class{constructor(e,t,i=!1){this.mapView=e,this.camera=t,this.enablePickTechnique=i,this.m_pickingRaycaster=new a.PickingRaycaster(e.renderer.getSize(new s.Vector2))}intersectMapObjects(e,t,i){const n=this.mapView.getNormalizedScreenCoordinates(e,t),r=this.setupRaycaster(e,t),o=new l.PickListener(i);if(void 0!==this.mapView.textElementsRenderer){const{clientWidth:e,clientHeight:t}=this.mapView.canvas,i=n.x*e*.5,r=n.y*t*.5,a=new s.Vector2(i,r);this.mapView.textElementsRenderer.pickTextElements(a,o)}const a=[],c=this.getIntersectedTiles(r),h=new Set;for(const{tile:e,distance:t}of c){if(o.done&&o.furthestResult.distance<t)break;a.length=0,r.intersectObjects(e.objects,!0,a),m(e,a,r,h,this.mapView);for(const t of a)o.addResult(this.createResult(t,e))}a.length=0;for(const e of this.mapView.mapAnchors.children){r.intersectObject(e,!0,a);for(const e of a)o.addResult(this.createResult(e))}return o.finish(),o.results}raycasterFromScreenPoint(e,t){return this.m_pickingRaycaster.setFromCamera(this.mapView.getNormalizedScreenCoordinates(e,t),this.camera),this.mapView.renderer.getSize(this.m_pickingRaycaster.canvasSize),this.m_pickingRaycaster}createResult(e,t){var i,r,s;const o={type:h.Unspecified,point:e.point,distance:e.distance,dataSourceName:null===(i=e.object.userData)||void 0===i?void 0:i.dataSource,dataSourceOrder:null===(r=null==t?void 0:t.dataSource)||void 0===r?void 0:r.dataSourceOrder,intersection:e,tileKey:null==t?void 0:t.tileKey};if(void 0===e.object.userData||void 0===e.object.userData.feature)return o;this.enablePickTechnique&&(o.technique=e.object.userData.technique),o.renderOrder=null===(s=e.object)||void 0===s?void 0:s.renderOrder;const a=e.object.userData.feature;if(this.addObjInfo(a,e,o),o.userData){const e=n.getFeatureId(o.userData);o.featureId=0===e?void 0:e}let l;switch(a.geometryType){case n.GeometryType.Point:case n.GeometryType.Text:l=h.Point;break;case n.GeometryType.Line:case n.GeometryType.ExtrudedLine:case n.GeometryType.SolidLine:case n.GeometryType.TextPath:l=h.Line;break;case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:l=h.Area;break;case n.GeometryType.Object3D:l=h.Object3D;break;default:l=h.Unspecified}return o.type=l,o}getIntersectedTiles(e){const t=new Array;return this.mapView.visibleTileSet.dataSourceTileList.forEach(i=>{i.dataSource.enablePicking&&i.renderedTiles.forEach(i=>{d.copy(i.boundingBox),d.position.sub(this.mapView.worldCenter);const n=i.computeWorldOffsetX();d.position.x+=n;const r=d.intersectsRay(e.ray);void 0!==r&&t.push({tile:i,distance:r})})}),t.sort((e,t)=>e.distance-t.distance),t}addObjInfo(e,t,i){if(void 0===e.objInfos)return;if(i.intersection.object instanceof o.MapViewPoints)return void(i.userData=e.objInfos[t.index]);if(void 0===e.starts||0===e.starts.length||"number"!=typeof t.faceIndex&&void 0===t.index)return void(1===e.objInfos.length&&(i.userData=e.objInfos[0]));if(1===e.starts.length)return void(i.userData=e.objInfos[0]);const n="number"==typeof t.faceIndex?3*t.faceIndex:t.index;let r=0;for(const t of e.starts){if(t>n)break;r++}i.userData=e.objInfos[r-1]}setupRaycaster(e,t){const i=this.mapView.camera,n=this.raycasterFromScreenPoint(e,t),r=this.mapView.getWorldPositionAt(e,t,!0),s=i.position.distanceTo(r)/this.mapView.camera.getWorldDirection(u).dot(n.ray.direction);return n.params.Line.threshold=c.MapViewUtils.calculateWorldSizeByFocalLength(this.mapView.focalLength,s,1),n}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphData=void 0;const n=i(0),r=i(26);class s{constructor(e,t,i,s,o,a,l,c,h,u,d,m,p,f=!1){this.codePoint=e,this.block=t,this.width=i,this.height=s,this.advanceX=o,this.offsetX=a,this.offsetY=l,this.texture=m,this.font=p,this.isReplacement=f,this.positions=[],this.sourceTextureCoordinates=[],this.dynamicTextureCoordinates=[],this.copyIndex=0,this.isInCache=!1,this.character=String.fromCodePoint(e),this.direction=r.UnicodeUtils.getDirection(e,t);const g=this.offsetX,v=g+this.width,y=p.metrics.lineHeight-this.offsetY,_=y-this.height;this.positions.push(new n.Vector3(g,_,1),new n.Vector3(v,_,1),new n.Vector3(g,y,1),new n.Vector3(v,y,1)),this.sourceTextureCoordinates.push(new n.Vector2(c,h),new n.Vector2(u,h),new n.Vector2(c,d),new n.Vector2(u,d)),this.dynamicTextureCoordinates.push(new n.Vector2(0,0),new n.Vector2(1,0),new n.Vector2(0,1),new n.Vector2(1,1))}clone(){return new s(this.codePoint,this.block,this.width,this.height,this.advanceX,this.offsetX,this.offsetY,this.sourceTextureCoordinates[0].x,this.sourceTextureCoordinates[0].y,this.sourceTextureCoordinates[3].x,this.sourceTextureCoordinates[3].y,this.texture,this.font,this.isReplacement)}}t.GlyphData=s},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(286),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextGeometry=t.QUAD_INDEX_MEMORY_FOOTPRINT=t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD=t.VERTICES_PER_QUAD=t.INDEX_BUFFER_STRIDE=t.VERTEX_BUFFER_STRIDE=t.MAX_CAPACITY=void 0;const n=i(0);t.MAX_CAPACITY=65536,t.VERTEX_BUFFER_STRIDE=16,t.INDEX_BUFFER_STRIDE=1,t.VERTICES_PER_QUAD=4,t.INDICES_PER_QUAD=6,t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.VERTICES_PER_QUAD*t.VERTEX_BUFFER_STRIDE,t.QUAD_INDEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD*t.INDEX_BUFFER_STRIDE;t.TextGeometry=class{constructor(e,i,r,s,o){this.scene=e,this.m_pickingDataArray=[],this.capacity=Math.min(o,t.MAX_CAPACITY),this.m_currentCapacity=Math.min(s,o),this.m_drawCount=0,this.m_updateOffset=0,this.m_vertexBuffer=new n.InterleavedBuffer(new Float32Array(this.m_currentCapacity*t.QUAD_VERTEX_MEMORY_FOOTPRINT),t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(n.DynamicDrawUsage),this.m_positionAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,12),this.m_indexBuffer=new n.BufferAttribute(new Uint32Array(this.m_currentCapacity*t.QUAD_INDEX_MEMORY_FOOTPRINT),t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(n.DynamicDrawUsage),this.m_geometry=new n.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_mesh=new n.Mesh(this.m_geometry,i),this.m_bgMesh=new n.Mesh(this.m_geometry,r),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}get drawCount(){return this.m_drawCount}get mesh(){return this.m_mesh}get backgroundMesh(){return this.m_bgMesh}dispose(){this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_geometry.dispose()}clear(){this.m_drawCount=0,this.m_updateOffset=0,this.m_pickingDataArray.length=0}update(){this.drawCount>this.m_updateOffset&&(this.m_vertexBuffer.needsUpdate=!0,this.m_vertexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_vertexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_indexBuffer.needsUpdate=!0,this.m_indexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_INDEX_MEMORY_FOOTPRINT,this.m_indexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_INDEX_MEMORY_FOOTPRINT),this.m_updateOffset=this.m_drawCount,this.m_geometry.setDrawRange(0,this.m_drawCount*t.INDICES_PER_QUAD)}add(e,i,n,r,s,o){if(this.m_drawCount>=this.capacity)return!1;if(this.m_drawCount>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const a=this.m_drawCount*t.VERTICES_PER_QUAD,l=this.m_drawCount*t.INDICES_PER_QUAD;for(let l=0;l<t.VERTICES_PER_QUAD;++l){this.m_positionAttribute.setXYZW(a+l,i[l].x,i[l].y,i[l].z,(s?-1:1)*o.rotation);const t=s?(l+1)%2+2*Math.floor(l/2):l;this.m_uvAttribute.setXYZW(a+l,e.dynamicTextureCoordinates[t].x,e.dynamicTextureCoordinates[t].y,n,r),this.m_colorAttribute.setXYZW(a+l,o.color.r,o.color.g,o.color.b,o.opacity),this.m_bgColorAttribute.setXYZW(a+l,o.backgroundColor.r,o.backgroundColor.g,o.backgroundColor.b,o.backgroundOpacity)}return this.m_indexBuffer.setX(l,a),this.m_indexBuffer.setX(l+1,a+1),this.m_indexBuffer.setX(l+2,a+2),this.m_indexBuffer.setX(l+3,a+2),this.m_indexBuffer.setX(l+4,a+1),this.m_indexBuffer.setX(l+5,a+3),++this.m_drawCount,!0}addToBuffer(e,i,n,r,s,o,a,l){for(let c=0;c<t.VERTICES_PER_QUAD;++c){const h=i+t.VERTEX_BUFFER_STRIDE*c;e[h]=r[c].x,e[h+1]=r[c].y,e[h+2]=r[c].z,e[h+3]=(a?-1:1)*l.rotation;const u=a?(c+1)%2+2*Math.floor(c/2):c;e[h+4]=n.dynamicTextureCoordinates[u].x,e[h+5]=n.dynamicTextureCoordinates[u].y,e[h+6]=s,e[h+7]=o,e[h+8]=l.color.r,e[h+9]=l.color.g,e[h+10]=l.color.b,e[h+11]=l.opacity,e[h+12]=l.backgroundColor.r,e[h+13]=l.backgroundColor.g,e[h+14]=l.backgroundColor.b,e[h+15]=l.backgroundOpacity}}addTextBufferObject(e,i,n,r,s,o,a,l){if(this.m_drawCount+e.glyphs.length>=this.capacity)return!1;if(this.m_drawCount+e.glyphs.length>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const c=null!=n?n:1,h=null!=r?r:0,u=Math.cos(h),d=Math.sin(h),m=void 0!==i?i.x:0,p=void 0!==i?i.y:0,f=e.buffer,g=f[3]<0?-1:1,v=void 0!==s?s.r:f[8],y=void 0!==s?s.g:f[9],_=void 0!==s?s.b:f[10],x=void 0!==o?o:f[11],w=void 0!==a?a.r:f[12],b=void 0!==a?a.g:f[13],M=void 0!==a?a.b:f[14],T=void 0!==l?l:f[15],S=this.m_drawCount*t.VERTICES_PER_QUAD;for(let i=0;i<e.glyphs.length;++i){const n=i*t.QUAD_VERTEX_MEMORY_FOOTPRINT,r=e.glyphs[i];if(!r.isInCache)return!1;const s=f[n+4]>f[n+t.VERTEX_BUFFER_STRIDE+4],o=f[n+6],a=f[n+7];for(let e=0;e<t.VERTICES_PER_QUAD;++e){const l=f[n+e*t.VERTEX_BUFFER_STRIDE],E=f[n+e*t.VERTEX_BUFFER_STRIDE+1];this.m_positionAttribute.setXYZW(S+i*t.VERTICES_PER_QUAD+e,l*c*u+E*c*-d+m,l*c*d+E*c*u+p,f[n+e*t.VERTEX_BUFFER_STRIDE+2]+0,f[n+e*t.VERTEX_BUFFER_STRIDE+3]+g*h);const P=s?(e+1)%2+2*Math.floor(e/2):e;this.m_uvAttribute.setXYZW(S+i*t.VERTICES_PER_QUAD+e,r.dynamicTextureCoordinates[P].x,r.dynamicTextureCoordinates[P].y,o,(a-o)/c+o),this.m_colorAttribute.setXYZW(S+i*t.VERTICES_PER_QUAD+e,v,y,_,x),this.m_bgColorAttribute.setXYZW(S+i*t.VERTICES_PER_QUAD+e,w,b,M,T)}this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD,(this.m_drawCount+i)*t.VERTICES_PER_QUAD),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+1,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+2,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+3,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+4,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+5,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+3)}return this.m_drawCount+=e.glyphs.length,!0}addPickingData(e,t,i){return!(this.m_pickingDataArray.length>=this.m_currentCapacity)&&(this.m_pickingDataArray.push({start:Math.min(e,this.capacity),end:Math.min(t,this.capacity),data:i}),!0)}pick(e,i){for(const n of this.m_pickingDataArray){if(void 0===n)return;for(let r=n.start;r<n.end;++r){const s=r*t.VERTICES_PER_QUAD,o=Math.min(this.m_positionAttribute.getX(s+2),this.m_positionAttribute.getX(s+1));if(e.x<o)continue;const a=Math.max(this.m_positionAttribute.getX(s+2),this.m_positionAttribute.getX(s+1));if(e.x>a)continue;const l=Math.min(this.m_positionAttribute.getY(s+2),this.m_positionAttribute.getY(s+1));if(e.y<l)continue;const c=Math.max(this.m_positionAttribute.getY(s+2),this.m_positionAttribute.getY(s+1));if(!(e.y>c)){i(n.data);break}}}}updateMemoryUsage(e){const t=4*this.m_vertexBuffer.count+4*this.m_indexBuffer.count;e.heapSize+=t,e.gpuSize+=t}resizeBuffers(e){this.m_currentCapacity=e;const i=new Float32Array(e*t.QUAD_VERTEX_MEMORY_FOOTPRINT);i.set(this.m_vertexBuffer.array),this.m_vertexBuffer=new n.InterleavedBuffer(i,t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(n.DynamicDrawUsage),this.m_positionAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,12);const r=new Uint32Array(e*t.QUAD_INDEX_MEMORY_FOOTPRINT);r.set(this.m_indexBuffer.array),this.m_indexBuffer=new n.BufferAttribute(r,t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(n.DynamicDrawUsage),this.m_geometry.dispose(),this.m_geometry=new n.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_pickingDataArray.length=this.m_currentCapacity,this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_mesh=new n.Mesh(this.m_geometry,this.m_mesh.material),this.m_bgMesh=new n.Mesh(this.m_geometry,this.m_bgMesh.material),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypesettingUtils=void 0;const n=i(0),r=i(27),s=i(26);!function(e){e.EM_TO_PX=16,e.PT_TO_PX=1.25,e.OBLIQUE_ANGLE=.174533,e.OBLIQUE_OFFSET=Math.tan(e.OBLIQUE_ANGLE),e.getPixelSize=function(t,i,n){let s=t;switch(i){case r.FontUnit.Em:s*=e.EM_TO_PX;break;case r.FontUnit.Point:s*=e.PT_TO_PX;break;case r.FontUnit.Percent:s*=.01*n}return s},e.getSmallCapsScale=function(e,t,i,n){return t[i]&&n===r.FontVariant.SmallCaps?e[i].font.metrics.xHeight/e[i].font.metrics.capHeight:1},e.getDirection=function(e,t){let i=s.UnicodeUtils.Direction.LTR,n=t;for(;e[n].direction!==s.UnicodeUtils.Direction.LTR&&e[n].direction!==s.UnicodeUtils.Direction.RTL&&n<e.length-1;)++n;return 1===Math.abs(e[n].direction)&&(i=e[n].direction),i},e.computeGlyphTransform=function(e,t,i,n,r){const s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r);e.set(i*a,i*-l,s*t.x-o*t.y,i*l,i*a,o*t.x+s*t.y,0,0,1)},e.updateBounds=function(e,t,i){const r=Math.min(e[0].x,e[1].x,e[2].x,e[3].x),s=Math.max(e[0].x,e[1].x,e[2].x,e[3].x),o=Math.min(e[0].y,e[1].y,e[2].y,e[3].y),a=Math.max(e[0].y,e[1].y,e[2].y,e[3].y);void 0!==i&&(void 0!==i.array[i.offset]?(i.array[i.offset].min.set(r,o),i.array[i.offset].max.set(s,a)):i.array.push(new n.Box2(new n.Vector2(r,o),new n.Vector2(s,a))),++i.offset),t.min.set(Math.min(t.min.x,r),Math.min(t.min.y,o)),t.max.set(Math.max(t.max.x,s),Math.max(t.max.y,a))}}(t.TypesettingUtils||(t.TypesettingUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorCache=void 0;const n=i(0);class r{constructor(){this.m_map=new Map}static get instance(){return this.m_instance}getColor(e){"number"==typeof e&&(e="#"+e.toString(16).padStart(6,"0"));let t=this.m_map.get(e);return void 0!==t||(t=new n.Color(e),this.m_map.set(e,t)),t}get size(){return this.m_map.size}clear(){this.m_map.clear()}}t.ColorCache=r,r.m_instance=new r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debugContext=t.DebugContext=void 0;const n=i(0),r="undefined"==typeof window;class s extends n.EventDispatcher{constructor(e){super(),this.value=e}set(e,t){this.value=e,this.dispatchEvent({type:s.SET_EVENT_TYPE,name:t,value:e})}}s.SET_EVENT_TYPE="set";class o{constructor(){if(this.m_optionsMap=new Map,!r&&"undefined"!=typeof window&&window){window.__debugContext=this}}setValue(e,t){let i=this.m_optionsMap.get(e);i?i.set(t,e):(i=new s(t),this.m_optionsMap.set(e,i))}getValue(e){const t=this.m_optionsMap.get(e);return t?t.value:void 0}hasOption(e){return void 0!==this.m_optionsMap.get(e)}addEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.addEventListener(s.SET_EVENT_TYPE,t)}hasEventListener(e,t){const i=this.m_optionsMap.get(e);if(i)return i.hasEventListener(s.SET_EVENT_TYPE,t);throw Error("Unknown option: "+e)}removeEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.removeEventListener(s.SET_EVENT_TYPE,t)}get options(){return this.m_optionsMap}clear(){this.m_optionsMap.forEach(e=>{e.set(void 0,"")})}}t.DebugContext=o,t.debugContext=new o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructLineWidth=t.reconstructLine=t.triangulateLine=t.numCirclePoints=void 0;const n=i(0),r=new n.Vector3(0,0,1),s=[0,1,2,1,3,2],o=[0,1,3,3,1,2,0,3,4,5,4,3],a=Math.PI/8;function l(e,t,i,n,r,s){const o=r.length/3;r.push(e,t,0);for(let l=0;l<9;++l){const c=a*l+Math.PI/2+i;r.push(e+n*Math.cos(c),t+n*Math.sin(c),0),s.push(o,o+l+1,o+(l+1)%9+1)}}t.numCirclePoints=function(e){return 9},t.triangulateLine=function(e,t,i,a,c=!0,h=c){if(e.length<3)return;const u=new n.Vector2;if(c){const n=3!==e.length?u.set(e[3]-e[0],e[4]-e[1]).angle():0;l(e[0],e[1],n,t,i,a)}const d=i.length/3,m=new n.Vector3,p=new n.Vector3,f=new n.Vector3,g=new n.Vector3,v=new n.Vector3,y=new n.Vector3,_=new n.Vector3,x=new n.Vector3,w=new n.Vector3,b=e.length/3;let M=0;for(let n=0;n<b;++n){let l=!1;if(p.set(e[3*n],e[3*n+1],e[3*n+2]),n+1<b){if(f.set(e[3*(n+1)],e[3*(n+1)+1],e[3*(n+1)+2]),g.copy(f).sub(p).normalize().cross(r),v.copy(g),n>0&&(v.add(m).multiplyScalar(1-.5*g.dot(m)),l=m.angleTo(g)>Math.PI/2,l)){const e=t/Math.cos(g.angleTo(m)/2);y.copy(g).add(m).normalize().multiplyScalar(-e).add(p),_.copy(m).multiplyScalar(t).add(p),x.copy(g).add(m).normalize().multiplyScalar(e).add(p),w.copy(g).multiplyScalar(t).add(p)}l?i.push(y.x,y.y,y.z,_.x,_.y,_.z,x.x,x.y,x.z,w.x,w.y,w.z):(y.copy(v).multiplyScalar(-t).add(p),_.copy(v).multiplyScalar(t).add(p),i.push(y.x,y.y,y.z,_.x,_.y,_.z)),m.copy(g)}else y.copy(m).multiplyScalar(-t).add(p),_.copy(m).multiplyScalar(t).add(p),i.push(y.x,y.y,y.z,_.x,_.y,_.z);n!==b-1&&((l?o:s).forEach(e=>a.push(d+M+e)),M+=l?4:2)}if(h){const n=2!==e.length?u.set(e[3*(b-3)]-e[3*(b-2)],e[3*(b-3)+1]-e[3*(b-2)+1]).angle():Math.PI;l(e[3*(b-2)],e[3*(b-2)+1],n,t,i,a)}},t.reconstructLine=function(e,t){const i=new Float32Array(e.length/2);for(let n=3*t,r=2*n;n<i.length;n+=3,r+=6)i[n]=e[r]+.5*(e[r+3]-e[r]),i[n+1]=e[r+1]+.5*(e[r+3+1]-e[r+1]),i[n+2]=e[r+2]+.5*(e[r+3+2]-e[r+2]);return i},t.reconstructLineWidth=function(e,t){const i=e[2*t+3]-e[2*t],n=e[2*t+3+1]-e[2*t+1],r=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(i*i+n*n+r*r)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionUtils=void 0;const n=i(4),r=i(0),s=i(163),o=i(329),a=i(82);!function(e){function t(e){return new r.Vector3(Math.fround(e.x),Math.fround(e.y),Math.fround(e.z))}function i(e,i){const n=(new r.Matrix4).copy(e.projectionMatrix).multiply(e.matrixWorldInverse),s=new r.Vector3(0,0,0).applyMatrix4(i),o=t(s);return{viewProjection:n,eyePosHi:o,eyePosLo:t(s.sub(o))}}function l(e){if(e.length>0){const t=e[0];if(null==t)throw Error("Empty element in positions");const i=new Array,n=new Array,s=(...e)=>{for(const t of e){const e=Math.fround(t);n.push(t-e),i.push(e)}},o=e=>{s(e.x,e.y,e.z)};if(void 0!==t.z)e.forEach(e=>{o(e)});else{if(i.length%3!=0)throw Error("Positions must be 3D, not 2D");e.forEach(e=>{s(e)})}return{positionHigh:new r.Float32BufferAttribute(i,3),positionLow:new r.Float32BufferAttribute(n,3)}}return{positionHigh:new r.Float32BufferAttribute([],3),positionLow:new r.Float32BufferAttribute([],3)}}function c(e,t,i=0){const n=new Array,r=e.length;for(let s=0;s<r;s+=t){for(let t=0;t<i;t++)n.push(e[s+t]);const r=e[s+i],o=e[s+i+1],a=e[s+i+2],l=Math.fround(r),c=r-l,h=Math.fround(o),u=o-h,d=Math.fround(a),m=a-d;n.push(l,h,d,c,u,m);for(let r=i+3;r<t;r++)n.push(e[s+r])}return n}function h(e,t){const i=l(t);return e.bufferGeometry.setAttribute("position",i.positionHigh),e.bufferGeometry.setAttribute("positionLow",i.positionLow),i.positionHigh.itemSize}e.doubleToFloatVec=t,e.makeFloatVec=function(e){const t=Math.fround(e.x),i=Math.fround(e.y),n=Math.fround(e.z),s=new r.Vector3(e.x-t,e.y-i,e.z-n);return e.x=Math.fround(t),e.y=Math.fround(i),e.z=Math.fround(n),s},e.createHighPrecisionCameraPos=i,e.updateHpUniforms=function(e,t,n){const r=i(t,e.matrixWorldInverse),s=r.viewProjection;if(void 0===n||!n.isMaterial)throw Error("High pecision line has no high precision material");if(!(n.uniforms&&n.uniforms.u_mvp&&n.uniforms.u_eyepos&&n.uniforms.u_eyepos_lowpart))throw Error("High pecision material has missing uniforms");n.uniforms.u_mvp.value=new Float32Array(s.elements),n.uniforms.u_eyepos.value=new Float32Array(r.eyePosHi.toArray()),n.uniforms.u_eyepos_lowpart.value=new Float32Array(r.eyePosLo.toArray())},e.createAttributes=l,e.addInterleavedAttributes3=c,e.setPositions=h,e.convertPositions=function(e){if(e.length<=0)return{positions:[]};const t=e[0];if(null==t)throw Error("Empty element in positions");const i=t;if(void 0===i.y&&void 0===i.z)return{positions:e};const n=new Array;return e.forEach(e=>{n.push(e.x,e.y,e.z)}),{positions:n}},e.createLine=function(e,t){const i=void 0!==t.lineWidth?t.lineWidth:5,o=void 0!==t.addCircles&&t.addCircles,l=void 0!==t.wireFrame&&t.wireFrame,h=[],u=[];a.triangulateLine(e,i,h,u,o);const d=new r.BufferGeometry,m=c(h,3),p=new r.InterleavedBuffer(new Float32Array(m),6),f=new r.InterleavedBufferAttribute(p,3,0,!1),g=new r.InterleavedBufferAttribute(p,3,3,!1);d.setAttribute("position",f),d.setAttribute("positionLow",g),d.setIndex(new r.BufferAttribute(new Uint32Array(u),1));const v=new n.HighPrecisionLineMaterial(t),y=l?new s.HighPrecisionWireFrameLine(d,v):new s.HighPrecisionLine(d,v);return y.setupForRendering(),y},e.createPoints=function(e,t){const i=[];for(let t=0;t<e.length;t++)i.push(i.length/3);const s=new r.BufferGeometry,a=n.isHighPrecisionPointMaterial(t)?t:new n.HighPrecisionPointMaterial(t),l=new o.HighPrecisionPoints(s,a);return h(l,e),l.setupForRendering(),l}}(t.HighPrecisionUtils||(t.HighPrecisionUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProvider=void 0,i(16);const n=i(0);class r extends n.EventDispatcher{constructor(){super(...arguments),this.m_clients=new Set}register(e){return 0===this.m_clients.size&&(this.m_connectPromise=this.connect()),this.m_clients.add(e),this.m_connectPromise}unregister(e){this.m_clients.delete(e)&&0===this.m_clients.size&&this.dispose()}}t.DataProvider=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileDataSource=void 0;const n=i(2),r=i(5),s=i(1),o=i(348);class a extends r.DataSource{constructor(e){var t,i,n,r,o;super(e),this.m_options=e,this.m_opacity=1,this.m_renderOrder=0,this.m_transparent=!1,this.dataProvider=this.m_options.dataProvider,this.cacheable=!0,this.m_opacity=null!==(i=null===(t=this.m_options.renderingOptions)||void 0===t?void 0:t.opacity)&&void 0!==i?i:1,this.m_transparent=!0===(null===(n=this.m_options.renderingOptions)||void 0===n?void 0:n.transparent)||this.m_opacity<1,this.m_renderOrder=null!==(o=null===(r=this.m_options.renderingOptions)||void 0===r?void 0:r.renderOrder)&&void 0!==o?o:0,this.m_resolution=s.getOptionValue(e.resolution,a.resolutionValue.resolution512)}set opacity(e){var t;this.m_opacity=e,this.m_opacity<1?this.m_transparent=!0:!0!==(null===(t=this.m_options.renderingOptions)||void 0===t?void 0:t.transparent)&&(this.m_transparent=!1)}get opacity(){return this.m_opacity}get resolution(){return this.m_resolution}get renderOrder(){return this.m_renderOrder}get transparent(){return this.m_transparent}shouldPreloadTiles(){return!0}getTilingScheme(){return n.webMercatorTilingScheme}getTile(e){const t=new r.Tile(this,e);return t.tileLoader=new o.WebTileLoader(this,t,this.dataProvider),t}isFullyCovering(){return!0}}t.WebTileDataSource=a,function(e){let t,i;!function(e){e[e.ppi72=72]="ppi72",e[e.ppi250=250]="ppi250",e[e.ppi320=320]="ppi320",e[e.ppi500=500]="ppi500"}(t=e.ppiValue||(e.ppiValue={})),function(e){e[e.resolution256=256]="resolution256",e[e.resolution512=512]="resolution512"}(i=e.resolutionValue||(e.resolutionValue={}))}(a=t.WebTileDataSource||(t.WebTileDataSource={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapControls=t.EventNames=t.TiltState=void 0;const n=i(2),r=i(5),s=i(0),o=i(170);var a,l,c;!function(e){e[e.NONE=0]="NONE",e[e.PAN=1]="PAN",e[e.ROTATE=2]="ROTATE",e[e.ORBIT=3]="ORBIT",e[e.TOUCH=4]="TOUCH"}(a||(a={})),function(e){e[e.Tilted=0]="Tilted",e[e.Down=1]="Down"}(l=t.TiltState||(t.TiltState={})),function(e){e.Update="update",e.BeginInteraction="begin-interaction",e.EndInteraction="end-interaction"}(c=t.EventNames||(t.EventNames={}));const h={type:c.Update},u={type:c.BeginInteraction},d={type:c.EndInteraction},m=s.MathUtils.degToRad(89);class p extends r.EventDispatcher{constructor(e,t=!0){super(),this.mapView=e,this.rotationMouseDeltaFactor=.1,this.orbitingMouseDeltaFactor=.1*s.MathUtils.DEG2RAD,this.orbitingTouchDeltaFactor=.1*s.MathUtils.DEG2RAD,this.enabled=!0,this.zoomEnabled=!0,this.panEnabled=!0,this.tiltEnabled=!0,this.rotateEnabled=!0,this.inertiaEnabled=!0,this.zoomInertiaDampingDuration=.6,this.panInertiaDampingDuration=1,this.tiltToggleDuration=.5,this.tiltAngle=Math.PI/4,this.northResetAnimationDuration=1.5,this.zoomLevelDeltaOnControl=1,this.minZoomLevel=0,this.maxZoomLevel=20,this.minCameraHeight=3,this.zoomLevelDeltaOnDoubleClick=1,this.doubleTapTime=.3,this.m_currentViewDirection=new s.Vector3,this.m_lastMousePosition=new s.Vector2(0,0),this.m_initialMousePosition=new s.Vector2(0,0),this.m_mouseDelta=new s.Vector2(0,0),this.m_needsRenderLastFrame=!0,this.m_panIsAnimated=!1,this.m_panDistanceFrameDelta=new s.Vector3,this.m_panAnimationTime=0,this.m_panAnimationStartTime=0,this.m_lastAveragedPanDistanceOrAngle=0,this.m_currentInertialPanningSpeed=0,this.m_lastPanVector=new s.Vector3,this.m_rotateGlobeQuaternion=new s.Quaternion,this.m_lastRotateGlobeAxis=new s.Vector3,this.m_lastRotateGlobeAngle=0,this.m_lastRotateGlobeFromVector=new s.Vector3,this.m_recentPanDistancesOrAngles=[0,0,0,0,0],this.m_currentPanDistanceOrAngleIndex=0,this.m_zoomIsAnimated=!1,this.m_zoomDeltaRequested=0,this.m_zoomTargetNormalizedCoordinates=new s.Vector2,this.m_zoomAnimationTime=0,this.m_zoomAnimationStartTime=0,this.m_startZoom=0,this.m_tiltIsAnimated=!1,this.m_tiltRequested=void 0,this.m_tiltAnimationTime=0,this.m_tiltAnimationStartTime=0,this.m_startTilt=0,this.m_state=a.NONE,this.m_tmpVector2=new s.Vector2,this.m_tmpVector3=new s.Vector3,this.m_tapStartTime=0,this.m_lastSingleTapTime=0,this.m_fingerMoved=!1,this.m_isDoubleTap=!1,this.m_resetNorthStartTime=0,this.m_resetNorthIsAnimated=!1,this.m_resetNorthAnimationDuration=0,this.m_currentAzimuth=0,this.m_lastAzimuth=0,this.m_startAzimuth=0,this.m_maxTiltAngle=m,this.m_touchState={touches:[],currentRotation:0,initialRotation:0},this.dispose=()=>{},this.camera=e.camera,this.domElement=e.renderer.domElement,this.maxZoomLevel=e.maxZoomLevel,this.minZoomLevel=e.minZoomLevel,this.minCameraHeight=e.minCameraHeight,this.bindInputEvents(this.domElement),this.handleZoom=this.handleZoom.bind(this),this.handlePan=this.handlePan.bind(this),this.tilt=this.tilt.bind(this),this.resetNorth=this.resetNorth.bind(this),this.assignZoomAfterTouchZoomRender=this.assignZoomAfterTouchZoomRender.bind(this),t&&e.addEventListener(r.MapViewEventNames.Dispose,()=>{this.dispose()})}static create(e,t=!0){return new p(e,t)}get zoomLevelDeltaOnMouseWheel(){return void 0!==this.m_zoomLevelDeltaOnMouseWheel?this.m_zoomLevelDeltaOnMouseWheel:this.inertiaEnabled?.8:.2}set zoomLevelDeltaOnMouseWheel(e){this.m_zoomLevelDeltaOnMouseWheel=e}get attitude(){const e=r.MapViewUtils.extractAttitude(this.mapView,this.camera);return{yaw:s.MathUtils.radToDeg(e.yaw),pitch:s.MathUtils.radToDeg(e.pitch),roll:s.MathUtils.radToDeg(e.roll)}}pointToNorth(){this.m_startAzimuth=Math.PI+r.MapViewUtils.extractSphericalCoordinatesFromLocation(this.mapView,this.camera,this.mapView.target).azimuth,this.m_startAzimuth=Math.atan2(Math.sin(this.m_startAzimuth),Math.cos(this.m_startAzimuth)),0!==this.m_startAzimuth&&(this.stopExistingAnimations(),this.m_resetNorthAnimationDuration=this.northResetAnimationDuration,this.m_currentAzimuth=this.m_startAzimuth,this.m_resetNorthStartTime=performance.now(),this.resetNorth())}zoomOnTargetPosition(e,t,i){r.MapViewUtils.zoomOnTargetPosition(this.mapView,e,t,i,this.m_maxTiltAngle)}setZoomLevel(e,t={x:0,y:0}){this.enabled&&this.zoomEnabled&&(this.dispatchEvent(u),this.m_startZoom=this.currentZoom,this.m_zoomDeltaRequested=e-this.zoomLevelTargeted,this.stopExistingAnimations(),this.m_zoomAnimationStartTime=performance.now(),this.m_zoomTargetNormalizedCoordinates.set(t.x,t.y),this.handleZoom(),this.dispatchEvent(d))}toggleTilt(){if(!this.enabled||!this.tiltEnabled)return;this.stopExistingAnimations(),this.m_startTilt=this.currentTilt;const e=this.m_startTilt<.01;this.m_tiltRequested=e?this.tiltAngle:0,this.m_tiltState=e?l.Tilted:l.Down,this.m_tiltAnimationStartTime=performance.now(),this.tilt()}set cameraHeight(e){this.camera.position.setZ(e),this.camera.matrixWorldNeedsUpdate=!0}get cameraHeight(){return this.mapView.camera.position.z}set maxTiltAngle(e){this.m_maxTiltAngle=Math.max(0,Math.min(m,s.MathUtils.degToRad(e)))}get maxTiltAngle(){return s.MathUtils.radToDeg(this.m_maxTiltAngle)}get zoomLevelTargeted(){return void 0===this.m_targetedZoom?this.currentZoom:this.m_targetedZoom}get tiltState(){return void 0===this.m_tiltState&&(this.m_tiltState=this.currentTilt<.01||this.m_tiltState===l.Down?l.Tilted:l.Down),this.m_tiltState}set currentZoom(e){this.m_currentZoom=e}get currentZoom(){return void 0!==this.m_currentZoom?this.m_currentZoom:this.mapView.zoomLevel}set currentTilt(e){this.m_currentTilt=e}get currentTilt(){return s.MathUtils.degToRad(this.mapView.tilt)}get targetedTilt(){return void 0===this.m_targetedTilt?void 0===this.m_currentTilt?this.currentTilt:this.m_currentTilt:this.m_targetedTilt}assignZoomAfterTouchZoomRender(){this.m_currentZoom=this.mapView.zoomLevel,this.m_targetedZoom=this.mapView.zoomLevel,this.mapView.removeEventListener(r.MapViewEventNames.AfterRender,this.assignZoomAfterTouchZoomRender)}stopExistingAnimations(){this.stopResetNorth(),this.stopZoom(),this.stopPan(),this.stopTilt()}resetNorth(){const e=(performance.now()-this.m_resetNorthStartTime)/1e3;if(this.inertiaEnabled){this.m_resetNorthIsAnimated||(this.m_resetNorthIsAnimated=!0,this.mapView.addEventListener(r.MapViewEventNames.AfterRender,this.resetNorth));e>this.m_resetNorthAnimationDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.stopResetNorth()):this.m_needsRenderLastFrame=!0}this.m_lastAzimuth=this.m_currentAzimuth,this.m_currentAzimuth=this.inertiaEnabled?this.easeOutCubic(this.m_startAzimuth,0,Math.min(1,e/this.m_resetNorthAnimationDuration)):0;const t=this.m_currentAzimuth-this.m_lastAzimuth;r.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaAzimuth:t,maxTiltAngle:this.m_maxTiltAngle}),this.updateMapView()}stopResetNorth(){this.mapView.removeEventListener(r.MapViewEventNames.AfterRender,this.resetNorth),this.m_resetNorthIsAnimated=!1}tilt(){void 0!==this.m_tiltRequested&&(this.m_targetedTilt=Math.max(Math.min(this.m_tiltRequested,this.maxTiltAngle),0),this.m_tiltRequested=void 0);let e=!1;if(this.inertiaEnabled){this.m_tiltIsAnimated||(this.m_tiltIsAnimated=!0,this.mapView.addEventListener(r.MapViewEventNames.AfterRender,this.tilt));const t=performance.now();this.m_tiltAnimationTime=(t-this.m_tiltAnimationStartTime)/1e3;this.m_tiltAnimationTime>=this.tiltToggleDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_tiltAnimationTime=this.tiltToggleDuration,e=!0):this.m_needsRenderLastFrame=!0}this.m_currentTilt=this.inertiaEnabled?this.easeOutCubic(this.m_startTilt,this.targetedTilt,Math.min(1,this.m_tiltAnimationTime/this.tiltToggleDuration)):this.targetedTilt;const t=this.currentTilt,i=this.m_currentTilt-t;r.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaTilt:i,maxTiltAngle:this.m_maxTiltAngle}),this.updateMapView(),e&&this.stopTilt()}stopTilt(){this.mapView.removeEventListener(r.MapViewEventNames.AfterRender,this.tilt),this.m_tiltIsAnimated=!1,this.m_targetedTilt=this.m_currentTilt=void 0}easeOutCubic(e,t,i){return e+(t-e)*(1-Math.pow(1-i,3))}easeOutCirc(e,t,i){return e+(t-e)*Math.sqrt(1-Math.pow(i-1,2))}handleZoom(){let e=!1;if(0!==this.m_zoomDeltaRequested&&(this.m_targetedZoom=Math.max(Math.min(this.zoomLevelTargeted+this.m_zoomDeltaRequested,this.maxZoomLevel),this.minZoomLevel),this.m_zoomDeltaRequested=0),this.inertiaEnabled&&this.zoomInertiaDampingDuration>0){this.m_zoomIsAnimated||(this.m_zoomIsAnimated=!0,this.mapView.addEventListener(r.MapViewEventNames.AfterRender,this.handleZoom));const t=performance.now();this.m_zoomAnimationTime=(t-this.m_zoomAnimationStartTime)/1e3;this.m_zoomAnimationTime>this.zoomInertiaDampingDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_zoomAnimationTime=this.zoomInertiaDampingDuration,e=!0,this.stopZoom()):this.m_needsRenderLastFrame=!0}this.currentZoom=!this.inertiaEnabled||Math.abs(this.zoomLevelTargeted-this.m_startZoom)<.01?this.zoomLevelTargeted:this.easeOutCirc(this.m_startZoom,this.zoomLevelTargeted,Math.min(1,this.m_zoomAnimationTime/this.zoomInertiaDampingDuration));const t=r.MapViewUtils.zoomOnTargetPosition(this.mapView,this.m_zoomTargetNormalizedCoordinates.x,this.m_zoomTargetNormalizedCoordinates.y,this.currentZoom,this.m_maxTiltAngle);!e&&t||(this.m_targetedZoom=void 0,this.m_currentZoom=void 0),this.updateMapView()}stopZoom(){this.mapView.removeEventListener(r.MapViewEventNames.AfterRender,this.handleZoom),this.m_zoomIsAnimated=!1}handlePan(){if(this.m_state===a.NONE&&0===this.m_lastAveragedPanDistanceOrAngle)return;this.inertiaEnabled&&!this.m_panIsAnimated&&(this.m_panIsAnimated=!0,this.mapView.addEventListener(r.MapViewEventNames.AfterRender,this.handlePan));const e=this.inertiaEnabled&&this.panInertiaDampingDuration>0&&this.m_state===a.NONE&&this.m_lastAveragedPanDistanceOrAngle>0;if(e){const e=performance.now();this.m_panAnimationTime=(e-this.m_panAnimationStartTime)/1e3;this.m_panAnimationTime>this.panInertiaDampingDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_panAnimationTime=this.panInertiaDampingDuration,this.mapView.removeEventListener(r.MapViewEventNames.AfterRender,this.handlePan),this.m_panIsAnimated=!1):this.m_needsRenderLastFrame=!0;const t=this.m_panAnimationTime/this.panInertiaDampingDuration;this.m_currentInertialPanningSpeed=this.easeOutCubic(this.m_lastAveragedPanDistanceOrAngle,0,Math.min(1,t)),0===this.m_currentInertialPanningSpeed&&(this.m_lastAveragedPanDistanceOrAngle=0),this.mapView.projection.type===n.ProjectionType.Planar?this.m_panDistanceFrameDelta.copy(this.m_lastPanVector).setLength(this.m_currentInertialPanningSpeed):this.mapView.projection.type===n.ProjectionType.Spherical&&this.m_rotateGlobeQuaternion.setFromAxisAngle(this.m_lastRotateGlobeAxis,this.m_currentInertialPanningSpeed).normalize()}else{let e=0;this.mapView.projection.type===n.ProjectionType.Planar?e=this.m_lastPanVector.copy(this.m_panDistanceFrameDelta).length():this.mapView.projection.type===n.ProjectionType.Spherical&&(e=this.m_lastRotateGlobeAngle,this.m_rotateGlobeQuaternion.setFromAxisAngle(this.m_lastRotateGlobeAxis,this.m_lastRotateGlobeAngle),this.m_rotateGlobeQuaternion.normalize()),this.m_currentPanDistanceOrAngleIndex=(this.m_currentPanDistanceOrAngleIndex+1)%5,this.m_recentPanDistancesOrAngles[this.m_currentPanDistanceOrAngleIndex]=e,this.m_lastAveragedPanDistanceOrAngle=this.m_recentPanDistancesOrAngles.reduce((e,t)=>e+t)/5}this.mapView.projection.type===n.ProjectionType.Planar?r.MapViewUtils.panCameraAboveFlatMap(this.mapView,this.m_panDistanceFrameDelta.x,this.m_panDistanceFrameDelta.y):this.mapView.projection.type===n.ProjectionType.Spherical&&r.MapViewUtils.panCameraAroundGlobe(this.mapView,this.m_lastRotateGlobeFromVector,this.m_tmpVector3.copy(this.m_lastRotateGlobeFromVector).applyQuaternion(this.m_rotateGlobeQuaternion)),e||(this.m_panDistanceFrameDelta.set(0,0,0),this.m_lastRotateGlobeAngle=0),this.updateMapView()}stopPan(){this.m_panDistanceFrameDelta.set(0,0,0),this.m_lastAveragedPanDistanceOrAngle=0}bindInputEvents(e){const t=this.contextMenu.bind(this),i=this.mouseDown.bind(this),n=this.mouseWheel.bind(this),r=this.touchStart.bind(this),s=this.touchEnd.bind(this),o=this.touchMove.bind(this),a=this.mouseDoubleClick.bind(this);e.addEventListener("dblclick",a,!1),e.addEventListener("contextmenu",t,!1),e.addEventListener("mousedown",i,!1),e.addEventListener("wheel",n,!1),e.addEventListener("touchstart",r,!1),e.addEventListener("touchend",s,!1),e.addEventListener("touchmove",o,!1),this.dispose=()=>{e.removeEventListener("dblclick",a,!1),e.removeEventListener("contextmenu",t,!1),e.removeEventListener("mousedown",i,!1),e.removeEventListener("wheel",n,!1),e.removeEventListener("touchstart",r,!1),e.removeEventListener("touchend",s,!1),e.removeEventListener("touchmove",o,!1)}}updateMapView(){this.dispatchEvent(h),this.mapView.update()}mouseDoubleClick(e){if(!this.enabled||!this.zoomEnabled)return;const t=this.getPointerPosition(e);this.zoomOnDoubleClickOrTap(t.x,t.y)}mouseDown(e){if(!1===this.enabled)return;if(e.shiftKey)return;if(e.stopPropagation(),this.m_state!==a.NONE)return;if(0===e.button&&!e.ctrlKey&&this.panEnabled)this.m_state=a.PAN;else if(1===e.button)this.m_state=a.ROTATE;else{if(2!==e.button&&!e.ctrlKey||!this.tiltEnabled)return;this.m_state=a.ORBIT}this.dispatchEvent(u);const t=this.getPointerPosition(e);if(this.m_lastMousePosition.copy(t),!0===e.altKey){const{width:e,height:i}=o.getWidthAndHeightFromCanvas(this.domElement);this.m_initialMousePosition.copy(o.calculateNormalizedDeviceCoordinates(t.x,t.y,e,i))}else r.CameraUtils.getPrincipalPoint(this.mapView.camera,this.m_initialMousePosition);const i=this.mouseMove.bind(this),n=this.mouseUp.bind(this);window.addEventListener("mousemove",i,!1),window.addEventListener("mouseup",n,!1),this.m_cleanupMouseEventListeners=()=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",n)}}mouseMove(e){if(!1===this.enabled)return;const t=this.getPointerPosition(e);if(this.m_mouseDelta.set(t.x-this.m_lastMousePosition.x,t.y-this.m_lastMousePosition.y),this.m_state===a.PAN){const e=this.getWorldPositionWithElevation(this.m_lastMousePosition.x,this.m_lastMousePosition.y,t.x,t.y);if(void 0===e)return;const{fromWorld:i,toWorld:n}=e;this.panFromTo(i,n)}else this.m_state===a.ROTATE?(this.stopExistingAnimations(),r.MapViewUtils.rotate(this.mapView,-this.rotationMouseDeltaFactor*this.m_mouseDelta.x,this.rotationMouseDeltaFactor*this.m_mouseDelta.y,this.m_maxTiltAngle)):this.m_state===a.ORBIT&&(this.stopExistingAnimations(),r.MapViewUtils.orbitAroundScreenPoint(this.mapView,{center:this.m_tmpVector2.set(this.m_initialMousePosition.x,this.m_initialMousePosition.y),deltaAzimuth:this.orbitingMouseDeltaFactor*this.m_mouseDelta.x,deltaTilt:-this.orbitingMouseDeltaFactor*this.m_mouseDelta.y,maxTiltAngle:this.m_maxTiltAngle}));this.m_lastMousePosition.set(t.x,t.y),this.m_zoomAnimationStartTime=performance.now(),this.updateMapView(),e.preventDefault(),e.stopPropagation()}mouseUp(e){!1!==this.enabled&&(this.updateMapView(),e.preventDefault(),e.stopPropagation(),this.m_state=a.NONE,this.m_cleanupMouseEventListeners&&this.m_cleanupMouseEventListeners(),this.dispatchEvent(d))}mouseWheel(e){if(!this.enabled||!this.zoomEnabled)return;const{width:t,height:i}=o.getWidthAndHeightFromCanvas(this.domElement),n=o.calculateNormalizedDeviceCoordinates(e.offsetX,e.offsetY,t,i);this.setZoomLevel(this.mapView.zoomLevel-this.zoomLevelDeltaOnMouseWheel*Math.sign(e.deltaY),n),e.preventDefault(),e.stopPropagation()}updateCurrentRotation(){if(this.m_touchState.touches.length<2||0===this.m_touchState.touches[1].currentWorldPosition.length()||0===this.m_touchState.touches[0].currentWorldPosition.length())return;let e=0,t=0;this.mapView.projection.type===n.ProjectionType.Planar?(e=this.m_touchState.touches[1].currentWorldPosition.x-this.m_touchState.touches[0].currentWorldPosition.x,t=this.m_touchState.touches[1].currentWorldPosition.y-this.m_touchState.touches[0].currentWorldPosition.y):this.mapView.projection.type===n.ProjectionType.Spherical&&(e=this.m_touchState.touches[1].currentTouchPoint.x-this.m_touchState.touches[0].currentTouchPoint.x,t=this.m_touchState.touches[0].currentTouchPoint.y-this.m_touchState.touches[1].currentTouchPoint.y,this.m_touchState.initialRotation=this.m_touchState.currentRotation),this.m_touchState.currentRotation=Math.atan2(t,e)}calculatePinchDistanceInWorldSpace(){if(this.m_touchState.touches.length<2)return 0;const e=this.m_tmpVector3.subVectors(this.m_touchState.touches[0].initialWorldPosition,this.m_touchState.touches[1].initialWorldPosition).length();return this.m_tmpVector3.subVectors(this.m_touchState.touches[0].currentWorldPosition,this.m_touchState.touches[1].currentWorldPosition).length()-e}convertTouchPoint(e,t){const i=this.getPointerPosition(e);if(void 0!==t){const e=t.currentTouchPoint,n=this.getWorldPositionWithElevation(e.x,e.y,i.x,i.y),r=void 0===n?new s.Vector3:n.toWorld;return 0!==r.length()||3===this.m_touchState.touches.length&&this.tiltEnabled?(this.m_state!==a.TOUCH&&this.dispatchEvent(u),this.m_state=a.TOUCH,{currentTouchPoint:i,lastTouchPoint:i,currentWorldPosition:r,initialWorldPosition:r}):(this.setTouchState([]),this.m_state=a.NONE,void this.dispatchEvent(d))}{const{width:e,height:t}=o.getWidthAndHeightFromCanvas(this.domElement),n=o.calculateNormalizedDeviceCoordinates(i.x,i.y,e,t),l=r.MapViewUtils.rayCastWorldCoordinates(this.mapView,n.x,n.y),c=null===l?new s.Vector3:l;return 0!==c.length()||3===this.m_touchState.touches.length&&this.tiltEnabled?(this.m_state!==a.TOUCH&&this.dispatchEvent(u),this.m_state=a.TOUCH,{currentTouchPoint:i,lastTouchPoint:i,currentWorldPosition:c,initialWorldPosition:c}):(this.setTouchState([]),this.m_state=a.NONE,void this.dispatchEvent(d))}}setTouchState(e){this.m_touchState.touches=[];for(let t=0;t<e.length;++t){const i=this.convertTouchPoint(e[t]);void 0!==i&&this.m_touchState.touches.push(i)}0!==this.m_touchState.touches.length&&(this.updateCurrentRotation(),this.m_touchState.initialRotation=this.m_touchState.currentRotation)}updateTouches(e){const t=Math.min(e.length,this.m_touchState.touches.length);for(let i=0;i<t;++i){const t=this.m_touchState.touches[i],n=this.convertTouchPoint(e[i],t);void 0!==n&&void 0!==t&&(n.initialWorldPosition=t.initialWorldPosition,n.lastTouchPoint=t.currentTouchPoint,this.m_touchState.touches[i]=n)}}zoomOnDoubleClickOrTap(e,t){if(0===this.zoomLevelDeltaOnDoubleClick)return;const{width:i,height:n}=o.getWidthAndHeightFromCanvas(this.domElement),r=o.calculateNormalizedDeviceCoordinates(e,t,i,n);this.setZoomLevel(this.currentZoom+this.zoomLevelDeltaOnDoubleClick,r)}touchStart(e){!1!==this.enabled&&(this.m_tapStartTime=performance.now(),this.m_fingerMoved=!1,this.m_state=a.TOUCH,this.dispatchEvent(u),this.setTouchState(e.touches),this.updateTouches(e.touches),e.preventDefault(),e.stopPropagation())}touchMove(e){if(!1!==this.enabled){if(this.m_fingerMoved=!0,this.updateTouches(e.touches),this.panEnabled&&this.m_touchState.touches.length<=2&&void 0!==this.m_touchState.touches[0]&&this.panFromTo(this.m_touchState.touches[0].initialWorldPosition,this.m_touchState.touches[0].currentWorldPosition),2===this.m_touchState.touches.length){const e=this.m_touchState.touches,t=new s.Vector2;if(!0===this.zoomEnabled||!0===this.rotateEnabled){const{width:i,height:n}=o.getWidthAndHeightFromCanvas(this.domElement);e.forEach(e=>{const r=o.calculateNormalizedDeviceCoordinates(e.currentTouchPoint.x,e.currentTouchPoint.y,i,n);t.add(r)}),t.divideScalar(e.length)}if(this.zoomEnabled){const e=this.calculatePinchDistanceInWorldSpace();if(Math.abs(e)<.01)return;const i=r.MapViewUtils.calculateZoomLevelFromDistance(this.mapView,this.mapView.targetDistance-e);r.MapViewUtils.zoomOnTargetPosition(this.mapView,t.x,t.y,i,this.m_maxTiltAngle)}if(this.rotateEnabled){this.updateCurrentRotation();const e=this.m_touchState.currentRotation-this.m_touchState.initialRotation;this.stopExistingAnimations(),r.MapViewUtils.orbitAroundScreenPoint(this.mapView,{center:this.m_tmpVector2.set(t.x,t.y),deltaAzimuth:e,maxTiltAngle:this.m_maxTiltAngle})}}if(3===this.m_touchState.touches.length&&this.tiltEnabled){const e=this.m_touchState.touches[0],t=this.m_tmpVector2.subVectors(e.currentTouchPoint,e.lastTouchPoint);this.stopExistingAnimations(),r.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaAzimuth:this.orbitingTouchDeltaFactor*t.x,deltaTilt:-this.orbitingTouchDeltaFactor*t.y,maxTiltAngle:this.m_maxTiltAngle})}this.m_zoomAnimationStartTime=performance.now(),this.updateMapView(),e.preventDefault(),e.stopPropagation()}}touchEnd(e){!1!==this.enabled&&(this.m_state=a.NONE,this.handleDoubleTap(),this.setTouchState(e.touches),this.dispatchEvent(d),this.updateMapView(),e.preventDefault(),e.stopPropagation())}handleDoubleTap(){if(this.m_fingerMoved||!this.zoomEnabled)return;const e=performance.now();return e-this.m_tapStartTime>120?void 0:this.m_isDoubleTap?(e-this.m_lastSingleTapTime>1e3*this.doubleTapTime||this.zoomOnDoubleClickOrTap(this.m_touchState.touches[0].currentTouchPoint.x,this.m_touchState.touches[0].currentTouchPoint.y),void(this.m_isDoubleTap=!1)):(this.m_isDoubleTap=!0,void(this.m_lastSingleTapTime=e))}contextMenu(e){e.preventDefault()}getWorldPositionWithElevation(e,t,i,n){const{width:s,height:a}=o.getWidthAndHeightFromCanvas(this.domElement),l=o.calculateNormalizedDeviceCoordinates(e,t,s,a),c=o.calculateNormalizedDeviceCoordinates(i,n,s,a);let h,u,d;if(void 0!==this.mapView.elevationProvider&&(d=this.mapView.elevationProvider.rayCast(e,t)),void 0===d)u=r.MapViewUtils.rayCastWorldCoordinates(this.mapView,l.x,l.y),h=r.MapViewUtils.rayCastWorldCoordinates(this.mapView,c.x,c.y);else{u=d;const e=this.mapView.projection.unprojectAltitude(u);h=r.MapViewUtils.rayCastWorldCoordinates(this.mapView,c.x,c.y,e)}if(null!==u&&null!==h)return{fromWorld:u,toWorld:h}}panFromTo(e,t){this.stopExistingAnimations(),this.m_panAnimationStartTime=performance.now(),this.mapView.projection.type===n.ProjectionType.Planar?this.m_panDistanceFrameDelta.subVectors(e,t):this.mapView.projection.type===n.ProjectionType.Spherical&&(this.m_lastRotateGlobeFromVector.copy(e),this.m_lastRotateGlobeAxis.crossVectors(e,t).normalize(),this.m_lastRotateGlobeAngle=e.angleTo(t),isNaN(this.m_lastRotateGlobeAngle)&&(this.m_lastRotateGlobeAngle=0)),this.handlePan()}getPointerPosition(e){const t=o.getWidthAndHeightFromCanvas(this.domElement),i=this.domElement.getBoundingClientRect(),n=Math.round(i.width)/t.width,r=Math.round(i.height)/t.height;return new s.Vector2((e.clientX-Math.floor(i.left))*n,(e.clientY-Math.floor(i.top))*r)}}t.MapControls=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkerProperties=t.getSpatialProperties=void 0,t.getSpatialProperties=e=>{const t=e.getStyle(),i=t.lineWidth,s={lineWidth:t.lineWidth+"px",lineJoin:"Round",strokeColor:r(t.strokeColor)};return e.isClosed()?s.fillColor=r(t.fillColor):s.lineCap=n[t.lineCap],t.lineDash.length>1&&(s.dashSize=t.lineDash[0]*i+"px",s.gapSize=t.lineDash[1]*i+"px",s.dashes="Square"),s},t.getMarkerProperties=(e,t)=>{const i=e.getIcon();let n=null;if(i.getState()===H.map.Icon.State.READY){const{w:r,h:s}=i.getSize(),o="mapjs-icon-"+i.uid,a=i.getAnchor();let l=0,c=0;void 0!==a&&(l=a.x,c=a.y),n={id:e.getId(),imageTexture:o,minZoom:e.getMin(!0),maxZoom:e.getMax(!0)+1,screenWidth:r,screenHeight:s,iconXOffset:r/2-l,iconYOffset:-(s/2-c)},t[o]=i}return n};const n={butt:"None",square:"Square",round:"Round","arrow-head":"TriangleOut","arrow-tail":"TriangleIn"},r=e=>{const t="none"===e;return t&&console.warn('Unsupported color value "none" converted to "rgba(0,0,0,0)"'),t?"rgba(0,0,0,0)":e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectTile=t.ObjectDataSource=void 0;const n=i(353),r=i(24),s=i(50),o=i(167),a=i(175);class l extends o.VectorTileDataSource{constructor(e,t){super(Object.assign(Object.assign({},e),{tileFactory:new s.TileFactory(c),addGroundPlane:!1,styleSetName:"H-"+t.uid,gatherFeatureAttributes:!0})),this.provider=t,this.m_tileInvalidationPending=!1,this.invalidationDebounceTime=100,this.invalidationMaxTime=200,t.addEventListener("update",this.onProviderUpdate,!1,this),this.debounceTileInvalidation=a.default(()=>{this.m_tileInvalidationPending=!1,this.invalidateTiles()},this.invalidationDebounceTime,this.invalidationMaxTime)}attach(e){super.attach(e);const t=this.dataProvider();t.setIconLoader(new n.IconLoader(e)),t.setTilingScheme(this.getTilingScheme()),t.setProjectionSource(this)}dispose(){this.provider.removeEventListener("update",this.onProviderUpdate,!1,this),super.dispose()}get tileInvalidationPending(){return this.m_tileInvalidationPending}invalidateTilesWithDelay(){this.m_tileInvalidationPending=!0,this.debounceTileInvalidation()}}t.ObjectDataSource=l;class c extends r.Tile{dispose(){super.dispose(),this.dataSource.dataProvider().getIconLoader().releaseImageReferences(this.tileKey)}get allGeometryLoaded(){return super.allGeometryLoaded&&!this.dataSource.tileInvalidationPending}}t.ObjectTile=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:85},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:H.map.render.RenderEngine.InteractionModifiers.ZOOM,COORD:H.map.render.RenderEngine.InteractionModifiers.COORD},capture:!0};t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordLike=t.geoCoordLikeToGeoPointLike=t.geoCoordLikeToGeoCoordinatesLike=void 0;const n=i(20),r=i(55),s=i(56);t.geoCoordLikeToGeoCoordinatesLike=function(e){return n.isGeoCoordinatesLike(e)?e:s.isLatLngLike(e)?{latitude:e.lat,longitude:e.lng}:{latitude:e[1],longitude:e[0]}},t.geoCoordLikeToGeoPointLike=function(e){return r.isGeoPointLike(e)?e:s.isLatLngLike(e)?[e.lng,e.lat]:[e.longitude,e.latitude]},t.isGeoCoordLike=function(e){return n.isGeoCoordinatesLike(e)||s.isLatLngLike(e)||!r.isGeoPointLike(e)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoPolygon=t.isAntimeridianCrossing=void 0;const n=i(0),r=i(12),s=i(7),o=i(90);function a(e,t){return Math.max(e,t)-Math.min(e,t)}function l(e,t){return e>0&&t<0&&a(e,t)>180}t.isAntimeridianCrossing=function(e,t){return Math.sign(e)===-Math.sign(t)&&a(e,t)>180};t.GeoPolygon=class{constructor(e,t=!1,i=!1){this.m_coordinates=e.map(e=>o.geoCoordLikeToGeoCoordinatesLike(e)),t&&this.sortCCW(),i&&this.wrapCoordinatesAround()}get coordinates(){return this.m_coordinates}getGeoBoundingBox(){const e=this.getCentroid();if(void 0===e)return r.GeoBox.fromCoordinates(this.coordinates[0],this.coordinates[0]);const{east:t,west:i}=this.getEastAndWest(e),{north:n,south:o}=this.getNorthAndSouth();return r.GeoBox.fromCoordinates(new s.GeoCoordinates(o,i),new s.GeoCoordinates(n,t))}getCentroid(){const e=this.getArea();if(0===e)return;let t,i=0,n=0,r=this.m_coordinates.length-1;return this.m_coordinates.forEach((e,s)=>{const o=this.m_coordinates[r];t=e.latitude*o.longitude-o.latitude*e.longitude,i+=(e.latitude+o.latitude)*t,n+=(e.longitude+o.longitude)*t,r=s}),t=6*e,new s.GeoCoordinates(i/t,e<0?n/t-180:n/t)}sortCCW(){const e=this.getPolyAverageCenter();e&&this.m_coordinates.sort((t,i)=>{const r=new n.Vector2(t.latitude-e.latitude,t.longitude-e.longitude).normalize();return new n.Vector2(i.latitude-e.latitude,i.longitude-e.longitude).normalize().angle()-r.angle()})}wrapCoordinatesAround(){const e=this.m_coordinates.findIndex((e,t)=>{const i=0===t?this.m_coordinates.length-1:t-1;return l(this.m_coordinates[i].longitude,e.longitude)});if(e<0)return;let t=!0;for(let i=0;i<this.m_coordinates.length;i++){const n=(e+i)%this.m_coordinates.length,r=this.m_coordinates[n].longitude,s=this.m_coordinates[(n+1)%this.m_coordinates.length].longitude;t&&(this.m_coordinates[n].longitude+=360),l(s,r)?t=!1:l(r,s)&&(t=!0)}}getPolyAverageCenter(){const e=this.m_coordinates.reduce((e,t)=>new s.GeoCoordinates(e.latitude+t.latitude,e.longitude+t.longitude));return new s.GeoCoordinates(e.latitude/this.m_coordinates.length,e.longitude/this.m_coordinates.length)}getArea(){let e=0,t=this.m_coordinates.length-1;return this.m_coordinates.forEach((i,n)=>{const r=this.m_coordinates[t];e+=i.latitude*r.longitude,e-=i.longitude*r.latitude,t=n}),e/=2}getEastAndWest(e){let t=e.longitude,i=e.longitude,r=this.m_coordinates.length-1;return this.m_coordinates.forEach((s,o)=>{const a=this.m_coordinates[r];r=o;const l=new n.Vector2(s.latitude-e.latitude,s.longitude-e.longitude).normalize(),c=new n.Vector2(a.latitude-e.latitude,a.longitude-e.longitude).normalize();let h=1===Math.sign(c.angle()-l.angle());c.y>=0&&l.y<0&&(h=!0);const u=s.longitude;u<e.longitude?h?t=Math.min(t,u):i=Math.min(i,u):h?i=Math.max(i,u):t=Math.max(t,u)}),{east:i,west:t}}getNorthAndSouth(){let e=s.MIN_LATITUDE,t=s.MAX_LATITUDE;return this.m_coordinates.forEach((i,n)=>{e=Math.max(e,i.latitude),t=Math.min(t,i.latitude)}),{north:e,south:t}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.equirectangularProjection=t.normalizedEquirectangularProjection=void 0;const n=i(0),r=i(12),s=i(7),o=i(22),a=i(13),l=i(23),c=i(21),h=i(14);class u extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale/2,i.max.z=t,i}projectPoint(e,t){var i;return void 0===t&&(t={x:0,y:0,z:0}),t.x=(n.MathUtils.degToRad(e.longitude)+Math.PI)*u.geoToWorldScale*this.unitScale,t.y=(n.MathUtils.degToRad(e.latitude)+.5*Math.PI)*u.geoToWorldScale*this.unitScale,t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return s.GeoCoordinates.fromRadians(e.y*u.worldToGeoScale/this.unitScale-.5*Math.PI,e.x*u.worldToGeoScale/this.unitScale-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const i=this.projectPoint(new s.GeoCoordinates(e.center.latitude,e.center.longitude,0)),{latitudeSpanInRadians:r,longitudeSpanInRadians:c,altitudeSpan:h}=e,d=c*u.geoToWorldScale,m=r*u.geoToWorldScale;return t||(t=new n.Box3),o.isBox3Like(t)?(t.min.x=i.x-.5*d*this.unitScale,t.min.y=i.y-.5*m*this.unitScale,t.max.x=i.x+.5*d*this.unitScale,t.max.y=i.y+.5*m*this.unitScale,void 0!==h?(t.min.z=i.z-.5*h,t.max.z=i.z+.5*h):(t.min.z=0,t.max.z=0)):l.isOrientedBox3Like(t)&&(a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=i.x,t.position.y=i.y,t.position.z=i.z,t.extents.x=.5*d*this.unitScale,t.extents.y=.5*m*this.unitScale,t.extents.z=Math.max(Number.EPSILON,.5*(null!=h?h:0))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}u.geoToWorldScale=1/(2*Math.PI),u.worldToGeoScale=2*Math.PI/1,t.normalizedEquirectangularProjection=new u(1),t.equirectangularProjection=new u(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transverseMercatorProjection=t.TransverseMercatorUtils=void 0;const n=i(0),r=i(12),s=i(7),o=i(22),a=i(13),l=i(23),c=i(21),h=i(14);class u extends h.Projection{constructor(e){super(e),this.unitScale=e,this.type=h.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}static clampGeoPoint(e,t){const i=e.latitude,n=e.longitude,r=d.POLE_RADIUS,o=d.POLE_RADIUS_SQ,a=Math.round(n/90),l=90*a-n;if(a%2==0||Math.abs(l)>r)return e;const c=i-0,h=l*l+c*c;if(h<o){const e=Math.sqrt(h),t=(r-e)/e,o=1,a=0===l&&0===c?r*o:l;return new s.GeoCoordinates(i+c*t,n+a*t)}return e}getScaleFactor(e){return Math.cosh(2*(e.x/this.unitScale-.5)*Math.PI)}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){var i;t||(t={x:0,y:0,z:0});const r=u.clampGeoPoint(e,this.unitScale),s=r.longitude/360+.5,o=1===s?0:Math.floor(s),a=n.MathUtils.degToRad(r.latitude),l=n.MathUtils.degToRad(r.longitude-360*o)-this.m_lambda0,c=Math.cos(a)*Math.sin(l);t.x=Math.atanh(c),t.y=Math.atan2(Math.tan(a),Math.cos(l))-this.m_phi0;const h=.5/Math.PI;return t.x=this.unitScale*(n.MathUtils.clamp(t.x*h+.5,0,1)+o),t.y=this.unitScale*n.MathUtils.clamp(t.y*h+.5,0,1),t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){const t=2*Math.PI,i=e.x/this.unitScale,n=e.y/this.unitScale,r=1===i?0:Math.floor(i),o=t*(i-.5-r),a=t*(n-.5),l=e.z||0,c=a+this.m_phi0,h=Math.asin(Math.sin(c)/Math.cosh(o)),u=this.m_lambda0+Math.atan2(Math.sinh(o),Math.cos(c))+r*t;return s.GeoCoordinates.fromRadians(h,u,l)}projectBox(e,t){const{north:i,south:r,east:c,west:h}=e,u=[e.center,e.northEast,e.southWest,new s.GeoCoordinates(r,c),new s.GeoCoordinates(i,h)],m=d.POLE_EDGE_DEG,p=h<90&&c>90,f=h<0&&c>0,g=h<m&&c>-m&&i>0&&r<0;h<-90&&c>-90&&(u.push(new s.GeoCoordinates(i,-90)),u.push(new s.GeoCoordinates(r,-90))),p&&(u.push(new s.GeoCoordinates(i,90)),u.push(new s.GeoCoordinates(r,90))),f&&(u.push(new s.GeoCoordinates(i,0)),u.push(new s.GeoCoordinates(r,0))),g&&(u.push(new s.GeoCoordinates(0,h)),u.push(new s.GeoCoordinates(0,c))),d.alignLatitude(u,u[0]);const v=u.map(e=>this.projectPoint(e)),y=v.map(e=>e.x),_=v.map(e=>e.y),x=v.map(e=>e.z),w=Math.min(...y),b=Math.min(..._),M=Math.min(...x),T=Math.max(...y),S=Math.max(..._),E=Math.max(...x);if(t||(t=new n.Box3),o.isBox3Like(t))t.min.x=w,t.min.y=b,t.min.z=M,t.max.x=T,t.max.y=S,t.max.z=E;else{if(!l.isOrientedBox3Like(t))throw new Error("invalid bounding box");a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=(w+T)/2,t.position.y=(b+S)/2,t.position.z=(M+E)/2,t.extents.x=(T-w)/2,t.extents.y=(S-b)/2,t.extents.z=(E-M)/2}return t}unprojectBox(e){const t=this.unitScale,i=e.min,n=e.max,o=[{x:(i.x+n.x)/2,y:(i.y+n.y)/2,z:0},i,n,{x:i.x,y:n.y,z:0},{x:n.x,y:i.y,z:0}],a=.5*t,l=.25*t,c=.75*t,h=i.x<a&&n.x>a,u=i.y<a&&n.y>a,m=i.y<l&&n.y>l,p=i.y<c&&n.y>c;u&&(o.push({x:i.x,y:a,z:0}),o.push({x:n.x,y:a,z:0}),h&&o.push({x:a,y:a,z:0})),m&&(o.push({x:i.x,y:l,z:0}),o.push({x:n.x,y:l,z:0}),h&&o.push({x:a,y:l,z:0})),p&&(o.push({x:i.x,y:c,z:0}),o.push({x:n.x,y:c,z:0}),h&&o.push({x:a,y:c,z:0}));const f=o.map(e=>this.unprojectPoint(e));d.alignLongitude(f,f[0]);const g=f.map(e=>e.latitude),v=f.filter(e=>Math.abs(e.latitude)<90).map(e=>e.longitude),y=f.map(e=>{var t;return null!==(t=e.altitude)&&void 0!==t?t:0}),_=new s.GeoCoordinates(Math.min(...g),Math.min(...v),Math.min(...y)),x=new s.GeoCoordinates(Math.max(...g),Math.max(...v),Math.max(...y));return r.GeoBox.fromCoordinates(_,x)}unprojectAltitude(e){return e.z}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}}class d{static alignLatitude(e,t){for(const i of e)0===i.latitude&&(i.latitude=1e-9*t.latitude)}static alignLongitude(e,t){const i=t.longitude<0?180:-180,n=t.longitude<0?-180:180;for(const t of e)t.longitude===i&&(t.longitude=n)}}t.TransverseMercatorUtils=d,d.POLE_EDGE=1.4844222297453322,d.POLE_EDGE_DEG=n.MathUtils.radToDeg(d.POLE_EDGE),d.POLE_RADIUS=90-d.POLE_EDGE_DEG,d.POLE_RADIUS_SQ=Math.pow(d.POLE_RADIUS,2),t.transverseMercatorProjection=new u(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlatTileBoundingBoxGenerator=void 0;const n=i(0);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,i=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=i,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,i);const{min:n,max:r}=this.m_worldBox;this.m_worldDimensions={x:r.x-n.x,y:r.y-n.y,z:r.z-n.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const i=e.level,r=this.subdivisionScheme.getLevelDimensionX(i),s=this.subdivisionScheme.getLevelDimensionY(i),o=this.m_worldDimensions.x/r,a=this.m_worldDimensions.y/s,l=this.m_worldBox.min.x+o*e.column,c=this.m_worldBox.min.y+a*e.row;return t||(t=new n.Box3),t.min.x=l,t.min.y=c,t.min.z=this.m_worldBox.min.z,t.max.x=l+o,t.max.y=c+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.halfQuadTreeSubdivisionScheme=void 0;t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubTiles=void 0;const n=i(41);class r{constructor(e,t,i){this.tileKey=e,this.sizeX=t,this.sizeY=i}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?r.ZCurveIterator(this.tileKey):r.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}t.SubTiles=r,function(e){e.RowColumnIterator=function*(e,t,i){for(let r=0;r<i;r++)for(let s=0;s<t;s++)yield n.TileKey.fromRowColumnLevel(e.row*i+r,e.column*t+s,e.level+1)},e.ZCurveIterator=function*(e){for(let t=0;t<4;t++)yield n.TileKey.fromRowColumnLevel(e.row<<1|t>>1,e.column<<1|1&t,e.level+1)}}(r=t.SubTiles||(t.SubTiles={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileKeyUtils=t.powerOfTwo=void 0;const n=i(7),r=i(41);t.powerOfTwo=(()=>{let e=.5;return new Array(53).fill(0).map(()=>e*=2)})(),function(e){function i(e,t,i){const n=e.projection,s=e.subdivisionScheme,o=s.getLevelDimensionX(i),a=s.getLevelDimensionY(i),{min:l,max:c}=n.worldExtent(0,0),h=c.x-l.x,u=c.y-l.y;if(t.x<l.x||t.x>c.x)return null;if(t.y<l.y||t.y>c.y)return null;const d=Math.min(o-1,Math.floor(o*(t.x-l.x)/h)),m=Math.min(a-1,Math.floor(a*(t.y-l.y)/u));return r.TileKey.fromRowColumnLevel(m,d,i)}function s(e,i,n=4){const r=function(e,i=4){let n=0;const r=t.powerOfTwo[i];e+=r/2;for(;e<0;)e+=r;for(;e>=r;)e-=r;for(let r=0;r<i&&e>0;r++)1&e&&(n+=t.powerOfTwo[53-i+r]),e>>>=1;return n}(i,n);return e.mortonCode()+r}function o(e,i=4){let n=0,r=e,s=0;for(;s<i;s++){const e=t.powerOfTwo[52-s];r>=e&&(r-=e,n+=t.powerOfTwo[i-1-s])}return n-=t.powerOfTwo[i-1],{offset:n,mortonCode:r}}e.geoCoordinatesToTileKey=function(e,t,n){return i(e,e.projection.projectPoint(t),n)},e.worldCoordinatesToTileKey=i,e.geoRectangleToTileKeys=function(t,i,s){const o=(e,t,i)=>e<t?i-(t-e)%(i-t):t+(e-t)%(i-t),a=(e,t,i)=>Math.min(Math.max(e,t),i),l=o(i.southWest.longitudeInRadians,-Math.PI,Math.PI),c=a(i.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),h=o(i.northEast.longitudeInRadians,-Math.PI,Math.PI),u=a(i.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),d=e.geoCoordinatesToTileKey(t,n.GeoCoordinates.fromRadians(c,l),s),m=e.geoCoordinatesToTileKey(t,n.GeoCoordinates.fromRadians(u,h),s),p=t.subdivisionScheme.getLevelDimensionX(s);if(!d||!m)throw new Error("Invalid coordinates");const f=d.column;let g=m.column;l>h&&(g+=g!==f?p:p-1);const v=Math.min(d.row,m.row),y=Math.max(d.row,m.row),_=new Array;for(let e=v;e<=y;++e)for(let t=f;t<=g;++t)_.push(r.TileKey.fromRowColumnLevel(e,t%p,s));return _},e.getKeyForTileKeyAndOffset=s,e.extractOffsetAndMortonKeyFromKey=o,e.getParentKeyFromKey=function(e,t=4){const{offset:i,mortonCode:n}=o(e,t);return s(r.TileKey.fromMortonCode(r.TileKey.parentMortonCode(n)),i,t)}}(t.TileKeyUtils||(t.TileKeyUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileTreeTraverse=void 0;const n=i(96);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=this.m_subdivisionScheme.getSubdivisionX(e.level),i=this.m_subdivisionScheme.getSubdivisionY(e.level);return new n.SubTiles(e,t,i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimatedExtrusionHandler=t.AnimatedExtrusionState=void 0;const n=i(3),r=i(4),s=i(1);var o;!function(e){e[e.None=0]="None",e[e.Started=1]="Started",e[e.Finished=2]="Finished"}(o=t.AnimatedExtrusionState||(t.AnimatedExtrusionState={}));t.AnimatedExtrusionHandler=class{constructor(e){this.m_mapView=e,this.enabled=!0,this.duration=750,this.m_minZoomLevel=1,this.m_forceEnabled=!1,this.m_dataSourceMap=new Map,this.m_state=o.None,this.m_startTime=-1}get forceEnabled(){return this.m_forceEnabled}set forceEnabled(e){this.m_forceEnabled=e,this.duration=750}get minZoomLevel(){return this.m_minZoomLevel}setAnimationProperties(e,t){if(!n.isExtrudedPolygonTechnique(e))return!1;if(e.hasOwnProperty("minZoomLevel")&&(this.m_minZoomLevel=e.minZoomLevel),this.forceEnabled)return this.enabled;void 0!==e.animateExtrusionDuration&&(this.duration=e.animateExtrusionDuration);const i=n.getPropertyValue(e.animateExtrusion,t);return null===i?this.enabled:"boolean"==typeof i?i:"number"==typeof i&&0!==i}update(e){const t=this.m_dataSourceMap.size>0&&e>=this.m_minZoomLevel;this.m_state===o.None&&t?this.m_state=o.Started:this.m_state===o.None||t||this.resetAnimation(!0),this.animateExtrusion()}add(e,t){e.addDisposeCallback(this.removeTile.bind(this));let i=!1;this.m_state!==o.None&&(i=this.skipAnimation(e),i?this.setTileExtrusionRatio(t,1):this.m_state===o.Finished&&this.resetAnimation(!1)),this.getOrCreateTileMap(e.dataSource).set(e.tileKey.mortonCode(),{materials:t,animated:i})}get isAnimating(){return this.m_state!==o.Finished&&this.m_state!==o.None}getTileMap(e,t=!1){return this.m_dataSourceMap.get(e)}getOrCreateTileMap(e){let t=this.m_dataSourceMap.get(e);return t||(t=new Map,this.m_dataSourceMap.set(e,t)),t}skipAnimation(e){return this.wasAnyAncestorAnimated(e)||this.wasAnyDescendantAnimated(e)}wasAnyAncestorAnimated(e){var t,i;const n=e.dataSource.getDataZoomLevel(this.m_minZoomLevel),r=Math.max(0,e.tileKey.level-n),s=Math.min(r,this.m_mapView.visibleTileSet.options.quadTreeSearchDistanceUp),o=this.getTileMap(e.dataSource);if(!o)return!1;let a=e.tileKey;for(let e=1;e<=s;++e)if(a=a.parent(),null!==(i=null===(t=o.get(a.mortonCode()))||void 0===t?void 0:t.animated)&&void 0!==i&&i)return!0;return!1}wasAnyDescendantAnimated(e){var t,i;const n=e.dataSource.maxDataLevel-e.tileKey.level,r=Math.min(n,this.m_mapView.visibleTileSet.options.quadTreeSearchDistanceDown),s=this.getTileMap(e.dataSource);if(!s)return!1;const o=e.dataSource.getTilingScheme();let a=[e.tileKey],l=[];for(let e=1;e<=r;++e){l.length=0;for(const e of a)for(const n of o.getSubTileKeys(e)){if(null!==(i=null===(t=s.get(n.mortonCode()))||void 0===t?void 0:t.animated)&&void 0!==i&&i)return!0;l.push(n)}[a,l]=[l,a]}return!1}removeTile(e){const t=this.getTileMap(e.dataSource);t&&(t.delete(e.tileKey.mortonCode()),0===t.size&&this.m_dataSourceMap.delete(e.dataSource))}animateExtrusion(){if(this.m_state!==o.Started)return;const e=Date.now();this.m_startTime<0&&(this.m_startTime=e);const t=this.duration,i=Math.min(e-this.m_startTime,t),n=s.MathUtils.easeInOutCubic(r.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN,r.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX,i/t);this.setExtrusionRatio(n),i>=t&&(this.m_state=o.Finished),this.m_mapView.update()}resetAnimation(e){this.m_state=o.None,this.m_startTime=-1,e&&this.m_dataSourceMap.forEach(e=>{e.forEach(e=>{e.animated=!1})})}setExtrusionRatio(e){this.m_dataSourceMap.forEach(t=>{t.forEach(t=>{t.animated||(this.setTileExtrusionRatio(t.materials,e),e>=1&&(t.animated=!0))})})}setTileExtrusionRatio(e,t){e.forEach(e=>{e.extrusionRatio=t})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleChannel=void 0;t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const n=i(57);t.Logger=class{constructor(e,t,i){this.name=e,this.m_channel=t,this.enabled=!0,this.level=n.LogLevel.Trace,void 0!==i&&this.update(i)}error(e,...t){this.enabled&&this.level<=n.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=n.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=n.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=n.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=n.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=n.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+":"}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerChannel=t.WORKERCHANNEL_MSG_TYPE=void 0;const n=i(57);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message";t.WorkerChannel=class{error(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Error};self.postMessage(r)}debug(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Debug};self.postMessage(r)}info(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Info};self.postMessage(r)}log(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Log};self.postMessage(r)}trace(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Trace};self.postMessage(r)}warn(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Warn};self.postMessage(r)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils=void 0,function(e){function t(e,t,i){return e<t?t:e>i?i:e}e.clamp=t,e.smoothStep=function(e,i,n){return(n=t((n-e)/(i-e),0,1))*n*(3-2*n)},e.smootherStep=function(e,i,n){return(n=t((n-e)/(i-e),0,1))*n*n*(n*(6*n-15)+10)},e.map=function(e,t,i,n,r){return(e-t)*(r-n)/(i-t)+n},e.min2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.min(i,t)),i},e.max2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.max(i,t)),i},e.isClamped=function(e,t,i){return!(void 0!==t&&e<t)&&!(void 0!==i&&e>i)},e.easeInOutCubic=function(e,t,i){return e+(t-e)*(i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1)}}(t.MathUtils||(t.MathUtils={}))},function(e,t,i){"use strict";var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.isTextureBuffer=t.PlacementToken=t.transientToPickability=t.Pickability=t.PoiStackMode=t.TextureCoordinateType=t.GeometryKindSet=t.GeometryKind=t.StandardGeometryKind=void 0,function(e){e.All="_all_",e.Background="background",e.Terrain="terrain",e.Area="area",e.Line="line",e.Water="water",e.Border="border",e.Road="road",e.Building="building",e.Label="label",e.Detail="detail"}(n=t.StandardGeometryKind||(t.StandardGeometryKind={})),t.GeometryKind=n;class s extends Set{isSuperset(e){for(const t of e)if(!this.has(t))return!1;return!0}hasIntersection(e){for(const t of e)if(this.has(t))return!0;return!1}hasOrIntersects(e){return e instanceof Set?this.hasIntersection(e):this.has(e)}hasOrIntersectsArray(e){for(const t of e)if(this.has(t))return!0;return!1}}t.GeometryKindSet=s,function(e){e.TileSpace="tile-space",e.EquirectangularSpace="equirectangular-space",e.FeatureSpace="feature-space"}(t.TextureCoordinateType||(t.TextureCoordinateType={})),function(e){e.Show="show-in-stack",e.Hide="hide-in-stack",e.ShowParent="show-parent"}(t.PoiStackMode||(t.PoiStackMode={})),function(e){e.onlyVisible="only-visible",e.transient="transient",e.all="all"}(r=t.Pickability||(t.Pickability={})),t.transientToPickability=function(e){let t=r.onlyVisible;return null!=e&&(t="string"==typeof e?e:!0===e?r.transient:r.onlyVisible),t},function(e){e.TopLeft="TL",e.Top="T",e.TopRight="TR",e.Right="R",e.BottomRight="BR",e.Bottom="B",e.BottomLeft="BL",e.Left="L",e.Center="C",e.NorthWest="NW",e.North="N",e.NorthEast="NE",e.East="E",e.SouthEast="SE",e.South="S",e.SouthWest="SW",e.West="W"}(t.PlacementToken||(t.PlacementToken={})),t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.type}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isJsonExprReference=void 0,t.isJsonExprReference=function(e){return Array.isArray(e)&&2===e.length&&"ref"===e[0]&&"string"==typeof e[1]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPropertyValue=void 0;const n=i(1),r=i(6),s=i(61),o=i(42),a=i(43),l=n.LoggerManager.instance.create("PropertyValue");t.getPropertyValue=function(e,t,i){var n,c,h;if(r.Expr.isExpr(e))try{let a=e.evaluate(t,r.ExprScope.Dynamic,i);return"string"==typeof a&&(a=null!==(c=null!==(n=o.RGBA.parse(a))&&void 0!==n?n:s.Pixels.parse(a))&&void 0!==c?c:a),a instanceof o.RGBA?a.getHex():a instanceof s.Pixels?a.value*(null!==(h=Number(t.lookup("$pixelToMeters")))&&void 0!==h?h:1):a}catch(t){return l.error("failed to evaluate expression",JSON.stringify(e),"error",String(t)),null}if(null==e)return null;if("string"!=typeof e)return e;{const i=t.lookup("$pixelToMeters")||1,n=a.parseStringEncodedNumeral(e,i);return void 0!==n?n:e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scaleHeight=t.getFeatureText=t.getFeatureName=t.getFeatureId=t.getProjectionName=t.getProjection=t.GeometryType=t.getArrayConstructor=void 0;const n=i(2),r=i(6),s=i(108),o=i(63);function a(e,t,i,n,r){var s;let o;if(void 0===t&&(t="name"),i){const i=e.lookup(t+":short");if("string"==typeof i&&i.length>0)return i}if(n){const t=e.lookup("iso_code");if("string"==typeof t&&t.length>0)return t}if(void 0!==r)for(const i of r)if(o=null!==(s=e.lookup(`${t}:${i}`))&&void 0!==s?s:e.lookup(`${t}_${i}`),"string"==typeof o&&o.length>0)return o;if(o=e.lookup(t),"string"==typeof o)return o}t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array}},function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.SolidLine=3]="SolidLine",e[e.Text=4]="Text",e[e.TextPath=5]="TextPath",e[e.ExtrudedLine=6]="ExtrudedLine",e[e.Polygon=7]="Polygon",e[e.ExtrudedPolygon=8]="ExtrudedPolygon",e[e.Object3D=9]="Object3D",e[e.Other=1e3]="Other"}(t.GeometryType||(t.GeometryType={})),t.getProjection=function(e){switch(e){case"mercator":return n.mercatorProjection;case"webMercator":return n.webMercatorProjection;case"sphere":return n.sphereProjection;case"normalizedEquirectangular":return n.normalizedEquirectangularProjection;case"equirectangular":return n.equirectangularProjection;default:throw new Error("Unknown projection "+e)}},t.getProjectionName=function(e){if(e===n.mercatorProjection)return"mercator";if(e===n.webMercatorProjection)return"webMercator";if(e===n.sphereProjection)return"sphere";if(e===n.normalizedEquirectangularProjection)return"normalizedEquirectangular";if(e===n.equirectangularProjection)return"equirectangular";throw new Error("Unknown projection")},t.getFeatureId=function(e){if(void 0===e)return 0;if("string"==typeof e||"number"==typeof e)return e;if(e.hasOwnProperty("$id")){const t=e.$id;if("string"==typeof t||"number"==typeof t)return t}return 0},t.getFeatureName=a,t.getFeatureText=function(e,t,i){let n,l;const c=e instanceof r.Env?e:e.env;let h="name";if(o.isTextTechnique(t)||o.isPoiTechnique(t)||o.isLineMarkerTechnique(t)){if(void 0!==t.text)return s.evaluateTechniqueAttr(e,t.text);if(void 0!==t.label&&(h=s.evaluateTechniqueAttr(e,t.label),"string"!=typeof h))return;n=t.useAbbreviation,l=t.useIsoCode}return a(c,h,n,l,i)},t.scaleHeight=function(e,t,i){return!s.evaluateTechniqueAttr(e,t.constantHeight,i<12)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateTechniqueAttr=void 0;const n=i(6),r=i(106);t.evaluateTechniqueAttr=function(e,t,i){if(void 0===t)return i;const s=n.Env.isEnv(e)?r.getPropertyValue(t,e):r.getPropertyValue(t,e.env,e.cachedExprResults);return null!=s?s:i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFeatureGeometry=void 0,t.isFeatureGeometry=function(e){const t=e.type;return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyMaterial=t.CopyShader=void 0;const n=i(0);t.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform float opacity;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        gl_FragColor = opacity * texel;\n    }"};class r extends n.ShaderMaterial{constructor(e){super({name:"CopyMaterial",uniforms:e,vertexShader:t.CopyShader.vertexShader,fragmentShader:t.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!1,blending:n.NoBlending,depthTest:!1,depthWrite:!1})}}t.CopyMaterial=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={atmosphere_vertex_utils:"\n\n    const float RayleighScaleDepth = 0.25;\n\n    struct AtmosphereColor\n    {\n        vec3 mie;\n        vec3 rayleigh;\n    };\n\n    float scale(float cosAngle)\n    {\n        float x = 1.0 - cosAngle;\n        return RayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n    }\n\n    float getNearSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\n        // Solve simple square equation for the x0 (first point of intersection).\n#if defined(IMPROVE_INTERSECT_PRECISION)\n        // To improve precision instead of simple projection: b = 2.0 * dot(vPos, v3Ray),\n        // we change the equation that gives better results especially around the poles.\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\n#else\n        float fB = 2.0 * dot(v3Pos, v3Ray);\n#endif\n        float fC = fCameraHeight2 - fOuterRadius2;\n        // det = b^2 - 4*a*c, where a = 1\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\n        // Intersection points distances are defined as follows:\n        // x0 = (-b - sqrt(det)) / 2*a ^ x1 = (-b + sqrt(det)) / 2*a\n        // we search for x0:\n        return 0.5 * (-fB - sqrt(fDet));\n    }\n\n    float getFarSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\n        // Solve simple square equation for the x1 (second point of intersection).\n#if defined(IMPROVE_INTERSECT_PRECISION)\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\n#else\n        float fB = 2.0 * dot(v3Pos, v3Ray);\n#endif\n        float fC = fCameraHeight2 - fOuterRadius2;\n        // det = b^2 - 4*a*c, where a = 1\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\n        // Compute second intersection distance:\n        // x1 = (-b + sqrt(det)) / 2*a\n        return 0.5 * (-fB + sqrt(fDet));\n    }\n    ",atmosphere_fragment_utils:"\n\n    // Branch free RGB to HSV conversion.\n    // Based on article:\n    // http://lolengine.net/blog/2013/01/13/fast-rgb-to-hsv\n    // and optimized OpenGL SL algorithm\n    // http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl\n    vec3 rgb2Hsv(vec3 c)\n    {\n        const vec4 RGB_HSV_CONV = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        // Ternary operator may be used explicitly if compiler can use fast conditional move.\n        // vec4 p = c.g < c.b ? vec4(c.bg, RGB_HSV_CONV.wz) : vec4(c.gb, RGB_HSV_CONV.xy);\n        vec4 p = mix(vec4(c.bg, RGB_HSV_CONV.wz), vec4(c.gb, RGB_HSV_CONV.xy), step(c.b, c.g));\n        // vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n    }\n\n    // Branch free HSV to RGB conversion\n    vec3 hsv2Rgb(vec3 c)\n    {\n        const vec4 HSV_RGB_CONV = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + HSV_RGB_CONV.xyz) * 6.0 - HSV_RGB_CONV.www);\n        return c.z * mix(HSV_RGB_CONV.xxx, clamp(p - HSV_RGB_CONV.xxx, 0.0, 1.0), c.y);\n    }\n\n    vec3 correctExposure(vec3 rgb, float exposure)\n    {\n        const vec3 fullColor = vec3(1.0);\n        return fullColor - exp(-exposure * rgb);\n    }\n\n    vec3 correctColor(vec3 rgb, vec3 hsvShift)\n    {\n        const float e = 0.0000001;\n        // Convert rgb color to hsv\n        vec3 hsv = rgb2Hsv(rgb);\n        // Shift hue value with angle wrapping\n        hsv.x = mod(hsv.x + hsvShift.x, 1.0);\n        // Shift and clamp saturation\n        hsv.y = clamp(hsv.y + hsvShift.y, 0.0, 1.0);\n        // Change value if it is significant (greater then epsilon)\n        hsv.z = hsv.z > e ? clamp(hsv.z + hsvShift.z, 0.0, 1.0) : 0.0;\n        // Convert shifted hsv back to rgb\n        return hsv2Rgb(hsv);\n    }\n    "}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoundsGenerator=void 0;const n=i(2),r=i(265),s=i(315);t.BoundsGenerator=class{constructor(e){this.m_view=e,this.createViewBounds()}generate(){return this.m_view.projection!==this.m_viewBounds.projection&&this.createViewBounds(),this.m_viewBounds.generate()}createViewBounds(){this.m_viewBounds=this.m_view.projection.type===n.ProjectionType.Planar?new r.PlaneViewBounds(this.m_view.camera,this.m_view.projection,this.m_view):new s.SphereViewBounds(this.m_view.camera,this.m_view.projection)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Object3DUtils=void 0;const n=i(4),r=i(1),s=i(0),o=i(24),a=r.LoggerManager.instance.create("Object3DUtils");!function(e){function t(e,t,i){if(null==e||void 0===e.image||null===e.image)return;if(void 0!==e.uuid&&!0===i.get(e.uuid))return;i.set(e.uuid,!0);const n=e.image,r=4*n.width*n.height;t.heapSize+=r,t.gpuSize+=r}function i(e,i,r){if(void 0===e.uuid||!0!==r.get(e.uuid))if(r.set(e.uuid,!0),e instanceof s.RawShaderMaterial||e instanceof s.ShaderMaterial){const n=e;for(const e in n.uniforms)if(void 0!==n.uniforms[e]){const o=n.uniforms[e];o instanceof s.Texture&&t(o,i,r)}}else if(e instanceof s.MeshBasicMaterial||e instanceof n.MapMeshBasicMaterial){const n=e;t(n.map,i,r),t(n.aoMap,i,r),t(n.specularMap,i,r),t(n.alphaMap,i,r),t(n.envMap,i,r)}else if(e instanceof n.MapMeshStandardMaterial){const n=e;t(n.map,i,r),t(n.lightMap,i,r),t(n.aoMap,i,r),t(n.emissiveMap,i,r),t(n.bumpMap,i,r),t(n.normalMap,i,r),t(n.displacementMap,i,r),t(n.roughnessMap,i,r),t(n.metalnessMap,i,r),t(n.alphaMap,i,r),t(n.envMap,i,r)}else e instanceof s.LineBasicMaterial||e instanceof s.LineDashedMaterial||e instanceof s.PointsMaterial||a.warn("estimateMeshSize: unidentified material: ",e)}function r(e,t,i,n){if(void 0===e.uuid&&(e.uuid=s.MathUtils.generateUUID()),!0===n.get(e.uuid))return;n.set(e.uuid,!0);let r=0,o=4;void 0!==e.array.BYTES_PER_ELEMENT&&(o=e.array.BYTES_PER_ELEMENT),e instanceof s.InterleavedBufferAttribute||e instanceof s.BufferAttribute?r=o*e.count*e.itemSize:a.warn("estimateMeshSize: unidentified attribute: ",t),i.heapSize+=r+56,i.gpuSize+=r}function l(e,t,i){if(!(void 0===e.uuid||!0!==i.get(e.uuid)))return;if(i.set(e.uuid,!0),void 0===e)return;const n=e.attributes;if(void 0!==n){for(const e in n)void 0!==n[e]&&r(n[e],e,t,i);null!==e.index&&r(e.index,"index",t,i)}else a.warn("estimateGeometrySize: unidentified geometry: ",e)}e.estimateSize=function e(t,n,r){const c=void 0!==n?n:{heapSize:0,gpuSize:0};if(void 0===r&&(r=new Map),function(e,t,n){if(e.isObject3D&&!(e instanceof s.Scene)&&(void 0===e.uuid||!0!==n.get(e.uuid)))if(n.set(e.uuid,!0),e.isMesh||e.isLine||e.isPoints){let r=1e3;const s=0,a=e;if(void 0!==a.material)if(Array.isArray(a.material)){const e=a.material;for(const r of e)i(r,t,n)}else{i(a.material,t,n)}if(void 0!==a.geometries)for(const e of a.geometries)l(e,t,n);else void 0!==a.geometry&&l(a.geometry,t,n);const c=void 0!==e.userData?e.userData.feature:void 0;void 0!==c&&(r+=o.getFeatureDataSize(c)),t.heapSize+=r,t.gpuSize+=s}else a.warn("estimateMeshSize: unidentified object",e)}(t,c,r),t.children.length>0)for(const i of t.children)e(i,c,r);return c}}(t.Object3DUtils||(t.Object3DUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LodMesh=void 0;const n=i(0);class r extends n.Mesh{constructor(e,t){super(void 0,t),this.geometries=e}set geometries(e){this.m_geometries!==e&&this.disposeGeometries(),this.m_geometries=e,this.geometries&&this.m_geometries.length>0&&(this.geometry=this.m_geometries[0])}get geometries(){return this.m_geometries}setLevelOfDetail(e){this.m_geometries&&0!==this.m_geometries.length&&(e=n.MathUtils.clamp(e,0,this.m_geometries.length-1),this.geometry=this.m_geometries[e])}disposeGeometries(){if(this.m_geometries)for(const e of this.m_geometries)e.dispose();this.geometry.dispose()}}t.LodMesh=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprPool=void 0;const n=i(6);t.ExprPool=class{constructor(){this.m_booleanLiterals=new Map,this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiterals=new Map,this.m_arrayLiterals=[],this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_matchExprs=[],this.m_caseExprs=[],this.m_interpolateExprs=[],this.m_stepExprs=[],this.m_callExprs=new Map}add(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return n.NullLiteralExpr.instance}visitBooleanLiteralExpr(e,t){const i=this.m_booleanLiterals.get(e.value);return i||(this.m_booleanLiterals.set(e.value,e),e)}visitNumberLiteralExpr(e,t){const i=this.m_numberLiterals.get(e.value);return i||(this.m_numberLiterals.set(e.value,e),e)}visitStringLiteralExpr(e,t){const i=this.m_stringLiterals.get(e.value);return i||(this.m_stringLiterals.set(e.value,e),e)}visitObjectLiteralExpr(e,t){const i=this.m_objectLiterals.get(e.value);if(i)return i;if(Array.isArray(e.value)){const t=e.value,i=this.m_arrayLiterals.find(e=>{const i=e.value;return i.length===t.length&&t.every((e,t)=>e===i[t])});if(void 0!==i)return i;this.m_arrayLiterals.push(e)}return this.m_objectLiterals.set(e.value,e),e}visitVarExpr(e,t){const i=this.m_varExprs.get(e.name);return i||(this.m_varExprs.set(e.name,e),e)}visitHasAttributeExpr(e,t){const i=this.m_hasAttributeExprs.get(e.name);return i||(this.m_hasAttributeExprs.set(e.name,e),e)}visitMatchExpr(e,t){const i=e.value.accept(this,t),r=e.branches.map(([e,i])=>[e,i.accept(this,t)]),s=e.fallback.accept(this,t);for(const e of this.m_matchExprs){if(e.value!==i)continue;if(e.fallback!==s)continue;if(e.branches.length!==r.length)continue;let t=!0;for(let i=0;i<r.length;i++)if(r[i][0]!==e.branches[i][0]||r[i][1]!==e.branches[i][1]){t=!1;break}if(t)return e}const o=new n.MatchExpr(i,r,s);return this.m_matchExprs.push(o),o}visitCaseExpr(e,t){const i=e.branches.map(([e,i])=>[e.accept(this,t),i.accept(this,t)]),r=e.fallback.accept(this,t);for(const e of this.m_caseExprs){if(e.fallback!==r)continue;if(e.branches.length!==i.length)continue;let t=!0;for(let n=0;n<i.length;n++)if(i[n][0]!==e.branches[n][0]||i[n][1]!==e.branches[n][1]){t=!1;break}if(t)return e}const s=new n.CaseExpr(i,r);return this.m_caseExprs.push(s),s}visitCallExpr(e,t){const i=e.args.map(e=>e.accept(this,t));this.m_callExprs.has(e.op)||this.m_callExprs.set(e.op,[]);const r=this.m_callExprs.get(e.op);for(const e of r){if(e.args.length!==i.length)continue;let t=0;for(;t<e.args.length&&e.args[t]===i[t];++t);if(t===e.args.length)return e}const s=new n.CallExpr(e.op,i);return s.descriptor=e.descriptor,r.push(s),s}visitStepExpr(e,t){if(this.m_stepExprs.includes(e))return e;const i=e.input.accept(this,t),r=e.defaultValue.accept(this,t),s=e.stops.map(e=>{const i=e[0],n=e[1].accept(this,t);return n===e[1]?e:[i,n]});for(const e of this.m_stepExprs)if(e.input===i&&e.defaultValue===r&&s.length===e.stops.length&&s.every(([t,i],n)=>t===e.stops[n][0]&&i===e.stops[n][1]))return e;const o=new n.StepExpr(i,r,s);return this.m_stepExprs.push(o),o}visitInterpolateExpr(e,t){if(this.m_interpolateExprs.includes(e))return e;const i=e.input.accept(this,t),r=e.stops.map(e=>{const i=e[0],n=e[1].accept(this,t);return n===e[1]?e:[i,n]});for(const t of this.m_interpolateExprs)if(t.input===i&&t.mode[0]===e.mode[0]&&t.mode[1]===e.mode[1]&&r.length===t.stops.length&&r.every(([e,i],n)=>e===t.stops[n][0]&&i===t.stops[n][1]))return t;const s=new n.InterpolateExpr(e.mode,i,r);return this.m_interpolateExprs.push(s),s}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeLengthGeometrySubdivisionModifier=t.SubdivisionMode=void 0;const n=i(2),r=i(1),s=i(0),o=i(117),a=[new s.Vector3,new s.Vector3];var l;!function(e){e[e.All=0]="All",e[e.NoDiagonals=1]="NoDiagonals"}(l=t.SubdivisionMode||(t.SubdivisionMode={}));class c extends o.SubdivisionModifier{constructor(e,t,i=l.All,s){super(),this.subdivision=e,this.geoBox=t,this.subdivisionMode=i,this.projection=s,r.assert(s.type===n.ProjectionType.Planar,"EdgeLengthGeometrySubdivisionModifier only supports planar projections");const o=s.projectPoint(t.northEast,a[0]),c=s.projectPoint(t.southWest,a[1]);this.m_projectedBox={min:{x:Math.min(o.x,c.x),y:Math.min(o.y,c.y),z:Math.min(o.z,c.z)},max:{x:Math.max(o.x,c.x),y:Math.max(o.y,c.y),z:Math.max(o.z,c.z)}},this.m_maxLengthX=(this.m_projectedBox.max.x-this.m_projectedBox.min.x)/e,this.m_maxLengthY=(this.m_projectedBox.max.y-this.m_projectedBox.min.y)/e,this.subdivisionMode===l.All&&(this.m_maxLengthX*=1.1,this.m_maxLengthY*=1.1),this.m_maxLength=Math.sqrt(this.m_maxLengthX*this.m_maxLengthX+this.m_maxLengthY*this.m_maxLengthY)}get maxLength(){return this.m_maxLength}get maxLengthX(){return this.m_maxLengthX}get maxLengthY(){return this.m_maxLengthY}shouldSplitTriangle(e,t,i){const n=this.shouldSplitEdge(e,t),r=this.shouldSplitEdge(t,i),s=this.shouldSplitEdge(i,e);if(!(n||r||s))return;const o=e.distanceTo(t),a=t.distanceTo(i),l=i.distanceTo(e),c=Math.max(n?o:0,r?a:0,s?l:0);if(o===c)return 0;if(a===c)return 1;if(l===c)return 2;throw new Error("Could not split triangle.")}shouldSplitEdge(e,t){switch(this.subdivisionMode){case l.All:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY||e.distanceTo(t)>this.m_maxLength;case l.NoDiagonals:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY}}}t.EdgeLengthGeometrySubdivisionModifier=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubdivisionModifier=void 0;const n=i(0),r=new n.Vector3,s=new n.Vector3,o=new n.Vector3;t.SubdivisionModifier=class{constructor(){}modify(e){const t=e.getAttribute("position"),i=Array.from(t.array),n=e.getAttribute("uv"),a=void 0!==n?Array.from(n.array):void 0,l=e.getAttribute("edge"),c=void 0!==l?Array.from(l.array):void 0,h=e.getAttribute("wall"),u=void 0!==h?Array.from(h.array):void 0,d=e.getIndex(),m=Array.from(d.array),p=new Map;function f(e,t){const n=`${Math.min(e,t)}_${Math.max(e,t)}`,l=p.get(n);if(void 0!==l)return l;r.set(i[3*e],i[3*e+1],i[3*e+2]),s.set(i[3*t],i[3*t+1],i[3*t+2]),o.lerpVectors(r,s,.5);const h=i.length/3;return i.push(...o.toArray()),p.set(n,h),void 0!==a&&(r.set(a[2*e],a[2*e+1],0),s.set(a[2*t],a[2*t+1],0),o.lerpVectors(r,s,.5),a.push(o.x,o.y)),void 0!==c&&(c[e]===t?(c.push(t),c[e]=h):c[t]===e?(c.push(e),c[t]=h):c.push(-1)),void 0!==u&&(u[e]===t?(u.push(t),u[e]=h):u[t]===e?(u.push(e),u[t]=h):u.push(-1)),h}const g=[];for(;m.length>=3;){const e=m.shift(),t=m.shift(),n=m.shift();r.set(i[3*e],i[3*e+1],i[3*e+2]),s.set(i[3*t],i[3*t+1],i[3*t+2]),o.set(i[3*n],i[3*n+1],i[3*n+2]);switch(this.shouldSplitTriangle(r,s,o)){case 0:{const i=f(e,t);m.push(e,i,n,i,t,n);break}case 1:{const i=f(t,n);m.push(e,t,i,e,i,n);break}case 2:{const i=f(n,e);m.push(e,t,i,i,t,n);break}case void 0:g.push(e,t,n);break;default:throw new Error("failed to subdivide the given geometry")}}return t.array=t.array instanceof Float32Array?new Float32Array(i):new Float64Array(i),t.count=i.length/t.itemSize,t.needsUpdate=!0,e.setIndex(g),void 0!==a&&(n.array=new Float32Array(a),n.count=a.length/n.itemSize,n.needsUpdate=!0),void 0!==c&&(l.array=new Float32Array(c),l.count=c.length/l.itemSize,l.needsUpdate=!0),e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphericalGeometrySubdivisionModifier=void 0;const n=i(2),r=i(0),s=i(117),o=[new r.Vector3,new r.Vector3,new r.Vector3];class a extends s.SubdivisionModifier{constructor(e,t=n.sphereProjection){super(),this.angle=e,this.projection=t}shouldSplitTriangle(e,t,i){const r=n.sphereProjection.reprojectPoint(this.projection,e,o[0]),s=n.sphereProjection.reprojectPoint(this.projection,t,o[1]),a=n.sphereProjection.reprojectPoint(this.projection,i,o[2]),l=r.angleTo(s),c=s.angleTo(a),h=a.angleTo(r),u=Math.max(l,Math.max(c,h));if(!(u<this.angle)){if(u===l)return 0;if(u===c)return 1;if(u===h)return 2;throw new Error("failed to split triangle")}}}t.SphericalGeometrySubdivisionModifier=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerTileObject=void 0;const n=i(33);t.registerTileObject=function(e,t,i,r){const s=i instanceof Set?Array.from(i.values()):Array.isArray(i)?i:[i];n.MapObjectAdapter.create(t,Object.assign({dataSource:e.dataSource,kind:s,level:e.tileKey.level},r)),void 0===t.userData&&(t.userData={});const o=t.userData;o.tileKey=e.tileKey,o.dataSource=e.dataSource.name,o.kind=s,e.resetVisibilityCounter()}},function(e,t,i){"use strict";var n;function r(...e){const t={attrDescriptors:{}};for(const i of e)void 0!==i.attrTransparencyColor&&(t.attrTransparencyColor=i.attrTransparencyColor),void 0!==i.attrDescriptors&&(t.attrDescriptors=Object.assign(Object.assign({},t.attrDescriptors),i.attrDescriptors));return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getTechniqueAutomaticAttrs=t.getTechniqueAttributeDescriptor=t.getTechniqueDescriptor=t.AttrScope=void 0,function(e){e[e.FeatureGeometry=0]="FeatureGeometry",e[e.TechniqueGeometry=1]="TechniqueGeometry",e[e.TechniqueRendering=2]="TechniqueRendering"}(n=t.AttrScope||(t.AttrScope={}));const s={attrTransparencyColor:"color",attrDescriptors:{constantHeight:n.FeatureGeometry,enabled:n.FeatureGeometry,fadeFar:n.TechniqueRendering,fadeNear:n.TechniqueRendering,transparent:{scope:n.TechniqueRendering,automatic:!0},side:{scope:n.TechniqueRendering,automatic:!0}}},o=r(s,{attrDescriptors:{color:{scope:n.TechniqueRendering,automatic:!0},size:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0}}}),a=r(s,o),l=r(s,o),c=r(s,{attrDescriptors:{text:n.FeatureGeometry,label:n.FeatureGeometry,useAbbreviation:n.FeatureGeometry,useIsoCode:n.FeatureGeometry,poiName:n.FeatureGeometry,imageTexture:n.FeatureGeometry,iconColor:n.TechniqueRendering,iconBrightness:n.TechniqueRendering,backgroundColor:n.TechniqueRendering,backgroundSize:n.TechniqueRendering,backgroundOpacity:n.TechniqueRendering,color:n.TechniqueRendering,opacity:n.TechniqueRendering,size:n.TechniqueRendering}}),h={attrDescriptors:{polygonOffset:{scope:n.TechniqueRendering,automatic:!0},polygonOffsetFactor:{scope:n.TechniqueRendering,automatic:!0},polygonOffsetUnits:{scope:n.TechniqueRendering,automatic:!0},depthTest:{scope:n.TechniqueRendering,automatic:!0},transparent:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0},color:{scope:n.TechniqueRendering,automatic:!0},lineColor:n.TechniqueRendering,lineFadeFar:n.TechniqueRendering,lineFadeNear:n.TechniqueRendering}},u=r(s,h,{attrDescriptors:{lineWidth:n.TechniqueRendering,secondaryWidth:n.TechniqueRendering,secondaryColor:n.TechniqueRendering,dashSize:n.TechniqueRendering,gapSize:n.TechniqueRendering,outlineColor:{scope:n.TechniqueRendering,automatic:!0},caps:{scope:n.TechniqueRendering,automatic:!0},drawRangeStart:{scope:n.TechniqueRendering,automatic:!0},drawRangeEnd:{scope:n.TechniqueRendering,automatic:!0},dashes:{scope:n.TechniqueRendering,automatic:!0},dashColor:{scope:n.TechniqueRendering,automatic:!0}}}),d=r(s,{attrDescriptors:{color:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0},lineWidth:n.FeatureGeometry}}),m=r(s,h,{attrDescriptors:{wireframe:{scope:n.TechniqueRendering,automatic:!0},color:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0},transparent:{scope:n.TechniqueRendering,automatic:!0},lineWidth:n.TechniqueRendering,map:{scope:n.TechniqueRendering,automatic:!0}}}),p=r(s,{attrDescriptors:{color:{scope:n.TechniqueRendering,automatic:!0},vertexColors:{scope:n.TechniqueRendering,automatic:!0},wireframe:{scope:n.TechniqueRendering,automatic:!0},roughness:{scope:n.TechniqueRendering,automatic:!0},metalness:{scope:n.TechniqueRendering,automatic:!0},alphaTest:{scope:n.TechniqueRendering,automatic:!0},depthTest:{scope:n.TechniqueRendering,automatic:!0},transparent:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0},emissive:{scope:n.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:n.TechniqueRendering,automatic:!0},refractionRatio:{scope:n.TechniqueRendering,automatic:!0},normalMapType:{scope:n.TechniqueRendering,automatic:!0},map:{scope:n.TechniqueRendering,automatic:!0},normalMap:{scope:n.TechniqueRendering,automatic:!0},displacementMap:{scope:n.TechniqueRendering,automatic:!0},roughnessMap:{scope:n.TechniqueRendering,automatic:!0},emissiveMap:{scope:n.TechniqueRendering,automatic:!0},bumpMap:{scope:n.TechniqueRendering,automatic:!0},metalnessMap:{scope:n.TechniqueRendering,automatic:!0},alphaMap:{scope:n.TechniqueRendering,automatic:!0}}}),f={"extruded-polygon":r(s,p,{attrDescriptors:{height:n.FeatureGeometry,floorHeight:n.FeatureGeometry,color:n.FeatureGeometry,defaultColor:n.FeatureGeometry,defaultHeight:n.FeatureGeometry,boundaryWalls:n.FeatureGeometry,footprint:n.FeatureGeometry,maxSlope:n.FeatureGeometry,animateExtrusion:n.TechniqueRendering,lineWidth:n.TechniqueRendering,lineFadeNear:n.TechniqueRendering,lineFadeFar:n.TechniqueRendering,lineColor:n.TechniqueRendering}}),"line-marker":c,"labeled-icon":c,"solid-line":u,"dashed-line":u,terrain:p,standard:p,squares:a,circles:l,line:d,segments:d,fill:m,text:r(s,{attrDescriptors:{text:n.FeatureGeometry,label:n.FeatureGeometry,useAbbreviation:n.FeatureGeometry,useIsoCode:n.FeatureGeometry,backgroundColor:n.TechniqueRendering,backgroundSize:n.TechniqueRendering,backgroundOpacity:n.TechniqueRendering,color:n.TechniqueRendering,opacity:n.TechniqueRendering,priority:n.TechniqueRendering,size:n.TechniqueRendering}}),shader:r(s,{attrDescriptors:{params:n.TechniqueRendering}})};function g(e){return"string"!=typeof e&&(e=e.name),f[e]}t.getTechniqueDescriptor=g,t.getTechniqueAttributeDescriptor=function(e,t){const i=g(e),n=null==i?void 0:i.attrDescriptors,r=null==n?void 0:n[t];if(void 0!==typeof r)return"object"==typeof r?r:{scope:r}};const v=new Map;t.getTechniqueAutomaticAttrs=function(e){var t;if("string"!=typeof e&&(e=e.name),v.has(e))return v.get(e);const i=[],n=null===(t=g(e))||void 0===t?void 0:t.attrDescriptors;if(void 0===n)return i;for(const e in n){if(!n.hasOwnProperty(e))continue;const t=n[e];void 0!==t&&"number"!=typeof t&&(!0===t.automatic&&i.push(e))}return v.set(e,i),i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedBufferAttribute=void 0;const n=i(1),r=i(0),s=i(269);class o extends r.BufferAttribute{constructor(e,t,i,n){super(e.array,e.itemSize,e.normalized),this.originalAttribute=e,this.m_normals=t,this.m_uvs=i,this.m_textureWidth=0,this.m_textureHeight=0,this.m_cache=new s.VertexCache(o.MAX_CACHE_SIZE),this.m_lastPos=new r.Vector3,this.m_tmpNormal=new r.Vector3,this.resetTexture(n)}reset(e,t,i,n){this.array=e.array,this.itemSize=e.itemSize,this.count=this.array.length/this.itemSize,this.normalized=e.normalized,this.originalAttribute=e,this.m_normals=t,this.m_uvs=i,this.m_cache.clear(),this.m_lastBufferIndex=void 0,this.resetTexture(n)}getX(e){return this.getDisplacedCoordinate(e).x}getY(e){return this.getDisplacedCoordinate(e).y}getZ(e){return this.getDisplacedCoordinate(e).z}resetTexture(e){this.m_texture=new Float32Array(e.image.data.buffer),this.m_textureWidth=e.image.width,this.m_textureHeight=e.image.height}getDisplacedCoordinate(e){return e===this.m_lastBufferIndex?this.m_lastPos:(this.m_lastBufferIndex=e,this.m_cache.get(e,this.m_lastPos)||(this.displacePosition(e),this.m_cache.set(e,this.m_lastPos)),this.m_lastPos)}displacePosition(e){this.m_lastPos.fromBufferAttribute(this.originalAttribute,e);const t=this.m_normals;this.m_tmpNormal.fromBufferAttribute(t,e);const i=this.m_uvs,s=r.MathUtils.clamp(i.getX(e),0,1),o=r.MathUtils.clamp(i.getY(e),0,1),a=n.sampleBilinear(this.m_texture,this.m_textureWidth,this.m_textureHeight,s,o);this.m_lastPos.add(this.m_tmpNormal.multiplyScalar(a))}}t.DisplacedBufferAttribute=o,o.MAX_CACHE_SIZE=6},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedBufferGeometry=t.displaceBox=void 0;const n=i(0),r=i(121),s=new n.Vector3,o=new n.Vector3,a=new n.Box3;function l(e,t,i){a.copy(e);const n=s.copy(i),r=o.copy(n);return e.translate(n.multiplyScalar(t.min)).union(a.translate(r.multiplyScalar(t.max))),e}t.displaceBox=l;class c extends n.BufferGeometry{constructor(e,t,i,s){super(),this.originalGeometry=e,this.displacementRange=i,this.m_originalBoundingBox=new n.Box3,this.m_displacedPositions=s||new r.DisplacedBufferAttribute(e.attributes.position,e.attributes.normal,e.attributes.uv,t),this.resetAttributes()}reset(e,t,i){this.originalGeometry=e;const n=e.attributes.position,r=e.attributes.normal,s=e.attributes.uv;this.m_displacedPositions.reset(n,r,s,t);const o=this.displacementRange.min!==i.min||this.displacementRange.max!==i.max;this.displacementRange=i,this.resetAttributes(),this.resetBoundingVolumes(o)}computeBoundingBox(){null===this.originalGeometry.boundingBox&&this.originalGeometry.computeBoundingBox();const e=this.m_originalBoundingBox.copy(this.originalGeometry.boundingBox);null===this.boundingBox?this.boundingBox=e.clone():this.boundingBox.copy(e),l(this.boundingBox,this.displacementRange,s.fromBufferAttribute(this.attributes.normal,0))}computeBoundingSphere(){null===this.boundingBox&&this.computeBoundingBox(),null===this.boundingSphere&&(this.boundingSphere=new n.Sphere),this.boundingBox.getBoundingSphere(this.boundingSphere)}needsBoundingBoxUpdate(e){return e||null!==this.boundingBox&&(!this.originalGeometry.boundingBox||!this.m_originalBoundingBox.equals(this.originalGeometry.boundingBox))}resetBoundingVolumes(e){this.needsBoundingBoxUpdate(e)&&(this.computeBoundingBox(),this.boundingSphere&&this.computeBoundingSphere())}resetAttributes(){this.index=this.originalGeometry.index,this.groups=this.originalGeometry.groups,this.drawRange=this.originalGeometry.drawRange,this.attributes=Object.assign({},this.originalGeometry.attributes),this.attributes.position=this.m_displacedPositions}}t.DisplacedBufferGeometry=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLineMesh=void 0;const n=i(2),r=i(4),s=i(1),o=i(0),a=i(122),l=new o.Sphere,c=new o.Matrix4,h=new o.Ray,u=new o.Line3,d=new o.Box3,m=new n.OrientedBox3,p=new o.Plane,f=new o.Vector3,g=new o.Vector3,v=new o.Vector3,y=new o.Vector3;function _(e,t,i){let n;e instanceof a.DisplacedBufferGeometry&&(n=e.displacementRange,e=e.originalGeometry);const r=e.attributes.position,s=e.index.array,l=new o.Sphere,c=d.makeEmpty(),h=f;for(let e=t;e<i;e+=6)c.expandByPoint(h.fromBufferAttribute(r,s[e])),c.expandByPoint(h.fromBufferAttribute(r,s[e+2]));if(n){const t=g;return t.fromBufferAttribute(e.attributes.normal,0),a.displaceBox(c,n,t).getBoundingSphere(l)}return c.getBoundingSphere(l)}function x(e,t,i,n,r,s,a,l){if(a.equals(e.origin)&&0===e.direction.dot(s.normal)){const r=function(e,t,i,n,r){var s;const o=m;return t.getCenter(o.position),t.delta(o.xAxis).normalize(),o.yAxis.copy(i),o.zAxis.copy(n),o.extents.set(t.distance()/2,r,r),o.contains(e.origin)?0:null!==(s=o.intersectsRay(e))&&void 0!==s?s:1/0}(e,t,i,s.normal,n),a=function(e,t,i){const n=new o.Sphere(t.start,i),r=n.containsPoint(e.origin)?0:e.intersectSphere(n,y)?y.sub(e.origin).length():1/0;n.center.copy(t.end);const s=n.containsPoint(e.origin)?0:e.intersectSphere(n,y)?y.sub(e.origin).length():1/0;return Math.min(r,s)}(e,t,n),c=Math.min(r,a);return c!==1/0&&(e.at(c,l),!0)}return!(a.distanceToSquared(t.closestPointToPoint(a,!0,y))>r)&&(l.copy(a),!0)}function w(e,t,i,n,r,s,o,a,c,h){const d=f,m=p,y=g,_=u,w=e.geometry,b=w.attributes,M=b.position,T=b.bitangent,S=w.index.array;if(l.copy(c),l.applyMatrix4(e.matrixWorld),l.radius+=n,t.ray.intersectsSphere(l))for(let n=o;n<a;n+=6){const o=S[n],a=S[n+2];if(_.start.fromBufferAttribute(M,o),_.end.fromBufferAttribute(M,a),d.set(T.getX(o),T.getY(o),T.getZ(o)).normalize(),m.setFromCoplanarPoints(_.start,v.copy(_.start).add(d),_.end),0===m.normal.manhattanLength())continue;if(!i.intersectPlane(m,y))continue;const l=v;if(!x(i,_,d,r,s,m,y,l))continue;const c=l.applyMatrix4(e.matrixWorld),u=t.ray.origin.distanceTo(c);u<t.near||u>t.far||h.push({distance:u,point:c.clone(),index:n,object:e})}}const b=[0];function M(e,t,i,n,a,l,c){var h;const u=e.userData.feature.boundingVolumes;s.assert(e.geometry instanceof o.BufferGeometry,"Unsupported geometry type.");const d=e.geometry;s.assert(function(e){return Array.isArray(e)?e.every(e=>e instanceof r.SolidLineMaterial):e instanceof r.SolidLineMaterial}(t),"Unsupported material type");const m=t,p=(m.lineWidth+m.outlineWidth)/2;s.assert(Math.abs(1-e.scale.x/e.scale.y)<.01),s.assert(Math.abs(1-e.scale.x/e.scale.z)<.01),s.assert(Math.abs(1-e.scale.y/e.scale.z)<.01);const f=p/((e.scale.x+e.scale.y+e.scale.z)/3),g=f*f,v=null!==(h=e.userData.feature.starts)&&void 0!==h?h:b;let y=a,x=v[y];const M=v.length-1;for(;x<l;){const t=y,r=y<M?v[++y]:l;t>=u.length&&u.push(_(d,x,r)),w(e,i,n,p,f,g,x,r,u[t],c),x=r}return y}class T extends o.Mesh{static raycast(e,t,i){s.assert(e.geometry instanceof o.BufferGeometry,"Unsupported geometry type");const n=e.geometry;s.assert(null!==n.index,"Geometry does not have indices");const r=e.matrixWorld;c.copy(r).invert();const a=h.copy(t.ray).applyMatrix4(c);void 0===e.userData.feature&&(e.userData.feature={});const l=n.attributes.position,u=e.userData.feature.attributeInfo;(void 0===u||void 0===e.userData.feature.boundingVolumes||function(e,t){const i=!0===e.isBufferAttribute?e:e.data;return void 0===t||t.data!==i||e.isBufferAttribute&&t.version!==i.version}(l,u))&&(e.userData.feature.boundingVolumes=[],e.userData.feature.attributeInfo=function(e){const t=!0===e.isBufferAttribute?e:e.data;return{data:t,version:t.version}}(l));const d=n.index.array;if(Array.isArray(e.material)){let r=0;for(const s of n.groups){r=M(e,e.material[s.materialIndex],t,a,r,s.start+s.count,i)}}else M(e,e.material,t,a,0,d.length,i)}constructor(e,t){super(e,t)}raycast(e,t){T.raycast(this,e,t)}}t.SolidLineMesh=T},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLight=t.toTextureFilter=t.toWrappingMode=t.toTextureDataType=t.toPixelFormat=void 0;const n=i(0);t.toPixelFormat=function(e){switch(e){case"Alpha":return n.AlphaFormat;case"RGB":return n.RGBFormat;case"RGBA":return n.RGBAFormat;case"Luminance":return n.LuminanceFormat;case"LuminanceAlpha":return n.LuminanceAlphaFormat;case"RGBE":return n.RGBEFormat;case"Depth":return n.DepthFormat;case"DepthStencil":return n.DepthStencilFormat;case"Red":return n.RedFormat;default:throw new Error("invalid pixel format: "+e)}},t.toTextureDataType=function(e){switch(e){case"UnsignedByte":return n.UnsignedByteType;case"Byte":return n.ByteType;case"Short":return n.ShortType;case"UnsignedShort":return n.UnsignedShortType;case"Int":return n.IntType;case"UnsignedInt":return n.UnsignedIntType;case"Float":return n.FloatType;case"HalfFloat":return n.HalfFloatType;default:throw new Error("invalid texture data type: "+e)}},t.toWrappingMode=function(e){switch(e){case"clamp":return n.ClampToEdgeWrapping;case"repeat":return n.RepeatWrapping;case"mirror":return n.MirroredRepeatWrapping;default:throw new Error("invalid wrapping mode: "+e)}},t.toTextureFilter=function(e){switch(e){case"nearest":return n.NearestFilter;case"nearestMipMapNearest":return n.NearestMipMapNearestFilter;case"nearestMipMapLinear":return n.NearestMipMapLinearFilter;case"linear":return n.LinearFilter;case"linearMipMapNearest":return n.LinearMipMapNearestFilter;case"linearMipMapLinear":return n.LinearMipMapLinearFilter;default:throw new Error("invalid texture filter: "+e)}},t.createLight=function(e){switch(e.type){case"ambient":{const t=new n.AmbientLight(e.color,e.intensity);return t.name=e.name,t}case"directional":{const t=new n.DirectionalLight(e.color,e.intensity);return t.name=e.name,void 0!==e.castShadow&&(t.castShadow=e.castShadow),t.castShadow&&(t.shadow.bias=1e-5,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024),t.position.set(e.direction.x,e.direction.y,e.direction.z),t.position.normalize(),t}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraMovementDetector=void 0;const n=i(0),r=i(9);t.CameraMovementDetector=class{constructor(e,t,i){this.m_throttlingTimeout=e,this.m_movementStartedFunc=t,this.m_movementFinishedFunc=i,this.m_lastCameraPos=new n.Vector3,this.m_newCameraPos=new n.Vector3,this.m_throttlingTimerId=void 0,this.m_movementDetectorDeadline=0,this.onDeadlineTimer=()=>{this.m_throttlingTimerId=void 0;const e=performance.now();e>=this.m_movementDetectorDeadline?this.movementFinished():this.startMovementFinishedTimer(e)},void 0===this.m_throttlingTimeout&&(this.m_throttlingTimeout=300)}checkCameraMoved(e,t){const i=r.MapViewUtils.extractAttitude(e,e.camera),n=e.camera.getWorldPosition(this.m_newCameraPos);if(void 0===this.m_lastAttitude)return this.m_lastCameraPos.copy(n),this.m_lastAttitude=i,!1;const s=!this.m_lastCameraPos.equals(n)||i.yaw!==this.m_lastAttitude.yaw||i.pitch!==this.m_lastAttitude.pitch||i.roll!==this.m_lastAttitude.roll;return s&&(this.m_lastCameraPos.copy(n),this.m_lastAttitude=i),s!==this.m_cameraMovedLastFrame&&(s&&this.movementStarted(),this.m_cameraMovedLastFrame=s),s&&(this.m_movementDetectorDeadline=t+this.m_throttlingTimeout,this.startMovementFinishedTimer(t)),this.m_cameraMovedLastFrame}clear(e){const t=e.camera.getWorldPosition(this.m_newCameraPos);this.m_lastCameraPos.set(t.x,t.y,t.z);const i=r.MapViewUtils.extractAttitude(e,e.camera);this.m_lastAttitude=i}forceMoved(){this.m_lastCameraPos.set(Number.NaN,Number.NaN,Number.NaN)}get cameraIsMoving(){return void 0!==this.m_throttlingTimerId}dispose(){this.removeMovementFinishedTimer(),this.m_movementStartedFunc=void 0,this.m_movementFinishedFunc=void 0}get cameraMovedLastFrame(){return!0===this.m_cameraMovedLastFrame}movementStarted(){void 0!==this.m_movementStartedFunc&&this.m_movementStartedFunc()}movementFinished(){this.removeMovementFinishedTimer(),void 0!==this.m_movementFinishedFunc&&this.m_movementFinishedFunc()}startMovementFinishedTimer(e){if(void 0===this.m_throttlingTimerId){const t=Math.max(0,this.m_movementDetectorDeadline-e);this.m_throttlingTimerId=setTimeout(this.onDeadlineTimer,t)}}removeMovementFinishedTimer(){void 0!==this.m_throttlingTimerId&&(clearTimeout(this.m_throttlingTimerId),this.m_throttlingTimerId=void 0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(270);Object.defineProperty(t,"MapRenderingManager",{enumerable:!0,get:function(){return n.MapRenderingManager}});var r=i(34);Object.defineProperty(t,"Pass",{enumerable:!0,get:function(){return r.Pass}});var s=i(127);Object.defineProperty(t,"MSAARenderPass",{enumerable:!0,get:function(){return s.MSAARenderPass}}),Object.defineProperty(t,"MSAASampling",{enumerable:!0,get:function(){return s.MSAASampling}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAARenderPass=t.MSAASampling=void 0;const n=i(4),r=i(0),s=i(34);var o;!function(e){e[e.Level_0=0]="Level_0",e[e.Level_1=1]="Level_1",e[e.Level_2=2]="Level_2",e[e.Level_3=3]="Level_3",e[e.Level_4=4]="Level_4",e[e.Level_5=5]="Level_5"}(o=t.MSAASampling||(t.MSAASampling={}));class a extends s.Pass{constructor(){super(),this.samplingLevel=o.Level_1,this.m_renderTarget=null,this.m_localCamera=new r.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new r.Scene,this.m_quadUniforms=n.CopyShader.uniforms,this.m_quadMaterial=new n.MSAAMaterial(this.m_quadUniforms),this.m_quad=new r.Mesh(new r.PlaneBufferGeometry(2,2),this.m_quadMaterial),this.m_tmpColor=new r.Color,this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad)}dispose(){null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}render(e,t,i,n,s){if(!this.enabled)return;null===this.m_renderTarget&&(this.m_renderTarget=new r.WebGLRenderTarget(s.width,s.height,{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat}),this.m_renderTarget.texture.name="MSAARenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture;const o=a.OffsetVectors[this.samplingLevel],l=e.getClearColor(this.m_tmpColor),c=void 0!==l?l.getHex():0,h={enabled:null!==i.view&&i.view.enabled,fullWidth:s.width,fullHeight:s.height,x:0,y:0,width:s.width,height:s.height};h.enabled&&null!==i.view&&(h.fullWidth=i.view.fullWidth,h.fullHeight=i.view.fullHeight,h.x=i.view.offsetX,h.y=i.view.offsetY,h.width=i.view.width,h.height=i.view.height);const u=e.getRenderTarget();for(let r=0;r<o.length;r++){const s=o[r];i.setViewOffset(h.fullWidth,h.fullHeight,h.x+s[0]/16,h.y+s[1]/16,h.width,h.height);const a=(r+.5)/o.length-.5,u=1/o.length+a/32;this.m_quadUniforms.opacity.value=u,e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:n),0===r&&(e.setClearColor(0),e.clear()),e.render(this.m_quadScene,this.m_localCamera),0===r&&void 0!==l&&e.setClearColor(c)}e.setRenderTarget(u),null!==i.view&&(i.view.enabled=h.enabled,i.view.offsetX=h.x,i.view.offsetY=h.y)}setSize(e,t){this.m_renderTarget&&this.m_renderTarget.setSize(e,t)}}t.MSAARenderPass=a,a.OffsetVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]]},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentDecoderFacade=void 0;const n=i(129),r=i(130);class s{static getTileDecoder(e,t,i,n){const s=this.getWorkerSet(t,i,n);return new r.WorkerBasedDecoder(s,e)}static getWorkerSet(e,t,i){void 0===e&&(e=this.defaultScriptUrl);let r=this.workerSets[e];if(void 0===r){const s=void 0!==i?1e3*i:void 0;r=new n.ConcurrentWorkerSet({scriptUrl:e,workerCount:null!=t?t:this.defaultWorkerCount,workerConnectionTimeout:s}),this.workerSets[e]=r}return r}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach(e=>{this.workerSets[e].destroy()}),this.workerSets={}}static destroyIfTerminated(){let e=!0;Object.keys(this.workerSets).forEach(t=>{this.workerSets[t].terminated||(e=!1)}),e&&s.destroy()}}t.ConcurrentDecoderFacade=s,s.defaultScriptUrl="./decoder.bundle.js",s.defaultWorkerCount=void 0,s.workerSets={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentWorkerSet=t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=t.isLoggingMessage=void 0;const n=i(3),r=i(1),s=i(0),o=i(72),a=r.LoggerManager.instance.create("ConcurrentWorkerSet");function l(e){return e&&"number"==typeof e.level&&e.type===r.WORKERCHANNEL_MSG_TYPE}t.isLoggingMessage=l;t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=1e4;t.ConcurrentWorkerSet=class{constructor(e){this.m_options=e,this.m_workerChannelLogger=r.LoggerManager.instance.create("WorkerChannel"),this.m_eventListeners=new Map,this.m_workers=new Array,this.m_availableWorkers=new Array,this.m_workerPromises=new Array,this.m_readyPromises=new Map,this.m_requests=new Map,this.m_workerRequestQueue=[],this.m_nextMessageId=0,this.m_stopped=!0,this.m_referenceCount=0,this.onWorkerMessage=(e,t)=>{if(n.WorkerServiceProtocol.isResponseMessage(t.data)){const i=t.data;if(null===i.messageId)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: no messageId`);const n=this.m_requests.get(i.messageId);if(void 0===n)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: invalid messageId`);if(e>=0&&e<this.m_workers.length){const t=this.m_workers[e];this.m_availableWorkers.push(t),this.checkWorkerRequestQueue()}else a.error(`[${this.m_options.scriptUrl}]: onWorkerMessage: invalid workerId`);if(void 0!==i.errorMessage){const e=new Error(i.errorMessage);void 0!==i.errorStack&&(e.stack=i.errorStack),n.resolver(e)}else n.resolver(void 0,i.response)}else if(n.WorkerServiceProtocol.isInitializedMessage(t.data)){const e=this.getReadyPromise(t.data.service);++e.count===this.m_workerPromises.length&&e.resolve()}else if(l(t.data))switch(t.data.level){case r.LogLevel.Trace:this.m_workerChannelLogger.trace(...t.data.message);break;case r.LogLevel.Debug:this.m_workerChannelLogger.debug(...t.data.message);break;case r.LogLevel.Log:this.m_workerChannelLogger.log(...t.data.message);break;case r.LogLevel.Info:this.m_workerChannelLogger.info(...t.data.message);break;case r.LogLevel.Warn:this.m_workerChannelLogger.warn(...t.data.message);break;case r.LogLevel.Error:this.m_workerChannelLogger.error(...t.data.message)}else this.eventHandler(t)},this.start()}addReference(){this.m_referenceCount+=1,1===this.m_referenceCount&&this.m_stopped&&this.start()}removeReference(){this.m_referenceCount-=1,0===this.m_referenceCount&&this.destroy()}start(e){if(void 0!==e&&(this.m_options=e),!this.m_stopped)throw new Error("ConcurrentWorker set already started");this.m_workerCount=r.getOptionValue(this.m_options.workerCount,"undefined"!=typeof navigator&&void 0!==navigator.hardwareConcurrency?s.MathUtils.clamp(navigator.hardwareConcurrency-1,1,2):void 0,2);const i=r.getOptionValue(this.m_options.workerConnectionTimeout,t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT);for(let e=0;e<this.m_workerCount;++e){const t=o.WorkerLoader.startWorker(this.m_options.scriptUrl,i).then(t=>{const i=t=>{this.onWorkerMessage(e,t)};return t.addEventListener("message",i),this.m_workers.push(t),this.m_availableWorkers.push(t),{worker:t,listener:i}});this.m_workerPromises.push(t)}this.m_stopped=!1}get workerCount(){return this.m_workerCount}async stop(){this.m_stopped=!0,await this.waitForAllResponses().then(()=>{this.terminateWorkers()})}destroy(){this.m_stopped=!0,this.m_requests.forEach(e=>{e.resolver(new Error("worker destroyed"))}),this.m_requests.clear(),this.m_workerRequestQueue=[],this.terminateWorkers(),this.m_eventListeners.clear()}get terminated(){return 0===this.m_workers.length}async connect(e){return this.ensureStarted(),await Promise.all(this.m_workerPromises),await this.getReadyPromise(e).promise}addEventListener(e,t){this.m_eventListeners.set(e,t)}removeEventListener(e){this.m_eventListeners.delete(e)}invokeRequest(e,t,i,r){this.ensureStarted();const s=this.m_nextMessageId++;let o;const a=new Promise((e,t)=>{o=(i,n)=>{this.m_requests.delete(s),void 0!==i?t(i):e(n)}});this.m_requests.set(s,{promise:a,resolver:o});const l={service:e,type:n.WorkerServiceProtocol.ServiceMessageName.Request,messageId:s,request:t};return this.postRequestMessage(l,i,r),a}broadcastRequest(e,t,i){const r=[];for(const s of this.m_workers){const o=this.m_nextMessageId++;let a;const l=new Promise((e,t)=>{a=(i,n)=>{this.m_requests.delete(o),void 0!==i?t(i):e(n)}});r.push(l),this.m_requests.set(o,{promise:l,resolver:a});const c={service:e,type:n.WorkerServiceProtocol.ServiceMessageName.Request,messageId:o,request:t};void 0!==i?s.postMessage(c,i):s.postMessage(c)}return Promise.all(r)}broadcastMessage(e,t){this.ensureStarted(),void 0!==t?this.m_workers.forEach(i=>i.postMessage(e,t)):this.m_workers.forEach(t=>t.postMessage(e))}get requestQueueSize(){return this.m_workerRequestQueue.length}get numWorkers(){return this.m_workers.length}get numIdleWorkers(){return this.m_availableWorkers.length}eventHandler(e){"string"==typeof e.data.type&&this.dispatchEvent(e.data.type,e)}postRequestMessage(e,t,i){if(this.ensureStarted(),0===this.m_workers.length)throw new Error("ConcurrentWorkerSet#postMessage: no workers started");if(void 0!==i&&i.signal.aborted){const t=this.m_requests.get(e.messageId);if(void 0===t)return void a.error(`[${this.m_options.scriptUrl}]: Bad RequestMessage: invalid messageId`);const i=new Error("Aborted");return i.name="AbortError",void t.resolver(i,void 0)}if(this.m_availableWorkers.length>0){const i=this.m_availableWorkers.pop();void 0!==t?i.postMessage(e,t):i.postMessage(e)}else void 0===i&&(i=new n.RequestController(0)),0===i.priority&&(i.priority=-this.m_nextMessageId),this.m_workerRequestQueue.unshift({message:e,buffers:t,requestController:i})}ensureStarted(){if(this.m_stopped)throw new Error("ConcurrentWorkerSet stopped")}async waitForAllResponses(){const e=new Array;this.m_requests.forEach(t=>{e.push(t.promise)}),await Promise.all(e)}dispatchEvent(e,t){const i=this.m_eventListeners.get(e);void 0!==i&&i(t)}terminateWorkers(){this.m_workerPromises.forEach(e=>{e.then(e=>{void 0!==e&&(e.worker.removeEventListener("message",e.listener),e.worker.terminate())})}),this.m_workers=[],this.m_workerPromises=[],this.m_availableWorkers=[],this.m_readyPromises.clear()}getReadyPromise(e){const t=this.m_readyPromises.get(e);if(void 0!==t)return t;const i={count:0,promise:void 0,resolve:()=>{},reject:e=>{i.error=e},error:void 0};return i.promise=new Promise((e,t)=>{const n=i;void 0!==n.error?t(n.error):n.count===this.m_workerPromises.length&&e(),n.resolve=e,n.reject=t}),this.m_readyPromises.set(e,i),i}checkWorkerRequestQueue(){if(0!==this.m_workerRequestQueue.length&&0!==this.m_availableWorkers.length)for(this.m_workerRequestQueue.sort((e,t)=>e.requestController.priority-t.requestController.priority);this.m_availableWorkers.length>0&&this.m_workerRequestQueue.length>0;){const e=this.m_workerRequestQueue.pop();this.postRequestMessage(e.message,e.buffers,e.requestController)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerBasedDecoder=void 0;const n=i(3);let r=0;t.WorkerBasedDecoder=class{constructor(e,t){this.workerSet=e,this.decoderServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.decoderServiceType}-${r++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch(()=>{}),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.decoderServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}decodeTile(e,t,i,r){const s=t.mortonCode(),o={type:n.WorkerDecoderProtocol.Requests.DecodeTileRequest,tileKey:s,data:e,projection:n.getProjectionName(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,o,a,r)}getTileInfo(e,t,i,r){const s=t.mortonCode(),o={type:n.WorkerDecoderProtocol.Requests.TileInfoRequest,tileKey:s,data:e,projection:n.getProjectionName(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,o,a,r)}configure(e,t){const i=Object.assign(Object.assign({service:this.serviceId,type:n.WorkerDecoderProtocol.DecoderMessageName.Configuration},e),{options:t});this.workerSet.broadcastMessage(i)}get workerCount(){return this.workerSet.workerCount}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentTilerFacade=void 0;const n=i(129),r=i(132);class s{static getTiler(e,t,i,n){const s=this.getWorkerSet(t,i,n);return new r.WorkerBasedTiler(s,e)}static getWorkerSet(e,t,i){void 0===e&&(e=this.defaultScriptUrl);let r=this.workerSets[e];if(void 0===r){const s=void 0!==i?1e3*i:void 0;r=new n.ConcurrentWorkerSet({scriptUrl:e,workerCount:null!=t?t:this.defaultWorkerCount,workerConnectionTimeout:s}),this.workerSets[e]=r}return r}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach(e=>{this.workerSets[e].destroy()}),this.workerSets={}}static destroyIfTerminated(){let e=!0;Object.keys(this.workerSets).forEach(t=>{this.workerSets[t].terminated||(e=!1)}),e&&s.destroy()}}t.ConcurrentTilerFacade=s,s.defaultScriptUrl="./decoder.bundle.js",s.defaultWorkerCount=1,s.workerSets={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerBasedTiler=void 0;const n=i(3);let r=0;t.WorkerBasedTiler=class{constructor(e,t){this.workerSet=e,this.tilerServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.tilerServiceType}-${r++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch(()=>{}),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.tilerServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}registerIndex(e,t){const i={type:n.WorkerTilerProtocol.Requests.RegisterIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}updateIndex(e,t){const i={type:n.WorkerTilerProtocol.Requests.UpdateIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}getTile(e,t){const i=t.mortonCode(),r={type:n.WorkerTilerProtocol.Requests.TileRequest,index:e,tileKey:i};return this.workerSet.invokeRequest(this.serviceId,r)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0;t.EventDispatcher=class{constructor(){this.m_listeners=new Map}dispose(){this.removeAllEventListeners()}hasEventListener(e,t){const i=this.m_listeners.get(e);return void 0!==i&&(void 0===t||i.includes(t))}addEventListener(e,t){let i=this.m_listeners.get(e);void 0===i&&(i=[],this.m_listeners.set(e,i)),i.includes(t)||i.push(t)}removeEventListener(e,t){const i=this.m_listeners.get(e);if(void 0!==i)if(void 0===t)this.m_listeners.delete(e);else{const n=i.indexOf(t);-1!==n&&(i.splice(n,1),0===i.length&&this.m_listeners.delete(e))}}removeAllEventListeners(){const e=Array.from(this.m_listeners.keys());for(const t of e)this.removeEventListener(t)}get eventTypes(){return Array.from(this.m_listeners.keys())}listeners(e){return this.m_listeners.get(e)}dispatchEvent(e){const t=this.m_listeners.get(e.type);if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrustumIntersection=t.TileKeyEntry=void 0;const n=i(2),r=i(1),s=i(0),o=i(135),a=i(275),l=i(9),c=[new s.Vector3,new s.Vector3],h=new s.Vector4;class u{constructor(e,t,i=0,n,r=0){this.tileKey=e,this.area=t,this.offset=i,this.elevationRange=n,this.distance=r}}t.TileKeyEntry=u;t.FrustumIntersection=class{constructor(e,t,i,n,r,o=256){this.m_camera=e,this.mapView=t,this.m_extendedFrustumCulling=i,this.m_tileWrappingEnabled=n,this.m_enableMixedLod=r,this.m_tilePixelSize=o,this.m_frustum=new s.Frustum,this.m_viewProjectionMatrix=new s.Matrix4,this.m_rootTileKeys=[],this.m_tileKeyEntries=new Map,this.m_mapTileCuller=new a.MapTileCuller(e)}get camera(){return this.m_camera}get projection(){return this.mapView.projection}updateFrustum(e){this.m_viewProjectionMatrix.multiplyMatrices(void 0!==e?e:this.m_camera.projectionMatrix,this.m_camera.matrixWorldInverse),this.m_frustum.setFromProjectionMatrix(this.m_viewProjectionMatrix),this.m_extendedFrustumCulling&&this.m_mapTileCuller.setup(),this.computeRequiredInitialRootTileKeys(this.m_camera.position)}compute(e,t,i,o){this.m_tileKeyEntries.clear(),r.assert(0!==this.mapView.viewportHeight);const a=Math.pow(this.m_tilePixelSize/this.mapView.viewportHeight,2),l=void 0!==t&&t.getTilingScheme()===e,c=this.mapView.projection.type===n.ProjectionType.Spherical||l,h=new Set(i);let u=0,d=0;o.forEach(e=>{u=Math.min(u,e.minGeometryHeight),d=Math.max(d,e.maxGeometryHeight)});const m={calculationFinal:!0,tileBounds:c?new n.OrientedBox3:new s.Box3};for(const e of h)this.m_tileKeyEntries.set(e,new Map);for(const i of this.m_rootTileKeys){const r=i.tileKey,s=i.offset,o=this.getTileKeyEntry(r,s,e,m,u,d,l?t:void 0);if(void 0!==o)for(const e of h){this.m_tileKeyEntries.get(e).set(n.TileKeyUtils.getKeyForTileKeyAndOffset(r,s),o)}}const p=[...this.m_rootTileKeys.values()];for(;p.length>0;){const r=p.pop();if(void 0===r)break;const s=r.tileKey,c=r.offset;if(!o.some((e,t)=>e.shouldSubdivide(i[t],s)))continue;if(this.m_enableMixedLod&&r.area<a)continue;const f=n.TileKeyUtils.getKeyForTileKeyAndOffset(s,c);for(const e of h){if(s.level>=e)continue;this.m_tileKeyEntries.get(e).delete(f)}for(const i of e.getSubTileKeys(s)){const r=this.getTileKeyEntry(i,c,e,m,u,d,l?t:void 0);if(void 0!==r){for(const e of h){if(r.tileKey.level>e)continue;const t=n.TileKeyUtils.getKeyForTileKeyAndOffset(i,c);this.m_tileKeyEntries.get(e).set(t,r)}p.push(r)}}}return{tileKeyEntries:this.m_tileKeyEntries,calculationFinal:m.calculationFinal}}getTileKeyEntry(e,t,i,n,r,s,a){var l,c;const h=function(e,t,i){const n=e.getGeoBox(t),r=360*i;return n.northEast.longitude+=r,n.southWest.longitude+=r,n}(i,e,t);if(void 0!==a){const t=a.getElevationRange(e);h.southWest.altitude=t.minElevation,h.northEast.altitude=t.maxElevation,n.calculationFinal=n.calculationFinal&&t.calculationStatus===o.CalculationStatus.FinalPrecise}h.southWest.altitude=(null!==(l=h.southWest.altitude)&&void 0!==l?l:0)+r,h.northEast.altitude=(null!==(c=h.northEast.altitude)&&void 0!==c?c:0)+s,this.mapView.projection.projectBox(h,n.tileBounds);const{area:d,distance:m}=this.computeTileAreaAndDistance(n.tileBounds);if(d>0)return new u(e,d,t,{minElevation:h.southWest.altitude,maxElevation:h.northEast.altitude},m)}computeTileAreaAndDistance(e){if(e instanceof s.Box3){if(this.m_extendedFrustumCulling&&!this.m_mapTileCuller.frustumIntersectsTileBox(e)||!this.m_frustum.intersectsBox(e))return{area:0,distance:1/0}}else if(!e.intersects(this.m_frustum))return{area:0,distance:1/0};const t=e.getCenter(c[0]),i=h.set(t.x,t.y,t.z,1).applyMatrix4(this.m_viewProjectionMatrix),n=.5*e.getSize(c[1]).length()/i.w;return{area:n*n,distance:i.z<=-i.w?-1:i.z>=i.w?1:i.z/i.w}}computeRequiredInitialRootTileKeys(e){this.m_rootTileKeys=[];const t=n.TileKey.fromRowColumnLevel(0,0,0);if(!(this.mapView.projection.type===n.ProjectionType.Planar)||!this.m_tileWrappingEnabled)return void this.m_rootTileKeys.push(new u(t,1/0,0));const i=this.mapView.projection.unprojectPoint(e),r=Math.round(i.longitude/360),o=this.m_camera,a=l.MapViewUtils.extractAttitude(this.mapView,o).pitch,c=o.aspect>1?o.aspect:1/o.aspect,h=s.MathUtils.degToRad(o.fov*c/2)+a,d=Math.tan(h)*o.position.z-Math.tan(a)*o.position.z,m=new s.Vector3(e.x-d,e.y,e.z),p=this.mapView.projection.unprojectPoint(m),f=s.MathUtils.clamp(Math.ceil(Math.abs((i.longitude-p.longitude)/360)*Math.SQRT2),0,7);for(let e=-f+r;e<=f+r;e++)this.m_rootTileKeys.push(new u(t,1/0,e))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CalculationStatus=void 0,function(e){e[e.PendingApproximate=0]="PendingApproximate",e[e.FinalPrecise=1]="FinalPrecise"}(t.CalculationStatus||(t.CalculationStatus={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overlayOnElevation=t.overlayTextElement=void 0;const n=i(3),r=i(4),s=i(1);function o(e,t){if(!("material"in e))return;const i=r.setDisplacementMapToMaterial.bind(null,t),n=e.material;Array.isArray(n)?n.forEach(i):n&&i(n)}function a(e,t,i,n){const r=n.unprojectPoint(e);if(i.geoBox.contains(r))r.altitude=t.sampleHeight(r,i);else if(r.altitude=t.getHeight(r,i.tileKey.level),void 0===r.altitude)return!1;return n.projectPoint(r,e),!0}t.overlayTextElement=function(e,t,i,n){s.assert(!e.elevated),i&&(e.elevated=e.path?function(e,t,i,n){for(const r of e)if(!a(r,t,i,n))return!1;return!0}(e.path,t,i,n):a(e.position,t,i,n))},t.overlayOnElevation=function(e){const t=e.mapView.elevationProvider;if(void 0===t||0===e.objects.length)return;const i=e.objects[0];if(!i.userData||!i.userData.kind||!i.userData.kind.find(e=>e!==n.GeometryKind.All&&e!==n.GeometryKind.Terrain))return;const r=t.getDisplacementMap(e.tileKey);if(void 0!==r)for(const t of e.objects)o(t,r.texture)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCache=void 0;const n=i(138);class r{constructor(){this.m_images=new Map}static get instance(){return void 0===r.m_instance&&(r.m_instance=new r),r.m_instance}static dispose(){r.m_instance=void 0}registerImage(e,t,i){let r=this.findImageCacheItem(t);return r?(void 0===e||r.owners.includes(e)||r.owners.push(e),r.imageItem):(r={imageItem:new n.ImageItem(t,i),owners:[e]},this.m_images.set(t,r),r.imageItem)}removeImage(e,t){const i=this.m_images.get(e);return void 0!==i&&(this.unlinkCacheItem(i,t),!0)}findImage(e){const t=this.m_images.get(e);if(void 0!==t)return t.imageItem}clear(e){this.m_images.forEach(t=>{this.unlinkCacheItem(t,e)})}get size(){return this.m_images.size}findImageCacheItem(e){return this.m_images.get(e)}cancelLoading(e){e.loading&&(e.cancelled=!0)}unlinkCacheItem(e,t){const i=e.owners.indexOf(t);i>=0&&e.owners.splice(i,1),0===e.owners.length&&(this.m_images.delete(e.imageItem.url),this.cancelLoading(e.imageItem))}}t.ImageCache=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageItem=void 0;const n=i(1),r=i(0),s=i(139),o=n.LoggerManager.instance.create("loadImage"),a=new s.MipMapGenerator;t.ImageItem=class{constructor(e,t){this.url=e,this.image=t}get loaded(){return void 0!==this.image&&void 0!==this.mipMaps}get loading(){return void 0!==this.loadingPromise}loadImage(){return this.loaded?Promise.resolve(this):(this.loading||(this.loadingPromise=new Promise((e,t)=>{if(this.image){const i=this.image;i instanceof HTMLImageElement&&!i.complete?(i.addEventListener("load",this.finalizeImage.bind(this,i,e)),i.addEventListener("error",t)):this.finalizeImage(this.image,e)}else o.debug("Loading image: "+this.url),!0===this.cancelled?(o.debug("Cancelled loading image: "+this.url),e(void 0)):(new r.ImageLoader).load(this.url,t=>{if(!0===this.cancelled)return o.debug("Cancelled loading image: "+this.url),void e(void 0);this.finalizeImage(t,e)},void 0,e=>{o.error(`... loading image failed: ${this.url} : ${e}`),this.loadingPromise=void 0,t(`... loading image failed: ${this.url} : ${e}`)})})),this.loadingPromise)}finalizeImage(e,t){this.image=e,this.mipMaps=a.generateTextureAtlasMipMap(this),this.loadingPromise=void 0,t(this)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MipMapGenerator=void 0;const n=i(0),r="undefined"==typeof window;class s{constructor(){r||(this.m_paddingCanvas=document.createElement("canvas"),this.m_paddingContext=this.m_paddingCanvas.getContext("2d"),this.m_resizeCanvas=document.createElement("canvas"),this.m_resizeContext=this.m_resizeCanvas.getContext("2d"))}static getPaddedSize(e,t){return{width:n.MathUtils.ceilPowerOfTwo(e),height:n.MathUtils.ceilPowerOfTwo(t)}}generateTextureAtlasMipMap(e){if(r)throw new Error("MipMapGenerator only works in browser.");if(void 0===e.image)throw new Error("Can not generate mip maps. Image data not loaded!");const t=e.image,i=[],{width:n,height:o}=s.getPaddedSize(t.width,t.height);this.copyImageWithPadding(t,n,o),i.push(this.m_paddingContext.getImageData(0,0,n,o));let a=.5*n,l=.5*o;for(;a>=1||l>=1;){const e=i[i.length-1];i.push(this.resizeImage(e,Math.max(a,1),Math.max(l,1))),a*=.5,l*=.5}return i}copyImageWithPadding(e,t,i){return this.m_paddingCanvas.width=t,this.m_paddingCanvas.height=i,this.m_paddingContext.clearRect(0,0,t,i),e instanceof ImageData?this.m_paddingContext.putImageData(e,0,0):this.m_paddingContext.drawImage(e,0,0),e.width!==t&&this.m_paddingContext.drawImage(this.m_paddingCanvas,e.width-1,0,1,e.height,e.width,0,t-e.width,e.height),e.height!==i&&this.m_paddingContext.drawImage(this.m_paddingCanvas,0,e.height-1,t,1,0,e.height,t,i-e.height),this.m_paddingCanvas}resizeImage(e,t,i){const n=this.copyImageWithPadding(e,e.width,e.height);return this.m_resizeCanvas.width=t,this.m_resizeCanvas.height=i,this.m_resizeContext.clearRect(0,0,t,i),this.m_resizeContext.drawImage(n,0,0,t,i),this.m_resizeContext.getImageData(0,0,t,i)}}t.MipMapGenerator=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapAnchors=void 0;const n=i(2),r=i(0);t.MapAnchors=class{constructor(){this.m_anchors=[],this.m_priorities=[]}get children(){return this.m_anchors}add(e){this.m_anchors.push(e)}remove(e){const t=this.m_anchors.findIndex(t=>t===e);t>-1&&this.m_anchors.splice(t,1)}clear(){this.m_anchors.length=0}setPriorities(e){this.m_priorities=e}update(e,t,i,s){const o=new r.Vector3;this.m_anchors.forEach(r=>{var a;if(void 0!==r.styleSet){const e=null===(a=this.m_priorities)||void 0===a?void 0:a.findIndex(e=>e.group===r.styleSet&&e.category===r.category);void 0!==e&&-1!==e&&(r.renderOrder=10*(e+1))}const l=void 0!==r.geoPosition?r.geoPosition:r.anchor;void 0!==l&&(n.isVector3Like(l)?o.set(l.x,l.y,l.z):n.isGeoCoordinatesLike(l)&&e.projectPoint(l,o),r.position.copy(o).sub(t)),!0===r.overlay?s.add(r):i.add(r)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewFog=void 0;const n=i(4),r=i(10),s=i(1),o=i(0);t.MapViewFog=class{constructor(e){this.m_scene=e,this.m_enabled=!0,this.m_fog=new o.Fog(0),this.m_fogIsDefined=!1}set enabled(e){this.m_enabled=e,e&&this.m_fogIsDefined&&null===this.m_scene.fog?this.add():e||null===this.m_scene.fog||this.remove()}get enabled(){return this.m_enabled}reset(e){this.m_cachedFog=e,void 0!==e&&void 0!==e.color&&void 0!==e.startRatio?(this.m_fogIsDefined=!0,this.m_fog.color.set(e.color),this.m_enabled&&null===this.m_scene.fog&&this.add()):(this.m_fogIsDefined=!1,null!==this.m_scene.fog&&this.remove())}update(e,t){if(null!==this.m_scene.fog&&void 0!==this.m_cachedFog&&this.m_cachedFog&&void 0!==this.m_cachedFog.startRatio&&(void 0!==e.camera.far||void 0!==t)){const i=void 0!==t?t:e.camera.far,n=1,r=0,a=this.m_cachedFog.startRatio,l=1;s.assert(a<=l);const c=Math.abs(Math.cos(e.tilt)),h=s.MathUtils.smoothStep(n,r,c);this.m_fog.near=o.MathUtils.lerp(i*a,i,1-h),this.m_fog.far=o.MathUtils.lerp(i*l,i,h),this.m_fog.near=Math.min(this.m_fog.near,e.camera.far),this.m_fog.far=Math.min(this.m_fog.far,e.camera.far)}}add(){this.m_scene.fog=this.m_fog,this.setFogInRawShaderMaterials(!0)}remove(){this.m_scene.fog=null,this.setFogInRawShaderMaterials(!1)}setFogInRawShaderMaterials(e){this.m_scene.traverse(t=>{if(t instanceof o.Mesh){const i=t.material;i instanceof o.Material&&!(i instanceof n.HighPrecisionLineMaterial)&&i.fog!==e&&(i.fog=e,i instanceof r.RawShaderMaterial&&i.invalidateFog())}})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyCubemapTexture=t.SkyCubemapFaceId=t.SKY_CUBEMAP_FACE_COUNT=void 0;const n=i(1),r=i(0),s=n.LoggerManager.instance.create("SkyCubemapTexture");var o;t.SKY_CUBEMAP_FACE_COUNT=6,function(e){e[e.positiveX=0]="positiveX",e[e.negativeX=1]="negativeX",e[e.positiveY=2]="positiveY",e[e.negativeY=3]="negativeY",e[e.positiveZ=4]="positiveZ",e[e.negativeZ=5]="negativeZ"}(o=t.SkyCubemapFaceId||(t.SkyCubemapFaceId={}));t.SkyCubemapTexture=class{constructor(e){const t=this.createCubemapFaceArray(e);this.m_skybox=void 0!==t?(new r.CubeTextureLoader).load(t):new r.CubeTexture}dispose(){this.m_skybox.dispose()}get texture(){return this.m_skybox}updateTexture(e){const t=this.createCubemapFaceArray(e);void 0!==t&&(this.m_skybox=(new r.CubeTextureLoader).load(t))}createCubemapFaceArray(e){const i=[void 0,void 0,void 0,void 0,void 0,void 0];for(let n=0;n<t.SKY_CUBEMAP_FACE_COUNT;++n){const t=e[o[n]];if(void 0===t)return void s.error(`Face "${o[n]}" was not defined.`);i[n]=t}return i}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiManager=void 0;const n=i(3),r=i(1),s=i(0),o=i(144),a=r.LoggerManager.instance.create("PoiManager");function l(e,t=0){if(e.imageTextures){const i=e.imageTextures[t];if(i>=0)return r.assert(e.imageTextures.length>t),e.stringCatalog[i]}}function c(e,t=0){return e.objInfos?e.objInfos[t]:void 0}function h(e,t,i=0){const n=(new s.Vector3).fromBufferAttribute(e,i);return n.x+=t,n}function u(e,t=0){var i;r.assert(e.texts.length>t);const n=e.texts[t];return r.assert(e.stringCatalog.length>n),null!==(i=e.stringCatalog[n])&&void 0!==i?i:""}class d{constructor(e){this.mapView=e,this.m_imageTextures=new Map,this.m_poiShieldGroups=new Map}static notifyMissingPoiTable(e,t){void 0===e&&(e="undefined"),void 0===d.m_missingPoiTableName.get(e)&&(d.m_missingPoiTableName.set(e,!0),void 0===t||t.loadedOk?a.error(`updatePoiFromPoiTable: No POI table with name '${e}' found!`):a.error(`updatePoiFromPoiTable: Could not load POI table '${e}'!`))}static notifyMissingPoi(e,t){void 0===e&&(e="undefined");const i=`${t}[${e}]`;void 0===d.m_missingPoiName.get(i)&&(d.m_missingPoiName.set(i,!0),a.warn(`updatePoiFromPoiTable: Cannot find POI info for '${e}' in table '${t}'.`))}addPois(e,t){const i=r.assertExists(t.poiGeometries),a=e.computeWorldOffsetX(),l=e.mapView,c=Math.floor(l.zoomLevel),h=new n.MapEnv({$zoom:c},l.env),u=new o.TextElementBuilder(h,e.textStyleCache,e.dataSource.dataSourceOrder);for(const o of i){r.assert(void 0!==o.technique);const i=r.assertExists(o.technique),l=t.techniques[i];if(!1===l._kindState||!n.isLineMarkerTechnique(l)&&!n.isPoiTechnique(l))continue;if(!1===l.showOnMap)continue;const c=new s.BufferAttribute(new Float64Array(o.positions.buffer),o.positions.itemCount);u.withTechnique(l),n.isLineMarkerTechnique(l)&&c.count>0?this.addLineMarker(u,e,o,c,a):n.isPoiTechnique(l)&&this.addPoi(u,e,o,c,a)}}async addTextureAtlas(e,t,i){const n=await fetch(t,{signal:i});if(!n.ok)throw new Error("addTextureAtlas: Cannot load textureAtlas: "+n.statusText);try{const i=await n.json();if(void 0===i)return void a.info("addTextureAtlas: TextureAtlas empty: "+t);a.debug(`addTextureAtlas: Loading textureAtlas '${t}' for image '${e}'`);for(const t of Object.getOwnPropertyNames(i)){const n=i[t],r={name:t,image:e,xOffset:n.x,yOffset:n.y,width:n.width,height:n.height};this.addImageTexture(r)}this.mapView.update()}catch(e){a.error(`addTextureAtlas: Failed to load textureAtlas '${t}' : ${e}`)}}addImageTexture(e){void 0!==e.name?(void 0!==this.m_imageTextures.get(e.name)&&a.warn("addImageTexture: Name already used: "+e.name+" (overriding it)"),this.m_imageTextures.set(e.name,e)):a.error("addImageTexture: Name required",e)}getImageTexture(e){return this.m_imageTextures.get(e)}updatePoiFromPoiTable(e){var t,i,r,s,a,l;const c=e.poiInfo;if(!c||void 0===c.poiTableName||void 0===c.poiName)return!0;const h=c.poiTableName,u=this.mapView.poiTableManager.getPoiTable(h);if(u&&u.isLoading)return!1;if(c.poiTableName=void 0,!u||!u.loadedOk)return d.notifyMissingPoiTable(h,u),!0;const m=c.poiName,p=u.getEntry(m);return p?(void 0!==p.iconName&&p.iconName.length>0&&(c.imageTextureName=n.composeTechniqueTextureName(p.iconName,c.technique)),e.visible=null!==(t=p.visible)&&void 0!==t?t:e.visible,e.priority=null!==(i=p.priority)&&void 0!==i?i:e.priority,c.iconMinZoomLevel=null!==(r=p.iconMinLevel)&&void 0!==r?r:c.iconMinZoomLevel,c.iconMaxZoomLevel=null!==(s=p.iconMaxLevel)&&void 0!==s?s:c.iconMaxZoomLevel,c.textMinZoomLevel=null!==(a=p.textMinLevel)&&void 0!==a?a:c.textMinZoomLevel,c.textMaxZoomLevel=null!==(l=p.textMaxLevel)&&void 0!==l?l:c.textMaxZoomLevel,o.TextElementBuilder.alignZoomLevelRanges(e),!0):(d.notifyMissingPoi(m,h),!0)}clear(){this.m_imageTextures.clear(),this.m_poiShieldGroups.clear()}addLineMarker(e,t,i,n,r){const s=u(i),o=l(i),a=o+"-"+s;let d=this.m_poiShieldGroups.get(a);void 0===d&&(d=this.m_poiShieldGroups.size,this.m_poiShieldGroups.set(a,d));const m=[];for(let e=0;e<n.count;e+=3)m.push(h(n,r,e));const p=e.withIcon(o,d).build(s,m,t.offset,t.dataSource.name,t.dataSource.dataSourceOrder,c(i));t.addTextElement(p)}addPoi(e,t,i,n,r){var s,o;for(let a=0;a<n.count;++a){const d=null!==(o=null===(s=i.offsetDirections)||void 0===s?void 0:s[a])&&void 0!==o?o:0,m=e.withIcon(l(i,a)).build(u(i,a),h(n,r,a),t.offset,t.dataSource.name,t.dataSource.dataSourceOrder,c(i,a),void 0,d);t.addTextElement(m)}}}t.PoiManager=d,d.m_missingPoiTableName=new Map,d.m_missingPoiName=new Map},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementBuilder=void 0;const n=i(3),r=i(8),s=i(1),o=i(291),a=i(37),l=i(47),c=s.LoggerManager.instance.create("TextElementBuilder");class h{constructor(e,t,i){if(this.m_env=e,this.m_styleCache=t,this.m_baseRenderOrder=i,this.m_distanceScale=l.DEFAULT_TEXT_DISTANCE_SCALE,this.m_renderOrder=i,Number.isInteger(i))this.renderOrderUpBound=h.RENDER_ORDER_UP_BOUND;else{const e=Math.abs(i);this.renderOrderUpBound=(e-Math.floor(e))*h.RENDER_ORDER_UP_BOUND}this.isValidRenderOrder(i)||c.warn(`Large base render order (${i}) might cause precision issues.`)}static alignZoomLevelRanges(e){var t,i;if(!e.poiInfo)return;const n=e.poiInfo;e.minZoomLevel=null!==(t=e.minZoomLevel)&&void 0!==t?t:s.MathUtils.min2(n.iconMinZoomLevel,n.textMinZoomLevel),e.maxZoomLevel=null!==(i=e.maxZoomLevel)&&void 0!==i?i:s.MathUtils.max2(n.iconMaxZoomLevel,n.textMaxZoomLevel)}static composeRenderOrder(e,t){return e*h.RENDER_ORDER_UP_BOUND+t}withTechnique(e){var t,i,r,o,a,u,d;this.m_technique=e,this.m_priority=null!==(t=n.getPropertyValue(e.priority,this.m_env))&&void 0!==t?t:0,this.m_fadeNear=null!==(i=n.getPropertyValue(e.fadeNear,this.m_env))&&void 0!==i?i:void 0,this.m_fadeFar=null!==(r=n.getPropertyValue(e.fadeFar,this.m_env))&&void 0!==r?r:void 0,this.m_minZoomLevel=null!==(o=n.getPropertyValue(e.minZoomLevel,this.m_env))&&void 0!==o?o:void 0,this.m_maxZoomLevel=null!==(a=n.getPropertyValue(e.maxZoomLevel,this.m_env))&&void 0!==a?a:void 0,this.m_distanceScale=null!==(u=e.distanceScale)&&void 0!==u?u:l.DEFAULT_TEXT_DISTANCE_SCALE,this.m_renderStyle=this.m_styleCache.getRenderStyle(e),this.m_layoutStype=this.m_styleCache.getLayoutStyle(e),this.m_xOffset=n.getPropertyValue(e.xOffset,this.m_env),this.m_yOffset=n.getPropertyValue(e.yOffset,this.m_env);const m=null!==(d=n.getPropertyValue(e.renderOrder,this.m_env))&&void 0!==d?d:0;if(!this.isValidRenderOrder(m)){const e=`Unsupported large render order (${m})`;c.error(e),s.assert(!1,e)}return this.m_renderOrder=h.composeRenderOrder(this.m_baseRenderOrder,m),n.isTextTechnique(e)?this.withTextTechnique(e):this.withPoiTechnique(e),this}withIcon(e,t){return s.assert(void 0!==this.m_poiBuilder),this.m_poiBuilder.withIcon(e,t),this}build(e,t,i,o,l,c,u,d){var m;const p=n.getFeatureId(c);s.assert(void 0!==this.m_technique),s.assert(void 0!==this.m_renderStyle),s.assert(void 0!==this.m_layoutStype);const f=this.m_technique,g=this.m_renderStyle,v=this.m_layoutStype,y=new a.TextElement(r.ContextualArabicConverter.instance.convert(e),t,g,v,this.m_priority,this.m_xOffset,this.m_yOffset,p,f.style,this.m_fadeNear,this.m_fadeFar,i,d,o,l);return y.minZoomLevel=this.m_minZoomLevel,y.maxZoomLevel=this.m_maxZoomLevel,y.distanceScale=this.m_distanceScale,y.mayOverlap=this.m_mayOverlap,y.reserveSpace=this.m_reserveSpace,y.kind=f.kind,y.userData=c,y.textFadeTime=void 0!==f.textFadeTime?1e3*f.textFadeTime:void 0,y.pathLengthSqr=u,y.alwaysOnTop=this.m_alwaysOnTop,y.renderOrder=this.m_renderOrder,y.poiInfo=null===(m=this.m_poiBuilder)||void 0===m?void 0:m.build(y),h.alignZoomLevelRanges(y),y}withTextTechnique(e){this.m_mayOverlap=!0===e.mayOverlap,this.m_reserveSpace=!1!==e.reserveSpace,this.m_poiBuilder=void 0}withPoiTechnique(e){this.m_mayOverlap=!0===e.textMayOverlap,this.m_reserveSpace=!1!==e.textReserveSpace,this.m_alwaysOnTop=!0===e.alwaysOnTop,this.m_poiBuilder||(this.m_poiBuilder=new o.PoiBuilder(this.m_env)),this.m_poiBuilder.withTechnique(e)}isValidRenderOrder(e){return Math.abs(e)<this.renderOrderUpBound}}t.TextElementBuilder=h,h.RENDER_ORDER_UP_BOUND=1e7},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdfTextMaterial=t.GlyphCopyMaterial=t.GlyphClearMaterial=void 0;const n=i(1),r=i(0),s={sdf_attributes:"\n        attribute vec4 position;\n        attribute vec4 uv;\n        attribute vec4 color;\n        attribute vec4 bgColor;\n        ",sdf_varying:"\n        varying vec4 vColor;\n        varying float vWeight;\n        varying vec2 vUv;\n        varying float vRotation;\n        ",sdf_varying_computation:"\n        #if BG_TEXT\n        vColor = bgColor;\n        vWeight = uv.w;\n        #else\n        vColor = color;\n        vWeight = uv.z;\n        #endif\n        vUv = vec2(uv.xy);\n        vRotation = position.w;\n        ",sdf_frag_uniforms:"\n        uniform sampler2D sdfTexture;\n        uniform vec4 sdfParams;\n        ",sdf_sampling_functions:"\n        float median(float r, float g, float b) {\n            return max(min(r, g), min(max(r, g), b));\n        }\n\n        float getDistance(vec2 uvOffset) {\n            vec3 texSample = texture2D(sdfTexture, vUv.xy + uvOffset).rgb;\n            #if MSDF\n            return median(texSample.r, texSample.g, texSample.b);\n            #else\n            return texSample.r;\n            #endif\n        }\n\n        float getOpacity(vec2 uvOffset, float weight) {\n            vec2 uv = vUv + uvOffset;\n            vec2 rotatedUVs = abs(vec2(\n                cos(vRotation) * uv.x - sin(vRotation) * uv.y,\n                sin(vRotation) * uv.x + cos(vRotation) * uv.y));\n\n            float dx = dFdx(rotatedUVs.x) * sdfParams.x;\n            float dy = dFdy(rotatedUVs.y) * sdfParams.y;\n            float toPixels = sdfParams.w * inversesqrt( dx * dx + dy * dy );\n\n            float dist = getDistance(uvOffset) + min(weight, 0.5 - 1.0 / sdfParams.w) - 0.5;\n            return clamp(dist * toPixels + 0.5, 0.0, 1.0);\n        }\n        "};Object.assign(r.ShaderChunk,s);class o extends r.RawShaderMaterial{constructor(e){const t=!0===(null==e?void 0:e.rendererCapabilities.isWebGL2),i=e?Object.assign(Object.assign({},e),{glslVersion:t?r.GLSL3:r.GLSL1,vertexShader:t&&e.vertexShader?n.convertVertexShaderToWebGL2(e.vertexShader):e.vertexShader,fragmentShader:t&&e.fragmentShader?n.convertFragmentShaderToWebGL2(e.fragmentShader):e.fragmentShader}):void 0;i&&delete i.rendererCapabilities,super(i)}}t.GlyphClearMaterial=class extends o{constructor(e){super(e?{name:"GlyphClearMaterial",vertexShader:"\n    attribute vec2 position;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",fragmentShader:"\n    precision highp float;\n    precision highp int;\n\n    void main() {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }",uniforms:{},depthTest:!1,depthWrite:!1,rendererCapabilities:e.rendererCapabilities}:void 0)}};t.GlyphCopyMaterial=class extends o{constructor(e){super(e?{name:"GlyphCopyMaterial",vertexShader:"\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vUv;\n\n    void main() {\n        vUv = vec3(uv.xy, position.z);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",fragmentShader:"\n    precision highp float;\n    precision highp int;\n\n    uniform float pageOffset;\n    uniform sampler2D page0;\n    uniform sampler2D page1;\n    uniform sampler2D page2;\n    uniform sampler2D page3;\n    uniform sampler2D page4;\n    uniform sampler2D page5;\n    uniform sampler2D page6;\n    uniform sampler2D page7;\n\n    varying vec3 vUv;\n\n    void main() {\n        vec4 texSample = vec4(0.0);\n        if (vUv.z < pageOffset || vUv.z > (pageOffset + 7.0)) discard;\n        else if (vUv.z < pageOffset + 1.0) texSample = texture2D(page0, vUv.xy);\n        else if (vUv.z < pageOffset + 2.0) texSample = texture2D(page1, vUv.xy);\n        else if (vUv.z < pageOffset + 3.0) texSample = texture2D(page2, vUv.xy);\n        else if (vUv.z < pageOffset + 4.0) texSample = texture2D(page3, vUv.xy);\n        else if (vUv.z < pageOffset + 5.0) texSample = texture2D(page4, vUv.xy);\n        else if (vUv.z < pageOffset + 6.0) texSample = texture2D(page5, vUv.xy);\n        else if (vUv.z < pageOffset + 7.0) texSample = texture2D(page6, vUv.xy);\n        else texSample = texture2D(page7, vUv.xy);\n\n        gl_FragColor = texSample;\n    }",uniforms:{pageOffset:new r.Uniform(0),page0:new r.Uniform(r.Texture.DEFAULT_IMAGE),page1:new r.Uniform(r.Texture.DEFAULT_IMAGE),page2:new r.Uniform(r.Texture.DEFAULT_IMAGE),page3:new r.Uniform(r.Texture.DEFAULT_IMAGE),page4:new r.Uniform(r.Texture.DEFAULT_IMAGE),page5:new r.Uniform(r.Texture.DEFAULT_IMAGE),page6:new r.Uniform(r.Texture.DEFAULT_IMAGE),page7:new r.Uniform(r.Texture.DEFAULT_IMAGE)},depthTest:!1,depthWrite:!1,rendererCapabilities:e.rendererCapabilities}:void 0)}};t.SdfTextMaterial=class extends o{constructor(e){super(e?{name:"SdfTextMaterial",vertexShader:void 0!==e.vertexSource?e.vertexSource:"\n    #include <sdf_attributes>\n    #include <sdf_varying>\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        #include <sdf_varying_computation>\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n    }",fragmentShader:void 0!==e.fragmentSource?e.fragmentSource:"\n    precision highp float;\n    precision highp int;\n\n    #include <sdf_varying>\n    #include <sdf_frag_uniforms>\n    #include <sdf_sampling_functions>\n\n    void main() {\n        vec4 color = vColor;\n        color.a *= getOpacity(vec2(0.0), vWeight);\n        if (color.a < 0.05) {\n            discard;\n        }\n        gl_FragColor = color;\n    }",uniforms:{sdfTexture:new r.Uniform(e.texture),sdfParams:new r.Uniform(new r.Vector4(e.textureSize.x,e.textureSize.y,e.size,e.distanceRange))},defines:{MSDF:e.isMsdf?1:0,BG_TEXT:e.isBackground?1:0},depthTest:!0,depthWrite:!1,side:r.DoubleSide,transparent:!0,rendererCapabilities:e.rendererCapabilities}:void 0),this.extensions.derivatives=!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextBufferObject=void 0;t.TextBufferObject=class{constructor(e,t,i,n,r,s){this.glyphs=e,this.buffer=t,this.bounds=i,this.characterBounds=n,this.textRenderStyle=r,this.textLayoutStyle=s}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSdfTextMaterial=void 0;const n=i(145);t.createSdfTextMaterial=function(e){return new n.SdfTextMaterial({texture:e.fontCatalog.texture,textureSize:e.fontCatalog.textureSize,size:e.fontCatalog.size,distanceRange:e.fontCatalog.distanceRange,isMsdf:"msdf"===e.fontCatalog.type,isBackground:!0===e.isBackground,vertexSource:e.vertexSource,fragmentSource:e.fragmentSource,rendererCapabilities:e.rendererCapabilities})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiRenderer=t.PoiBatchRegistry=t.PoiBuffer=void 0;const n=i(3),r=i(4),s=i(1),o=i(0),a=i(139),l=i(292),c=s.LoggerManager.instance.create("PoiRenderer"),h=new o.Color(1,1,1),u=new o.Color;class d{constructor(e,t,i){this.buffer=e,this.layer=t,this.m_onDispose=i,this.m_refCount=0}increaseRefCount(){return++this.m_refCount,this}decreaseRefCount(){return s.assert(this.m_refCount>0),0==--this.m_refCount&&this.dispose(),this}dispose(){this.layer.scene.remove(this.buffer.mesh),this.buffer.dispose(),this.m_onDispose()}}t.PoiBuffer=d;class m{constructor(e,t,i){this.m_rendererCapabilities=e,this.imageItem=t,this.m_onDispose=i;const n=new o.Texture(this.imageItem.image,o.UVMapping,void 0,void 0,(m.trilinear,o.LinearFilter),m.trilinear?o.LinearMipMapLinearFilter:o.LinearFilter,o.RGBAFormat);m.trilinear&&this.imageItem.mipMaps&&(n.mipmaps=this.imageItem.mipMaps,n.image=n.mipmaps[0]),n.flipY=!1,n.premultiplyAlpha=!0,n.needsUpdate=!0,this.m_material=new r.IconMaterial({rendererCapabilities:this.m_rendererCapabilities,map:n}),this.m_poiBuffers=new Map}getBuffer(e){let t=this.m_poiBuffers.get(e.id);if(t)return t.increaseRefCount();const i=new l.BoxBuffer(this.m_material,e.id),n=i.mesh;return n.frustumCulled=!1,e.scene.add(n),t=new d(i,e,()=>{this.disposeBuffer(e.id)}),this.m_poiBuffers.set(e.id,t),t.increaseRefCount()}reset(){for(const e of this.m_poiBuffers.values())e.buffer.reset()}update(){for(const e of this.m_poiBuffers.values())e.buffer.updateBufferGeometry()}pickBoxes(e,t,i){for(const n of this.m_poiBuffers.values())n.buffer.pickBoxes(e,t,i)}updateMemoryUsage(e){if(void 0!==this.imageItem.image){const t=this.imageItem.image.width*this.imageItem.image.height*4;e.heapSize+=t,e.gpuSize+=t}for(const t of this.m_poiBuffers.values())t.buffer.updateMemoryUsage(e)}dispose(){this.m_poiBuffers.clear(),this.m_material.map.dispose(),this.m_material.dispose(),this.m_onDispose()}disposeBuffer(e){s.assert(this.m_poiBuffers.size>0),this.m_poiBuffers.delete(e),0===this.m_poiBuffers.size&&this.dispose()}}m.trilinear=!0;class p{constructor(e){this.m_rendererCapabilities=e,this.m_batchMap=new Map}registerPoi(e,t){var i;const{imageItem:n,imageTexture:r}=e;if(!n)return;s.assert(void 0!==e.imageTextureName);const o=null!==(i=null==r?void 0:r.image)&&void 0!==i?i:e.imageTextureName;let a=this.m_batchMap.get(o);return void 0===a&&(a=new m(this.m_rendererCapabilities,n,()=>{this.deleteBatch(o)}),this.m_batchMap.set(o,a)),a.getBuffer(t)}addPoi(e,t,i,n){if(!1===e.isValid||!e.buffer)return void c.warn("PoiBatchRegistry: trying to add poiInfo without buffer prepared: ",e.poiName);let r;s.assert(void 0!==e.uvBox),void 0!==e.iconBrightness?(r=u.setScalar(e.iconBrightness),void 0!==e.iconColor&&(r=u.multiply(e.iconColor))):r=void 0!==e.iconColor?e.iconColor:h,e.buffer.buffer.addBox(t,e.uvBox,r,n,i,e.textElement)}reset(){for(const e of this.m_batchMap.values())e.reset()}update(){for(const e of this.m_batchMap.values())e.update()}pickTextElements(e,t){for(const i of this.m_batchMap.values())i.pickBoxes(e,t,i.imageItem.image)}updateMemoryUsage(e){for(const t of this.m_batchMap.values())t.updateMemoryUsage(e)}deleteBatch(e){this.m_batchMap.delete(e)}}t.PoiBatchRegistry=p;const f=new Map;class g{constructor(e,t,i){this.m_renderer=e,this.m_poiManager=t,this.m_imageCaches=i,this.m_tempScreenBox=new s.Math2D.Box,this.m_layers=[],this.m_poiBatchRegistry=new p(this.renderer.capabilities)}static computeIconScreenBox(e,t,i,r,o=new s.Math2D.Box){s.assert(void 0!==e.buffer);const a=e.computedWidth*i,l=e.computedHeight*i,c=e.technique,h=n.getPropertyValue(c.iconXOffset,r),u=n.getPropertyValue(c.iconYOffset,r),d=t.x+("number"==typeof h?h:0)*i,m=t.y+("number"==typeof u?u:0)*i;return o.x=d-a/2,o.y=m-l/2,o.w=a,o.h=l,o}get renderer(){return this.m_renderer}prepareRender(e,t){const i=e.poiInfo;return void 0!==i&&(void 0===i.buffer&&this.preparePoi(e,t),void 0!==i.buffer)}reset(){this.m_poiBatchRegistry.reset()}addPoi(e,t,i,n,r,o,a,l){s.assert(void 0!==e.buffer),g.computeIconScreenBox(e,t,r,l,this.m_tempScreenBox),o&&i.allocate(this.m_tempScreenBox),a>0&&(e.buffer||this.preparePoi(e.textElement,l),this.m_poiBatchRegistry.addPoi(e,this.m_tempScreenBox,n,a))}update(){this.m_poiBatchRegistry.update()}addLayer(e){let t=this.getLayer(e);return void 0===t&&(t={id:e,scene:new o.Scene},this.m_layers.push(t),this.m_layers.sort((e,t)=>e.id-t.id)),t}getLayer(e){return this.m_layers.find(t=>t.id===e)}get layers(){return this.m_layers}render(e,t){this.m_renderer.render(t.scene,e)}pickTextElements(e,t){this.m_poiBatchRegistry.pickTextElements(e,t)}getMemoryUsage(e){this.m_poiBatchRegistry.updateMemoryUsage(e)}preparePoi(e,t){const i=e.poiInfo;if(!i||!e.visible)return;if(void 0!==i.buffer||!1===i.isValid)return;if(void 0!==i.poiTableName){if(!this.m_poiManager.updatePoiFromPoiTable(e))return;if(!e.visible)return}const n=i.imageTextureName;if(void 0===n)return void(i.isValid=!1);const r=this.m_poiManager.getImageTexture(n),o=function(e,t,i){var n;s.assert(void 0!==e.imageTextureName);const r=i?i.image:e.imageTextureName;for(const e of t){const t=e.findImageByName(r);if(t)return f.delete(r),t}const o=f.get(r);f.set(r,o?o+1:0),5===f.get(r)&&c.error(`PoiRenderer::findImageItem: No imageItem found with name:\n            '${null!==(n=null==i?void 0:i.image)&&void 0!==n?n:r}'\n            after 5 attempts.`)}(i,this.m_imageCaches,r);o&&(o.loaded?this.setupPoiInfo(i,o,t,r):o.loading||o.loadImage().then(e=>{(null==e?void 0:e.image)&&this.setupPoiInfo(i,e,t,r)}).catch(e=>{c.error("preparePoi: Failed to load imageItem: '"+o.url,e),i.isValid=!1}))}setupPoiInfo(e,t,i,r){if(s.assert(void 0===e.uvBox),!t.image)return c.error("setupPoiInfo: No imageItem/imageData found"),void(e.isValid=!1);const o=e.technique,l=t.image.width,h=t.image.height,u=a.MipMapGenerator.getPaddedSize(l,h),d=m.trilinear&&t.mipMaps,p=d?u.width:l,f=d?u.height:h,g=void 0!==(null==r?void 0:r.width)?r.width:l,v=void 0!==(null==r?void 0:r.height)?r.height:h,y=void 0!==(null==r?void 0:r.width)?r.width:l,_=void 0!==(null==r?void 0:r.height)?r.height:h,x=void 0!==(null==r?void 0:r.xOffset)?r.xOffset:0,w=void 0!==(null==r?void 0:r.yOffset)?r.yOffset:0,b=x/p,M=(x+y)/p,T=w/f,S=(w+_)/f;let E=void 0!==o.iconScale?o.iconScale:1,P=void 0!==o.iconScale?o.iconScale:1;const A=n.getPropertyValue(o.screenWidth,i);null!=A&&(P=E=A/g);const C=n.getPropertyValue(o.screenHeight,i);null!=C&&(P=C/v,void 0!==A&&(E=P)),e.computedWidth=g*E,e.computedHeight=v*P,e.uvBox={s0:b,t0:S,s1:M,t1:T},e.imageItem=t,e.imageTexture=r,e.buffer=this.m_poiBatchRegistry.registerPoi(e,this.addLayer(e.renderOrder)),e.isValid=!0}}t.PoiRenderer=g},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenCollisionsDebug=t.ScreenCollisions=t.isLineWithBound=t.DetailedCollisionBox=t.CollisionBox=void 0;const n=i(1),r=i(0),s=i(81),o=i(150),a=n.LoggerManager.instance.create("ScreenCollissions");class l extends n.Math2D.Box{constructor(e){super(),void 0!==e&&this.copy(e)}copy(e){return e instanceof n.Math2D.Box?this.set(e.x,e.y,e.w,e.h):e instanceof r.Box2?this.set(e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y):this.set(e.minX,e.minY,e.maxX-e.minX,e.maxY-e.minY),this}get minX(){return this.x}set minX(e){this.x=e}get maxX(){return this.x+this.w}set maxX(e){this.w=e-this.x}get minY(){return this.y}set minY(e){this.y=e}get maxY(){return this.y+this.h}set maxY(e){this.h=e-this.y}}t.CollisionBox=l;class c extends l{constructor(e,t){super(e),this.detailBoxes=t}}function h(e){return void 0!==e.line}t.DetailedCollisionBox=c,t.isLineWithBound=h;const u=new l;class d{constructor(){this.screenBounds=new n.Math2D.Box,this.rtree=new o}reset(){this.rtree.clear()}update(e,t){this.screenBounds.set(e/-2,t/-2,e,t),this.reset()}allocate(e){const t=e instanceof l?e:new l(e);this.rtree.insert(t)}allocateIBoxes(e){this.rtree.load(e)}search(e){return this.rtree.search(e)}isAllocated(e){const t=e instanceof l?e:u.copy(e),i=this.search(t);return this.intersectsDetails(t,i)}isVisible(e){return this.screenBounds.intersects(e)}isFullyVisible(e){return this.screenBounds.containsBox(e)}intersectsDetails(e,t){for(const i of t)if(i instanceof c){for(const t of i.detailBoxes)if(t.intersects(e))return!0}else{if(!h(i))return!0;{const t=i;if(this.intersectsLine(e,t))return!0}}return!1}intersectsLine(e,t){const i=t.line,n=i.end.x-i.start.x;let r,s,o,a;if(0!==n){const t=i.end.y-i.start.y,l=t,c=-n,h=i.start.y-t/n*i.start.x;r=Math.sign(e.minX*l+(e.minY-h)*c),s=Math.sign(e.maxX*l+(e.minY-h)*c),o=Math.sign(e.minX*l+(e.maxY-h)*c),a=Math.sign(e.maxX*l+(e.maxY-h)*c)}else r=Math.sign(e.minX-i.start.x),s=Math.sign(e.maxX-i.start.x),o=Math.sign(e.minX-i.start.x),a=Math.sign(e.maxX-i.start.x);return r!==s||r!==o||r!==a}}t.ScreenCollisions=d;t.ScreenCollisionsDebug=class extends d{constructor(e){super(),this.m_renderContext=null,this.m_renderingEnabled=!1,this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0,null!=e&&(this.m_renderContext=e.getContext("2d"))}reset(){super.reset(),this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0}update(e,t){this.m_renderingEnabled&&a.log(`Allocations: ${this.m_numAllocations} Successful Tests: ${this.m_numSuccessfulTests} Failed Tests: ${this.m_numFailedTests}  Successful Visibility Tests: ${this.m_numSuccessfulVisibilityTests}  Failed Visibility Tests: ${this.m_numFailedVisibilityTests} `),super.update(e,t),null!==this.m_renderContext&&(this.m_renderContext.canvas.width=e,this.m_renderContext.canvas.height=t),this.m_renderingEnabled=s.debugContext.getValue("DEBUG_SCREEN_COLLISIONS")}allocate(e){super.allocate(e),this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#6666ff",this.m_renderContext.strokeRect(e.x-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-e.y,e.w,-e.h))}allocateIBoxes(e){for(const t of e)this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#aa2222",this.m_renderContext.strokeRect(t.minX-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-t.minY,t.maxX-t.minX,-(t.maxY-t.minY)));super.allocateIBoxes(e)}intersectsDetails(e,t){const i=super.intersectsDetails(e,t);if(this.m_renderingEnabled&&null!==this.m_renderContext){const t=i?2:1;this.m_renderContext.strokeStyle=i?"#FF0000":"#00ff00",this.m_renderContext.strokeRect(e.x-this.screenBounds.x-t,this.screenBounds.y+this.screenBounds.h-e.y+t,e.w+2*t,-e.h-2*t)}return i?this.m_numFailedTests++:this.m_numSuccessfulTests++,i}isVisible(e){const t=super.isVisible(e);return t?this.m_numSuccessfulVisibilityTests++:this.m_numFailedVisibilityTests++,t}}},function(e,t,i){e.exports=function(){"use strict";function e(e,n,r,s,o){!function e(i,n,r,s,o){for(;s>r;){if(s-r>600){var a=s-r+1,l=n-r+1,c=Math.log(a),h=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1);e(i,n,Math.max(r,Math.floor(n-l*h/a+u)),Math.min(s,Math.floor(n+(a-l)*h/a+u)),o)}var d=i[n],m=r,p=s;for(t(i,r,n),o(i[s],d)>0&&t(i,r,s);m<p;){for(t(i,m,p),m++,p--;o(i[m],d)<0;)m++;for(;o(i[p],d)>0;)p--}0===o(i[r],d)?t(i,r,p):t(i,++p,s),p<=n&&(r=p+1),n<=p&&(s=p-1)}}(e,n,r||0,s||e.length-1,o||i)}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function i(e,t){return e<t?-1:e>t?1:0}var n=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(e,t,i){if(!i)return t.indexOf(e);for(var n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function s(e,t){o(e,0,e.children.length,t,e)}function o(e,t,i,n,r){r||(r=p(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var s=t;s<i;s++){var o=e.children[s];a(r,e.leaf?n(o):o)}return r}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function u(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(t,i,n,r,s){for(var o=[i,n];o.length;)if(!((n=o.pop())-(i=o.pop())<=r)){var a=i+Math.ceil((n-i)/r/2)*r;e(t,a,i,n,s),o.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(e){var t=this.data,i=[];if(!m(e,t))return i;for(var n=this.toBBox,r=[];t;){for(var s=0;s<t.children.length;s++){var o=t.children[s],a=t.leaf?n(o):o;m(e,a)&&(t.leaf?i.push(o):d(e,a)?this._all(o,i):r.push(o))}t=r.pop()}return i},n.prototype.collides=function(e){var t=this.data;if(!m(e,t))return!1;for(var i=[];t;){for(var n=0;n<t.children.length;n++){var r=t.children[n],s=t.leaf?this.toBBox(r):r;if(m(e,s)){if(t.leaf||d(e,s))return!0;i.push(r)}}t=i.pop()}return!1},n.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},n.prototype.clear=function(){return this.data=p([]),this},n.prototype.remove=function(e,t){if(!e)return this;for(var i,n,s,o=this.data,a=this.toBBox(e),l=[],c=[];o||l.length;){if(o||(o=l.pop(),n=l[l.length-1],i=c.pop(),s=!0),o.leaf){var h=r(e,o.children,t);if(-1!==h)return o.children.splice(h,1),l.push(o),this._condense(l),this}s||o.leaf||!d(o,a)?n?(i++,o=n.children[i],s=!1):o=null:(l.push(o),c.push(i),i=0,n=o,o=o.children[0])}return this},n.prototype.toBBox=function(e){return e},n.prototype.compareMinX=function(e,t){return e.minX-t.minX},n.prototype.compareMinY=function(e,t){return e.minY-t.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(e){return this.data=e,this},n.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},n.prototype._build=function(e,t,i,n){var r,o=i-t+1,a=this._maxEntries;if(o<=a)return s(r=p(e.slice(t,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(r=p([])).leaf=!1,r.height=n;var l=Math.ceil(o/a),c=l*Math.ceil(Math.sqrt(a));f(e,t,i,c,this.compareMinX);for(var h=t;h<=i;h+=c){var u=Math.min(h+c-1,i);f(e,h,u,l,this.compareMinY);for(var d=h;d<=u;d+=l){var m=Math.min(d+l-1,u);r.children.push(this._build(e,d,m,n-1))}}return s(r,this.toBBox),r},n.prototype._chooseSubtree=function(e,t,i,n){for(;n.push(t),!t.leaf&&n.length-1!==i;){for(var r=1/0,s=1/0,o=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=h(l),u=(d=e,m=l,(Math.max(m.maxX,d.maxX)-Math.min(m.minX,d.minX))*(Math.max(m.maxY,d.maxY)-Math.min(m.minY,d.minY))-c);u<s?(s=u,r=c<r?c:r,o=l):u===s&&c<r&&(r=c,o=l)}t=o||t.children[0]}var d,m;return t},n.prototype._insert=function(e,t,i){var n=i?e:this.toBBox(e),r=[],s=this._chooseSubtree(n,this.data,t,r);for(s.children.push(e),a(s,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)},n.prototype._split=function(e,t){var i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),a=p(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,s(i,this.toBBox),s(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(e,t){this.data=p([e,t]),this.data.height=e.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(e,t,i){for(var n,r,s,a,l,c,u,d=1/0,m=1/0,p=t;p<=i-t;p++){var f=o(e,0,p,this.toBBox),g=o(e,p,i,this.toBBox),v=(r=f,s=g,a=Math.max(r.minX,s.minX),l=Math.max(r.minY,s.minY),c=Math.min(r.maxX,s.maxX),u=Math.min(r.maxY,s.maxY),Math.max(0,c-a)*Math.max(0,u-l)),y=h(f)+h(g);v<d?(d=v,n=p,m=y<m?y:m):v===d&&y<m&&(m=y,n=p)}return n||i-t},n.prototype._chooseSplitAxis=function(e,t,i){var n=e.leaf?this.compareMinX:l,r=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n)},n.prototype._allDistMargin=function(e,t,i,n){e.children.sort(n);for(var r=this.toBBox,s=o(e,0,t,r),l=o(e,i-t,i,r),c=u(s)+u(l),h=t;h<i-t;h++){var d=e.children[h];a(s,e.leaf?r(d):d),c+=u(s)}for(var m=i-t-1;m>=t;m--){var p=e.children[m];a(l,e.leaf?r(p):p),c+=u(l)}return c},n.prototype._adjustParentBBoxes=function(e,t,i){for(var n=i;n>=0;n--)a(t[n],e)},n.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():s(e[t],this.toBBox)},n}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWorldPosition=t.isPathLabelTooSmall=t.placePathLabel=t.placePointLabel=t.placeIcon=t.PlacementResult=t.newPointLabelTextMarginPercent=t.persistentPointLabelTextMargin=t.checkReadyForPlacement=t.PrePlacementResult=t.getMaxViewDistance=t.pointToPlaneDistance=t.computeViewDistance=void 0;const n=i(3),r=i(2),s=i(8),o=i(1),a=i(0),l=i(148),c=i(149),h=i(37),u=i(17),d=new a.Vector3(0,0,0),m=new a.Vector3(0,0,0),p=new a.Vector3(0,0,0);function f(e,t,i,n){let r;const s=e.path;if(s&&s.length>1)if(void 0!==t&&s&&s.length>t)r=g(s[t],i,n);else{const e=g(s[0],i,n),t=g(s[s.length-1],i,n);r=Math.min(e,t)}else r=g(e.position,i,n);return r}function g(e,t,i){return p.copy(e).sub(t).dot(i)}var v;t.computeViewDistance=f,t.pointToPlaneDistance=g,t.getMaxViewDistance=function(e,t){return e.maxVisibilityDist*t},function(e){e[e.Ok=0]="Ok",e[e.NotReady=1]="NotReady",e[e.Invisible=2]="Invisible",e[e.TooFar=3]="TooFar",e[e.Duplicate=4]="Duplicate",e[e.Count=5]="Count"}(v=t.PrePlacementResult||(t.PrePlacementResult={}));const y=new a.Vector3;t.checkReadyForPlacement=function(e,t,i,n,s){let a;return e.visible?n.updatePoiFromPoiTable(e)?e.visible&&i.zoomLevel!==e.maxZoomLevel&&o.MathUtils.isClamped(i.zoomLevel,e.minZoomLevel,e.maxZoomLevel)?(a=void 0===s?f(e,t,i.worldCenter,i.lookAtVector):function(e,t,i,n,s,o){const a=f(e,t,i,n);return s!==r.ProjectionType.Spherical?a<=o?a:void 0:(d.copy(e.position).normalize(),m.copy(i).normalize(),d.dot(m)>.5877852522924731&&a<=o?a:void 0)}(e,t,i.worldCenter,i.lookAtVector,i.projection.type,s),void 0===a?{result:v.TooFar,viewDistance:a}:{result:v.Ok,viewDistance:a}):{result:v.Invisible,viewDistance:a}:{result:v.NotReady,viewDistance:a}:{result:v.Invisible,viewDistance:a}};const _=new a.Box2,x=new a.Box2,w=[],b={},M=[],T=new c.CollisionBox,S=new a.Vector2,E=new a.Vector2,P=new o.Math2D.Box,A=new a.Vector2,C=new a.Vector2;var L;function R(e,i,r,l,c,d,m,p,f){const g=e.element;o.assert(void 0!==g.glyphs),o.assert(void 0!==g.layoutStyle);const v=!g.bounds||p,y=v?x:g.bounds;v&&(D(c,r),b.outputCharacterBounds=void 0,b.path=void 0,b.pathOverflow=!1,b.letterCaseArray=g.glyphCaseArray,c.measureText(g.glyphs,y,b));const w=function(e,t,i,r,l,c=new a.Vector2){switch(o.assert(e.type===u.TextElementType.PoiLabel||e.type===u.TextElementType.LineMarker),o.assert(void 0!==e.layoutStyle),c.x=e.xOffset,c.y=e.yOffset,i.h){case s.HorizontalPlacement.Left:c.x-=t.max.x;break;case s.HorizontalPlacement.Right:c.x-=t.min.x}switch(i.v){case s.VerticalPlacement.Top:c.y-=t.min.y;break;case s.VerticalPlacement.Center:c.y-=.5*(t.max.y+t.min.y);break;case s.VerticalPlacement.Bottom:c.y-=t.max.y}if(void 0!==e.poiInfo&&h.poiIsRenderable(e.poiInfo)){o.assert(void 0!==e.poiInfo.computedWidth),o.assert(void 0!==e.poiInfo.computedHeight),c.x+=e.poiInfo.computedWidth*(.5+i.h),c.y+=e.poiInfo.computedHeight*(.5+i.v);const t=s.hPlacementFromAlignment(e.layoutStyle.horizontalAlignment),r=s.vPlacementFromAlignment(e.layoutStyle.verticalAlignment);if(t!==i.h||r!==i.v){const o=e.poiInfo.technique;let a=n.getPropertyValue(o.iconXOffset,l),h=n.getPropertyValue(o.iconYOffset,l);a="number"==typeof a?a:0,h="number"==typeof h?h:0;const u=t-i.h,d=r-i.v,m=a-e.xOffset,p=h-e.yOffset;t===s.HorizontalPlacement.Center||r===s.VerticalPlacement.Center?(c.x+=2*Math.abs(u)*m,c.y-=2*d*Math.abs(m),c.y+=2*Math.abs(d)*p,c.x-=2*u*Math.abs(p)):(c.x+=2*Math.min(Math.abs(u),.5)*m,c.y-=2*Math.sign(d)*Math.min(Math.abs(d),.5)*Math.abs(m),c.y+=2*Math.min(Math.abs(d),.5)*p,c.x-=2*Math.sign(u)*Math.min(Math.abs(u),.5)*Math.abs(p))}}return c.multiplyScalar(r),c}(g,y,r,l,d,E).add(i);return f.set(w.x,w.y,e.renderDistance),_.copy(y).expandByVector(t.persistentPointLabelTextMargin).translate(w),_.getCenter(A),_.getSize(C),C.multiplyScalar(l),P.set(A.x-C.x/2,A.y-C.y/2,C.x,C.y),m.isVisible(P)?(v&&(_.getSize(C),C.multiplyScalar(l*(1+t.newPointLabelTextMarginPercent)),P.set(A.x-C.x/2,A.y-C.y/2,C.x,C.y)),!g.textMayOverlap&&m.isAllocated(P)?L.Rejected:(g.textReservesSpace&&m.allocate(P),v?(g.textBufferObject=void 0,g.bounds=g.bounds?g.bounds.copy(y):y.clone()):D(c,r),e.textPlacement=r,L.Ok)):L.Invisible}function D(e,t){e.textLayoutStyle.horizontalAlignment=s.hAlignFromPlacement(t.h),e.textLayoutStyle.verticalAlignment=s.vAlignFromPlacement(t.v)}t.persistentPointLabelTextMargin=new a.Vector2(2,2),t.newPointLabelTextMarginPercent=.1,function(e){e[e.Ok=0]="Ok",e[e.Rejected=1]="Rejected",e[e.Invisible=2]="Invisible"}(L=t.PlacementResult||(t.PlacementResult={})),t.placeIcon=function(e,t,i,n,r,s){return l.PoiRenderer.computeIconScreenBox(t,i,n,r,P),s.isVisible(P)?!0===t.mayOverlap||!s.isAllocated(P)?L.Ok:L.Rejected:L.Invisible},t.placePointLabel=function(e,t,i,n,r,s,a,l=!1){o.assert(void 0!==e.element.layoutStyle);const c=e.element.layoutStyle;return(l=l&&void 0!==c.placements&&c.placements.length>1)?function(e,t,i,n,r,s,a){o.assert(void 0!==e.element.layoutStyle);const l=e.element,c=e.visible,h=e.textPlacement,u=l.layoutStyle.placements,d=u.length,m=u.findIndex(e=>e.h===h.h&&e.v===h.v);o.assert(m>=0);let p=!0;for(let o=m;o<d+m;++o){const l=u[o%d],h=o===m&&c,f=R(e,t,l,i,n,r,s,!h,y);if(f===L.Ok)return a.copy(y),L.Ok;h&&a.copy(y),p=p&&f===L.Invisible}return p?L.Invisible:L.Rejected}(e,t,i,n,r,s,a):function(e,t,i,n,r,s,a){o.assert(void 0!==e.element.layoutStyle);const l=e.textPlacement;return R(e,t,l,i,n,r,s,!e.visible,a)}(e,t,i,n,r,s,a)},t.placePathLabel=function(e,t,i,n,r){if(b.path=t,b.outputCharacterBounds=w,b.letterCaseArray=e.element.glyphCaseArray,!n.measureText(e.element.glyphs,_,b))return L.Rejected;if(T.copy(_.translate(i)),!r.isVisible(T))return L.Invisible;let s,o=!1;e.element.textMayOverlap||(s=r.search(T),o=s.length>0),M.length=w.length;for(let e=0;e<w.length;++e){const t=w[e].translate(i);let n=M[e];if(void 0===n?(n=new c.CollisionBox(t),M[e]=n):n.copy(t),o&&r.intersectsDetails(n,s))return L.Rejected}if(e.element.textReservesSpace){const e=new c.DetailedCollisionBox(T,M.slice());M.length=0,r.allocate(e)}return L.Ok},t.isPathLabelTooSmall=function(e,t,i){o.assert(e.type===u.TextElementType.PathLabel),i.length=0;let n=!1;for(const r of e.points){void 0!==(n?t.project(r,S):t.projectToScreen(r,S))&&(n=!0,i.push(S.clone()))}if(!n)return!0;const r=5*e.text.length;return _.setFromPoints(i),_.max.sub(_.min).lengthSq()<r*r&&(e.dbgPathTooSmall=!0,!0)};const O=new r.OrientedBox3;t.getWorldPosition=function(e,t,i,r){var s,o;const l=n.getPropertyValue(null===(o=null===(s=e.poiInfo)||void 0===s?void 0:s.technique)||void 0===o?void 0:o.worldOffset,i);if(null==r||r.copy(e.position),null!=l&&void 0!==e.offsetDirection){t.localTangentSpace(e.position,O);const i=O.yAxis,n=a.MathUtils.degToRad(e.offsetDirection);i.applyAxisAngle(O.zAxis.negate(),n),r.addScaledVector(O.yAxis,l)}return r}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLineMarkerElementState=t.TextElementState=void 0;const n=i(8),r=i(1),s=i(301),o=i(302),a=i(17);t.TextElementState=class{constructor(e,t){this.element=e,this.m_lineMarkerIndex=t}get initialized(){return void 0!==this.m_textRenderState||void 0!==this.m_iconRenderState}get visible(){if(void 0!==this.m_textRenderState&&this.m_textRenderState.isVisible())return!0;const e=this.iconRenderState;return!(void 0===e||!e.isVisible())}get textPlacement(){const e=this.element.layoutStyle,t=this.m_textLayoutState;return void 0!==t?t.textPlacement:{h:n.hPlacementFromAlignment(e.horizontalAlignment),v:n.vPlacementFromAlignment(e.verticalAlignment)}}set textPlacement(e){void 0===this.m_textLayoutState&&!0===this.isBaseTextPlacement(e)||(void 0===this.m_textLayoutState?this.m_textLayoutState=new s.LayoutState(e):this.m_textLayoutState.textPlacement=e)}isBaseTextPlacement(e){const t=this.element.layoutStyle;if(void 0!==t)return n.hAlignFromPlacement(e.h)===t.horizontalAlignment&&n.vAlignFromPlacement(e.v)===t.verticalAlignment}reset(){void 0!==this.m_textRenderState&&this.m_textRenderState.reset(),void 0!==this.m_textLayoutState&&(void 0!==this.element.layoutStyle?this.m_textLayoutState.reset(this.element.layoutStyle):this.m_textLayoutState=void 0),this.iconRenderState&&this.m_iconRenderState.reset(),this.m_viewDistance=void 0,this.element.textBufferObject=void 0,this.element.bounds=void 0}replace(e){this.m_textRenderState=e.m_textRenderState,this.m_textLayoutState=e.m_textLayoutState,this.m_iconRenderState=e.m_iconRenderState,e.m_textRenderState=void 0,e.m_textLayoutState=void 0,e.m_iconRenderState=void 0,void 0===this.element.glyphs&&(this.element.glyphs=e.element.glyphs,this.element.glyphCaseArray=e.element.glyphCaseArray),this.element.bounds=void 0,this.element.textBufferObject=void 0}get viewDistance(){return this.m_viewDistance}update(e){this.initialized||void 0===e||this.initializeRenderStates(),this.setViewDistance(e)}setViewDistance(e){this.m_viewDistance=e}get renderDistance(){return!0===this.element.alwaysOnTop?0:void 0!==this.m_viewDistance?-this.m_viewDistance:0}get textRenderState(){return this.m_textRenderState}get iconRenderState(){return this.m_iconRenderState}get lineMarkerIndex(){return this.m_lineMarkerIndex}get position(){return void 0!==this.element.path&&void 0!==this.m_lineMarkerIndex?this.element.path[this.m_lineMarkerIndex]:this.element.position}updateFading(e,t){void 0!==this.m_textRenderState&&this.m_textRenderState.updateFading(e,t),void 0!==this.iconRenderState&&this.iconRenderState.updateFading(e,t)}initializeRenderStates(){var e;r.assert(void 0===this.m_textRenderState),r.assert(void 0===this.m_textLayoutState),r.assert(void 0===this.m_iconRenderState);const{textFadeTime:t}=this.element;if(this.m_textRenderState=new o.RenderState(t),this.element.type===a.TextElementType.PoiLabel||this.element.type===a.TextElementType.LineMarker){const i=null===(e=this.element.poiInfo)||void 0===e?void 0:e.technique.iconFadeTime,n=void 0!==i?1e3*i:t;this.m_iconRenderState=new o.RenderState(n)}}},t.isLineMarkerElementState=function(e){return void 0!==e.m_lineMarkerIndex}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextStyleCache=void 0;const n=i(3),r=i(8),s=i(1),o=i(80),a=i(25),l=i(47),c=s.LoggerManager.instance.create("TextStyleCache"),h=new r.TextRenderStyle({fontSize:{unit:r.FontUnit.Pixel,size:32,backgroundSize:8},color:o.ColorCache.instance.getColor("#6d7477"),opacity:1,backgroundColor:o.ColorCache.instance.getColor("#f7fbfd"),backgroundOpacity:.5}),u=new r.TextLayoutStyle({verticalAlignment:r.VerticalAlignment.Center,horizontalAlignment:r.HorizontalAlignment.Center,placements:[]});function d(e,t,i){const s=i?function(e){const t=[];return(e?e.toUpperCase().replace(" ","").split(","):[]).forEach(e=>{const i=function(e){if(e.length<1||e.length>2)return;const t={h:r.HorizontalPlacement.Center,v:r.VerticalPlacement.Center};let i=e.charAt(0),s=!0;switch(i){case n.PlacementToken.Top:case n.PlacementToken.North:t.v=r.VerticalPlacement.Top;break;case n.PlacementToken.Bottom:case n.PlacementToken.South:t.v=r.VerticalPlacement.Bottom;break;default:if(s=!1,2===e.length)return}if(s&&1===e.length)return t;switch(i=1===e.length?e.charAt(0):e.charAt(1),i){case n.PlacementToken.Right:case n.PlacementToken.East:t.h=r.HorizontalPlacement.Right;break;case n.PlacementToken.Left:case n.PlacementToken.West:t.h=r.HorizontalPlacement.Left;break;default:return}return t}(e);void 0!==i&&t.push(i)}),t}(i):void 0;return r.resolvePlacementAndAlignment(function(e){return"Left"===e||"Center"===e||"Right"===e?r.HorizontalAlignment[e]:u.horizontalAlignment}(e),function(e){return"Above"===e||"Center"===e||"Below"===e?r.VerticalAlignment[e]:u.verticalAlignment}(t),s)}t.TextStyleCache=class{constructor(){this.m_textStyles=new Map,this.m_defaultStyle={name:"default",fontCatalog:void 0,renderParams:h.params,layoutParams:u.params},this.updateDefaultTextStyle()}updateTextStyles(e,t){this.m_textStyles.clear(),null==e||e.forEach(e=>{this.m_textStyles.set(e.name,this.createTextElementStyle(e,e.name))}),this.updateDefaultTextStyle(t,e)}updateTextCanvases(e){this.initializeTextCanvas(this.m_defaultStyle,e);for(const[,t]of this.m_textStyles)this.initializeTextCanvas(t,e)}getTextElementStyle(e){let t;return void 0===e?t=this.m_defaultStyle:(t=this.m_textStyles.get(e),void 0===t&&(t=this.m_defaultStyle)),t}createRenderStyle(e,t){const i=e.mapView,l=i.zoomLevel,c=Math.floor(l),h=new n.MapEnv({$zoom:c},i.env),u=this.m_defaultStyle.renderParams,d=s.getOptionValue(u.opacity,1);let m,p=n.getPropertyValue(s.getOptionValue(t.opacity,d),h);if(void 0!==t.color){let e=a.evaluateColorProperty(t.color,h);if(void 0!==e){if(n.ColorUtils.hasAlphaInHex(e)){p*=n.ColorUtils.getAlphaFromHex(e),e=n.ColorUtils.removeAlphaFromHex(e)}m=o.ColorCache.instance.getColor(e)}}const f=s.getOptionValue(u.fontSize.backgroundSize,0),g=n.getPropertyValue(s.getOptionValue(t.backgroundSize,f),h),v=void 0!==t.backgroundColor&&void 0!==t.backgroundSize&&g>0,y=s.getOptionValue(u.backgroundOpacity,0);let _,x=n.getPropertyValue(s.getOptionValue(t.backgroundOpacity,v?1:y),h);if(void 0!==t.backgroundColor){let e=a.evaluateColorProperty(t.backgroundColor,h);if(void 0!==e){if(n.ColorUtils.hasAlphaInHex(e)){x*=n.ColorUtils.getAlphaFromHex(e),e=n.ColorUtils.removeAlphaFromHex(e)}_=o.ColorCache.instance.getColor(e)}}const w={fontName:s.getOptionValue(t.fontName,u.fontName),fontSize:{unit:r.FontUnit.Pixel,size:n.getPropertyValue(s.getOptionValue(t.size,u.fontSize.size),h),backgroundSize:g},fontStyle:"Regular"===t.fontStyle||"Bold"===t.fontStyle||"Italic"===t.fontStyle||"BoldItalic"===t.fontStyle?r.FontStyle[t.fontStyle]:u.fontStyle,fontVariant:"Regular"===t.fontVariant||"AllCaps"===t.fontVariant||"SmallCaps"===t.fontVariant?r.FontVariant[t.fontVariant]:u.fontVariant,rotation:s.getOptionValue(t.rotation,u.rotation),color:s.getOptionValue(m,s.getOptionValue(u.color,r.DefaultTextStyle.DEFAULT_COLOR)),backgroundColor:s.getOptionValue(_,s.getOptionValue(u.backgroundColor,r.DefaultTextStyle.DEFAULT_BACKGROUND_COLOR)),opacity:p,backgroundOpacity:x},b=this.getTextElementStyle(t.style).renderParams;return new r.TextRenderStyle(Object.assign(Object.assign({},b),w))}createLayoutStyle(e,t){var i,s,o,a,l,c;const h=e.mapView,u=Math.floor(e.mapView.zoomLevel),m=new n.MapEnv({$zoom:u},h.env),p=this.m_defaultStyle.layoutParams,f=n.getPropertyValue(t.hAlignment,m),g=n.getPropertyValue(t.vAlignment,m),v=n.isPoiTechnique(t)?n.getPropertyValue(t.placements,m):null,{horizontalAlignment:y,verticalAlignment:_,placements:x}=d(f,g,v),w=n.getPropertyValue(t.wrappingMode,m),b="None"===w||"Character"===w||"Word"===w?r.WrappingMode[w]:p.wrappingMode,M={tracking:null!==(i=n.getPropertyValue(t.tracking,m))&&void 0!==i?i:p.tracking,leading:null!==(s=n.getPropertyValue(t.leading,m))&&void 0!==s?s:p.leading,maxLines:null!==(o=n.getPropertyValue(t.maxLines,m))&&void 0!==o?o:p.maxLines,lineWidth:null!==(a=n.getPropertyValue(t.lineWidth,m))&&void 0!==a?a:p.lineWidth,canvasRotation:null!==(l=n.getPropertyValue(t.canvasRotation,m))&&void 0!==l?l:p.canvasRotation,lineRotation:null!==(c=n.getPropertyValue(t.lineRotation,m))&&void 0!==c?c:p.lineRotation,wrappingMode:b,horizontalAlignment:y,verticalAlignment:_,placements:x},T=this.getTextElementStyle(t.style);return new r.TextLayoutStyle(Object.assign(Object.assign({},T),M))}updateDefaultTextStyle(e,t){var i,n;this.m_defaultStyle.fontCatalog=void 0;const r=null!==(n=null!==(i=null==t?void 0:t.find(e=>"default"===e.name))&&void 0!==i?i:e)&&void 0!==n?n:null==t?void 0:t[0];r&&(this.m_defaultStyle=this.createTextElementStyle(r,"default")),this.m_defaultStyle.textCanvas=void 0}initializeTextCanvas(e,t){var i;if(!e.textCanvas){if(void 0!==e.fontCatalog){const i=t.get(e.fontCatalog);if(e.textCanvas=i,t.has(e.fontCatalog)&&!i)return void c.info(`fontCatalog(${e.fontCatalog}), not yet loaded`)}if(void 0===e.textCanvas){void 0!==e.fontCatalog&&e.fontCatalog!==l.DEFAULT_FONT_CATALOG_NAME&&c.warn(`FontCatalog '${e.fontCatalog}' set in TextStyle\n                     '${e.name}' not found`);let n=t.get(l.DEFAULT_FONT_CATALOG_NAME);if(!n&&t.size>0)for(const[,e]of t)if(e){n=e;break}n&&(e.textCanvas=n,void 0!==e.fontCatalog&&c.info(`fontCatalog: '${e.fontCatalog}' not found,\n                      using default fontCatalog(${null===(i=e.textCanvas)||void 0===i?void 0:i.name}).`))}}}createTextElementStyle(e,t){var i;const{horizontalAlignment:n,verticalAlignment:a,placements:l}=d(e.hAlignment,e.vAlignment,e.placements);return{name:t,fontCatalog:s.getOptionValue(e.fontCatalogName,this.m_defaultStyle.fontCatalog),renderParams:{fontName:e.fontName,fontSize:{unit:r.FontUnit.Pixel,size:32,backgroundSize:null!==(i=e.backgroundSize)&&void 0!==i?i:8},fontStyle:"Regular"===e.fontStyle||"Bold"===e.fontStyle||"Italic"===e.fontStyle||"BoldItalic"===e.fontStyle?r.FontStyle[e.fontStyle]:void 0,fontVariant:"Regular"===e.fontVariant||"AllCaps"===e.fontVariant||"SmallCaps"===e.fontVariant?r.FontVariant[e.fontVariant]:void 0,rotation:e.rotation,color:void 0!==e.color?o.ColorCache.instance.getColor(e.color):void 0,backgroundColor:void 0!==e.backgroundColor?o.ColorCache.instance.getColor(e.backgroundColor):void 0,opacity:e.opacity,backgroundOpacity:e.backgroundOpacity},layoutParams:{tracking:e.tracking,leading:e.leading,maxLines:e.maxLines,lineWidth:e.lineWidth,canvasRotation:e.canvasRotation,lineRotation:e.lineRotation,wrappingMode:"None"===e.wrappingMode||"Character"===e.wrappingMode||"Word"===e.wrappingMode?r.WrappingMode[e.wrappingMode]:r.WrappingMode.Word,verticalAlignment:a,horizontalAlignment:n,placements:l}}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiTableManager=t.PoiTable=void 0;const n=i(3),r=i(1).LoggerManager.instance.create("PoiTable");class s{static verifyJSON(e){let t="string"==typeof e.name&&e.name.length>0&&(void 0===e.altNames||Array.isArray(e.altNames))&&(void 0===e.stackMode||"yes"===e.stackMode||"no"===e.stackMode||"parent"===e.stackMode)&&(void 0===e.visible||"boolean"==typeof e.visible)&&(void 0===e.priority||"number"==typeof e.priority)&&(void 0===e.iconMinLevel||"number"==typeof e.iconMinLevel)&&(void 0===e.iconMaxLevel||"number"==typeof e.iconMaxLevel)&&(void 0===e.textMinLevel||"number"==typeof e.textMinLevel)&&(void 0===e.textMaxLevel||"number"==typeof e.textMaxLevel);if(t&&void 0!==e.altNames){const i=e.altNames;for(const e in i)if("string"!=typeof e){t=!1;break}}return t}setup(e){switch(this.name=e.name,this.altNames=e.altNames,this.iconName=e.iconName,this.visible=e.visible,this.priority=e.priority,this.iconMinLevel=e.iconMinLevel,this.iconMaxLevel=e.iconMaxLevel,this.textMinLevel=e.textMinLevel,this.textMaxLevel=e.textMaxLevel,e.stackMode){case"yes":this.stackMode=n.PoiStackMode.Show;break;case"no":this.stackMode=n.PoiStackMode.Hide;break;case"parent":this.stackMode=n.PoiStackMode.ShowParent}}}class o{constructor(e,t){this.name=e,this.useAltNamesForKey=t,this.poiList=new Array,this.poiDict=new Map,this.m_isLoading=!1,this.m_loadedOk=void 0}get isLoading(){return this.m_isLoading}get loadedOk(){return!0===this.m_loadedOk}getEntry(e){const t=this.poiDict.get(e);if(void 0!==t){if(t<this.poiList.length)return this.poiList[t];throw new Error("Poi table entry index out of stored list!")}}async load(e,t){if(void 0!==this.m_loadedOk)return!0;this.m_loadedOk=!1;const i=await fetch(e,{signal:t});if(!i.ok)throw new Error(`load: Cannot load POI table at ${e}: `+i.statusText);const n=await i.json();if(void 0===n)return r.info("load: TextureAtlas empty: "+e),!0;this.startLoading();try{if(r.debug(`load: Loading POI table '${e}' for table '${this.name}'`),void 0!==n.poiList&&Array.isArray(n.poiList))for(const t of n.poiList)if(s.verifyJSON(t)){const i=new s;i.setup(t);const n=this.poiList.push(i)-1;if(this.useAltNamesForKey)if(void 0!==i.altNames&&i.altNames.length>0)for(const e of i.altNames)this.poiDict.set(e,n);else r.debug(`load: Invalid entry in POI table '${e}' : No alternative names set in entry: ${JSON.stringify(t)}.`);else void 0===i.name?r.warn(`load: Invalid entry in POI table '${e}' : . No name set in entry: ${t}.`):this.poiDict.set(i.name,n)}else r.warn(`load: Invalid entry in POI table '${e}' : ${JSON.stringify(t)}`);this.m_loadedOk=!0,this.finishedLoading()}catch(t){return r.error(`load: Failed to load POI table '${e}' : ${t}`),this.m_loadedOk=!1,this.finishedLoading(),!1}return!0}startLoading(){this.m_isLoading=!0}finishedLoading(){this.m_isLoading=!1}}t.PoiTable=o;t.PoiTableManager=class{constructor(e){this.mapView=e,this.m_isLoading=!1,this.m_poiTables=new Map,this.m_abortControllers=new Map}async loadPoiTables(e){return new Promise(t=>{if(this.clear(),void 0!==e){this.startLoading();const i=new Array;e.forEach(e=>{var t;if(void 0!==e&&void 0!==e.name&&"string"==typeof e.name){const n=new o(e.name,!1!==e.useAltNamesForKey);void 0!==e.url&&"string"==typeof e.url?(this.addTable(n),this.m_abortControllers.set(e.name,new AbortController),i.push(n.load(e.url,null===(t=this.m_abortControllers.get(e.name))||void 0===t?void 0:t.signal))):r.error("POI table definition has no valid url: "+e)}else r.error("POI table definition has no valid name: "+e)}),i.length>0?Promise.all(i).finally(()=>{this.finishLoading(),t()}):(this.finishLoading(),t())}else this.finishLoading(),t()})}clear(){this.m_poiTables=new Map,this.m_abortControllers.forEach((e,t)=>{e.abort(),this.m_abortControllers.delete(t)})}get poiTables(){return this.m_poiTables}addTable(e){this.m_poiTables.set(e.name,e)}getPoiTable(e){return void 0===e?void 0:this.m_poiTables.get(e)}get finishedLoading(){return!this.m_isLoading}startLoading(){this.m_isLoading=!0}finishLoading(){this.m_isLoading=!1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolarTileDataSource=void 0;const n=i(3),r=i(48),s=i(2),o=i(0),a=i(67),l=i(25),c=i(33),h=i(36),u=i(24);class d extends a.DataSource{constructor({name:e="polar",styleSetName:t="polar",minDataLevel:i,maxDataLevel:n,minDisplayLevel:r,maxDisplayLevel:a,storageLevelOffset:l=-2,geometryLevelOffset:c=1,debugTiles:h=!1}){super({name:e,styleSetName:t,minDataLevel:i,maxDataLevel:n,minDisplayLevel:r,maxDisplayLevel:a,storageLevelOffset:l}),this.m_tilingScheme=s.polarTilingScheme,this.m_maxLatitude=o.MathUtils.radToDeg(s.MercatorConstants.MAXIMUM_LATITUDE),this.m_geometryLevelOffset=c,this.m_debugTiles=h,this.cacheable=!1,this.enablePicking=!1}dispose(){this.m_northPoleEntry&&(this.m_northPoleEntry.material.dispose(),delete this.m_northPoleEntry),this.m_southPoleEntry&&(this.m_southPoleEntry.material.dispose(),delete this.m_southPoleEntry),this.m_styleSetEvaluator&&delete this.m_styleSetEvaluator}createTechiqueEntry(e){if(!this.m_styleSetEvaluator)return;const t=new r.MapEnv({$geometryType:"polygon",$layer:"earth",kind:e}),i=this.m_styleSetEvaluator.getMatchingTechniques(t);if(0===i.length)return;const n=i[0],s=l.createMaterial(this.mapView.renderer.capabilities,{technique:n,env:this.mapView.env});return s?{material:s,technique:n}:void 0}async setTheme(e){let t;e=await h.ThemeLoader.load(e),void 0!==this.styleSetName&&void 0!==e.styles&&(t=e.styles[this.styleSetName]),this.m_styleSetEvaluator=new r.StyleSetEvaluator({styleSet:null!=t?t:[],definitions:e.definitions,priorities:e.priorities,labelPriorities:e.labelPriorities}),this.m_northPoleEntry=this.createTechiqueEntry("north_pole"),this.m_southPoleEntry=this.createTechiqueEntry("south_pole"),this.mapView.markTilesDirty(this)}canGetTile(e,t){if(e!==t.level||t.level<1)return!1;const{north:i,south:n}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||n<-this.m_maxLatitude}shouldSubdivide(e,t){if(e<=t.level)return!1;const{north:i,south:n}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||n<-this.m_maxLatitude}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new u.Tile(this,e);return this.createTileGeometry(t),t}get geometryLevelOffset(){return this.m_geometryLevelOffset}set geometryLevelOffset(e){this.m_geometryLevelOffset=e}intersectEdge(e,t,i){const n=t.latitude,r=i.latitude;let o=t.longitude,a=i.longitude;90===Math.abs(n)&&(o=a),90===Math.abs(r)&&(a=o);const l=a-o,c=(e-n)/(r-n);return new s.GeoCoordinates(e,o+l*c,0)}createTileGeometry(e){const{north:t,south:i}=e.geoBox,r=t>0&&i>=0,a=r?this.m_northPoleEntry:this.m_southPoleEntry;if(void 0===a)return void e.forceHasGeometry(!0);const l=this.m_tilingScheme.projection,h=this.projection,u=this.m_maxLatitude,d=r?u:-u,m=this.m_tilingScheme.boundingBoxGenerator.getWorldBox(e.tileKey),p=l.unprojectPoint(new o.Vector3(m.min.x,m.min.y,0)),f=l.unprojectPoint(new o.Vector3(m.max.x,m.min.y,0)),g=l.unprojectPoint(new o.Vector3(m.max.x,m.max.y,0)),v=l.unprojectPoint(new o.Vector3(m.min.x,m.max.y,0));let y,_=!1;if(1===e.tileKey.level){const e=0===m.min.x,t=e?m.max.x:m.min.x,i=(m.max.y+m.min.y)/2,n=l.unprojectPoint(new o.Vector3(t,i,0)),s=e?p:f;y=r?e?[n,g,s,f]:[n,p,s,v]:e?[n,f,s,g]:[n,v,s,p],_=!0}else{y=r?[p,f,g,v]:[p,v,g,f];const e=y.map(e=>e.latitude),t=Math.max(...e),i=Math.min(...e);if(r?t<d:i>d)return;if(_=r?i<d:t>d,_){const n=e.indexOf(r?t:i);if(0!==n)for(let e=0;e<n;e++)y.push(y.shift())}}if(_){const t=(m.min.x+m.max.x)/2,i=(m.min.y+m.max.y)/2,n=l.unprojectPoint(new o.Vector3(t,i,0));s.TransverseMercatorUtils.alignLongitude(y,n);const r=y[0],a=y[1],c=y[2],h=y[3],p=Math.abs(a.latitude)>=u,f=Math.abs(h.latitude)>=u,g=p?this.intersectEdge(d,a,c):this.intersectEdge(d,r,a),v=f?this.intersectEdge(d,h,c):this.intersectEdge(d,r,h);y.splice(p?2:1,4,g);const _=e.tileKey.level-this.storageLevelOffset+this.m_geometryLevelOffset,x=360/(1<<Math.max(0,_)),w=Math.floor((g.longitude+180)/x),b=Math.ceil((v.longitude+180)/x);for(let e=w+1;e<b;e++)y.push(new s.GeoCoordinates(d,e*x-180,0));y.push(v),f&&y.push(h)}const x=new o.BufferGeometry,w=y.map(t=>{const i=h.projectPoint(t,new o.Vector3);return i.sub(e.center),i});x.setFromPoints(w);const b=[];for(let e=1;e<w.length-1;e++)r?b.push(0,e,e+1):b.push(0,e+1,e);x.setIndex(b);const M=new o.Mesh(x,a.material);if(M.userData={dataSource:this.name,tileKey:e.tileKey},this.m_debugTiles){const t=Math.round(16777215*Math.abs(Math.sin(11*e.tileKey.mortonCode())));M.material=new o.MeshBasicMaterial({color:t,transparent:!0,opacity:.5}),e.objects.push(new o.Mesh(x,new o.MeshBasicMaterial({color:t,wireframe:!0})))}c.MapObjectAdapter.create(M,{dataSource:this,technique:a.technique,kind:[r?n.StandardGeometryKind.Water:n.StandardGeometryKind.Background]}),e.objects.push(M)}}t.PolarTileDataSource=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisibleTileSet=t.ResourceComputationType=void 0;const n=i(2),r=i(77),s=i(1),o=i(0),a=i(46),l=i(134),c=i(15);var h,u;!function(e){e[e.EstimationInMb=0]="EstimationInMb",e[e.NumberOfTiles=1]="NumberOfTiles"}(h=t.ResourceComputationType||(t.ResourceComputationType={})),function(e){e[e.NONE=0]="NONE",e[e.UP=1]="UP",e[e.DOWN=2]="DOWN",e[e.BOTH=3]="BOTH"}(u||(u={}));class d{constructor(e,t=h.EstimationInMb){this.m_disposedTiles=[],this.m_resourceComputationType=t,this.m_tileCache=new r.LRUCache(e,e=>this.m_resourceComputationType===h.EstimationInMb?e.memoryUsage*(1/1048576):1),this.m_tileCache.evictionCallback=(e,t)=>{void 0!==t.tileLoader&&t.tileLoader.cancel(),this.m_disposedTiles.push(t)},this.m_tileCache.canEvict=(e,t)=>!t.isVisible}static getKey(e,t,i){return`${i.name}_${e}_${t}`}static getKeyForTile(e){return d.getKey(e.tileKey.mortonCode(),e.offset,e.dataSource)}get resourceComputationType(){return this.m_resourceComputationType}get capacity(){return this.m_tileCache.capacity}get size(){return this.m_tileCache.size}setCapacity(e,t){this.m_resourceComputationType=t,this.m_tileCache.setCapacityAndMeasure(e,e=>this.m_resourceComputationType===h.EstimationInMb?e.memoryUsage*(1/1048576):1)}get(e,t,i){return this.m_tileCache.get(d.getKey(e,t,i))}set(e,t,i,n){this.m_tileCache.set(d.getKey(e,t,i),n)}delete(e){const t=d.getKeyForTile(e);this.deleteByKey(t)}deleteByKey(e){this.m_tileCache.delete(e)}disposeTiles(){this.m_disposedTiles.forEach(e=>{e.dispose()}),this.m_disposedTiles.length=0}shrinkToCapacity(){this.m_tileCache.shrinkToCapacity()}evictAll(){this.m_tileCache.evictAll()}evictSelected(e){this.m_tileCache.evictSelected(e)}forEach(e,t){this.m_tileCache.forEach((i,n)=>{void 0!==t&&i.dataSource!==t||e(i,n)})}}const m=(e,t)=>{const i=e.distance-t.distance,n=1e-6*(e.distance+t.distance);return Math.abs(i)<n?e.tileKey.mortonCode()-t.tileKey.mortonCode():i};t.VisibleTileSet=class{constructor(e,t,i,n){var r;this.m_frustumIntersection=e,this.m_tileGeometryManager=t,this.options=i,this.m_taskQueue=n,this.dataSourceTileList=[],this.allVisibleTilesLoaded=!1,this.m_cameraOverride=new o.PerspectiveCamera,this.m_viewRange={near:.1,far:1/0,minimum:.1,maximum:1/0},this.m_coveringMap=new Map,this.m_resourceComputationType=h.EstimationInMb,this.options=i,this.options.maxTilesPerFrame=Math.floor(null!==(r=this.options.maxTilesPerFrame)&&void 0!==r?r:0),this.m_resourceComputationType=void 0===i.resourceComputationType?h.EstimationInMb:i.resourceComputationType,this.m_dataSourceCache=new d(this.options.tileCacheSize,this.m_resourceComputationType)}getDataSourceCacheSize(){return this.options.tileCacheSize}setDataSourceCacheSize(e,t=h.EstimationInMb){this.options.tileCacheSize=e,this.resourceComputationType=t}getNumberOfVisibleTiles(){return this.options.maxVisibleDataSourceTiles}setNumberOfVisibleTiles(e){this.options.maxVisibleDataSourceTiles=e}get maxTilesPerFrame(){return this.options.maxTilesPerFrame}set maxTilesPerFrame(e){if(e<0)throw new Error("Invalid value, this will result in no tiles ever showing");this.options.maxTilesPerFrame=Math.floor(e)}get resourceComputationType(){return this.m_resourceComputationType}set resourceComputationType(e){this.m_resourceComputationType=e,this.m_dataSourceCache.setCapacity(this.options.tileCacheSize,e)}updateClipPlanes(e,t){void 0!==e&&(this.options.clipPlanesEvaluator.maxElevation=e),void 0!==t&&(this.options.clipPlanesEvaluator.minElevation=t);const{camera:i,projection:n,elevationProvider:r}=this.m_frustumIntersection.mapView;return this.m_viewRange=this.options.clipPlanesEvaluator.evaluateClipPlanes(i,n,r),this.m_viewRange}updateRenderList(e,t,i,n,r){let o=!0;const a=this.getVisibleTileKeysForDataSources(t,i,r);this.dataSourceTileList=[],this.m_coveringMap.clear();for(const{dataSource:i,visibleTileKeys:r}of a.tileKeys){r.sort(m);const s=i.getDataZoomLevel(t),a=this.processVisibleTiles(r,i,n,{newTilesPerFrame:0},!0),l=this.processVisibleTiles(a.dependentTiles,i,n,{newTilesPerFrame:0},!1);this.m_tileGeometryManager.updateTiles(a.visibleTiles),this.m_tileGeometryManager.updateTiles(l.visibleTiles),this.dataSourceTileList.push({dataSource:i,storageLevel:e,zoomLevel:s,allVisibleTileLoaded:a.allDataSourceTilesLoaded&&l.allDataSourceTilesLoaded,numTilesLoading:a.numTilesLoading+l.numTilesLoading,visibleTiles:[...a.visibleTiles,...l.visibleTiles],renderedTiles:new Map}),o=o&&a.allDataSourceTilesLoaded}let l,c;this.allVisibleTilesLoaded=o&&a.allBoundingBoxesFinal,this.populateRenderedTiles(),this.forEachCachedTile(e=>{e.isVisible||e.allGeometryLoaded||this.disposeTile(e)}),this.m_dataSourceCache.shrinkToCapacity(),this.dataSourceTileList.forEach(e=>{e.renderedTiles.forEach(t=>{t.update(e.zoomLevel),l=s.MathUtils.min2(l,t.geoBox.minAltitude),c=s.MathUtils.max2(c,t.geoBox.maxAltitude)})}),void 0===l&&(l=0),void 0===c&&(c=0);let h=!1;const u=this.m_viewRange,d=this.updateClipPlanes(c,l);var p,f;return h=!1==(f=u,(p=d).far===f.far&&p.maximum===f.maximum&&p.minimum===f.minimum&&p.near===f.near),{viewRanges:d,viewRangesChanged:h}}getTile(e,t,i,n){return this.getTileImpl(e,t,i,!1,n)}getCachedTile(e,t,i,n){s.assert(e.cacheable);return this.getTileImpl(e,t,i,!0,n)}getRenderedTile(e,t,i=0){const r=this.dataSourceTileList.find(t=>t.dataSource===e);if(void 0!==r)return r.renderedTiles.get(n.TileKeyUtils.getKeyForTileKeyAndOffset(t,i))}getRenderedTileAtLocation(e,t,i=0){const r=this.dataSourceTileList.find(t=>t.dataSource===e);if(void 0===r)return;const s=e.getTilingScheme(),o=r.zoomLevel,a=s.getTileKey(t,o);if(!a)return;let l=r.renderedTiles.get(n.TileKeyUtils.getKeyForTileKeyAndOffset(a,i));if(void 0!==l)return l;const{searchLevelsUp:c,searchLevelsDown:h}=this.getSearchDirection(e,o);let u=a;for(let e=1;e<=c;++e)if(u=u.parent(),l=r.renderedTiles.get(n.TileKeyUtils.getKeyForTileKeyAndOffset(u,i)),void 0!==l)return l;const d=s.projection.projectPoint(t);for(let e=1;e<=h;++e){const t=o+e,a=n.TileKeyUtils.worldCoordinatesToTileKey(s,d,t);if(a&&(l=r.renderedTiles.get(n.TileKeyUtils.getKeyForTileKeyAndOffset(a,i)),void 0!==l))return l}}removeDataSource(e){this.clearTileCache(e),this.dataSourceTileList=this.dataSourceTileList.filter(t=>t.dataSource!==e)}clearTileCache(e,t){void 0!==e?this.m_dataSourceCache.evictSelected((i,n)=>i.dataSource===e&&(void 0===t||t(i))):void 0!==t?this.m_dataSourceCache.evictSelected(t):this.m_dataSourceCache.evictAll()}markTilesDirty(e,t){if(void 0===e)this.dataSourceTileList.forEach(e=>{this.markDataSourceTilesDirty(e,t)});else{const i=this.dataSourceTileList.find(t=>t.dataSource===e);if(void 0===i)return;this.markDataSourceTilesDirty(i,t)}}disposePendingTiles(){this.m_dataSourceCache.disposeTiles()}forEachVisibleTile(e){for(const t of this.dataSourceTileList)t.renderedTiles.forEach(e)}forEachCachedTile(e,t){this.m_dataSourceCache.forEach((t,i)=>e(t),t)}disposeTile(e){this.m_dataSourceCache.delete(e),e.dispose()}processVisibleTiles(e,t,i,n,r){var s;let o=!0,a=0;const c=[],h=[];for(let u=0;u<e.length&&c.length<this.options.maxVisibleDataSourceTiles;u++){const d=e[u],m=this.getTile(t,d.tileKey,d.offset,i);if(void 0!==m&&(c.push(m),o=o&&m.allGeometryLoaded,m.allGeometryLoaded?(this.skipOverlappedTiles(t,m),this.processDelayTileRendering(m,n.newTilesPerFrame,i)&&n.newTilesPerFrame++):a++,m.visibleArea=d.area,m.elevationRange=null!==(s=d.elevationRange)&&void 0!==s?s:{minElevation:0,maxElevation:0},r))for(const t of m.dependencies)void 0===e.find(e=>e.tileKey.mortonCode()===t.mortonCode())&&void 0===h.find(e=>e.tileKey.mortonCode()===t.mortonCode())&&h.push(new l.TileKeyEntry(t,0))}return{allDataSourceTilesLoaded:o,numTilesLoading:a,visibleTiles:c,dependentTiles:h}}processDelayTileRendering(e,t,i){let n=!1;return 0!==this.options.maxTilesPerFrame&&t>this.options.maxTilesPerFrame&&e.frameNumLastVisible!==i-1?(e.delayRendering=!0,e.mapView.update()):(e.frameNumVisible<0&&(e.frameNumVisible=i,n=!0),e.numFramesVisible++,e.delayRendering=!1),n}skipOverlappedTiles(e,t){if(this.options.projection.type!==n.ProjectionType.Spherical&&e.isFullyCovering()){const i=t.uniqueKey,n=this.m_coveringMap.get(i);void 0===n?(t.skipRendering=!1,this.m_coveringMap.set(i,t)):n.dataSource instanceof a.BackgroundDataSource?n.skipRendering=!0:e instanceof a.BackgroundDataSource&&(t.skipRendering=!0)}}getSearchDirection(e,t){const i=Math.min(this.options.quadTreeSearchDistanceUp,Math.max(0,t-e.minDataLevel)),n=Math.min(this.options.quadTreeSearchDistanceDown,Math.max(0,e.maxDataLevel-t));return{searchDirection:n>0&&i>0?u.BOTH:n>0?u.DOWN:i>0?u.UP:u.NONE,searchLevelsUp:i,searchLevelsDown:n}}populateRenderedTiles(){this.dataSourceTileList.forEach(e=>{const t=e.renderedTiles,i=[];e.visibleTiles.forEach(e=>{e.levelOffset=0,e.hasGeometry&&!e.delayRendering?t.set(e.uniqueKey,e):i.push(e.uniqueKey)});const n=e.dataSource;if(0===i.length||!1===n.allowOverlappingTiles)return;const r=e.zoomLevel,{searchDirection:s}=this.getSearchDirection(n,r),o=new Map;for(const e of i)(s!==u.BOTH&&s!==u.UP||!this.findUp(e,r,t,o,n))&&(s!==u.BOTH&&s!==u.DOWN||this.findDown(e,r,t,n))})}findDown(e,t,i,r){const{offset:s,mortonCode:o}=n.TileKeyUtils.extractOffsetAndMortonKeyFromKey(e),a=n.TileKey.fromMortonCode(o),l=r.getTilingScheme();for(const e of l.getSubTileKeys(a)){const o=n.TileKeyUtils.getKeyForTileKeyAndOffset(e,s),a=this.m_dataSourceCache.get(e.mortonCode(),s,r),l=Math.abs(e.level-t);void 0===a||!a.hasGeometry||a.delayRendering?l<this.options.quadTreeSearchDistanceDown&&this.findDown(o,t,i,r):(i.set(o,a),a.levelOffset=l)}}findUp(e,t,i,r,s){const o=n.TileKeyUtils.getParentKeyFromKey(e);if(void 0!==i.get(o))return!0;const a=r.get(o);if(void 0!==a)return a;const{offset:l,mortonCode:c}=n.TileKeyUtils.extractOffsetAndMortonKeyFromKey(o),h=this.m_dataSourceCache.get(c,l,s),u=h?h.tileKey:n.TileKey.fromMortonCode(c),d=Math.abs(t-u.level);if(void 0!==h&&h.hasGeometry&&!h.delayRendering)return r.set(o,!0),i.set(o,h),h.levelOffset=-d,!0;if(r.set(o,!1),d<this.options.quadTreeSearchDistanceUp&&0!==u.level){const e=this.findUp(o,t,i,r,s);if(r.set(o,e),e)return!0}return!1}getTileImpl(e,t,i,n,r){function s(e){e.frameNumLastRequested=r}if(!e.cacheable&&!n){const i=e.getTile(t,!0);return void 0!==i&&(this.addToTaskQueue(i),s(i)),i}const o=this.m_dataSourceCache;let a=o.get(t.mortonCode(),i,e);return void 0!==a&&a.offset===i?(s(a),a):n?void 0:(a=e.getTile(t,!0),void 0!==a&&(this.addToTaskQueue(a),a.offset=i,s(a),o.set(t.mortonCode(),i,e,a)),a)}addToTaskQueue(e){this.m_taskQueue.add({execute:e.load.bind(e),group:c.TileTaskGroups.FETCH_AND_DECODE,getPriority:()=>{var t,i;return null!==(i=null===(t=null==e?void 0:e.tileLoader)||void 0===t?void 0:t.priority)&&void 0!==i?i:0},isExpired:()=>!(null==e?void 0:e.isVisible),estimatedProcessTime:()=>1})}markDataSourceTilesDirty(e,t){const i=this.m_dataSourceCache,n=new Set,r=e=>{var t;const i=d.getKeyForTile(e);n.has(i)||(n.add(i),null===(t=e.tileLoader)||void 0===t||t.cancel(),this.addToTaskQueue(e))};e.visibleTiles.forEach(e=>{(void 0===t||t(e))&&r(e)}),e.renderedTiles.forEach(e=>{(void 0===t||t(e))&&r(e)}),i.forEach((e,r)=>{void 0!==t&&!t(e)||n.has(r)||(i.deleteByKey(r),e.dispose())},e.dataSource)}getVisibleTileKeysForDataSources(e,t,i){const n=Array();let r=!0;if(0===t.length)return{tileKeys:n,allBoundingBoxesFinal:r};const s=new Map;t.forEach(e=>{const t=e.getTilingScheme(),i=s.get(t);void 0===i?s.set(t,[e]):i.push(e)}),void 0!==i?(this.m_cameraOverride.copy(this.m_frustumIntersection.camera),this.m_cameraOverride.near=Math.min(this.m_cameraOverride.near,this.m_viewRange.minimum),this.m_cameraOverride.far=Math.max(this.m_cameraOverride.far,this.m_viewRange.maximum),this.m_cameraOverride.updateProjectionMatrix(),this.m_frustumIntersection.updateFrustum(this.m_cameraOverride.projectionMatrix)):this.m_frustumIntersection.updateFrustum();for(const[t,o]of s){const s=o.map(t=>t.getDataZoomLevel(e)),a=this.m_frustumIntersection.compute(t,i,s,o);r=r&&a.calculationFinal;for(const t of o){const i=[],r=t.getDataZoomLevel(e);for(const e of a.tileKeyEntries.get(r).values())t.canGetTile(r,e.tileKey)&&i.push(e);n.push({dataSource:t,visibleTileKeys:i})}}return{tileKeys:n,allBoundingBoxesFinal:r}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryCreator=void 0;const n=i(3),r=i(2),s=i(4),o=i(1),a=i(0),l=i(25),c=i(158),h=i(69),u=i(311),d=i(144),m=i(68),p=i(119),f=o.LoggerManager.instance.create("TileGeometryCreator"),g=new a.Vector3,v=new a.Vector2;class y{constructor(){this.bufferAttributes=new Map,this.interleavedAttributes=new Map}}class _ extends n.CallExpr{constructor(e){super("memo",[e]),this.m_cachedProperties=[],this.m_deps=Array.from(e.dependencies().properties),this.descriptor=this}call(e){let t=!1;return this.m_deps.forEach((i,n)=>{const r=e.env.lookup(i);t||r===this.m_cachedProperties[n]||(t=!0),t&&(this.m_cachedProperties[n]=r)}),(t||void 0===this.m_cachedValue)&&(this.m_cachedValue=e.evaluate(this.args[0])),this.m_cachedValue}}class x{constructor(e,t,i){this.geometry=e,this.info=t,this.cache=i}getBufferAttribute(e){if(this.cache.bufferAttributes.has(e))return this.cache.bufferAttributes.get(e);const t=l.getBufferAttribute(e);return this.cache.bufferAttributes.set(e,t),t}getInterleavedBufferAttributes(e){const t=this.cache.interleavedAttributes.get(e);if(t)return t;const i=new(n.getArrayConstructor(e.type))(e.buffer),r=new a.InterleavedBuffer(i,e.stride),s=e.attributes.map(e=>{const t=new a.InterleavedBufferAttribute(r,e.itemSize,e.offset,!1);return{name:e.name,attribute:t}});return this.cache.interleavedAttributes.set(e,s),s}}function w(e,t){if(Array.isArray(e)){const i=e;t.push(...i)}else t.push(e)}class b{constructor(){}static get instance(){return this.m_instance||(this.m_instance=new b)}initDecodedTile(e,t,i){for(const n of e.techniques){const e=n.kind;void 0===e||e instanceof Set&&0===e.size?n._kindState=!0:n._kindState=!(void 0!==i&&i.hasOrIntersects(e))||void 0!==t&&t.hasOrIntersects(e)}for(const t of e.geometries)for(const e of t.groups)e.createdOffsets=[]}createAllGeometries(e,t){const i=e=>!1!==e._kindState;let s=Promise.resolve();this.createObjects(e,t,t=>{s=Promise.all([s,t.then(t=>(e.addOwnedTexture(t),t.image?new Promise(i=>{t.onUpdate=()=>{t.onUpdate=null,i()},e.mapView.renderer.initTexture(t)}):Promise.resolve())).catch(()=>{})])},i),this.preparePois(e,t);return this.createTextElements(e,t,e=>!!(n.isPoiTechnique(e)||n.isLineMarkerTechnique(e)||n.isTextTechnique(e))&&i(e)),this.createLabelRejectionElements(e,t),e.dataSource.addGroundPlane&&e.projection.type===r.ProjectionType.Planar&&m.addGroundPlane(e,-1),s}createLabelRejectionElements(e,t){if(void 0!==t.pathGeometries)for(const i of t.pathGeometries)e.addBlockingElement(new u.PathBlockingElement(i.path))}processTechniques(e,t,i){const r=e.decodedTile;if(void 0===r)return;this.initDecodedTile(r,t,i);const s=e.dataSource.exprPool;r.techniques.forEach(e=>{for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];if(n.isJsonExpr(i)&&"kind"!==t)try{let r=n.Expr.fromJSON(i);!0!==r.dependencies().volatile&&(r=new _(n.Expr.fromJSON(i))),e[t]=r.intern(s)}catch(e){f.error("Failed to compile expression:",e)}}})}prepareTextPaths(e,t,i){const r=new Array,s=e.slice();for(;s.length>0;){const e=s.pop();if(void 0===e)break;const o=t.techniques[e.technique];n.isTextTechnique(o)&&(void 0===i||i(o))&&r.push(e)}return r}createTextElements(e,t,i){var r;const s=e.mapView,o=e.computeWorldOffsetX(),l=Math.floor(s.zoomLevel),c=new n.MapEnv({$zoom:l},s.env),h=new d.TextElementBuilder(c,e.textStyleCache,e.dataSource.dataSourceOrder);if(void 0!==t.textPathGeometries){const r=this.prepareTextPaths(t.textPathGeometries,t,i);for(const s of r){const r=t.techniques[s.technique];if(!1===r._kindState||!n.isTextTechnique(r)||void 0!==i&&!i(r))continue;const l=[];for(let e=0;e<s.path.length;e+=3)l.push(new a.Vector3(s.path[e]+o,s.path[e+1],s.path[e+2]));const c=h.withTechnique(r).build(s.text,l,e.offset,e.dataSource.name,e.dataSource.dataSourceOrder,s.objInfos,s.pathLengthSqr);e.addTextElement(c)}}if(void 0!==t.textGeometries)for(const s of t.textGeometries){if(void 0===s.technique||void 0===s.stringCatalog)continue;const l=t.techniques[s.technique];if(!1===l._kindState||!n.isTextTechnique(l)||void 0!==i&&!i(l))continue;const c=new a.BufferAttribute(new Float64Array(s.positions.buffer),s.positions.itemCount),u=c.count;if(!(u<1)){h.withTechnique(l);for(let t=0;t<u;++t){const i=c.getX(t)+o,n=c.getY(t),l=c.getZ(t),u=s.stringCatalog[s.texts[t]];if(void 0===u)continue;const d=null===(r=s.objInfos)||void 0===r?void 0:r[t],m=new a.Vector3(i,n,l),p=h.build(u,m,e.offset,e.dataSource.name,e.dataSource.dataSourceOrder,d);e.addTextElement(p)}}}}createObjects(e,t,i,u){var d,m,f,y,_,x;const b=e.mapView,M=[],T=[],S=b.animatedExtrusionHandler,E=Math.floor(b.zoomLevel),P=new n.MapEnv({$zoom:E},b.env),A=e.objects,C=b.viewRanges,L=void 0!==b.elevationProvider;for(const E of this.getAttachments(t)){const R=E.geometry,D=E.info.groups,O=D.length;for(let I=0;I<O;){const F=D[I++],V=F.start,U=F.technique,N=t.techniques[U];if(void 0===F.createdOffsets&&(F.createdOffsets=[]),F.createdOffsets.includes(e.offset)||!1===N._kindState||void 0!==u&&!u(N))continue;let B=F.count;for(F.createdOffsets.push(e.offset);I<O&&D[I].technique===U&&V+B===D[I].start;++I)B+=D[I].count,D[I].createdOffsets.push(e.offset);if(!l.usesObject3D(N))continue;const k=null!==(d=null==S?void 0:S.setAnimationProperties(N,P))&&void 0!==d&&d;let z=M[U];if(void 0===z){if(z=l.createMaterial(b.renderer.capabilities,{technique:N,env:b.env,fog:null!==b.scene.fog,shadowsEnabled:b.shadowsEnabled},i),void 0===z)continue;k&&s.hasExtrusionFeature(z)&&w(z,T),M[U]=z}const G=N.kind;n.isTerrainTechnique(N)&&this.setupTerrainMaterial(N,z,e.mapView.clearColor);const j=new a.BufferGeometry;null===(m=R.vertexAttributes)||void 0===m||m.forEach(e=>{const t=E.getBufferAttribute(e);j.setAttribute(e.name,t)}),null===(f=R.interleavedVertexAttributes)||void 0===f||f.forEach(e=>{E.getInterleavedBufferAttributes(e).forEach(({name:e,attribute:t})=>j.setAttribute(e,t))});const H=null!==(y=E.info.index)&&void 0!==y?y:R.index;if(H&&j.setIndex(E.getBufferAttribute(H)),!j.getAttribute("normal")&&n.needsVertexNormals(N)&&j.computeVertexNormals(),j.addGroup(V,B),n.isSolidLineTechnique(N)){o.assert(!s.isHighPrecisionLineMaterial(z));const t=z;!0===N.clipping&&e.projection.type===r.ProjectionType.Planar&&(e.boundingBox.getSize(g),v.set(g.x,g.y),t.clipTileSize=v),j.getAttribute("color")&&s.setShaderMaterialDefine(t,"USE_COLOR",!0)}const W=n.isSolidLineTechnique(N)&&void 0!==N.secondaryWidth,q=n.Expr.isExpr(N.enabled)&&R.featureStarts&&R.featureStarts.length>0,X=l.buildObject(N,j,q?[z]:z,e,L);if(X.renderOrder=n.getPropertyValue(N.renderOrder,b.env),void 0!==E.info.uuid&&(X.uuid=E.info.uuid,X.userData.geometryId=E.info.uuid),(n.isCirclesTechnique(N)||n.isSquaresTechnique(N))&&void 0!==N.enablePicking&&(X.enableRayTesting=N.enablePicking),n.isLineTechnique(N)||n.isSegmentsTechnique(N)){const e=this.getFadingParams(P,N);s.FadingFeature.addRenderHelper(X,C,e.fadeNear,e.fadeFar,!1)}if(n.isSolidLineTechnique(N)){const e=this.getFadingParams(P,N);s.FadingFeature.addRenderHelper(X,C,e.fadeNear,e.fadeFar,!1)}if(n.isExtrudedLineTechnique(N)&&void 0!==N.fadeFar){const e=this.getFadingParams(b.env,N);s.FadingFeature.addRenderHelper(X,C,e.fadeNear,e.fadeFar,!0)}if(this.addUserData(e,R,N,X),n.isExtrudedPolygonTechnique(N)?(X.castShadow=b.shadowsEnabled,X.receiveShadow=b.shadowsEnabled):(n.isStandardTechnique(N)||n.isFillTechnique(N))&&(X.receiveShadow=b.shadowsEnabled),(n.isExtrudedPolygonTechnique(N)||n.isStandardTechnique(N)||n.isFillTechnique(N))&&void 0!==N.fadeFar){const e=this.getFadingParams(P,N);s.FadingFeature.addRenderHelper(X,C,e.fadeNear,e.fadeFar,!0)}if(n.isExtrudedPolygonTechnique(N)&&c.isRenderDepthPrePassEnabled(N,P)){const t=c.createDepthPrePassMesh(X);this.addUserData(e,R,N,t),p.registerTileObject(e,t,G,{technique:N,pickability:n.Pickability.transient}),A.push(t),k&&w(t.material,T),c.setDepthPrePassStencil(t,X)}const Z=n.transientToPickability(n.getPropertyValue(N.transient,b.env));if(p.registerTileObject(e,X,G,{technique:N,pickability:W?n.Pickability.transient:Z}),A.push(X),n.isExtrudedPolygonTechnique(N)&&void 0!==E.info.edgeIndex){const t=n.Expr.isExpr(N.enabled)&&R.edgeFeatureStarts&&R.edgeFeatureStarts.length>0,i=N,r=new a.BufferGeometry;r.setAttribute("position",j.getAttribute("position"));const o=j.getAttribute("color");void 0!==o&&r.setAttribute("color",o);const l=j.getAttribute("extrusionAxis");void 0!==l&&r.setAttribute("extrusionAxis",l);const c=j.getAttribute("normal");void 0!==c&&r.setAttribute("normal",c);const u=j.getAttribute("uv");void 0!==u&&r.setAttribute("uv",u),r.setIndex(E.getBufferAttribute(E.info.edgeIndex));const d=N,m=this.getPolygonFadingParams(P,d),f={color:m.color,colorMix:m.colorMix,fadeNear:m.lineFadeNear,fadeFar:m.lineFadeFar,extrusionRatio:k?0:void 0,vertexColors:!!j.getAttribute("color"),rendererCapabilities:b.renderer.capabilities},g=new s.EdgeMaterial(f),v=new a.LineSegments(r,t?[g]:g);this.addUserData(e,R,N,v),v.renderOrder=X.renderOrder+.1,s.FadingFeature.addRenderHelper(v,C,m.lineFadeNear,m.lineFadeFar,!1),k&&w(v.material,T),p.registerTileObject(e,v,G,{technique:N,pickability:n.Pickability.transient}),h.MapMaterialAdapter.create(g,{color:i.lineColor,objectColor:i.color,opacity:i.opacity,lineWidth:e=>{const t=n.getPropertyValue(i.lineWidth,e.env);return"number"==typeof t?a.MathUtils.clamp(t,0,1):0}}),A.push(v)}if(n.isExtrudedPolygonTechnique(N)&&k&&(X.customDepthMaterial=new s.MapMeshDepthMaterial({depthPacking:a.RGBADepthPacking}),w(X.customDepthMaterial,T)),n.isFillTechnique(N)&&E.info.edgeIndex){const t=n.Expr.isExpr(N.enabled)&&R.edgeFeatureStarts&&R.edgeFeatureStarts.length>0,i=new a.BufferGeometry;i.setAttribute("position",j.getAttribute("position")),i.setIndex(E.getBufferAttribute(E.info.edgeIndex));const r=N,o=this.getPolygonFadingParams(b.env,r),l={color:o.color,colorMix:o.colorMix,fadeNear:o.lineFadeNear,fadeFar:o.lineFadeFar,vertexColors:!!j.getAttribute("color"),rendererCapabilities:b.renderer.capabilities},c=new s.EdgeMaterial(l),u=new a.LineSegments(i,t?[c]:c);u.renderOrder=X.renderOrder+.1,s.FadingFeature.addRenderHelper(u,C,o.lineFadeNear,o.lineFadeFar,!1),this.addUserData(e,R,N,u),p.registerTileObject(e,u,G,{technique:N,pickability:Z}),h.MapMaterialAdapter.create(c,{color:r.lineColor,objectColor:r.color,opacity:r.opacity}),A.push(u)}if(W){const t=N,i=z.clone();l.applyBaseColorToMaterial(i,i.color,t,null!==(_=t.secondaryColor)&&void 0!==_?_:0,P),void 0!==t.secondaryCaps&&(i.caps=n.getPropertyValue(t.secondaryCaps,b.env));const r=l.buildObject(N,j,i,e,L);r.renderOrder=(null!==(x=n.getPropertyValue(t.secondaryRenderOrder,b.env))&&void 0!==x?x:0)-1e-7,this.addUserData(e,R,N,r);const o=this.getFadingParams(P,N);s.FadingFeature.addRenderHelper(r,C,o.fadeNear,o.fadeFar,!1);const a=l.buildMetricValueEvaluator(t.secondaryWidth,t.metricUnit);p.registerTileObject(e,r,G,{technique:N});const c=h.MapMaterialAdapter.get(z),u=h.MapMaterialAdapter.create(i,{color:t.secondaryColor,opacity:t.opacity,caps:t.secondaryCaps,lineWidth:e=>{if(!c)return;c.ensureUpdated(e);const t=c.currentStyledProperties.lineWidth,i=n.getPropertyValue(a,b.env),r=u.currentStyledProperties.opacity;return"number"==typeof t&&"number"==typeof i?i<=t&&(null==r||1===r)?0:i:0}});A.push(r)}}}T.length>0&&b.animatedExtrusionHandler.add(e,T)}preparePois(e,t){void 0!==t.poiGeometries&&e.mapView.poiManager.addPois(e,t)}*getAttachments(e){const t=new y;for(const i of e.geometries){const e={index:i.index,edgeIndex:i.edgeIndex,uuid:i.uuid,groups:i.groups};if(yield new x(i,e,t),i.attachments)for(const e of i.attachments)yield new x(i,e,t)}}setupTerrainMaterial(e,t,i){if(!e.map||!e.displacementMap){const e=t;return e.color.set(i),void s.setDisplacementMapToMaterial(null,e)}t.onBeforeCompile=e=>{e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>","#include <map_pars_fragment>\n    uniform sampler2D displacementMap;\n    uniform float displacementScale;\n    uniform float displacementBias;"),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#ifdef USE_MAP\n    float minElevation = ${r.EarthConstants.MIN_ELEVATION.toFixed(1)};\n    float maxElevation = ${r.EarthConstants.MAX_ELEVATION.toFixed(1)};\n    float elevationRange = maxElevation - minElevation;\n\n    float disp = texture2D( displacementMap, vUv ).x * displacementScale + displacementBias;\n    vec4 texelColor = texture2D( map, vec2((disp - minElevation) / elevationRange, 0.0) );\n    texelColor = mapTexelToLinear( texelColor );\n    diffuseColor *= texelColor;\n#endif`),e.vertexShader=e.vertexShader.replace("#include <displacementmap_vertex>","")},t.displacementMap.needsUpdate=!0}addUserData(e,t,i,r){if(n.isTerrainTechnique(i)){o.assert(0===Object.keys(r.userData).length,"Unexpected user data in terrain object"),o.assert("object"==typeof t.objInfos[0],"Wrong attribute map type for terrain geometry");const i=t.objInfos[0],n={tileKey:e.tileKey,texture:new a.DataTexture(i.buffer,i.xCountVertices,i.yCountVertices,a.LuminanceFormat,a.FloatType),displacementMap:i,geoBox:e.geoBox};r.userData=n}else{const e="LineSegments"===r.type&&(n.isExtrudedPolygonTechnique(i)||n.isFillTechnique(i)),s={geometryType:t.type,starts:e?t.edgeFeatureStarts:t.featureStarts,objInfos:t.objInfos};r.userData.feature=s,r.userData.technique=i}}getFadingParams(e,t){return{fadeNear:void 0!==t.fadeNear?n.getPropertyValue(t.fadeNear,e):s.FadingFeature.DEFAULT_FADE_NEAR,fadeFar:void 0!==t.fadeFar?n.getPropertyValue(t.fadeFar,e):s.FadingFeature.DEFAULT_FADE_FAR}}getPolygonFadingParams(e,t){let i,r=s.EdgeMaterial.DEFAULT_COLOR_MIX;if(void 0!==t.lineColor&&(i=n.getPropertyValue(t.lineColor,e),n.isExtrudedPolygonTechnique(t))){const e=t;r=void 0!==e.lineColorMix?e.lineColorMix:s.EdgeMaterial.DEFAULT_COLOR_MIX}const o=void 0!==t.fadeNear?n.getPropertyValue(t.fadeNear,e):s.FadingFeature.DEFAULT_FADE_NEAR,a=void 0!==t.fadeFar?n.getPropertyValue(t.fadeFar,e):s.FadingFeature.DEFAULT_FADE_FAR,l=void 0!==t.lineFadeNear?n.getPropertyValue(t.lineFadeNear,e):o,c=void 0!==t.lineFadeFar?n.getPropertyValue(t.lineFadeFar,e):a;return void 0===i&&(i=s.EdgeMaterial.DEFAULT_COLOR),{color:i,colorMix:r,fadeNear:o,fadeFar:a,lineFadeNear:l,lineFadeFar:c}}}t.TileGeometryCreator=b},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setDepthPrePassStencil=t.createDepthPrePassMesh=t.isDepthPrePassMesh=t.createDepthPrePassMaterial=t.isRenderDepthPrePassEnabled=t.DEPTH_PRE_PASS_STENCIL_MASK=void 0;const n=i(30),r=i(4),s=i(0),o=i(25);t.DEPTH_PRE_PASS_STENCIL_MASK=1;function a(e){e.depthWrite=!1,e.depthFunc=s.EqualDepth,e.colorWrite=!0,r.enforceBlending(e);const t=e.clone();return t.isDepthPrepassMaterial=!0,t.depthWrite=!0,t.depthTest=!0,t.depthFunc=s.LessDepth,t.colorWrite=!1,t.opacity=1,t.blending=s.NoBlending,t}t.isRenderDepthPrePassEnabled=function(e,t){if(!1===e.enableDepthPrePass)return!1;let i=void 0!==e.opacity&&e.opacity>0&&e.opacity<1;if(!i){const r=o.evaluateBaseColorProperty(e,t);if(void 0!==r){const e=n.ColorUtils.getAlphaFromHex(r);i=e>0&&e<1}}return i},t.createDepthPrePassMaterial=a,t.isDepthPrePassMesh=function(e){if(!0!==e.isMesh)return!1;const t=e;return t.material instanceof Array?t.material.every(e=>!0===e.isDepthPrepassMaterial):!0===t.material.isDepthPrepassMaterial},t.createDepthPrePassMesh=function(e){const t=e.geometry;if(!(t instanceof s.BufferGeometry))throw new Error("#createDepthPassMesh only BufferGeometry is supported");const i=t.getAttribute("position");if(!i)throw new Error("#createDepthPassMesh position attribute not found");const n=new s.BufferGeometry;n.setAttribute("position",i);const r=t.getAttribute("uv");r&&n.setAttribute("uv",r);const o=t.getAttribute("normal");o&&n.setAttribute("normal",o);const l=t.getAttribute("extrusionAxis");l&&n.setAttribute("extrusionAxis",l),t.index&&n.setIndex(t.index);for(const e of t.groups){const{start:t,count:i,materialIndex:r}=e;n.addGroup(t,i,r)}const c=e.material instanceof Array?e.material.map(a):a(e.material),h=new s.Mesh(n,c);return h.renderOrder=e.renderOrder-1e-6,h},t.setDepthPrePassStencil=function(e,i){function n(e){const i=e;i.stencilWrite=!0,i.stencilFail=s.KeepStencilOp,i.stencilZFail=s.KeepStencilOp,i.stencilZPass=s.ReplaceStencilOp,i.stencilFunc=s.AlwaysStencilFunc,i.stencilRef=255,i.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK}function r(e){const i=e;i.stencilWrite=!0,i.stencilFail=s.KeepStencilOp,i.stencilZFail=s.KeepStencilOp,i.stencilZPass=s.ZeroStencilOp,i.stencilFunc=s.EqualStencilFunc,i.stencilRef=255,i.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK}e.material instanceof Array?e.material.map(n):n(e.material),i.material instanceof Array?i.material.map(r):r(i.material)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightCoverageProvider=void 0;const n=i(1),r=i(150);t.CopyrightCoverageProvider=class{constructor(){this.logger=n.LoggerManager.instance.create("CopyrightCoverageProvider")}getTree(){return void 0!==this.m_cachedTreePromise||(this.m_cachedTreePromise=this.getCopyrightCoverageData().then(e=>this.initRBush(e)).catch(e=>(this.logger.error(e),new r))),this.m_cachedTreePromise}async getCopyrights(e,t){const i=[],r=(await this.getTree()).search({minX:e.west,minY:e.south,maxX:e.east,maxY:e.north});for(const e of r){const r=n.getOptionValue(e.minLevel,0),s=n.getOptionValue(e.maxLevel,1/0);t>=r&&t<=s&&void 0===i.find(t=>t.id===e.label)&&i.push({id:e.label})}return i}initRBush(e){const t=new r;if(!e)return this.logger.warn("No copyright coverage data provided"),t;for(const i of e){const{minLevel:e,maxLevel:n,label:r,alt:s}=i;if(i.boxes)for(const o of i.boxes){const[i,a,l,c]=o;t.insert({minX:a,minY:i,maxX:c,maxY:l,minLevel:e,maxLevel:n,label:r,alt:s})}else t.insert({minX:-180,minY:-90,maxX:180,maxY:180,minLevel:e,maxLevel:n,label:r,alt:s})}return t}}},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(320),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedBufferedGeometryLineAccessor=t.IndexedBufferedGeometryAccessor=t.BufferedGeometryObject3dAccessor=t.BufferedGeometryLineAccessor=t.BufferedGeometryAccessor=t.BufferedGeometryAccessorBase=t.isObject3dAccessor=t.isLineAccessor=void 0;const n=i(3),r=i(328),s=i(1),o=s.LoggerManager.instance.create("TileGeometry");t.isLineAccessor=function(e){return"function"==typeof e.isLineAccessor&&!0===e.isLineAccessor()},t.isObject3dAccessor=function(e){return"function"==typeof e.isObject3dAccessor&&!0===e.isObject3dAccessor()};class a{constructor(e,t,i){this.object=e,this.geometryType=t,this.bufferGeometry=i,this.start=-1,this.end=-1,this.startCapSize=0,this.endCapSize=0,s.assert(!!e),"BufferGeometry"!==i.type&&o.error("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),s.assert("BufferGeometry"===i.type,"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),this.position=this.bufferGeometry.getAttribute("position"),this.itemSize=this.position.itemSize,this.position||o.warn("BufferedGeometryAccessor#constructor: BufferGeometry has no position attribute"),this.position.array.constructor!==Float32Array&&o.warn("BufferedGeometryAccessor#constructor: BufferGeometry.position: unsupported ArrayBuffer")}getCount(){return this.position.count}get renderOrder(){return this.object.renderOrder}setRange(e,t,i=0,n=0){s.assert(e>=0),s.assert(t>=0),s.assert(e<=t),this.start=e,this.end=t,this.startCapSize=i,this.endCapSize=n}get color(){const e=e=>{const t=e;if("MeshBasicMaterial"===t.type||"MeshStandardMaterial"===t.type)return t.color;if("RawShaderMaterial"===t.type){const t=e;if("SolidLineMaterial"===t.name)return t.uniforms.diffuse.value;o.warn("BufferedGeometryAccessor#color: unknown shader material name",t.name)}else o.warn("BufferedGeometryAccessor#color: unknown material type",t.type)};if(Array.isArray(this.object.material)){const t=new Array,i=this.object.material;for(const n of i)t.push(e(n));return t}return e(this.object.material)}}t.BufferedGeometryAccessorBase=a;class l extends a{constructor(e,t,i,n){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.stride=n}clear(){s.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.position.array,t=this.start*this.itemSize,i=this.end*this.itemSize;for(let n=t;n<i;n++)e[n]=0;this.position.needsUpdate=!0}getVertices(){s.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.start,t=this.end;return this.position.array.subarray(e*this.itemSize,t*this.itemSize)}checkSetUp(){return void 0!==this.position&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.position.count&&this.start<=this.end}}t.BufferedGeometryAccessor=l;t.BufferedGeometryLineAccessor=class extends l{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){s.assert(this.checkSetUp(),"RoBufferedGeometryLineAccessor not setup")}};t.BufferedGeometryObject3dAccessor=class extends l{constructor(e,t,i){super(e,t,i,1),this.object=e,this.geometryType=t,this.bufferGeometry=i}isObject3dAccessor(){return!0}getVertices(){return super.getVertices()}};class c extends a{constructor(e,t,i,n,r){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.indices=null!==this.bufferGeometry.index?this.bufferGeometry.index.array:void 0,this.indices?this.indices instanceof Uint32Array||(o.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry index has wrong type"),s.assert(this.indices instanceof Uint32Array)):(o.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has no index"),s.assert(!!this.indices))}getCount(){return this.indices.length}checkSetUp(){return!!this.indices&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.indices.length&&this.start<=this.end}}t.IndexedBufferedGeometryAccessor=c;t.IndexedBufferedGeometryLineAccessor=class extends c{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){if(s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup"),this.geometryType===n.GeometryType.ExtrudedLine){const e=this.start+this.startCapSize,t=this.position.array;return r.reconstructLineWidth(t,e)}}clear(){s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.start,t=this.end;for(let i=e;i<t;i++)this.indices[i]=0;null!==this.bufferGeometry.index&&(this.bufferGeometry.index.needsUpdate=!0)}getVertices(){s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.itemSize,t=this.start,i=this.end,n=new Float32Array((i-t)*e),r=this.position.array;if(2===e)for(let s=t,o=0;s<i;s++,o+=e){const t=this.indices[s];n[o+0]=r[t*e+0],n[o+1]=r[t*e+1]}if(3===e)for(let s=t,o=0;s<i;s++,o+=e){const t=this.indices[s];n[o+0]=r[t*e+0],n[o+1]=r[t*e+1],n[o+2]=r[t*e+2]}else for(let s=t,o=0;s<i;s++,o++){const t=this.indices[s];for(let i=0;i<e;i++)n[o*e+i]=r[t*e+i]}return n}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineGroup=t.createSimpleLineGeometry=t.createLineGeometry=t.LineGeometry=void 0;const n=i(1),r=i(0),s=new r.Vector3,o=new r.Vector3,a=new r.Vector3,l=new r.Vector3,c=new r.Vector3,h={attributes:[{name:"extrusionCoord",itemSize:3,offset:0},{name:"position",itemSize:3,offset:3},{name:"tangent",itemSize:3,offset:6},{name:"bitangent",itemSize:4,offset:9}],stride:13},u={attributes:[{name:"uv",itemSize:2,offset:h.stride},{name:"normal",itemSize:3,offset:h.stride+2}],stride:5},d={attributes:[...h.attributes,...u.attributes],stride:h.stride+u.stride},m={attributes:[{name:"extrusionCoord",itemSize:2,offset:0},{name:"position",itemSize:3,offset:2},{name:"positionLow",itemSize:3,offset:5},{name:"tangent",itemSize:3,offset:8},{name:"bitangent",itemSize:4,offset:11}],stride:15},p={attributes:[...m.attributes,...u.attributes],stride:m.stride+u.stride};class f{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function g(e,t){return t?e?p:m:e?d:h}function v(e,t,i,r,h,u,d=new f,m=!1){if(0===t.length)return d;const p=g(void 0!==h,m).stride,v=t.length/3,y=new Array(v),_=new Array(t.length-3),x=d.vertices.length/p,w=void 0!==r&&r.length>0,b=void 0!==h&&h.length>0,M=void 0!==u&&u.length&&t.length;n.assert(!w||r.length===v),n.assert(!b||h.length/2===v),n.assert(!M||u.length===t.length);let T=.1;y[0]=T;for(let e=0;e<v-1;++e){let i=0;for(let n=0;n<3;++n){const r=t[3*(e+1)+n]-t[3*e+n];_[3*e+n]=r,i+=r*r}T+=Math.sqrt(i),y[e+1]=T}const S=w?Math.abs(r[r.length-1]-r[0]):1,E=y[y.length-1]/S;if(w)for(let e=0;e<v;++e)y[e]=r[e]*E+.1;let P=!0;for(let e=0;e<3;++e)P=P&&t[e]===t[t.length-3+e];const A=[],C=(n,r,p,f,g)=>{A.length=0,d.vertices.push(f,-1*g,E),A.push(f,1*g,E);for(let e=0;e<3;++e){if(m){const i=Math.fround(t[3*n+e]),r=t[3*n+e]-i;d.vertices.push(i,r),A.push(i,r)}else d.vertices.push(t[3*n+e]),A.push(t[3*n+e]);o.setComponent(e,t[3*n+e])}for(let e=0;e<3;++e)a.setComponent(e,_[r+e]),l.setComponent(e,_[p+e]);a.normalize(),d.vertices.push(a.x,a.y,a.z),A.push(a.x,a.y,a.z),o.add(e),i.surfaceNormal(o,o);const v=function(e,t,i,n){let r=0;t.equals(i)||(r=Math.acos(t.dot(i))*Math.sign(e.dot(s.copy(t).cross(i))),Number.isNaN(r)&&(r=0));return n.copy(t).add(i).normalize().cross(e).normalize(),r}(o,a,l.normalize(),c);d.vertices.push(c.x,c.y,c.z,v),A.push(c.x,c.y,c.z,v),b&&(d.vertices.push(h[2*n],h[2*n+1]),A.push(h[2*n],h[2*n+1]),d.vertices.push(o.x,o.y,o.z),A.push(o.x,o.y,o.z)),d.vertices.push(...A),M&&(d.vertexColors.push(u[3*n],u[3*n+1],u[3*n+2]),d.vertexColors.push(u[3*n],u[3*n+1],u[3*n+2]))};for(let e=0;e<v;++e){const t=P&&0===e?_.length-3:3*Math.max(0,e-1),i=P&&e===v-1?0:Math.min(3*e,_.length-3);e>0&&C(e,t,i,y[e-1],y[e]),e+1<v&&C(e,t,i,-1*y[Math.min(e,y.length-1)],y[Math.min(e+1,y.length-1)])}for(let e=0;e<v-1;++e){const t=x+4*e;d.indices.push(t,t+1,t+2,t+2,t+1,t+3)}return d}function y(e,t,i=new f){if(0===e.length)return i;const n=e.length/3;let r=i.vertices.length/3;const s=void 0!==t&&t.length&&e.length;for(let o=0;o<n;++o,r++){o>0&&i.indices.push(r),o<n-1&&i.indices.push(r);for(let n=0;n<3;++n)i.vertices.push(e[3*o+n]),s&&i.vertexColors.push(t[3*o+n])}return i}t.LineGeometry=f,t.createLineGeometry=v,t.createSimpleLineGeometry=y;class _{constructor(e=!1,t=!1,i=!1){this.hasNormalsAndUvs=e,this.highPrecision=t,this.isSimple=i,this.m_geometry=new f}static createGeometry(e,t,i,n,s=!1,o=!1,a=!1){if(a)return n.setAttribute("position",new r.BufferAttribute(new Float32Array(e),3)),t.length===e.length&&n.setAttribute("color",new r.BufferAttribute(new Float32Array(t),3)),n.setIndex(new r.BufferAttribute(new Uint32Array(i),1)),n;{const a=g(s,o),l=new r.InterleavedBuffer(new Float32Array(e),a.stride);return a.attributes.forEach(e=>{const t=new r.InterleavedBufferAttribute(l,e.itemSize,e.offset,!1);n.setAttribute(e.name,t)}),t.length===e.length&&n.setAttribute("color",new r.BufferAttribute(new Float32Array(t),3)),n.setIndex(new r.BufferAttribute(new Uint32Array(i),1)),n}}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(e,t,i,r,s,o){return this.isSimple?y(t,o,this.m_geometry):(n.assert(!this.hasNormalsAndUvs||void 0!==s),v(e,t,i,r,s,o,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return g(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return g(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(e){return void 0===e&&(e=new r.BufferGeometry),_.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,e,this.hasNormalsAndUvs,this.highPrecision)}}t.LineGroup=_},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionLine=t.HighPrecisionWireFrameLine=void 0;const n=i(0),r=i(83);class s extends n.Line{constructor(e,t,i){super(e,t),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){r.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,n,s,o)=>{r.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionWireFrameLine=s;class o extends n.Mesh{constructor(e,t,i){super(e,t),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){r.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,n,s,o)=>{r.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionLine=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraAnimationBuilder=void 0;const n=i(2),r=i(0),s=i(54);t.CameraAnimationBuilder=class{static getLookAtFromView(e){return{target:e.target,heading:e.heading,tilt:e.tilt,distance:e.targetDistance}}static appendControlPoint(e,t,i){i=null!=i?i:10,e.controlPoints.length>0&&(void 0===t.timestamp||t.timestamp<=e.controlPoints[e.controlPoints.length-1].timestamp)&&(t.timestamp=e.controlPoints[e.controlPoints.length-1].timestamp+i),e.controlPoints.push(t)}static prependControlPoint(e,t,i){i=void 0!==i?i:10;for(const t of e.controlPoints)t.timestamp+=i;t.timestamp=0,e.controlPoints.unshift(t)}static createBowFlyToOptions(e,t,i,o,a=10){const l=[t],c=new r.Vector3;e.projection.projectPoint(t.target,c);let h=null!=o?o:2*c.distanceTo(e.projection.projectPoint(i.target));h=Math.max(t.distance+i.distance,h);const u=n.GeoCoordinates.lerp(t.target,i.target,.25),d=new s.ControlPoint({target:u,distance:h,timestamp:a/3,tilt:n.MathUtils.interpolateAnglesDeg(t.tilt,i.tilt,.25),heading:n.MathUtils.interpolateAnglesDeg(t.heading,i.heading,.25)});l.push(d);const m=n.GeoCoordinates.lerp(t.target,i.target,.75),p=new s.ControlPoint({target:m,distance:h,timestamp:a/3*2,tilt:n.MathUtils.interpolateAnglesDeg(t.tilt,i.tilt,.75),heading:n.MathUtils.interpolateAnglesDeg(t.heading,i.heading,.75)});return l.push(p),i.timestamp=a,l.push(i),{controlPoints:l}}static createOrbitOptions(e,t=10){const i=[e],n=t/3;for(let e=1;e<4;e++){const t=i[e-1];i.push(Object.assign(Object.assign({},t),{heading:t.heading-120,timestamp:t.timestamp+n}))}return{controlPoints:i}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalObjectDataSource=void 0;const n=i(0),r=i(332),s=i(50),o=i(88),a=i(51),l=i(49),c=i(181),h=i(175),u=new n.Box3;class d extends o.ObjectDataSource{constructor(e,t){super(Object.assign(Object.assign({},e),{dataProvider:new r.LocalObjectDataProvider(t),tileFactory:new s.TileFactory(o.ObjectTile),addGroundPlane:!1,gatherFeatureAttributes:!0,decoder:new a.VectorTileDecoder}),t),this.provider=t,this.m_invalidateAllTiles=!1,this.m_synced_at=H.map.provider.Invalidations.MARK_INITIAL,this.m_affectedBoundingBox=new n.Box3,this.m_affectedBoundingBoxNextWorld=new n.Box3,this.m_objects=new Map}getMapObjectById(e){return this.m_objects.get(e)}attach(e){super.attach(e),this.provider instanceof H.map.provider.LocalObjectProvider&&this.provider.getRootGroup().getObjects(!0).forEach(e=>{this.m_objects.set(e.getId(),e)})}detach(e){this.m_objects.forEach((e,t)=>{e.getVolatility()&&(e instanceof H.map.Overlay?this.mapView.removeDynamicProperty(m(e)):e instanceof H.map.GeoShape&&this.removeStyleDynamicProps(e.getId()))}),super.detach(e)}setStyleDynamicProps(e,t){p.forEach(i=>this.mapView.setDynamicProperty(f(i,t),e[i]))}removeStyleDynamicProps(e){p.forEach(t=>this.mapView.removeDynamicProperty(f(t,e)))}dispose(){this.m_objects.clear(),super.dispose()}invalidateTiles(){const e=this.m_affectedBoundingBox.isEmpty();this.m_invalidateAllTiles||e?this.mapView.markTilesDirty(this):e||this.mapView.markTilesDirty(this,e=>this.isTileAffected(e)),this.m_affectedBoundingBox.makeEmpty(),this.m_affectedBoundingBoxNextWorld.makeEmpty(),this.m_invalidateAllTiles=!1}isTileAffected(e){this.getTilingScheme().getWorldBox(e.tileKey,u);return u.intersectsBox(this.m_affectedBoundingBox)||!this.m_affectedBoundingBoxNextWorld.isEmpty()&&u.intersectsBox(this.m_affectedBoundingBoxNextWorld)}onProviderUpdate(e){if(this.isDetached())return;if(e.target===this.provider)return this.m_invalidateAllTiles=!0,void this.invalidateTiles();const t=e.target,i=this.m_synced_at,r=e.currentTarget.getInvalidations(t.type);if(this.m_synced_at=r.getMark(),t instanceof H.map.Marker&&t.getIcon().getState()===H.map.Icon.State.READY||t instanceof H.map.GeoShape||t instanceof H.map.Overlay){if(r.isRemove(i)?(this.m_objects.delete(t.getId()),t.getVolatility()&&(t instanceof H.map.Overlay?this.mapView.removeDynamicProperty(m(t)):t instanceof H.map.GeoShape&&this.removeStyleDynamicProps(t.getId()))):this.m_objects.set(t.getId(),t),r.isSpatial(i))return this.m_invalidateAllTiles=!0,void this.invalidateTiles();if(t instanceof H.map.GeoShape&&!t.getVolatility()&&r.isVolatility(i)&&h.default(()=>this.removeStyleDynamicProps(t.getId()),this.invalidationDebounceTime,this.invalidationMaxTime),t.getVolatility()&&(r.isAdd(i)||r.isVisual(i)||r.isVolatility(i)))if(t instanceof H.map.Overlay){const e=m(t),i=t.getBitmap(),n=this.mapView.env.lookup(e);if(null!==i&&n!==i&&(this.mapView.setDynamicProperty(e,i),void 0!==n))return}else if(t instanceof H.map.GeoShape){const e=t.getStyle(),n=t.getId();if(this.setStyleDynamicProps(e,n),r.isVisual(i))return}if(!this.m_invalidateAllTiles){const e=t instanceof H.map.Marker||t instanceof H.map.Overlay?t.getGeometry().getBoundingBox():t.getBoundingBox(),i=l.hGeoRectToHarpGeoBox(e);this.getTilingScheme().projection.projectBox(i,u),this.m_affectedBoundingBox=this.m_affectedBoundingBox.union(u);const r=this.projection.unitScale;(this.m_affectedBoundingBox.max.x>r||this.m_affectedBoundingBox.min.x<0)&&(this.m_affectedBoundingBoxNextWorld=new n.Box3(this.m_affectedBoundingBox.min.clone().add(new n.Vector3(-r,0,0)),this.m_affectedBoundingBox.max.clone().add(new n.Vector3(-r,0,0))))}this.invalidateTilesWithDelay()}}}function m(e){return`${c.ObjectStyleBuilder.DYNAMIC_OVERLAY_PROP_PREFIX}${e.getId()}`}t.LocalObjectDataSource=d;const p=["fillColor","strokeColor","lineWidth"];function f(e,t){return`${e}:${t}`}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvGenericFeatureModifier=t.ComposedDataFilter=t.OmvGenericFeatureFilter=t.OmvFeatureFilterDescriptionBuilder=void 0;const n=i(3),r=i(28);t.OmvFeatureFilterDescriptionBuilder=class{constructor(e){this.m_processLayersDefault=!0,this.m_processPointsDefault=!0,this.m_processLinesDefault=!0,this.m_processPolygonsDefault=!0,this.m_layersToProcess=new Array,this.m_layersToIgnore=new Array,this.m_pointsToProcess=new Array,this.m_ignoredPoints=new Array,this.m_linesToProcess=new Array,this.m_linesToIgnore=new Array,this.m_polygonsToProcess=new Array,this.m_polygonsToIgnore=new Array,this.m_kindsToProcess=[],this.m_kindsToIgnore=[],e&&(this.m_processLayersDefault=void 0===e.processLayersDefault||e.processLayersDefault,this.m_processPointsDefault=void 0===e.processPointsDefault||e.processPointsDefault,this.m_processLinesDefault=void 0===e.processLinesDefault||e.processLinesDefault,this.m_processPolygonsDefault=void 0===e.processPolygonsDefault||e.processPolygonsDefault)}processLayer(e,t=r.OmvFilterString.StringMatch.Match,i=0,n=1/0){this.m_layersToProcess.push({name:{value:e,match:t},minLevel:i,maxLevel:n})}ignoreLayer(e,t=r.OmvFilterString.StringMatch.Match,i=0,n=1/0){this.m_layersToIgnore.push({name:{value:e,match:t},minLevel:i,maxLevel:n})}processPoint(e){this.addItem(this.m_pointsToProcess,e)}processPoints(e){this.addItems(this.m_pointsToProcess,e)}ignorePoint(e){this.addItem(this.m_ignoredPoints,e)}ignorePoints(e){this.addItems(this.m_ignoredPoints,e)}processLine(e){this.addItem(this.m_linesToProcess,e)}processLines(e){this.addItems(this.m_linesToProcess,e)}ignoreLine(e){this.addItem(this.m_linesToIgnore,e)}ignoreLines(e){this.addItems(this.m_linesToIgnore,e)}processPolygon(e){this.addItem(this.m_polygonsToProcess,e)}processPolygons(e){this.addItems(this.m_polygonsToProcess,e)}ignorePolygon(e){this.addItem(this.m_polygonsToIgnore,e)}ignorePolygons(e){this.addItems(this.m_polygonsToIgnore,e)}processKinds(e){this.m_kindsToProcess=this.m_kindsToProcess.concat(e)}ignoreKinds(e){this.m_kindsToIgnore=this.m_kindsToIgnore.concat(e)}createDescription(){return{processLayersDefault:this.m_processLayersDefault,processPointsDefault:this.m_processPointsDefault,processLinesDefault:this.m_processLinesDefault,processPolygonsDefault:this.m_processPolygonsDefault,layersToProcess:this.m_layersToProcess,layersToIgnore:this.m_layersToIgnore,pointsToProcess:this.m_pointsToProcess,pointsToIgnore:this.m_ignoredPoints,linesToProcess:this.m_linesToProcess,linesToIgnore:this.m_linesToIgnore,polygonsToProcess:this.m_polygonsToProcess,polygonsToIgnore:this.m_polygonsToIgnore,kindsToProcess:this.m_kindsToProcess,kindsToIgnore:this.m_kindsToIgnore}}addItem(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const i={layerName:{value:t.layer,match:void 0===t.matchLayer?r.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomType?Array.isArray(t.geomType)?t.geomType:[t.geomType]:void 0,classes:[{value:t.featureClass,match:void 0===t.matchClass?r.OmvFilterString.StringMatch.Match:t.matchClass}],minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(i)}addItems(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const i={layerName:{value:t.layer,match:void 0===t.matchLayer?r.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomTypes?Array.isArray(t.geomTypes)?t.geomTypes:[t.geomTypes]:void 0,classes:t.featureClasses,minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(i)}};class s{constructor(e){this.description=e,this.description.kindsToProcess.length>0&&(this.enabledKinds=new n.GeometryKindSet(this.description.kindsToProcess)),this.description.kindsToIgnore.length>0&&(this.disabledKinds=new n.GeometryKindSet(this.description.kindsToIgnore))}static matchLayer(e,t,i){for(const n of t)if(!(i<n.minLevel||i>n.maxLevel)&&r.OmvFilterString.matchString(e,n.name))return!0;return!1}wantsLayer(e,t){return!!s.matchLayer(e,this.description.layersToProcess,t)||!s.matchLayer(e,this.description.layersToIgnore,t)&&this.description.processLayersDefault}wantsPointFeature(e,t,i){return this.wantsFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,i,this.description.processPointsDefault)}wantsLineFeature(e,t,i){return this.wantsFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,i,this.description.processLinesDefault)}wantsPolygonFeature(e,t,i){return this.wantsFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,i,this.description.processPolygonsDefault)}wantsKind(e){return void 0===e||(!(void 0!==this.disabledKinds&&this.disabledKinds.hasOrIntersects(e))||void 0!==this.enabledKinds&&this.enabledKinds.hasOrIntersects(e))}get hasKindFilter(){return void 0!==this.enabledKinds||void 0!==this.disabledKinds}wantsFeature(e,t,i,n,s,o){for(const t of e)if(!(s<t.minLevel||s>t.maxLevel)&&r.OmvFilterString.matchString(i,t.layerName)&&void 0!==t.geometryTypes&&t.geometryTypes.includes(n))return!0;for(const e of t)if(r.OmvFilterString.matchString(i,e.layerName)&&void 0!==e.geometryTypes&&e.geometryTypes.includes(n))return!1;return o}}t.OmvGenericFeatureFilter=s;t.ComposedDataFilter=class{constructor(e){this.filters=e}get hasKindFilter(){return this.filters.reduce((e,t)=>e||t.hasKindFilter,!0)}wantsLayer(e,t){return this.filters.reduce((i,n)=>i&&n.wantsLayer(e,t),!0)}wantsPointFeature(e,t,i){return this.filters.reduce((n,r)=>n&&r.wantsPointFeature(e,t,i),!0)}wantsLineFeature(e,t,i){return this.filters.reduce((n,r)=>n&&r.wantsLineFeature(e,t,i),!0)}wantsPolygonFeature(e,t,i){return this.filters.reduce((n,r)=>n&&r.wantsPolygonFeature(e,t,i),!0)}wantsKind(e){return this.filters.reduce((t,i)=>t&&i.wantsKind(e),!0)}};class o{constructor(e){this.description=e}static matchItems(e,t,i){for(const n of i)if(void 0!==n.classes){if(!r.OmvFilterString.matchString(e,n.layerName))continue;for(const e of n.classes)if(r.OmvFilterString.matchString(t,e))return!0}return!1}static matchAttribute(e,t,i){for(const n of i)if(void 0!==n.featureAttribute&&r.OmvFilterString.matchString(e,n.layerName)&&t.lookup(n.featureAttribute.key)===n.featureAttribute.value)return!0;return!1}doProcessPointFeature(e,t){return this.doProcessFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,this.description.processPointsDefault)}doProcessLineFeature(e,t){return this.doProcessFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,this.description.processLinesDefault)}doProcessPolygonFeature(e,t){return this.doProcessFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,this.description.processPolygonsDefault)}doProcessFeature(e,t,i,n,r){if(void 0===i||0===e.length&&0===t.length)return r;let s;const a=n.lookup("class");return null!=a&&(s=a.toString()),!(!s||!o.matchItems(i,s,e))||(!s||!o.matchItems(i,s,t))&&(!!o.matchAttribute(i,n,e)||!o.matchAttribute(i,n,t)&&r)}}t.OmvGenericFeatureModifier=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDataSource=void 0;const n=i(3),r=i(2),s=i(5),o=i(38),a=i(1),l=i(28),c=i(169),h=a.LoggerManager.instance.create("VectorTileDataSource");function u(e){var t;if(e.dataProvider)return e.dataProvider;if(null!==(t=e.baseUrl)&&void 0!==t?t:e.url)return new c.OmvRestClient(e);throw new Error("OmvDataSource: missing url, baseUrl or dataProvider params")}let d=!1;const m="https://vector.hereapi.com/v2/vectortiles/base/mc",p={baseUrl:m,apiFormat:c.APIFormat.XYZOMV,styleSetName:"tilezen",authenticationMethod:{method:c.AuthenticationMethod.QueryString,name:"apikey"},copyrightInfo:[{id:"here.com",year:(new Date).getFullYear(),label:"HERE",link:"https://legal.here.com/terms"}]},f=new Map([[m,p]]);class g extends o.TileDataSource{constructor(e){var t,i,n,h,d,p,g,v;super(null!==(t=e.tileFactory)&&void 0!==t?t:new o.TileFactory(s.Tile),Object.assign({styleSetName:null!==(i=e.styleSetName)&&void 0!==i?i:"omv",concurrentDecoderServiceName:null!==(n=e.concurrentDecoderServiceName)&&void 0!==n?n:l.VECTOR_TILE_DECODER_SERVICE_TYPE,minDataLevel:null!==(h=e.minDataLevel)&&void 0!==h?h:1,maxDataLevel:null!==(d=e.maxDataLevel)&&void 0!==d?d:17,storageLevelOffset:null!==(p=e.storageLevelOffset)&&void 0!==p?p:-1},function(e){var t;if(void 0===e.dataProvider&&void 0===e.url){const i=null!==(t=e.baseUrl)&&void 0!==t?t:m,n=Object.assign(Object.assign({},f.get(i)),e);return Object.assign(Object.assign({},n),{tilingScheme:r.webMercatorTilingScheme,dataProvider:new c.OmvRestClient(n)})}return Object.assign(Object.assign({},e),{tilingScheme:r.webMercatorTilingScheme,dataProvider:u(e)})}(e))),this.m_params=e,this.cacheable=!0,this.addGroundPlane=void 0===e.addGroundPlane||!0===e.addGroundPlane;let y=e.roundUpCoordinatesIfNeeded;void 0===y&&(null===(g=e)||void 0===g?void 0:g.baseUrl)===m&&(y=!0),this.m_decoderOptions={showMissingTechniques:!0===this.m_params.showMissingTechniques,filterDescription:this.m_params.filterDescr,gatherFeatureAttributes:!0===this.m_params.gatherFeatureAttributes,featureModifiers:this.m_params.featureModifierId?[this.m_params.featureModifierId]:void 0,politicalView:this.m_params.politicalView,skipShortLabels:this.m_params.skipShortLabels,storageLevelOffset:null!==(v=e.storageLevelOffset)&&void 0!==v?v:-1,enableElevationOverlay:!0===this.m_params.enableElevationOverlay,roundUpCoordinatesIfNeeded:y},this.maxGeometryHeight=a.getOptionValue(e.maxGeometryHeight,r.EarthConstants.MAX_BUILDING_HEIGHT),this.minGeometryHeight=a.getOptionValue(e.minGeometryHeight,0)}async connect(){try{await super.connect()}catch(e){throw e.message&&n.WorkerServiceProtocol.isUnknownServiceError(e)&&!d&&(h.info("Unable to create decoder service in worker. Use  'OmvTileDecoderService.start();' in decoder script."),d=!0),"string"==typeof e?new Error(e):e}this.configureDecoder(void 0,this.m_decoderOptions)}removeDataFilter(){this.configureDecoder(void 0,{filterDescription:null})}setDataFilter(e){this.m_decoderOptions.filterDescription=null!==e?e:void 0,this.configureDecoder(void 0,{filterDescription:e,featureModifiers:this.m_decoderOptions.featureModifiers,politicalView:this.m_decoderOptions.politicalView})}shouldPreloadTiles(){return!0}setPoliticalView(e){e=null==e?void 0:e.toLowerCase(),this.m_decoderOptions.politicalView!==e&&(this.m_decoderOptions.politicalView=e,this.configureDecoder(void 0,{filterDescription:this.m_decoderOptions.filterDescription,featureModifiers:this.m_decoderOptions.featureModifiers,politicalView:void 0!==e?e:""}))}get storageLevelOffset(){return super.storageLevelOffset}set storageLevelOffset(e){super.storageLevelOffset=e,this.m_decoderOptions.storageLevelOffset=this.storageLevelOffset,this.configureDecoder(void 0,{storageLevelOffset:this.storageLevelOffset})}setEnableElevationOverlay(e){this.m_decoderOptions.enableElevationOverlay!==e&&(this.m_decoderOptions.enableElevationOverlay=e,this.configureDecoder(void 0,{enableElevationOverlay:e}))}configureDecoder(e,t){this.clearCache(),this.decoder.configure(e,t),this.mapView.markTilesDirty(this)}}t.VectorTileDataSource=g},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileInfoLoader=t.TileLoader=void 0,i(16);const n=i(3),r=i(5),s=i(45),o=i(1).LoggerManager.instance.create("TileLoader");class a extends r.BaseTileLoader{constructor(e,t,i,n){super(e,t),this.dataSource=e,this.tileKey=t,this.dataProvider=i,this.tileDecoder=n}get priority(){return this.m_priority}set priority(e){this.m_priority=e,void 0!==this.requestController&&(this.requestController.priority=e)}loadImpl(e,t,i){this.dataProvider.getTile(this.tileKey,e).then(n=>{if(e.aborted){const e=new Error("Aborted");throw e.name="AbortError",e}this.onLoaded(n,t,i)}).catch(e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&i(e)})}cancelImpl(){this.state===s.TileLoaderState.Decoding&&this.requestController&&(this.requestController.abort(),this.requestController=void 0)}startDecodeTile(e,t){const i=this.payload;if(void 0===i)return void o.error("TileLoader#startDecodeTile: Cannot decode without payload");this.state=s.TileLoaderState.Decoding,this.payload=void 0;const r=new n.RequestController(this.priority);this.requestController=r;const a=this.dataSource;this.tileDecoder.decodeTile(i,this.tileKey,a.projection,r).then(t=>{r.signal.aborted||this.onDecoded(t,e)}).catch(e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&t(e)})}onLoaded(e,t,i){this.state=s.TileLoaderState.Loaded,this.payload=e;0===e.byteLength||e.constructor===Object&&0===Object.keys(e).length?this.onDecoded({geometries:[],techniques:[]},t):this.startDecodeTile(t,i)}onDecoded(e,t){this.decodedTile=e,t(s.TileLoaderState.Ready)}}t.TileLoader=a;t.TileInfoLoader=class extends a{startDecodeTile(e,t){const i=this.payload;if(void 0===i)return void o.error("TileInfoLoader#startDecodeTile: Cannot decode without payload");this.state=s.TileLoaderState.Decoding,this.payload=void 0;const r=new n.RequestController(this.priority);this.requestController=r;const a=this.dataSource;this.tileDecoder.getTileInfo(i,this.tileKey,a.projection,r).then(t=>{r.signal.aborted||(this.tileInfo=t,e(s.TileLoaderState.Ready))}).catch(e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&t(e)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvRestClient=t.AuthenticationTypeAccessToken=t.AuthenticationTypeTomTomV1=t.AuthenticationTypeBearer=t.AuthenticationMethod=t.APIFormat=void 0,i(16);const n=i(38),r=i(160),s=i(1).LoggerManager.instance.create("OmvRestClient");var o,a;!function(e){e[e.HereV1=0]="HereV1",e[e.MapboxV4=1]="MapboxV4",e[e.XYZMVT=2]="XYZMVT",e[e.XYZJson=3]="XYZJson",e[e.XYZOMV=4]="XYZOMV",e[e.TomtomV1=5]="TomtomV1",e[e.XYZSpace=6]="XYZSpace"}(o=t.APIFormat||(t.APIFormat={})),function(e){e[e.QueryString=0]="QueryString",e[e.AuthorizationHeader=1]="AuthorizationHeader"}(a=t.AuthenticationMethod||(t.AuthenticationMethod={})),t.AuthenticationTypeBearer={method:a.AuthorizationHeader,name:"Bearer"},t.AuthenticationTypeTomTomV1={method:a.QueryString,name:"key"},t.AuthenticationTypeAccessToken={method:a.QueryString,name:"access_token"};class l extends n.DataProvider{constructor(e){super(),this.params=e,this.downloadManager=void 0===e.downloadManager?r.TransferManager.instance():e.downloadManager,this.urlParams=void 0===e.urlParams?{}:e.urlParams}async connect(){}ready(){return!0}async getTile(e,t){const i={signal:t};let n=this.dataUrl(e);const r=await this.getActualAuthenticationCode();return n=this.applyAuthCode(n,i,r),n=this.addQueryParams(n,this.urlParams),this.params.apiFormat===o.XYZJson?await this.downloadManager.downloadJson(n,i):await this.downloadManager.downloadArrayBuffer(n,i)}dispose(){}async getActualAuthenticationCode(){return"string"==typeof this.params.authenticationCode?this.params.authenticationCode:void 0!==this.params.authenticationCode?await this.params.authenticationCode():void 0!==this.params.getBearerToken?await this.params.getBearerToken():void 0}getDefaultAuthMethod(){if(void 0!==this.params.getBearerToken)return t.AuthenticationTypeBearer;switch(this.params.apiFormat){case o.HereV1:return t.AuthenticationTypeBearer;case o.MapboxV4:case o.XYZOMV:case o.XYZMVT:case o.XYZSpace:case o.XYZJson:return t.AuthenticationTypeAccessToken;case o.TomtomV1:return t.AuthenticationTypeTomTomV1;default:return void s.warn("#getDefaultAuthMethod: Not supported API format: "+this.params.apiFormat)}}applyAuthCode(e,t,i){var n,r,s;if(void 0===i)return e;const o=null!==(n=this.params.authenticationMethod)&&void 0!==n?n:this.getDefaultAuthMethod();if(void 0===o)return e;if(o.method===a.AuthorizationHeader){void 0===t.headers&&(t.headers=new Headers);const e=null!==(r=o.name)&&void 0!==r?r:"Bearer";t.headers.append("Authorization",`${e} ${i}`)}else if(o.method===a.QueryString){const t={};t[null!==(s=o.name)&&void 0!==s?s:"access_token"]=i,e=this.addQueryParams(e,t)}return e}dataUrl(e){if(void 0!==this.params.url)return this.params.url.replace("{x}",String(e.column)).replace("{y}",String(e.row)).replace("{z}",String(e.level));let t=["/"+e.level,e.column,e.row].join(this.params.apiFormat===o.XYZSpace||this.params.apiFormat===o.XYZJson?"_":"/");switch(this.params.apiFormat){case o.HereV1:case o.XYZOMV:t+="/omv";break;case o.MapboxV4:case o.XYZMVT:t+=".mvt";break;case o.XYZJson:break;case o.XYZSpace:t+=".mvt";break;case o.TomtomV1:t+=".pbf";break;default:s.warn("Not supported API format: "+this.params.apiFormat)}return this.params.baseUrl+t}addQueryParams(e,t){let i="",n=e.includes("?")?"&":"?";for(const e in t)t.hasOwnProperty(e)&&(i+=`${n}${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`,"?"===n&&(n="&"));return e+i}}t.OmvRestClient=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWidthAndHeightFromCanvas=t.safeParseDecimalInt=t.azimuthAltitudeToDirection=t.calculateNormalizedDeviceCoordinates=void 0;const n=i(0);function r(e,t){if(null==e||""===e)return t;if(!e.match(s))return t;const i=Number.parseInt(e,10);return isNaN(i)?t:i}t.calculateNormalizedDeviceCoordinates=function(e,t,i,r){return new n.Vector2(e/i*2-1,-t/r*2+1)},t.azimuthAltitudeToDirection=function(e,t){e=e,t=t;const i=new n.Vector3,r=Math.cos(t);return i.setX(Math.sin(e)*r),i.setY(Math.cos(e)*r),i.setZ(Math.sin(t)),i},t.safeParseDecimalInt=r;const s=/^\d+$/;t.getWidthAndHeightFromCanvas=function(e){return{width:r(e.style.width,e.clientWidth),height:r(e.style.height,e.clientHeight)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapControlsUI=void 0;const n=i(2),r=i(5);t.MapControlsUI=class{constructor(e,t={}){this.controls=e,this.domElement=document.createElement("div"),this.m_buttonsElement=document.createElement("div"),this.m_zoomLevelElement=null,this.m_projectionSwitchElement=null,this.m_onMapViewRenderEvent=()=>{if(null===this.m_zoomLevelElement)return;const e=this.controls.zoomLevelTargeted.toFixed(1);"INPUT"===this.m_zoomLevelElement.tagName?this.m_zoomLevelElement.value=e:this.m_zoomLevelElement.innerHTML=e},this.m_onWindowClick=e=>{const t=this.m_zoomLevelElement;e&&e.target&&e.target.contains&&e.target!==t&&!e.target.contains(t)&&t.blur()};const i=document.createElement("span");i.className="harp-gl_v-align",this.domElement.appendChild(i),this.m_buttonsElement=document.createElement("div"),this.m_buttonsElement.className="harp-gl_v-aligned",this.domElement.appendChild(this.m_buttonsElement);const s=document.createElement("button");s.innerText="+",s.className="harp-gl_controls_button-top",s.classList.add("harp-gl_controls-button");const o=document.createElement("button");o.innerText="-",o.className="harp-gl_controls_button-bottom",o.classList.add("harp-gl_controls-button");const a=document.createElement("button");a.innerText="3D",a.id="harp-gl_controls_tilt-button-ui",a.title="Toggle tilt",a.classList.add("harp-gl_controls-button"),a.classList.add("harp-gl_controls_button-bottom");const l=document.createElement("button");l.id="harp-gl_controls-button_compass",l.title="Reset North",l.classList.add("harp-gl_controls-button"),l.classList.add("harp-gl_controls_button-top");const c=document.createElement("span");if(c.id="harp-gl_controls_compass",l.appendChild(c),"show"===t.zoomLevel)this.m_zoomLevelElement=document.createElement("div"),e.mapView.addEventListener(r.MapViewEventNames.Render,this.m_onMapViewRenderEvent);else if("input"===t.zoomLevel){const t=document.createElement("input");t.type="number",t.step="0.1",e.mapView.addEventListener(r.MapViewEventNames.Render,this.m_onMapViewRenderEvent);const i=i=>{e.setZoomLevel(parseFloat(t.value)),i.preventDefault()};t.addEventListener("blur",i),t.addEventListener("keypress",e=>{"Enter"===e.key&&i(e)}),window.addEventListener("click",this.m_onWindowClick),this.m_zoomLevelElement=t}if(t.projectionSwitch){const e=document.createElement("button");e.id="harp-gl_controls_switch_projection",e.classList.add("harp-gl_controls-button");const t=()=>`Switch to ${this.controls.mapView.projection.type===n.ProjectionType.Spherical?"flat":"globe"} projection`;e.title=t();const i='\n    <svg style="margin-top:5px;" stroke-width="2" class="harp-gl_controls_switch_svg" width="50" height="50" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">\n        <ellipse ry="9.79855" rx="4.56139" id="svg_6" cy="11.99798" cx="11.99798" fill="none"/>\n        <line id="svg_8" y2="8.16866" x2="21.12086" y1="8.16866" x1="3.10044"/>\n        <line id="svg_9" y2="16.10887" x2="21.0645" y1="16.10887" x1="3.04409"/>\n        <ellipse id="svg_11" ry="9.79855" rx="9.82671" cy="11.94167" cx="12.02614" fill="none"/>\n    </svg>',r='\n    <svg style="margin-top:5px;" class="harp-gl_controls_switch_svg" width="25" height="25" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">\n        <rect id="svg_1" stroke-width="2" height="13.51524" width="18.35821" y="5.80349" x="3.21307" fill="none"/>\n        <path id="svg_14" d="m9.52018,7.71815l1.2357,-0.0032l-0.61945,1.18258l-0.61625,-1.17938z"/>\n        <path id="svg_15" d="m4.11409,7.32396l3.65718,-0.0032l0.28156,2.13991l-2.59042,1.57678l0.50682,1.80203l2.25254,0.8447l-0.90101,2.0836l0.28157,2.25254l-3.26619,-3.04093l0.67576,-2.02728l-0.61945,-1.97097l-1.01364,-3.15356l0.73528,-0.50362z"/>\n        <path id="svg_17" d="m13.23688,7.4929l2.02409,-0.0032l0.78839,1.29521l2.47779,-1.35152l2.75936,0.78839l0,1.57678l-0.73208,0.61945l-0.28157,1.97097c0,0 -0.67256,0.8479 -0.72888,0.90422c-0.05631,0.05631 0.28157,1.06996 0.33788,1.18258c0.05631,0.11263 -1.68941,-1.35152 -1.6926,-1.35472c-0.0032,-0.0032 -0.16574,1.29841 -0.16894,1.29521c-0.0032,-0.0032 -1.57358,-1.34832 -1.57678,-1.35152c-0.0032,-0.0032 -0.72888,0.67896 -0.73208,0.67576c-0.0032,-0.0032 -0.8415,-0.67256 -0.8447,-0.67576c-0.0032,-0.0032 0.73528,2.0868 0.79159,2.0868c0.05631,0 -0.50682,3.20987 -0.51002,3.20667c-0.0032,-0.0032 -1.2357,-0.16574 -1.34832,-0.16574c-0.11263,0 -0.95733,-1.52046 -0.90102,-1.57678c0.05631,-0.05631 0,-1.80203 -0.0032,-1.80523c-0.0032,-0.0032 -1.40464,-0.33468 -1.40784,-0.33788c-0.0032,-0.0032 -0.05311,-1.74252 -0.05631,-1.74572c-0.0032,-0.0032 1.18578,-0.8415 1.18258,-0.8447c-0.0032,-0.0032 1.69261,-0.16574 1.74892,-0.16574c0.05631,0 1.2389,-1.06996 1.2357,-1.07316c-0.0032,-0.0032 -1.91146,-0.10943 -1.91466,-0.11263c-0.0032,-0.0032 -1.96777,0.17214 -1.97097,0.16894c-0.0032,-0.0032 1.52366,-3.20667 1.52366,-3.20667z"/>\n    </svg>';e.innerHTML=this.controls.mapView.projection.type===n.ProjectionType.Spherical?r:i,e.addEventListener("click",()=>{this.controls.mapView.projection=this.controls.mapView.projection.type===n.ProjectionType.Spherical?n.mercatorProjection:n.sphereProjection,e.title=t(),e.innerHTML=this.controls.mapView.projection.type===n.ProjectionType.Spherical?r:i}),this.m_projectionSwitchElement=e}return this.m_buttonsElement.appendChild(s),null!==this.m_zoomLevelElement&&this.m_buttonsElement.appendChild(this.m_zoomLevelElement),this.m_buttonsElement.appendChild(o),this.m_buttonsElement.appendChild(l),this.m_buttonsElement.appendChild(a),null!==this.m_projectionSwitchElement&&this.m_buttonsElement.appendChild(this.m_projectionSwitchElement),s.addEventListener("click",t=>{const i=e.zoomLevelTargeted+e.zoomLevelDeltaOnControl;e.setZoomLevel(i)}),s.addEventListener("dblclick",e=>{e.stopPropagation()}),o.addEventListener("click",t=>{const i=e.zoomLevelTargeted-e.zoomLevelDeltaOnControl;e.setZoomLevel(i)}),o.addEventListener("dblclick",e=>{e.stopPropagation()}),a.addEventListener("click",t=>{e.toggleTilt()}),l.addEventListener("click",t=>{e.pointToNorth()}),e.mapView.addEventListener(r.MapViewEventNames.AfterRender,()=>{c.style.transform=`rotate(${e.mapView.heading}deg)`}),this.domElement.className="harp-gl_controls",null!==this.m_zoomLevelElement&&this.m_zoomLevelElement.classList.add("harp-gl_controls_zoom-level"),!0!==t.disableDefaultStyle&&(this.initStyle(),this.domElement.style.cssText="\n                position: absolute;\n                right: 5px;\n                top: 0;\n                height: 100%; /* Vertical alignment is done dynamically, in the rest of the CSS. */\n                pointer-events: none; /* Allows to click the map even though height is 100%. */\n            "),this}get projectionSwitchElement(){return this.m_projectionSwitchElement}dispose(){null!==this.m_zoomLevelElement&&"INPUT"===this.m_zoomLevelElement.tagName&&window.removeEventListener("click",this.m_onWindowClick),this.controls.mapView.removeEventListener(r.MapViewEventNames.Render,this.m_onMapViewRenderEvent),this.domElement.remove()}initStyle(){if(null!==document.getElementById("here-harp-controls.map-controls-ui-styles"))return;const e=document.createElement("style");e.id="here-harp-controls.map-controls-ui-styles",e.appendChild(document.createTextNode('\n        /* CSS trick to align another div dynamically. */\n        .harp-gl_v-align{\n            height: 100%;\n            display: inline-block;\n            vertical-align: middle;\n        }\n        /* The target element to align vertically with vertical-align. */\n        .harp-gl_v-aligned{\n            pointer-events: all;\n            vertical-align: middle;\n            display: inline-block;\n        }\n        .harp-gl_controls-button {\n            display: block;\n            background-color: #272d37;\n            width: 40px;\n            height: 40px;\n            font-size: 22px;\n            font-weight: bold;\n            outline: none;\n            margin:0;\n            border: none;\n            color: rgba(255, 255, 255, 0.8);\n            cursor: pointer;\n            border-radius: 4px;\n            box-shadow: 0px 0px 5px 0 hsl(220, 4%, 40%);\n            transition: all 0.1s;\n            padding: 0 0 1px 1px;\n            user-select: none;\n            position:relative;\n        }\n        #harp-gl_controls_tilt-button-ui {\n            font-size: 16px;\n        }\n        .harp-gl_controls-button:active {\n            background-color: #37afaa;\n            color: #eee;\n        }\n        .harp-gl_controls-button:focus {\n            outline:none;\n        }\n        .harp-gl_controls_button-top{\n            margin-bottom:0;\n            border-bottom-right-radius:0;\n            border-bottom-left-radius:0;\n        }\n        .harp-gl_controls_button-bottom{\n            margin-top:1px;\n            border-top-right-radius:0;\n            border-top-left-radius:0;\n        }\n        .harp-gl_controls_zoom-level {\n            display: block;\n            background-color: #fff;\n            width: 40px;\n            height: 20px;\n            font-size: 12px;\n            font-weight: bold;\n            outline: none;\n            border: none;\n            color: #555;\n            opacity: 0.87;\n            box-shadow: 0px 0px 4px #aaa;\n            padding: 2px 0 0;\n            text-align: center;\n            user-select: text;\n        }\n        input.harp-gl_controls_zoom-level::-webkit-outer-spin-button,\n        input.harp-gl_controls_zoom-level::-webkit-inner-spin-button {\n            /* display: none; <- Crashes Chrome on hover */\n            -webkit-appearance: none;\n            margin: 0; /* <-- Apparently some margin are still there even though it\'s hidden */\n        }\n        input.harp-gl_controls_zoom-level[type=number] {\n            -moz-appearance:textfield; /* Firefox */\n        }\n        #harp-gl_controls-button_compass{\n            overflow: hidden;\n            margin: 5px 0 0 0;\n        }\n        #harp-gl_controls_compass{\n            pointer-events:none;\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            margin:0\n        }\n        #harp-gl_controls_compass::after{\n            content: " ";\n            position:absolute;\n            left:50%;\n            margin-left:-3px;\n            top:50%;\n            margin-top: -18px;\n            border:solid 3px rgba(0,0,0,0);\n            border-bottom:solid 15px #a34f2e;\n        }\n        #harp-gl_controls_compass::before{\n            content: " ";\n            position:absolute;\n            left:50%;\n            margin-left:-3px;\n            top:50%;\n            margin-top:0px;\n            border:solid 3px rgba(0,0,0,0);\n            border-top:solid 15px #eee;\n        }\n        #harp-gl_controls_switch_projection{\n            margin-top:5px;\n        }\n        .harp-gl_controls_switch_svg{\n            width: 25px;\n            height: 25px;\n            stroke: #d4d5d7;\n            fill: #d4d5d7;\n        }\n    ')),document.head.appendChild(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clipPolygon=t.ClippingEdge=void 0;const n=i(0);class r{clipPolygon(e,t){const i=e;e=[];const n=t=>{const i=e[e.length-1];(!(null==i?void 0:i.equals(t))||!0===t.isClipped&&!(null==i?void 0:i.isClipped)||!t.isClipped&&!0===(null==i?void 0:i.isClipped))&&e.push(t)};for(let e=0;e<i.length;++e){const r=i[e],s=i[(e+i.length-1)%i.length];if(this.inside(r,t)){if(!this.inside(s,t)){const e=this.computeIntersection(s,r,t);e.isClipped=!0,n(e)}n(r)}else if(this.inside(s,t)){const e=this.computeIntersection(s,r,t);e.isClipped=!0,n(e)}}return e}}t.ClippingEdge=r;const s=[new class extends r{inside(e){return e.y>=0}computeIntersection(e,t){const{x:i,y:r}=e,{x:s,y:o}=t;return new n.Vector2((i*o-r*s)/-(r-o),0).round()}},new class extends r{inside(e,t){return e.x<=t}computeIntersection(e,t,i){const{x:r,y:s}=e,{x:o,y:a}=t;return new n.Vector2(i,(r*a-s*o-(s-a)*-i)/(r-o)).round()}},new class extends r{inside(e,t){return e.y<=t}computeIntersection(e,t,i){const{x:r,y:s}=e,{x:o,y:a}=t;return new n.Vector2((r*a-s*o-(r-o)*i)/-(s-a),i).round()}},new class extends r{inside(e){return e.x>=0}computeIntersection(e,t){const{x:i,y:r}=e,{x:s,y:o}=t;return new n.Vector2(0,(i*o-r*s)/(i-s)).round()}}];t.clipPolygon=function(e,t){if(0===e.length)return e;e[0].equals(e[e.length-1])||(e=[...e,e[0]]);for(const i of s)e=i.clipPolygon(e,t);return e.length<3?[]:e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapLineString=t.clipLineString=void 0;const n=i(2),r=i(1),s=i(0);class o{constructor(e,t,i,n,r){this.isInside=r,this.p0=new s.Vector2(e,t),this.p1=new s.Vector2(i,n)}inside(e){return this.isInside(e)}computeIntersection(e,t){const i=new s.Vector2;return r.Math2D.intersectLines(e.x,e.y,t.x,t.y,this.p0.x,this.p0.y,this.p1.x,this.p1.y,i),i}clipLine(e){const t=e,i=[];e=[],i.push(e);const n=t=>{0!==e.length&&e[e.length-1].equals(t)||e.push(t)};for(let r=0;r<t.length;++r){const s=t[r],o=r>0?t[r-1]:void 0;this.inside(s)?(void 0===o||this.inside(o)||(e.length>0&&(e=[],i.push(e)),n(this.computeIntersection(o,s))),n(s)):void 0!==o&&this.inside(o)&&n(this.computeIntersection(o,s))}return 0===i[i.length-1].length&&(i.length=i.length-1),i}clipLines(e){const t=[];return e.forEach(e=>{this.clipLine(e).forEach(e=>{t.push(e)})}),t}}function a(e,t,i){for(const i of t)e=i.clipLines(e);const r=new s.Vector3,o=[];return e.forEach(e=>{if(0===e.length)return;const t=e.map(({x:e,y:t})=>{r.set(e,t,0);const s=n.webMercatorProjection.unprojectPoint(r);return s.longitude+=i,s});o.push(t)}),o.length>0?o:void 0}t.clipLineString=function(e,t,i,n,r){const s=new o(t,i,t,r,e=>e.x>t),a=new o(t,r,n,r,e=>e.y<r),l=new o(n,r,n,i,e=>e.x<n),c=new o(n,i,t,i,e=>e.y>i);let h=s.clipLine(e);return h=a.clipLines(h),h=l.clipLines(h),h=c.clipLines(h),h},t.wrapLineString=function(e){const t=new s.Vector3,i=[e.map(e=>{const{x:i,y:r}=n.webMercatorProjection.projectPoint(e,t);return new s.Vector2(i,r)})];return{left:a(i,h,360),middle:a(i,c,0),right:a(i,u,-360)}};const l=n.EarthConstants.EQUATORIAL_CIRCUMFERENCE,c=[new o(0,l,0,0,e=>e.x>0),new o(l+0,0,l+0,l,e=>e.x<l+0)],h=[new o(-l-0,l,-l-0,0,e=>e.x>-l-0),new o(0,0,0,l,e=>e.x<0)],u=[new o(l-0,l,l-0,0,e=>e.x>l-0),new o(2*l+0,0,2*l+0,l,e=>e.x<2*l+0)]},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectDataProvider=void 0;const n=i(84);class r extends n.DataProvider{constructor(e){super(),this.provider=e}setTilingScheme(e){this.m_tilingScheme=e}setProjectionSource(e){this.m_projectionSource=e}getProjectionSource(){return this.m_projectionSource}setIconLoader(e){this.m_iconLoader=e}getIconLoader(){return this.m_iconLoader}async connect(){}dispose(){var e;null===(e=this.m_iconLoader)||void 0===e||e.dispose()}ready(){return void 0!==this.m_iconLoader}}t.ObjectDataProvider=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i=0){let n,r;return function(){const s=this,o=arguments;function a(){r=0,e.apply(s,o)}clearTimeout(n),r>0&&i&&Date.now()-r>=i?a():(void 0===r&&(r=Date.now()),n=setTimeout(()=>a(),t))}}},function(e,t,i){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonTiler=void 0;const r=i(3),s=i(405),o=null!==(n=s.default)&&void 0!==n?n:s,a=-(-2&-Math.ceil(204.8));t.GeoJsonTiler=class{constructor(){this.indexes=new Map}dispose(){}async connect(){return await Promise.resolve()}async registerIndex(e,t){if(!this.indexes.has(e))return await this.updateIndex(e,t)}async updateIndex(e,t){if(t instanceof URL){const e=await fetch(t.href);if(!e.ok)throw new Error(`GeoJsonTiler: Unable to fetch ${t.href}: ${e.statusText}`);t=await e.json()}else t=t;const i=r.isFeatureGeometry(t)||"GeometryCollection"===t.type||"Feature"===t.type&&void 0===t.id||"FeatureCollection"===t.type&&t.features.length>0&&void 0===t.features[0].id,n=o(t,{maxZoom:20,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:a,lineMetrics:!1,promoteId:null,generateId:i,debug:0});n.geojson=t,this.indexes.set(e,n)}async getTile(e,t){const i=this.indexes.get(e);if(void 0===i)throw new Error("Tile not found");const n=i.getTile(t.level,t.column,t.row);return null!==n&&(n.layer=e),n||{}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataAdapter=void 0;const n=i(173),r=i(2),s=i(0),o=i(53),a=new s.Vector3;function l(e,t,i){return r.webMercatorProjection.projectPoint(r.GeoCoordinates.fromGeoPoint(e),a),o.world2tile(4096,t,a,!1,i)}function c(e,t){return{untiledPositions:e.map(e=>r.GeoCoordinates.fromGeoPoint(e)),positions:e.map(e=>l(e,t,new s.Vector2))}}function h(e,t){return"LineString"===e.type?[c(e.coordinates,t)]:e.coordinates.map(e=>c(e,t))}function u(e,t){return{rings:e.map((e,i)=>{const n=0===i,{positions:r}=c(e,t),o=s.ShapeUtils.area(r)>0;return(n&&!o||!n&&o)&&r.reverse(),r})}}function d(e,t){return"Polygon"===e.type?[u(e.coordinates,t)]:e.coordinates.map(e=>u(e,t))}function m(e,t){return"Point"===e.type?[l(e.coordinates,t,new s.Vector3)]:e.coordinates.map(e=>l(e,t,new s.Vector3))}t.GeoJsonDataAdapter=class{canProcess(e){return e&&"FeatureCollection"===e.type&&Array.isArray(e.features)}process(e,t,i,r="geojson"){if(Array.isArray(e.features)&&0!==e.features.length)for(const s of e.features)switch(s.geometry.type){case"LineString":case"MultiLineString":{let e=h(s.geometry,t);const o=[],a=100;e.forEach(e=>{n.clipLineString(e.positions,-a,-a,4096+a,4096+a).forEach(e=>{o.push({positions:e})})}),e=o,e.length>0&&i.processLineFeature(r,4096,o,s.properties,s.id);break}case"Polygon":case"MultiPolygon":{const e=d(s.geometry,t);i.processPolygonFeature(r,4096,e,s.properties,s.id);break}case"Point":case"MultiPoint":{const e=m(s.geometry,t);i.processPointFeature(r,4096,e,s.properties,s.id);break}}}}},function(e,t,i){"use strict";var n,r,s,o=i(365),a=o.Reader,l=o.util,c=o.roots.default||(o.roots.default={});c.com=((s={}).mapbox=((r={}).pb=((n={}).Tile=function(){function e(e){if(this.layers=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}var t,i;return e.prototype.layers=l.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile;e.pos<i;){var r=e.uint32();switch(r>>>3){case 3:n.layers&&n.layers.length||(n.layers=[]),n.layers.push(c.com.mapbox.pb.Tile.Layer.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile)return e;var t=new c.com.mapbox.pb.Tile;if(e.layers){if(!Array.isArray(e.layers))throw TypeError(".com.mapbox.pb.Tile.layers: array expected");t.layers=[];for(var i=0;i<e.layers.length;++i){if("object"!=typeof e.layers[i])throw TypeError(".com.mapbox.pb.Tile.layers: object expected");t.layers[i]=c.com.mapbox.pb.Tile.Layer.fromObject(e.layers[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.layers=[]),e.layers&&e.layers.length){i.layers=[];for(var n=0;n<e.layers.length;++n)i.layers[n]=c.com.mapbox.pb.Tile.Layer.toObject(e.layers[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.GeomType=(t={},(i=Object.create(t))[t[0]="UNKNOWN"]=0,i[t[1]="POINT"]=1,i[t[2]="LINESTRING"]=2,i[t[3]="POLYGON"]=3,i),e.Value=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.stringValue="",e.prototype.floatValue=0,e.prototype.doubleValue=0,e.prototype.intValue=l.Long?l.Long.fromBits(0,0,!1):0,e.prototype.uintValue=l.Long?l.Long.fromBits(0,0,!0):0,e.prototype.sintValue=l.Long?l.Long.fromBits(0,0,!1):0,e.prototype.boolValue=!1,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile.Value;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.stringValue=e.string();break;case 2:n.floatValue=e.float();break;case 3:n.doubleValue=e.double();break;case 4:n.intValue=e.int64();break;case 5:n.uintValue=e.uint64();break;case 6:n.sintValue=e.sint64();break;case 7:n.boolValue=e.bool();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Value)return e;var t=new c.com.mapbox.pb.Tile.Value;return null!=e.stringValue&&(t.stringValue=String(e.stringValue)),null!=e.floatValue&&(t.floatValue=Number(e.floatValue)),null!=e.doubleValue&&(t.doubleValue=Number(e.doubleValue)),null!=e.intValue&&(l.Long?(t.intValue=l.Long.fromValue(e.intValue)).unsigned=!1:"string"==typeof e.intValue?t.intValue=parseInt(e.intValue,10):"number"==typeof e.intValue?t.intValue=e.intValue:"object"==typeof e.intValue&&(t.intValue=new l.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber())),null!=e.uintValue&&(l.Long?(t.uintValue=l.Long.fromValue(e.uintValue)).unsigned=!0:"string"==typeof e.uintValue?t.uintValue=parseInt(e.uintValue,10):"number"==typeof e.uintValue?t.uintValue=e.uintValue:"object"==typeof e.uintValue&&(t.uintValue=new l.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),null!=e.sintValue&&(l.Long?(t.sintValue=l.Long.fromValue(e.sintValue)).unsigned=!1:"string"==typeof e.sintValue?t.sintValue=parseInt(e.sintValue,10):"number"==typeof e.sintValue?t.sintValue=e.sintValue:"object"==typeof e.sintValue&&(t.sintValue=new l.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber())),null!=e.boolValue&&(t.boolValue=Boolean(e.boolValue)),t},e.toObject=function(e,t){t||(t={});var i={};if(t.defaults){if(i.stringValue="",i.floatValue=0,i.doubleValue=0,l.Long){var n=new l.Long(0,0,!1);i.intValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.intValue=t.longs===String?"0":0;l.Long?(n=new l.Long(0,0,!0),i.uintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):i.uintValue=t.longs===String?"0":0,l.Long?(n=new l.Long(0,0,!1),i.sintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):i.sintValue=t.longs===String?"0":0,i.boolValue=!1}return null!=e.stringValue&&e.hasOwnProperty("stringValue")&&(i.stringValue=e.stringValue),null!=e.floatValue&&e.hasOwnProperty("floatValue")&&(i.floatValue=t.json&&!isFinite(e.floatValue)?String(e.floatValue):e.floatValue),null!=e.doubleValue&&e.hasOwnProperty("doubleValue")&&(i.doubleValue=t.json&&!isFinite(e.doubleValue)?String(e.doubleValue):e.doubleValue),null!=e.intValue&&e.hasOwnProperty("intValue")&&("number"==typeof e.intValue?i.intValue=t.longs===String?String(e.intValue):e.intValue:i.intValue=t.longs===String?l.Long.prototype.toString.call(e.intValue):t.longs===Number?new l.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber():e.intValue),null!=e.uintValue&&e.hasOwnProperty("uintValue")&&("number"==typeof e.uintValue?i.uintValue=t.longs===String?String(e.uintValue):e.uintValue:i.uintValue=t.longs===String?l.Long.prototype.toString.call(e.uintValue):t.longs===Number?new l.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),null!=e.sintValue&&e.hasOwnProperty("sintValue")&&("number"==typeof e.sintValue?i.sintValue=t.longs===String?String(e.sintValue):e.sintValue:i.sintValue=t.longs===String?l.Long.prototype.toString.call(e.sintValue):t.longs===Number?new l.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber():e.sintValue),null!=e.boolValue&&e.hasOwnProperty("boolValue")&&(i.boolValue=e.boolValue),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.Feature=function(){function e(e){if(this.tags=[],this.geometry=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.id=l.Long?l.Long.fromBits(0,0,!0):0,e.prototype.tags=l.emptyArray,e.prototype.type=0,e.prototype.geometry=l.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile.Feature;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.id=e.uint64();break;case 2:if(n.tags&&n.tags.length||(n.tags=[]),2==(7&r))for(var s=e.uint32()+e.pos;e.pos<s;)n.tags.push(e.uint32());else n.tags.push(e.uint32());break;case 3:n.type=e.int32();break;case 4:if(n.geometry&&n.geometry.length||(n.geometry=[]),2==(7&r))for(s=e.uint32()+e.pos;e.pos<s;)n.geometry.push(e.uint32());else n.geometry.push(e.uint32());break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Feature)return e;var t=new c.com.mapbox.pb.Tile.Feature;if(null!=e.id&&(l.Long?(t.id=l.Long.fromValue(e.id)).unsigned=!0:"string"==typeof e.id?t.id=parseInt(e.id,10):"number"==typeof e.id?t.id=e.id:"object"==typeof e.id&&(t.id=new l.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0))),e.tags){if(!Array.isArray(e.tags))throw TypeError(".com.mapbox.pb.Tile.Feature.tags: array expected");t.tags=[];for(var i=0;i<e.tags.length;++i)t.tags[i]=e.tags[i]>>>0}switch(e.type){case"UNKNOWN":case 0:t.type=0;break;case"POINT":case 1:t.type=1;break;case"LINESTRING":case 2:t.type=2;break;case"POLYGON":case 3:t.type=3}if(e.geometry){if(!Array.isArray(e.geometry))throw TypeError(".com.mapbox.pb.Tile.Feature.geometry: array expected");for(t.geometry=[],i=0;i<e.geometry.length;++i)t.geometry[i]=e.geometry[i]>>>0}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.tags=[],i.geometry=[]),t.defaults){if(l.Long){var n=new l.Long(0,0,!0);i.id=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.id=t.longs===String?"0":0;i.type=t.enums===String?"UNKNOWN":0}if(null!=e.id&&e.hasOwnProperty("id")&&("number"==typeof e.id?i.id=t.longs===String?String(e.id):e.id:i.id=t.longs===String?l.Long.prototype.toString.call(e.id):t.longs===Number?new l.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0):e.id),e.tags&&e.tags.length){i.tags=[];for(var r=0;r<e.tags.length;++r)i.tags[r]=e.tags[r]}if(null!=e.type&&e.hasOwnProperty("type")&&(i.type=t.enums===String?c.com.mapbox.pb.Tile.GeomType[e.type]:e.type),e.geometry&&e.geometry.length)for(i.geometry=[],r=0;r<e.geometry.length;++r)i.geometry[r]=e.geometry[r];return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.Layer=function(){function e(e){if(this.features=[],this.keys=[],this.values=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.version=1,e.prototype.name="",e.prototype.features=l.emptyArray,e.prototype.keys=l.emptyArray,e.prototype.values=l.emptyArray,e.prototype.extent=4096,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile.Layer;e.pos<i;){var r=e.uint32();switch(r>>>3){case 15:n.version=e.uint32();break;case 1:n.name=e.string();break;case 2:n.features&&n.features.length||(n.features=[]),n.features.push(c.com.mapbox.pb.Tile.Feature.decode(e,e.uint32()));break;case 3:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(e.string());break;case 4:n.values&&n.values.length||(n.values=[]),n.values.push(c.com.mapbox.pb.Tile.Value.decode(e,e.uint32()));break;case 5:n.extent=e.uint32();break;default:e.skipType(7&r)}}if(!n.hasOwnProperty("version"))throw l.ProtocolError("missing required 'version'",{instance:n});if(!n.hasOwnProperty("name"))throw l.ProtocolError("missing required 'name'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Layer)return e;var t=new c.com.mapbox.pb.Tile.Layer;if(null!=e.version&&(t.version=e.version>>>0),null!=e.name&&(t.name=String(e.name)),e.features){if(!Array.isArray(e.features))throw TypeError(".com.mapbox.pb.Tile.Layer.features: array expected");t.features=[];for(var i=0;i<e.features.length;++i){if("object"!=typeof e.features[i])throw TypeError(".com.mapbox.pb.Tile.Layer.features: object expected");t.features[i]=c.com.mapbox.pb.Tile.Feature.fromObject(e.features[i])}}if(e.keys){if(!Array.isArray(e.keys))throw TypeError(".com.mapbox.pb.Tile.Layer.keys: array expected");for(t.keys=[],i=0;i<e.keys.length;++i)t.keys[i]=String(e.keys[i])}if(e.values){if(!Array.isArray(e.values))throw TypeError(".com.mapbox.pb.Tile.Layer.values: array expected");for(t.values=[],i=0;i<e.values.length;++i){if("object"!=typeof e.values[i])throw TypeError(".com.mapbox.pb.Tile.Layer.values: object expected");t.values[i]=c.com.mapbox.pb.Tile.Value.fromObject(e.values[i])}}return null!=e.extent&&(t.extent=e.extent>>>0),t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.features=[],i.keys=[],i.values=[]),t.defaults&&(i.name="",i.extent=4096,i.version=1),null!=e.name&&e.hasOwnProperty("name")&&(i.name=e.name),e.features&&e.features.length){i.features=[];for(var n=0;n<e.features.length;++n)i.features[n]=c.com.mapbox.pb.Tile.Feature.toObject(e.features[n],t)}if(e.keys&&e.keys.length)for(i.keys=[],n=0;n<e.keys.length;++n)i.keys[n]=e.keys[n];if(e.values&&e.values.length)for(i.values=[],n=0;n<e.values.length;++n)i.values[n]=c.com.mapbox.pb.Tile.Value.toObject(e.values[n],t);return null!=e.extent&&e.hasOwnProperty("extent")&&(i.extent=e.extent),null!=e.version&&e.hasOwnProperty("version")&&(i.version=e.version),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e}(),n),r),s),e.exports=c},function(e,t,i){"use strict";e.exports=u;var n,r=i(19),s=r.LongBits,o=r.base64,a=r.utf8;function l(e,t,i){this.fn=e,this.len=t,this.next=void 0,this.val=i}function c(){}function h(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function u(){this.len=0,this.head=new l(c,0,0),this.tail=this.head,this.states=null}var d=function(){return r.Buffer?function(){return(u.create=function(){return new n})()}:function(){return new u}};function m(e,t,i){t[i]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function f(e,t,i){for(;e.hi;)t[i++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[i++]=127&e.lo|128,e.lo=e.lo>>>7;t[i++]=e.lo}function g(e,t,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24}u.create=d(),u.alloc=function(e){return new r.Array(e)},r.Array!==Array&&(u.alloc=r.pool(u.alloc,r.Array.prototype.subarray)),u.prototype._push=function(e,t,i){return this.tail=this.tail.next=new l(e,t,i),this.len+=t,this},p.prototype=Object.create(l.prototype),p.prototype.fn=function(e,t,i){for(;e>127;)t[i++]=127&e|128,e>>>=7;t[i]=e},u.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},u.prototype.int32=function(e){return e<0?this._push(f,10,s.fromNumber(e)):this.uint32(e)},u.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},u.prototype.uint64=function(e){var t=s.from(e);return this._push(f,t.length(),t)},u.prototype.int64=u.prototype.uint64,u.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(f,t.length(),t)},u.prototype.bool=function(e){return this._push(m,1,e?1:0)},u.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},u.prototype.sfixed32=u.prototype.fixed32,u.prototype.fixed64=function(e){var t=s.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},u.prototype.sfixed64=u.prototype.fixed64,u.prototype.float=function(e){return this._push(r.float.writeFloatLE,4,e)},u.prototype.double=function(e){return this._push(r.float.writeDoubleLE,8,e)};var v=r.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var n=0;n<e.length;++n)t[i+n]=e[n]};u.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(m,1,0);if(r.isString(e)){var i=u.alloc(t=o.length(e));o.decode(e,i,0),e=i}return this.uint32(t)._push(v,t,e)},u.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(m,1,0)},u.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new l(c,0,0),this.len=0,this},u.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(c,0,0),this.len=0),this},u.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this},u.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t},u._configure=function(e){n=e,u.create=d(),n._configure()}},function(e,t,i){"use strict";e.exports=l;var n,r=i(19),s=r.LongBits,o=r.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var c,h="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},u=function(){return r.Buffer?function(e){return(l.create=function(e){return r.Buffer.isBuffer(e)?new n(e):h(e)})(e)}:h};function d(){var e=new s(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function m(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new s(m(this.buf,this.pos+=4),m(this.buf,this.pos+=4))}l.create=u(),l.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,l.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return c;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return c}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return m(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|m(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,i):t===i?new this.buf.constructor(0):this._slice.call(this.buf,t,i)},l.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=u(),n._configure();var t=r.Long?"toLong":"toNumber";r.merge(l.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectStyleBuilder=void 0;const n=i(3);class r{constructor(e){this.styleSetName=e,this.m_withVolatile=!1,this.m_withPoi=!1,this.m_withLine=!1,this.m_shouldClipLines=!1,this.m_withOverlay=!1,this.m_withPolygon=!1,this.m_withPolygonOutline=!0,this.m_withExtrudedPolygon=!1,this.m_withPolygonAlwaysPickable=!1}withVolatile(){return this.m_withVolatile=!0,this}withPoi(){return this.m_withPoi=!0,this}withLine(e=!1){return this.m_withLine=!0,this.m_shouldClipLines=e,this}withOverlay(){return this.m_withOverlay=!0,this}withPolygon(e=!1,t=!1,i=!1){return this.m_withPolygon=!0,this.m_withPolygonOutline=e,this.m_withExtrudedPolygon=t,this.m_withPolygonAlwaysPickable=i,this}build(){const e=[],t={styleSet:this.styleSetName,minZoomLevel:["case",!0,["get","minZoom"],["zoom"]],maxZoomLevel:["get","maxZoom"]};if(this.m_withPoi){const i=Object.assign(Object.assign({},t),{when:["==",["geometry-type"],"Point"],technique:"labeled-icon",priority:1e3,imageTexture:["get","imageTexture"],iconFadeTime:0,iconReserveSpace:!1,iconMayOverlap:!0,textIsOptional:!0,textReserveSpace:!1,screenWidth:["get","screenWidth"],screenHeight:["get","screenHeight"],iconXOffset:["get","iconXOffset"],iconYOffset:["get","iconYOffset"]});e.push(i)}if(this.m_withLine){const i=Object.assign(Object.assign({},t),{when:["all",["==",["geometry-type"],"LineString"],["!has","dashSize"],["!",["get","volatile"]]],renderOrder:["get","zOrder"],technique:"solid-line",caps:["get","lineCap"],color:["get","strokeColor"],lineWidth:["get","lineWidth"],clipping:this.m_shouldClipLines}),n=Object.assign(Object.assign({},i),{when:["all",["==",["geometry-type"],"LineString"],["has","dashes"]],technique:"dashed-line",clipping:this.m_shouldClipLines,dashes:["get","dashes"],dashSize:["get","dashSize"],gapSize:["get","gapSize"]});if(e.push(i,n),this.m_withVolatile){const t=Object.assign(Object.assign({},i),{when:["all",["==",["geometry-type"],"LineString"],["!has","dashSize"],["get","volatile"]],color:["get",["concat","strokeColor:",["get","id"]],["dynamic-properties"]],lineWidth:["concat",["get",["concat","lineWidth:",["get","id"]],["dynamic-properties"]],"px"]});e.push(t)}}const i=["==",["get","height"],0];if(this.m_withOverlay){const s=Object.assign(Object.assign({},t),{when:["all",["==",["geometry-type"],"Polygon"],i,["has","map"],["!",["get","volatile"]]],renderOrder:["+",["get","zOrder"]],technique:"fill",map:["get","map"],mapProperties:{flipY:!0,minFilter:"linear"},textureCoordinateType:n.TextureCoordinateType.FeatureSpace,color:16777215,opacity:["get","opacity"],transparent:!0});if(e.push(s),this.m_withVolatile){const t=Object.assign(Object.assign({},s),{when:["all",["==",["geometry-type"],"Polygon"],i,["has","map"],["get","volatile"]],map:["get",["concat",r.DYNAMIC_OVERLAY_PROP_PREFIX,["get","id"]],["dynamic-properties"]]});e.push(t)}}if(this.m_withPolygon){const r=Object.assign(Object.assign({},t),{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["!",["get","volatile"]]],renderOrder:["+",["get","zOrder"]],technique:"fill",color:["get","fillColor"],lineWidth:0});if(this.m_withPolygonAlwaysPickable&&(r.transient=n.Pickability.all),e.push(r),this.m_withPolygonOutline){const r=Object.assign(Object.assign({},t),{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["!has","dashes"],["!",["get","volatile"]]],renderOrder:["+",["get","zOrder"],.5],technique:"solid-line",color:["get","strokeColor"],lineWidth:["get","lineWidth"]}),s=Object.assign(Object.assign({},r),{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["has","dashes"]],technique:"dashed-line",clipping:!0,dashes:["get","dashes"],dashSize:["get","dashSize"],gapSize:["get","gapSize"]});if(this.m_withPolygonAlwaysPickable&&(r.transient=n.Pickability.all,s.transient=n.Pickability.all),e.push(r,s),this.m_withVolatile){const t=Object.assign(Object.assign({},r),{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["!has","dashes"],["get","volatile"]],color:["get",["concat","strokeColor:",["get","id"]],["dynamic-properties"]],lineWidth:["concat",["get",["concat","lineWidth:",["get","id"]],["dynamic-properties"]],"px"]});e.push(t)}}if(this.m_withExtrudedPolygon){const i=Object.assign(Object.assign({},t),{when:["all",["==",["geometry-type"],"Polygon"],[">",["get","height"],0]],renderOrder:["get","zOrder"],technique:"extruded-polygon",color:["get","fillColor"],lineColor:["get","strokeColor"],lineWidth:["get","lineWidth"],constantHeight:["get","constantHeight"]});this.m_withPolygonAlwaysPickable&&(i.transient=n.Pickability.all),e.push(i)}if(this.m_withVolatile){const t=Object.assign(Object.assign({},r),{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["get","volatile"]],color:["get",["concat","fillColor:",["get","id"]],["dynamic-properties"]]});e.push(t)}}return{styles:e}}}t.ObjectStyleBuilder=r,r.DYNAMIC_OVERLAY_PROP_PREFIX="overlay-image"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Style=void 0;const n=i(36);class r extends H.map.render.Style{constructor(e,t){super(e,t),this.m_config=e,this.m_baseUrl=t,"string"!=typeof this.m_config?this.setConfig(Object.assign({},e)):this.m_config=new URL(this.m_config,location.href).href,void 0===t&&("string"==typeof this.m_config?this.m_baseUrl=this.m_config:this.m_baseUrl=location.href),this.setState(H.map.render.Style.State.INIT)}getBaseUrl(){return this.m_baseUrl}load(){if("string"==typeof this.m_config){const e=this.m_baseUrl,t={uriResolver:{resolveUri:t=>new URL(t,e).toString()}};this.setState(H.map.render.Style.State.LOADING),n.ThemeLoader.load(this.m_config,t).then(e=>{this.setConfig(e),this.setState(H.map.render.Style.State.READY),this.dispatchChangeEvent()}).catch(e=>{this.setState(H.map.render.Style.State.ERROR),this.dispatchError(e)})}else this.setState(H.map.render.Style.State.READY),this.dispatchChangeEvent()}dispatchChangeEvent(){this.dispatchEvent(new H.util.Event("change",this))}}t.Style=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultTheme=t.DARK_THEME=t.DEFAULT_THEME=void 0;const n=i(393),r={color:"#FFFFFF",startRatio:.7};t.DEFAULT_THEME={clearColor:"#FFFFFF",fog:r,sky:{type:"gradient",topColor:"#347BC0",bottomColor:"#EDF2F9",groundColor:"#FFFFFF"},lights:n.lights},t.DARK_THEME={clearColor:"#010608",fog:r,sky:{type:"gradient",topColor:"#010608",bottomColor:"#EDF2F9",groundColor:"#010608"},lights:n.lights},t.getDefaultTheme=(e=!1)=>e?t.DARK_THEME:t.DEFAULT_THEME},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(185),r=i(182),s=i(14);self.H.map.render.harp={RenderEngine:n.RenderEngine,ProjectionType:s.ProjectionType,Style:r.Style}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderEngine=t.RenderEngineState=void 0;const n=i(0),r=i(186),s=i(54),o=i(2),a=i(15),l=i(49),c=i(330),h=i(164),u=i(331),d=i(58),m=i(394),p=i(9),f=i(59),g=i(400),v=i(401),y=i(89),_=i(183),x=i(402),w=i(5),b=d.LoggerManager.instance.create("harp::RenderEngine");var M;!function(e){e[e.Suspended=0]="Suspended",e[e.Busy=1]="Busy",e[e.Shutdown=2]="Shutdown"}(M=t.RenderEngineState||(t.RenderEngineState={}));class T extends H.util.EventTarget{constructor(e,t,i,n){super(),this.m_syncedSize=null,this.m_lookAtAnimation=void 0,this.m_animation=void 0,this.m_animationDuration=.3,this.m_lastCallTime=0,this.m_state=M.Suspended,this.m_rendered=!1,this.m_suspendTimeout=5e3,this.m_renderCallbacks=void 0,this.m_kinetics=void 0,this.m_control=new r.ControlUtils,this.type=H.Map.EngineType.HARP,this.m_viewModel=t,this.m_viewPort=e,this.m_dataModel=i,t.startControl=this.startControl.bind(this),t.control=this.control.bind(this),t.endControl=this.endControl.bind(this),e.startInteraction=this.startInteraction.bind(this),e.interaction=this.interaction.bind(this),e.endInteraction=this.endInteraction.bind(this),this.m_surface=new v.default(e.element,e.width,e.height,n.pixelRatio),this.m_layersContainer=e.element.ownerDocument.createElement("div"),this.m_layersContainer.style.position="absolute",this.m_layersContainer.style.width=this.m_layersContainer.style.height="100%",this.m_layersContainer.style.zIndex="1",e.element.appendChild(this.m_layersContainer);const s=new Blob([H.__harp_worker_decoders__],{type:"application/javascript"}),l=URL.createObjectURL(s);this.mapView=new a.MapView({decoderUrl:l,synchronousRendering:!0,canvas:this.m_surface.getElement(),pixelRatio:n.pixelRatio,enableMixedLod:!0,lodMinTilePixelSize:512,enableNativeWebglAntialias:!0,projection:n.projectionType===o.ProjectionType.Spherical?o.sphereProjection:o.mercatorProjection,theme:_.getDefaultTheme(!1),enablePickTechnique:!0}),this.m_handleRequestAnimationFrame=this.renderLoop.bind(this),t.addEventListener("update",this.onViewUpdate,void 0,this),e.addEventListener("update",this.onResize,void 0,this),this.m_lookAtManipulator=new m.LookAtManipulator(this.mapView,this.m_viewPort),this.mapView.addEventListener(a.MapViewEventNames.FrameComplete,()=>{this.m_rendered=!0}),this.mapView.addEventListener(a.MapViewEventNames.Update,()=>{this.m_rendered=!1,this.relaunch()}),this.mapView.addEventListener(a.MapViewEventNames.ContextLost,()=>{this.m_state=M.Suspended,cancelAnimationFrame(this.m_animationFrameHandle)}),this.m_layers=new u.Layers(this.mapView,i,this.m_lookAtManipulator,{createDOMSurface:()=>new H.map.render.dom.Surface(this.m_layersContainer,e.width,e.height,n.pixelRatio)}),this.m_control.addEventListener(r.AnimationUpdateEvent,e=>{var t;null===(t=this.m_animation)||void 0===t||t.stop(!0),e.changeRate.hasValue()&&(this.m_animation=new c.Animation(this.mapView,1/0,this.applyControl.bind(this)),this.m_animation.start())}),this.m_interaction=new H.map.render.InteractionUtils,this.relaunch();const h=new x.MapViewPickHandlerAdapter(this.mapView.pickHandler,this.geoToScreen.bind(this));this.m_pickingHandler=new g.PickingHandlerComposite(()=>{const e=[];return this.m_layers.forEachRenderer(t=>{t instanceof H.map.render.dom.MarkerRenderer&&e.push({getObjectsAt:(e,i,r)=>t.getObjectsAt(e*n.pixelRatio,i*n.pixelRatio,r)})}),e.push(h),e}),b.log("Ready")}setOnRenderCallbacks(e,t){this.m_renderCallbacks={start:e,end:t}}adjustZoomConstraints(){this.m_layers.adjustZoomConstraints()}onViewUpdate(e){const t=e.newValue,i=e.modifiers,n={};this.m_lookAtManipulator.clampValues(t),i&H.map.ChangeEvent.Type.POSITION&&(n.target=t.position),i&H.map.ChangeEvent.Type.ZOOM&&(n.zoomLevel=t.zoom),i&H.map.ChangeEvent.Type.HEADING&&(n.heading=m.adjustHeading(t.heading)),i&H.map.ChangeEvent.Type.TILT&&(n.tilt=t.tilt),i&H.map.ChangeEvent.Type.BOUNDS&&(i&H.map.ChangeEvent.Type.ZOOM&&i&H.map.ChangeEvent.Type.POSITION||(n.bounds=t.bounds instanceof H.geo.Polygon?l.hToHarpGeoPolygon(t.bounds):l.getHarpBoundingBox(t.bounds))),this.stopAnimations(),e.animate?(void 0!==n.bounds?this.m_lookAtManipulator.lookAt(n):this.setLookAtWithAnimation(n),this.relaunch()):this.m_lookAtManipulator.lookAt(n)}setLookAtWithAnimation(e,t){const i=new s.ControlPoint(Object.assign(Object.assign({},h.CameraAnimationBuilder.getLookAtFromView(this.mapView)),{timestamp:0}));let r=i.target;void 0!==e.target?r=o.GeoCoordinates.fromObject(e.target):e.bounds instanceof o.GeoBox?r=e.bounds.center:e.bounds instanceof o.GeoPolygon&&(r=e.bounds.getCentroid());const a=new s.ControlPoint({target:r,distance:void 0!==e.zoomLevel?p.MapViewUtils.calculateDistanceFromZoomLevel({focalLength:this.mapView.focalLength},e.zoomLevel):this.mapView.targetDistance,timestamp:this.m_animationDuration,tilt:void 0!==e.tilt?e.tilt:i.tilt,heading:void 0!==e.heading?e.heading:i.heading});let l=[i,a];void 0===e.target&&void 0===e.bounds||(l=h.CameraAnimationBuilder.createBowFlyToOptions(this.mapView,i,a,null,3*this.m_animationDuration).controlPoints),this.m_lookAtAnimation=new s.CameraKeyTrackAnimation(this.mapView,{controlPoints:l,interpolation:n.InterpolateLinear}),this.m_lookAtAnimation.start(0,t)}onResize(){const{width:e,height:t}=this.m_viewPort;this.m_surface.setSize(e,t),this.mapView.resize(e,t),this.m_syncedSize={w:e,h:t},this.m_layers.forEachRenderer(i=>{i.getSurface().setSize(e,t)}),this.relaunch()}synchronizeViewPort(){null!==this.m_syncedSize&&(this.m_viewPort.synchronize(this.m_syncedSize),this.m_syncedSize=null)}synchronizeLookAt(){var e;this.m_viewModel.synchronize(this.m_lookAtManipulator.getLookAtData(null===(e=this.m_lookAtAnimation)||void 0===e?void 0:e.isRunning(),!0))}adjustLongitudeToVisibleWorld(e){const t=this.mapView.target.longitude;if(Math.abs(t-e)<o.MAX_LONGITUDE)return e;const i=Math.sign(t),n=Math.trunc(t/(2*o.MAX_LONGITUDE)+i/2);return e+2*o.MAX_LONGITUDE*n}inViewport(e){return e.x>=0&&e.y>=0&&e.x<=this.m_viewPort.width&&e.y<=this.m_viewPort.height}setProjection(e){this.mapView.projection.type!==e&&(this.mapView.projection=e===o.ProjectionType.Spherical?o.sphereProjection:o.mercatorProjection)}getProjection(){return this.mapView.projection.type}get animationDuration(){return this.m_animationDuration}set animationDuration(e){e===+e&&e>0&&(this.m_animationDuration=e)}resetAnimationDefaults(){this.m_animationDuration=.3}dispose(){this.m_state=M.Shutdown,cancelAnimationFrame(this.m_animationFrameHandle),this.mapView.dispose(),this.stopAnimations(),this.m_viewModel.removeEventListener("update",this.onViewUpdate,void 0,this),this.m_viewPort.removeEventListener("update",this.onResize,void 0,this),this.m_viewModel.startControl=H.map.ViewModel.prototype.startControl,this.m_viewModel.control=H.map.ViewModel.prototype.control,this.m_viewModel.endControl=H.map.ViewModel.prototype.endControl,this.m_viewPort.startInteraction=H.map.ViewPort.prototype.startInteraction,this.m_viewPort.interaction=H.map.ViewPort.prototype.interaction,this.m_viewPort.endInteraction=H.map.ViewPort.prototype.endInteraction,this.m_layers.dispose(),this.m_viewPort.element.removeChild(this.m_layersContainer)}updateTimeStamp(){this.m_lastCallTime=f.PerformanceTimer.now()}relaunch(){this.updateTimeStamp(),this.m_state===M.Suspended&&this.startRenderLoop()}get continueRenderLoop(){return this.mapView.animating||f.PerformanceTimer.now()-this.m_lastCallTime<this.m_suspendTimeout&&!this.m_rendered}startRenderLoop(){this.continueRenderLoop?(this.m_state=M.Busy,this.m_animationFrameHandle=requestAnimationFrame(this.m_handleRequestAnimationFrame)):(this.m_state=M.Suspended,this.m_animationFrameHandle=void 0,this.m_rendered&&(this.m_rendered=!1,setTimeout(()=>{!this.mapView.isDynamicFrame&&this.mapView.visibleTileSet.allVisibleTilesLoaded?this.dispatchRenderEvent():this.relaunch()})))}renderLoop(e){void 0!==this.m_renderCallbacks&&this.m_renderCallbacks.start(),this.mapView.renderSync(e),this.m_suspendTimeout=5e3,this.renderLayers()||(this.m_rendered=!1),this.synchronizeLookAt(),this.synchronizeViewPort(),void 0!==this.m_renderCallbacks&&this.m_renderCallbacks.end(),this.startRenderLoop()}renderLayers(){var e;let t=this.m_lookAtManipulator.getLookAtData(null===(e=this.m_lookAtAnimation)||void 0===e?void 0:e.isRunning()).bounds.getBoundingBox();this.mapView.projection.type===o.ProjectionType.Planar&&t.getHeight()>=2*o.MercatorConstants.MAXIMUM_LATITUDE&&(t=new H.geo.Rect(90,t.getLeft(),-90,t.getRight()));const i=this.mapView.zoomLevel;this.m_dataModel.asArray().forEach(e=>{var n;null===(n=e.getProvider())||void 0===n||n.preprocessData(t,i)});const n=this.m_viewPort.center,r=new H.math.Point(0,0);let s=!0;return this.m_layers.forEachRenderer(e=>{const o=e.render(t,n,void 0,i,!1,r,e=>this.geoToScreen(e));o===H.map.render.RenderState.ACTIVE&&(this.m_suspendTimeout=1/0),o===H.map.render.RenderState.PENDING&&(s=!1)}),s}getState(){return this.m_state}stopAnimations(){var e,t;null===(e=this.m_lookAtAnimation)||void 0===e||e.stop(),this.m_control.isRunning()&&this.endControl(!0),this.m_interaction.isRunning()&&this.endInteraction(!0),null===(t=this.m_animation)||void 0===t||t.stop(!0)}applyControl(e,t,i,n){const r=this.m_control.getChangeRate(),s=r.moveZ*i,o=r.rotateX*i,a=r.rotateY*i,l={x:r.moveX*i,y:r.moveY*i};this.m_lookAtManipulator.applyLookAtDelta(l,this.getControlTargetNDC(),s,o,a)}dispatchRenderEvent(e){this.dispatchEvent(new H.util.Event("render",null!=e?e:this))}screenToGeo(e,t){const{latitude:i,longitude:n,altitude:r}=this.mapView.getGeoCoordinatesAt(e,t,!0);return new H.geo.Point(i,n,r)}geoToScreen(e){let t;if(this.getProjection()===o.ProjectionType.Planar){const{lat:i,lng:n,alt:r}=e,s=this.adjustLongitudeToVisibleWorld(n),o=this.mapView.getScreenPosition([s,i,r]);t=o,this.inViewport(o)||(t=this.mapView.getScreenPosition([s+360,i,r]),this.inViewport(t)||(t=this.mapView.getScreenPosition([s-360,i,r])),this.inViewport(t)||(t=o))}else t=this.mapView.getScreenPosition(e);return void 0!==t?{x:Math.round(t.x),y:Math.round(t.y)}:null}screenToLookAtData(e,t){const i=this.m_viewModel.getLookAtData();return i.position=this.screenToGeo(e,t),i}getObjectsAt(e,t,i,n){this.m_pickingHandler.getObjectsAt(e,t,i).then(n)}async capture(e,t,i,n){return await new Promise((r,s)=>{const o=()=>{this.mapView.removeEventListener(a.MapViewEventNames.FrameComplete,o);const s=this.m_viewPort.element.ownerDocument.createElement("img");s.onload=()=>{const o=this.m_viewPort.element.ownerDocument.createElement("canvas"),a=this.mapView.pixelRatio,l=o.width=(i-e)*a,c=o.height=(n-t)*a;o.getContext("2d").drawImage(s,e,t,l,c,0,0,l,c),r(o)},s.src=this.mapView.canvas.toDataURL()};this.mapView.addEventListener(a.MapViewEventNames.FrameComplete,o),this.mapView.update()})}setPointer(e,t){}zoomAt(e,t,i){const n=this.mapView.getNormalizedScreenCoordinates(t,i);this.m_lookAtManipulator.zoomAt(e,n),this.relaunch()}startControl(e,t,i){this.stopAnimations(),this.m_kinetics=e,this.m_control.start(t,i)}control(e,t,i,n,r,s){for(let e,t=0;t<arguments.length;t++)if(e=arguments[t],Number.isNaN(e))throw new Error("Invalid argument "+e);this.m_control.isRunning()&&this.m_control.set(e,t,i,n,r,s)}endControl(e,t){var i,n;if(!this.m_control.isRunning())return;const r=t instanceof Function,s=this.getControlTargetNDC();if(null===(i=this.m_animation)||void 0===i||i.stop(),void 0===this.m_kinetics||e||r){if(r){const e=this.m_lookAtManipulator.getLookAtData();t(e);const i=this.mapView.zoomLevel,n=this.m_lookAtManipulator.clampZoom(e.zoom)-i;n&&(this.m_animation=new c.Animation(this.mapView,Math.abs(n/this.m_control.getChangeRate().moveZ)*Math.PI,e=>{const t=(r=e,--r*r*r+1);var r;this.m_lookAtManipulator.zoomAt(i+n*t,s)}).start())}}else{const e=null!==(n=this.m_kinetics.power)&&void 0!==n?n:1,t=this.m_control.getChangeRate(),i=this.m_kinetics.duration>0?this.m_kinetics.duration:1,{zoom:r,tilt:o,heading:a}=this.m_lookAtManipulator.getLookAtData();let l=0,h=0;this.m_animation=new c.Animation(this.mapView,i,n=>{const c=this.m_kinetics.ease(n)*i*e,u=t.moveX*c,d=t.moveY*c,p=t.moveZ*c,f=t.rotateX*c,g=t.rotateY*c;this.m_lookAtManipulator.setAngles(o+f,m.adjustHeading(a+g)),this.m_lookAtManipulator.zoomAt(r+p,s),this.m_lookAtManipulator.moveLookAtByOffset(u-l,d-h),l=u,h=d}).start()}this.m_control.reset()}startInteraction(e,t){const i=!!(void 0!==t||e&(H.map.render.RenderEngine.InteractionModifiers.HEADING|H.map.render.RenderEngine.InteractionModifiers.TILT));this.stopAnimations(),this.m_kinetics=t,this.m_interaction.start(e,i)}interaction(e,t,i,n,r){if(!this.m_interaction.isRunning())return;const s=this.m_interaction,o=s.store(e,t,i,n,r);if(!this.m_interaction.isGestureDetected())return;let a=!1;const l=this.m_interaction.getMoveVector(),c=o&&s.getBifocalCenter(),h=H.map.render.RenderEngine.InteractionModifiers;let u={x:0,y:0},d=w.CameraUtils.getPrincipalPoint(this.mapView.camera),m=0,p=0,f=0;s.isModifierEnabled(h.TILT)&&(p=l.y/this.m_viewPort.height*2*-180,a=!0),s.isModifierEnabled(h.HEADING)&&(o?(f=this.m_interaction.getBifocalRotation(),d=this.mapView.getNormalizedScreenCoordinates(c.x,c.y),a=!0):l.x&&(f=l.x/this.m_viewPort.width*360,a=!0));const g=this.m_interaction.getBifocalScaling();if(o&&1!==g&&s.isModifierEnabled(h.ZOOM)&&(m=Math.log(Math.pow(2,this.mapView.zoomLevel)*g)/Math.LN2-this.mapView.zoomLevel,d=this.mapView.getNormalizedScreenCoordinates(c.x,c.y),a=!0),s.isModifierEnabled(h.COORD)){l.x*l.x+l.y*l.y>0&&(u={x:-l.x,y:-l.y},a=!0)}a&&(this.m_lookAtManipulator.applyLookAtDelta(u,d,m,p,f),this.relaunch())}endInteraction(e){var t;if(this.m_interaction.isRunning()&&!e&&void 0!==this.m_kinetics){const e=(null!==(t=this.m_kinetics.power)&&void 0!==t?t:1)*this.m_interaction.getSpeed();if(e>0){const t=this.m_kinetics.duration>0?this.m_kinetics.duration:1,i=this.m_interaction.getDirection(),n=this.m_kinetics.ease;this.m_animation=new c.Animation(this.mapView,t,t=>{const r=e-e*n(t);this.m_lookAtManipulator.moveLookAtByOffset(-i.x*r,-i.y*r)}).start()}}this.m_kinetics=void 0,this.m_interaction.clear()}getCapabilities(){return y.default}getControlTargetNDC(){var e,t;return void 0!==(null===(e=this.m_control)||void 0===e?void 0:e.atX)&&void 0!==(null===(t=this.m_control)||void 0===t?void 0:t.atY)?this.mapView.getNormalizedScreenCoordinates(this.m_control.atX,this.m_control.atY):w.CameraUtils.getPrincipalPoint(this.mapView.camera)}}t.RenderEngine=T},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeRate=t.ControlUtils=t.AnimationUpdateEvent=void 0,t.AnimationUpdateEvent="animation-update";class n extends H.util.EventTarget{constructor(){super(),this.atX=void 0,this.atY=void 0,this.m_isRunning=!1,this.reset()}start(e,t){this.m_isRunning&&this.reset(),e===+e&&t===+t&&(this.atX=e,this.atY=t),this.m_isRunning=!0}reset(){this.m_isRunning=!1,this.atX=this.atY=void 0,this.m_changeRate=new s(0,0,0,0,0,0)}set(e,t,i,n,o,a){if(e/=1e3,t/=1e3,i/=1e3,n/=1e3,o/=1e3,a/=1e3,this.isRunning()){const l=new s(e,t,i,n,o,a);this.m_changeRate.equals(l)||(this.m_changeRate=l,this.dispatchEvent(new r(this.getChangeRate())))}}isRunning(){return this.m_isRunning}getChangeRate(){return this.m_changeRate}}t.ControlUtils=n;class r extends H.util.Event{constructor(e){super(t.AnimationUpdateEvent),this.changeRate=e,this.changeRate=e}}class s{constructor(e,t,i,n,r,s){this.moveX=e,this.moveY=t,this.moveZ=i,this.rotateX=n,this.rotateY=r,this.rotateZ=s,this.moveX=e,this.moveY=t,this.moveZ=i,this.rotateX=n,this.rotateY=r,this.rotateZ=s}equals(e){return this.moveX===e.moveX&&this.moveY===e.moveY&&this.moveZ===e.moveZ&&this.rotateX===e.rotateX&&this.rotateY===e.rotateY&&this.rotateZ===e.rotateZ}hasValue(){return 0!==this.moveX||0!==this.moveY||0!==this.moveZ||0!==this.rotateX||0!==this.rotateY||0!==this.rotateZ}}t.ChangeRate=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoBoxExtentLike=void 0,t.isGeoBoxExtentLike=function(e){return e&&"object"==typeof e&&"number"==typeof e.latitudeSpan&&"number"==typeof e.longitudeSpan}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPolygonLike=void 0;const n=i(90);t.isGeoPolygonLike=function(e){if(!e||!Array.isArray(e.coordinates)&&e.coordinates.length>2)return!1;let t=!0;return e.coordinates.forEach(i=>{n.isGeoCoordLike(e)||(t=!1)}),t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.identityProjection=void 0;const n=i(0),r=i(12),s=i(7),o=i(22),a=i(13),l=i(23),c=i(14);class h extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=-Math.PI,i.min.y=.5*-Math.PI,i.min.z=e,i.max.x=Math.PI,i.max.y=.5*Math.PI,i.max.z=t,i}projectPoint(e,t){var i;return t||(t={x:0,y:0,z:0}),t.x=n.MathUtils.degToRad(e.longitude),t.y=n.MathUtils.degToRad(e.latitude),t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return s.GeoCoordinates.fromRadians(e.y,e.x,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){t||(t=new n.Box3);const i=this.projectPoint(new s.GeoCoordinates(e.south,e.west,e.minAltitude)),r=this.projectPoint(new s.GeoCoordinates(e.north,e.east,e.maxAltitude));return o.isBox3Like(t)?(t.min.x=i.x,t.min.y=i.y,t.min.z=i.z,t.max.x=r.x,t.max.y=r.y,t.max.z=r.z):l.isOrientedBox3Like(t)&&(a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.x+r.x),t.position.y=.5*(i.y+r.y),t.position.z=.5*(i.z+r.z),t.extents.x=.5*(r.x-i.x),t.extents.y=.5*(r.y-i.y),t.extents.z=Math.max(Number.EPSILON,.5*(r.z-i.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}t.identityProjection=new h(1)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sphereProjection=void 0;const n=i(0),r=i(7),s=i(20),o=i(22),a=i(13),l=i(23),c=i(21),h=i(39),u=i(14);function d(e){const t=1/Math.PI,i=Math.floor(2*(e*t+1));return n.MathUtils.clamp(i,0,4)}function m(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function p(e,t,i){var r;const s=.5*(i+(null!==(r=e.maxAltitude)&&void 0!==r?r:0)),o=n.MathUtils.degToRad(e.west),a=n.MathUtils.degToRad(e.east),l=d(o),c=d(a);let h=Math.cos(o),u=h,m=Math.sin(o),p=m;for(let e=l+1;e<=c;e++){const t=(e+1&1)*((2&e)-1);h=Math.min(t,h),u=Math.max(t,u);const i=(1&e)*((2&e)-1);m=Math.min(i,m),p=Math.max(i,p)}const f=Math.cos(a);h=Math.min(f,h),u=Math.max(f,u);const g=Math.sin(a);m=Math.min(g,m),p=Math.max(g,p);const v=(u+h)*s,y=(u-h)*s,_=(p+m)*s,x=(p-m)*s,w=n.MathUtils.degToRad(e.south),b=n.MathUtils.degToRad(e.north),M=Math.sin(b),T=Math.sin(w),S=(M+T)*s,E=(M-T)*s;return t.min.x=v-y,t.min.y=_-x,t.min.z=S-E,t.max.x=v+y,t.max.y=_+x,t.max.z=S+E,t}class f extends u.Projection{constructor(){super(...arguments),this.type=u.ProjectionType.Spherical}worldExtent(e,t,i=new n.Box3){const r=this.unitScale+t;return i.min.x=-r,i.min.y=-r,i.min.z=-r,i.max.x=r,i.max.y=r,i.max.z=r,i}projectPoint(e,t=a.MathUtils.newVector3(0,0,0)){return function(e,t,i){var r;const s=i+(null!==(r=e.altitude)&&void 0!==r?r:0),o=n.MathUtils.degToRad(e.latitude),a=n.MathUtils.degToRad(e.longitude),l=Math.cos(o);return t.x=s*l*Math.cos(a),t.y=s*l*Math.sin(a),t.z=s*Math.sin(o),t}(e,t,this.unitScale)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,i=Math.sqrt(t),n=e.z/i;if(isNaN(n))return r.GeoCoordinates.fromRadians(0,0,-this.unitScale);const s=Math.sqrt(t+e.z*e.z);return r.GeoCoordinates.fromRadians(Math.atan(n),Math.atan2(e.y,e.x),s-this.unitScale)}unprojectAltitude(e){const t=e.x*e.x+e.y*e.y+e.z*e.z;return Math.sqrt(t)-c.EarthConstants.EQUATORIAL_RADIUS}projectBox(e,t=new n.Box3){var i,r;if(o.isBox3Like(t))return p(e,t,this.unitScale);if(l.isOrientedBox3Like(t)){if(e.longitudeSpan>=90){const i=p(e,new n.Box3,this.unitScale);return a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.max.x+i.min.x),t.position.y=.5*(i.max.y+i.min.y),t.position.z=.5*(i.max.z+i.min.z),t.extents.x=.5*(i.max.x-i.min.x),t.extents.y=.5*(i.max.y-i.min.y),t.extents.z=.5*(i.max.z-i.min.z),t}const{south:s,west:o,north:l,east:c,center:h}=e,u=h.longitude,d=h.latitude,m=Math.cos(n.MathUtils.degToRad(s)),f=Math.sin(n.MathUtils.degToRad(s)),g=Math.cos(n.MathUtils.degToRad(o)),v=Math.sin(n.MathUtils.degToRad(o)),y=Math.cos(n.MathUtils.degToRad(l)),_=Math.sin(n.MathUtils.degToRad(l)),x=Math.cos(n.MathUtils.degToRad(c)),w=Math.sin(n.MathUtils.degToRad(c)),b=Math.cos(n.MathUtils.degToRad(u)),M=Math.sin(n.MathUtils.degToRad(u)),T=Math.cos(n.MathUtils.degToRad(d)),S=Math.sin(n.MathUtils.degToRad(d));let E,P,A;a.MathUtils.newVector3(b*T,M*T,S,t.zAxis),a.MathUtils.newVector3(-M,b,0,t.xAxis),a.MathUtils.newVector3(-b*S,-M*S,T,t.yAxis),s>=0?(E=Math.abs(m*(b*(v-w)+M*(x-g))),P=T*f-S*m,A=T*_-S*y*(b*x+M*w)):(l<=0?(E=Math.abs(y*(b*(v-w)+M*(x-g))),A=T*_-S*y):(E=Math.abs(b*(v-w)+M*(x-g)),A=T*_-S*y*(M*w+b*x)),P=T*f-S*m*(b*x+M*w));const C=.5*(this.unitScale+(null!==(i=e.maxAltitude)&&void 0!==i?i:0)),L=.5*(this.unitScale+(null!==(r=e.minAltitude)&&void 0!==r?r:0)),R=T*(b*x+M*w),D=Math.min(y*R+_*S,m*R+f*S);return a.MathUtils.newVector3(E*C,(A-P)*C,C-D*L,t.extents),a.MathUtils.newVector3(0,(P+A)*C,C+C,t.position),function(e,t,i,n){const r=e.x*n.x+t.x*n.y+i.x*n.z,s=e.y*n.x+t.y*n.y+i.y*n.z,o=e.z*n.x+t.z*n.y+i.z*n.z;n.x=r,n.y=s,n.z=o}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error("Invalid bounding box")}unprojectBox(e){throw new Error("Method not implemented.")}getScaleFactor(e){return 1}groundDistance(e){return m(e)-this.unitScale}scalePointToSurface(e){const t=this.unitScale/(m(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}surfaceNormal(e,t){void 0===t&&(t={x:0,y:0,z:0});const i=1/(m(e)||1);return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t}reprojectPoint(e,t,i){if(e===h.mercatorProjection||e===h.webMercatorProjection){const{x:n,y:r,z:s}=t,o=this.unitScale,a=n/o-Math.PI,l=r/o-Math.PI,c=Math.exp(l),u=c*c,d=2*c/(u+1),m=(u-1)/(u+1),p=o+s;return void 0===i&&(i={}),i.x=Math.cos(a)*d*p,i.y=Math.sin(a)*d*p,i.z=m*p,e===h.webMercatorProjection&&(i.z=-i.z),i}return super.reprojectPoint(e,t,i)}localTangentSpace(e,t){let i;s.isGeoCoordinatesLike(e)?(this.projectPoint(e,t.position),i=e):(a.MathUtils.copyVector3(e,t.position),i=this.unprojectPoint(e));const r=n.MathUtils.degToRad(i.latitude),o=n.MathUtils.degToRad(i.longitude),l=Math.cos(o),c=Math.sin(o),h=Math.cos(r),u=Math.sin(r);return a.MathUtils.newVector3(l*h,c*h,u,t.zAxis),a.MathUtils.newVector3(-c,l,0,t.xAxis),a.MathUtils.newVector3(-l*u,-c*u,h,t.yAxis),t}}t.sphereProjection=new f(c.EarthConstants.EQUATORIAL_RADIUS)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuadTree=void 0;const n=i(41);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(n.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const i of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(i,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hereTilingScheme=void 0;const n=i(92),r=i(95),s=i(29);t.hereTilingScheme=new s.TilingScheme(r.halfQuadTreeSubdivisionScheme,n.normalizedEquirectangularProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorTilingScheme=void 0;const n=i(39),r=i(40),s=i(29);t.webMercatorTilingScheme=new s.TilingScheme(r.quadTreeSubdivisionScheme,n.webMercatorProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mercatorTilingScheme=void 0;const n=i(39),r=i(40),s=i(29);t.mercatorTilingScheme=new s.TilingScheme(r.quadTreeSubdivisionScheme,n.mercatorProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.polarTilingScheme=void 0;const n=i(93),r=i(40),s=i(29);t.polarTilingScheme=new s.TilingScheme(r.quadTreeSubdivisionScheme,n.transverseMercatorProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector2Like=void 0,t.isVector2Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=void 0,t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTransformLike=void 0,t.isTransformLike=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrientedBox3=void 0;const n=i(0);function r(e,t,i,n,r){const s=i.dot(t),o=i.dot(e);if(Math.abs(o)<1e-20)return Math.abs(s)<=n;const a=1/o,l=(s+n)*a,c=(s-n)*a;return l>c?(c>r.min&&(r.min=c),l<r.max&&(r.max=l)):(l>r.min&&(r.min=l),c<r.max&&(r.max=c)),r.min<=r.max&&r.max>=0}const s=new n.Vector3,o={min:-1/0,max:1/0};class a{constructor(e,t,i){this.position=new n.Vector3,this.xAxis=new n.Vector3(1,0,0),this.yAxis=new n.Vector3(0,1,0),this.zAxis=new n.Vector3(0,0,1),this.extents=new n.Vector3,void 0!==e&&this.position.copy(e),void 0!==t&&t.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==i&&this.extents.copy(i)}clone(){const e=new a;return e.copy(this),e}copy(e){this.position.copy(e.position),this.xAxis.copy(e.xAxis),this.yAxis.copy(e.yAxis),this.zAxis.copy(e.zAxis),this.extents.copy(e.extents)}getCenter(e=new n.Vector3){return e.copy(this.position)}getSize(e=new n.Vector3){return e.copy(this.extents).multiplyScalar(2)}getRotationMatrix(e=new n.Matrix4){return e.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(e){const t=Array.isArray(e)?e:e.planes;for(const e of t){const t=Math.abs(e.normal.dot(this.xAxis)*this.extents.x)+Math.abs(e.normal.dot(this.yAxis)*this.extents.y)+Math.abs(e.normal.dot(this.zAxis)*this.extents.z);if(e.distanceToPoint(this.position)+t<0)return!1}return!0}intersectsRay(e){if(o.min=-1/0,o.max=1/0,s.copy(this.position).sub(e.origin),r(e.direction,s,this.xAxis,this.extents.x,o)&&r(e.direction,s,this.yAxis,this.extents.y,o)&&r(e.direction,s,this.zAxis,this.extents.z,o))return o.min>0?o.min:o.max}contains(e){const t=e.x-this.position.x,i=e.y-this.position.y,n=e.z-this.position.z,r=Math.abs(t*this.xAxis.x+i*this.xAxis.y+n*this.xAxis.z),s=Math.abs(t*this.yAxis.x+i*this.yAxis.y+n*this.yAxis.z),o=Math.abs(t*this.zAxis.x+i*this.zAxis.y+n*this.zAxis.z);return!(r>this.extents.x||s>this.extents.y||o>this.extents.z)}distanceToPoint(e){return Math.sqrt(this.distanceToPointSquared(e))}distanceToPointSquared(e){const t=new n.Vector3;t.subVectors(e,this.position);const i=[t.dot(this.xAxis),t.dot(this.yAxis),t.dot(this.zAxis)];let r=0;for(let e=0;e<3;++e){const t=i[e],n=this.extents.getComponent(e);if(t<-n){const e=n+t;r+=e*e}else if(t>n){const e=t-n;r+=e*e}}return r}}t.OrientedBox3=a},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(202),t),r(i(203),t),r(i(204),t),r(i(208),t),r(i(103),t),r(i(209),t),r(i(210),t),r(i(211),t),r(i(212),t),r(i(59),t),r(i(213),t),r(i(214),t),r(i(215),t),r(i(216),t),r(i(60),t),r(i(217),t),r(i(218),t),r(i(219),t),r(i(220),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOMUtils=void 0,function(e){function t(e){return e.substring(0,2)}e.getBrowserLanguages=function(){if(void 0!==navigator.languages&&navigator.languages.length>0){const e=[];for(const i of navigator.languages)e.push(t(i));return e}if(void 0!==navigator.language)return[t(navigator.language)]}}(t.DOMUtils||(t.DOMUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupedPriorityList=t.PriorityListGroup=void 0;class n{constructor(e,t=new Array){this.priority=e,this.elements=t}clone(){return new n(this.priority,this.elements.slice())}remove(e){const t=this.elements.indexOf(e);return-1!==t&&(this.elements.splice(t,1),!0)}}t.PriorityListGroup=n;class r{constructor(){this.groups=new Map}add(e){this.getGroup(e.priority).elements.push(e)}remove(e){const t=this.findGroup(e.priority);return!(void 0===t||!t.remove(e))&&(0===t.elements.length&&this.groups.delete(t.priority),!0)}clear(){this.groups.clear()}merge(e){for(const t of e.groups){const e=this.findGroup(t[1].priority);void 0!==e?e.elements=e.elements.concat(t[1].elements):this.groups.set(Math.floor(t[1].priority),t[1].clone())}return this}clone(){const e=new r;for(const[t,i]of this.groups)e.groups.set(t,i.clone());return e}forEach(e){for(const t of this.groups)t[1].elements.forEach(e)}count(){let e=0;for(const t of this.groups)e+=t[1].elements.length;return e}findGroup(e){const t=Math.floor(e);return this.groups.get(t)}getGroup(e){let t=this.findGroup(e);if(void 0===t){const i=Math.floor(e);t=new n(i),this.groups.set(t.priority,t)}return t}}t.GroupedPriorityList=r},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(100),t),r(i(205),t),r(i(57),t),r(i(101),t),r(i(58),t),r(i(207),t),r(i(102),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManagerImpl=void 0;const n=i(100),r=i(101),s=i(102);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new n.ConsoleChannel:new s.WorkerChannel}getLoggerNames(){return this.m_loggers.map(e=>e.name)}getLogger(e){return this.m_loggers.find(t=>t.name===e)}create(e,t={}){void 0!==this.m_levelSetForAll&&(void 0===t.level||t.level<this.m_levelSetForAll)&&(t.level=this.m_levelSetForAll);const i=new r.Logger(e,this.channel,t);return this.m_loggers.push(i),i}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister "${e}" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const i of this.m_loggers)i.name===e&&i.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){this.m_levelSetForAll=e;for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultiChannel=void 0;t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const i of this.channels)i.error(e,...t)}debug(e,...t){for(const i of this.channels)i.debug(e,...t)}info(e,...t){for(const i of this.channels)i.info(e,...t)}log(e,...t){for(const i of this.channels)i.log(e,...t)}trace(e,...t){for(const i of this.channels)i.trace(e,...t)}warn(e,...t){for(const i of this.channels)i.warn(e,...t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Math2D=void 0,function(e){function t(e,t,i,n){return(e-i)*(e-i)+(t-n)*(t-n)}e.Box=class{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.w=i,this.h=n}set(e,t,i,n){this.x=e,this.y=t,this.w=i,this.h=n}copy(e){this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}containsBox(e){const t=e.x+e.w,i=e.y+e.h;return this.contains(e.x,e.y)&&this.contains(t,e.y)&&this.contains(e.x,i)&&this.contains(t,i)}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const i=e.length-4;for(let n=0;n<i;n+=3){const i=e[n+3]-e[n],r=e[n+4]-e[n+1];t+=i*i+r*r}return t},e.distToSegmentSquared=function(e,i,n,r,s,o){const a=t(n,r,s,o);if(0===a)return t(e,i,n,r);let l=((e-n)*(s-n)+(i-r)*(o-r))/a;return l=Math.max(0,Math.min(1,l)),t(e,i,n+l*(s-n),r+l*(o-r))},e.intersectLineAndCircle=function(e,t,i,n,r,s=0,o=0){const a=i-e,l=n-t,c=a*a+l*l,h=e*n-i*t-l*s+a*o,u=r*r*c-h*h;if(u<-1e-10)return;const d=h*l,m=-h*a;if(u<1e-10)return{x1:s+d/c,y1:o+m/c};const p=Math.sqrt(u),f=(l<0?-1:1)*a*p,g=Math.abs(l)*p;return{x1:s+(d+f)/c,y1:o+(m+g)/c,x2:s+(d-f)/c,y2:o+(m-g)/c}},e.intersectLines=function(e,t,i,n,r,s,o,a,l={x:0,y:0}){const c=(e-i)*(s-a)-(t-n)*(r-o);if(0===c)return;const h=((e*n-t*i)*(r-o)-(e-i)*(r*a-s*o))/c,u=((e*n-t*i)*(s-a)-(t-n)*(r*a-s*o))/c;return l.x=h,l.y=u,l}}(t.Math2D||(t.Math2D={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixinsWithoutProperties=t.applyMixins=void 0,t.applyMixins=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(i=>{e.prototype[i]=t.prototype[i]})})},t.applyMixinsWithoutProperties=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(i=>{const n=Object.getOwnPropertyDescriptor(t.prototype,i);void 0!==n&&void 0===n.get&&"constructor"!==i&&(e.prototype[i]=t.prototype[i])})})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assertExists=t.assert=void 0;t.assert=function(e,t){0},t.assertExists=function(e,t){return e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContextLogger=void 0;t.ContextLogger=class{constructor(e,t){this.m_logger=e,this.headerMessage=t,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod("warn"),this.info=this.createLogMethod("info"),this.error=this.createLogMethod("error")}pushAttr(e){this.context.push(`${this.context.length>0?".":""}${e}`)}pushIndex(e){this.context.push(`[${e}]`)}pop(){this.context.pop()}createLogMethod(e){return(t,...i)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[e](`${this.context.join("")}: ${t}`,...i)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pick=t.cloneDeep=void 0,t.cloneDeep=function(e){const t=new Map,i=function e(i){if(null===i)return null;if("object"==typeof i){const n=t.get(i);if(void 0!==n)return n;if(Array.isArray(i)){const n=[];t.set(i,n),n.length=i.length;for(let t=0;t<n.length;++t)n[t]=e(i[t]);return n}if(i instanceof Date){const e=new Date(i.getTime());return t.set(i,e),e}if(i instanceof RegExp){const e=new RegExp(i.source,i.flags);return t.set(i,e),e}if(i.constructor!==Object)throw new Error("cloneDeep doesn't support objects with custom prototypes");{const n={};t.set(i,n);for(const t in i)i.hasOwnProperty(t)&&(n[t]=e(i[t]));return n}}return i}(e);return t.clear(),i},t.pick=function(e,t){const i={};for(const n of t)e.hasOwnProperty(n)&&(i[n]=e[n]);return i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=void 0,t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TaskQueue=void 0;t.TaskQueue=class{constructor(e){var t;this.m_options=e,this.m_taskLists=new Map,null===(t=this.m_options.groups)||void 0===t||t.forEach(e=>{this.m_taskLists.set(e,[])}),this.m_options.prioSortFn&&(this.sort=this.m_options.prioSortFn)}update(e){if(void 0===e)this.m_taskLists.forEach(e=>{this.updateTaskList(e)});else{const t=this.getTaskList(e);t&&this.updateTaskList(t)}}add(e){var t;if(this.m_taskLists.has(e.group)){const i=this.m_taskLists.get(e.group);if(!(null==i?void 0:i.includes(e)))return null===(t=this.m_taskLists.get(e.group))||void 0===t||t.push(e),!0}return!1}remove(e){var t,i;if(this.m_taskLists.has(e.group)){const n=null===(t=this.m_taskLists.get(e.group))||void 0===t?void 0:t.indexOf(e);if(-1!==n)return null===(i=this.m_taskLists.get(e.group))||void 0===i||i.splice(n,1),!0}return!1}numItemsLeft(e){var t,i;let n=0;return void 0===e?this.m_taskLists.forEach(e=>{n+=e.length}):n+=null!==(i=null===(t=this.getTaskList(e))||void 0===t?void 0:t.length)&&void 0!==i?i:0,n}processNext(e,t,i=1){if(!this.getTaskList(e)||this.numItemsLeft(e)<=0)return!1;for(let n=0;n<i&&this.numItemsLeft(e)>0;n++){const i=this.pull(e,!0);void 0!==i&&(!t||(null==t?void 0:t(i))?i.execute():this.add(i))}return!0}clear(){this.m_taskLists.clear()}pull(e,t=!1){var i,n;let r;return this.getTaskList(e)&&(r=null===(i=this.getTaskList(e))||void 0===i?void 0:i.pop(),t&&r&&(null===(n=r.isExpired)||void 0===n?void 0:n.call(r)))?this.pull(e,t):r}sort(e,t){return t.getPriority()-e.getPriority()}getTaskList(e){return this.m_taskLists.get(e)}updateTaskList(e){var t;for(let i=0;i<e.length;i++){const n=e[i];(null===(t=null==n?void 0:n.isExpired)||void 0===t?void 0:t.call(n))&&(e.splice(i,1),i--)}e.sort(this.sort)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.composeUriResolvers=t.RelativeUriResolver=t.PrefixMapUriResolver=void 0;const n=i(60);t.PrefixMapUriResolver=class{constructor(e){this.definitions=e}resolveUri(e){return Object.keys(this.definitions).reduce((e,t)=>{if(t.endsWith("/")&&e.startsWith(t)){return this.definitions[t]+e.substr(t.length)}return e===t?this.definitions[t]:e},e)}};t.RelativeUriResolver=class{constructor(e){this.parentUri=e}resolveUri(e){return n.resolveReferenceUri(this.parentUri,e)}},t.composeUriResolvers=function(...e){return{resolveUri:t=>e.reduce((e,t)=>void 0!==t?t.resolveUri(e):e,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chainCallbacks=void 0,t.chainCallbacks=function(e,t){return function(...i){return e&&e.apply(this,i),t.apply(this,i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sampleBilinear=void 0,t.sampleBilinear=function(e,t,i,n,r){const s=t-1,o=i-1,a=n*s,l=Math.floor(a),c=r*o,h=Math.floor(c),u=h*t+l,d=l<s?u+1:u,m=h<o?u+t:u,p=l<s?m+1:m,f=e[u],g=e[d],v=e[m],y=e[p],_=Number.isInteger(a)?0:a-l,x=1-_,w=Number.isInteger(c)?0:c-h,b=1-w;return f*x*b+g*_*b+v*x*w+y*_*w}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertFragmentShaderToWebGL2=t.convertVertexShaderToWebGL2=void 0,t.convertVertexShaderToWebGL2=function(e){return["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+e},t.convertFragmentShaderToWebGL2=function(e){return["#define varying in","out highp vec4 pc_fragColor;","#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+e}},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.getAppBaseUrl=void 0;const n=i(60);t.getAppBaseUrl=function(){return"undefined"==typeof window?`file://${e.cwd()}/`:n.baseUrl(window.location.href)}}).call(this,i(222))},function(e,t){var i,n,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,c=[],h=!1,u=-1;function d(){h&&l&&(h=!1,l.length?c=l.concat(c):u=-1,c.length&&m())}function m(){if(!h){var e=a(d);h=!0;for(var t=c.length;t;){for(l=c,c=[];++u<t;)l&&l[u].run();u=-1,t=c.length}l=null,h=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new p(e,t)),1!==c.length||h||a(m)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return e<0?0:e>1?1:e}function s(e){return"%"===e[e.length-1]?n(parseFloat(e)/100*255):n(parseInt(e))}function o(e){return"%"===e[e.length-1]?r(parseFloat(e)/100):r(parseFloat(e))}function a(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in i)return i[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=r.indexOf("("),c=r.indexOf(")");if(-1!==l&&c+1===r.length){var h=r.substr(0,l),u=r.substr(l+1,c-(l+1)).split(","),d=1;switch(h){case"rgba":if(4!==u.length)return null;d=o(u.pop());case"rgb":return 3!==u.length?null:[s(u[0]),s(u[1]),s(u[2]),d];case"hsla":if(4!==u.length)return null;d=o(u.pop());case"hsl":if(3!==u.length)return null;var m=(parseFloat(u[0])%360+360)%360/360,p=o(u[1]),f=o(u[2]),g=f<=.5?f*(p+1):f+p-f*p,v=2*f-g;return[n(255*a(v,g,m+1/3)),n(255*a(v,g,m)),n(255*a(v,g,m-1/3)),d];default:return null}}return null}}catch(e){}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprEvaluator=t.ExprEvaluatorContext=void 0;const n=i(0),r=i(6),s=i(225),o=i(226),a=i(227),l=i(228),c=i(229),h=i(230),u=i(231),d=i(232),m=i(233),p=i(234),f=i(235),g=i(236),v=i(237),y=i(61),_=i(42),x=new Map;function w(e,t){var i,n,s;if(t instanceof r.StringLiteralExpr)return null!==(i=t.promotedValue)&&void 0!==i?i:t.value;const o=e.evaluate(t);return"string"==typeof o&&null!==(s=null!==(n=_.RGBA.parse(o))&&void 0!==n?n:y.Pixels.parse(o))&&void 0!==s?s:o}t.ExprEvaluatorContext=class{constructor(e,t,i,n){this.evaluator=e,this.env=t,this.scope=i,this.cache=n}evaluate(e){var t,i;if(void 0===e)throw new Error("Failed to evaluate expression");const n=null===(t=this.cache)||void 0===t?void 0:t.get(e);if(void 0!==n)return n;const r=e.accept(this.evaluator,this);return null===(i=this.cache)||void 0===i||i.set(e,r),r}wrapValue(e){return r.Expr.isExpr(e)?e:r.LiteralExpr.fromValue(e)}};class b{static defineOperator(e,t){x.set(e,t)}static defineOperators(e){Object.getOwnPropertyNames(e).forEach(t=>{this.defineOperator(t,e[t])})}static getOperator(e){return x.get(e)}visitVarExpr(e,t){const i=t.env.lookup(e.name);return void 0!==i?i:null}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value}visitHasAttributeExpr(e,t){return void 0!==t.env.lookup(e.name)}visitMatchExpr(e,t){const i=t.evaluate(e.value);for(const[n,r]of e.branches){if(Array.isArray(n)&&n.includes(i))return t.evaluate(r);if(n===i)return t.evaluate(r)}return t.evaluate(e.fallback)}visitCaseExpr(e,t){if(t.scope===r.ExprScope.Value){const i=e.branches.findIndex(([e,t])=>e.isDynamic());if(-1!==i){let n;for(let s=0;s<e.branches.length;++s){const[o,a]=e.branches[s],l=t.evaluate(o),c=t.evaluate(a);if(s<i&&Boolean(l))return c;if((r.Expr.isExpr(l)||Boolean(l))&&(void 0===n&&(n=[]),null==n||n.push([t.wrapValue(l),t.wrapValue(c)]),!r.Expr.isExpr(l)&&Boolean(l)))return new r.CaseExpr(n,r.LiteralExpr.fromValue(null))}const s=t.evaluate(e.fallback);return void 0===n?s:new r.CaseExpr(n,t.wrapValue(s))}}for(const[i,n]of e.branches)if(t.evaluate(i))return t.evaluate(n);return t.evaluate(e.fallback)}visitCallExpr(e,t){var i;const n=null!==(i=e.descriptor)&&void 0!==i?i:x.get(e.op);if(n){let i;if(e.descriptor=n,t.scope===r.ExprScope.Value&&e.isDynamic()){if(e.descriptor.partialEvaluate)return e.descriptor.partialEvaluate(t,e);const n=e.args.map(e=>t.wrapValue(t.evaluate(e)));if(n.every((t,i)=>t===e.args[i]))return e;i=new r.CallExpr(e.op,n)}else i=n.call(t,e);return i}throw new Error(`undefined operator '${e.op}'`)}visitStepExpr(e,t){if(t.scope===r.ExprScope.Value){const i=t.evaluate(e.input),n=t.evaluate(e.defaultValue);return new r.StepExpr(t.wrapValue(i),t.wrapValue(n),e.stops.map(([e,i])=>{const n=t.evaluate(i);return[e,t.wrapValue(n)]}))}{const i=t.evaluate(e.input);if("number"!=typeof i)throw new Error(`input '${i}' must be a number`);if(i<e.stops[0][0])return t.evaluate(e.defaultValue);let n=e.stops.findIndex(e=>e[0]>i);return-1===n&&(n=e.stops.length),t.evaluate(e.stops[n-1][1])}}visitInterpolateExpr(e,t){if(t.scope===r.ExprScope.Value){const i=t.evaluate(e.input);return new r.InterpolateExpr(e.mode,t.wrapValue(i),e.stops.map(([e,i])=>{const n=t.evaluate(i);return[e,t.wrapValue(n)]}))}{const i=t.evaluate(e.input);if("number"!=typeof i)throw new Error("input must be a number");if("cubic"===e.mode[0])return function(e,t,i){if(i<t.stops[0][0])return w(e,t.stops[0][1]);if(i>=t.stops[t.stops.length-1][0])return w(e,t.stops[t.stops.length-1][1]);const r=t.stops.findIndex(e=>e[0]>i),s=Math.max(0,r-1),o=0===s?r:s-1,a=r<t.stops.length-1?r+1:r-1,l=t.stops[o][0],c=t.stops[s][0],h=t.stops[r][0],u=.5*(h-c),d=u/(c-l),m=u/(t.stops[a][0]-h),p=(i-c)/(h-c),f=p*p,g=f*p,v=-d*g+2*d*f-d*p,x=(1+d)*g+(-1.5-2*d)*f+(-.5+d)*p+1,b=(-1-m)*g+(1.5+m)*f+.5*p,M=m*g-m*f,T=w(e,t.stops[o][1]),S=w(e,t.stops[s][1]),E=w(e,t.stops[r][1]),P=w(e,t.stops[a][1]);if("number"==typeof T&&"number"==typeof S&&"number"==typeof E&&"number"==typeof P)return v*T+x*S+b*E+M*P;if(T instanceof _.RGBA&&S instanceof _.RGBA&&E instanceof _.RGBA&&P instanceof _.RGBA)return new _.RGBA(n.MathUtils.clamp(v*T.r+x*S.r+b*E.r+M*P.r,0,1),n.MathUtils.clamp(v*T.g+x*S.g+b*E.g+M*P.g,0,1),n.MathUtils.clamp(v*T.b+x*S.b+b*E.b+M*P.b,0,1),n.MathUtils.clamp(v*T.a+x*S.a+b*E.a+M*P.a,0,1));if(T instanceof y.Pixels&&S instanceof y.Pixels&&E instanceof y.Pixels&&P instanceof y.Pixels)return new y.Pixels(v*T.value+x*S.value+b*E.value+M*P.value);if(T instanceof n.Color&&S instanceof n.Color&&E instanceof n.Color&&P instanceof n.Color)return new n.Color(v*T.r+x*S.r+b*E.r+M*P.r,v*T.g+x*S.g+b*E.g+M*P.g,v*T.b+x*S.b+b*E.b+M*P.b);if(T instanceof n.Vector2&&S instanceof n.Vector2&&E instanceof n.Vector2&&P instanceof n.Vector2)return new n.Vector2(v*T.x+x*S.x+b*E.x+M*P.x,v*T.y+x*S.y+b*E.y+M*P.y);if(T instanceof n.Vector3&&S instanceof n.Vector3&&E instanceof n.Vector3&&P instanceof n.Vector3)return new n.Vector3(v*T.x+x*S.x+b*E.x+M*P.x,v*T.y+x*S.y+b*E.y+M*P.y,v*T.z+x*S.z+b*E.z+M*P.z);if(T instanceof n.Vector4&&S instanceof n.Vector4&&E instanceof n.Vector4&&P instanceof n.Vector4)return new n.Vector4(v*T.x+x*S.x+b*E.x+M*P.x,v*T.y+x*S.y+b*E.y+M*P.y,v*T.z+x*S.z+b*E.z+M*P.z,v*T.w+x*S.w+b*E.w+M*P.w);if(Array.isArray(T)&&Array.isArray(S)&&Array.isArray(E)&&Array.isArray(P)){const e=T.length,t=[];for(let i=0;i<e;++i)t[i]=v*T[i]+x*S[i]+b*E[i]+M*P[i];return t}throw new Error("failed to interpolate values")}(t,e,i);const r=e.stops.findIndex(e=>e[0]>i);if(-1===r)return t.evaluate(e.stops[e.stops.length-1][1]);if(0===r)return t.evaluate(e.stops[0][1]);const[s,o]=e.stops[r],[a,l]=e.stops[r-1],c=w(t,l);let h=0;switch(e.mode[0]){case"discrete":return c;case"linear":h=(i-a)/(s-a);break;case"exponential":{const t=e.mode[1];h=1===t?(i-a)/(s-a):(Math.pow(t,i-a)-1)/(Math.pow(t,s-a)-1);break}default:throw new Error(`interpolation mode ${JSON.stringify(e.mode)} is not supported`)}const u=w(t,o);if("number"==typeof c&&"number"==typeof u)return n.MathUtils.lerp(c,u,h);if(c instanceof _.RGBA&&u instanceof _.RGBA)return c.clone().lerp(u,h);if(c instanceof y.Pixels&&u instanceof y.Pixels)return new y.Pixels(n.MathUtils.lerp(c.value,u.value,h));if(c instanceof n.Color&&u instanceof n.Color)return c.clone().lerp(u,h);if(c instanceof n.Vector2&&u instanceof n.Vector2)return c.clone().lerp(u,h);if(c instanceof n.Vector3&&u instanceof n.Vector3)return c.clone().lerp(u,h);if(c instanceof n.Vector4&&u instanceof n.Vector4)return c.clone().lerp(u,h);if(Array.isArray(c)&&Array.isArray(u)&&c.length===u.length)return c.map((e,t)=>n.MathUtils.lerp(e,u[t],h));throw new Error(`todo: mix(${JSON.stringify(c)}, ${JSON.stringify(u)}, ${h})`)}}}t.ExprEvaluator=b,b.defineOperators(o.CastOperators),b.defineOperators(l.ComparisonOperators),b.defineOperators(d.MathOperators),b.defineOperators(f.StringOperators),b.defineOperators(a.ColorOperators),b.defineOperators(g.TypeOperators),b.defineOperators(m.MiscOperators),b.defineOperators(h.FlowOperators),b.defineOperators(s.ArrayOperators),b.defineOperators(p.ObjectOperators),b.defineOperators(c.FeatureOperators),b.defineOperators(u.MapOperators),b.defineOperators(v.VectorOperators)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayOperators=void 0;const n=i(6),r=["boolean","number","string"];function s(e,t){if(!(e instanceof n.StringLiteralExpr&&r.includes(e.value)))throw new Error(`expected "boolean", "number" or "string" instead of '${JSON.stringify(e)}'`);const i=e.value;t.forEach((e,t)=>{if(typeof e!==i)throw new Error(`expected array element at index ${t} to have type '${i}'`)})}function o(e,t){const i=e.evaluate(t);if(!Array.isArray(i))throw new Error(`'${i}' is not an array`);return i}const a={array:{call:(e,t)=>{switch(t.args.length){case 0:throw new Error("not enough arguments");case 1:return o(e,t.args[0]);case 2:{const i=o(e,t.args[1]);return s(t.args[0],i),i}case 3:{const i=o(e,t.args[2]);return function(e,t){if(!(e instanceof n.NumberLiteralExpr))throw new Error("missing expected number of elements");const i=e.value;if(t.length!==i)throw new Error(`the array must have ${i} element(s)`)}(t.args[1],i),s(t.args[0],i),i}default:throw new Error("too many arguments")}}},"make-array":{call:(e,t)=>{if(0===t.args.length)throw new Error("not enough arguments");return[...t.args.map(t=>e.evaluate(t))]}},at:{call:(e,t)=>{const i=t.args,n=e.evaluate(i[0]);if("number"!=typeof n)throw new Error("expected the index of the element to retrieve");const r=e.evaluate(i[1]);if(!Array.isArray(r))throw new Error("expected an array");return n>=0&&n<r.length?r[n]:null}},slice:{call:(e,t)=>{if(t.args.length<2)throw new Error("not enough arguments");const i=e.evaluate(t.args[0]);if("string"!=typeof i&&!Array.isArray(i))throw new Error("input must be a string or an array");const n=e.evaluate(t.args[1]);if("number"!=typeof n)throw new Error("expected an index");let r;if(t.args.length>2&&(r=e.evaluate(t.args[2]),"number"!=typeof r))throw new Error("expected an index");return i.slice(n,r)}}};t.ArrayOperators=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CastOperators=void 0;const n={"to-boolean":{call:(e,t)=>Boolean(e.evaluate(t.args[0]))},"to-string":{call:(e,t)=>String(e.evaluate(t.args[0]))},"to-number":{call:(e,t)=>{for(const i of t.args){const t=Number(e.evaluate(i));if(!isNaN(t))return t}throw new Error("cannot convert the value to a number")}}};t.CastOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorOperators=void 0;const n=i(0),r=i(30),s=i(43),o={alpha:{call:(e,t)=>{let i=e.evaluate(t.args[0]);"string"==typeof i&&(i=s.parseStringEncodedColor(i));return"number"==typeof i?r.ColorUtils.getAlphaFromHex(i):1}},rgba:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]),a=e.evaluate(t.args[3]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&"number"==typeof a&&i>=0&&s>=0&&o>=0&&a>=0&&a<=1)return function(e,t,i,s){return r.ColorUtils.getHexFromRgba(n.MathUtils.clamp(e,0,255)/255,n.MathUtils.clamp(t,0,255)/255,n.MathUtils.clamp(i,0,255)/255,n.MathUtils.clamp(s,0,1))}(i,s,o,a);throw new Error(`unknown color 'rgba(${i},${s},${o},${a})'`)}},rgb:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&i>=0&&s>=0&&o>=0)return function(e,t,i){return r.ColorUtils.getHexFromRgb(n.MathUtils.clamp(e,0,255)/255,n.MathUtils.clamp(t,0,255)/255,n.MathUtils.clamp(i,0,255)/255)}(i,s,o);throw new Error(`unknown color 'rgb(${i},${s},${o})'`)}},hsl:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&i>=0&&s>=0&&o>=0)return function(e,t,i){return r.ColorUtils.getHexFromHsl(n.MathUtils.euclideanModulo(e,360)/360,n.MathUtils.clamp(t,0,100)/100,n.MathUtils.clamp(i,0,100)/100)}(i,s,o);throw new Error(`unknown color 'hsl(${i},${s}%,${o}%)'`)}}};t.ColorOperators=o},function(e,t,i){"use strict";function n(e,t,i=!1){const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if(!("number"==typeof n&&"number"==typeof r||"string"==typeof n&&"string"==typeof r)&&i)throw new Error(`invalid operands '${n}' and '${r}' for operator '${t.op}'`);switch(t.op){case"<":return n<r;case">":return n>r;case"<=":return n<=r;case">=":return n>=r;default:throw new Error(`invalid comparison operator '${t.op}'`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.ComparisonOperators=void 0;const r={"!":{call:(e,t)=>!e.evaluate(t.args[0])},"==":{call:(e,t)=>e.evaluate(t.args[0])===e.evaluate(t.args[1])},"!=":{call:(e,t)=>e.evaluate(t.args[0])!==e.evaluate(t.args[1])},"<":{call:(e,t)=>n(e,t)},">":{call:(e,t)=>n(e,t)},"<=":{call:(e,t)=>n(e,t)},">=":{call:(e,t)=>n(e,t)}};t.ComparisonOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureOperators=void 0;const n=i(44),r=i(6),s={"geometry-type":{call:(e,t)=>{switch(e.env.lookup("$geometryType")){case"point":return"Point";case"line":return"LineString";case"polygon":return"Polygon";default:return null}}},"feature-state":{isDynamicOperator:()=>!0,call:(e,t)=>{var i,s;if(e.scope!==r.ExprScope.Dynamic)throw new Error("feature-state cannot be used in this context");const o=e.evaluate(t.args[0]);if("string"!=typeof o)throw new Error("expected the name of the property of the feature state");const a=e.env.lookup("$state");return n.Env.isEnv(a)?null!==(i=a.lookup(o))&&void 0!==i?i:null:a instanceof Map&&null!==(s=a.get(o))&&void 0!==s?s:null}},id:{call:(e,t)=>{var i;return null!==(i=e.env.lookup("$id"))&&void 0!==i?i:null}}};t.FeatureOperators=s},function(e,t,i){"use strict";function n(e,t,i){switch(t){case"boolean":case"number":case"string":for(const n of i){const i=e.evaluate(n);if(typeof i===t)return i}throw new Error(`expected a '${t}'`);default:throw new Error(`invalid type '${t}'`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.FlowOperators=void 0;const r={all:{call:(e,t)=>{for(const i of t.args)if(!e.evaluate(i))return!1;return!0}},any:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!0;return!1}},none:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!1;return!0}},boolean:{call:(e,t)=>n(e,"boolean",t.args)},number:{call:(e,t)=>n(e,"number",t.args)},string:{call:(e,t)=>n(e,"string",t.args)}};t.FlowOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapOperators=void 0;const n=i(6),r={"ppi-scale":{call:(e,t)=>e.evaluate(t.args[0])*(t.args[1]?e.evaluate(t.args[1]):1)},"world-ppi-scale":{isDynamicOperator:()=>!0,call:(e,t)=>{const i=e.evaluate(t.args[0]),n=t.args[1]?e.evaluate(t.args[1]):1,r=e.env.lookup("$zoom");return i*(Math.pow(2,17)/Math.pow(2,r))*n}},"world-discrete-ppi-scale":{isDynamicOperator:()=>!0,call:(e,t)=>{const i=e.evaluate(t.args[0]),n=t.args[1]?e.evaluate(t.args[1]):1,r=e.env.lookup("$zoom");return i*(Math.pow(2,17)/Math.pow(2,Math.floor(r)))*n}},ppi:{call:e=>{const t=e.env.lookup("$ppi");return"number"==typeof t?t:72}},zoom:{isDynamicOperator:()=>!0,call:(e,t)=>{var i;return e.scope===n.ExprScope.Value?t:null!==(i=e.env.lookup("$zoom"))&&void 0!==i?i:null}}};t.MapOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathOperators=void 0;const n=i(0),r={"^":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '^'`);return Math.pow(i,n)}},"-":{call:(e,t)=>{if(1===t.args.length){const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`ìnvalid operand '${typeof i} for operator '-'`);return-i}const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '-'`);return i-n}},"/":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '/'`);return i/n}},"%":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '%'`);return i%n}},"+":{call:(e,t)=>t.args.reduce((t,i)=>Number(t)+Number(e.evaluate(i)),0)},"*":{call:(e,t)=>t.args.reduce((t,i)=>Number(t)*Number(e.evaluate(i)),1)},abs:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'abs'`);return Math.abs(i)}},acos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'acos'`);return Math.acos(i)}},asin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'asin'`);return Math.asin(i)}},atan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'atan'`);return Math.atan(i)}},ceil:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ceil'`);return Math.ceil(i)}},cos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'cos'`);return Math.cos(i)}},e:{call:()=>Math.E},floor:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'floor'`);return Math.floor(i)}},ln:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln'`);return Math.log(i)}},ln2:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln2'`);return Math.log2(i)}},log10:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'log10'`);return Math.log10(i)}},max:{call:(e,t)=>Math.max(...t.args.map(t=>Number(e.evaluate(t))))},min:{call:(e,t)=>Math.min(...t.args.map(t=>Number(e.evaluate(t))))},clamp:{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if("number"!=typeof i||"number"!=typeof r||"number"!=typeof s)throw new Error(`invalid operands '${i}', ${r}, ${s} for operator 'clamp'`);return n.MathUtils.clamp(i,r,s)}},pi:{call:()=>Math.PI},round:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'round'`);return Math.round(i)}},sin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sin'`);return Math.sin(i)}},sqrt:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sqrt'`);return Math.sqrt(i)}},tan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'tan'`);return Math.tan(i)}}};t.MathOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MiscOperators=void 0;const n={length:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if(Array.isArray(i)||"string"==typeof i)return i.length;throw new Error(`invalid operand '${i}' for operator 'length'`)}},coalesce:{call:(e,t)=>{for(const i of t.args){const t=e.evaluate(i);if(null!==t)return t}return null}}};t.MiscOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectOperators=void 0;const n=i(44),r=i(6),s=Object.prototype.hasOwnProperty;var o;function a(e,t,i){var r;const a=e.evaluate(t[0]);if("string"!=typeof a)throw new Error("expected the name of an attribute");const l=e.evaluate(t[1]);if(l&&"object"==typeof l){if(n.Env.isEnv(l)){const e=null!==(r=l.lookup(a))&&void 0!==r?r:null;return i===o.get?e:null!==e}if(s.call(l,a))return i!==o.get||l[a]}return i===o.get&&null}!function(e){e[e.get=0]="get",e[e.has=1]="has"}(o||(o={}));const l={in:{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return("string"==typeof i&&"string"==typeof n||!!Array.isArray(n))&&n.includes(i)}},get:{call:(e,t)=>a(e,t.args,o.get)},has:{call:(e,t)=>a(e,t.args,o.has)},"dynamic-properties":{isDynamicOperator:()=>!0,call:(e,t)=>e.scope===r.ExprScope.Dynamic?e.env:t}};t.ObjectOperators=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StringOperators=void 0;const n={concat:{call:(e,t)=>"".concat(...t.args.map(t=>String(e.evaluate(t))))},downcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleLowerCase()},upcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleUpperCase()},"~=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof n&&i.includes(n)}},"^=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof n&&i.startsWith(n)}},"$=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof n&&i.endsWith(n)}}};t.StringOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeOperators=void 0;t.TypeOperators={typeof:{call:(e,t)=>typeof e.evaluate(t.args[0])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorOperators=void 0;const n=i(0),r=i(6);function s(e,t,i){let r;switch(i){case"vector2":r=n.Vector2;break;case"vector3":r=n.Vector3;break;case"vector4":r=n.Vector4}for(const i of t.args){const t=e.evaluate(i);if(t instanceof r)return t}throw new Error(`expected a "${i}"`)}function o(e,t,i){let r,s;switch(i){case"vector2":r=n.Vector2,s=2;break;case"vector3":r=n.Vector3,s=3;break;case"vector4":r=n.Vector4,s=4}for(const i of t.args){const t=e.evaluate(i);if(t instanceof r)return t;if(Array.isArray(t)&&t.length===s&&t.every(e=>"number"==typeof e))return(new r).fromArray(t)}throw new Error(`expected a "${i}"`)}const a={"make-vector":{call:(e,t)=>{if(void 0!==t._value)return t._value;if(t.args.length<2)throw new Error("not enough arguments");if(t.args.length>4)throw new Error("too many arguments");const i=t.args.map(t=>e.evaluate(t));let s;switch(i.forEach((e,t)=>{if("number"!=typeof e)throw new Error(`expected vector component at index ${t} to have type "number"`)}),i.length){case 2:s=(new n.Vector2).fromArray(i);break;case 3:s=(new n.Vector3).fromArray(i);break;case 4:s=(new n.Vector4).fromArray(i);break;default:throw new Error("too many arguments")}return t.args.every(e=>e instanceof r.NumberLiteralExpr)&&(t._value=s),s}},vector2:{call:(e,t)=>s(e,t,"vector2")},vector3:{call:(e,t)=>s(e,t,"vector3")},vector4:{call:(e,t)=>s(e,t,"vector4")},"to-vector2":{call:(e,t)=>o(e,t,"vector2")},"to-vector3":{call:(e,t)=>o(e,t,"vector3")},"to-vector4":{call:(e,t)=>o(e,t,"vector4")}};t.VectorOperators=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprInstantiator=void 0;const n=i(44),r=i(6),s=new n.Env;t.ExprInstantiator=class{visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=t.env.lookup(e.name);return r.LiteralExpr.fromValue(void 0!==i?i:null)}visitHasAttributeExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=void 0!==t.env.lookup(e.name);return r.LiteralExpr.fromValue(i)}visitCallExpr(e,t){const i=e.args.map(e=>e.accept(this,t));return i.some((t,i)=>t!==e.args[i])?new r.CallExpr(e.op,i):e}visitMatchExpr(e,t){const i=e.value.accept(this,t);if(i instanceof r.LiteralExpr){const n=i.value;for(const[i,r]of e.branches){if(Array.isArray(i)&&i.includes(n))return r.accept(this,t);if(i===n)return r.accept(this,t)}return e.fallback.accept(this,t)}let n=e.value!==i;const s=e.branches.map(([e,i])=>{const r=i.accept(this,t);return r!==i&&(n=!0),[e,r]}),o=e.fallback.accept(this,t);return o!==e.fallback&&(n=!0),n?new r.MatchExpr(i,s,o):e}visitCaseExpr(e,t){const i=[];let n=!1;for(const[o,a]of e.branches){const e=o.accept(this,t),l=e.dependencies();if(o.isDynamic()||0!==l.properties.size)e!==o&&(n=!0),i.push([e,a]);else if(Boolean(e.evaluate(s,r.ExprScope.Condition)))return a.accept(this,t)}if(0===i.length)return e.fallback.accept(this,t);i.length!==e.branches.length&&(n=!0),i.forEach(e=>{const i=e[1].accept(this,t);i!==e[1]&&(n=!0),e[1]=i});const o=e.fallback.accept(this,t);return o!==e.fallback&&(n=!0),n?new r.CaseExpr(i,o):e}visitStepExpr(e,t){const i=e.input.accept(this,t),n=e.defaultValue.accept(this,t),s=e.stops.map(([e,i])=>[e,i.accept(this,t)]);return new r.StepExpr(i,n,s)}visitInterpolateExpr(e,t){const i=e.input.accept(this,t),n=e.stops.map(([e,i])=>[e,i.accept(this,t)]);return new r.InterpolateExpr(e.mode,i,n)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprParser=void 0;const n=i(6);var r,s;function o(e){switch(e){case r.Tab:case r.Lf:case r.Cr:case r.Space:return!0;default:return!1}}function a(e){return e>=r._0&&e<=r._9}function l(e){return e>=r.a&&e<=r.z||e>=r.A&&e<=r.Z}function c(e){return function(e){return l(e)||a(e)}(e)||e===r._||e===r.Dollar||e===r.Dot||e===r.LBracket||e===r.RBracket}function h(e){switch(e){case s.Eof:return"eof";case s.Error:return"error";case s.Identifier:return"identifier";case s.Number:return"number";case s.String:return"string";case s.Comma:return",";case s.LParen:return"(";case s.RParen:return")";case s.LBracket:return"[";case s.RBracket:return"]";case s.Exclaim:return"!";case s.TildeEqual:return"~=";case s.CaretEqual:return"^=";case s.DollarEqual:return"$=";case s.EqualEqual:return"==";case s.ExclaimEqual:return"!=";case s.Less:return"<";case s.Greater:return">";case s.LessEqual:return"<=";case s.GreaterEqual:return">=";case s.BarBar:return"||";case s.AmpAmp:return"&&";default:throw new Error("invalid token "+e)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(r||(r={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(s||(s={}));class u{constructor(e){this.code=e,this.m_token=s.Error,this.m_index=0,this.m_char=r.Lf}token(){return this.m_token}text(){var e;return null!==(e=this.m_text)&&void 0!==e?e:""}next(){if(this.m_token=this.yylex(),this.m_token===s.Error)throw new Error("unexpected character "+this.m_char);return this.m_token}yyinp(){var e;this.m_char=null!==(e=this.code.codePointAt(this.m_index++))&&void 0!==e?e:0}yylex(){for(this.m_text=void 0;o(this.m_char);)this.yyinp();if(0===this.m_char)return s.Eof;const e=this.m_char;switch(this.yyinp(),e){case r.LParen:return s.LParen;case r.RParen:return s.RParen;case r.LBracket:return s.LBracket;case r.RBracket:return s.RBracket;case r.Comma:return s.Comma;case r.SingleQuote:case r.DoubleQuote:{const t=this.m_index-1;for(;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),s.String}case r.Exclaim:return this.m_char===r.Equal?(this.yyinp(),s.ExclaimEqual):s.Exclaim;case r.Caret:return this.m_char===r.Equal?(this.yyinp(),s.CaretEqual):s.Error;case r.Tilde:return this.m_char===r.Equal?(this.yyinp(),s.TildeEqual):s.Error;case r.Equal:return this.m_char===r.Equal?(this.yyinp(),s.EqualEqual):s.Error;case r.Less:return this.m_char===r.Equal?(this.yyinp(),s.LessEqual):s.Less;case r.Greater:return this.m_char===r.Equal?(this.yyinp(),s.GreaterEqual):s.Greater;case r.Bar:return this.m_char===r.Bar?(this.yyinp(),s.BarBar):s.Error;case r.Amp:return this.m_char===r.Amp?(this.yyinp(),s.AmpAmp):s.Error;default:{const t=this.m_index-2;if(l(e)||e===r._||e===r.Dollar&&c(this.m_char)){for(;c(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),s.Identifier}if(a(e)){for(;a(this.m_char);)this.yyinp();if(this.m_char===r.Dot)for(this.yyinp();a(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),s.Number}if(e===r.Dollar)return this.m_char===r.Equal?(this.yyinp(),s.DollarEqual):s.Error}}return s.Error}}function d(e){switch(e){case s.TildeEqual:return"~=";case s.CaretEqual:return"^=";case s.DollarEqual:return"$=";case s.EqualEqual:return"==";case s.ExclaimEqual:return"!=";default:return}}function m(e){switch(e){case s.Less:return"<";case s.Greater:return">";case s.LessEqual:return"<=";case s.GreaterEqual:return">=";default:return}}t.ExprParser=class{constructor(e){this.lex=new u(e),this.lex.next()}parse(){return this.parseLogicalOr()}yyexpect(e){if(this.lex.token()!==e)throw new Error(`Syntax error: Expected token '${h(e)}' but found '${h(this.lex.token())}'`);this.lex.next()}parsePrimary(){switch(this.lex.token()){case s.Identifier:{const e=this.lex.text();switch(e){case"has":this.lex.next(),this.yyexpect(s.LParen);const t=this.lex.text();return this.yyexpect(s.Identifier),this.yyexpect(s.RParen),new n.HasAttributeExpr(t);case"length":this.lex.next(),this.yyexpect(s.LParen);const i=this.parseLogicalOr();return this.yyexpect(s.RParen),new n.CallExpr("length",[i]);default:const r=new n.VarExpr(e);return this.lex.next(),r}}case s.LParen:{this.lex.next();const e=this.parseLogicalOr();return this.yyexpect(s.RParen),e}default:return this.parseLiteral()}}parseLiteral(){switch(this.lex.token()){case s.Number:{const e=new n.NumberLiteralExpr(parseFloat(this.lex.text()));return this.lex.next(),e}case s.String:{const e=new n.StringLiteralExpr(this.lex.text());return this.lex.next(),e}default:throw new Error("Syntax error")}}parseUnary(){return this.lex.token()===s.Exclaim?(this.lex.next(),new n.CallExpr("!",[this.parseUnary()])):this.parsePrimary()}parseRelational(){let e=this.parseUnary();for(;;)if(this.lex.token()===s.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(s.LBracket);const t=[this.parseLiteral()];for(;this.lex.token()===s.Comma;)this.lex.next(),t.push(this.parseLiteral());this.yyexpect(s.RBracket),e=new n.CallExpr("in",[e,n.LiteralExpr.fromValue(t.map(({value:e})=>e))])}else{const t=m(this.lex.token());if(void 0===t)break;this.lex.next();const i=this.parseUnary();e=new n.CallExpr(t,[e,i])}return e}parseEquality(){let e=this.parseRelational();for(;;){let t=d(this.lex.token());if(void 0===t)break;"~="===t&&(t="in"),this.lex.next();const i=this.parseRelational();e=new n.CallExpr(t,[e,i])}return e}parseLogicalAnd(){const e=this.parseEquality();if(this.lex.token()!==s.AmpAmp)return e;const t=[e];do{this.lex.next(),t.push(this.parseEquality())}while(this.lex.token()===s.AmpAmp);return new n.CallExpr("all",t)}parseLogicalOr(){const e=this.parseLogicalAnd();if(this.lex.token()!==s.BarBar)return e;const t=[e];do{this.lex.next(),t.push(this.parseLogicalAnd())}while(this.lex.token()===s.BarBar);return new n.CallExpr("any",t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerServiceProtocol=void 0,function(e){let t,i;e.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.Initialized="initialized",e.Request="request",e.Response="response"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService="create-service",e.DestroyService="destroy-service"}(i=e.Requests||(e.Requests={})),e.isUnknownServiceError=function(e){return e.message.includes("unknown targetServiceType requested: ")},e.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerTilerProtocol=void 0,function(e){let t;!function(e){e.RegisterIndex="register-index",e.UpdateIndex="update-index",e.TileRequest="tile-request"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.RegisterIndex},e.isUpdateIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.UpdateIndex},e.isTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerDecoderProtocol=t.RequestController=void 0;t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,i;!function(e){e.Configuration="configuration"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(i=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeVisitor=void 0;const n=i(6);t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=t=>!n.isJsonExpr(t)&&!!e(t);if(void 0!==this.theme.styles)for(const e in this.theme.styles)if(void 0!==this.theme.styles[e])for(const i of this.theme.styles[e])if(t(i))return!0;return!1}}},function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.CirclePointsMaterial=void 0;const r=i(0),s=i(10),o=i(11);class a extends s.RawShaderMaterial{constructor(e){const t=new r.Color;let i,s,l,c;if(e){const{size:o,color:h,opacity:u}=e,d=n(e,["size","color","opacity"]);i=o,s=h,l=u,d.name="CirclePointsMaterial",d.vertexShader="\nuniform float size;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nattribute vec3 position;\n\nvoid main() {\n    vec3 transformed = vec3(position);\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n    gl_PointSize = size;\n}\n",d.fragmentShader="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\nvoid main() {\n    float alpha = opacity;\n\n    float radius = 0.5;\n    vec2 coords = gl_PointCoord.xy - vec2(0.5);\n    float len = length(coords);\n    float falloff = fwidth(len);\n    float threshold = 1.0 - smoothstep(radius - falloff, radius, len);\n    alpha *= threshold;\n\n    gl_FragColor = vec4(diffuse, alpha);\n}",d.uniforms=r.UniformsUtils.merge([{size:new r.Uniform(a.DEFAULT_CIRCLE_SIZE),diffuse:new r.Uniform(t),opacity:new r.Uniform(1)},r.UniformsLib.fog]),d.depthTest=!1,d.extensions=Object.assign(Object.assign({},d.extensions),{derivatives:!0}),c=d}super(c),o.enforceBlending(this),this.type="CirclePointsMaterial",this.setOpacity(1),void 0!==i&&(this.size=i),void 0!==s&&(this.color=s),void 0!==l&&this.setOpacity(l)}get size(){return this.uniforms.size.value}set size(e){this.uniforms.size.value=e}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}}t.CirclePointsMaterial=a,a.DEFAULT_CIRCLE_SIZE=1},function(e,t,i){"use strict";function n(e){return"displacementMap"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.setDisplacementMapToMaterial=t.hasDisplacementFeature=void 0,t.hasDisplacementFeature=n,t.setDisplacementMapToMaterial=function(e,t){n(t)&&t.displacementMap!==e&&(t.displacementMap=e,t.needsUpdate=!0,null!==t.displacementMap&&(t.displacementMap.needsUpdate=!0))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeMaterial=void 0;const n=i(0),r=i(64),s=i(31),o=i(10),a=i(11);class l extends o.RawShaderMaterial{constructor(e){var t;let i;if(e){const o={},c=void 0!==e.extrusionRatio&&e.extrusionRatio>=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN&&e.extrusionRatio<s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX;e.displacementMap&&a.setShaderDefine(o,"USE_DISPLACEMENTMAP",!0),c&&a.setShaderDefine(o,"USE_EXTRUSION",!0),!0===e.vertexColors&&a.setShaderDefine(o,"USE_COLOR",!0),i={name:"EdgeMaterial",vertexShader:"\n#define EDGE_DEPTH_OFFSET 0.0001\n\n#ifdef USE_COLOR\nattribute vec4 color;\n#else\nuniform vec3 color;\n#endif\n\n// SHADER_NAME may be defined by THREE.JS own shaders in which case these attributes & uniforms are\n// already defined\n#ifndef SHADER_NAME\nattribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\n#endif\n\nuniform vec3 edgeColor;\nuniform float edgeColorMix;\n\n#ifdef USE_DISPLACEMENTMAP\nattribute vec3 normal;\nattribute vec2 uv;\nuniform sampler2D displacementMap;\n#endif\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_vertex>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\nvoid main() {\n\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\n\n    vec3 transformed = vec3( position );\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_vertex>\n    #endif\n\n    #ifdef USE_DISPLACEMENTMAP\n    transformed += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n    gl_Position = projectionMatrix * mvPosition;\n    // After projection gl_Position contains clip space coordinates of each vertex\n    // before perspective division (1 / w), thus only vertexes with -w < z < w should\n    // be displayed and offset. We offset only those edges which z coordinate in NDC\n    // space is between: -inf < z < 1\n    float depthOffset = step(-1.0, -gl_Position.z / gl_Position.w) * EDGE_DEPTH_OFFSET;\n    gl_Position.z -= depthOffset;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\nvoid main() {\n    float alphaValue = 1.0;\n    gl_FragColor = vec4(vColor, alphaValue);\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}",uniforms:{color:new n.Uniform(new n.Color(l.DEFAULT_COLOR)),edgeColor:new n.Uniform(new n.Color(l.DEFAULT_COLOR)),edgeColorMix:new n.Uniform(l.DEFAULT_COLOR_MIX),fadeNear:new n.Uniform(r.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new n.Uniform(r.FadingFeature.DEFAULT_FADE_FAR),extrusionRatio:new n.Uniform(s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),displacementMap:new n.Uniform(null!==(t=e.displacementMap)&&void 0!==t?t:new n.Texture)},depthWrite:!1,defines:o,rendererCapabilities:e.rendererCapabilities}}super(i),a.enforceBlending(this),r.FadingFeature.patchGlobalShaderChunks(),r.ExtrusionFeature.patchGlobalShaderChunks(),void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.colorMix&&(this.colorMix=e.colorMix),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.extrusionRatio&&(this.extrusionRatio=e.extrusionRatio))}get objectColor(){return this.uniforms.color.value}set objectColor(e){this.uniforms.color.value.copy(e)}get color(){return this.uniforms.edgeColor.value}set color(e){this.uniforms.edgeColor.value.copy(e)}get lineWidth(){return this.linewidth}set lineWidth(e){this.linewidth=e,this.linewidth<=0?this.visible=!1:this.visible=!0}get colorMix(){return this.uniforms.edgeColorMix.value}set colorMix(e){this.uniforms.edgeColorMix.value!==e&&(this.uniforms.edgeColorMix.value=e)}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value!==e&&(this.uniforms.fadeFar.value=e,a.setShaderMaterialDefine(this,"USE_FADING",e>0))}get extrusionRatio(){return this.uniforms.extrusionRatio.value}set extrusionRatio(e){if(this.uniforms.extrusionRatio.value===e)return;this.uniforms.extrusionRatio.value=e;const t=e>=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN;a.setShaderMaterialDefine(this,"USE_EXTRUSION",t)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),a.setShaderMaterialDefine(this,"USE_DISPLACEMENTMAP",t)}}t.EdgeMaterial=l,l.DEFAULT_COLOR=0,l.DEFAULT_COLOR_MIX=0},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(31),r=n.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT*n.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT;t.default={extrusion_pars_vertex:"\n// Add define so we can check for it in the outline effect (see Outline.ts).\n#define HAS_EXTRUSION_PARS_VERTEX\n// Extrusion axis (xyz: vector, w: factor).\nattribute vec4 extrusionAxis;\nuniform float extrusionRatio;\n#ifdef FLAT_SHADED\nvarying vec4 vExtrusionAxis;\n#endif\n#ifdef ZFIGHTING_WORKAROUND\nvarying float vExtrusionRatio;\n#endif\n",extrusion_vertex:`\n#define HAS_EXTRUSION_VERTEX\n#ifdef ZFIGHTING_WORKAROUND\n// Cancel extrusionRatio (meaning, force to 1) if extrusionAxisLen < MIN_BUILDING_HEIGHT.\nconst float MIN_BUILDING_HEIGHT_SQUARED = ${r};\nfloat extrusionAxisLenSquared = dot(extrusionAxis.xyz, extrusionAxis.xyz);\nvExtrusionRatio = (extrusionAxisLenSquared < MIN_BUILDING_HEIGHT_SQUARED) ? 1.0 : extrusionRatio;\n#else\nfloat vExtrusionRatio = extrusionRatio;\n#endif\ntransformed = transformed + extrusionAxis.xyz * (vExtrusionRatio - 1.0);\n#ifdef FLAT_SHADED\nvExtrusionAxis = vec4(normalMatrix * extrusionAxis.xyz, extrusionAxis.w);\n#endif\n`,extrusion_normal_fragment_begin:"\n#ifdef FLAT_SHADED\n    // Flattened this divergent path to prevent undefined behaviour in the following derivatives\n    // functions. For more info:\n    // http://www.aclockworkberry.com/shader-derivative-functions/#Derivatives_and_branches\n\n    // Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n    vec3 fdx = vec3(dFdx(vViewPosition.x), dFdx(vViewPosition.y), dFdx(vViewPosition.z));\n    vec3 fdy = vec3(dFdy(vViewPosition.x), dFdy(vViewPosition.y), dFdy(vViewPosition.z));\n    vec3 normal = cross( fdx, fdy );\n    if (vExtrusionAxis.w > 0.999999) {\n        normal = vExtrusionAxis.xyz;\n    }\n    normal = normalize(normal);\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\tbitangent = bitangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t#endif\n\t#endif\n#endif\n// non perturbed normal for clearcoat among others\nvec3 geometryNormal = normal;\n",extrusion_pars_fragment:"\n#ifdef ZFIGHTING_WORKAROUND\nvarying float vExtrusionRatio;\n#else\nuniform float extrusionRatio;\n#endif\nvarying vec4 vExtrusionAxis;\n",extrusion_fragment:"\n#ifndef ZFIGHTING_WORKAROUND\nfloat vExtrusionRatio = extrusionRatio;\n#endif\ngl_FragColor.a *= smoothstep( 0.0, 0.25, vExtrusionRatio );\n"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={fading_pars_vertex:"\nvarying float fadingDepth;\n",fading_vertex:"\nfadingDepth = -mvPosition.z;\n",fading_pars_fragment:"\nvarying float fadingDepth;\nuniform float fadeNear;\nuniform float fadeFar;\n",fading_fragment:'\n\n// lerp with "hard" edges\n//float fadingFactor = 1.0 - clamp((fadingDepth - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\n\n// smooth transitions\nfloat fadingFactor = smoothstep( fadeNear, fadeFar, fadingDepth );\n\ngl_FragColor.a *= 1.0 - fadingFactor;\n\n// debugging color:\n// gl_FragColor = vec4(1., fadingFactor, fadingFactor, 1.0);\n'}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simpleLightingShadowChunk=void 0,t.simpleLightingShadowChunk="\n    struct PhysicalMaterial {\n        vec3\tdiffuseColor;\n        float\tspecularRoughness;\n        vec3\tspecularColor;\n    };\n\n    #define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n    void RE_Direct_Physical( const in IncidentLight directLight,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight ) {\n        // directLight.color is the light color * shadow, internally three.js uses a step function, so\n        // this value is either the light color or black. in order to lighten up the shadows, we\n        // take add 50% of the color to grey (to give us either pure white or grey) and multiply this to\n        // the material's diffuse color.\n        #if defined(USE_SHADOWMAP)\n            reflectedLight.directDiffuse = (0.5 * directLight.color +\n                vec3(0.5,0.5,0.5)) * material.diffuseColor;\n        #else\n            reflectedLight.directDiffuse = material.diffuseColor;\n        #endif\n    }\n\n    void RE_IndirectDiffuse_Physical( const in vec3 irradiance,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight ) {\n            // Disable influence of indirect light (it is handled in the RE_Direct_Physical function)\n    }\n\n    void RE_IndirectSpecular_Physical( const in vec3 radiance,\n        const in vec3 irradiance,\n        const in vec3 clearcoatRadiance,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight) {\n            // Disable specular reflection of light.\n    }\n\n    #define RE_Direct               RE_Direct_Physical\n    #define RE_IndirectDiffuse      RE_IndirectDiffuse_Physical\n    #define RE_IndirectSpecular     RE_IndirectSpecular_Physical\n"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroundAtmosphereMaterial=t.GroundAtmosphereShader=void 0;const n=i(0),r=i(10),s=i(111),o=i(11);t.GroundAtmosphereShader={uniforms:{u_eyePositionWorld:new n.Uniform(new n.Vector3),u_lightDirectionWorld:new n.Uniform(new n.Vector3(0,1,0)),u_modelViewProjection:new n.Uniform(new n.Matrix4),u_atmosphereEnv:new n.Uniform(new n.Vector3(6378137*1.001,6537590.425,0)),u_hsvCorrection:new n.Uniform(new n.Vector3(0,0,0)),topColor:new n.Uniform(new n.Color(30719)),bottomColor:new n.Uniform(new n.Color(16777215)),offset:new n.Uniform(33),exponent:new n.Uniform(.6),fogColor:new n.Uniform(new n.Color(30719)),fogNear:new n.Uniform(new n.Color(30719)),fogFar:new n.Uniform(new n.Color(16777215))},vertexShader:`\n\n    #define IMPROVE_INTERSECT_PRECISION 1\n    #define IMPROVE_DOT_PRECISION 1\n\n    precision highp float;\n    precision highp int;\n\n    attribute vec4 position;\n\n    // Base mandatory uniforms\n    uniform mat4 u_modelViewProjection;\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_hsvCorrection;\n\n    const float Pi = 3.141592653589793;\n    const float Kr = 0.0025;\n    const float Km = 0.0015;\n    const float Kr4PI = Kr * 4.0 * Pi;\n    const float Km4PI = Km * 4.0 * Pi;\n    const float ESun = 25.0; // should be 15.0\n    const float KmESun = Km * ESun;\n    const float KrESun = Kr * ESun;\n    const vec3 InvWavelength = vec3(\n        1.0 / pow(0.650, 4.0), // Red\n        1.0 / pow(0.570, 4.0), // Green\n        1.0 / pow(0.475, 4.0)); // Blue\n\n    const int nSamples = 2;\n    const float fSamples = 2.0;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n    varying vec3 v_vertToOrigin;\n\n    ${s.default.atmosphere_vertex_utils}\n\n    //\n    // Computes rayleight and mia atmosphere factors for ground.\n    //\n    // Code based on GPU Gems article.\n    //\n    // Author: Sean O'Neil\n    //\n    // Copyright (c) 2004 Sean O'Neil\n    //\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\n    //\n    // Further modifications by HERE.\n    //\n    AtmosphereColor computeGroundAtmosphere(vec3 v3Pos, vec3 vLightDir)\n    {\n        // Retrieve environment variables\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        // All that may be moved to const or define(s) at further optimizations:\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n        float fScaleOverScaleDepth = fScale / RayleighScaleDepth;\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\n        float fFar = length(v3Ray);\n        v3Ray /= fFar;\n\n#if !defined(IMPROVE_DOT_PRECISION)\n        vec3 v3Dir = normalize(v3Pos);\n#endif\n\n#ifdef CAMERA_IN_SPACE\n\n        // Calculate first point of camera ray and sphere intersection.\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\n        // Make far relative to first atmosphere intersection, setting it to\n        // the length of ray passed through atmosphere\n        fFar -= fNear;\n\n        // Compute the ray's starting position within the atmosphere, then\n        // calculate its scattering offset\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\n        float fDepth = exp((fInnerRadius - fOuterRadius) / RayleighScaleDepth);\n\n#else // CAMERA_IN_ATMOSPHERE\n\n        // The ray starts already in atmosphere\n        vec3 v3Start = u_eyePositionWorld;\n        // Virtually fNear is just at eye position, so ray passing through atmosphere does not shorten\n        // fFar -= 0.0;\n        float fDepth = exp((fInnerRadius - fCameraHeight) / RayleighScaleDepth);\n#endif\n\n#if defined(IMPROVE_DOT_PRECISION)\n        float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n#else\n        float fCameraAngle = dot(-v3Ray, v3Dir);\n#endif\n        float fCameraScale = scale(fCameraAngle);\n\n#ifdef DYNAMIC_LIGHT\n        // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\n        #if defined(IMPROVE_DOT_PRECISION)\n            // The light angle for given light source may be calculated as:\n            // angle = dot(vLightDir, v3Dir) / length(v3Dir);\n            // where v3Dir holds normalized vertex position, but for precision issues we v3Pos (un-normalized)\n            float fLightAngle = dot(vLightDir, v3Pos) / length(v3Pos);\n        #else\n            float fLightAngle = dot(vLightDir, v3Dir);\n        #endif\n#else\n        float fLightAngle = 1.0;\n#endif\n        float fLightScale = scale(fLightAngle);\n\n        float fCameraOffset = fDepth * fCameraScale;\n        float fTemp = (fLightScale + fCameraScale);\n\n        // Initialize the scattering loop variables\n        float fSampleLength = fFar / fSamples;\n        float fScaledLength = fSampleLength * fScale;\n        vec3 v3SampleRay = v3Ray * fSampleLength;\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n        // Now loop through the sample rays\n        vec3 v3BaseColor = vec3(0.0);\n        vec3 v3Attenuate = vec3(0.0);\n        for(int i = 0; i < nSamples; i++)\n        {\n            float fHeight = length(v3SamplePoint);\n            float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n            float fScatter = fDepth * fTemp - fCameraOffset;\n            // Compute color factors\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n            v3BaseColor += v3Attenuate * (fDepth * fScaledLength);\n            // Move to the next point\n            v3SamplePoint += v3SampleRay;\n        }\n\n        AtmosphereColor color;\n        color.mie = v3BaseColor * (InvWavelength * KrESun + KmESun);\n        // Calculate the attenuation factor for the ground\n        color.rayleigh = v3Attenuate;\n\n        return color;\n    }\n\n    void main(void)\n    {\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        AtmosphereColor atmColor = computeGroundAtmosphere(position.xyz, vLightDir);\n        v_mieColor = atmColor.mie;\n        v_rayleighColor = atmColor.rayleigh;\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\n        v_vertToOrigin = normalize(position.xyz);\n\n        gl_Position = u_modelViewProjection * position;\n    }\n    `,fragmentShader:`\n\n    // Exposure correction gives more subtle gradients on the ground.\n    #define CORRECT_EXPOSURE 1\n    #define FADE_DEPTH 1\n    #define NIGHT_LOCAL 1\n\n    precision highp float;\n    precision highp int;\n\n    #ifdef CORRECT_COLOR\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\n    #endif\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    const float g = -0.95;\n    const float g2 = g * g;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n    varying vec3 v_vertToOrigin;\n\n    ${s.default.atmosphere_fragment_utils}\n\n    void main(void)\n    {\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        // GPU gems mix of ground solution, with custom alpha settings\n        vec3 cRgb = v_mieColor + 0.25 * v_rayleighColor;\n\n        // Not needed for HDR frame buffer\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\n        // Interesting results with exposure factor: 2.0, 3.5, 4.0\n        cRgb = correctExposure(cRgb, 3.0);\n    #endif\n\n    #ifdef CORRECT_COLOR\n        cRgb = correctColor(cRgb, u_hsvCorrection);\n    #endif\n\n        // Base atmosphere opacity\n        float fAtmosphereAlpha = 1.0;\n\n        // Factor based on the distance of camera atmosphere and ground, results are:\n        // 0.0 = camera on the ground surface,\n        // 1.0 = at the outer edge of the atmosphere.\n        float fDepthFactor = clamp((fCameraHeight - fInnerRadius) /\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\n    #ifdef FADE_DEPTH\n        // Fade alpha based on the distance of camera between atmosphere layers\n        #ifdef FADE_DEPTH_LINEAR\n            fAtmosphereAlpha *= fDepthFactor;\n        #else\n            fAtmosphereAlpha *= pow(fDepthFactor, 1.5);\n        #endif\n    #endif\n\n#if defined(FADE_NIGHT) || defined(DARKEN_NIGHT)\n    #ifdef DYNAMIC_LIGHT\n        // Adjust factor based on time of day, results are:\n        // 0.0 = night,\n        // 1.0 = day.\n        #ifdef NIGHT_GLOBAL\n            // Global night fade based on camera and light orientation\n            float fNightFactor = clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0);\n            fNightFactor = pow(fNightFactor, 0.5);\n        #else // NIGHT_LOCAL\n            float fNightFactor =\n                clamp(dot(v_vertToOrigin, vLightDir) / length(v_vertToOrigin), 0.0, 1.0);\n            fNightFactor = pow(fNightFactor, 0.8);\n        #endif\n    #else\n        float fNightFactor = 1.0;\n    #endif\n#endif\n\n    #ifdef FADE_NIGHT\n        // Adjust alpha for night side of the globe\n        fAtmosphereAlpha *= fNightFactor;\n    #endif\n\n    #ifdef DARKEN_NIGHT\n        // Change the brightness depending on night / day side.\n        // NOTE: Darkening should be rather applied in HSV space, without loss on saturation,\n        // but it is much more GPU consuming.\n        const float minBrightness = 0.5;\n        float fDarkenFactor = clamp(fNightFactor, minBrightness, 1.0);\n        cRgb *= fDarkenFactor;\n    #endif\n\n    #ifdef EXPOSURE_DEPTH\n        // Control exposure depending from ground distance\n        float exposureBoost = 3.0 - fDepthFactor;\n        cRgb = correctExposure(cRgb, exposureBoost);\n    #endif\n\n        // Experimental fading out of focus point - similar to fresnel effect in top view.\n        // This fade is handy to better expose cartographic/map features in screen center.\n        float fFocusFactor = 1.0 - clamp(dot(normalize(v_vertToCamera), v_vertToOrigin), 0.0, 1.0) + 0.1;\n        fFocusFactor = pow(fFocusFactor, 2.5);\n        fAtmosphereAlpha *= fFocusFactor;\n\n        // Integrate all features\n        gl_FragColor = vec4(cRgb, fAtmosphereAlpha);\n    }\n    `};class a extends r.RawShaderMaterial{constructor(e){let i;if(e){i={name:"GroundAtmosphereMaterial",vertexShader:t.GroundAtmosphereShader.vertexShader,fragmentShader:t.GroundAtmosphereShader.fragmentShader,uniforms:t.GroundAtmosphereShader.uniforms,transparent:!0,depthTest:!1,depthWrite:!1,side:n.FrontSide,blending:n.NormalBlending,fog:!1,rendererCapabilities:e.rendererCapabilities}}super(i)}setDynamicLighting(e){o.setShaderMaterialDefine(this,"DYNAMIC_LIGHT",e)}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,i,n){const r=this.getCameraInfo(t,i);if(void 0===e||!e.isMaterial)throw Error("Wrong object used, only Material objects are supported");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error("Atmosphere material has missing uniforms");{const t=r.eyePos,i=r.modelViewProjection,s=r.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(i),e.uniforms.u_atmosphereEnv.value.z=s,e.uniforms.u_lightDirectionWorld.value=n.clone();const a=s>this.outerRadius,l=o.setShaderDefine(e.defines,"CAMERA_IN_SPACE",a),c=o.setShaderDefine(e.defines,"CAMERA_IN_ATMOSPHERE",!a);e.needsUpdate=e.needsUpdate||l||c}}getCameraInfo(e,t,i=!1){if(i){const i=(new n.Matrix4).identity(),r=(new n.Matrix4).copy(e.matrixWorld).invert().transpose(),s=t.projectionMatrix,o=new n.Matrix4;o.multiplyMatrices(r,i),o.multiplyMatrices(s,o);const a=new n.Vector3;e.getWorldPosition(a);const l=new n.Vector3;t.getWorldPosition(l);return{modelViewProjection:o,eyePos:a,eyeHeight:l.distanceTo(a)}}{const i=e.matrixWorld,r=t.matrixWorldInverse,s=t.projectionMatrix,o=new n.Matrix4;o.multiplyMatrices(r,i),o.multiplyMatrices(s,o);const a=new n.Vector3;t.getWorldPosition(a);const l=new n.Vector3;e.getWorldPosition(l);const c=l.distanceTo(a);return a.sub(l),{modelViewProjection:o,eyePos:a,eyeHeight:c}}}}t.GroundAtmosphereMaterial=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHighPrecisionLineMaterial=t.HighPrecisionLineMaterial=void 0;const n=i(0),r=i(10),s=i(65);class o extends r.RawShaderMaterial{constructor(e){Object.assign(n.ShaderChunk,s.default);const t=e?{name:"HighPrecisionLineMaterial",vertexShader:"\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 position;        // high part\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, opacity );\n    #else\n    gl_FragColor = vec4( diffuse, opacity );\n    #endif\n}",uniforms:{diffuse:new n.Uniform(new n.Color(o.DEFAULT_COLOR)),opacity:new n.Uniform(o.DEFAULT_OPACITY),u_mvp:new n.Uniform(new n.Matrix4),u_eyepos:new n.Uniform(new n.Vector3),u_eyepos_lowpart:new n.Uniform(new n.Vector3)},rendererCapabilities:e.rendererCapabilities}:void 0;Object.assign(t,e),super(t),this.type="HighPrecisionLineMaterial",this.isHighPrecisionLineMaterial=!0,e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity)),this.updateTransparencyFeature()}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}updateTransparencyFeature(){this.transparent=this.opacity<1}}t.HighPrecisionLineMaterial=o,o.DEFAULT_COLOR=80,o.DEFAULT_OPACITY=1,t.isHighPrecisionLineMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionLineMaterial}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHighPrecisionPointMaterial=t.HighPrecisionPointMaterial=void 0;const n=i(0),r=i(65);class s extends n.PointsMaterial{constructor(e){Object.assign(n.ShaderChunk,r.default);super(e),this.type="HighPrecisionPointMaterial",this.vertexShader="\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}",this.fragmentShader=n.ShaderChunk.points_frag,this.fog=!1,this.uniforms={diffuse:new n.Uniform(new n.Color(s.DEFAULT_COLOR)),opacity:new n.Uniform(s.DEFAULT_OPACITY),size:new n.Uniform(s.DEFAULT_SIZE),scale:new n.Uniform(s.DEFAULT_SCALE),map:new n.Uniform(new n.Texture),uvTransform:new n.Uniform(new n.Matrix3),u_mvp:new n.Uniform(new n.Matrix4),u_eyepos:new n.Uniform(new n.Vector3),u_eyepos_lowpart:new n.Uniform(new n.Vector3)},this.isHighPrecisionPointMaterial=!0,void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity),void 0!==e.size&&(this.size=e.size),void 0!==e.scale&&(this.scale=e.scale),void 0!==e.uvTransform&&(this.uvTransform=e.uvTransform),void 0!==e.map&&(this.map=e.map))}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}get uvTransform(){return this.uniforms.uvTransform.value}set uvTransform(e){this.uniforms.uvTransform.value=e}}t.HighPrecisionPointMaterial=s,s.DEFAULT_COLOR=80,s.DEFAULT_OPACITY=1,s.DEFAULT_SIZE=1,s.DEFAULT_SCALE=1,t.isHighPrecisionPointMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionPointMaterial}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconMaterial=void 0;const n=i(0),r=i(10);class s extends r.RawShaderMaterial{constructor(e){super(e?{name:"IconMaterial",vertexShader:"\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D map;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 color = texture2D(map, vUv.xy);\n    color *= vColor;\n    if (color.a < 0.05) {\n        discard;\n    }\n    gl_FragColor = color;\n}",uniforms:{map:new n.Uniform(e.map)},depthTest:!1,depthWrite:!1,transparent:!0,vertexColors:!0,premultipliedAlpha:!0,rendererCapabilities:e.rendererCapabilities}:void 0)}get map(){return this.uniforms.map.value}}t.IconMaterial=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LuminosityHighPassShader=void 0;const n=i(0);t.LuminosityHighPassShader={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new n.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform vec3 defaultColor;\n    uniform float defaultOpacity;\n    uniform float luminosityThreshold;\n    uniform float smoothWidth;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        vec3 luma = vec3( 0.299, 0.587, 0.114 );\n        float v = dot( texel.xyz, luma );\n        vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n        float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n        gl_FragColor = mix( outputColor, texel, alpha );\n    }"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAAMaterial=void 0;const n=i(0),r=i(110);class s extends n.ShaderMaterial{constructor(e){super({uniforms:e,vertexShader:r.CopyShader.vertexShader,fragmentShader:r.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:n.AdditiveBlending,depthTest:!1,depthWrite:!1})}}t.MSAAMaterial=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SepiaShader=void 0,t.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float amount;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 color = texture2D( tDiffuse, vUv );\n            vec3 c = color.rgb;\n            color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n            color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n            color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n            gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n        }"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyAtmosphereMaterial=t.SkyAtmosphereShader=void 0;const n=i(0),r=i(10),s=i(111),o=i(11);t.SkyAtmosphereShader={uniforms:{u_eyePositionWorld:new n.Uniform(new n.Vector3),u_lightDirectionWorld:new n.Uniform(new n.Vector3(0,1,0)),u_modelViewProjection:new n.Uniform(new n.Matrix4),u_atmosphereEnv:new n.Uniform(new n.Vector3(6378137,6537590.425,0)),u_hsvCorrection:new n.Uniform(new n.Vector3(0,0,0)),topColor:new n.Uniform(new n.Color(30719)),bottomColor:new n.Uniform(new n.Color(16777215)),offset:new n.Uniform(33),exponent:new n.Uniform(.6),fogColor:new n.Uniform(new n.Color(30719)),fogNear:new n.Uniform(new n.Color(30719)),fogFar:new n.Uniform(new n.Color(16777215))},vertexShader:`\n    precision highp float;\n    precision highp int;\n\n    attribute vec4 position;\n\n    uniform mat4 u_modelViewProjection;\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_hsvCorrection;\n\n    const float Pi = 3.141592653589793;\n    const float Kr = 0.0025;\n    const float Kr4PI = Kr * 4.0 * Pi;\n    const float Km = 0.0015;\n    const float Km4PI = Km * 4.0 * Pi;\n    const float ESun = 15.0; // should be 15.0\n    const float KmESun = Km * ESun;\n    const float KrESun = Kr * ESun;\n    const vec3 InvWavelength = vec3(\n        5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n        9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n        19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\n\n    const int nSamples = 2;\n    const float fSamples = 2.0;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n\n    ${s.default.atmosphere_vertex_utils}\n\n    //\n    // Computes rayleight and mia atmosphere factors for sky.\n    //\n    // Code based on GPU Gems article.\n    //\n    // Author: Sean O'Neil\n    //\n    // Copyright (c) 2004 Sean O'Neil\n    //\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\n    //\n    // Further modifications by HERE\n    //\n    AtmosphereColor computeSkyAtmosphere(vec3 v3Pos, vec3 vLightDir)\n    {\n        // Unpack attributes\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        // All that may be const or define(s) at further optimization:\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n        float fScaleOverScaleDepth = (fScale / RayleighScaleDepth);\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\n        float fFar = length(v3Ray);\n        v3Ray /= fFar;\n\n    #ifdef CAMERA_IN_SPACE\n\n        // Calculate the closest intersection of the ray with the outer\n        // atmosphere, this is the first point of the ray passing through the atmosphere dome.\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\n        // Make far relative to first atmosphere intersection\n        fFar -= fNear;\n\n        // Compute the ray's starting position within the atmosphere, then\n        // calculate its scattering offset\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\n\n        float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n        float fStartDepth = exp(-1.0 / RayleighScaleDepth );\n        float fStartOffset = fStartDepth * scale(fStartAngle);\n\n    #else // CAMERA_IN_ATMOSPHERE\n\n        // The ray starts already in atmosphere\n        vec3 v3Start = u_eyePositionWorld;\n        float height = length(v3Start);\n        float depth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n        float fStartAngle = dot(v3Ray, v3Start) / height;\n        float fStartOffset = depth * scale(fStartAngle);\n\n    #endif\n\n        // Initialize the scattering loop variables\n        float fSampleLength = fFar / fSamples;\n        float fScaledLength = fSampleLength * fScale;\n        vec3 v3SampleRay = v3Ray * fSampleLength;\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n        // Now loop through the sample rays\n        vec3 v3BaseColor = vec3(0.0);\n        vec3 v3Attenuate = vec3(0.0);\n        for(int i=0; i < nSamples; i++)\n        {\n            float height = length(v3SamplePoint);\n            float depth = exp(fScaleOverScaleDepth * (fInnerRadius - height));\n            float fLightAngle = dot(vLightDir, v3SamplePoint) / height;\n            float fCameraAngle = dot(v3Ray, v3SamplePoint) / height;\n            float fScatter = (fStartOffset + depth * (scale(fLightAngle) - scale(fCameraAngle)));\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n            v3BaseColor += v3Attenuate * (depth * fScaledLength);\n            v3SamplePoint += v3SampleRay;\n        }\n\n        // Scale the Mie and Rayleigh colors and set up output of the function\n        AtmosphereColor color;\n        color.mie = v3BaseColor * KmESun;\n        color.rayleigh = v3BaseColor * (InvWavelength * KrESun);\n        return color;\n    }\n\n    void main(void)\n    {\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        AtmosphereColor atmColor = computeSkyAtmosphere(position.xyz, vLightDir);\n        v_mieColor = atmColor.mie;\n        v_rayleighColor = atmColor.rayleigh;\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\n\n        gl_Position = u_modelViewProjection * position;\n    }\n    `,fragmentShader:`\n    // Because of harsh light distribution the exposure correction is always enabled for the sky.\n    #define CORRECT_EXPOSURE 1\n\n    precision highp float;\n    precision highp int;\n\n    #ifdef CORRECT_COLOR\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\n    #endif\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    const float g = -0.95;\n    const float g2 = g * g;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n\n    ${s.default.atmosphere_fragment_utils}\n\n    void main(void)\n    {\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n            // Alter alpha based on time of day (0.0 = night , 1.0 = day)\n            float fNightAlpha = clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0);\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n            float fNightAlpha = 1.0;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        // NOTE:\n        // For better precision normalization may be added on fragment (for mobile devices)\n        // while in vertex shader may be left un-normalized\n        // dot(vLightDir, normalize(v_vertToCamera)) / length(v_vertToCamera);\n        float fCosAngle = dot(vLightDir, v_vertToCamera) / length(v_vertToCamera);\n        float fRayleighPhase = 0.75 * (1.0 + fCosAngle * fCosAngle);\n        float fMiePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCosAngle * fCosAngle) / pow(1.0 + g2 - 2.0 * g * fCosAngle, 1.5);\n\n        vec3 cRgb = fRayleighPhase * v_rayleighColor + fMiePhase * v_mieColor;\n\n        // Sky produces very harsh lighting effect so exposure correction is always enabled.\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\n        // Exposure factor may be exposed to uniform variable.\n        cRgb = correctExposure(cRgb, 2.0);\n    #endif\n\n    #ifdef CORRECT_COLOR\n        cRgb = correctColor(cRgb, u_hsvCorrection);\n    #endif\n\n        // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\n        float fAtmosphereAlpha = clamp((fOuterRadius - fCameraHeight) /\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\n        fAtmosphereAlpha *= pow(fNightAlpha, 0.5);\n\n        gl_FragColor = vec4(cRgb, mix(cRgb.b, 1.0, fAtmosphereAlpha));\n    }\n    `};class a extends r.RawShaderMaterial{constructor(e){let i;if(e){i={name:"SkyAtmosphereMaterial",vertexShader:t.SkyAtmosphereShader.vertexShader,fragmentShader:t.SkyAtmosphereShader.fragmentShader,uniforms:t.SkyAtmosphereShader.uniforms,transparent:!0,depthTest:!0,depthWrite:!1,side:n.BackSide,blending:n.NormalBlending,fog:!1,rendererCapabilities:e.rendererCapabilities}}super(i)}setDynamicLighting(e){o.setShaderMaterialDefine(this,"DYNAMIC_LIGHT",e)}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,i,n){const r=this.getCameraInfo(t,i);if(void 0===e||!e.isMaterial)throw Error("Wrong object used, only Material objects are supported");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error("Atmosphere material has missing uniforms");{const t=r.eyePos,i=r.modelViewProjection,s=r.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(i),e.uniforms.u_atmosphereEnv.value.z=s,e.uniforms.u_lightDirectionWorld.value=n.clone();const a=s>this.outerRadius,l=o.setShaderDefine(e.defines,"CAMERA_IN_SPACE",a),c=o.setShaderDefine(e.defines,"CAMERA_IN_ATMOSPHERE",!a);e.needsUpdate=e.needsUpdate||l||c}}getCameraInfo(e,t,i=!1){if(i){const i=(new n.Matrix4).identity(),r=(new n.Matrix4).copy(e.matrixWorld).invert().transpose(),s=t.projectionMatrix,o=new n.Matrix4;o.multiplyMatrices(r,i),o.multiplyMatrices(s,o);const a=new n.Vector3;e.getWorldPosition(a);const l=new n.Vector3;t.getWorldPosition(l);return{modelViewProjection:o,eyePos:a,eyeHeight:l.distanceTo(a)}}{const i=e.matrixWorld,r=t.matrixWorldInverse,s=t.projectionMatrix,o=new n.Matrix4;o.multiplyMatrices(r,i),o.multiplyMatrices(s,o);const a=new n.Vector3;t.getWorldPosition(a);const l=new n.Vector3;e.getWorldPosition(l);const c=l.distanceTo(a);return a.sub(l),{modelViewProjection:o,eyePos:a,eyeHeight:c}}}}t.SkyAtmosphereMaterial=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLineMaterial=t.LineDashesModes=void 0;const n=i(0),r=i(64),s=i(10),o=i(65),a=i(11),l={None:o.LineCapsModes.CAPS_NONE,Square:o.LineCapsModes.CAPS_SQUARE,Round:o.LineCapsModes.CAPS_ROUND,TriangleIn:o.LineCapsModes.CAPS_TRIANGLE_IN,TriangleOut:o.LineCapsModes.CAPS_TRIANGLE_OUT},c=Object.keys(l).reduce((e,t)=>{const i=t;return e[l[i]]=i,e},{});var h;!function(e){e[e.DASHES_SQUARE=0]="DASHES_SQUARE",e[e.DASHES_ROUND=1]="DASHES_ROUND",e[e.DASHES_DIAMOND=2]="DASHES_DIAMOND"}(h=t.LineDashesModes||(t.LineDashesModes={}));const u={Square:h.DASHES_SQUARE,Round:h.DASHES_ROUND,Diamond:h.DASHES_DIAMOND},d=Object.keys(u).reduce((e,t)=>{const i=t;return e[u[i]]=i,e},{}),m=new n.Color,p=`\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform vec3 outlineColor;\nuniform float opacity;\nuniform float extrusionWidth;\nuniform float outlineWidth;\nuniform vec2 tileSize;\nuniform vec2 drawRange;\n\n#ifdef USE_DASHED_LINE\nuniform float dashSize;\nuniform float gapSize;\nuniform vec3 dashColor;\n\n#define DASHES_SQUARE ${h.DASHES_SQUARE}\n#define DASHES_ROUND ${h.DASHES_ROUND}\n#define DASHES_DIAMOND ${h.DASHES_DIAMOND}\n#endif\n\n#ifdef USE_TILE_CLIP\nvarying vec3 vPosition;\n#endif\n\nvarying vec3 vRange;\nvarying vec4 vCoords;\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\n#include <round_edges_and_add_caps>\n#include <tile_clip_func>\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\n#include <fog_pars_fragment>\n\nvoid main() {\n    float alpha = opacity;\n    vec3 outputDiffuse = diffuse;\n\n    #ifdef USE_TILE_CLIP\n    tileClip(vPosition.xy, tileSize);\n    #endif\n\n    // Calculate distance to center (0.0: lineCenter, 1.0: lineEdge).\n    float distToCenter = roundEdgesAndAddCaps(vCoords, vRange);\n    // Calculate distance to edge (-1.0: lineCenter, 0.0: lineEdge).\n    float distToEdge = distToCenter - (extrusionWidth + outlineWidth) / extrusionWidth;\n\n    // Decrease the line opacity by the distToEdge, making the transition steeper when the slope\n    // of distToChange increases (i.e. the line is further away).\n    float width = fwidth(distToEdge);\n\n    float s = opacity < 0.98\n        ? clamp((distToEdge + width) / (2.0 * width), 0.0, 1.0) // prefer a boxstep\n        : smoothstep(-width, width, distToEdge);\n\n    if (opacity < 0.98 && 1.0 - s < opacity) {\n        // drop the fragment when the line is using opacity.\n        discard;\n    }\n\n    alpha *= 1.0 - s;\n\n    #ifdef USE_DASHED_LINE\n    // Compute the distance to the dash origin (0.0: dashOrigin, 1.0: dashEnd, (d+g)/d: gapEnd).\n    float d = dashSize / vRange.x;\n    float g = gapSize / vRange.x;\n    float distToDashOrigin = mod(vCoords.x, d + g) / d;\n\n    // Compute distance to dash edge (0.5: dashCenter, 0.0: dashEdge) and compute the\n    // dashBlendFactor similarly on how we did it for the line opacity.\n    float distToDashEdge = 0.5 - distance(distToDashOrigin, (d + g) / d * 0.5);\n    #if DASHES_MODE == DASHES_ROUND\n    distToDashEdge = 0.5 - distance(vec2(distToCenter * 0.5, distToDashEdge), vec2(0.0, 0.5));\n    #elif DASHES_MODE == DASHES_DIAMOND\n    distToDashEdge -= distToCenter * 0.5;\n    #endif\n    float dashWidth = fwidth(distToDashEdge);\n    float dashBlendFactor = 1.0 - smoothstep(-dashWidth, dashWidth, distToDashEdge);\n\n    #ifdef USE_DASH_COLOR\n    outputDiffuse = mix(diffuse, dashColor, dashBlendFactor);\n    #endif\n    #endif\n\n    #ifdef USE_OUTLINE\n    // Calculate distance to outline (0.0: lineEdge, outlineWidth/lineWidth: outlineEdge) and\n    // compute the outlineBlendFactor (used to mix line and outline colors).\n    float distToOutline = distToCenter - 1.0;\n    float outlineWidth = fwidth(distToOutline);\n    float outlineBlendFactor = smoothstep(-outlineWidth, outlineWidth, distToOutline);\n\n    // Mix the colors using the different computed factors.\n    #if defined(USE_DASHED_LINE) && !defined(USE_DASH_COLOR)\n    float colorBlendFactor = smoothstep(-1.0, 1.0, dashBlendFactor - outlineBlendFactor);\n    outputDiffuse = mix(\n      mix(\n        mix(outlineColor, diffuse, colorBlendFactor),\n        outputDiffuse,\n        dashBlendFactor\n      ),\n      outlineColor,\n      outlineBlendFactor\n    );\n    #else\n    outputDiffuse = mix(outputDiffuse, outlineColor, outlineBlendFactor);\n    #endif\n    #endif\n\n    #if defined(USE_DASHED_LINE) && !defined(USE_DASH_COLOR)\n    // Multiply the alpha by the dashBlendFactor.\n    #if defined(USE_OUTLINE)\n    alpha *= clamp(dashBlendFactor + outlineBlendFactor, 0.0, 1.0);\n    #else\n    alpha *= 1.0 - dashBlendFactor;\n    #endif\n    #endif\n\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( outputDiffuse * vColor, alpha );\n    #else\n    gl_FragColor = vec4( outputDiffuse, alpha );\n    #endif\n\n    #include <fog_fragment>\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}`;class f extends s.RawShaderMaterial{constructor(e){var t;Object.assign(n.ShaderChunk,o.default),r.FadingFeature.patchGlobalShaderChunks();const i={CAPS_MODE:o.LineCapsModes.CAPS_ROUND,DASHES_MODE:h.DASHES_SQUARE};let s,l,c=!0,u=1;if(e){c=!0===e.fog,c&&a.setShaderDefine(i,"USE_FOG",!0),u=void 0!==e.opacity?e.opacity:u,s=e.displacementMap,void 0!==s&&a.setShaderDefine(i,"USE_DISPLACEMENTMAP",!0);void 0!==e.outlineWidth&&e.outlineWidth>0&&a.setShaderDefine(i,"USE_OUTLINE",!0),l={name:"SolidLineMaterial",vertexShader:"\n#define SEGMENT_OFFSET 0.1\n\nattribute vec3 extrusionCoord;\nattribute vec3 position;\nattribute vec4 bitangent;\nattribute vec3 tangent;\nattribute vec2 uv;\nattribute vec3 normal;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float extrusionWidth;\nuniform float outlineWidth;\nuniform float offset;\nuniform vec2 drawRange;\n\n#ifdef USE_DISPLACEMENTMAP\nuniform sampler2D displacementMap;\n#endif\n\n#ifdef USE_TILE_CLIP\nvarying vec3 vPosition;\n#endif\nvarying vec3 vRange;\nvarying vec4 vCoords;\n#ifdef USE_COLOR\nattribute vec3 color;\nvarying vec3 vColor;\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\n#include <fog_pars_vertex>\n\n#include <extrude_line_vert_func>\n\nvoid main() {\n    // Calculate the segment.\n    vec2 segment = abs(extrusionCoord.xy) - SEGMENT_OFFSET;\n    float segmentPos = sign(extrusionCoord.x) / 2.0 + 0.5;\n\n    // Calculate the vertex position inside the line (segment) and extrusion direction and factor.\n    float linePos = mix(segment.x, segment.y, segmentPos);\n    vec2 extrusionDir = sign(extrusionCoord.xy);\n    // Precompute to avoid computing multiple times\n    float tanHalfAngle = tan(bitangent.w / 2.0);\n    float extrusionFactor = extrusionDir.y * tanHalfAngle;\n\n    // Calculate the extruded vertex position (and scale the extrusion direction).\n    vec3 pos = extrudeLine(\n        position, linePos, extrusionWidth + outlineWidth, bitangent, tangent, tanHalfAngle,\n        extrusionDir);\n\n    // Store the normalized extrusion coordinates in vCoords (with their ranges in vRange).\n    vRange = vec3(extrusionCoord.z, extrusionWidth, extrusionFactor);\n    vCoords = vec4(extrusionDir / vRange.xy, segment / vRange.x);\n\n    // Adjust the segment to fit the drawRange.\n    float capDist = (extrusionWidth + outlineWidth) / extrusionCoord.z;\n    if ((vCoords.w + capDist) < drawRange.x || (vCoords.z - capDist) > drawRange.y) {\n        vCoords.zw += 1.0;\n    }\n    if (vCoords.z < drawRange.x) {\n        vCoords.zw += vec2(drawRange.x - vCoords.z, 0.0);\n    }\n    if (vCoords.w > drawRange.y) {\n        vCoords.zw -= vec2(0.0, vCoords.w - drawRange.y);\n    }\n\n    // Transform position.\n    #ifdef USE_DISPLACEMENTMAP\n    pos += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    // Shift the line based on the offset, where the bitangent is the cross product of the average\n    // of the two direction vectors (the previous and next segment directions) and the normal of\n    // the line (facing into the sky). The w component is the angle between the two segments.\n    // Note, we need to take the angle into consideration, so we use trigonometry to calculate how\n    // much we need to extend the offset. Note, orthough this looks complicated we are doing this\n    // in the vertex shader, so it should not cause a performance issue.\n    pos += bitangent.xyz * offset * sqrt(1.0 + pow(abs(tanHalfAngle), 2.0));\n\n    vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Pass extruded position to fragment shader.\n    #ifdef USE_TILE_CLIP\n    vPosition = pos;\n    #endif\n\n    #ifdef USE_COLOR\n    // Pass vertex color to fragment shader.\n    vColor = color;\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n\n    #include <fog_vertex>\n}",fragmentShader:p,uniforms:n.UniformsUtils.merge([{diffuse:new n.Uniform(new n.Color(f.DEFAULT_COLOR)),dashColor:new n.Uniform(new n.Color(f.DEFAULT_COLOR)),outlineColor:new n.Uniform(new n.Color(f.DEFAULT_COLOR)),extrusionWidth:new n.Uniform(f.DEFAULT_WIDTH),outlineWidth:new n.Uniform(f.DEFAULT_OUTLINE_WIDTH),offset:new n.Uniform(f.DEFAULT_OFFSET),opacity:new n.Uniform(f.DEFAULT_OPACITY),tileSize:new n.Uniform(new n.Vector2),fadeNear:new n.Uniform(r.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new n.Uniform(r.FadingFeature.DEFAULT_FADE_FAR),displacementMap:new n.Uniform(void 0!==s?s:new n.Texture),drawRange:new n.Uniform(new n.Vector2(f.DEFAULT_DRAW_RANGE_START,f.DEFAULT_DRAW_RANGE_END)),dashSize:new n.Uniform(f.DEFAULT_DASH_SIZE),gapSize:new n.Uniform(f.DEFAULT_GAP_SIZE)},n.UniformsLib.fog]),defines:i,fog:c,opacity:u,rendererCapabilities:e.rendererCapabilities}}super(l),this.fog=c,this.setOpacity(u),this.stencilFunc=n.NotEqualStencilFunc,this.stencilZPass=n.ReplaceStencilOp,this.stencilRef=1,this.stencilWrite=!1,a.enforceBlending(this),this.extensions.derivatives=!0,e&&(void 0!==e.color&&(m.set(e.color),this.color=m),void 0!==e.outlineColor&&(m.set(e.outlineColor),this.outlineColor=m),void 0!==e.lineWidth&&(this.lineWidth=e.lineWidth),void 0!==e.outlineWidth&&(this.outlineWidth=e.outlineWidth),void 0!==e.opacity&&this.setOpacity(e.opacity),void 0!==e.depthTest&&(this.depthTest=e.depthTest),void 0!==e.depthWrite&&(this.depthWrite=e.depthWrite),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.caps&&(this.caps=e.caps),void 0!==e.drawRangeStart&&(this.drawRangeStart=e.drawRangeStart),void 0!==e.drawRangeEnd&&(this.drawRangeEnd=e.drawRangeEnd),void 0!==e.dashes&&(this.dashes=e.dashes),void 0!==e.dashColor&&(m.set(e.dashColor),this.dashColor=m),void 0!==e.dashSize&&(this.dashSize=e.dashSize),void 0!==e.gapSize&&(this.gapSize=e.gapSize),void 0!==e.fog&&(this.fog=e.fog,this.invalidateFog()),this.offset=null!==(t=e.offset)&&void 0!==t?t:0)}set offset(e){this.uniforms.offset.value=e}get offset(){return this.uniforms.offset.value}set outline(e){a.setShaderMaterialDefine(this,"USE_OUTLINE",e)}get outline(){return!0===a.getShaderMaterialDefine(this,"USE_OUTLINE")}setOpacity(e){super.setOpacity(e),void 0!==e&&(this.stencilWrite=e<.98)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}get outlineColor(){return this.uniforms.outlineColor.value}set outlineColor(e){this.uniforms.outlineColor.value.copy(e)}get dashColor(){return this.uniforms.dashColor.value}set dashColor(e){this.uniforms.dashColor.value.copy(e),a.setShaderMaterialDefine(this,"USE_DASH_COLOR",!0)}get lineWidth(){return 2*this.uniforms.extrusionWidth.value}set lineWidth(e){this.uniforms.extrusionWidth.value=e/2}get outlineWidth(){return this.uniforms.outlineWidth.value}set outlineWidth(e){this.uniforms.outlineWidth.value=e,this.outline=e>0}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){var t,i;this.uniforms.gapSize.value=e,a.setShaderMaterialDefine(this,"USE_DASHED_LINE",e>0),0===(null===(i=null===(t=this.uniforms)||void 0===t?void 0:t.gapSize)||void 0===i?void 0:i.value)&&(this.stencilWrite=this.opacity<.98)}get caps(){let e="Round";const t=a.getShaderMaterialDefine(this,"CAPS_MODE");return"number"==typeof t&&c.hasOwnProperty(t)&&(e=c[t]),e}set caps(e){l.hasOwnProperty(e)&&a.setShaderMaterialDefine(this,"CAPS_MODE",l[e])}get dashes(){let e="Square";const t=a.getShaderMaterialDefine(this,"DASHES_MODE");return"number"==typeof t&&d.hasOwnProperty(t)&&(e=d[t]),e}set dashes(e){u.hasOwnProperty(e)&&a.setShaderMaterialDefine(this,"DASHES_MODE",u[e])}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value=e,a.setShaderMaterialDefine(this,"USE_FADING",e>0)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),a.setShaderMaterialDefine(this,"USE_DISPLACEMENTMAP",t)}get drawRangeStart(){return this.uniforms.drawRange.value.x}set drawRangeStart(e){this.uniforms.drawRange.value.x=e}get drawRangeEnd(){return this.uniforms.drawRange.value.y}set drawRangeEnd(e){this.uniforms.drawRange.value.y=e}set clipTileSize(e){this.uniforms.tileSize.value.copy(e);const t=e.x>0&&e.y>0;a.setShaderMaterialDefine(this,"USE_TILE_CLIP",t)}get clipTileSize(){return this.uniforms.tileSize.value}copy(e){return super.copy(e),this.invalidateFog(),this.setOpacity(e.opacity),this}}t.SolidLineMaterial=f,f.DEFAULT_COLOR=16711680,f.DEFAULT_WIDTH=1,f.DEFAULT_OUTLINE_WIDTH=0,f.DEFAULT_OPACITY=1,f.DEFAULT_DRAW_RANGE_START=0,f.DEFAULT_DRAW_RANGE_END=1,f.DEFAULT_DASH_SIZE=1,f.DEFAULT_GAP_SIZE=1,f.DEFAULT_OFFSET=0},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VignetteShader=void 0,t.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float offset;\n        uniform float darkness;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 texel = texture2D( tDiffuse, vUv );\n            vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n            gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n        }"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTileLoader=void 0;const n=i(1),r=i(45),s=n.LoggerManager.instance.create("BaseTileLoader");t.BaseTileLoader=class{constructor(e,t){this.dataSource=e,this.tileKey=t,this.state=r.TileLoaderState.Initialized,this.m_priority=0,this.loadAbortController=new AbortController}get priority(){return this.m_priority}set priority(e){this.m_priority=e}loadAndDecode(){switch(this.state){case r.TileLoaderState.Loading:case r.TileLoaderState.Loaded:case r.TileLoaderState.Decoding:return this.donePromise;case r.TileLoaderState.Ready:case r.TileLoaderState.Failed:case r.TileLoaderState.Initialized:case r.TileLoaderState.Canceled:return this.load(),this.donePromise}}waitSettled(){return this.donePromise?this.donePromise:Promise.resolve(this.state)}cancel(){this.state===r.TileLoaderState.Loading&&(this.loadAbortController.abort(),this.loadAbortController=new AbortController),this.cancelImpl(),this.onDone(r.TileLoaderState.Canceled)}get isFinished(){return this.state===r.TileLoaderState.Ready||this.state===r.TileLoaderState.Canceled||this.state===r.TileLoaderState.Failed}cancelImpl(){}load(){this.loadImpl(this.loadAbortController.signal,this.onDone.bind(this),this.onError.bind(this)),void 0===this.donePromise&&(this.donePromise=new Promise((e,t)=>{this.resolveDonePromise=e,this.rejectedDonePromise=t})),this.state=r.TileLoaderState.Loading}onDone(e){this.resolveDonePromise&&e===r.TileLoaderState.Ready?this.resolveDonePromise(e):this.rejectedDonePromise&&this.rejectedDonePromise(e),this.resolveDonePromise=void 0,this.rejectedDonePromise=void 0,this.donePromise=void 0,this.state=e}onError(e){if(this.state===r.TileLoaderState.Canceled)return;const t=this.dataSource;s.error(`[${t.name}]: failed to load tile ${this.tileKey.mortonCode()}`,e),this.error=e,this.onDone(r.TileLoaderState.Failed)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneViewBounds=void 0;const n=i(2),r=i(1),s=i(0),o=i(9);t.PlaneViewBounds=class{constructor(e,t,i){this.camera=e,this.projection=t,this.m_options=i,this.m_groundPlaneNormal=new s.Vector3(0,0,1),this.m_groundPlane=new s.Plane(this.m_groundPlaneNormal.clone()),r.assert(t.type===n.ProjectionType.Planar)}generate(){
//!!!!!!!ALTITUDE IS NOT TAKEN INTO ACCOUNT!!!!!!!!!
const e=[];if(this.addCanvasCornerIntersection(e),4===e.length)return this.createPolygon(e);this.addHorizonIntersection(e);const t=(new s.Frustum).setFromProjectionMatrix((new s.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse)),i=this.getWorldConers(this.projection);if(this.m_options.tileWrappingEnabled||[i.ne,i.nw,i.se,i.sw].forEach(i=>{this.addPointInFrustum(i,t,e)}),this.m_options.tileWrappingEnabled){const n=(new s.Vector3).subVectors(i.sw,i.se).normalize(),r=(new s.Vector3).subVectors(i.se,i.sw).normalize();[new s.Ray(i.se,n),new s.Ray(i.se,r),new s.Ray(i.ne,n),new s.Ray(i.ne,r)].forEach(i=>{this.addFrustumIntersection(i,t,e)})}else[new s.Line3(i.sw,i.se),new s.Line3(i.ne,i.nw),new s.Line3(i.se,i.ne),new s.Line3(i.nw,i.sw)].forEach(i=>{this.addFrustumIntersection(i,t,e)});return this.createPolygon(e)}createPolygon(e){if(e.length>2)return new n.GeoPolygon(e,!0)}getWorldConers(e){const t=e.worldExtent(0,0);return{sw:t.min,se:new s.Vector3(t.max.x,t.min.y,0),nw:new s.Vector3(t.min.x,t.max.y,0),ne:t.max}}addNDCRayIntersection(e,t){e.forEach(e=>{const i=o.MapViewUtils.rayCastWorldCoordinates({camera:this.camera,projection:this.projection},e[0],e[1]);i&&this.validateAndAddToGeoPolygon(i,t)})}addHorizonIntersection(e){const t=this.getVerticalHorizonPositionInNDC();t&&this.addNDCRayIntersection([[-1,t],[1,t]],e)}addCanvasCornerIntersection(e){this.addNDCRayIntersection([[-1,-1],[1,-1],[1,1],[-1,1]],e)}validateAndAddToGeoPolygon(e,t){this.isInVisibleMap(e)&&t.push(this.projection.unprojectPoint(e))}isInVisibleMap(e){return!(e.y<0||e.y>n.EarthConstants.EQUATORIAL_CIRCUMFERENCE)&&!(!this.m_options.tileWrappingEnabled&&(e.x<0||e.x>n.EarthConstants.EQUATORIAL_CIRCUMFERENCE))}addPointInFrustum(e,t,i){if(t.containsPoint(e)){const t=this.projection.unprojectPoint(e);t.altitude=0,i.push(t)}}addFrustumIntersection(e,t,i){t.planes.forEach(t=>{let n=null;const r=new s.Vector3;if(e instanceof s.Ray&&e.intersectsPlane(t)?n=e.intersectPlane(t,r):e instanceof s.Line3&&t.intersectsLine(e)&&(n=t.intersectLine(e,r)),n&&o.MapViewUtils.closeToFrustum(n,this.camera)){const e=this.projection.unprojectPoint(n);e.altitude=0,i.push(e)}})}getVerticalHorizonPositionInNDC(){const e=new s.Vector3(-1,-1,1).unproject(this.camera).add(new s.Vector3(1,-1,1).unproject(this.camera)).multiplyScalar(.5),t=new s.Vector3(-1,1,1).unproject(this.camera).add(new s.Vector3(1,1,1).unproject(this.camera)).multiplyScalar(.5),i=new s.Line3(e,t),n=new s.Vector3;if(this.m_groundPlane.intersectLine(i,n))return n.project(this.camera).y}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryLoader=t.TileGeometryLoaderState=void 0;const n=i(3),r=i(1),s=i(15),o=i(35),a=i(157);function l(e){const t=o.PerformanceStatistics.instance;if(t.enabled){const i=e.dataSource.name,n=e.tileKey.level,r=e.tileKey.column,s=e.tileKey.row,o=e.disposed?"disposed":"invisible";t.currentFrame.addMessage(`Decoded tile: ${i} # lvl=${n} col=${r} row=${s} DISCARDED - ${o}`)}}var c;!function(e){e[e.Initialized=0]="Initialized",e[e.CreationQueued=1]="CreationQueued",e[e.CreatingGeometry=2]="CreatingGeometry",e[e.Finished=3]="Finished",e[e.Canceled=4]="Canceled",e[e.Disposed=5]="Disposed"}(c=t.TileGeometryLoaderState||(t.TileGeometryLoaderState={}));class h{constructor(e,t){this.m_tile=e,this.m_taskQueue=t,this.m_priority=0,this.m_state=c.Initialized,this.m_finishedPromise=new Promise((e,t)=>{this.m_resolveFinishedPromise=e,this.m_rejectFinishedPromise=t})}static prepareAvailableGeometryKinds(e){const t=new n.GeometryKindSet;for(const i of e.techniques){const e=h.compileGeometryKind(i);if(e instanceof Set)for(const i of e)t.add(i);else t.add(e)}return t}static compileGeometryKind(e){let t=e.kind;return void 0===t?(t=n.isFillTechnique(e)?n.GeometryKind.Area:n.isLineTechnique(e)||n.isSolidLineTechnique(e)||n.isSegmentsTechnique(e)||n.isExtrudedLineTechnique(e)?n.GeometryKind.Line:n.isExtrudedPolygonTechnique(e)?n.GeometryKind.Building:n.isPoiTechnique(e)||n.isLineMarkerTechnique(e)||n.isTextTechnique(e)?n.GeometryKind.Label:n.GeometryKind.All,e.kind=t):Array.isArray(t)&&(t=e.kind=new n.GeometryKindSet(t)),t}set priority(e){this.m_priority=e}getPriority(){return this.m_priority}get tile(){return this.m_tile}get hasDecodedTile(){return void 0!==this.m_decodedTile}get isFinished(){return this.m_state===c.Finished}get isSettled(){return this.isFinished||this.isCanceled||this.isDisposed}waitFinished(){return this.m_finishedPromise}setDecodedTile(e){return this.m_decodedTile=e,this.hasDecodedTile&&(this.m_availableGeometryKinds=h.prepareAvailableGeometryKinds(this.m_decodedTile)),this.m_decodedTile}get availableGeometryKinds(){return this.m_availableGeometryKinds}update(e,t){const i=this.tile;this.tile.hasGeometry&&!this.compareGeometryKinds(e,t)&&this.reset(),this.m_state!==c.Initialized&&this.m_state!==c.Canceled||void 0===i.decodedTile||(this.m_state===c.Initialized&&(a.TileGeometryCreator.instance.processTechniques(i,e,t),this.setGeometryKinds(e,t),this.setDecodedTile(i.decodedTile)),this.queueGeometryCreation(e,t))}cancel(){var e;l(this.tile),this.m_state=c.Canceled,null===(e=this.m_rejectFinishedPromise)||void 0===e||e.call(this)}dispose(){var e;l(this.tile),this.clear(),this.m_state=c.Disposed,null===(e=this.m_rejectFinishedPromise)||void 0===e||e.call(this)}reset(){this.clear(),this.isSettled&&(this.m_finishedPromise=new Promise((e,t)=>{this.m_resolveFinishedPromise=e,this.m_rejectFinishedPromise=t})),this.m_state=c.Initialized}finish(){var e;this.m_decodedTile=void 0,this.m_state=c.Finished,null===(e=this.m_resolveFinishedPromise)||void 0===e||e.call(this)}clear(){var e,t,i;null===(e=this.m_availableGeometryKinds)||void 0===e||e.clear(),null===(t=this.m_enabledKinds)||void 0===t||t.clear(),null===(i=this.m_disabledKinds)||void 0===i||i.clear(),this.m_decodedTile=void 0}queueGeometryCreation(e,t){this.m_state!==c.CreationQueued&&(this.m_taskQueue.add({execute:this.createGeometry.bind(this,e,t),group:s.TileTaskGroups.CREATE,getPriority:this.getPriority.bind(this),isExpired:()=>this.m_state!==c.CreationQueued,estimatedProcessTime:()=>{var e,t;return(null!==(t=null===(e=this.tile.decodedTile)||void 0===e?void 0:e.decodeTime)&&void 0!==t?t:30)/6}}),this.m_state=c.CreationQueued)}async createGeometry(e,t){if(this.m_state===c.CreatingGeometry)return;this.m_state=c.CreatingGeometry;const i=this.tile,n=this.m_decodedTile;if(void 0===n)return void this.finish();const s=o.PerformanceStatistics.instance;let l=0;s.enabled&&(l=r.PerformanceTimer.now());const h=a.TileGeometryCreator.instance;i.clear(),h.initDecodedTile(n,e,t),await h.createAllGeometries(i,n),s.enabled&&this.addStats(s,l),this.finish(),i.dataSource.requestUpdate()}addStats(e,t){const i=this.tile,n=this.m_decodedTile;if(void 0===n)return;const s=r.PerformanceTimer.now()-t,o=e.currentFrame;o.addValue("render.fullFrameTime",s),o.addValue("render.geometryCreationTime",s),o.addValue("geometry.geometryCreationTime",s),o.addValue("geometryCount.numGeometries",n.geometries.length),o.addValue("geometryCount.numTechniques",n.techniques.length),o.addValue("geometryCount.numPoiGeometries",void 0!==n.poiGeometries?n.poiGeometries.length:0),o.addValue("geometryCount.numTextGeometries",void 0!==n.textGeometries?n.textGeometries.length:0),o.addValue("geometryCount.numTextPathGeometries",void 0!==n.textPathGeometries?n.textPathGeometries.length:0),o.addValue("geometryCount.numPathGeometries",void 0!==n.pathGeometries?n.pathGeometries.length:0),o.addMessage(`Decoded tile: ${i.dataSource.name} # lvl=${i.tileKey.level} col=${i.tileKey.column} row=${i.tileKey.row}`)}setGeometryKinds(e,t){var i,r;void 0!==e&&(this.m_enabledKinds=Object.assign(null!==(i=this.m_enabledKinds)&&void 0!==i?i:new n.GeometryKindSet,e)),void 0!==t&&(this.m_disabledKinds=Object.assign(null!==(r=this.m_disabledKinds)&&void 0!==r?r:new n.GeometryKindSet,t))}compareGeometryKinds(e,t){const i=this.m_enabledKinds===e,n=this.m_disabledKinds===t;if(i&&n)return!0;const r=!(void 0!==this.m_enabledKinds&&0!==this.m_enabledKinds.size||void 0!==e&&0!==e.size),s=!(void 0!==this.m_disabledKinds&&0!==this.m_disabledKinds.size||void 0!==t&&0!==t.size);if(r&&s||i&&s||n&&r)return!0;if(!r){if(void 0===e||void 0===this.m_enabledKinds)return!1;if(!e.has(this.m_enabledKinds))return!1}if(!s){if(void 0===t||void 0===this.m_disabledKinds)return!1;if(!t.has(this.m_disabledKinds))return!1}return!0}get isCanceled(){return this.m_state===c.Canceled}get isDisposed(){return this.m_state===c.Disposed}}t.TileGeometryLoader=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.projectTilePlaneCorners=void 0;const n=i(2),r=i(0);t.projectTilePlaneCorners=function(e,t){const{east:i,west:s,north:o,south:a}=e.geoBox;return{sw:t.projectPoint(new n.GeoCoordinates(a,s),new r.Vector3),se:t.projectPoint(new n.GeoCoordinates(a,i),new r.Vector3),nw:t.projectPoint(new n.GeoCoordinates(o,s),new r.Vector3),ne:t.projectPoint(new n.GeoCoordinates(o,i),new r.Vector3)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedMesh=void 0;const n=i(4),r=i(1),s=i(0),o=i(121),a=i(122);class l extends s.Mesh{constructor(e,t,i,n){super(e,t),this.m_getDisplacementRange=i,this.m_raycastStrategy=n}static getDisplacedPositionAttribute(e,t){return l.displacedPositions?l.displacedPositions.reset(e.attributes.position,e.attributes.normal,e.attributes.uv,t):l.displacedPositions=new o.DisplacedBufferAttribute(e.attributes.position,e.attributes.normal,e.attributes.uv,t),l.displacedPositions}raycast(e,t){const i=this.firstMaterial;if(!function(e){const t=n.hasDisplacementFeature(e);return r.assert(t,"Material does not support displacement maps."),t}(i)||!function(e){if(!e)return!1;const t=e instanceof s.DataTexture;return r.assert(t,"Material does not support displacement maps."),t}(i.displacementMap))return void super.raycast(e,t);const o=i.displacementMap,c=Object.assign({},this.m_getDisplacementRange());r.assert(this.geometry instanceof s.BufferGeometry,"Unsupported geometry type.");const h=this.geometry;this.displacedGeometry?this.displacedGeometry.reset(h,o,c):this.displacedGeometry=new a.DisplacedBufferGeometry(h,o,c,l.getDisplacedPositionAttribute(h,o)),this.geometry=this.displacedGeometry,this.m_raycastStrategy?this.m_raycastStrategy(this,e,t):super.raycast(e,t),super.geometry=this.displacedGeometry.originalGeometry}get firstMaterial(){return Array.isArray(this.material)?this.material[0]:this.material}}t.DisplacedMesh=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexCache=void 0;const n=i(1);var r;!function(e){e[e.VertexId=0]="VertexId",e[e.OlderIdx=1]="OlderIdx",e[e.NewerIdx=2]="NewerIdx",e[e.X=3]="X",e[e.Y=4]="Y",e[e.Z=5]="Z",e[e.Count=6]="Count"}(r||(r={}));t.VertexCache=class{constructor(e){this.maxVertexCount=e,this.m_cache=[],this.m_vertexCount=0,this.m_oldestIdx=0,this.m_newestIdx=0,this.m_cache.length=this.maxVertexCount*r.Count,this.clear()}clear(){this.m_cache.fill(-1),this.m_vertexCount=0}get(e,t){const i=this.find(e);return void 0!==i&&(this.promoteEntry(i),this.getVertex(i,t),!0)}set(e,t){let i=-1;this.m_vertexCount<this.maxVertexCount?(i=this.m_vertexCount*r.Count,this.m_vertexCount++):i=this.m_oldestIdx,1===this.m_vertexCount?this.m_oldestIdx=this.m_newestIdx=i:this.promoteEntry(i),this.setVertex(i,e,t)}find(e){const t=this.m_cache.length;for(let i=0;i<t;i+=r.Count)if(this.m_cache[i]===e)return i}promoteEntry(e){if(e===this.m_newestIdx)return;const t=this.getNewerIdx(e),i=this.getOlderIdx(e);-1!==t&&(n.assert(this.getOlderIdx(t)===e),this.setOlderIdx(t,i)),-1!==i&&(n.assert(this.getNewerIdx(i)===e),this.setNewerIdx(i,t)),e===this.m_oldestIdx&&(this.m_oldestIdx=t),this.setNewerIdx(e,-1),this.setOlderIdx(e,this.m_newestIdx),n.assert(-1!==this.m_newestIdx),n.assert(-1===this.getNewerIdx(this.m_newestIdx)),this.setNewerIdx(this.m_newestIdx,e),this.m_newestIdx=e}getOlderIdx(e){return this.m_cache[e+r.OlderIdx]}setOlderIdx(e,t){this.m_cache[e+r.OlderIdx]=t}getNewerIdx(e){return this.m_cache[e+r.NewerIdx]}setNewerIdx(e,t){this.m_cache[e+r.NewerIdx]=t}getVertex(e,t){t.x=this.m_cache[e+r.X],t.y=this.m_cache[e+r.Y],t.z=this.m_cache[e+r.Z]}setVertex(e,t,i){this.m_cache[e]=t,this.m_cache[e+r.X]=i.x,this.m_cache[e+r.Y]=i.y,this.m_cache[e+r.Z]=i.z}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapRenderingManager=void 0;const n=i(4),r=i(0),s=i(271),o=i(127),a=i(272),l=i(34),c=i(273),h=o.MSAASampling.Level_1,u=o.MSAASampling.Level_4;t.MapRenderingManager=class{constructor(e,t,i,a={msaaEnabled:!1}){this.bloom={enabled:!1,strength:1.5,radius:.4,threshold:.85},this.outline={enabled:!1,thickness:.005,color:"#000000",ghostExtrudedPolygons:!1,needsUpdate:!1},this.vignette={enabled:!1,offset:1,darkness:1},this.sepia={enabled:!1,amount:.5},this.m_width=1,this.m_height=1,this.m_renderPass=new l.RenderPass,this.m_target1=new r.WebGLRenderTarget(1,1),this.m_target2=new r.WebGLRenderTarget(1,1),this.m_sepiaPass=new l.ShaderPass(n.SepiaShader),this.m_vignettePass=new l.ShaderPass(n.VignetteShader),this.m_readBuffer=new r.WebGLRenderTarget(e,t),this.m_msaaPass=new o.MSAARenderPass,this.m_msaaPass.enabled=void 0!==a&&!0===a.msaaEnabled,this.m_dynamicMsaaSamplingLevel=void 0===a.dynamicMsaaSamplingLevel?h:a.dynamicMsaaSamplingLevel,this.m_staticMsaaSamplingLevel=void 0===a.staticMsaaSamplingLevel?u:a.staticMsaaSamplingLevel,this.m_lowResPass=new s.LowResRenderPass(i),this.m_lowResPass.enabled=void 0!==i}updateOutline(e){this.outline.color=e.color,this.outline.thickness=e.thickness,this.outline.ghostExtrudedPolygons=e.ghostExtrudedPolygons,this.outline.needsUpdate=!0}render(e,t,i,n){if(!n&&void 0!==this.m_lowResPass.pixelRatio)return this.m_lowResPass.renderToScreen=!0,void this.m_lowResPass.render(e,t,i,null,this.m_readBuffer);const s=this.bloom.enabled||this.outline.enabled||this.vignette.enabled||this.sepia.enabled;let o=null;if((this.bloom.enabled||this.vignette.enabled||this.sepia.enabled)&&(e.setRenderTarget(this.m_target1),e.clearDepth()),this.m_msaaPass.enabled?(this.m_msaaPass.samplingLevel=n?this.m_staticMsaaSamplingLevel:this.m_dynamicMsaaSamplingLevel,this.m_msaaPass.renderToScreen=!s,this.m_msaaPass.render(e,t,i,null,this.m_readBuffer)):this.bloom.enabled||this.vignette.enabled||this.sepia.enabled?(o=this.m_target1,this.m_renderPass.render(e,t,i,this.m_target1,null)):(!this.outline.enabled||this.outline.enabled&&!this.bloom.enabled)&&e.render(t,i),this.outline.enabled){void 0===this.m_outlineEffect&&(this.m_outlineEffect=new a.OutlineEffect(e)),this.outline.needsUpdate&&(this.m_outlineEffect.color=this.outline.color,this.m_outlineEffect.thickness=this.outline.thickness,this.m_outlineEffect.ghostExtrudedPolygons=this.outline.ghostExtrudedPolygons,this.outline.needsUpdate=!1);const n=this.bloom.enabled||this.vignette.enabled||this.sepia.enabled;n&&(o=this.m_target1),e.setRenderTarget(n?o:null),this.m_outlineEffect.render(t,i)}if(this.bloom.enabled){void 0===this.m_bloomPass&&(this.m_bloomPass=new c.BloomPass(new r.Vector2(this.m_width,this.m_height),this.bloom.strength,this.bloom.radius,this.bloom.threshold));const n=this.vignette.enabled||this.sepia.enabled;this.m_bloomPass.renderToScreen=!n,this.m_bloomPass.radius=this.bloom.radius,this.m_bloomPass.strength=this.bloom.strength,this.m_bloomPass.threshold=this.bloom.threshold,this.m_bloomPass.render(e,t,i,null,o)}else void 0!==this.m_bloomPass&&(this.m_bloomPass.dispose(),this.m_bloomPass=void 0);if(this.vignette.enabled){const n=o,r=this.sepia.enabled;this.m_vignettePass.uniforms.offset.value=this.vignette.offset,this.m_vignettePass.uniforms.darkness.value=this.vignette.darkness,this.m_vignettePass.renderToScreen=!r,r&&(o=o===this.m_target1?this.m_target2:this.m_target1),this.m_vignettePass.render(e,t,i,o,n)}this.sepia.enabled&&(this.m_sepiaPass.renderToScreen=!0,this.m_sepiaPass.uniforms.amount.value=this.sepia.amount,this.m_sepiaPass.render(e,t,i,null,o))}setSize(e,t){this.m_readBuffer.setSize(e,t),this.m_msaaPass.setSize(e,t),void 0!==this.m_bloomPass&&this.m_bloomPass.setSize(e,t),this.m_lowResPass.setSize(e,t),this.m_target1.setSize(e,t),this.m_target2.setSize(e,t),this.m_width=e,this.m_height=t}get lowResPixelRatio(){return this.m_lowResPass.pixelRatio}set lowResPixelRatio(e){this.m_lowResPass.pixelRatio=e,this.m_lowResPass.enabled=void 0!==e}set dynamicMsaaSamplingLevel(e){this.m_dynamicMsaaSamplingLevel=e}get dynamicMsaaSamplingLevel(){return this.m_dynamicMsaaSamplingLevel}set msaaEnabled(e){this.m_msaaPass.enabled=e}get msaaEnabled(){return this.m_msaaPass.enabled}set staticMsaaSamplingLevel(e){this.m_staticMsaaSamplingLevel=e}get staticMsaaSamplingLevel(){return this.m_staticMsaaSamplingLevel}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LowResRenderPass=void 0;const n=i(4),r=i(0),s=i(34);class o extends s.Pass{constructor(e){super(),this.lowResPixelRatio=e,this.m_renderTarget=null,this.m_localCamera=new r.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new r.Scene,this.m_quadUniforms=n.CopyShader.uniforms,this.m_quadMaterial=new n.CopyMaterial(this.m_quadUniforms),this.m_quad=new r.Mesh(new r.PlaneBufferGeometry(2,2),this.m_quadMaterial),this.m_savedWidth=0,this.m_savedHeight=0,this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad),this.m_pixelRatio=e}dispose(){this.m_quadMaterial.dispose(),this.m_quad.geometry.dispose(),null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}set pixelRatio(e){this.m_pixelRatio=e,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio))}get pixelRatio(){return this.m_pixelRatio}render(e,t,i,n,s){if(!this.enabled||void 0===this.pixelRatio)return;null===this.m_renderTarget&&(this.m_savedWidth=s.width,this.m_savedHeight=s.height,this.m_renderTarget=new r.WebGLRenderTarget(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio),{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat,depthBuffer:!0,stencilBuffer:!0}),this.m_renderTarget.texture.name="LowResRenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture,this.m_quadUniforms.opacity.value=1;const o=e.getRenderTarget();e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:n),e.clear(),e.render(this.m_quadScene,this.m_localCamera),e.setRenderTarget(o)}setSize(e,t){this.m_savedWidth=e,this.m_savedHeight=t,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(e*this.pixelRatio),Math.floor(t*this.pixelRatio))}}t.LowResRenderPass=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlineEffect=void 0;const n=i(4),r=i(1),s=i(0);t.OutlineEffect=class{constructor(e){this.m_renderer=e,this.enabled=!0,this.m_defaultThickness=.02,this.m_defaultColor=new s.Color(0,0,0),this.m_defaultAlpha=1,this.m_defaultKeepAlive=!1,this.m_ghostExtrudedPolygons=!1,this.m_cache={},this.m_removeThresholdCount=60,this.m_originalMaterials={},this.m_originalOnBeforeRenders={},this.m_shaderIDs={MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical"},this.m_uniformsChunk={outlineThickness:{value:this.m_defaultThickness},outlineColor:{value:this.m_defaultColor},outlineAlpha:{value:this.m_defaultAlpha}},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap}set thickness(e){this.m_defaultThickness=e,this.m_uniformsChunk.outlineThickness.value=e,this.m_cache={}}set color(e){this.m_defaultColor.set(e),this.m_cache={}}set ghostExtrudedPolygons(e){this.m_ghostExtrudedPolygons=e}clear(e,t,i){this.m_renderer.clear(e,t,i)}getPixelRatio(){return this.m_renderer.getPixelRatio()}setPixelRatio(e){this.m_renderer.setPixelRatio(e)}getSize(e){return this.m_renderer.getSize(e)}setSize(e,t,i){this.m_renderer.setSize(e,t,i)}setViewport(e,t,i,n){this.m_renderer.setViewport(e,t,i,n)}setScissor(e,t,i,n){this.m_renderer.setScissor(e,t,i,n)}setScissorTest(e){this.m_renderer.setScissorTest(e)}setRenderTarget(e){this.m_renderer.setRenderTarget(e)}render(e,t){if(this.m_ghostExtrudedPolygons){if(!this.enabled)return void this.m_renderer.render(e,t);const i=this.m_renderer.autoClear;this.m_renderer.autoClear=this.autoClear,this.m_renderer.render(e,t),this.m_renderer.autoClear=i}this.renderOutline(e,t)}renderOutline(e,t){const i=this.m_renderer.autoClear,n=e.autoUpdate,r=e.background,s=this.m_renderer.shadowMap.enabled;e.autoUpdate=!1,e.background=null,this.m_renderer.autoClear=!1,this.m_renderer.shadowMap.enabled=!1,e.traverse(this.setOutlineMaterial.bind(this)),this.m_renderer.render(e,t),e.traverse(this.restoreOriginalMaterial.bind(this)),this.cleanupCache(),e.autoUpdate=n,e.background=r,this.m_renderer.autoClear=i,this.m_renderer.shadowMap.enabled=s}createInvisibleMaterial(){return new s.ShaderMaterial({name:"invisible",visible:!1})}createMaterial(e){if(e instanceof n.EdgeMaterial||!0===e.isDepthPrepassMaterial)return this.createInvisibleMaterial();const t=this.m_shaderIDs[e.type];let i,r=void 0!==e.shaderUniforms?e.shaderUniforms:e.uniforms;if(void 0!==t){const e=s.ShaderLib[t];r=e.uniforms,i=e.vertexShader}else if(!0===e.isRawShaderMaterial){if(i=e.vertexShader,!/attribute\s+vec3\s+position\s*;/.test(i)||!/attribute\s+vec3\s+normal\s*;/.test(i))return this.createInvisibleMaterial()}else{if(!0!==e.isShaderMaterial)return this.createInvisibleMaterial();i=e.vertexShader}const o=void 0!==e.shaderUniforms&&void 0!==e.shaderUniforms.extrusionRatio,a=n.FadingFeature.isDefined(e),l=Object.assign(Object.assign({},r),this.m_uniformsChunk),c=i.replace(/void\s+main\s*\(\s*\)/,"\n#ifdef USE_EXTRUSION\n  #ifndef HAS_EXTRUSION_PARS_VERTEX\n    #include <extrusion_pars_vertex>\n  #endif\n#endif\n\n#ifdef USE_FADING\n  #include <fading_pars_vertex>\n#endif\n\nuniform float outlineThickness;\n\nvec4 calculateOutline( vec4 pos, vec3 objectNormal, vec4 skinned ) {\n    float thickness = outlineThickness;\n    const float ratio = 1.0;\n    vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + objectNormal, 1.0 );\n    vec4 norm = normalize( pos - pos2 );\n    return pos + norm * thickness * pos.w * ratio;\n}\nvoid main()").replace(/\}\s*$/,"\n#if ! defined( LAMBERT ) && ! defined( PHONG ) && ! defined( TOON ) && ! defined( STANDARD )\n    #ifndef USE_ENVMAP\n        vec3 objectNormal = normalize( normal );\n    #endif\n#endif\n\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n\n#ifdef DECLARE_TRANSFORMED\n    vec3 transformed = vec3( position );\n#endif\n\n#ifdef USE_EXTRUSION\n #ifndef HAS_EXTRUSION_VERTEX\n  #include <extrusion_vertex>\n #endif\n#endif\n\n#ifdef USE_FADING\n  #include <fading_vertex>\n#endif\n\n#ifdef USE_EXTRUSION\n  gl_Position = calculateOutline( projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 ),\n      objectNormal, vec4( transformed, 1.0 ) );\n#else\n  gl_Position = calculateOutline( gl_Position, objectNormal, vec4( transformed, 1.0 ) );\n#endif\n\n#include <fog_vertex>\n}").replace(/#include\s+<[\w_]*light[\w_]*>/g,""),h={};/vec3\s+transformed\s*=/.test(i)||/#include\s+<begin_vertex>/.test(i)||(h.DECLARE_TRANSFORMED=!0),o&&(l.extrusionRatio={value:n.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN},h.USE_EXTRUSION=1),a&&(l.fadeNear={value:void 0!==r.fadeNear?r.fadeNear.value:n.FadingFeature.DEFAULT_FADE_NEAR},l.fadeFar={value:void 0!==r.fadeFar?r.fadeFar.value:n.FadingFeature.DEFAULT_FADE_FAR},h.USE_FADING=1);return new s.ShaderMaterial({defines:h,uniforms:l,vertexShader:c,fragmentShader:"\n#include <common>\n#include <fog_pars_fragment>\n\n#ifdef USE_EXTRUSION\n  #include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n  #include <fading_pars_fragment>\n#endif\n\nuniform vec3 outlineColor;\nuniform float outlineAlpha;\n\nvoid main() {\n\n    gl_FragColor = vec4( outlineColor, outlineAlpha );\n\n    #include <fog_fragment>\n\n    #ifdef USE_EXTRUSION\n      #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n      #include <fading_fragment>\n    #endif\n}",side:s.BackSide,morphTargets:!1,morphNormals:!1,fog:!1,blending:s.CustomBlending,blendSrc:s.SrcAlphaFactor,blendDst:s.OneMinusSrcAlphaFactor,blendSrcAlpha:s.OneFactor,blendDstAlpha:s.OneMinusSrcAlphaFactor,transparent:!0,polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:30})}getOutlineMaterialFromCache(e){let t=this.m_cache[e.uuid];return void 0===t&&(t={material:this.createMaterial(e),used:!0,keepAlive:this.m_defaultKeepAlive,count:0},this.m_cache[e.uuid]=t),t.used=!0,t.material}getOutlineMaterial(e){const t=this.getOutlineMaterialFromCache(e);return this.m_originalMaterials[t.uuid]=e,this.updateOutlineMaterial(t,e),t}setOutlineMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.getOutlineMaterial(e.material[t]);else e.material=this.getOutlineMaterial(e.material);this.m_originalOnBeforeRenders[e.uuid]=e.onBeforeRender,e.onBeforeRender=r.chainCallbacks(e.onBeforeRender,this.onBeforeRender.bind(this))}}restoreOriginalMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.m_originalMaterials[e.material[t].uuid];else e.material=this.m_originalMaterials[e.material.uuid];e.onBeforeRender=this.m_originalOnBeforeRenders[e.uuid]}}onBeforeRender(e,t,i,n,r,s){const o=this.m_originalMaterials[r.uuid];void 0!==o&&this.updateUniforms(r,o)}updateUniforms(e,t){var i;const r=t.userData.outlineParameters,s=e.uniforms;s.outlineAlpha.value=t.opacity;const o=void 0!==t.shaderUniforms?t.shaderUniforms:t.uniforms;if(void 0!==r&&(void 0!==r.thickness&&(s.outlineThickness.value=r.thickness),void 0!==r.color&&s.outlineColor.value.fromArray(r.color),void 0!==r.alpha&&(s.outlineAlpha.value=r.alpha)),void 0!==o&&void 0!==o.extrusionRatio){const i=t.shaderUniforms.extrusionRatio.value;e.extrusionRatio=i,e.uniforms.extrusionRatio.value=void 0!==i?i:n.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}void 0!==(null===(i=e.defines)||void 0===i?void 0:i.USE_FADING)&&void 0!==o.fadeNear&&void 0!==o.fadeFar&&o.fadeFar.value>=0&&(s.fadeNear.value=o.fadeNear.value,s.fadeFar.value=o.fadeFar.value)}updateOutlineMaterial(e,t){if("invisible"===e.name)return;const i=t.userData.outlineParameters;e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.fog=t.fog,void 0!==i?(e.visible=!1!==t.visible&&(void 0===i.visible||i.visible),void 0!==i.keepAlive&&(this.m_cache[t.uuid].keepAlive=i.keepAlive)):e.visible=t.visible,!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1)}cleanupCache(){let e;e=Object.keys(this.m_originalMaterials);for(let t=0,i=e.length;t<i;t++)this.m_originalMaterials[e[t]]=void 0;e=Object.keys(this.m_originalOnBeforeRenders);for(let t=0,i=e.length;t<i;t++)this.m_originalOnBeforeRenders[e[t]]=void 0;e=Object.keys(this.m_cache);for(const t of e)!1===this.m_cache[t].used?(this.m_cache[t].count++,!1===this.m_cache[t].keepAlive&&this.m_cache[t].count>this.m_removeThresholdCount&&delete this.m_cache[t]):(this.m_cache[t].used=!1,this.m_cache[t].count=0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BloomPass=void 0;const n=i(4),r=i(0),s=i(34),o=new r.Vector2(1,0),a=new r.Vector2(0,1);class l extends s.Pass{constructor(e,t,i,s){super(),this.resolution=new r.Vector2(256,256),this.m_renderTargetsHorizontal=[],this.m_renderTargetsVertical=[],this.m_nMips=5,this.m_separableBlurMaterials=[],this.m_camera=new r.OrthographicCamera(-1,1,1,-1,0,1),this.m_scene=new r.Scene,this.m_basic=new r.MeshBasicMaterial,this.m_quad=new r.Mesh(new r.PlaneBufferGeometry(2,2)),this.m_bloomTintColors=[new r.Vector3(1,1,1),new r.Vector3(1,1,1),new r.Vector3(1,1,1),new r.Vector3(1,1,1),new r.Vector3(1,1,1)],this.strength=t,this.radius=i,this.threshold=s,this.resolution=e,this.m_quad.frustumCulled=!1,this.m_scene.add(this.m_quad);const o={minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat};let a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);this.m_renderTargetBright=new r.WebGLRenderTarget(a,l,o),this.m_renderTargetBright.texture.name="UnrealBloomPass.bright",this.m_renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.m_nMips;e++){const t=new r.WebGLRenderTarget(a,l,o);t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.m_renderTargetsHorizontal.push(t);const i=new r.WebGLRenderTarget(a,l,o);i.texture.name="UnrealBloomPass.v"+e,i.texture.generateMipmaps=!1,this.m_renderTargetsVertical.push(i),a=Math.round(a/2),l=Math.round(l/2)}this.m_highPassUniforms=r.UniformsUtils.clone(n.LuminosityHighPassShader.uniforms),this.m_highPassUniforms.luminosityThreshold.value=s,this.m_highPassUniforms.smoothWidth.value=.01,this.m_materialHighPassFilter=new r.ShaderMaterial({uniforms:this.m_highPassUniforms,vertexShader:n.LuminosityHighPassShader.vertexShader,fragmentShader:n.LuminosityHighPassShader.fragmentShader,defines:{}});const c=[3,5,7,9,11];a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);for(let e=0;e<this.m_nMips;e++)this.m_separableBlurMaterials.push(this.getSeperableBlurMaterial(c[e])),this.m_separableBlurMaterials[e].uniforms.texSize.value=new r.Vector2(a,l),a=Math.round(a/2),l=Math.round(l/2);this.m_compositeMaterial=this.getCompositeMaterial(this.m_nMips),this.m_compositeMaterial.uniforms.blurTexture1.value=this.m_renderTargetsVertical[0].texture,this.m_compositeMaterial.uniforms.blurTexture2.value=this.m_renderTargetsVertical[1].texture,this.m_compositeMaterial.uniforms.blurTexture3.value=this.m_renderTargetsVertical[2].texture,this.m_compositeMaterial.uniforms.blurTexture4.value=this.m_renderTargetsVertical[3].texture,this.m_compositeMaterial.uniforms.blurTexture5.value=this.m_renderTargetsVertical[4].texture,this.m_compositeMaterial.uniforms.bloomStrength.value=t,this.m_compositeMaterial.uniforms.bloomRadius.value=.1,this.m_compositeMaterial.needsUpdate=!0;this.m_compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,this.m_copyUniforms=r.UniformsUtils.clone(n.CopyShader.uniforms),this.m_copyUniforms.opacity.value=1,this.m_materialCopy=new r.ShaderMaterial({uniforms:this.m_copyUniforms,vertexShader:n.CopyShader.vertexShader,fragmentShader:n.CopyShader.fragmentShader,blending:r.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}dispose(){for(const e of this.m_renderTargetsHorizontal)e.dispose();for(const e of this.m_renderTargetsVertical)e.dispose();this.m_renderTargetBright.dispose()}setSize(e,t){let i=Math.round(e/2),n=Math.round(t/2);this.m_renderTargetBright.setSize(i,n);for(let e=0;e<this.m_nMips;e++)this.m_renderTargetsHorizontal[e].setSize(i,n),this.m_renderTargetsVertical[e].setSize(i,n),this.m_separableBlurMaterials[e].uniforms.texSize.value=new r.Vector2(i,n),i=Math.round(i/2),n=Math.round(n/2)}render(e,t,i,n,r){this.renderToScreen&&(this.m_quad.material=this.m_basic,this.m_basic.map=r.texture,e.setRenderTarget(null),e.clear(),e.render(this.m_scene,this.m_camera)),this.m_highPassUniforms.tDiffuse.value=r.texture,this.m_highPassUniforms.luminosityThreshold.value=this.threshold,this.m_quad.material=this.m_materialHighPassFilter,e.setRenderTarget(this.m_renderTargetBright),e.clear(),e.render(this.m_scene,this.m_camera);let s=this.m_renderTargetBright;for(let t=0;t<this.m_nMips;t++)this.m_quad.material=this.m_separableBlurMaterials[t],this.m_separableBlurMaterials[t].uniforms.colorTexture.value=s.texture,this.m_separableBlurMaterials[t].uniforms.direction.value=o,e.setRenderTarget(this.m_renderTargetsHorizontal[t]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_separableBlurMaterials[t].uniforms.colorTexture.value=this.m_renderTargetsHorizontal[t].texture,this.m_separableBlurMaterials[t].uniforms.direction.value=a,e.setRenderTarget(this.m_renderTargetsVertical[t]),e.clear(),e.render(this.m_scene,this.m_camera),s=this.m_renderTargetsVertical[t];this.m_quad.material=this.m_compositeMaterial,this.m_compositeMaterial.uniforms.bloomStrength.value=this.strength,this.m_compositeMaterial.uniforms.bloomRadius.value=this.radius,this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,e.setRenderTarget(this.m_renderTargetsHorizontal[0]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_quad.material=this.m_materialCopy,this.m_copyUniforms.tDiffuse.value=this.m_renderTargetsHorizontal[0].texture,this.renderToScreen?(e.setRenderTarget(null),e.render(this.m_scene,this.m_camera)):(e.setRenderTarget(r),e.render(this.m_scene,this.m_camera))}getSeperableBlurMaterial(e){return new r.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new r.Vector2(.5,.5)},direction:{value:new r.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            }",fragmentShader:"#include <common>\n            varying vec2 vUv;\n            uniform sampler2D colorTexture;\n            uniform vec2 texSize;\n            uniform vec2 direction;\n\n            float gaussianPdf(in float x, in float sigma) {\n                return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n            }\n            void main() {\n                vec2 invSize = 1.0 / texSize;\n                float fSigma = float(SIGMA);\n                float weightSum = gaussianPdf(0.0, fSigma);\n                vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n                for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n                    float x = float(i);\n                    float w = gaussianPdf(x, fSigma);\n                    vec2 uvOffset = direction * invSize * x;\n                    vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n                    vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n                    diffuseSum += (sample1 + sample2) * w;\n                    weightSum += 2.0 * w;\n                }\n                gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n            }"})}getCompositeMaterial(e){return new r.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                }",fragmentShader:"varying vec2 vUv;\n                uniform sampler2D blurTexture1;\n                uniform sampler2D blurTexture2;\n                uniform sampler2D blurTexture3;\n                uniform sampler2D blurTexture4;\n                uniform sampler2D blurTexture5;\n                uniform sampler2D dirtTexture;\n                uniform float bloomStrength;\n                uniform float bloomRadius;\n                uniform float bloomFactors[NUM_MIPS];\n                uniform vec3 bloomTintColors[NUM_MIPS];\n\n                float lerpBloomFactor(const in float factor) {\n                    float mirrorFactor = 1.2 - factor;\n                    return mix(factor, mirrorFactor, bloomRadius);\n                }\n\n                void main() {\n                    gl_FragColor = bloomStrength * (\nlerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\nlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\nlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\nlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\nlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n                }"})}}t.BloomPass=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isWorkerBootstrapResponse=t.isWorkerBootstrapRequest=void 0,t.isWorkerBootstrapRequest=function(e){return e&&"worker-bootstrap-request"===e.type&&Array.isArray(e.dependencies)},t.isWorkerBootstrapResponse=function(e){return e&&"worker-bootstrap-response"===e.type&&Array.isArray(e.resolvedDependencies)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapTileCuller=void 0;const n=i(0);t.MapTileCuller=class{constructor(e){this.m_camera=e,this.m_globalFrustumMin=new n.Vector3,this.m_globalFrustumMax=new n.Vector3,this.m_frustumCorners=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3]}setup(){const e=this.getFrustumCorners(),t=this.m_camera.matrixWorld;this.m_globalFrustumMin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.m_globalFrustumMax.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(const i of e)i.applyMatrix4(t),this.m_globalFrustumMin.x=Math.min(this.m_globalFrustumMin.x,i.x),this.m_globalFrustumMin.y=Math.min(this.m_globalFrustumMin.y,i.y),this.m_globalFrustumMin.z=Math.min(this.m_globalFrustumMin.z,i.z),this.m_globalFrustumMax.x=Math.max(this.m_globalFrustumMax.x,i.x),this.m_globalFrustumMax.y=Math.max(this.m_globalFrustumMax.y,i.y),this.m_globalFrustumMax.z=Math.max(this.m_globalFrustumMax.z,i.z)}frustumIntersectsTileBox(e){const t=this.m_globalFrustumMin,i=this.m_globalFrustumMax;return!(i.x<e.min.x||i.y<e.min.y||i.z<e.min.z||t.x>e.max.x||t.y>e.max.y||t.z>e.max.z)}getFrustumCorners(){const e=this.m_frustumCorners,t=this.m_camera.projectionMatrixInverse;let i=0;function n(n,r,s){e[i++].set(n,r,s).applyMatrix4(t)}return n(-1,-1,-1),n(1,-1,-1),n(-1,1,-1),n(1,1,-1),n(-1,-1,1),n(1,-1,1),n(-1,1,1),n(1,1,1),e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryManager=void 0;const n=i(3),r=i(33);t.TileGeometryManager=class{constructor(e){this.mapView=e,this.enableFilterByKind=!0,this.enabledKinds=new n.GeometryKindSet,this.disabledKinds=new n.GeometryKindSet,this.hiddenKinds=new n.GeometryKindSet,this.m_visibilityCounter=1}get enabledGeometryKinds(){return this.enabledKinds}set enabledGeometryKinds(e){this.enabledKinds=e}get disabledGeometryKinds(){return this.disabledKinds}set disabledGeometryKinds(e){this.disabledKinds=e}get hiddenGeometryKinds(){return this.hiddenKinds}set hiddenGeometryKinds(e){this.hiddenKinds=e,this.incrementVisibilityCounter()}get visibilityCounter(){return this.m_visibilityCounter}updateTiles(e){let t=0;for(const i of e){const e=t++;i.updateGeometry(e,this.enableFilterByKind?this.enabledGeometryKinds:void 0,this.enableFilterByKind?this.disabledGeometryKinds:void 0)&&this.m_tileUpdateCallback&&this.m_tileUpdateCallback(i)}this.updateTileObjectVisibility(e)&&this.mapView.update()}clear(){this.enabledKinds.clear(),this.disabledKinds.clear(),this.hiddenKinds.clear()}enableKind(e,t=!0){this.enableDisableKinds(this.enabledKinds,e,t)}disableKind(e,t=!0){this.enableDisableKinds(this.disabledKinds,e,t)}hideKind(e,t=!0){let i=!1;if(Array.isArray(e)||e instanceof Set)for(const n of e){const e=this.addRemove(this.hiddenKinds,n,t);i=i||e}else i=this.addRemove(this.hiddenKinds,e,t);i&&this.incrementVisibilityCounter()}getAvailableKinds(e){const t=new n.GeometryKindSet;for(const i of e){const e=i.loadedGeometryKinds;if(void 0!==e)for(const i of e)t.add(i)}return t}updateTileObjectVisibility(e){let t=!1;for(const i of e)if(0!==i.objects.length&&i.visibilityCounter!==this.visibilityCounter){i.visibilityCounter=this.visibilityCounter;for(const e of i.objects){const i=r.MapObjectAdapter.get(e),n=null==i?void 0:i.kind;if(void 0!==n){const i=!n.some(e=>this.hiddenKinds.has(e));t=t||e.visible!==i,e.visible=i}}}return t}setTileUpdateCallback(e){this.m_tileUpdateCallback=e}incrementVisibilityCounter(){return++this.m_visibilityCounter}enableDisableKinds(e,t,i){if(Array.isArray(t))for(const n of t)this.addRemove(e,n,i);else if(t instanceof Set){const n=t;for(const t of n)this.addRemove(e,t,i)}else void 0!==t&&this.addRemove(e,t,i)}addRemove(e,t,i){if(i){if(!e.has(t))return e.add(t),!0}else if(e.has(t))return e.delete(t),!0;return!1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewEnvironment=t.DEFAULT_CLEAR_COLOR=void 0;const n=i(2),r=i(1),s=i(0),o=i(46),a=i(141),l=i(278),c=i(124),h=r.LoggerManager.instance.create("MapViewEnvironment");t.DEFAULT_CLEAR_COLOR=16777215;const u={vector3:[new s.Vector3,new s.Vector3,new s.Vector3],frustumPoints:[new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3]};t.MapViewEnvironment=class{constructor(e,t){this.m_mapView=e,this.m_fog=new a.MapViewFog(this.m_mapView.scene),!1!==t.addBackgroundDatasource&&(this.m_backgroundDataSource=new o.BackgroundDataSource,this.m_mapView.addDataSource(this.m_backgroundDataSource)),void 0!==t.backgroundTilingScheme&&void 0!==this.m_backgroundDataSource&&this.m_backgroundDataSource.setTilingScheme(t.backgroundTilingScheme),this.updateClearColor()}get lights(){var e;return null!==(e=this.m_createdLights)&&void 0!==e?e:[]}get fog(){return this.m_fog}updateBackgroundDataSource(){this.m_backgroundDataSource&&this.m_backgroundDataSource.updateStorageLevelOffset()}clearBackgroundDataSource(){void 0!==this.m_backgroundDataSource&&this.m_mapView.clearTileCache(this.m_backgroundDataSource.name)}update(){this.m_fog.update(this.m_mapView,this.m_mapView.viewRanges.maximum),void 0!==this.m_skyBackground&&this.m_mapView.projection.type===n.ProjectionType.Planar&&this.m_skyBackground.updateCamera(this.m_mapView.camera),this.updateLights()}updateClearColor(e,i){void 0!==e?this.m_mapView.renderer.setClearColor(new s.Color(e),i):this.m_mapView.renderer.setClearColor(t.DEFAULT_CLEAR_COLOR,i)}updateSkyBackground(e,t){if(this.m_skyBackground instanceof l.SkyBackground&&void 0!==e)this.updateSkyBackgroundColors(e,t);else{if(void 0===this.m_skyBackground&&void 0!==e)return void this.addNewSkyBackground(e,t);this.m_skyBackground instanceof l.SkyBackground&&void 0===e&&this.removeSkyBackGround()}}updateLighting(e){var t;this.m_createdLights&&this.m_createdLights.forEach(e=>{this.m_mapView.scene.remove(e)}),null===(t=this.m_overlayCreatedLights)||void 0===t||t.forEach(e=>{this.m_mapView.overlayScene.remove(e),e instanceof s.DirectionalLight&&this.m_mapView.overlayScene.remove(e.target)}),void 0!==e&&(this.m_createdLights=[],this.m_overlayCreatedLights=[],e.forEach(e=>{const t=c.createLight(e);if(!t)return void h.warn(`MapView: failed to create light ${e.name} of type ${e.type}`);if(this.m_mapView.scene.add(t),t.isDirectionalLight){const e=t;this.m_mapView.scene.add(e.target)}this.m_createdLights.push(t);const i=t.clone();this.m_mapView.overlayScene.add(i),i instanceof s.DirectionalLight&&this.m_mapView.overlayScene.add(i.target.clone())}))}updateLights(){if(!this.m_mapView.shadowsEnabled||this.m_mapView.projection.type===n.ProjectionType.Spherical||void 0===this.m_createdLights||0===this.m_createdLights.length)return;const e=[{x:-1,y:-1,z:-1},{x:1,y:-1,z:-1},{x:-1,y:1,z:-1},{x:1,y:1,z:-1},{x:-1,y:-1,z:1},{x:1,y:-1,z:1},{x:-1,y:1,z:1},{x:1,y:1,z:1}].map((e,t)=>this.m_mapView.ndcToView(e,u.frustumPoints[t]));this.m_createdLights.forEach(t=>{const i=t;if(!0===i.isDirectionalLight){const t=u.vector3[0];t.copy(i.target.position),t.sub(i.position),t.normalize();const r=u.vector3[1];this.m_mapView.projection.type===n.ProjectionType.Planar&&r.set(0,0,-1);const o=this.m_mapView.tilt,a=this.m_mapView.targetDistance*Math.cos(s.MathUtils.degToRad(o))/r.dot(t);i.target.position.copy(this.m_mapView.worldTarget).sub(this.m_mapView.camera.position),i.position.copy(this.m_mapView.worldTarget),i.position.addScaledVector(t,-a),i.position.sub(this.m_mapView.camera.position),i.updateMatrixWorld(),i.shadow.updateMatrices(i);const l=i.shadow.camera,c=e.map(e=>this.viewToLightSpace(e.clone(),l)),h=new s.Box3;c.forEach(e=>{h.expandByPoint(e)}),l.left=h.min.x,l.right=h.max.x,l.top=h.max.y,l.bottom=h.min.y,l.near=.95*-h.max.z,l.far=-h.min.z,l.updateProjectionMatrix()}})}addNewSkyBackground(e,t){"gradient"===e.type&&void 0===e.groundColor&&(e.groundColor=r.getOptionValue(t,"#000000")),this.m_skyBackground=new l.SkyBackground(e,this.m_mapView.projection.type,this.m_mapView.camera),this.m_mapView.scene.background=this.m_skyBackground.texture}removeSkyBackGround(){this.m_mapView.scene.background=null,void 0!==this.m_skyBackground&&(this.m_skyBackground.dispose(),this.m_skyBackground=void 0)}updateSkyBackgroundColors(e,t){var i;"gradient"===e.type&&void 0===e.groundColor&&(e.groundColor=r.getOptionValue(t,"#000000")),void 0!==this.m_skyBackground&&(this.m_skyBackground.updateTexture(e,this.m_mapView.projection.type),this.m_mapView.scene.background=null===(i=this.m_skyBackground)||void 0===i?void 0:i.texture)}viewToLightSpace(e,t){return e.applyMatrix4(t.matrixWorldInverse)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBackground=void 0;const n=i(142),r=i(279);t.SkyBackground=class{constructor(e,t,i){switch(this.m_sky=e,this.m_projectionType=t,this.m_sky.type){case"gradient":this.m_skyTexture=new r.SkyGradientTexture(this.m_sky,this.m_projectionType),this.updateCamera(i);break;case"cubemap":this.m_skyTexture=new n.SkyCubemapTexture(this.m_sky)}}dispose(){this.m_skyTexture.dispose()}get texture(){return this.m_skyTexture.texture}updateCamera(e){"gradient"===this.m_sky.type&&this.m_skyTexture.update(e)}updateTexture(e,t){const i=this.m_sky.type===e.type&&this.m_projectionType===t;switch(e.type){case"gradient":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new r.SkyGradientTexture(e,t);break;case"cubemap":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new n.SkyCubemapTexture(e)}this.m_projectionType=t,this.m_sky=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyGradientTexture=t.DEFAULT_MONOMIAL_POWER=t.DEFAULT_TEXTURE_SIZE=void 0;const n=i(2),r=i(1),s=i(0);t.DEFAULT_TEXTURE_SIZE=512,t.DEFAULT_MONOMIAL_POWER=1;const o=[new s.Vector3(1,0,0),new s.Vector3(-1,0,0),new s.Vector3(0,-1,0),new s.Vector3(0,1,0),new s.Vector3(0,0,1),new s.Vector3(0,0,-1)],a=[new s.Vector3(0,0,-1),new s.Vector3(0,0,1),new s.Vector3(1,0,0),new s.Vector3(1,0,0),new s.Vector3(1,0,0),new s.Vector3(-1,0,0)],l=[new s.Vector3(0,1,0),new s.Vector3(0,1,0),new s.Vector3(0,0,1),new s.Vector3(0,0,-1),new s.Vector3(0,1,0),new s.Vector3(0,1,0)];t.SkyGradientTexture=class{constructor(e,i,r=t.DEFAULT_TEXTURE_SIZE){this.m_projectionType=i,this.m_height=r;const o=new s.Color(e.topColor),a=new s.Color(e.bottomColor),l=new s.Color(e.groundColor);this.m_width=this.m_projectionType===n.ProjectionType.Planar?1:this.m_height,this.m_faceCount=this.m_projectionType===n.ProjectionType.Planar?1:6,this.m_faces=[];for(let t=0;t<this.m_faceCount;++t){const i=new Uint8Array(3*this.m_width*this.m_height);this.fillTextureData(i,t,o,a,l,e.monomialPower);const n=new s.DataTexture(i,this.m_width,this.m_height,s.RGBFormat);n.needsUpdate=!0,n.unpackAlignment=1,this.m_faces.push(n)}this.m_projectionType===n.ProjectionType.Spherical?(this.m_skybox=new s.CubeTexture(this.m_faces),this.m_skybox.needsUpdate=!0):(this.m_farClipPlaneDividedVertically=new s.Line3,this.m_groundPlane=new s.Plane(new s.Vector3(0,0,1)),this.m_bottomMidFarPoint=new s.Vector3,this.m_topMidFarPoint=new s.Vector3,this.m_horizonPosition=new s.Vector3,this.m_farClipPlaneCorners=[new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3])}dispose(){for(let e=0;e<this.m_faceCount;++e)this.m_faces[e].dispose();this.m_projectionType===n.ProjectionType.Spherical&&this.m_skybox.dispose()}get texture(){return this.m_projectionType===n.ProjectionType.Planar?this.m_faces[0]:this.m_skybox}update(e){this.m_projectionType===n.ProjectionType.Planar&&(this.setHorizonPosition(e),this.updateTexturePosition())}updateTexture(e){for(let t=0;t<this.m_faceCount;++t)this.fillTextureData(this.m_faces[t].image.data,t,new s.Color(e.topColor),new s.Color(e.bottomColor),new s.Color(e.groundColor),e.monomialPower),this.m_faces[t].needsUpdate=!0;this.m_projectionType===n.ProjectionType.Spherical&&(this.m_skybox.needsUpdate=!0)}fillTextureData(e,i,c,h,u,d){const m=new s.Color,p=new s.Vector3,f=new s.Vector3,g=new s.Vector3,v=new s.Vector3(0,0,1);for(let s=0;s<this.m_height;++s)for(let y=0;y<this.m_width;++y){if(this.m_projectionType===n.ProjectionType.Spherical){const e=f.copy(a[i]).multiplyScalar((y+.5)/this.m_width*2-1),n=g.copy(l[i]).multiplyScalar((s+.5)/this.m_height*2-1);p.copy(o[i]).add(e).add(n).normalize();const _=Math.max(v.dot(p),0);m.copy(u).lerp(h,Math.min(100*_,1)).lerp(c,_**r.getOptionValue(d,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}else{const e=s/this.m_height;0===s?m.copy(u).multiplyScalar(255):m.copy(h).lerp(c,e**r.getOptionValue(d,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}e[s*this.m_width*3+3*y]=m.r,e[s*this.m_width*3+3*y+1]=m.g,e[s*this.m_width*3+3*y+2]=m.b}}setHorizonPosition(e){this.m_farClipPlaneCorners[0].set(-1,-1,1).unproject(e),this.m_farClipPlaneCorners[1].set(1,-1,1).unproject(e),this.m_farClipPlaneCorners[2].set(-1,1,1).unproject(e),this.m_farClipPlaneCorners[3].set(1,1,1).unproject(e),this.m_bottomMidFarPoint.copy(this.m_farClipPlaneCorners[0]).add(this.m_farClipPlaneCorners[1]).multiplyScalar(.5),this.m_topMidFarPoint.copy(this.m_farClipPlaneCorners[2]).add(this.m_farClipPlaneCorners[3]).multiplyScalar(.5),this.m_farClipPlaneDividedVertically.set(this.m_bottomMidFarPoint,this.m_topMidFarPoint);this.m_groundPlane.intersectLine(this.m_farClipPlaneDividedVertically,this.m_horizonPosition)||this.m_horizonPosition.set(0,0,0)}updateTexturePosition(){const e=this.m_bottomMidFarPoint.distanceTo(this.m_horizonPosition)/this.m_farClipPlaneDividedVertically.distance(),t=0===this.m_horizonPosition.length()?1:e-2/this.m_height;this.m_faces[0].offset.set(0,this.m_bottomMidFarPoint.z<=0?-t:e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewTaskScheduler=void 0;const n=i(1),r=i(0),s=i(15),o=i(35),a={type:"update"};class l extends r.EventDispatcher{constructor(e=60){super(),this.m_maxFps=e,this.m_throttlingEnabled=!1,this.m_taskQueue=new n.TaskQueue({groups:[s.TileTaskGroups.FETCH_AND_DECODE,s.TileTaskGroups.CREATE],prioSortFn:(e,t)=>e.getPriority()-t.getPriority()}),this.maxFps=e}set maxFps(e){this.m_maxFps=e<=0?60:e}get maxFps(){return this.m_maxFps}get taskQueue(){return this.m_taskQueue}get throttlingEnabled(){return!0===this.m_throttlingEnabled}set throttlingEnabled(e){this.m_throttlingEnabled=e}requestUpdate(){this.dispatchEvent(a)}processPending(e){const t=o.PerformanceStatistics.instance,i=t.enabled?t.currentFrame:void 0;let r;t.enabled&&(r=n.PerformanceTimer.now()),this.m_taskQueue.update();let a=this.taskQueue.numItemsLeft();if(null==i||i.setValue("TaskScheduler.numPendingTasks",a),this.throttlingEnabled){let t=this.spaceInFrame(e);t=t>2?t-2:t,null==i||i.setValue("TaskScheduler.estimatedAvailableTime",t);let n=0;for(;t>0&&a>0;){function l(e){var i,r;return t-=null!==(r=null===(i=e.estimatedProcessTime)||void 0===i?void 0:i.call(e))&&void 0!==r?r:2,t>0||1===n}n++,[s.TileTaskGroups.CREATE,s.TileTaskGroups.FETCH_AND_DECODE].forEach(e=>{this.m_taskQueue.numItemsLeft(e)&&this.m_taskQueue.processNext(e,l)}),a=this.m_taskQueue.numItemsLeft()}a=this.m_taskQueue.numItemsLeft(),a>0&&(null==i||i.setValue("TaskScheduler.pendingTasksNotYetProcessed",a),this.requestUpdate())}else this.m_taskQueue.processNext(s.TileTaskGroups.CREATE,void 0,this.m_taskQueue.numItemsLeft(s.TileTaskGroups.CREATE)),this.m_taskQueue.processNext(s.TileTaskGroups.FETCH_AND_DECODE,void 0,this.m_taskQueue.numItemsLeft(s.TileTaskGroups.FETCH_AND_DECODE));t.enabled&&(null==i||i.setValue("TaskScheduler.pendingTasksTime",n.PerformanceTimer.now()-r))}clearQueuedTasks(){this.m_taskQueue.clear()}spaceInFrame(e){const t=(performance||Date).now()-e;return Math.max(1e3/this.m_maxFps-t,0)}}t.MapViewTaskScheduler=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewThemeManager=void 0;const n=i(1),r=i(74),s=i(36),o=n.LoggerManager.instance.create("MapViewThemeManager");t.MapViewThemeManager=class{constructor(e,t){this.m_mapView=e,this.m_uriResolver=t,this.m_abortControllers=[],this.m_theme={},this.m_imageCache=new r.MapViewImageCache}async setTheme(e){return this.isUpdating()&&(o.warn("Formerly set Theme is still updating, update will be canceled"),this.cancelThemeUpdate()),this.m_updatePromise=this.loadTheme(e).then(async e=>{await this.updateTheme(e)}),await this.m_updatePromise,this.m_updatePromise=void 0,this.m_theme}async getTheme(){return this.isUpdating()&&await this.m_updatePromise,this.m_theme}isUpdating(){return void 0!==this.m_updatePromise}get theme(){return this.isUpdating()?{}:this.m_theme}async loadTheme(e){let t={};if("string"!=typeof e&&s.ThemeLoader.isThemeLoaded(e))t=e;else try{t=await s.ThemeLoader.load(e,{uriResolver:this.m_uriResolver,signal:this.createAbortController().signal})}catch(e){"AbortError"===e.name?o.warn("theme loading was aborted due to: "+e):o.error("failed to load theme: "+e)}return t}async updateTheme(e){var t,i;const n=this.m_mapView.sceneEnvironment;this.m_theme.fog=e.fog,this.m_theme.sky=e.sky,n.updateSkyBackground(e.sky),n.fog.reset(e.fog),this.m_theme.lights=e.lights,n.updateLighting(e.lights),this.m_theme.clearColor=e.clearColor,this.m_theme.clearAlpha=e.clearAlpha,n.updateClearColor(e.clearColor,e.clearAlpha),this.m_theme.images=e.images,this.m_theme.imageTextures=e.imageTextures,await this.updateImages(e.images,e.imageTextures),this.m_theme.poiTables=e.poiTables,await this.loadPoiTables(e.poiTables),this.m_theme.textStyles=e.textStyles,this.m_theme.defaultTextStyle=e.defaultTextStyle,this.m_theme.fontCatalogs=e.fontCatalogs,await this.m_mapView.resetTextRenderer(e.fontCatalogs,e.textStyles,e.defaultTextStyle),Array.isArray(e.priorities)&&(this.m_theme.priorities=e.priorities),this.m_mapView.mapAnchors.setPriorities(null!==(t=e.priorities)&&void 0!==t?t:[]),Array.isArray(e.labelPriorities)&&(this.m_theme.labelPriorities=e.labelPriorities),void 0===this.m_theme.styles&&(this.m_theme.styles={}),this.m_theme.styles=null!==(i=e.styles)&&void 0!==i?i:{},this.m_theme.definitions=e.definitions,n.clearBackgroundDataSource();for(const e of this.m_mapView.dataSources)await e.setTheme(this.m_theme)}updateCache(){this.updateImages(this.m_theme.images,this.m_theme.imageTextures),this.m_mapView.sceneEnvironment.updateLighting(this.m_theme.lights),this.m_mapView.sceneEnvironment.updateSkyBackground(this.m_theme.sky,this.m_theme.clearColor)}get imageCache(){return this.m_imageCache}dispose(){this.m_imageCache.clear()}async loadPoiTables(e){this.m_mapView.poiTableManager.clear(),await this.m_mapView.poiTableManager.loadPoiTables(e)}cancelThemeUpdate(){for(var e=0;e<this.m_abortControllers.length;e++)this.m_abortControllers[e].abort();this.m_abortControllers=[],this.m_imageCache.clear(),this.m_mapView.poiManager.clear(),this.m_mapView.poiTableManager.clear()}createAbortController(){return this.m_abortControllers.push(new AbortController),this.m_abortControllers[this.m_abortControllers.length-1]}async updateImages(e,t){if(this.m_imageCache.clear(),this.m_mapView.poiManager.clear(),void 0!==e)for(const t of Object.keys(e)){const i=e[t];this.m_imageCache.addImage(t,i.url,!0===i.preload),"string"==typeof i.atlas&&await this.m_mapView.poiManager.addTextureAtlas(t,i.atlas,this.createAbortController().signal)}void 0!==t&&t.forEach(e=>{this.m_mapView.poiManager.addImageTexture(e)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickingRaycaster=void 0;const n=i(0),r=i(33);function s(e,t,i,n){if(e.layers.test(t.layers)&&e.visible){const n=r.MapObjectAdapter.get(e);n&&!n.isPickable()||e.raycast(t,i)}if(!0===n)for(const n of e.children)s(n,t,i,!0)}class o extends n.Raycaster{constructor(e){super(),this.canvasSize=e}intersectObject(e,t,i){const n=null!=i?i:[];return s(e,this,n,t),n}intersectObjects(e,t,i){const n=null!=i?i:[];for(const i of e)s(i,this,n,t);return n}}t.PickingRaycaster=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickListener=void 0;const n=i(1);function r(e,t){var i,n;const r=null!==(i=e.dataSourceOrder)&&void 0!==i?i:0,s=null!==(n=t.dataSourceOrder)&&void 0!==n?n:0;if(r!==s)return s-r;const o=e.distance-t.distance,a=void 0!==e.renderOrder&&void 0!==t.renderOrder;return Math.abs(o)>1e-4||!a?o:t.renderOrder-e.renderOrder}t.PickListener=class{constructor(e){this.m_parameters=e,this.m_results=[],this.m_sorted=!0,this.m_finished=!0}addResult(e){const t=this.m_results.findIndex(t=>{var i,n,r,s;const o=t.type===e.type,a=null===(n=null===(i=e.intersection)||void 0===i?void 0:i.object.userData)||void 0===n?void 0:n.dataSource,l=a&&(null===(s=null===(r=t.intersection)||void 0===r?void 0:r.object.userData)||void 0===s?void 0:s.dataSource)===a,c=void 0!==e.featureId&&t.featureId===e.featureId,h=void 0===e.featureId&&void 0===t.featureId,u=e.userData&&t.userData===e.userData;return o&&l&&(c||h&&u)});if(t<0)return this.m_sorted=!1,this.m_finished=!1,void this.m_results.push(e);const i=this.m_results[t];r(e,i)<0&&(this.m_results[t]=e,this.m_sorted=!1,this.m_finished=!1)}get done(){return!!this.maxResults&&this.m_results.length>=this.maxResults}finish(){this.sortResults(),this.maxResults&&this.m_results.length>this.maxResults&&(this.m_results.length=this.maxResults),this.m_finished=!0}get results(){return n.assert(this.m_finished,"finish() was not called before getting the results"),this.m_results}get closestResult(){return this.sortResults(),this.m_results.length>0?this.m_results[0]:void 0}get furthestResult(){return this.sortResults(),this.m_results.length>0?this.m_results[this.m_results.length-1]:void 0}get maxResults(){var e,t;const i=null!==(t=null===(e=this.m_parameters)||void 0===e?void 0:e.maxResultCount)&&void 0!==t?t:0;return i>0?i:void 0}sortResults(){if(this.m_sorted)return;const e=[],t=[];this.m_results.sort(r).forEach(i=>(0===i.distance?e:t).push(i)),this.m_results=e.concat(t),this.m_sorted=!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FontCatalog=void 0;const n=i(0),r=i(26),s=i(76),o=i(285),a=i(27);class l{constructor(e,t,i,n,r,s,a,l,c,h,u){this.url=e,this.name=t,this.type=i,this.size=n,this.maxWidth=r,this.maxHeight=s,this.distanceRange=a,this.fonts=l,this.unicodeBlocks=c,this.maxCodePointCount=h,this.m_replacementGlyph=u,this.showReplacementGlyphs=!1,this.m_glyphTextureCache=new o.GlyphTextureCache(h,this.maxWidth+1,this.maxHeight+1),this.m_loadingJson=new Map,this.m_loadingPages=new Map,this.m_loadingGlyphs=new Map,this.m_loadedJson=new Map,this.m_loadedPages=new Map,this.m_loadedGlyphs=new Map}static async load(e,t){const i=new URL(e,window.location.href),r=await l.loadJSON(i.href),o=new URL(r.name+"_Assets/Extra/",i),a=await l.loadJSON(o.href+"Specials.json"),c=await l.loadTexture(o.href+"Specials.png");c.wrapS=n.ClampToEdgeWrapping,c.wrapT=n.ClampToEdgeWrapping,c.minFilter=n.NearestFilter,c.needsUpdate=!0;const h=r.fonts.find(e=>"Extra"===e.name),u=new s.GlyphData(65533,"Specials",a.chars[0].width,a.chars[0].height,a.chars[0].xadvance,a.chars[0].xoffset,a.chars[0].yoffset,0,0,1,1,c,h,!0);return new l(i.href.substr(0,i.href.lastIndexOf("/")),r.name,r.type,r.size,r.maxWidth,r.maxHeight,r.distanceRange,r.fonts,r.supportedBlocks,t,u)}static async loadTexture(e){return await new Promise(t=>{(new n.TextureLoader).load(e,t)})}static async loadJSON(e){const t=await fetch(e);if(!t.ok)throw new Error(`${e} Status Text:  ${t.statusText}`);const i=await t.text();return JSON.parse(i)}dispose(){this.fonts.length=0,this.unicodeBlocks.length=0,this.m_glyphTextureCache.dispose(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}clear(){this.m_glyphTextureCache.clear(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}update(e){this.m_glyphTextureCache.update(e)}get texture(){return this.m_glyphTextureCache.texture}get textureSize(){return this.m_glyphTextureCache.textureSize}get isLoading(){return this.m_loadingJson.size>0||this.m_loadingPages.size>0||this.m_loadingGlyphs.size>0}async loadBlock(e,t,i,n){const r=this.getAssetsPath(i,t),s=`${r}/${e.name.replace(/ /g,"_")}.json`;let o=this.m_loadedJson.get(s);if(void 0===o){let e=this.m_loadingJson.get(s);if(void 0===e)try{e=l.loadJSON(s),this.m_loadingJson.set(s,e),o=await e,this.m_loadingJson.delete(s),this.m_loadedJson.set(s,o)}catch(e){console.error(e),this.m_loadingJson.delete(s)}else o=await e}const a=[];if(!0===n)for(const e of o.pages)a.push(this.loadPage(`${r}/${e}`));return await Promise.all(a),o}removeBlock(e,t,i){const n=this.getAssetsPath(i,t),r=`${n}/${e.name.replace(/ /g,"_")}.json`,s=this.m_loadedJson.get(r);if(void 0!==s){for(const e of s.pages){const t=`${n}/${e}`;this.m_loadingPages.delete(t),this.m_loadedPages.delete(t)}this.m_loadingJson.delete(r),this.m_loadedJson.delete(r)}}async loadCharset(e,t){const i=t.fontName,n=t.fontStyle,r=(t.fontVariant===a.FontVariant.AllCaps||t.fontVariant===a.FontVariant.SmallCaps?e.toUpperCase():e).replace(/[\s\S](?=([\s\S]+))/g,(e,t)=>t.indexOf(e)+1?"":e),s=[];for(const e of r){const t=e.codePointAt(0),r=this.getFont(t,i),o=`${r.name}_${n}`,a=`${o}_${t}`;let l=this.m_loadedGlyphs.get(o);void 0===l&&(l=new Map,this.m_loadedGlyphs.set(o,l));const c=l.get(t);if(void 0===c){let i=this.m_loadingGlyphs.get(a);if(void 0===i){if(!r.charset.includes(String.fromCodePoint(t))){const i=this.createReplacementGlyph(t,e,r);l.set(t,i),this.m_glyphTextureCache.add(a,i);continue}let s;for(const e of this.unicodeBlocks)if(t>=e.min&&t<=e.max){s=e;break}i=this.loadAssets(t,n,s,r),this.m_loadingGlyphs.set(a,i),i.then(e=>{this.m_loadingGlyphs.delete(a),l.set(t,e),this.m_glyphTextureCache.add(a,e)})}s.push(i)}else this.m_glyphTextureCache.has(a)||(s.push(Promise.resolve(c)),this.m_glyphTextureCache.add(a,c))}return Promise.all(s)}getGlyph(e,t,i){const n=this.m_loadedGlyphs.get(`${t.name}_${i}`);if(void 0!==n)return n.get(e)}getGlyphs(e,t,i){const n=[],r=t.fontName,s=t.fontStyle,o=t.fontVariant,l=o===a.FontVariant.AllCaps||o===a.FontVariant.SmallCaps;for(const t of e){const e=l?t.toUpperCase():t;for(const o of e){const e=o.codePointAt(0),a=this.getFont(e,r),l=this.getGlyph(e,a,s);if(void 0===l||l.isReplacement&&!this.showReplacementGlyphs)return;n.push(l),void 0!==i&&i.push(o!==t)}}return n}getFont(e,t){let i=this.fonts[0].name;for(const n of this.unicodeBlocks)if(e>=n.min&&e<=n.max){i=void 0!==t&&void 0!==n.fonts.find(e=>e===t)?t:n.fonts[0];break}return this.fonts.find(e=>e.name===i)}updateMemoryUsage(e){let t=0;for(const e of this.unicodeBlocks)t+=2*(e.max-e.min);let i=this.m_glyphTextureCache.textureSize.x*this.m_glyphTextureCache.textureSize.y*4;for(const e in this.m_loadedPages.entries)if(void 0!==this.m_loadedPages.get(e)){const t=this.m_loadedPages.get(e);void 0!==t&&(i+=t.image.width*t.image.height*4)}e.heapSize+=t+i,e.gpuSize+=i}createReplacementGlyph(e,t,i){const n=this.m_replacementGlyph.clone();return n.codePoint=e,n.character=t,n.font=i,n.isReplacement=r.UnicodeUtils.isPrintable(e),n}async loadAssets(e,t,i,n){const r=await this.loadBlock(i,n,t);if(void 0===r)return this.m_replacementGlyph;const o=r.chars.find(t=>t.id===e),a=`${this.getAssetsPath(t,n)}/${r.pages[o.page]}`,l=await this.loadPage(a);return new s.GlyphData(o.id,i.name,o.width,o.height,o.xadvance,o.xoffset,o.yoffset,o.x/l.image.width,1-(o.y+o.height)/l.image.height,(o.x+o.width)/l.image.width,1-o.y/l.image.height,l,n)}async loadPage(e){let t=this.m_loadedPages.get(e);if(void 0===t){let i=this.m_loadingPages.get(e);void 0===i?(i=l.loadTexture(e),this.m_loadingPages.set(e,i),t=await i,t.wrapS=n.ClampToEdgeWrapping,t.wrapT=n.ClampToEdgeWrapping,t.minFilter=n.NearestFilter,t.needsUpdate=!0,this.m_loadingPages.delete(e)&&this.m_loadedPages.set(e,t),this.m_loadingPages.delete(e)):t=await i}return t}getAssetsPath(e,t){let i="_Assets/";switch(e){case a.FontStyle.Bold:void 0!==t.bold&&(i="_BoldAssets/");break;case a.FontStyle.Italic:void 0!==t.italic&&(i="_ItalicAssets/");break;case a.FontStyle.BoldItalic:void 0!==t.boldItalic?i="_BoldItalicAssets/":void 0!==t.italic?i="_ItalicAssets/":void 0!==t.bold&&(i="_BoldAssets/")}return`${this.url}/${this.name}${i}${t.name}`}}t.FontCatalog=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphTextureCache=void 0;const n=i(77),r=i(0),s=i(76),o=i(145);t.GlyphTextureCache=class{constructor(e,t,i){this.capacity=e,this.entryWidth=t,this.entryHeight=i;const s=Math.floor(Math.sqrt(e));this.m_cacheHeight=s*s<e?s+1:s,this.m_cacheWidth=s*this.m_cacheHeight<e?s+1:s,this.m_textureSize=new r.Vector2(this.m_cacheWidth*t,this.m_cacheHeight*i),(this.m_textureSize.y>4096||this.m_textureSize.x>4096)&&console.warn("GlyphTextureCache texture size ("+this.m_textureSize.x+", "+this.m_textureSize.y+") exceeds WebGL's widely supported MAX_TEXTURE_SIZE (4096).\nThis could result in rendering errors on some devices.\nPlease consider reducing its capacity or input assets size."),this.m_entryCache=new n.LRUCache(e),this.initCacheEntries(),this.m_scene=new r.Scene,this.m_camera=new r.OrthographicCamera(0,this.m_textureSize.x,this.m_textureSize.y,0),this.m_camera.position.z=1,this.m_camera.updateMatrixWorld(!1),this.m_rt=new r.WebGLRenderTarget(this.m_textureSize.x,this.m_textureSize.y,{wrapS:r.ClampToEdgeWrapping,wrapT:r.ClampToEdgeWrapping,depthBuffer:!1,stencilBuffer:!1}),this.m_copyTextureSet=new Set,this.m_copyTransform=new r.Matrix3,this.m_copyPositions=[],this.m_copyPositions.push(new r.Vector2,new r.Vector2,new r.Vector2,new r.Vector2),this.m_copyVertexBuffer=new r.InterleavedBuffer(new Float32Array(20*e),5),this.m_copyVertexBuffer.setUsage(r.DynamicDrawUsage),this.m_copyPositionAttribute=new r.InterleavedBufferAttribute(this.m_copyVertexBuffer,3,0),this.m_copyUVAttribute=new r.InterleavedBufferAttribute(this.m_copyVertexBuffer,2,3),this.m_copyGeometry=new r.BufferGeometry,this.m_copyGeometry.setAttribute("position",this.m_copyPositionAttribute),this.m_copyGeometry.setAttribute("uv",this.m_copyUVAttribute);const o=new r.BufferAttribute(new Uint32Array(6*e),1);o.setUsage(r.DynamicDrawUsage),this.m_copyGeometry.setIndex(o),this.m_copyMesh=new r.Mesh(this.m_copyGeometry),this.m_copyMesh.frustumCulled=!1,this.m_copyGeometryDrawCount=0,this.m_clearPositionAttribute=new r.BufferAttribute(new Float32Array(8*e),2),this.m_clearPositionAttribute.setUsage(r.DynamicDrawUsage),this.m_clearGeometry=new r.BufferGeometry,this.m_clearGeometry.setAttribute("position",this.m_clearPositionAttribute);const a=new r.BufferAttribute(new Uint32Array(6*e),1);a.setUsage(r.DynamicDrawUsage),this.m_clearGeometry.setIndex(a),this.m_clearMesh=new r.Mesh(this.m_clearGeometry),this.m_clearMesh.frustumCulled=!1,this.m_clearGeometryDrawCount=0,this.m_scene.add(this.m_clearMesh,this.m_copyMesh)}dispose(){var e,t;this.m_entryCache.clear(),this.m_scene.remove(this.m_clearMesh,this.m_copyMesh),this.m_rt.dispose(),null===(e=this.m_clearMaterial)||void 0===e||e.dispose(),null===(t=this.m_copyMaterial)||void 0===t||t.dispose(),this.m_copyTextureSet.clear(),this.m_clearGeometry.dispose(),this.m_copyGeometry.dispose()}get texture(){return this.m_rt.texture}get textureSize(){return this.m_textureSize}add(e,t){if(void 0!==this.m_entryCache.get(e))return;const i=this.m_entryCache.oldest;if(null===i)throw new Error("GlyphTextureCache is uninitialized!");this.clearCacheEntry(i.value),this.copyGlyphToCache(e,t,i.value.location)}has(e){return this.m_entryCache.has(e)}get(e){return this.m_entryCache.get(e)}clear(){this.m_copyGeometryDrawCount=0,this.m_clearGeometryDrawCount=0,this.m_entryCache.clear(),this.m_copyTextureSet.clear(),this.initCacheEntries()}update(e){let t=null;const i=this.m_clearGeometryDrawCount>0,n=this.m_copyGeometryDrawCount>0;if((i||n)&&(t=e.getRenderTarget(),e.setRenderTarget(this.m_rt)),i){if(this.m_clearMaterial||(this.m_clearMaterial=new o.GlyphClearMaterial({rendererCapabilities:e.capabilities}),this.m_clearMesh.material=this.m_clearMaterial),null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearPositionAttribute.needsUpdate=!0,this.m_clearPositionAttribute.updateRange.offset=0,this.m_clearPositionAttribute.updateRange.count=8*this.m_clearGeometryDrawCount,this.m_clearGeometry.index.needsUpdate=!0,this.m_clearGeometry.index.updateRange.offset=0,this.m_clearGeometry.index.updateRange.count=6*this.m_clearGeometryDrawCount,this.m_clearGeometry.setDrawRange(0,6*this.m_clearGeometryDrawCount),this.m_clearMesh.visible=!0,this.m_copyMesh.visible=!1,e.render(this.m_scene,this.m_camera),this.m_clearGeometryDrawCount=0,this.m_clearMesh.visible=!1}if(n){if(this.m_copyMaterial||(this.m_copyMaterial=new o.GlyphCopyMaterial({rendererCapabilities:e.capabilities}),this.m_copyMesh.material=this.m_copyMaterial),null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyVertexBuffer.needsUpdate=!0,this.m_copyVertexBuffer.updateRange.offset=0,this.m_copyVertexBuffer.updateRange.count=20*this.m_copyGeometryDrawCount,this.m_copyGeometry.index.needsUpdate=!0,this.m_copyGeometry.index.updateRange.offset=0,this.m_copyGeometry.index.updateRange.count=6*this.m_copyGeometryDrawCount,this.m_copyGeometry.setDrawRange(0,6*this.m_copyGeometryDrawCount),this.m_copyMesh.visible=!0;const t=Array.from(this.m_copyTextureSet),i=Math.ceil(this.m_copyTextureSet.size/8);for(let n=0;n<i;n++){const i=8*n;this.m_copyMaterial.uniforms.pageOffset.value=i;for(let e=0;e<8;e++){const n=i+e;n<this.m_copyTextureSet.size&&(this.m_copyMaterial.uniforms["page"+e].value=t[n])}e.render(this.m_scene,this.m_camera)}this.m_copyTextureSet.clear(),this.m_copyGeometryDrawCount=0}(i||n)&&e.setRenderTarget(t)}initCacheEntries(){const e={name:"",metrics:{size:0,distanceRange:0,base:0,lineHeight:0,lineGap:0,capHeight:0,xHeight:0},charset:""},t=new s.GlyphData(0,"",0,0,0,0,0,0,0,0,0,r.Texture.DEFAULT_IMAGE,e);for(let e=0;e<this.m_cacheHeight;e++)for(let i=0;i<this.m_cacheWidth;i++){const n={glyphData:t,location:new r.Vector2(i,e)};this.m_entryCache.set("Dummy_"+(e*this.m_cacheHeight+i),n)}}copyGlyphToCache(e,t,i){this.m_copyTextureSet.add(t.texture);let n=0;for(const e of this.m_copyTextureSet.values()){if(e===t.texture)break;n++}t.copyIndex=n,this.m_copyTransform.set(1,0,i.x*this.entryWidth-t.offsetX,0,1,i.y*this.entryHeight-t.positions[0].y,0,0,0);for(let e=0;e<4;++e)this.m_copyPositions[e].set(t.positions[e].x,t.positions[e].y),this.m_copyPositions[e].applyMatrix3(this.m_copyTransform);if(this.m_copyGeometryDrawCount>=this.capacity)return;const r=4*this.m_copyGeometryDrawCount,s=6*this.m_copyGeometryDrawCount;for(let e=0;e<4;++e)this.m_copyPositionAttribute.setXYZ(r+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y,t.copyIndex),this.m_copyUVAttribute.setXY(r+e,t.sourceTextureCoordinates[e].x,t.sourceTextureCoordinates[e].y);if(null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyGeometry.index.setX(s,r),this.m_copyGeometry.index.setX(s+1,r+1),this.m_copyGeometry.index.setX(s+2,r+2),this.m_copyGeometry.index.setX(s+3,r+2),this.m_copyGeometry.index.setX(s+4,r+1),this.m_copyGeometry.index.setX(s+5,r+3),++this.m_copyGeometryDrawCount;const o=this.m_copyPositions[0].x/this.m_textureSize.x,a=this.m_copyPositions[0].y/this.m_textureSize.y,l=this.m_copyPositions[3].x/this.m_textureSize.x,c=this.m_copyPositions[3].y/this.m_textureSize.y;t.dynamicTextureCoordinates[0].set(o,a),t.dynamicTextureCoordinates[1].set(l,a),t.dynamicTextureCoordinates[2].set(o,c),t.dynamicTextureCoordinates[3].set(l,c),t.isInCache=!0,this.m_entryCache.set(e,{glyphData:t,location:i})}clearCacheEntry(e){if(e.glyphData.isInCache=!1,this.m_copyPositions[0].set(e.location.x*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[1].set((e.location.x+1)*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[2].set(e.location.x*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_copyPositions[3].set((e.location.x+1)*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_clearGeometryDrawCount>=this.capacity)return;const t=4*this.m_clearGeometryDrawCount,i=6*this.m_clearGeometryDrawCount;for(let e=0;e<4;++e)this.m_clearPositionAttribute.setXY(t+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y);if(null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearGeometry.index.setX(i,t),this.m_clearGeometry.index.setX(i+1,t+1),this.m_clearGeometry.index.setX(i+2,t+2),this.m_clearGeometry.index.setX(i+3,t+2),this.m_clearGeometry.index.setX(i+4,t+1),this.m_clearGeometry.index.setX(i+5,t+3),++this.m_clearGeometryDrawCount}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=t.Entry=void 0;const n=i(1);class r{constructor(e,t,i,n,r){this.key=e,this.value=t,this.size=i,this.newer=n,this.older=r}}t.Entry=r;t.LRUCache=class{constructor(e,t=(()=>1)){this.m_size=0,this.m_map=new Map,this.m_newest=null,this.m_oldest=null,this.m_capacity=e,this.m_sizeFunction=t}forEach(e,t){let i=this.m_newest;for(;null!==i;){const n=i.older;e.call(t,i.value,i.key,this),i=n}}get size(){return this.m_size}get capacity(){return this.m_capacity}get map(){return this.m_map}get newest(){return this.m_newest}get oldest(){return this.m_oldest}setCapacity(e){this.m_capacity=e,this.evict()}setCapacityAndMeasure(e,t=(()=>1)){this.m_capacity=e,this.m_sizeFunction=t,this.shrinkToCapacity()}shrinkToCapacity(){let e=0;const t=this.m_sizeFunction;let i=this.m_newest;for(;null!==i;){const n=t(i.value);i.size=n,e+=n,i=i.older}this.m_size=e,this.evict()}set(e,t){const i=this.m_sizeFunction(t);let s=this.m_map.get(e);if(void 0!==s)this.m_size=this.m_size-s.size+i,s.value=t,s.size=i,this.promoteEntry(s),this.evict();else{if(i>this.m_capacity)return;if(s=new r(e,t,i,null,null),0===this.m_map.size)this.m_newest=this.m_oldest=s;else{n.assert(null!==this.m_newest);const e=this.m_newest;s.older=this.m_newest,e.newer=s,this.m_newest=s}this.m_map.set(e,s),this.m_size+=i,this.evict()}}get(e){const t=this.m_map.get(e);if(void 0!==t)return this.promoteEntry(t),t.value}has(e){return this.m_map.has(e)}clear(){this.m_newest=this.m_oldest=null,this.m_size=0,this.m_map.clear()}evictAll(){const e=this.evictionCallback;void 0!==e&&this.forEach((t,i)=>e(i,t)),this.clear()}evictSelected(e,t){const i=this.evictionCallback;let n=this.m_newest;for(;null!==n;){const r=n.older;e.call(t,n.value,n.key)&&(void 0!==i&&i(n.key,n.value),this.deleteEntry(n),this.m_map.delete(n.key)),n=r}}delete(e){const t=this.m_map.get(e);return void 0!==t&&(this.deleteEntry(t),this.m_map.delete(e))}evict(){for(;null!==this.m_oldest&&this.m_size>this.m_capacity;){if(void 0===this.evictOldest())return}}evictOldest(){n.assert(null!==this.m_oldest);const e=this.m_oldest;n.assert(null===e.older);let t=e;if(void 0!==this.canEvict)for(;!this.canEvict(t.key,t.value);){if(null===t.newer)return;t=t.newer}if(t===e)this.m_oldest=t.newer,null!==t.newer&&(n.assert(t.newer.older===t),t.newer.older=null);else{if(null===t.newer)return;n.assert(t.newer.older===t),t.newer.older=t.older,null!==t.older&&(t.older.newer=t.newer)}const i=this.m_map.delete(t.key);return n.assert(!0===i),i&&void 0!==this.evictionCallback&&this.evictionCallback(t.key,t.value),this.m_size-=t.size,t}deleteEntry(e){e===this.m_newest?this.m_newest=e.older:e.newer?e.newer.older=e.older:n.assert(!1),e===this.m_oldest?this.m_oldest=e.newer:e.older?e.older.newer=e.newer:n.assert(!1),this.m_size-=e.size}promoteEntry(e){if(e===this.m_newest)return;e.newer&&(n.assert(e.newer.older===e),e.newer.older=e.older),e.older&&(n.assert(e.older.newer===e),e.older.newer=e.newer),e===this.m_oldest&&(this.m_oldest=e.newer),e.newer=null,e.older=this.m_newest,n.assert(null!==this.m_newest);const t=this.m_newest;n.assert(null===t.newer),t.newer=e,this.m_newest=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextCanvas=t.DEFAULT_TEXT_CANVAS_LAYER=void 0;const n=i(0),r=i(146),s=i(78),o=i(27),a=i(288),l=i(289),c=i(147),h=new n.Vector3,u={array:[new n.Box2],offset:0};let d=new Float32Array;t.DEFAULT_TEXT_CANVAS_LAYER=0;class m{constructor(e){this.m_renderer=e.renderer,this.m_fontCatalog=e.fontCatalog,this.minGlyphCount=e.minGlyphCount,this.maxGlyphCount=e.maxGlyphCount,this.name=e.name,void 0===e.material?(this.m_ownsMaterial=!0,this.m_material=c.createSdfTextMaterial({fontCatalog:e.fontCatalog,rendererCapabilities:this.m_renderer.capabilities})):(this.m_ownsMaterial=!1,this.m_material=e.material),void 0===e.backgroundMaterial?(this.m_ownsBgMaterial=!0,this.m_bgMaterial=c.createSdfTextMaterial({fontCatalog:e.fontCatalog,isBackground:!0,rendererCapabilities:this.m_renderer.capabilities})):(this.m_ownsBgMaterial=!1,this.m_bgMaterial=e.backgroundMaterial),this.m_defaultLayer={id:t.DEFAULT_TEXT_CANVAS_LAYER,storage:new s.TextGeometry(new n.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers=[this.m_defaultLayer],this.m_currentTextRenderStyle=(new o.TextRenderStyle).copy(m.defaultTextRenderStyle),this.m_currentTextLayoutStyle=(new o.TextLayoutStyle).copy(m.defaultTextLayoutStyle),this.m_lineTypesetter=new a.LineTypesetter,this.m_pathTypesetter=new l.PathTypesetter}get fontCatalog(){return this.m_fontCatalog}set fontCatalog(e){this.m_fontCatalog=e;const t=this.m_material;t.uniforms.sdfTexture.value=this.m_fontCatalog.texture,t.uniforms.sdfParams.value=new n.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),t.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0;const i=this.m_bgMaterial;i.uniforms.sdfTexture.value=this.m_fontCatalog.texture,i.uniforms.sdfParams.value=new n.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),i.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0}get material(){return this.m_material}set material(e){this.m_ownsMaterial&&(this.m_material.dispose(),this.m_ownsMaterial=!1),this.m_material=e;for(const e of this.m_layers)e.storage.mesh.material=this.m_material}get backgroundMaterial(){return this.m_bgMaterial}set backgroundMaterial(e){this.m_ownsBgMaterial&&(this.m_bgMaterial.dispose(),this.m_ownsBgMaterial=!1),this.m_bgMaterial=e;for(const e of this.m_layers)e.storage.backgroundMesh.material=this.m_bgMaterial}get textRenderStyle(){return this.m_currentTextRenderStyle}set textRenderStyle(e){this.m_currentTextRenderStyle.copy(e)}get textLayoutStyle(){return this.m_currentTextLayoutStyle}set textLayoutStyle(e){this.m_currentTextLayoutStyle.copy(e)}clear(){for(const e of this.m_layers)e.storage.clear();this.m_currentTextRenderStyle.copy(m.defaultTextRenderStyle),this.m_currentTextLayoutStyle.copy(m.defaultTextLayoutStyle)}render(e,t,i,n,r){this.m_fontCatalog.update(this.m_renderer);let s=null;void 0!==n&&(s=this.m_renderer.getRenderTarget(),this.m_renderer.setRenderTarget(n)),!0===r&&this.m_renderer.clear(!0);for(let n=0;n<this.m_layers.length;n++){const r=this.m_layers[n];if(r.id>=(null!=t?t:0)){if(!(void 0===i||r.id<i))break;r.storage.update(),this.m_renderer.render(r.storage.scene,e)}}void 0!==n&&this.m_renderer.setRenderTarget(s)}addLayer(e){let t=this.getLayer(e);return void 0===t&&(t={id:e,storage:new s.TextGeometry(new n.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers.push(t),this.m_layers.sort((e,t)=>e.id-t.id)),t}getLayer(e){return this.m_layers.find(t=>t.id===e)}getAllLayers(){return this.m_layers}measureText(e,t,i){let n,r,s,o;if(h.set(0,0,0),void 0!==i){if(n=i.path,r=i.pathOverflow,o=i.outputCharacterBounds,void 0!==i.path){const e=i.path.getPoint(0);if(null===e)return!1;h.set(e.x,e.y,0)}i.letterCaseArray&&(s=i.letterCaseArray)}return this.placeText({input:e,layer:this.m_defaultLayer,textPath:n,textPathOverflow:r,bounds:t,individualBounds:o,letterCaseArray:s})}addText(e,t,i){let n,r,s;h.copy(t);let o=this.m_defaultLayer;if(void 0!==i){if(n=i.path,r=i.pathOverflow,void 0!==i.layer){let e=this.getLayer(i.layer);void 0===e&&(e=this.addLayer(i.layer)),o=e}void 0!==i.path&&h.set(0,0,h.z),i.letterCaseArray&&(s=i.letterCaseArray)}const a=o.storage.drawCount,l=this.placeText({input:e,textPath:n,textPathOverflow:r,layer:o,letterCaseArray:s});return l&&void 0!==i?(!0===i.updatePosition&&t.copy(h),void 0!==i.pickingData&&o.storage.addPickingData(a,o.storage.drawCount,i.pickingData)):l||(o.storage.m_drawCount=a),l}createTextBufferObject(e,t){let i,s;h.set(0,0,0);const a=this.m_currentTextRenderStyle.fontVariant===o.FontVariant.SmallCaps;if("string"!=typeof e)i=e,void 0!==t&&t.letterCaseArray&&(s=t.letterCaseArray);else if(s=[],i=this.m_fontCatalog.getGlyphs(e,this.m_currentTextRenderStyle,a?s:void 0),void 0===i)return;let l,c,u,m,p,f;return void 0!==t&&(l=t.path,c=t.pathOverflow,!0===t.outputBounds&&(u=new n.Box2),!0===t.outputCharacterBounds&&(m=[]),!0===t.storeStyles&&(p=this.m_currentTextRenderStyle.clone(),f=this.m_currentTextLayoutStyle.clone())),this.placeText({input:e,layer:this.m_defaultLayer,computeTextBuffer:!0,textPath:l,textPathOverflow:c,bounds:u,individualBounds:m,letterCaseArray:s}),new r.TextBufferObject(i,new Float32Array(d),u,m,p,f)}addTextBufferObject(e,t){var i;let n,r,s,o,a,l,c,h=this.m_defaultLayer;if(void 0!==t){if(void 0!==t.layer){let e=this.getLayer(t.layer);void 0===e&&(e=this.addLayer(t.layer)),h=e}n=null===(i=t.position)||void 0===i?void 0:i.clone(),r=t.scale,s=t.rotation,o=t.color,a=t.opacity,l=t.backgroundColor,c=t.backgroundOpacity}const u=h.storage.drawCount,d=h.storage.addTextBufferObject(e,n,r,s,o,a,l,c);return d&&void 0!==t?void 0!==t.pickingData&&h.storage.addPickingData(u,h.storage.drawCount,t.pickingData):d||(h.storage.m_drawCount=u),d}pickText(e,t){for(const i of this.m_layers)i.storage.pick(e,t)}getMemoryUsage(e){this.m_fontCatalog.updateMemoryUsage(e);for(const t of this.m_layers)t.storage.updateMemoryUsage(e)}placeText(e){if(0===e.input.length||0===this.m_currentTextLayoutStyle.maxLines)return void 0!==e.bounds&&(e.bounds.min.set(0,0),e.bounds.max.set(0,0)),void 0!==e.individualBounds&&(e.individualBounds.length=0),!0;let t,i;const n=this.m_currentTextRenderStyle.fontVariant===o.FontVariant.SmallCaps;if("string"!=typeof e.input)t=e.input,e.letterCaseArray&&(i=e.letterCaseArray);else if(i=[],t=this.m_fontCatalog.getGlyphs(e.input,this.m_currentTextRenderStyle,n?i:void 0),void 0===t)return!1;let r;void 0!==e.individualBounds&&(u.array=e.individualBounds,u.offset=0,r=u),void 0!==e.bounds&&(e.bounds.min.set(1/0,1/0),e.bounds.max.set(-1/0,-1/0)),!0===e.computeTextBuffer&&(d=new Float32Array(t.length*s.QUAD_VERTEX_MEMORY_FOOTPRINT));const a=void 0!==e.textPath,l={glyphs:t,fontCatalog:this.m_fontCatalog,textRenderStyle:this.m_currentTextRenderStyle,textLayoutStyle:this.m_currentTextLayoutStyle,position:h,geometry:e.layer.storage,smallCapsArray:n?i:void 0,globalBounds:e.bounds,individualBounds:r,vertexBuffer:!0===e.computeTextBuffer?d:void 0};let c=!0;return a?(Object.assign(l,{path:e.textPath,pathOverflow:!0===e.textPathOverflow}),c=this.m_pathTypesetter.arrangeGlyphs(l)):c=this.m_lineTypesetter.arrangeGlyphs(l),void 0!==r&&(r.array.length=r.offset),c}}t.TextCanvas=m,m.defaultTextRenderStyle=new o.TextRenderStyle,m.defaultTextLayoutStyle=new o.TextLayoutStyle},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineTypesetter=void 0;const n=i(0),r=i(78),s=i(27),o=i(79),a=i(26);t.LineTypesetter=class{constructor(){this.m_tempTransform=new n.Matrix3,this.m_tempCorners=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],this.m_tempLineDirection=a.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=a.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_currentParams.position.y+=this.m_currentParams.textLayoutStyle.verticalAlignment*this.m_currentParams.glyphs[0].font.metrics.capHeight*this.m_tempScale;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer,i=this.m_currentParams.position.x,n=this.m_currentParams.glyphs[0].font.metrics.lineHeight+this.m_currentParams.textLayoutStyle.leading;let r=0,l=0,c=0,h=0,u=0,d=0,m=0,p=0,f=!1;for(let e=0;e<this.m_currentParams.glyphs.length&&!(p>this.m_currentParams.textLayoutStyle.maxLines-1);++e){const g=this.m_currentParams.glyphs[e];if(!g.isInCache&&!t)return!1;const v=a.UnicodeUtils.isNewLine(g.codePoint),y=a.UnicodeUtils.isWhiteSpace(g.codePoint);if(f||g.direction!==-this.m_tempLineDirection||(f=!0),a.UnicodeUtils.isPrintable(g.codePoint)&&(u+=(g.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1)),e===r&&(h=u,d=u,m=u),v||this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Character&&u>this.m_currentParams.textLayoutStyle.lineWidth||this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&u>this.m_currentParams.textLayoutStyle.lineWidth&&m!==h){if(this.m_currentParams.textLayoutStyle.wrappingMode!==s.WrappingMode.None){let t=l,i=d;this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&m!==h&&(t=c,i=m),u=i,e=Math.min(v?r===e?t:e:t,this.m_currentParams.glyphs.length-1)}const t=this.m_tempLineDirection===a.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.x=this.m_currentParams.position.x+u*t,!this.placeLine(r,e,this.m_tempLineDirection,f))return!1;for(this.m_currentParams.position.y-=n*this.m_tempScale,this.m_currentParams.position.x=i;e!==r&&e+1<this.m_currentParams.glyphs.length&&a.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint);)++e;if(r=e+1,r===this.m_currentParams.glyphs.length)break;v&&(this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,r),this.m_tempRunDirection=this.m_tempLineDirection),h=0,u=0,l=r,d=0,c=r,m=0,f=!1,p++}else this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.None||y||(l=e,d=u,this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&e+1<this.m_currentParams.glyphs.length&&(a.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint)||a.UnicodeUtils.isNewLine(this.m_currentParams.glyphs[e+1].codePoint))&&(c=e,m=u))}if(p<=this.m_currentParams.textLayoutStyle.maxLines-1&&r<=this.m_currentParams.glyphs.length-1){const e=this.m_tempLineDirection===a.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.setX(this.m_currentParams.position.x+u*e),!this.placeLine(r,this.m_currentParams.glyphs.length-1,this.m_tempLineDirection,f))return!1}return!0}placeLine(e,t,i,n){if(!n)return this.placeRun(e,t,i);const r=this.m_currentParams.glyphs,s=this.m_currentParams.smallCapsArray,l=this.m_currentParams.textRenderStyle,c=this.m_currentParams.textLayoutStyle,h=this.m_currentParams.position,u=i===a.UnicodeUtils.Direction.RTL,d=h.x;let m=0,p=e;for(let n=e;n<=t;++n){const e=r[n];if(e.direction===-this.m_tempRunDirection){if(u&&(h.x=d+m),!this.placeRun(p,n-1,this.m_tempRunDirection))return!1;u||(h.x=d+m),p=n,this.m_tempRunDirection*=-1}else if(e.direction===a.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-i){let e=n;for(;e+1<r.length&&1!==Math.abs(r[e].direction);)++e;if(r[e].direction!==this.m_tempRunDirection){if(u&&(h.x=d+m),!this.placeRun(p,n-1,this.m_tempRunDirection))return!1;u||(h.x=d+m),p=n,this.m_tempRunDirection*=-1}}m+=(e.advanceX+c.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(r,s,n,l.fontVariant):1)*i}if(p<=t){if(u&&(h.x=d+m),!this.placeRun(p,t,this.m_tempRunDirection))return!1;u||(h.x=d+m)}return!0}placeRun(e,t,i){const n=this.m_currentParams.glyphs,l=this.m_currentParams.smallCapsArray,c=this.m_currentParams.fontCatalog,h=this.m_currentParams.textRenderStyle,u=this.m_currentParams.textLayoutStyle,d=this.m_currentParams.position,m=this.m_currentParams.geometry,p=this.m_currentParams.globalBounds,f=this.m_currentParams.individualBounds,g=this.m_currentParams.vertexBuffer,v=i===a.UnicodeUtils.Direction.LTR?e:t,y=i===a.UnicodeUtils.Direction.LTR?t:e;for(let _=v;i===a.UnicodeUtils.Direction.RTL?_>=y:_<=y;_+=i){const v=n[_];if(!a.UnicodeUtils.isPrintable(v.codePoint))continue;if(e!==t&&0!==_&&i===a.UnicodeUtils.Direction.RTL&&v.direction===a.UnicodeUtils.Direction.Weak){let t=_,i=n[t-1];for(;t!==e&&(i.direction===a.UnicodeUtils.Direction.Weak||i.direction===a.UnicodeUtils.Direction.Neutral&&!a.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=n[t-1];this.placeRun(Math.max(t,e),_,a.UnicodeUtils.Direction.LTR),_=t;continue}const y=v.font,x=y.metrics,w=h.fontStyle,b=w===s.FontStyle.Bold&&void 0===y.bold||w===s.FontStyle.BoldItalic&&void 0===y.bold&&void 0===y.boldItalic,M=w===s.FontStyle.Italic&&void 0===y.italic||w===s.FontStyle.BoldItalic&&void 0===y.italic&&void 0===y.boldItalic,T=!!this.m_tempSmallCaps&&(l[_]&&h.fontVariant===s.FontVariant.SmallCaps),S=T?x.xHeight/x.capHeight:1,E=this.m_tempScale*S,P=((b?.02:0)+(T?.01:0))*(c.size/c.distanceRange),A=.5*this.m_tempPixelBgSize/(c.distanceRange*Math.max(E,1)),C=a.UnicodeUtils.isRtlMirrored(v.codePoint)&&i===a.UnicodeUtils.Direction.RTL,L=x.lineHeight-x.base-.5*x.distanceRange;o.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,d,E,u.canvasRotation,h.rotation);for(let e=0;e<4;++e){const t=v.positions[e],i=M&&e>1?o.TypesettingUtils.OBLIQUE_OFFSET*x.size:0;this.m_tempCorners[e].set(t.x+i,t.y-L,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform)}if(void 0===p&&void 0===g){if(!m.add(v,this.m_tempCorners,P,P+A,C,h))return!1}else void 0!==p&&o.TypesettingUtils.updateBounds(this.m_tempCorners,p,f),void 0!==g&&m.addToBuffer(g,_*r.QUAD_VERTEX_MEMORY_FOOTPRINT,v,this.m_tempCorners,P,P+A,C,h);d.set(d.x+(v.advanceX+u.tracking)*E*Math.cos(u.lineRotation),d.y+(v.advanceX+u.tracking)*E*Math.sin(u.lineRotation),d.z)}return!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathTypesetter=void 0;const n=i(0),r=i(78),s=i(27),o=i(79),a=i(26);t.PathTypesetter=class{constructor(){this.m_tempTransform=new n.Matrix3,this.m_tempCorners=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],this.m_tempLineDirection=a.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=a.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1,this.m_tempPathPosition=new n.Vector3,this.m_tempPathLength=0,this.m_tempPathOffset=0}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_tempPathLength=this.m_currentParams.path.getLength(),this.m_tempPathOffset=0;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer;let i=!1,n=0;for(let e=0;e<this.m_currentParams.glyphs.length;++e){const r=this.m_currentParams.glyphs[e];if(!r.isInCache&&!t)return!1;a.UnicodeUtils.isPrintable(r.codePoint)&&(i||r.direction!==-this.m_tempLineDirection||(i=!0),n+=(r.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1))}return this.m_tempPathOffset=Math.min(Math.max(-this.m_currentParams.textLayoutStyle.horizontalAlignment+this.m_currentParams.textLayoutStyle.horizontalAlignment*n/this.m_tempPathLength,0),1),this.placeLine(this.m_tempLineDirection,i)}placeLine(e,t){if(!t)return this.placeRun(0,this.m_currentParams.glyphs.length-1,e);const i=this.m_currentParams.glyphs;let n=0;for(let t=n;t<i.length;++t){const r=i[t];if(r.direction===-this.m_tempRunDirection){if(!this.placeRun(n,t-1,this.m_tempRunDirection))return!1;n=t,this.m_tempRunDirection*=-1}else if(r.direction===a.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-e){let e=t;for(;e+1<i.length&&1!==Math.abs(i[e].direction);)++e;if(i[e].direction!==this.m_tempRunDirection){if(!this.placeRun(n,t-1,this.m_tempRunDirection))return!1;n=t,this.m_tempRunDirection*=-1}}}return!(n<i.length&&!this.placeRun(n,i.length-1,this.m_tempRunDirection))}placeRun(e,t,i){const l=this.m_currentParams.glyphs,c=this.m_currentParams.smallCapsArray,h=this.m_currentParams.fontCatalog,u=this.m_currentParams.textRenderStyle,d=this.m_currentParams.textLayoutStyle,m=this.m_currentParams.position,p=this.m_currentParams.geometry,f=this.m_currentParams.globalBounds,g=this.m_currentParams.individualBounds,v=this.m_currentParams.vertexBuffer,y=this.m_currentParams.path,_=u.rotation,x=d.verticalAlignment*l[0].font.metrics.capHeight*this.m_tempScale,w=i===a.UnicodeUtils.Direction.LTR?e:t,b=i===a.UnicodeUtils.Direction.LTR?t:e;for(let M=w;i===a.UnicodeUtils.Direction.RTL?M>=b:M<=b;M+=i){const w=l[M];if(!a.UnicodeUtils.isPrintable(w.codePoint))continue;if(e!==t&&0!==M&&i===a.UnicodeUtils.Direction.RTL&&w.direction===a.UnicodeUtils.Direction.Weak){let t=M,i=l[t-1];for(;t!==e&&(i.direction===a.UnicodeUtils.Direction.Weak||i.direction===a.UnicodeUtils.Direction.Neutral&&!a.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=l[t-1];this.placeRun(Math.max(t,e),M,a.UnicodeUtils.Direction.LTR),M=t;continue}const b=w.font,T=b.metrics,S=u.fontStyle,E=S===s.FontStyle.Bold&&void 0===b.bold||S===s.FontStyle.BoldItalic&&void 0===b.bold&&void 0===b.boldItalic,P=S===s.FontStyle.Italic&&void 0===b.italic||S===s.FontStyle.BoldItalic&&void 0===b.italic&&void 0===b.boldItalic,A=!!this.m_tempSmallCaps&&(c[M]&&u.fontVariant===s.FontVariant.SmallCaps),C=A?T.xHeight/T.capHeight:1,L=this.m_tempScale*C,R=((E?.02:0)+(A?.01:0))*(h.size/h.distanceRange),D=.5*this.m_tempPixelBgSize/(h.distanceRange*Math.max(L,1)),O=a.UnicodeUtils.isRtlMirrored(w.codePoint)&&i===a.UnicodeUtils.Direction.RTL,I=T.lineHeight-T.base-.5*T.distanceRange,F=y.getPoint(this.m_tempPathOffset);if(null===F)return this.m_currentParams.pathOverflow;const V=y.getTangent(this.m_tempPathOffset),U=new n.Vector2(-V.y,V.x).multiplyScalar(x),N=Math.atan2(V.y,V.x);this.m_tempPathPosition.set(U.x+F.x,U.y+F.y,m.z),u.rotation=_+N,o.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,this.m_tempPathPosition,L,0,u.rotation);for(let e=0;e<4;++e){const t=w.positions[e],i=P&&e>1?o.TypesettingUtils.OBLIQUE_OFFSET*T.size:0;this.m_tempCorners[e].set(t.x+i,t.y-I,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform),this.m_tempCorners[e].x-=m.x,this.m_tempCorners[e].y-=m.y}if(void 0===f&&void 0===v){if(!p.add(w,this.m_tempCorners,R,R+D,O,u))return!1}else void 0!==f&&o.TypesettingUtils.updateBounds(this.m_tempCorners,f,g),void 0!==v&&p.addToBuffer(v,M*r.QUAD_VERTEX_MEMORY_FOOTPRINT,w,this.m_tempCorners,R,R+D,O,u);u.rotation=_,this.m_tempPathOffset+=(w.advanceX+d.tracking)*L/this.m_tempPathLength}return!0}}},function(e,t,i){"use strict";var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.ContextualArabicConverter=void 0,function(e){e[e.Initial=0]="Initial",e[e.Medial=1]="Medial",e[e.Final=2]="Final"}(n||(n={})),function(e){e[e.Isolated=0]="Isolated",e[e.Connected=1]="Connected"}(r||(r={}));class s{constructor(){this.m_singleCharactersMap=new Map,this.m_combinedCharactersMap=new Map,this.m_singleCharactersMap.set(1569,[void 0,void 0,void 0]),this.m_singleCharactersMap.set(1570,[void 0,void 0,65154]),this.m_singleCharactersMap.set(1571,[void 0,void 0,65156]),this.m_singleCharactersMap.set(1572,[void 0,void 0,65158]),this.m_singleCharactersMap.set(1573,[void 0,void 0,65160]),this.m_singleCharactersMap.set(1574,[65163,65164,65162]),this.m_singleCharactersMap.set(1575,[void 0,void 0,65166]),this.m_singleCharactersMap.set(1576,[65169,65170,65168]),this.m_singleCharactersMap.set(1577,[void 0,void 0,65172]),this.m_singleCharactersMap.set(1578,[65175,65176,65174]),this.m_singleCharactersMap.set(1579,[65179,65180,65178]),this.m_singleCharactersMap.set(1580,[65183,65184,65182]),this.m_singleCharactersMap.set(1581,[65187,65188,65186]),this.m_singleCharactersMap.set(1582,[65191,65192,65190]),this.m_singleCharactersMap.set(1583,[void 0,void 0,65194]),this.m_singleCharactersMap.set(1584,[void 0,void 0,65196]),this.m_singleCharactersMap.set(1585,[void 0,void 0,65198]),this.m_singleCharactersMap.set(1586,[void 0,void 0,65200]),this.m_singleCharactersMap.set(1587,[65203,65204,65202]),this.m_singleCharactersMap.set(1588,[65207,65208,65206]),this.m_singleCharactersMap.set(1589,[65211,65212,65210]),this.m_singleCharactersMap.set(1590,[65215,65216,65214]),this.m_singleCharactersMap.set(1591,[65219,65220,65218]),this.m_singleCharactersMap.set(1592,[65223,65224,65222]),this.m_singleCharactersMap.set(1593,[65227,65228,65226]),this.m_singleCharactersMap.set(1594,[65231,65232,65230]),this.m_singleCharactersMap.set(1600,[1600,1600,1600]),this.m_singleCharactersMap.set(1601,[65235,65236,65234]),this.m_singleCharactersMap.set(1602,[65239,65240,65238]),this.m_singleCharactersMap.set(1603,[65243,65244,65242]),this.m_singleCharactersMap.set(1604,[65247,65248,65246]),this.m_singleCharactersMap.set(1605,[65251,65252,65250]),this.m_singleCharactersMap.set(1606,[65255,65256,65254]),this.m_singleCharactersMap.set(1607,[65259,65260,65258]),this.m_singleCharactersMap.set(1608,[void 0,void 0,65262]),this.m_singleCharactersMap.set(1609,[void 0,void 0,65264]),this.m_singleCharactersMap.set(1610,[65267,65268,65266]),this.m_singleCharactersMap.set(1662,[64344,64345,64343]),this.m_singleCharactersMap.set(1740,[64510,64511,64509]),this.m_singleCharactersMap.set(1670,[64380,64381,64379]),this.m_singleCharactersMap.set(1705,[64400,64401,64399]),this.m_singleCharactersMap.set(1711,[64404,64405,64403]),this.m_singleCharactersMap.set(1688,[void 0,void 0,64395]),this.m_combinedCharactersMap.set(1604,new Map),this.m_combinedCharactersMap.get(1604).set(1570,[65269,65270]),this.m_combinedCharactersMap.get(1604).set(1571,[65271,65272]),this.m_combinedCharactersMap.get(1604).set(1573,[65273,65274]),this.m_combinedCharactersMap.get(1604).set(1575,[65275,65276]),this.m_neutralCharacters=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}static get instance(){return void 0===this.m_instance&&(this.m_instance=new s),this.m_instance}convert(e){let t="";for(let i=0;i<e.length;++i){const s=e.charCodeAt(i);if(this.isArabicCharacter(s)){let o=i-1;for(;o>=0&&this.isNeutral(e.charCodeAt(o));--o);let a=o>=0?e.charCodeAt(o):void 0;if(void 0!==a){const e=this.getCharacterMap(a);(void 0===e||void 0===e[n.Initial]&&void 0===e[n.Medial])&&(a=void 0)}let l=i+1;for(;l<e.length&&this.isNeutral(e.charCodeAt(l));++l);let c=l<e.length?e.charCodeAt(l):void 0;if(void 0!==c){const e=this.getCharacterMap(c);(void 0===e||void 0===e[n.Medial]&&void 0===e[n.Final])&&(c=void 0)}if(1604===s&&void 0!==c&&(1570===c||1571===c||1573===c||1575===c)){const e=this.getCombinedCharacterMap(s,c);t+=void 0!==a?String.fromCharCode(e[r.Connected]):String.fromCharCode(e[r.Isolated]),++i;continue}const h=this.getCharacterMap(s);void 0!==a&&void 0!==c&&void 0!==h[n.Medial]?t+=String.fromCharCode(h[n.Medial]):void 0!==a&&void 0!==h[n.Final]?t+=String.fromCharCode(h[n.Final]):void 0!==c&&void 0!==h[n.Initial]?t+=String.fromCharCode(h[n.Initial]):t+=String.fromCharCode(s)}else t+=String.fromCharCode(s)}return t}isArabicCharacter(e){return this.m_singleCharactersMap.has(e)}getCharacterMap(e){return this.m_singleCharactersMap.get(e)}getCombinedCharacterMap(e,t){const i=this.m_combinedCharactersMap.get(e);if(void 0!==i)return i.get(t)}isNeutral(e){for(const t of this.m_neutralCharacters)if(t===e)return!0;return!1}}t.ContextualArabicConverter=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiBuilder=void 0;const n=i(3),r=i(1),s=i(80),o=r.LoggerManager.instance.create("PoiBuilder");t.PoiBuilder=class{constructor(e){this.m_env=e}withTechnique(e){var t,i,r,s,o,a,l,c;return this.m_imageTextureName=function(e,t){return void 0!==e.imageTexture?n.composeTechniqueTextureName(n.getPropertyValue(e.imageTexture,t),e):void 0}(e,this.m_env),this.m_iconMinZoomLevel=null!==(i=n.getPropertyValue(null!==(t=e.iconMinZoomLevel)&&void 0!==t?t:e.minZoomLevel,this.m_env))&&void 0!==i?i:void 0,this.m_iconMaxZoomLevel=null!==(s=n.getPropertyValue(null!==(r=e.iconMaxZoomLevel)&&void 0!==r?r:e.maxZoomLevel,this.m_env))&&void 0!==s?s:void 0,this.m_textMinZoomLevel=null!==(a=n.getPropertyValue(null!==(o=e.textMinZoomLevel)&&void 0!==o?o:e.minZoomLevel,this.m_env))&&void 0!==a?a:void 0,this.m_textMaxZoomLevel=null!==(c=n.getPropertyValue(null!==(l=e.textMaxZoomLevel)&&void 0!==l?l:e.maxZoomLevel,this.m_env))&&void 0!==c?c:void 0,this.m_technique=e,this}withIcon(e,t){return void 0!==e&&(this.m_imageTextureName=e),this.m_shieldGroupIndex=t,this}build(e){var t,i,a,l,c;r.assert(void 0!==this.m_technique);const h=this.m_technique,u=this.m_env,d=this.m_imageTextureName,m=void 0!==h.poiTable?null!==(t=h.poiName)&&void 0!==t?t:d:void 0;if(void 0!==d&&void 0!==m&&o.warn("Possible duplicate POI icon definition via imageTextureName and poiTable!"),void 0===d&&void 0===m)return e.minZoomLevel=null!==(i=e.minZoomLevel)&&void 0!==i?i:this.m_textMinZoomLevel,void(e.maxZoomLevel=null!==(a=e.maxZoomLevel)&&void 0!==a?a:this.m_textMaxZoomLevel);const p=!0===h.textIsOptional,f=!0===h.iconIsOptional,g=!(!1===h.renderTextDuringMovements),v=null!==(l=h.iconMayOverlap)&&void 0!==l?l:h.textMayOverlap,y=null!==(c=h.iconReserveSpace)&&void 0!==c?c:h.textReserveSpace,_=n.getPropertyValue(h.iconColor,u),x=null!==_?s.ColorCache.instance.getColor(_):void 0;return{technique:h,imageTextureName:d,poiTableName:h.poiTable,poiName:m,shieldGroupIndex:this.m_shieldGroupIndex,textElement:e,textIsOptional:p,iconIsOptional:f,renderTextDuringMovements:g,mayOverlap:v,reserveSpace:y,iconBrightness:h.iconBrightness,iconColor:x,iconMinZoomLevel:this.m_iconMinZoomLevel,iconMaxZoomLevel:this.m_iconMaxZoomLevel,textMinZoomLevel:this.m_textMinZoomLevel,textMaxZoomLevel:this.m_textMaxZoomLevel}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoxBuffer=t.BoxBufferMesh=void 0;const n=i(1),r=i(0),s=i(293);class o extends r.Mesh{constructor(e,t){super(e,t),this.type="BoxBufferMesh"}get isEmpty(){if(void 0===this.geometry)return!0;{const e=this.geometry;return null===e.index||0===e.index.count}}}t.BoxBufferMesh=o;class a{constructor(e,t=0,i=0,n=32768){this.m_material=e,this.m_renderOrder=t,this.m_maxElementCount=n,this.m_size=0,this.resizeBuffer(i),this.m_pickInfos=new Array}clone(){return new a(this.m_material,this.m_renderOrder)}dispose(){void 0!==this.m_geometry&&(this.m_geometry.dispose(),this.m_geometry=void 0),this.m_mesh=void 0}get size(){return this.m_size}reset(){void 0!==this.m_positionAttribute&&(this.m_positionAttribute.count=0,this.m_colorAttribute.count=0,this.m_uvAttribute.count=0,this.m_indexAttribute.count=0,this.m_pickInfos.length=0)}canAddElements(e=1){const t=this.m_indexAttribute;if(t.count+6*e>=t.array.length){if(t.array.length>=6*this.m_maxElementCount)return!1;const e=Math.min(this.m_maxElementCount,0===this.size?256:2*this.size);this.resize(e)}return!0}saveState(){return{positionAttributeCount:this.m_positionAttribute.count,colorAttributeCount:this.m_colorAttribute.count,uvAttributeCount:this.m_uvAttribute.count,indexAttributeCount:this.m_indexAttribute.count,pickInfoCount:this.m_pickInfos.length}}restoreState(e){this.m_positionAttribute.count=e.positionAttributeCount,this.m_colorAttribute.count=e.colorAttributeCount,this.m_uvAttribute.count=e.uvAttributeCount,this.m_indexAttribute.count=e.indexAttributeCount,this.m_pickInfos.length=e.pickInfoCount}addBox(e,t,i,n,r,s){if(!this.canAddElements())return!1;const{s0:o,t0:a,s1:l,t1:c}=t,{x:h,y:u,w:d,h:m}=e,p=Math.round(i.r*n*255),f=Math.round(i.g*n*255),g=Math.round(i.b*n*255),v=Math.round(255*n),y=this.m_positionAttribute,_=this.m_colorAttribute,x=this.m_uvAttribute,w=this.m_indexAttribute,b=y.count,M=w.count;return y.setXYZ(b,h,u,r),y.setXYZ(b+1,h+d,u,r),y.setXYZ(b+2,h,u+m,r),y.setXYZ(b+3,h+d,u+m,r),_.setXYZW(b,p,f,g,v),_.setXYZW(b+1,p,f,g,v),_.setXYZW(b+2,p,f,g,v),_.setXYZW(b+3,p,f,g,v),x.setXY(b,o,a),x.setXY(b+1,l,a),x.setXY(b+2,o,c),x.setXY(b+3,l,c),w.setX(M,b),w.setX(M+1,b+1),w.setX(M+2,b+2),w.setX(M+3,b+2),w.setX(M+4,b+1),w.setX(M+5,b+3),y.count+=4,_.count+=4,x.count+=4,w.count+=6,this.m_pickInfos.push(s),!0}updateBufferGeometry(){const e=this.m_positionAttribute,t=this.m_colorAttribute,i=this.m_uvAttribute,n=this.m_indexAttribute;e.count>0&&(e.needsUpdate=!0,e.updateRange.offset=0,e.updateRange.count=4*e.count),t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=4*t.count),i.count>0&&(i.needsUpdate=!0,i.updateRange.offset=0,i.updateRange.count=4*i.count),n.count>0&&(n.needsUpdate=!0,n.updateRange.offset=0,n.updateRange.count=n.count),void 0!==this.m_geometry&&(this.m_geometry.clearGroups(),this.m_geometry.addGroup(0,this.m_indexAttribute.count))}cleanUp(){0===this.m_indexAttribute.count&&this.size>0&&this.clearAttributes()}get isEmpty(){return this.m_mesh.isEmpty}get mesh(){return void 0===this.m_mesh&&this.resize(),this.m_mesh}pickBoxes(e,t,i){const r=this.m_pickInfos.length,s=this.m_pickInfos,o=this.m_positionAttribute,a=e.x,l=e.y;for(let e=0;e<r;e++){const r=4*e,c=o.getX(r);if(a<c)continue;const h=o.getX(r+1);if(a>h)continue;const u=o.getY(r);if(l<u)continue;const d=o.getY(r+2);if(l>d)continue;const m=new n.Math2D.Box(c,u,h-c,d-u);void 0!==i&&void 0!==s[e].poiInfo&&void 0!==s[e].poiInfo.uvBox&&this.isPixelTransparent(i,a,l,m,s[e].poiInfo.uvBox,document.createElement("canvas"))||void 0!==s[e]&&t(s[e])}}resize(e,t){return void 0!==this.m_geometry&&this.m_geometry.dispose(),this.m_geometry=new r.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setIndex(this.m_indexAttribute),this.m_geometry.addGroup(0,this.m_indexAttribute.count),void 0===this.m_mesh?(this.m_mesh=new o(this.m_geometry,this.m_material),this.m_mesh.renderOrder=this.m_renderOrder):this.m_mesh.geometry=this.m_geometry,this.m_mesh}updateMemoryUsage(e){const t=3*this.m_positionAttribute.count*4+4*this.m_colorAttribute.count+4*this.m_uvAttribute.count*4+4*this.m_indexAttribute.count;e.heapSize+=t,e.gpuSize+=t}isPixelTransparent(e,t,i,n,r,o){const{u:a,v:l}=s.screenToUvCoordinates(t,i,n,r),{width:c,height:h}=e instanceof SVGImageElement?e.getBBox():e,u=c*a,d=h*l,m=s.getPixelFromImage(u,d,e,o);return void 0!==m&&0===m[3]}clearAttributes(){this.m_positionAttribute=void 0,this.m_colorAttribute=void 0,this.m_uvAttribute=void 0,this.m_indexAttribute=void 0,this.resize(0,!0)}resizeBuffer(e){const t=new Float32Array(4*e*3);if(void 0!==this.m_positionAttribute&&this.m_positionAttribute.array.length>0){const e=this.m_positionAttribute.count;t.set(this.m_positionAttribute.array),this.m_positionAttribute.array=t,this.m_positionAttribute.count=e}else this.m_positionAttribute=new r.BufferAttribute(t,3),this.m_positionAttribute.count=0,this.m_positionAttribute.setUsage(r.DynamicDrawUsage);const i=new Uint8Array(4*e*4);if(void 0!==this.m_colorAttribute){const e=this.m_colorAttribute.count;i.set(this.m_colorAttribute.array),this.m_colorAttribute.array=i,this.m_colorAttribute.count=e}else this.m_colorAttribute=new r.BufferAttribute(i,4,!0),this.m_colorAttribute.count=0,this.m_colorAttribute.setUsage(r.DynamicDrawUsage);const n=new Float32Array(4*e*4);if(void 0!==this.m_uvAttribute){const e=this.m_uvAttribute.count;n.set(this.m_uvAttribute.array),this.m_uvAttribute.array=n,this.m_uvAttribute.count=e}else this.m_uvAttribute=new r.BufferAttribute(n,4),this.m_uvAttribute.count=0,this.m_uvAttribute.setUsage(r.DynamicDrawUsage);const s=6*e*1,o=s>65535?new Uint32Array(s):new Uint16Array(s);if(void 0!==this.m_indexAttribute){const e=this.m_indexAttribute.count;o.set(this.m_indexAttribute.array),this.m_indexAttribute.array=o,this.m_indexAttribute.count=e}else this.m_indexAttribute=new r.BufferAttribute(o,1),this.m_indexAttribute.count=0,this.m_indexAttribute.setUsage(r.DynamicDrawUsage);this.m_size=e}}t.BoxBuffer=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPixelFromImageData=t.getPixelFromCanvasImageSource=t.screenToUvCoordinates=t.getPixelFromImage=void 0;const n=i(1);function r(e,t,i,n){const{width:r,height:s}=e instanceof SVGImageElement?e.getBBox():e;if(t>r||t<0||i>s||i<0)return;let o;n.width=r,n.height=s;const a=n.getContext("2d");return null!==a&&(a.drawImage(e,0,0),o=a.getImageData(t,i,1,1).data),o}function s(e,t,i,n){if(!(t>e.width||t<0||i>e.height||i<0))return((e,t,i)=>{const n=t*i,r=e.data,s=new Uint8ClampedArray(i);for(let e=0;e<i;e++)s[0]=r[n+e];return s})(e,i*e.width+t,n)}t.getPixelFromImage=function(e,t,i,n){if(i instanceof ImageData){return s(i,e,t,i.data.length/(i.height*i.width))}return n||(n=document.createElement("canvas")),r(i,e,t,n)},t.screenToUvCoordinates=function(e,t,i,r){const s=i.x,o=i.x+i.w,a=i.y,l=i.y+i.h;return{u:n.MathUtils.map(e,s,o,r.s0,r.s1),v:n.MathUtils.map(t,a,l,r.t0,r.t1)}},t.getPixelFromCanvasImageSource=r,t.getPixelFromImageData=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadFontCatalog=void 0;const n=i(8),r=i(1).LoggerManager.instance.create("FontCatalogLoader");t.loadFontCatalog=async function(e,t,i){return await n.FontCatalog.load(e.url,1024).then(t.bind(void 0,e.name)).catch(t=>{r.error("Failed to load FontCatalog: ",e.name,t),i&&i(t)})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlacementStats=void 0;t.PlacementStats=class{constructor(e){this.m_logger=e,this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedPoiIcons=0,this.numRenderedPoiTexts=0,this.numPoiTextsInvisible=0,this.numRenderedTextElements=0}clear(){this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedPoiIcons=0,this.numRenderedPoiTexts=0,this.numPoiTextsInvisible=0,this.numRenderedTextElements=0}log(){const e=this.uninitialized+this.numPoiTextsInvisible+this.tooFar+this.numNotVisible+this.numCannotAdd;this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("Resorted groups",this.resortedGroups),this.m_logger.debug("Total labels",this.total),this.m_logger.debug("Rendered labels",this.numRenderedTextElements),this.m_logger.debug("Rejected labels",e),this.m_logger.debug("Unitialized labels",this.uninitialized),this.m_logger.debug("Rendered poi icons",this.numRenderedPoiIcons),this.m_logger.debug("Rendered poi texts",this.numRenderedPoiTexts),this.m_logger.debug("Poi text invisible",this.numPoiTextsInvisible),this.m_logger.debug("Too far",this.tooFar),this.m_logger.debug("Not visible",this.numNotVisible),this.m_logger.debug("Path too small",this.numPathTooSmall),this.m_logger.debug("Rejected, max glyphs reached",this.numCannotAdd)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimplePath=t.PathParam=t.SimpleLineCurve=void 0;const n=i(0);class r extends n.LineCurve{constructor(e,t){super(e,t)}getLengths(){return void 0===this.m_lengths&&(this.m_lengths=[0,this.v2.distanceTo(this.v1)]),this.m_lengths}}t.SimpleLineCurve=r;class s{constructor(e,t,i){this.path=e,this.index=t,this.t=i}get curve(){return this.path.curves[this.index]}get point(){return void 0===this.m_point&&(this.m_point=this.curve.getPoint(this.t)),this.m_point}}t.PathParam=s;class o extends n.Path{constructor(){super()}getLengths(){if(this.m_cache)return this.m_cache;let e=0;const t=new Array;return t.push(0),this.curves.forEach(i=>{const n=i;e+=n.v1.distanceTo(n.v2),t.push(e)}),this.m_cache=t,t}getParamAt(e){const t=e*this.getLength(),i=this.getCurveLengths();for(let e=0;e<i.length;++e){if(i[e]<t)continue;const n=i[e]-t,r=this.curves[e].getLength();return new s(this,e,0===r?0:1-n/r)}return null}}t.SimplePath=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextCanvasFactory=void 0;const n=i(8),r=i(1);t.TextCanvasFactory=class{constructor(e){this.m_renderer=e,this.m_minGlyphCount=0,this.m_maxGlyphCount=0}setGlyphCountLimits(e,t){this.m_minGlyphCount=e,this.m_maxGlyphCount=t}createTextCanvas(e,t){return r.assert(this.m_maxGlyphCount>0),new n.TextCanvas({renderer:this.m_renderer,fontCatalog:e,minGlyphCount:this.m_minGlyphCount,maxGlyphCount:this.m_maxGlyphCount,name:t})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializeDefaultOptions=void 0;t.initializeDefaultOptions=function(e){void 0===e.minNumGlyphs&&(e.minNumGlyphs=1024),void 0===e.maxNumGlyphs&&(e.maxNumGlyphs=32768),void 0===e.labelDistanceScaleMin&&(e.labelDistanceScaleMin=.7),void 0===e.labelDistanceScaleMax&&(e.labelDistanceScaleMax=1.5),void 0===e.maxDistanceRatioForTextLabels&&(e.maxDistanceRatioForTextLabels=.99),void 0===e.maxDistanceRatioForPoiLabels&&(e.maxDistanceRatioForPoiLabels=.99),void 0===e.disableFading&&(e.disableFading=!1),void 0===e.delayLabelsUntilMovementFinished&&(e.delayLabelsUntilMovementFinished=!0),void 0===e.showReplacementGlyphs&&(e.showReplacementGlyphs=!1),void 0===e.maxPoiDistanceToBorder&&(e.maxPoiDistanceToBorder=.2)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementStateCache=void 0;const n=i(1),r=i(300),s=i(152),o=i(17),a=n.LoggerManager.instance.create("TextElementsStateCache",{level:n.LogLevel.Log});const l={entries:[],index:-1};function c(e){return e.hasFeatureId()?e.featureId:e.text}function h(e,t,i,n){return void 0!==e.pathLengthSqr&&(void 0!==i.pathLengthSqr&&e.pathLengthSqr>i.pathLengthSqr)}function u(e,t,i,n){return t<n}function d(e,t,i){const n=e.element,r=function(e){return 100<<(Math.min(4,13-Math.min(13,Math.floor(e)))<<2)}(i),a=t.length,l=e.position,c=e.visible,d=s.isLineMarkerElementState(e);let m,p=-1,f=1/0;const g=n.type===o.TextElementType.PathLabel?h:u;for(let e=0;e<a;++e){const i=t[e],o=i.element,a=n.type!==o.type||d!==s.isLineMarkerElementState(i),h=c&&i.visible;if(a||h)continue;const u=l.distanceToSquared(o.position);u>r||(void 0===m||g(o,u,m,f))&&(p=e,m=o,f=u)}return p}t.TextElementStateCache=class{constructor(){this.m_referenceMap=new Map,this.m_textMap=new Map}getOrSet(e,t,i){let n=this.get(e);return void 0!==n?(n.updateElements(i),[n,!0]):(n=new r.TextElementGroupState(e,t,i),this.set(e,n),[n,!1])}get size(){return this.m_referenceMap.size}get cacheSize(){return this.m_textMap.size}get sortedGroupStates(){return void 0===this.m_sortedGroupStates&&(this.m_sortedGroupStates=Array.from(this.m_referenceMap.values()),this.m_sortedGroupStates.sort((e,t)=>t.group.priority-e.group.priority)),n.assert(this.m_referenceMap.size===this.m_sortedGroupStates.length),this.m_sortedGroupStates}update(e,t,i,n){const r=i?this.replaceElement.bind(this,n):void 0;let s=!1;for(const[n,o]of this.m_referenceMap.entries())o.visited?o.updateFading(e,t):(i&&o.traverseVisibleElements(r),this.m_referenceMap.delete(n),this.m_sortedGroupStates=void 0,s=!0);return s}clearVisited(){for(const e of this.m_referenceMap.values())e.visited=!1}clearTextCache(){this.m_textMap.clear()}clear(){this.m_referenceMap.clear(),this.m_sortedGroupStates=void 0,this.m_textMap.clear()}deduplicateElement(e,t){const i=this.findDuplicate(t,e);if(void 0===i)return this.m_textMap.set(c(t.element),[t]),!0;if(-1===i.index)return i.entries.push(t),!0;const n=i.entries[i.index];return!(n.visible||!t.visible)&&(i.entries[i.index]=t,n.reset(),!0)}replaceElement(e,t){n.assert(t.visible);const i=this.findDuplicate(t,e);if(void 0===i||-1===i.index)return!1;const r=i.entries[i.index];return n.assert(!r.visible),r.replace(t),!0}get(e){const t=this.m_referenceMap.get(e);return void 0!==t&&(t.visited=!0),t}set(e,t){n.assert(e.elements.length>0),this.m_referenceMap.set(e,t),this.m_sortedGroupStates=void 0}findDuplicate(e,t){const i=e.element,r=this.m_textMap.get(c(i));if(void 0===r)return;l.entries=r;const s=i.hasFeatureId()?function(e,t){const i=e.element,r=t.findIndex(e=>e.element.tileOffset===i.tileOffset);if(-1===r)return-1;const s=t[r].element;if(n.assert(i.featureId===s.featureId),s.text===i.text)return r;a.debug(`Text feature id ${i.featureId} collision between "${i.text} and              ${s.text}`)}(e,r):d(e,r,t);return void 0===s?(i.featureId=void 0,this.findDuplicate(e,t)):(l.index=s,l)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementGroupState=void 0;const n=i(1),r=i(152),s=i(17);t.TextElementGroupState=class{constructor(e,t,i){this.group=e,this.tileKey=t,this.m_visited=!1,n.assert(e.elements.length>0);const o=e.elements.length;this.m_textElementStates=[],this.m_visited=!0;for(let t=0;t<o;++t){const n=e.elements[t];if(n.type===s.TextElementType.LineMarker&&void 0!==n.path){const e=n.path.length;for(let t=0;t<e;t++){const e=new r.TextElementState(n,t),s=i(e);e.update(s),this.m_textElementStates.push(e)}}else{const e=new r.TextElementState(n),t=i(e);e.update(t),this.m_textElementStates.push(e)}}}get visited(){return this.m_visited}set visited(e){this.m_visited=e}get priority(){return this.group.priority}updateFading(e,t){for(const i of this.m_textElementStates)void 0!==i&&i.updateFading(e,t)}traverseVisibleElements(e){for(const t of this.m_textElementStates)void 0!==t&&t.visible&&e(t)}updateElements(e){for(const t of this.m_textElementStates){const i=e(t);t.update(i)}}get size(){return this.m_textElementStates.length}get textElementStates(){return this.m_textElementStates}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutState=void 0;const n=i(8);t.LayoutState=class{constructor(e){this.m_hAlign=n.DefaultTextStyle.DEFAULT_HORIZONTAL_ALIGNMENT,this.m_vAlign=n.DefaultTextStyle.DEFAULT_VERTICAL_ALIGNMENT,this.textPlacement=e}set textPlacement(e){this.m_hAlign=n.hAlignFromPlacement(e.h),this.m_vAlign=n.vAlignFromPlacement(e.v)}get textPlacement(){return{h:n.hPlacementFromAlignment(this.m_hAlign),v:n.vPlacementFromAlignment(this.m_vAlign)}}reset(e){this.m_hAlign=e.horizontalAlignment,this.m_vAlign=e.verticalAlignment}get horizontalAlignment(){return this.m_hAlign}get verticalAlignment(){return this.m_vAlign}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderState=t.DEFAULT_FADE_TIME=t.FadingState=void 0;const n=i(1),r=i(0);var s;!function(e){e[e.Undefined=0]="Undefined",e[e.FadingIn=1]="FadingIn",e[e.FadedIn=2]="FadedIn",e[e.FadingOut=-1]="FadingOut",e[e.FadedOut=-2]="FadedOut"}(s=t.FadingState||(t.FadingState={})),t.DEFAULT_FADE_TIME=800;t.RenderState=class{constructor(e=t.DEFAULT_FADE_TIME){this.fadeTime=e,this.value=0,this.startTime=0,this.opacity=0,this.m_state=s.Undefined}reset(){this.m_state=s.Undefined,this.value=0,this.startTime=0,this.opacity=0}isUndefined(){return this.m_state===s.Undefined}isFading(){return this.m_state===s.FadingIn||this.m_state===s.FadingOut}isFadingIn(){return this.m_state===s.FadingIn}isFadingOut(){return this.m_state===s.FadingOut}isFadedIn(){return this.m_state===s.FadedIn}isFadedOut(){return this.m_state===s.FadedOut}isVisible(){return this.m_state!==s.FadedOut&&this.m_state!==s.Undefined&&this.opacity>0}startFadeIn(e,t){if(this.m_state!==s.FadingIn&&this.m_state!==s.FadedIn){if(!0===t)return this.value=1,this.opacity=1,this.m_state=s.FadedIn,void(this.startTime=e);this.m_state===s.FadingOut?(this.value=1-this.value,this.startTime=e-this.value*this.fadeTime):(this.startTime=e,this.value=0,this.opacity=0),this.m_state=s.FadingIn}}startFadeOut(e){this.m_state!==s.FadingOut&&this.m_state!==s.FadedOut&&this.m_state!==s.Undefined&&(this.m_state===s.FadingIn?(this.startTime=e-this.value*this.fadeTime,this.value=1-this.value):(this.startTime=e,this.value=0,this.opacity=1),this.m_state=s.FadingOut)}updateFading(e,t){if(this.m_state!==s.FadingIn&&this.m_state!==s.FadingOut)return;0===this.startTime&&(this.startTime=e);const i=e-this.startTime,o=this.m_state===s.FadingIn?0:1,a=this.m_state===s.FadingIn?1:0;t||i>=this.fadeTime?(this.value=1,this.opacity=a,this.m_state=this.m_state===s.FadingIn?s.FadedIn:s.FadedOut):(this.value=i/this.fadeTime,this.opacity=r.MathUtils.clamp(n.MathUtils.smootherStep(o,a,this.value),0,1),n.assert(this.isFading()))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStats=void 0;const n=i(151);t.UpdateStats=class{constructor(e){this.m_logger=e,this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results=new Array(n.PrePlacementResult.Count),this.results.fill(0)}clear(){this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results.fill(0)}log(){this.m_logger.debug("Tiles",this.tiles),this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("New groups",this.newGroups),this.m_logger.debug("Total labels",this.totalLabels),this.m_logger.debug("Placed labels",this.results[n.PrePlacementResult.Ok]),this.m_logger.debug("Invisible",this.results[n.PrePlacementResult.Invisible]),this.m_logger.debug("Poi not ready",this.results[n.PrePlacementResult.NotReady]),this.m_logger.debug("Too far",this.results[n.PrePlacementResult.TooFar]),this.m_logger.debug("Duplicate",this.results[n.PrePlacementResult.Duplicate])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeDecodedTechnique=t.StyleSetEvaluator=void 0;const n=i(1),r=i(6),s=i(115),o=i(62),a=i(120),l=i(63),c=n.LoggerManager.instance.create("StyleSetEvaluator"),h=a.AttrScope.TechniqueGeometry;class u{classify(e){if(e._whenExpr){const t=this.switchStyle(e);e._whenExpr=e._whenExpr.accept(this,void 0),this._style=t}}visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){return e}visitHasAttributeExpr(e,t){return e}visitMatchExpr(e,t){return e}visitCaseExpr(e,t){return e}visitCallExpr(e,t){if("all"===e.op){const t=e.args.map(t=>t.accept(this,e)).filter(e=>void 0!==e);return new r.CallExpr(e.op,t)}if(t){const t=this.matchVarStringComparison(e);if(t){if(void 0===this._style.layer&&"$layer"===t.name)return void(this._style.layer=t.value);if(void 0===this._style._geometryType&&"$geometryType"===t.name)return void(this._style._geometryType=t.value)}}return e}visitStepExpr(e,t){return e}visitInterpolateExpr(e,t){return e}matchVarStringComparison(e){if("=="===e.op){const t=e.args[0],i=e.args[1];if(t instanceof r.VarExpr&&i instanceof r.StringLiteralExpr)return{name:t.name,value:i.value};if(i instanceof r.VarExpr&&t instanceof r.StringLiteralExpr)return{name:i.name,value:t.value}}}switchStyle(e){const t=this._style;return this._style=e,t}}class d{constructor(e,t){this.key="",this.set(e,t)}set(e,t,i){let n=!1;if(void 0===e){const t=void 0!==i?i.lookup("$layer"):void 0;e="string"==typeof t?t:void 0}if(this.layer!==e&&(this.layer=e,n=!0),void 0===t){const e=void 0!==i?i.lookup("$geometryType"):void 0;t="string"==typeof e?e:void 0}return this.geometryType!==t&&(this.geometryType=t,n=!0),n&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=this.layer+":":void 0!==this.geometryType?this.key=":"+this.geometryType:this.key="all",this.cachedStyleSet=void 0}}function m(e){const t={};for(const i in e){if(!e.hasOwnProperty(i))continue;let n=e[i];"object"==typeof n&&(n.isVector2||n.isVector3||n.isVector4)&&(n=r.LiteralExpr.fromValue(n)),r.Expr.isExpr(n)&&(n=n.toJSON()),t[i]=n}return t}t.StyleSetEvaluator=class{constructor(e){var t;this.m_options=e,this.m_techniques=[],this.m_exprPool=new s.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new u,this.m_subStyleSetCache=new Map,this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new d,this.m_emptyEnv=new r.Env,this.m_featureDependencies=[],this.m_nextArrayBufferId=0,this.m_definitions=this.m_options.definitions,this.styleSet=(t=this.m_options.styleSet,this.m_definitions,t.map(e=>function(e,t){return Object.assign({},e)}(e))),function(e){let t=0,i=0;for(const n of e)n._styleSetIndex=i++,void 0!==n.technique&&void 0===n.renderOrder&&(n.renderOrder=t++)}(this.styleSet),this.compileStyleSet()}getMatchingTechniques(e,t,i){if(this.m_previousResult&&this.m_previousEnv&&this.m_featureDependencies.every(t=>{var i;return(null===(i=this.m_previousEnv)||void 0===i?void 0:i.lookup(t))===e.lookup(t)}))return this.m_previousResult;const n=[];this.m_cachedResults.clear();const r=this.m_tmpOptimizedSubSetKey;r.set(t,i,e),this.m_layer=r.layer,this.m_geometryType=r.geometryType,this.m_zoomLevel=e.lookup("$zoom");const s=this.getOptimizedStyleSet(r);for(const t of s)if(this.processStyle(e,t,n))break;return this.m_previousResult=n,this.m_previousEnv=e,n}wantsLayer(e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,void 0)).length>0}wantsFeature(e,t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,t)).length>0}get expressionEvaluatorCache(){return this.m_cachedResults}resetTechniques(){for(const e of this.m_techniques)e._index=void 0;this.m_techniques.length=0,this.m_previousResult=void 0,this.m_previousEnv=void 0}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(m)}getOptimizedStyleSet(e){if(void 0!==e.cachedStyleSet)return e.cachedStyleSet;let t=this.m_subStyleSetCache.get(e.key);return void 0!==t?(e.cachedStyleSet=t,t):(t=this.createPreFilteredStyleSet(e),this.m_subStyleSetCache.set(e.key,t),e.cachedStyleSet=t,t)}createPreFilteredStyleSet(e){const{layer:t,geometryType:i}=e;return this.styleSet.filter(e=>(void 0===t||void 0===e.layer||e.layer===t)&&(void 0===i||void 0===e._geometryType||e._geometryType===i))}compileStyleSet(){this.m_featureDependencies=["$layer","$geometryType","$zoom"],this.styleSet.forEach(e=>this.compileStyle(e)),this.styleSet.forEach(e=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e.layer,e._geometryType))})}compileStyle(e){if(this.checkStyleDynamicAttributes(e),void 0!==e.when)try{e._whenExpr=Array.isArray(e.when)?r.Expr.fromJSON(e.when,this.m_definitions,this.m_definitionExprCache):r.Expr.parse(e.when),this.m_styleConditionClassifier.classify(e),void 0!==e._whenExpr&&(e._whenExpr=e._whenExpr.intern(this.m_exprPool));const t=e._whenExpr.dependencies();null==t||t.properties.forEach(e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)}),r.isJsonExpr(e.minZoomLevel)&&(e._minZoomLevelExpr=r.Expr.fromJSON(e.minZoomLevel).intern(this.m_exprPool)),r.isJsonExpr(e.maxZoomLevel)&&(e._maxZoomLevelExpr=r.Expr.fromJSON(e.maxZoomLevel).intern(this.m_exprPool))}catch(t){c.log("failed to evaluate expression",JSON.stringify(e.when),"error",String(t))}}processStyle(e,t,i){if(!this.checkZoomLevel(e,t))return!1;if(void 0!==this.m_layer&&void 0!==t.layer&&t.layer!==this.m_layer)return!1;if(void 0!==this.m_geometryType&&void 0!==t._geometryType&&t._geometryType!==this.m_geometryType)return!1;if(t._whenExpr)try{if(!t._whenExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults))return!1}catch(e){return c.error(`failed to evaluate expression '${JSON.stringify(t.when)}': ${e}`),!1}return void 0!==t.technique&&("none"!==t.technique&&i.push(this.getTechniqueForStyleMatch(e,t)),!0===t.final)}checkZoomLevel(e,t){var i,n;if(void 0===t.minZoomLevel&&void 0===t.maxZoomLevel)return!0;const s=this.m_zoomLevel;if(void 0===s)return!0;if(void 0!==t.minZoomLevel){let n=t.minZoomLevel;if(!1===(null===(i=t._minZoomLevelExpr)||void 0===i?void 0:i.isDynamic()))try{n=t._minZoomLevelExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._minZoomLevelExpr)}': ${e}`)}if("number"==typeof n&&s<n)return!1}if(void 0!==t.maxZoomLevel){let i=t.maxZoomLevel;if(!1===(null===(n=t._maxZoomLevelExpr)||void 0===n?void 0:n.isDynamic()))try{i=t._maxZoomLevelExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._maxZoomLevelExpr)}': ${e}`)}if("number"==typeof i&&s>=i)return!1}return!0}getTechniqueForStyleMatch(e,t){let i;if(void 0!==t._dynamicTechniques){const n=this.evaluateTechniqueProperties(t,e),r=this.getDynamicTechniqueKey(t,n);i=t._dynamicTechniques.get(r),void 0===i&&(i=this.createTechnique(t,r,n),t._dynamicTechniques.set(r,i))}else i=t._staticTechnique,void 0===i&&(t._staticTechnique=i=this.createTechnique(t,""+t._styleSetIndex,[]));return void 0===i._index&&(i._index=this.m_techniques.length,this.m_techniques.push(i)),i}getDynamicTechniqueKey(e,t){const i=t.map(([e,t])=>void 0===t?"U":"object"==typeof t?JSON.stringify(t,(e,t)=>{if(t instanceof ArrayBuffer){let e=t.id;return void 0===e&&(e=t.id=this.m_nextArrayBufferId++),e}return t}):JSON.stringify(t)).join(":");return`${e._styleSetIndex}:${i}`}checkStyleDynamicAttributes(e){var t;if(void 0!==e._dynamicTechniqueAttributes||"none"===e.technique)return;e._dynamicTechniqueAttributes=[],e._dynamicFeatureAttributes=[],e._dynamicForwardedAttributes=[],e._staticAttributes=[];const i=e._dynamicFeatureAttributes,n=e._dynamicTechniqueAttributes,s=e._dynamicForwardedAttributes,l=e._staticAttributes,u=(t,u)=>{if(void 0!==u){if(r.isJsonExpr(u)?u=r.Expr.fromJSON(u,this.m_definitions,this.m_definitionExprCache).intern(this.m_exprPool):o.isInterpolatedPropertyDefinition(u)&&(u=r.Expr.fromJSON(o.interpolatedPropertyDefinitionToJsonExpr(u)).intern(this.m_exprPool)),r.Expr.isExpr(u)){const i=u.dependencies();i.featureState&&("enabled"!==t?c.log("feature-state is not supported in this context"):e._usesFeatureState=!0),0!==i.properties.size||u.isDynamic()||(u=u.evaluate(this.m_emptyEnv))}if(r.Expr.isExpr(u)){const r=function(e,t){var i,n;return"extruded-polygon"===e.technique&&"color"===t&&!1!==e.vertexColors?h:null!==(n=null===(i=a.getTechniqueAttributeDescriptor(e.technique,t))||void 0===i?void 0:i.scope)&&void 0!==n?n:h}(e,t),o=u.dependencies();switch(o.properties.forEach(e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)}),r){case a.AttrScope.FeatureGeometry:i.push([t,u]);break;case a.AttrScope.TechniqueGeometry:n.push([t,u]);break;case a.AttrScope.TechniqueRendering:0===o.properties.size?s.push([t,u]):n.push([t,u])}}else null!=u&&l.push([t,u])}},d=new Map([["category","_category"],["secondaryCategory","_secondaryCategory"]]);for(const i in e){if(!e.hasOwnProperty(i))continue;if(i.startsWith("_"))continue;if(["when","technique","layer","attr","description"].includes(i))continue;u(null!==(t=d.get(i))&&void 0!==t?t:i,e[i])}if(void 0!==e.attr)for(const t in e.attr)e.attr.hasOwnProperty(t)&&u(t,e.attr[t]);n.length>0&&(e._dynamicTechniques=new Map)}evaluateTechniqueProperties(e,t){return void 0===e._dynamicTechniqueAttributes?[]:e._dynamicTechniqueAttributes.map(([e,i])=>{try{return[e,i.evaluate(t,r.ExprScope.Value,this.m_cachedResults)]}catch(t){return c.error(`failed to evaluate expression '${i.toJSON()}': ${t}`),[e,null]}})}createTechnique(e,t,i){var n,r;const s={};if(s.name=e.technique,void 0!==e._staticAttributes)for(const[t,i]of e._staticAttributes)null!==i&&(s[t]=i);for(const[e,t]of i)null!==t&&(s[e]=t);if(void 0!==e._dynamicFeatureAttributes)for(const[t,i]of e._dynamicFeatureAttributes)s[t]=i;if(void 0!==e._dynamicForwardedAttributes)for(const[t,i]of e._dynamicForwardedAttributes)s[t]=i;return s._index=this.m_techniques.length,s._styleSetIndex=e._styleSetIndex,void 0!==e.styleSet&&(s._styleSet=e.styleSet),void 0!==e._usesFeatureState&&(s._usesFeatureState=e._usesFeatureState),l.setTechniqueRenderOrderOrPriority(s,null!==(n=this.m_options.priorities)&&void 0!==n?n:[],null!==(r=this.m_options.labelPriorities)&&void 0!==r?r:[]),this.m_techniques.push(s),s}},t.makeDecodedTechnique=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addPolygonEdges=void 0;const n=i(0),r=new n.Vector2,s=new n.Vector2,o=new n.Vector2,a=new n.Vector2;t.addPolygonEdges=function(e,t,i,n,l,c,h,u){for(let d=0;d<l.length;++d)if(l[d])if(!0===c){const c=t+2*d,m=c+1,p=t+(d+1)%l.length*2,f=p+1;!0===h&&e.push(c,p),e.push(m,f);const g=(0===d?l.length:d)-1;if(l[g])if(void 0!==u){const t=n[d*i],h=n[d*i+1],p=n[(d+1)%l.length*i],f=n[(d+1)%l.length*i+1];r.set(t,h),s.set(p,f),o.set(n[g*i],n[g*i+1]),a.set(r.x,r.y),a.sub(o).normalize().dot(s.sub(r).normalize())<=u&&e.push(c,m)}else e.push(c,m)}else{const i=t+d,n=t+(d+1)%l.length;e.push(i,n)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThreeBufferUtils=void 0;const n=i(107);!function(e){function t(e){if(e instanceof Int8Array)return"int8";if(e instanceof Uint8Array)return"uint8";if(e instanceof Int16Array)return"int16";if(e instanceof Uint16Array)return"uint16";if(e instanceof Int32Array)return"int32";if(e instanceof Uint32Array)return"uint32";if(e instanceof Float32Array)return"float";throw new Error("Unsupported buffer type "+name)}function i(e){const i=e.array;return{name:e.name,buffer:i.buffer,type:t(i),itemCount:e.itemSize,normalized:e.normalized}}e.getBufferElementType=t,e.fromThreeBufferAttribute=i,e.fromThreeInterleavedBufferAttribute=function(e){throw new Error("Not implemented yet")},e.fromThreeBufferGeometry=function(e,t){const r=[],s=Object.getOwnPropertyNames(e.attributes);for(const t of s){const n=i(e.attributes[t]);n.name=t,r.push(n)}const o=null!==e.index?i(e.index):void 0;let a=0;if(void 0!==o)a=null===e.index?0:e.index.count;else{const t=e.attributes.position;if(void 0===t)throw new Error("Missing position attibute to deduce item count");a=t.count}return{type:n.GeometryType.Unspecified,vertexAttributes:r,index:o,groups:[{start:0,count:a,technique:t}]}}}(t.ThreeBufferUtils||(t.ThreeBufferUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenProjector=void 0;const n=i(0);function r(e){return e.z>-1&&e.z<1}class s{constructor(e){this.m_camera=e,this.m_width=0,this.m_height=0}get width(){return this.m_width}get height(){return this.m_height}project(e,t=new n.Vector2){const i=this.projectVector(e,s.tempV3);return this.ndcToScreen(i,t)}projectToScreen(e,t=new n.Vector2){const i=this.projectVector(e,s.tempV3);if(r(i))return this.ndcToScreen(i,t)}projectAreaToScreen(e,t,i,o=new n.Vector2){t*=2,i*=2;const a=this.projectVector(e,s.tempV3);if(r(a)&&a.x+t>=-1&&a.x-t<=1&&a.y+i>=-1&&a.y-i<=1)return this.ndcToScreen(a,o)}project3(e,t=new n.Vector3){const i=this.projectVector(e,s.tempV3);if(i.z>-1&&i.z<1)return t.set(i.x*this.m_width/2,i.y*this.m_height/2,i.z),t}projectVector(e,t){return t.set(e.x,e.y,e.z).project(this.m_camera),t}onScreen(e){const t=this.projectVector(e,s.tempV3);return(i=t).z>-1&&i.z<1&&i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1;var i}update(e,t,i){this.m_camera=e,this.m_width=t,this.m_height=i}ndcToScreen(e,t){return t.set(e.x*this.m_width/2,e.y*this.m_height/2)}}t.ScreenProjector=s,s.tempV2=new n.Vector2,s.tempV3=new n.Vector3},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewState=void 0;const n=i(0);t.MapViewState=class{constructor(e,t){this.m_mapView=e,this.m_renderedTilesChangeCheck=t,this.m_lookAtVector=new n.Vector3}get worldCenter(){return this.m_mapView.worldCenter}get cameraIsMoving(){return this.m_mapView.cameraIsMoving}get maxVisibilityDist(){return this.m_mapView.viewRanges.maximum}get zoomLevel(){return this.m_mapView.zoomLevel}get env(){return this.m_mapView.env}get frameNumber(){return this.m_mapView.frameNumber}get lookAtVector(){return this.m_mapView.camera.getWorldDirection(this.m_lookAtVector)}get lookAtDistance(){return this.m_mapView.targetDistance}get isDynamic(){return this.m_mapView.isDynamicFrame}get hiddenGeometryKinds(){return void 0===this.m_mapView.tileGeometryManager?void 0:this.m_mapView.tileGeometryManager.hiddenGeometryKinds}get renderedTilesChanged(){return this.m_renderedTilesChangeCheck()}get projection(){return this.m_mapView.projection}get elevationProvider(){return this.m_mapView.elevationProvider}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileObjectRenderer=void 0;const n=i(3),r=i(46),s=i(123),o=i(33);t.TileObjectRenderer=class{constructor(e,t){this.m_env=e,this.m_renderer=t,this.m_renderOrderStencilValues=new Map,this.m_stencilValue=1}render(e,t,i,n,r){const s=e.computeWorldOffsetX();if(e.willRender(t)){for(const a of e.objects){const l=o.MapObjectAdapter.get(a);this.processTileObject(e,t,i,a,l)&&(this.updateStencilRef(a),a.position.copy(e.center),void 0!==a.displacement&&a.position.add(a.displacement),a.position.x+=s,a.position.sub(n),e.localTangentSpace&&a.setRotationFromMatrix(e.boundingBox.getRotationMatrix()),a.frustumCulled=!1,r.add(a))}e.didRender()}}prepareRender(){this.m_stencilValue=1,this.m_renderOrderStencilValues.clear()}setupRenderer(){const e=(e,t)=>e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.object.userData.tileKey&&t.object.userData.tileKey&&e.object.userData.tileKey.mortonCode()!==t.object.userData.tileKey.mortonCode()?e.object.userData.tileKey.mortonCode()-t.object.userData.tileKey.mortonCode():e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id;this.m_renderer.setOpaqueSort((t,i)=>{var n,s,a,l;const c=o.MapObjectAdapter.get(t.object),h=o.MapObjectAdapter.get(i.object),u=null===(n=null==c?void 0:c.dataSource)||void 0===n?void 0:n.dataSourceOrder,d=null===(s=null==h?void 0:h.dataSource)||void 0===s?void 0:s.dataSourceOrder;if(void 0!==u&&void 0!==d&&u!==d)return u-d;if(t.renderOrder===r.BackgroundDataSource.GROUND_RENDER_ORDER||i.renderOrder===r.BackgroundDataSource.GROUND_RENDER_ORDER)return e(t,i);if(void 0!==(null==c?void 0:c.level)&&void 0!==(null==h?void 0:h.level)){const n=void 0!==(null===(a=c.kind)||void 0===a?void 0:a.find(e=>"building"===e))||void 0!==(null===(l=h.kind)||void 0===l?void 0:l.find(e=>"building"===e));return c.level===h.level||n?e(t,i):c.level-h.level}return e(t,i)})}updateStencilRef(e){if(void 0!==e.renderOrder&&e instanceof s.SolidLineMesh){const t=e.material;Array.isArray(t)?t.forEach(t=>t.stencilRef=this.getStencilValue(e.renderOrder)):t.stencilRef=this.getStencilValue(e.renderOrder)}}allocateStencilValue(e){const t=this.m_stencilValue++;return this.m_renderOrderStencilValues.set(e,t),t}getStencilValue(e){var t;return null!==(t=this.m_renderOrderStencilValues.get(e))&&void 0!==t?t:this.allocateStencilValue(e)}processTileObject(e,t,i,r,s){return!!r.visible&&(!!this.processTileObjectFeatures(e,t,i,r)&&!(s&&(s.ensureUpdated(e.mapView),!s.isVisible()&&s.pickability!==n.Pickability.all)))}processTileObjectFeatures(e,t,i,r){var s,o;const a=r.userData.technique,l=n.getPropertyValue(null==a?void 0:a.minZoomLevel,this.m_env),c=n.getPropertyValue(null==a?void 0:a.maxZoomLevel,this.m_env);if("number"==typeof l&&i<l)return!1;if("number"==typeof c&&i>=c)return!1;if(void 0===(null==a?void 0:a.enabled))return!0;const h=r.userData.feature;if(!h||!n.Expr.isExpr(a.enabled))return Boolean(n.getPropertyValue(a.enabled,this.m_env));const{starts:u,objInfos:d}=h;if(!Array.isArray(d)||!Array.isArray(u))return!0;const m=r.geometry;if(!m||!m.isBufferGeometry)return!0;const p=null!==(o=null===(s=m.getIndex())||void 0===s?void 0:s.count)&&void 0!==o?o:m.attributes.position.count;let f;return m.clearGroups(),d.forEach((t,i)=>{var r,s;const o=n.getFeatureId(t);let l=!0;if(n.Expr.isExpr(a.enabled)){const i=e.dataSource.getFeatureState(o),r=i?new n.MapEnv(i):null,s="object"==typeof t?new n.MapEnv(t,this.m_env):this.m_env,c=new n.MapEnv({$state:r},s);l=Boolean(n.getPropertyValue(a.enabled,c))}if(!l)return;const c=null!==(r=u[i])&&void 0!==r?r:0,h=(null!==(s=u[i+1])&&void 0!==s?s:p)-c;c===f?m.groups[m.groups.length-1].count+=h:m.addGroup(c,h),f=c+h}),m.groups.length>0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathBlockingElement=void 0;const n=i(0);t.PathBlockingElement=class{constructor(e){this.points=e,this.screenSpaceLines=new Array(e.length>=2?e.length-1:0);for(let e=0;e<this.screenSpaceLines.length;e++)this.screenSpaceLines[e]=new n.Line3(new n.Vector3,new n.Vector3)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementGroup=void 0;const n=i(1);class r extends n.PriorityListGroup{}t.TextElementGroup=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementGroupPriorityList=void 0;const n=i(1);class r extends n.GroupedPriorityList{}t.TextElementGroupPriorityList=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileTextStyleCache=void 0;t.TileTextStyleCache=class{constructor(e){this.textRenderStyles=[],this.textLayoutStyles=[],this.tile=e}clear(){this.textRenderStyles.length=0,this.textLayoutStyles.length=0}getRenderStyle(e){let t=this.textRenderStyles[e._index];return void 0===t&&(t=this.textRenderStyles[e._index]=this.tile.mapView.textElementsRenderer.styleCache.createRenderStyle(this.tile,e)),t}getLayoutStyle(e){let t=this.textLayoutStyles[e._index];return void 0===t&&(t=this.textLayoutStyles[e._index]=this.tile.mapView.textElementsRenderer.styleCache.createLayoutStyle(this.tile,e)),t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphereViewBounds=t.computeEdgeDivisions=void 0;const n=i(2),r=i(1),s=i(0),o=i(316),a=i(9);function l(e,t){const i=Math.abs(t.latitude-e.latitude),n=e.minLongitudeSpanTo(t);return Math.ceil(Math.max(i/20,n/5))}t.computeEdgeDivisions=l;const c=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}];t.SphereViewBounds=class{constructor(e,t){this.camera=e,this.projection=t,r.assert(t.type===n.ProjectionType.Spherical)}generate(){const e=this.findBoundsIntersections();return this.wrapAroundPoles(e),e.length>2?new n.GeoPolygon(e,!1,!0):void 0}addSideSegmentSubdivisions(e,t,i,n,r){e.push(n);const o=l(n,r);if(o<=1)return;const c=new s.Vector2(i.x-t.x,i.y-t.y).multiplyScalar(1/o),h=new s.Vector2(t.x,t.y);for(let t=0;t<o-1;t++){h.add(c);const t=a.MapViewUtils.rayCastWorldCoordinates({camera:this.camera,projection:this.projection},h.x,h.y);t&&e.push(this.projection.unprojectPoint(t))}}addSideIntersections(e,t,i,n,s){const a=c[t],l=c[o.nextCanvasSide(t)];if(i&&n)return void this.addSideSegmentSubdivisions(e,a,l,i,n);if(!s)return;const h=s.getSideIntersections(t);if(0!==h.length){if(i){const t=s.getPoint(h[h.length-1]),n=this.projection.unprojectPoint(t);this.addSideSegmentSubdivisions(e,a,t.project(this.camera),i,n)}else{const i=o.previousCanvasSide(t);let n=s.getSideIntersections(i);0===n.length&&(n=s.getSideIntersections(o.previousCanvasSide(i))),r.assert(n.length>0),s.getDivisionPoints(t=>{e.push(this.projection.unprojectPoint(t))},n[n.length-1],h[0])}if(h.length>1){const t=s.getPoint(h[0]),i=s.getPoint(h[1]),n=this.projection.unprojectPoint(t),r=this.projection.unprojectPoint(i);this.addSideSegmentSubdivisions(e,t.project(this.camera),i.project(this.camera),n,r)}if(n){const t=s.getPoint(h[0]),i=this.projection.unprojectPoint(t);this.addSideSegmentSubdivisions(e,t.project(this.camera),l,i,n)}}}findBoundsIntersections(){const e=[],[t,i]=this.addCanvasCornerIntersection(),n=i<4?new o.SphereHorizon(this.camera,t.map(e=>void 0!==e)):void 0;if(0===i&&n.isFullyVisible)return n.getDivisionPoints(t=>{e.push(this.projection.unprojectPoint(t))}),e;for(let i=o.CanvasSide.Bottom;i<4;i++){const r=t[i],s=t[o.nextCanvasSide(i)];this.addSideIntersections(e,i,r,s,n)}return e}wrapAroundPoles(e){const t=new s.Vector3(0,0,n.EarthConstants.EQUATORIAL_RADIUS),i=new s.Vector3(0,0,-n.EarthConstants.EQUATORIAL_RADIUS),r=a.MapViewUtils.closeToFrustum(t,this.camera),o=a.MapViewUtils.closeToFrustum(i,this.camera);if(!r&&!o)return;const l=this.projection.unprojectPoint(this.camera.position).lng,c=r?90:-90,h=r?l+180:l-180,u=new n.GeoCoordinates(c,h),d=u.normalized(),m=d.lng;let p=e[e.length-1].lng,f=!1;const g=e.findIndex(e=>{const t=n.isAntimeridianCrossing(p,e.lng);return Math.sign(m-e.lng)===Math.sign(m-p)===t?(f=t,!0):(p=e.lng,!1)});if(g<0)return;const v=r?90:-90,y=r?1e-5:-1e-5,_=new n.GeoCoordinates(c,l+v).normalized(),x=new n.GeoCoordinates(c,l).normalized(),w=new n.GeoCoordinates(c,l-v).normalized(),b=new n.GeoCoordinates(c,h+y).normalized(),M=e[(g+e.length-1)%e.length],T=e[g];let S=n.GeoCoordinates.lerp(M,T,.01,f);f&&r?S.longitude-=360:S=S.normalized(),e.splice(g,0,h<-180?u:d,_,x,w,b,S)}addCanvasCornerIntersection(){const e=new Array;let t=0;return c.forEach(i=>{const n=a.MapViewUtils.rayCastWorldCoordinates({camera:this.camera,projection:this.projection},i.x,i.y);n?(e.push(this.projection.unprojectPoint(n)),++t):e.push(void 0)}),[e,t]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphereHorizon=t.previousCanvasSide=t.nextCanvasSide=t.CanvasSide=void 0;const n=i(2),r=i(1),s=i(0),o=i(32),a=i(9),l=2*Math.PI;var c;function h(e){return(e+1)%4}!function(e){e[e.Bottom=0]="Bottom",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Left=3]="Left"}(c=t.CanvasSide||(t.CanvasSide={})),t.nextCanvasSide=h,t.previousCanvasSide=function(e){return(e+3)%4};t.SphereHorizon=class{constructor(e,t){this.m_camera=e,this.m_cornerIntersects=t,this.m_intersections=[],this.m_isFullyVisible=!0;const i=n.EarthConstants.EQUATORIAL_RADIUS*n.EarthConstants.EQUATORIAL_RADIUS,r=(new s.Vector3).setFromMatrixColumn(e.matrixWorld,0).normalize(),o=e.position.clone().normalize(),l=(new s.Vector3).crossVectors(o,r),c=e.position.length();this.m_normalToTangentAngle=Math.asin(n.EarthConstants.EQUATORIAL_RADIUS/c);const h=Math.sqrt(c*c-i);this.m_distanceToHorizonCenter=h*Math.cos(this.m_normalToTangentAngle);const u=c-this.m_distanceToHorizonCenter;this.m_radius=Math.sqrt(i-u*u),this.m_cameraPitch=a.MapViewUtils.extractAttitude({projection:n.sphereProjection},this.m_camera).pitch;const d=(new s.Vector3).copy(o).setLength(u);this.m_matrix=(new s.Matrix4).makeBasis(r,l,o).setPosition(d),this.computeIntersections()}getPoint(e,t=0,i=1,n=new s.Vector3){const r=t*l,o=r+e*((i>=t?i*l:(i+1)*l)-r);return n.set(this.m_radius*Math.cos(o),this.m_radius*Math.sin(o),0),n.applyMatrix4(this.m_matrix),n}getDivisionPoints(e,t=0,i=1,n=10){const r=Math.max(Math.ceil(((i<t?1+i:i)-t)*n),1);for(let n=0;n<r;n++)e(this.getPoint(n/r,t,i))}get isFullyVisible(){return this.m_isFullyVisible}getSideIntersections(e){return this.m_intersections[e]}isTangentVisible(e){switch(e){case c.Top:{const e=this.m_normalToTangentAngle-this.m_cameraPitch;return o.CameraUtils.getTopFov(this.m_camera)>=Math.abs(e)}case c.Bottom:{const e=this.m_normalToTangentAngle+this.m_cameraPitch;return o.CameraUtils.getBottomFov(this.m_camera)>=Math.abs(e)}case c.Left:{const e=this.m_normalToTangentAngle;return o.CameraUtils.getLeftFov(this.m_camera)>=Math.abs(e)&&this.m_cameraPitch<=o.CameraUtils.getBottomFov(this.m_camera)}case c.Right:{const e=this.m_normalToTangentAngle;return o.CameraUtils.getRightFov(this.m_camera)>=Math.abs(e)&&this.m_cameraPitch<=o.CameraUtils.getBottomFov(this.m_camera)}}}getTangentOnSide(e){switch(e){case c.Bottom:return.75;case c.Right:return 0;case c.Top:return.25;case c.Left:return.5}}computeIntersections(){const e=this.m_distanceToHorizonCenter*Math.tan(this.m_cameraPitch-o.CameraUtils.getBottomFov(this.m_camera));let t,i;for(let n=c.Bottom;n<4;n++){if(this.isTangentVisible(n)){this.m_intersections.push([this.getTangentOnSide(n)]);continue}const r=new Array;switch(this.m_isFullyVisible=!1,n){case c.Bottom:r.push(...this.computeTBIntersections(e));break;case c.Right:{const n=o.CameraUtils.getRightFov(this.m_camera),s=this.computeLRIntersections(e,n);s&&([t,i]=s,r.push(void 0!==i?1+i:void 0,t));break}case c.Top:{const e=this.m_distanceToHorizonCenter*Math.tan(this.m_cameraPitch+o.CameraUtils.getTopFov(this.m_camera));r.push(...this.computeTBIntersections(e).reverse());break}case c.Left:{const n=o.CameraUtils.getLeftFov(this.m_camera);if(n===o.CameraUtils.getRightFov(this.m_camera))r.push(void 0!==t?.5-t:void 0,void 0!==i?.5-i:void 0);else{const t=this.computeLRIntersections(e,n);t&&r.push(.5-t[0],void 0!==t[1]?.5-t[1]:void 0)}break}}const s=[this.m_cornerIntersects[n],this.m_cornerIntersects[h(n)]];this.m_intersections.push(r.filter((e,t)=>void 0!==e&&!s[t]))}}computeTBIntersections(e){const t=this.m_radius*this.m_radius,i=Math.sqrt(t-e*e),n=Math.atan2(e,i)/l;return[.5-n,n>0?n:1+n]}computeLRIntersections(e,t){const i=this.m_distanceToHorizonCenter/Math.cos(this.m_cameraPitch),n=this.m_distanceToHorizonCenter*Math.tan(this.m_cameraPitch),s=i*Math.tan(t),a=o.CameraUtils.getBottomFov(this.m_camera),c=s*(this.m_distanceToHorizonCenter*Math.cos(a)/Math.cos(this.m_cameraPitch-a))/i,h=r.Math2D.intersectLineAndCircle(c,e,s,n,this.m_radius);if(!h)return;const u=h.y1;return[Math.atan2(u,h.x1)/l,-u>=e&&void 0!==h.x2?Math.atan2(h.y2,h.x2)/l:void 0]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightElementHandler=void 0;const n=i(1),r=i(15),s=i(73);class o{constructor(e,t){if(this.m_defaults=new Map,this.m_mapViews=[],this.update=()=>{var e;const t=this.m_mapViews.map(e=>e.copyrightInfo).reduce(s.CopyrightInfo.mergeArrays,null!==(e=this.staticInfo)&&void 0!==e?e:[]);if(0===t.length)return void(this.m_element.style.display="none");if(this.m_element.style.display="block",0!==this.m_defaults.size)for(const e of t){const t=this.m_defaults.get(e.id);void 0!==t&&(e.year=n.getOptionValue(e.year,t.year),e.label=n.getOptionValue(e.label,t.label),e.link=n.getOptionValue(e.link,t.link))}const i=s.CopyrightInfo.mergeArrays(t);this.m_element.innerHTML=s.CopyrightInfo.formatAsHtml(i)},"string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error("CopyrightElementHandler: unable to find DOM element #"+e);this.m_element=t}else this.m_element=e;void 0!==t&&this.attach(t)}static install(e,t){return new o(e,t)}destroy(){for(const e of this.m_mapViews)e.removeEventListener(r.MapViewEventNames.CopyrightChanged,this.update)}attach(e){return this.m_mapViews.push(e),e.addEventListener(r.MapViewEventNames.CopyrightChanged,this.update),this.update(),this}detach(e){return e.removeEventListener(r.MapViewEventNames.CopyrightChanged,this.update),this.m_mapViews=this.m_mapViews.filter(t=>t!==e),this.update(),this}setDefaults(e){if(this.m_defaults.clear(),void 0!==e)for(const t of e)this.m_defaults.set(t.id,t);return this}setStaticCopyightInfo(e){return this.staticInfo=e,this}}t.CopyrightElementHandler=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UrlCopyrightProvider=void 0;const n=i(160),r=i(159);class s extends r.CopyrightCoverageProvider{constructor(e,t,i,r=n.TransferManager.instance()){super(),this.m_fetchURL=e,this.m_baseScheme=t,this.m_requestHeaders=i,this.m_transferManager=r}setRequestHeaders(e){this.m_requestHeaders=e}getCopyrightCoverageData(e){return void 0!==this.m_cachedCopyrightResponse||(this.m_cachedCopyrightResponse=this.m_transferManager.downloadJson(this.m_fetchURL,{headers:this.m_requestHeaders,signal:e}).then(e=>e[this.m_baseScheme]).catch(e=>(this.logger.error(e),[]))),this.m_cachedCopyrightResponse}}t.UrlCopyrightProvider=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransferManager=void 0,i(16);const n=i(321);class r{constructor(e=fetch,t=5){this.fetchFunction=e,this.maxRetries=t,this.activeDownloadCount=0,this.downloadQueue=new Array,this.activeDownloads=new Map}static instance(){return r.defaultInstance}static async fetchRepeatedly(e,t,i,n,s){try{if(!(t<i))throw new Error("Max number of retries reached");{const r=await e(n,s);if(200===r.status||204===r.status)return r;if(r.status>=400&&r.status<500){t=i;const e=await r.text();throw new Error(e)}}}catch(e){if(e.hasOwnProperty("isCancelled")||"AbortError"===e.name||t>=i)throw e}return await r.waitFor(r.retryTimeout*t).then(()=>r.fetchRepeatedly(e,t+1,i,n,s))}static waitFor(e){return new Promise(t=>setTimeout(t,e))}downloadJson(e,t){return this.downloadAs(e=>e.json(),e,t)}downloadArrayBuffer(e,t){return this.download(e,t).then(e=>e.arrayBuffer())}download(e,t){if(this.activeDownloadCount>=r.maxParallelDownloads){const i=new n.DeferredPromise(()=>this.doDownload(e,t));return this.downloadQueue.push(i),i.promise}return this.doDownload(e,t)}async doDownload(e,t){try{++this.activeDownloadCount;const i=await r.fetchRepeatedly(this.fetchFunction,0,this.maxRetries,e,t);return this.onDownloadDone(),i}catch(e){throw this.onDownloadDone(),e}}onDownloadDone(){--this.activeDownloadCount,this.execDeferredDownload()}execDeferredDownload(){const e=this.downloadQueue.pop();void 0!==e&&e.exec()}downloadAs(e,t,i){const n=t,r=this.activeDownloads.get(n);if(void 0!==r)return Promise.resolve(r);const s=this.download(t,i).then(t=>{if(this.activeDownloads.delete(n),t.ok)return e(t);throw new Error(JSON.stringify(t))}).catch(e=>{throw this.activeDownloads.delete(n),e});return this.activeDownloads.set(n,s),s}}t.TransferManager=r,r.retryTimeout=500,r.maxParallelDownloads=16,r.defaultInstance=new r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeferredPromise=void 0;t.DeferredPromise=class{constructor(e){this.executor=e,this.promise=new Promise((e,t)=>{this.resolveFunc=e,this.rejectFunc=t})}exec(){this.executor().then(e=>this.resolveFunc(e)).catch(e=>this.rejectFunc(e))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FixedClipPlanesEvaluator=void 0;t.FixedClipPlanesEvaluator=class{constructor(e=1,t=10){this.minNear=e,this.minFarOffset=t,this.minFar=e+t,this.m_nearPlane=e,this.m_farPlane=this.minFar}get nearPlane(){return this.m_nearPlane}set nearPlane(e){this.invalidatePlanes(e,this.m_farPlane)}get farPlane(){return this.m_farPlane}set farPlane(e){this.invalidatePlanes(this.m_nearPlane,e)}set minElevation(e){}get minElevation(){return 0}set maxElevation(e){}get maxElevation(){return 0}evaluateClipPlanes(e,t,i){return{near:this.m_nearPlane,far:this.m_farPlane,minimum:this.minNear,maximum:this.m_farPlane}}invalidatePlanes(e,t){const i=Math.max(this.minNear,e),n=Math.max(this.minFar,t,i+this.minFarOffset);this.m_nearPlane=i,this.m_farPlane=n}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewAtmosphere=t.AtmosphereLightMode=void 0;const n=i(2),r=i(4),s=i(1),o=i(0),a=i(71);var l,c,h;!function(e){e[e.Ground=1]="Ground",e[e.Sky=2]="Sky",e[e.SkyAndGround=3]="SkyAndGround"}(l||(l={})),function(e){e[e.ScatteringShader=0]="ScatteringShader",e[e.SimpleColor=1]="SimpleColor",e[e.Wireframe=2]="Wireframe"}(c||(c={})),function(e){e[e.LightOverhead=0]="LightOverhead",e[e.LightDynamic=1]="LightDynamic"}(h=t.AtmosphereLightMode||(t.AtmosphereLightMode={}));const u={clipPlanes:{near:0,far:0}};class d{constructor(e,t,i,r,s,h=l.SkyAndGround,u=c.ScatteringShader){this.m_mapAnchors=e,this.m_sceneCamera=t,this.m_projection=i,this.m_rendererCapabilities=r,this.m_updateCallback=s,this.m_atmosphereVariant=h,this.m_materialVariant=u,this.m_enabled=!0,this.m_clipPlanesEvaluator=new a.TiltViewClipPlanesEvaluator(.025*n.EarthConstants.EQUATORIAL_RADIUS,0,1,.05,1e7),this.m_lightDirection=new o.Vector3(0,1,0),this.m_atmosphereVariant&l.Sky&&this.createSkyGeometry(),this.m_atmosphereVariant&l.Ground&&this.createGroundGeometry(),this.addToMapAnchors(this.m_mapAnchors)}static isPresent(e){for(const t of e.children)if(t.name===d.SkyAtmosphereUserName||t.name===d.GroundAtmosphereUserName)return!0;return!1}get skyMesh(){return this.m_skyMesh}get groundMesh(){return this.m_groundMesh}set enabled(e){if(this.disposed)return;if(this.m_enabled===e)return;this.m_enabled=e;const t=d.isPresent(this.m_mapAnchors);e&&!t?this.addToMapAnchors(this.m_mapAnchors):!e&&t&&this.removeFromMapAnchors(this.m_mapAnchors)}get enabled(){return this.m_enabled}set lightMode(e){if(this.m_materialVariant!==c.ScatteringShader)return;const t=e===h.LightDynamic;if(void 0!==this.m_groundMaterial){this.m_groundMaterial.setDynamicLighting(t)}if(void 0!==this.m_skyMaterial){this.m_skyMaterial.setDynamicLighting(t)}}dispose(){var e,t,i,n;this.enabled&&(this.enabled=!1),null===(e=this.m_skyMaterial)||void 0===e||e.dispose(),null===(t=this.m_groundMaterial)||void 0===t||t.dispose(),null===(i=this.m_skyGeometry)||void 0===i||i.dispose(),null===(n=this.m_groundGeometry)||void 0===n||n.dispose(),this.m_skyGeometry=void 0,this.m_groundGeometry=void 0,this.m_skyMaterial=void 0,this.m_groundMaterial=void 0,this.m_skyMesh=void 0,this.m_groundMesh=void 0}reset(e){}get disposed(){return void 0===this.m_skyMesh&&void 0===this.m_groundMesh}addToMapAnchors(e){s.assert(!d.isPresent(e),"Atmosphere already added"),void 0!==this.m_skyMesh&&e.add(m(this.m_skyMesh,Number.MIN_SAFE_INTEGER)),void 0!==this.m_groundMesh&&e.add(m(this.m_groundMesh,Number.MAX_SAFE_INTEGER)),this.m_updateCallback&&this.m_updateCallback()}removeFromMapAnchors(e){if(!d.isPresent(e))return;let t=!1;void 0!==this.m_skyMesh&&(e.remove(this.m_skyMesh),t=!0),void 0!==this.m_groundMesh&&(e.remove(this.m_groundMesh),t=!0),t&&this.m_updateCallback&&this.m_updateCallback()}createSkyGeometry(){switch(this.m_projection.type){case n.ProjectionType.Spherical:this.m_skyGeometry=new o.SphereGeometry(1.025*n.EarthConstants.EQUATORIAL_RADIUS,256,256);break;default:this.m_skyGeometry=new o.PlaneGeometry(200,200)}this.m_skyGeometry.translate(0,0,0),this.m_materialVariant===c.ScatteringShader?this.m_skyMaterial=new r.SkyAtmosphereMaterial({rendererCapabilities:this.m_rendererCapabilities}):this.m_materialVariant===c.SimpleColor?this.m_skyMaterial=new o.MeshBasicMaterial({color:new o.Color(12908781),opacity:.4,transparent:!1,depthTest:!0,depthWrite:!1,side:o.BackSide,blending:o.NormalBlending,fog:!1}):this.m_skyMaterial=new o.MeshStandardMaterial({color:8388607,depthTest:!1,depthWrite:!1,normalScale:new o.Vector2(-1,-1),side:o.BackSide,wireframe:!0}),this.m_skyMesh=new o.Mesh(this.m_skyGeometry,this.m_skyMaterial),this.m_skyMesh.name=d.SkyAtmosphereUserName,this.setupSkyForRendering()}createGroundGeometry(){switch(this.m_projection.type){case n.ProjectionType.Spherical:this.m_groundGeometry=new o.SphereGeometry(1.0001*n.EarthConstants.EQUATORIAL_RADIUS,256,256);break;default:this.m_groundGeometry=new o.PlaneGeometry(200,200)}this.m_groundGeometry.translate(0,0,0),this.m_materialVariant===c.ScatteringShader?this.m_groundMaterial=new r.GroundAtmosphereMaterial({rendererCapabilities:this.m_rendererCapabilities}):this.m_materialVariant===c.SimpleColor?this.m_groundMaterial=new o.MeshBasicMaterial({color:new o.Color(50687),opacity:.4,transparent:!0,depthTest:!1,depthWrite:!1,side:o.FrontSide,blending:o.NormalBlending,fog:!1}):this.m_groundMaterial=new o.MeshStandardMaterial({color:1149338,depthTest:!0,depthWrite:!1,side:o.FrontSide,wireframe:!0}),this.m_groundMesh=new o.Mesh(this.m_groundGeometry,this.m_groundMaterial),this.m_groundMesh.name=d.GroundAtmosphereUserName,this.setupGroundForRendering()}setupSkyForRendering(){if(void 0===this.m_skyMesh)return;let e;e=this.m_materialVariant!==c.ScatteringShader?(e,t)=>{this.overrideClipPlanes(e)}:(e,t)=>{this.overrideClipPlanes(e),s.assert(t instanceof r.SkyAtmosphereMaterial);const i=this.m_skyMaterial;i.updateUniforms(i,this.m_skyMesh,e,this.m_lightDirection)},s.assert(void 0!==this.m_skyMaterial),this.m_skyMesh.onBeforeRender=(t,i,n,r,s,o)=>{e(n,s)},this.m_skyMesh.onAfterRender=(e,t,i,n,r,s)=>{this.revertClipPlanes(i)}}setupGroundForRendering(){void 0!==this.m_groundMesh&&this.m_materialVariant===c.ScatteringShader&&(s.assert(void 0!==this.m_groundMaterial),this.m_groundMesh.onBeforeRender=(e,t,i,n,o,a)=>{s.assert(o instanceof r.GroundAtmosphereMaterial);const l=this.m_groundMaterial;l.updateUniforms(l,this.m_groundMesh,i,this.m_lightDirection)})}overrideClipPlanes(e){const t=this.m_sceneCamera;u.clipPlanes.near=t.near,u.clipPlanes.far=t.far;const i=this.m_clipPlanesEvaluator.evaluateClipPlanes(this.m_sceneCamera,this.m_projection);s.assert(e instanceof o.PerspectiveCamera);const r=e;r.near=i.near,r.far=i.far+.1*n.EarthConstants.EQUATORIAL_RADIUS,r.updateProjectionMatrix()}revertClipPlanes(e){s.assert(e instanceof o.PerspectiveCamera);const t=e;t.near=u.clipPlanes.near,t.far=u.clipPlanes.far,t.updateProjectionMatrix()}}function m(e,t){const i=e;return i.renderOrder=t,i.pickable=!1,i.anchor=new o.Vector3(0,0,0),i}t.MapViewAtmosphere=d,d.SkyAtmosphereUserName="SkyAtmosphere",d.GroundAtmosphereUserName="GroundAtmosphere"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureLoader=void 0;const n=i(0);t.TextureLoader=class{constructor(){this.m_textureLoader=new n.TextureLoader}async load(e,t,i,r=!0){if(void 0===t)return await this.loadWithThreeLoader(e);const s=await fetch(e,{headers:t,signal:i,mode:r?"cors":"no-cors"}),o=await s.blob(),a=await this.loadWithThreeLoader(URL.createObjectURL(o)),l="image/jpeg/"===o.type||e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);return a.format=l?n.RGBFormat:n.RGBAFormat,a}loadWithThreeLoader(e){return new Promise((t,i)=>{this.m_textureLoader.setCrossOrigin(""),this.m_textureLoader.load(e,e=>t(e),void 0,()=>i(new Error("failed to load texture")))})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDataAccessor=void 0;const n=i(3),r=i(1),s=i(161),o=r.LoggerManager.instance.create("TileDataAccessor");t.TileDataAccessor=class{constructor(e,t,i){this.tile=e,this.visitor=t;const n=!0===i.wantsAll;this.m_wantsPoints=n||!(!1===i.wantsPoints),this.m_wantsLines=n||!(!1===i.wantsLines),this.m_wantsAreas=n||!(!1===i.wantsAreas),this.m_wantsObject3D=n||!(!1===i.wantsObject3D)}visitAll(){const e=this.tile.objects;for(const t of e)this.visitObject(t)}visitObject(e){const t=void 0!==e.userData?e.userData.feature:void 0;if(void 0===t||void 0!==t.objInfos&&1===t.objInfos.length&&!this.visitor.wantsFeature(n.getFeatureId(t.objInfos[0])))return;const i=t.geometryType;if(void 0===i)return void o.warn("#visitObject: visiting object failed, no geometryType",e);switch(r.assert(void 0!==t.objInfos,"featureData.ids missing"),r.assert(void 0!==t.starts,"featureData.starts missing"),r.assert(Array.isArray(t.starts),"featureData.starts is not an array"),void 0!==t.objInfos&&void 0!==t.starts&&r.assert(t.objInfos.length===t.starts.length,"featureData.ids and featureData.starts have unequal length"),i){case n.GeometryType.Point:case n.GeometryType.Text:if(!this.m_wantsPoints)return;break;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:if(!this.m_wantsLines)return;break;case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:if(!this.m_wantsAreas)return;break;case n.GeometryType.Object3D:if(!this.m_wantsObject3D)return;break;default:o.warn("#visitObject: invalid geometryType")}if("Mesh"!==e.type)return void o.warn("#visitObject: visiting object failed, not of type 'Mesh'",e);const s=e;this.visitMesh(s,t)}getBufferGeometry(e){const t=e.geometry;if("BufferGeometry"!==t.type)return void o.warn("#visitObject: object does not have BufferGeometry");const i=t;if(i.getAttribute("position"))return i;o.warn("#visitLines: BufferGeometry has no position attribute")}getGeometryAccessor(e,t,i){switch(e){case n.GeometryType.Point:case n.GeometryType.Text:return;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:return new s.BufferedGeometryLineAccessor(t,e,i);case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:return;case n.GeometryType.Object3D:return new s.BufferedGeometryObject3dAccessor(t,e,i);default:o.warn("#getGeometryAccessor: invalid geometryType")}}getIndexedGeometryAccessor(e,t,i){switch(e){case n.GeometryType.Point:case n.GeometryType.Text:return;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:return new s.IndexedBufferedGeometryLineAccessor(t,e,i);case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:case n.GeometryType.Object3D:return;default:o.warn("#getIndexedGeometryAccessor: invalid geometryType")}}visitMesh(e,t){const{objInfos:i,starts:a}=t,l=t.geometryType;if(void 0===i||void 0===a||void 0===l)return;let c;for(let t=0;t<i.length;t++){const h=n.getFeatureId(i[t]);if(!this.visitor.wantsFeature(h))continue;const u=a[t];let d=-1;if(void 0===c){const t=this.getBufferGeometry(e);if(void 0===t)continue;if(c=null!==t.index?this.getIndexedGeometryAccessor(l,e,t):this.getGeometryAccessor(l,e,t),void 0===c){o.warn("#visitObject: no accessor geometryType",l);continue}}switch(d=t<a.length-1?a[t+1]:c.getCount(),c.setRange(u,d),l){case n.GeometryType.Point:case n.GeometryType.Text:this.visitor.visitPoint(h);break;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:r.assert(s.isLineAccessor(c)),this.visitor.visitLine(h,c);break;case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:this.visitor.visitArea(h);break;case n.GeometryType.Object3D:r.assert(s.isObject3dAccessor(c)),this.visitor.visitObject3D(h,c);break;default:o.warn("#visitObject: invalid geometryType")}}}}},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(162),t),r(i(82),t),r(i(163),t),r(i(83),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionPoints=void 0;const n=i(4),r=i(0),s=i(83);class o extends r.Points{constructor(e,t,i,s,o){void 0===t&&(t=new n.HighPrecisionPointMaterial({color:s||n.HighPrecisionPointMaterial.DEFAULT_COLOR,opacity:void 0!==o?o:1})),super(void 0===e?new r.BufferGeometry:e,t),this.matrixWorldInverse=new r.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}clearGeometry(){return this.geometry=new r.BufferGeometry}get shaderMaterial(){return this.material}setPositions(e){s.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.material.isHighPrecisionPointsMaterial&&void 0!==this.dimensionality&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=(e,t,i,n,r,o)=>{s.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionPoints=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Animation=void 0;const n=i(15),r=i(59);t.Animation=class{constructor(e,t,i){this.mapView=e,this.duration=t,this.updateCallback=i,this.running=!1,this.m_lastFrameTime=0,this.m_startTime=0,this.m_animateCb=e=>{this.animate(e.time<this.m_startTime?r.PerformanceTimer.now():e.time)}}start(e,t){if(!this.running)return this.running=!0,this.onFinished=t,this.mapView.addEventListener(n.MapViewEventNames.Render,this.m_animateCb),this.mapView.beginAnimation(),this.m_startTime=null!=e?e:r.PerformanceTimer.now(),this.m_lastFrameTime=this.m_startTime,this}stop(e=!1){this.running&&(this.running=!1,this.mapView.endAnimation(),this.mapView.removeEventListener(n.MapViewEventNames.Render,this.m_animateCb),void 0===this.onFinished||e||this.onFinished())}animate(e){const t=e-this.m_startTime,i=e-this.m_lastFrameTime;let n=t/this.duration;(0===this.duration||n>1)&&(n=1),this.m_lastFrameTime=e,this.update(n,t,i,e),n>=1&&this.stop()}update(e,t,i,n){void 0!==this.updateCallback&&this.updateCallback(e,t,i,n)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Layers=void 0;const n=i(58),r=i(165),s=i(88),o=i(181),a=i(385),l=i(182),c=i(391),h=i(18),u=i(392),d=i(85),m=i(89),p=i(183),f=n.LoggerManager.instance.create("harp::Layers");class g{constructor(e,t,i,n){this.mapView=e,this.dataModel=t,this.lookAtManipulator=i,this.surfaceFactory=n,this.m_layerSourceMap=new Map,this.m_renderers=[],this.m_themeManager=new v(t),t.addEventListener("add",this.onAdd,!1,this),t.addEventListener("remove",this.onRemove,!1,this),t.addEventListener("set",this.onSet,!1,this),t.addEventListener("configchange",this.onConfigChange,!1,this),t.addEventListener("update",this.onUpdate,!1,this),t.asArray().forEach((e,t)=>{this.add(e,t),this.resetDataSourceOrder()})}forEachRenderer(e){this.m_renderers.forEach((t,i)=>e(t,i))}dispose(){this.dataModel.getLength()>0&&this.updateMinMaxListeners(this.dataModel.get(0),!1),this.dataModel.asArray().forEach((e,t)=>{this.remove(e,t)}),this.m_renderers.forEach(e=>e.dispose()),this.m_layerSourceMap.clear(),this.dataModel.removeEventListener("add",this.onAdd,!1,this),this.dataModel.removeEventListener("remove",this.onRemove,!1,this),this.dataModel.removeEventListener("set",this.onSet,!1,this),this.dataModel.removeEventListener("configchange",this.onConfigChange,!1,this),this.dataModel.removeEventListener("update",this.onUpdate,!1,this)}resetDataSourceOrder(){this.dataModel.asArray().forEach((e,t)=>{const i=this.m_layerSourceMap.get(e);void 0!==i&&(i.dataSourceOrder=t)}),this.mapView.update()}sortSurfaces(){this.m_renderers.forEach(e=>{const t=e.getLayer();e.getSurface().setZIndex(this.dataModel.indexOf(t))})}async add(e,t){const i=e.getProvider();0===t&&(this.updateMinMaxListeners(e,!0),this.adjustZoomConstraints());const n="H-"+(null==i?void 0:i.uid);let s=!1,m=!1;if(function(e){return void 0!==e.requestDomMarkers}(e)){const t=new H.map.render.dom.MarkerRenderer(e);t.setSurface(this.surfaceFactory.createDOMSurface()),this.m_renderers.push(t);const i=this.dataModel.asArray();this.m_renderers.sort((e,t)=>i.indexOf(e.getLayer())-i.indexOf(t.getLayer())),m=!0,this.sortSurfaces()}const p={name:n,minDisplayLevel:e.min,maxDisplayLevel:e.max,minDataLevel:i.min,maxDataLevel:i.max};if(i instanceof H.map.provider.RemoteTileProvider){const t=i.getStyleInternal();if(!(t instanceof l.Style))throw new H.lang.IllegalOperationError(this.add,"Wrong style format for layer "+n);const r=t;if(r.getState()!==H.map.render.Style.State.READY&&r.load(),i.providesOMV()){const t=new h.VectorTileDataSource(Object.assign(Object.assign({},p),{addGroundPlane:!1,styleSetName:i instanceof H.service.omv.Provider?"tilezen":n,dataProvider:new c.VectorTileDataProvider(i),storageLevelOffset:-1,gatherFeatureAttributes:!0}));if(this.m_layerSourceMap.set(e,t),await this.mapView.addDataSource(t),r.getState()===H.map.render.Style.State.READY){const e=r.getConfig();g.setStyleSetName(e,t.styleSetName),t.setTheme(e)}s=!0}else if(i.providesRasters()){const t=new d.WebTileDataSource(Object.assign(Object.assign({},p),{dataProvider:new u.WebTileDataProvider(i),storageLevelOffset:0,renderingOptions:{opacity:i.getOpacityInternal(),transparent:!0}}));this.m_layerSourceMap.set(e,t),await this.mapView.addDataSource(t),s=!0}else if(i.providesSpatials()||i.providesMarkers()||i.providesGeoJSON()){const t=new a.ObjectTileDataSource(p,i);let n=r.getConfig();if(void 0!==n.styles)r.getState()===H.map.render.Style.State.READY&&(g.setStyleSetName(n,t.styleSetName),t.setTheme(n));else{const e=new o.ObjectStyleBuilder(t.styleSetName);i.providesMarkers()?e.withPoi():i.providesSpatials()&&(e.withLine(!0),e.withPolygon()),n=e.build(),t.setTheme(n)}this.m_layerSourceMap.set(e,t),await this.mapView.addDataSource(t),s=!0}}else if(i instanceof H.map.provider.ObjectProvider){const t=new r.LocalObjectDataSource(p,i),n=new o.ObjectStyleBuilder(t.styleSetName).withPoi().withLine(!1).withPolygon(!0,!0).withOverlay().withVolatile().build();t.setTheme(n),this.m_layerSourceMap.set(e,t),await this.mapView.addDataSource(t),s=!0}s||m||f.warn("Unsupported layer",e,i),s&&this.needsThemeUpdate(e)&&this.setTheme()}remove(e,t){for(let t=0;t<this.m_renderers.length;t++)if(this.m_renderers[t].getLayer()===e){this.m_renderers[t].dispose(),this.m_renderers.splice(t,1);break}const i=this.m_layerSourceMap.get(e);void 0!==i&&(this.mapView.removeDataSource(i),i.dispose(),this.m_layerSourceMap.delete(e),this.needsThemeUpdate(e)&&this.setTheme()),0===t&&this.updateMinMaxListeners(e,!1),0===this.dataModel.getLength()&&this.adjustZoomConstraints()}async onSet(e){e.removed instanceof H.map.layer.Layer&&this.remove(e.removed,e.idx),e.added instanceof H.map.layer.Layer&&await this.add(e.added,e.idx),this.resetDataSourceOrder()}onConfigChange(e){var t;const i=e.target.getProvider(),n=null===(t=null==i?void 0:i.getStyleInternal)||void 0===t?void 0:t.call(i);if(n instanceof l.Style)if(n.getState()===H.map.render.Style.State.READY){const t=this.m_layerSourceMap.get(e.target);if(null!=t&&!t.isDetached()){const e=n.getConfig();g.setStyleSetName(e,t.styleSetName),t.setTheme(e),this.setTheme()}}else n.getState()===H.map.render.Style.State.INIT&&n.load()}onUpdate(e){const t=e.target,i=t.getProvider();if(this.m_layerSourceMap.has(t)){const e=this.m_layerSourceMap.get(t);e instanceof s.ObjectDataSource||(this.mapView.markTilesDirty(e),e instanceof d.WebTileDataSource&&i.providesRasters()&&(e.opacity=i.getOpacityInternal())),this.mapView.update()}}async onAdd(e){await this.add(e.added,e.idx),this.resetDataSourceOrder()}onRemove(e){this.remove(e.removed,e.idx),this.resetDataSourceOrder()}adjustZoomConstraints(){const e=this.dataModel.asArray(),{min:t,max:i}=m.default.lookAt.zoom;e.length>0?this.lookAtManipulator.setZoomConstraints(Math.max(t,e[0].min),Math.min(i,e[0].max)):this.lookAtManipulator.setZoomConstraints(t,i);const n=this.mapView.zoomLevel,r=this.lookAtManipulator.clampZoom(n);r!==n&&(this.mapView.zoomLevel=r)}updateMinMaxListeners(e,t){t?(e.addEventListener("minchange",this.adjustZoomConstraints,!1,this),e.addEventListener("maxchange",this.adjustZoomConstraints,!1,this)):(e.removeEventListener("minchange",this.adjustZoomConstraints,!1,this),e.removeEventListener("maxchange",this.adjustZoomConstraints,!1,this))}async setTheme(){await this.mapView.setTheme(this.m_themeManager.merge()),this.mapView.update()}static isSupportedStyle(e){return e instanceof l.Style&&e.getState()===H.map.render.Style.State.READY}static setStyleSetName(e,t){var i,n;const r=Array.isArray(e.styles);let s=r?e.styles:void 0!==(null===(i=null==e?void 0:e.styles)||void 0===i?void 0:i[t])?null===(n=null==e?void 0:e.styles)||void 0===n?void 0:n[t]:[];r?(s=s.filter(e=>void 0===e.styleSet||e.styleSet===t),s.forEach(e=>{e.styleSet=t}),e.styles=s):e.styles={[t]:s}}needsThemeUpdate(e){return g.isSupportedStyle(e.getProvider().getStyleInternal())||e.dark!==this.m_themeManager.dark||0===this.dataModel.getLength()}}t.Layers=g;class v{constructor(e){this.dataModel=e,this.dark=void 0}merge(){const e=[],t=this.dataModel.asArray();return 0===t.length?(this.dark=void 0,{}):(this.dark=t[0].dark,e.push(p.getDefaultTheme(this.dark)),t.forEach(t=>{var i;const n=null===(i=t.getProvider())||void 0===i?void 0:i.getStyleInternal();if(g.isSupportedStyle(n)){const t=n.getConfig();delete t.styles,delete t.labelPriorities,delete t.priorities,delete t.definitions,e.push(t)}}),{extends:e})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalObjectDataProvider=void 0;const n=i(0),r=i(333),s=i(350),o=i(174),a=i(103),l=i(49),c=i(1),h=i(87),u=c.LoggerManager.instance.create("harp::ObjectDataProvider"),d=new n.Box3;function m(e,t){return H.map.Object.compareZInfo(e.getZInfo(),t.getZInfo(),!1)}class p extends o.ObjectDataProvider{constructor(e){super(e),this.provider=e}async getTile(e,t){const i=[],r=this.m_tilingScheme.getGeoBox(e),s=l.getClampedGeoRect(r,e),o=function(e,t,i){const r=new n.Vector3,s=t.getSize(r).multiplyScalar(i);return s.z=0,t.expandByVector(s),e.projection.unprojectBox(t)}(this.m_tilingScheme,this.m_tilingScheme.getWorldBox(e,d),.1),a=l.getClampedGeoRect(o,e);return this.fetchMarkers(e,s,i),this.fetchSpatialObjects(a,i),this.fetchOverlays(s,i),{type:"FeatureCollection",features:i}}fetchMarkers(e,t,i){const n={},r=[],s=this.getIconLoader();if(this.provider.providesMarkers()){const e=void 0;this.provider.requestMarkers(t,e,!0,!1).forEach(e=>{const t=h.getMarkerProperties(e,n);null!==t&&i.push({type:"Feature",properties:t,geometry:e.getGeometry().toGeoJSON()})});for(const e in n)r.push(e),s.load(e,n[e])}s.setImageReferences(e,r)}fetchSpatialObjects(e,t){if(this.provider.providesSpatials()){const i=void 0,n=this.provider.requestSpatials(e,i,!0,!1),s=this.getProjectionSource().projection;n.sort(m),n.forEach((e,i)=>{var n;const o={id:e.getId(),minZoom:e.getMin(!0),maxZoom:e.getMax(!0)+1,zOrder:i,volatile:e.getVolatility()};if(e instanceof H.map.Polyline||e instanceof H.map.Polygon){const i=e.getStyle(),l=null!==(n=i.lineWidth)&&void 0!==n?n:0;if(Object.assign(o,h.getSpatialProperties(e)),e instanceof H.map.Polygon){const t=e.getElevation(),i=e.getExtrusion();if(o.min_height=t,o.height=t+i,o.height>0&&(o.lineWidth=a.MathUtils.clamp(l,0,1),s.type===r.ProjectionType.Planar&&(o.constantHeight=o.height>2e3,!0===o.constantHeight))){const{lat:t,lng:i}=e.getBoundingBox().getCenter(),n=s.projectPoint({latitude:t,longitude:i}),r=s.getScaleFactor(n);o.min_height*=r,o.height*=r}}i.lineDash.length>1&&(o.dashSize=i.lineDash[0]*l+"px",o.gapSize=i.lineDash[1]*l+"px",o.dashes="Square"),t.push({type:"Feature",properties:o,geometry:f(e.getGeometry())})}})}}fetchOverlays(e,t){if(!this.provider.providesOverlays())return;const i=this.provider.requestOverlays(e,void 0,!0,!1);i.sort(m),i.forEach((e,i)=>{const n=e.getGeometry().getBoundingBox(),r={id:e.getId(),minZoom:e.getMin(!0),maxZoom:e.getMax(!0)+1,zOrder:i,opacity:e.getOpacity(),min_height:0,height:0,volatile:e.getVolatility(),bbox:[n.getLeft(),n.getBottom(),n.getRight(),n.getTop()]},s=e.getBitmap();if(null!==s){if(s instanceof HTMLImageElement)r.map=s.src;else{const e=s.getContext("2d");if(null===e)return void u.error("Cannot get context from canvas");r.map={buffer:e.getImageData(0,0,s.width,s.height).data.buffer,type:"image/raw",dataTextureProperties:{width:s.width,height:s.height}}}t.push({type:"Feature",properties:r,geometry:f(H.geo.Polygon.fromRect(e.getGeometry()))})}})}}function f(e){const t=[];let i;if(e instanceof H.geo.MultiPolygon)e.getGeometries().forEach(e=>{s.isCrossingAntimeridian(e)?s.wrapGeoPolygon(e,t):t.push(e.toGeoJSON().coordinates)}),i="MultiPolygon";else if(e instanceof H.geo.MultiLineString)e.getGeometries().forEach(e=>{s.isCrossingAntimeridian(e)?s.wrapGeoLineString(e,t):t.push(e.toGeoJSON().coordinates)}),i="MultiLineString";else{if(!s.isCrossingAntimeridian(e))return e.toGeoJSON();e instanceof H.geo.Polygon?(s.wrapGeoPolygon(e,t),i="MultiPolygon"):(s.wrapGeoLineString(e,t),i="MultiLineString")}return{type:i,coordinates:t}}t.LocalObjectDataProvider=p},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0});const s=i(334);window.THREE||console.warn("harp.js: It looks like 'three.js' is not loaded. This script requires 'THREE' object to be defined. See https://github.com/heremaps/harp.gl/@here/harp.gl."),r(i(5),t),r(i(18),t),r(i(337),t),r(i(339),t),r(i(341),t),r(i(344),t),r(i(347),t),r(i(86),t),r(i(171),t),r(i(3),t),r(i(2),t),r(i(38),t),s.mapBundleMain()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapBundleMain=t.BundledUriResolver=t.getScriptUrl=t.getBundleScriptUrl=t.BUNDLE_SCRIPT_BASENAME=t.DEFAULT_DECODER_SCRIPT_URL=void 0;const n=i(5),r=i(72),s=i(1);function o(){if(void 0!==a)return a;const e=document.currentScript,i=null!==e&&"string"==typeof e.src&&(e.src.endsWith(t.BUNDLE_SCRIPT_BASENAME+".js")||e.src.endsWith(t.BUNDLE_SCRIPT_BASENAME+".min.js"))?e.src:l(t.BUNDLE_SCRIPT_BASENAME);return i?(a=i,a):void(a=null)}let a;function l(e){var t,i,n;const r=null!==(n=null!==(i=null!==(t=document.querySelector(`script[src*='/${e}.min.js']`))&&void 0!==t?t:document.querySelector(`script[src='${e}.min.js']`))&&void 0!==i?i:document.querySelector(`script[src*='/${e}.js']`))&&void 0!==n?n:document.querySelector(`script[src='${e}.js']`);return r?r.src:void 0}t.DEFAULT_DECODER_SCRIPT_URL="harp.js-bundle://harp-decoders.js",t.BUNDLE_SCRIPT_BASENAME="harp",t.getBundleScriptUrl=o,t.getScriptUrl=l;class c{resolveUri(e){if(e.startsWith("harp.js-bundle://")){const t=o();if(null==t)throw new Error(`harp.js: cannot resolve ${e} because 'harp.gl' base url is not set.`);return(e=e.substring("harp.js-bundle://".length)).startsWith("/")&&(e=e.substring(1)),s.baseUrl(t)+e}return e}}t.BundledUriResolver=c;const h=new c,u=()=>{const e=o();e||console.error("harp.js: Unable to determine default location of 'harp-decoders(min).js'. See https://github.com/heremaps/harp.gl/@here/harp.gl."),r.WorkerLoader.dependencyUrlMapping.three||console.error("harp.js: Unable to determine location of 'three(.min).js'. `See https://github.com/heremaps/harp.gl/@here/harp.gl.`");const i=e&&e.endsWith(".min.js")?t.DEFAULT_DECODER_SCRIPT_URL.replace(/\.js$/,".min.js"):t.DEFAULT_DECODER_SCRIPT_URL;return h.resolveUri(i)};t.mapBundleMain=function(){o(),function(){n.ConcurrentDecoderFacade.defaultScriptUrl="",n.ConcurrentTilerFacade.defaultScriptUrl="";const e=l("three");r.WorkerLoader.dependencyUrlMapping.three=e;const t=n.ConcurrentDecoderFacade.getWorkerSet;n.ConcurrentDecoderFacade.getWorkerSet=e=>{if(void 0===e&&""===n.ConcurrentDecoderFacade.defaultScriptUrl){const e=u();n.ConcurrentDecoderFacade.defaultScriptUrl=e}return t.apply(n.ConcurrentDecoderFacade,[e])};const i=n.ConcurrentTilerFacade.getWorkerSet;n.ConcurrentTilerFacade.getWorkerSet=e=>{if(void 0===e&&""===n.ConcurrentTilerFacade.defaultScriptUrl){const e=u();n.ConcurrentTilerFacade.defaultScriptUrl=e}return i.apply(n.ConcurrentTilerFacade,[e])}}()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDebugLabelsTile=void 0;const n=i(3),r=i(5),s=i(81),o=i(157),a=i(17),l=i(8),c=i(0),h=new c.LineBasicMaterial({color:0,linewidth:1,depthTest:!1,depthFunc:c.NeverDepth}),u=new c.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:c.NeverDepth});new c.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:c.NeverDepth}).wireframe=!0;new c.MeshBasicMaterial({color:8421631,depthTest:!1,depthFunc:c.NeverDepth}).wireframe=!0;const d=new c.MeshBasicMaterial({color:0,depthTest:!1,depthFunc:c.NeverDepth}),m=new c.MeshBasicMaterial({color:255,depthTest:!1,depthFunc:c.NeverDepth,opacity:.75,transparent:!0}),p=new c.MeshBasicMaterial({color:10514432,depthTest:!1,depthFunc:c.NeverDepth,opacity:.75,transparent:!0}),f=new l.TextRenderStyle,g=new l.TextLayoutStyle;f.fontSize={unit:l.FontUnit.Point,size:9,backgroundSize:0},f.opacity=.75,f.backgroundOpacity=.75,f.color=new c.Color(.8,.2,.2);const v=Number.MAX_SAFE_INTEGER;class y{constructor(){this.geometry=new c.BufferGeometry,this.indices=new Array,this.positions=new Array}}function _(e,t,i,n,r){r.positions.push(e,t-n,i),r.positions.push(e+n,t,i),r.positions.push(e,t+n,i),r.positions.push(e-n,t,i);const s=r.positions.length/3;r.indices.push(s-4),r.indices.push(s-3),r.indices.push(s-2),r.indices.push(s-4),r.indices.push(s-2),r.indices.push(s-1)}function x(e,t,i=0,n){if(t.indices.length>0){t.geometry.addGroup(0,t.indices.length,0),t.geometry.setAttribute("position",new c.BufferAttribute(new Float32Array(t.positions),3)),t.geometry.setIndex(new c.BufferAttribute(new Uint32Array(t.indices),1));const r=n(t.geometry);r.renderOrder=v-i,e.push(r)}}class w extends r.Tile{constructor(e,t){super(e,t)}loadingFinished(){var e,t,i;const w=s.debugContext.getValue("DEBUG_TEXT_PATHS"),b=s.debugContext.getValue("DEBUG_TEXT_PATHS_FULL"),M=s.debugContext.getValue("DEBUG_TEXT_POIS_FULL"),T=s.debugContext.getValue("DEBUG_TEXT_LINE_MARKER");if(!(w||b||T)||void 0===this.decodedTile)return;const S=o.TileGeometryCreator.instance,E=this.decodedTile,P=new Map,A=s.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.TEXT"),C=s.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.INDEX"),L=this.mapView.env;void 0!==E.textPathGeometries&&(this.preparedTextPaths=S.prepareTextPaths(E.textPathGeometries,E));const R=this.center.x,D=this.center.y,O=this.center.z,I=this.mapView.pixelToWorld,F=this.computeWorldOffsetX();let V=0;if(this.textElementGroups.count()>0){const e=new y,t=new y,i=[];this.textElementGroups.forEach(n=>{if(n.type!==a.TextElementType.LineMarker&&n.type!==a.TextElementType.PoiLabel)return;const s=n.type===a.TextElementType.LineMarker?t:e,o=5*I,h=(e,t,a)=>{if(_(e,t,a,o,s),M||T){const s=.5*o,h=`${n.text} [${V}]`,u=new r.TextElement(l.ContextualArabicConverter.instance.convert(h),new c.Vector3(e+F+R+s,t+D+s,a+O),f,g,v,0,0);u.minZoomLevel=0,u.mayOverlap=!0,u.reserveSpace=!1,u.alwaysOnTop=!0,u.ignoreDistance=!0,u.priority=r.TextElement.HIGHEST_PRIORITY,u._isDebug=!0,i.push(u)}V++};if(void 0!==n.path&&Array.isArray(n.path))for(let e=0;e<n.path.length;e++){const t=n.path[e];h(t.x-R,t.y-D,10+t.z+5*e-O)}else if(M){h(n.position.x-R,n.position.y-D,5-O)}});for(const e of i)this.addTextElement(e);x(this.objects,e,0,e=>new c.Mesh(e,m)),x(this.objects,t,0,e=>new c.Mesh(e,p))}if(void 0!==this.preparedTextPaths){const s=new y,o=new y,a=new y;let m=0;for(const h of this.preparedTextPaths){const u=E.techniques[h.technique];if(!n.isTextTechnique(u)||void 0!==h._isDebug)continue;void 0!==u.color&&P.set(h.technique,new c.Color(n.getPropertyValue(u.color,L))),m=s.positions.length/3;const d=h.text,p=this.preparedTextPaths.indexOf(h);if((!A||d&&d.includes(A))&&(void 0===C||C===p)){for(let m=0;m<h.path.length;m+=3){const p=m/3,v=h.path[m]-R,y=h.path[m+1]-D,x=10+h.path[m+2]+m/3-O;w&&s.positions.push(v,y,x);const M=0===m&&w;if(b||M){if(_(v,y,x,I*(M?6:4),M?o:a),b){const s=null!==(e=u.xOffset)&&void 0!==e?e:0,o=null!==(t=u.yOffset)&&void 0!==t?t:0,a=u.minZoomLevel,h=p%5==0?d+":"+p:Number(p).toString(),m=new r.TextElement(l.ContextualArabicConverter.instance.convert(h),new c.Vector3(v+F+R,y+D,x+O),f,g,n.getPropertyValue(null!==(i=u.priority)&&void 0!==i?i:0,L),s,o);m.minZoomLevel=n.getPropertyValue(a,L),m.mayOverlap=!0,m.reserveSpace=!1,m.alwaysOnTop=!0,m.ignoreDistance=!0,m.priority=r.TextElement.HIGHEST_PRIORITY,this.addTextElement(m)}}}const p=h.path.length/3;for(let e=0;e<p;++e)e>0&&s.indices.push(m+e),e+1<p&&s.indices.push(m+e)}}x(this.objects,s,-2,e=>new c.LineSegments(e,h)),x(this.objects,o,0,e=>new c.Mesh(e,u)),x(this.objects,a,-1,e=>new c.Mesh(e,d))}}}t.OmvDebugLabelsTile=w},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataProvider=void 0,i(16);const n=i(3),r=i(5),s=i(38),o=i(1),a=i(28),l=o.LoggerManager.instance.create("GeoJsonDataProvider");let c=!1;class h extends s.DataProvider{constructor(e,t,i){var n;super(),this.name=e,this.input=t,this.m_registered=!1,this.m_tiler=null!==(n=null==i?void 0:i.tiler)&&void 0!==n?n:r.ConcurrentTilerFacade.getTiler(a.GEOJSON_TILER_SERVICE_TYPE,null==i?void 0:i.workerTilerUrl,null==i?void 0:i.workerConnectionTimeout)}async connect(){try{await this.m_tiler.connect()}catch(e){throw n.WorkerServiceProtocol.isUnknownServiceError(e)&&!c&&(l.info("Unable to start GeoJson tiler service in worker. Use  'OmvTilerService.start();' in decoder script."),c=!0),e}await this.m_tiler.registerIndex(this.name,this.input),this.m_registered=!0}updateInput(e){this.input=e,this.m_tiler.updateIndex(this.name,this.input),this.dispatchEvent({type:"invalidated"})}ready(){return this.m_registered}async getTile(e){return await this.m_tiler.getTile(this.name,e)}onDidInvalidate(e){return this.addEventListener("invalidated",e),()=>this.removeEventListener("invalidated",e)}dispose(){this.m_tiler.dispose()}}t.GeoJsonDataProvider=h},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0});var s=i(18);Object.defineProperty(t,"APIFormat",{enumerable:!0,get:function(){return s.APIFormat}}),Object.defineProperty(t,"AuthenticationMethod",{enumerable:!0,get:function(){return s.AuthenticationMethod}}),Object.defineProperty(t,"GeoJsonDataProvider",{enumerable:!0,get:function(){return s.GeoJsonDataProvider}}),r(i(338),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDataSource=void 0;const n=i(18);class r extends n.VectorTileDataSource{}t.OmvDataSource=r},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(340),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebugTileDataSource=t.DebugTile=void 0;const n=i(2),r=i(5),s=i(8),o=i(0),a=new o.LineBasicMaterial({color:16711680,linewidth:1,depthTest:!1}),l=Number.MAX_SAFE_INTEGER;class c extends r.Tile{constructor(e,t,i="#ff0000"){super(e,t),this.geometry=new o.BufferGeometry,this.m_labelPositions=new o.BufferAttribute(new Float32Array(3),3);const c=e.getTilingScheme(),h=c.boundingBoxGenerator.getWorldBox(t),u=c.projection,d=[u.unprojectPoint(new o.Vector3(h.min.x,h.min.y,0)),u.unprojectPoint(new o.Vector3(h.max.x,h.min.y,0)),u.unprojectPoint(new o.Vector3(h.max.x,h.max.y,0)),u.unprojectPoint(new o.Vector3(h.min.x,h.max.y,0))],m=new o.Vector3,p=[];d.forEach(e=>{const t=new o.Vector3;this.projection.projectPoint(e,t),t.sub(this.center),p.push(...t.toArray()),m.add(t)}),this.geometry.setAttribute("position",new o.BufferAttribute(new Float32Array(p),3)),m.divideScalar(d.length);const f=new o.Line(this.geometry,a);f.renderOrder=l,this.objects.push(f),this.m_labelPositions.setXYZ(0,0,0,0);const g=new o.Vector3;this.projection.type===n.ProjectionType.Planar?(g.set(this.geometry.getAttribute("position").getX(3),this.geometry.getAttribute("position").getY(3),this.geometry.getAttribute("position").getZ(3)),g.multiplyScalar(.95),this.m_textLayoutStyle=new s.TextLayoutStyle({verticalAlignment:s.VerticalAlignment.Below,horizontalAlignment:s.HorizontalAlignment.Left})):(g.copy(m),this.m_textLayoutStyle=new s.TextLayoutStyle({verticalAlignment:s.VerticalAlignment.Center,horizontalAlignment:s.HorizontalAlignment.Center})),this.m_textRenderStyle=new s.TextRenderStyle({fontSize:{unit:s.FontUnit.Pixel,size:16,backgroundSize:0},color:new o.Color(i)});const v=`${t.mortonCode()} (${t.row}, ${t.column}, ${t.level})`;g.add(this.center);const y=new r.TextElement(v,g,this.m_textRenderStyle,this.m_textLayoutStyle,l,.8);y.mayOverlap=!0,y.reserveSpace=!1,y.alwaysOnTop=!0,y.ignoreDistance=!0,this.addTextElement(y)}}t.DebugTile=c;class h extends r.DataSource{constructor(e,t="debug",i=20){super({name:t,minDataLevel:1,maxDataLevel:20,storageLevelOffset:-1}),this.m_tilingScheme=e,this.maxDbgZoomLevel=i,this.cacheable=!0,this.enablePicking=!1}getTilingScheme(){return this.m_tilingScheme}getTile(e){return new c(this,e)}canGetTile(e,t){return!(t.level>this.maxDbgZoomLevel)&&super.canGetTile(e,t)}}t.DebugTileDataSource=h},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(342),t),r(i(343),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataSource=void 0;const n=i(18);class r extends n.VectorTileDataSource{constructor(e){super(Object.assign({styleSetName:"geojson"},e))}}t.GeoJsonDataSource=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(18);Object.defineProperty(t,"GeoJsonDataProvider",{enumerable:!0,get:function(){return n.GeoJsonDataProvider}})},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(345),t),r(i(346),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewMultiPointFeature=t.MapViewPointFeature=t.MapViewMultiPolygonFeature=t.MapViewPolygonFeature=t.MapViewMultiLineFeature=t.MapViewLineFeature=t.MapViewFeature=void 0;const n=i(0);class r{constructor(e,t){this.coordinates=e,this.properties=t,this.type="Point",this.uuid=n.MathUtils.generateUUID()}}t.MapViewFeature=r;t.MapViewLineFeature=class extends r{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="LineString"}};t.MapViewMultiLineFeature=class extends r{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="MultiLineString"}};t.MapViewPolygonFeature=class extends r{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="Polygon"}};t.MapViewMultiPolygonFeature=class extends r{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="MultiPolygon"}};t.MapViewPointFeature=class extends r{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="Point"}};t.MapViewMultiPointFeature=class extends r{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="MultiPoint"}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeaturesDataSource=void 0;const n=i(2),r=i(1),s=i(18),o=r.LoggerManager.instance.create("FeaturesDataSource"),a={type:"FeatureCollection",features:[]};class l extends s.VectorTileDataSource{constructor(e){super(Object.assign(Object.assign({},e),{dataProvider:new s.GeoJsonDataProvider("user-features-datasource",a,e),addGroundPlane:!1})),this.m_isAttached=!1,this.m_featureCollection=this.emptyGeojson(),void 0!==e&&(void 0!==e.features&&this.add(...e.features),void 0!==e.geojson&&this.setFromGeojson(e.geojson))}setFromGeojson(e){if("FeatureCollection"===e.type)this.m_featureCollection=e;else if("Feature"===e.type)this.m_featureCollection=this.emptyGeojson(),this.m_featureCollection.features.push(e);else{if("GeometryCollection"!==e.type)throw new TypeError("The provided object is not a valid GeoJSON object.");this.m_featureCollection=this.emptyGeojson();for(const t of e.geometries)this.m_featureCollection.features.push({type:"Feature",geometry:t})}return this.update(),this}add(...e){for(const t of e)this.addFeature(t);return this.update(),this}remove(...e){for(const t of e)this.removeFeature(t);return this.update(),this}clear(){this.m_featureCollection=this.emptyGeojson(),this.update()}async connect(){await super.connect(),this.m_featureCollection.features.length>0&&await this.update()}attach(e){super.attach(e),this.m_isAttached=!0}detach(e){super.detach(e),this.m_isAttached=!1}getGeoBox(){let e;const t=t=>{const i=new n.GeoCoordinates(t[1],t[0]);void 0===e?e=new n.GeoBox(i,i.clone()):e.growToContain(i)};for(const e of this.m_featureCollection.features)switch(e.geometry.type){case"Point":t(e.geometry.coordinates);break;case"MultiPoint":case"LineString":e.geometry.coordinates.forEach(t);break;case"MultiLineString":case"Polygon":e.geometry.coordinates.forEach(e=>e.forEach(t));break;case"MultiPolygon":e.geometry.coordinates.forEach(e=>e.forEach(e=>e.forEach(t)))}return e}addFeature(e){if(this.m_featureCollection.features.some(t=>t.properties.__mapViewUuid===e.uuid))return;const t={type:"Feature",geometry:{type:e.type,coordinates:e.coordinates},properties:Object.assign(Object.assign({},e.properties),{__mapViewUuid:e.uuid})};this.m_featureCollection.features.push(t)}removeFeature(e){const t=this.m_featureCollection.features.findIndex(t=>t.properties.__mapViewUuid===e.uuid);-1!==t&&this.m_featureCollection.features.splice(t,1)}async update(){const e=this.dataProvider();if(this.m_isAttached&&e.ready())try{await e.updateInput(this.m_featureCollection),this.m_isAttached&&this.mapView.markTilesDirty(this)}catch(e){o.error(`[${this.name}]: failed to update tile index`,e)}}emptyGeojson(){return{features:[],type:"FeatureCollection"}}}t.FeaturesDataSource=l},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(85),t),r(i(349),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileLoader=void 0;const n=i(5),r=i(68),s=i(4),o=i(0);class a extends n.BaseTileLoader{constructor(e,t,i){super(e,t.tileKey),this.dataSource=e,this.tile=t,this.dataProvider=i}loadImpl(e,t,i){this.dataProvider.getTexture(this.tile,e).then(e=>{if(void 0===e||void 0===e[0])return this.tile.forceHasGeometry(!0),void t(n.TileLoaderState.Ready);const[i,a]=e;void 0!==a&&(this.tile.copyrightInfo=a),i.minFilter=o.LinearFilter,i.magFilter=o.LinearFilter,i.generateMipmaps=!1,this.tile.clear(),this.tile.addOwnedTexture(i);const l=r.addGroundPlane(this.tile,this.dataSource.renderOrder,16777215,this.dataSource.opacity,!0).material;l.map=i,this.dataSource.transparent&&s.enableBlending(l),l.depthTest=!1,this.tile.invalidateResourceInfo(),this.dataSource.requestUpdate(),t(n.TileLoaderState.Ready)},i).catch(i)}}t.WebTileLoader=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HereWebTileDataSource=t.HereTileProvider=void 0;const n=i(5),r=i(1),s=i(85),o=new n.TextureLoader,a={eu:"baq",ca:"cat",zh:"chi",cs:"cze",da:"dan",nl:"dut",en:"eng",fi:"fin",fr:"fre",de:"ger",ga:"gle",el:"gre",he:"heb",hi:"hin",id:"ind",it:"ita",no:"nor",fa:"per",pl:"pol",pt:"por",ru:"rus",si:"sin",es:"spa",sv:"swe",th:"tha",tr:"tur",uk:"ukr",ur:"urd",vi:"vie",cy:"wel"};class l{constructor(e){var t,i;if(this.m_options=e,this.HERE_COPYRIGHT_INFO={id:"here.com",year:(new Date).getFullYear(),label:"HERE",link:"https://legal.here.com/terms"},this.m_ppi=r.getOptionValue(e.ppi,s.WebTileDataSource.ppiValue.ppi72),this.m_resolution=r.getOptionValue(e.resolution,s.WebTileDataSource.resolutionValue.resolution512),this.m_tileBaseAddress=null!==(t=e.tileBaseAddress)&&void 0!==t?t:l.TILE_BASE_NORMAL,this.m_tileBaseAddress===l.TILE_AERIAL_SATELLITE&&this.m_ppi!==s.WebTileDataSource.ppiValue.ppi72)throw new Error("Requested combination of scheme satellite.day and ppi is not valid");const o=this.parseBaseUrl(this.m_tileBaseAddress),a=o.baseUrl,c=r.getOptionValue(o.mapVersion,"newest"),h=(null!==(i=o.scheme)&&void 0!==i?i:"normal.day").split(".")[0]||"normal",u=`https://1.${a}/maptile/2.1/copyright/${c}`+this.getCopyrightRequestParams();this.m_copyrightProvider=new n.UrlCopyrightProvider(u,h)}async getTexture(e,t){const i=e.tileKey.column,n=e.tileKey.row,r=e.tileKey.level,s=e.tileKey.toQuadKey(),a=`https://${parseInt(s[s.length-1],10)+1}.${this.m_tileBaseAddress}/${r}/${i}/${n}/${this.m_resolution}/png8`+this.getImageRequestParams();return await this.getRequestHeaders().then(i=>Promise.all([o.load(a,i,t),this.getTileCopyright(e,i,t)]))}mapIsoLanguageToWebTile(e){this.m_languages=[];for(const t of e)void 0!==a[t]&&this.m_languages.push(a[t])}async getRequestHeaders(){const{authenticationCode:e}=this.m_options;let t;if("string"==typeof e?t=e:void 0!==e&&(t=await e()),void 0!==t)return{Authorization:"Bearer "+t}}async getTileCopyright(e,t,i){return!1===this.m_options.gatherCopyrightInfo?[this.HERE_COPYRIGHT_INFO]:(this.m_copyrightProvider.setRequestHeaders(t),await this.m_copyrightProvider.getCopyrights(e.geoBox,e.tileKey.level))}parseBaseUrl(e){const t=new URL(e.startsWith("https:")?e:"https://"+e),i=t.pathname,n=new RegExp("^(/maptile/2.1/)([^/]+)/([^/]+)/([^/]+)"),r=i.match(n);if(!r)throw new Error("HereWebTileDataSource: invalid baseUrl: "+e);return{baseUrl:t.host,path:r[1],tileType:r[2],mapVersion:r[3],scheme:r[4]}}getAuthParams(){const{apikey:e}=this.m_options,{appId:t,appCode:i}=this.m_options,{authenticationCode:n}=this.m_options;if(void 0!==n)return[];if(void 0!==e)return["apikey="+e];if(void 0!==t&&void 0!==i)return["app_id="+t,"app_code="+i];throw new Error("Neither apiKey, appId/appCode nor authenticationCode are defined.")}getCopyrightRequestParams(){return"?"+["output=json",...this.getAuthParams()].join("&")}getImageRequestParams(){const e=this.getAuthParams();return void 0!==this.m_options.additionalRequestParameters&&e.push(this.m_options.additionalRequestParameters),this.m_ppi!==s.WebTileDataSource.ppiValue.ppi72&&e.push("ppi="+this.m_ppi),void 0!==this.m_languages&&void 0!==this.m_languages[0]&&e.push("lg="+this.m_languages[0]),void 0!==this.m_languages&&void 0!==this.m_languages[1]&&e.push("lg2="+this.m_languages[1]),e.length>0?"?"+e.join("&"):""}}t.HereTileProvider=l,l.TILE_BASE_NORMAL="base.maps.ls.hereapi.com/maptile/2.1/maptile/newest/normal.day",l.TILE_AERIAL_HYBRID="aerial.maps.ls.hereapi.com/maptile/2.1/maptile/newest/hybrid.day",l.TILE_AERIAL_SATELLITE="aerial.maps.ls.hereapi.com/maptile/2.1/maptile/newest/satellite.day",l.TILE_TRAFFIC_NORMAL="traffic.maps.ls.hereapi.com/maptile/2.1/traffictile/newest/normal.day";class c extends s.WebTileDataSource{constructor(e){var t;super(Object.assign(Object.assign({},e),{minDataLevel:1,maxDataLevel:20,resolution:e.resolution,dataProvider:new l(e),storageLevelOffset:null!==(t=e.storageLevelOffset)&&void 0!==t?t:-1})),this.cacheable=!0,this.resolution===s.WebTileDataSource.resolutionValue.resolution512&&(this.maxDataLevel=19)}setLanguages(e){void 0!==e&&(this.dataProvider.mapIsoLanguageToWebTile(e),this.mapView.markTilesDirty(this))}}t.HereWebTileDataSource=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCrossingAntimeridian=t.wrapGeoLineString=t.wrapGeoPolygon=void 0;const n=i(351),r=i(352),s=i(7);function o(e){const t=[],i=e.getLatLngAltArray();let n=0,r=0;for(let e=0,o=i.length;e<o;e+=3){const o=i[e];let a=i[e+1];const l=i[e+2];if(e>=3){a+=n;const e=Math.abs(a-r)>180?a>r?-360:360:0;r=a+=e,n+=e}else r=a;t.push(new s.GeoCoordinates(o,a,l))}return t}function a(e){const{left:t,middle:i,right:n}=e;return{left:null==t?void 0:t.map(l),middle:null==i?void 0:i.map(l),right:null==n?void 0:n.map(l)}}function l(e){return e.toGeoPoint()}t.wrapGeoPolygon=function(e,t){const i=o(e.getExterior()),r=a(n.wrapPolygon(i)),s=e.getInteriors().map(e=>a(n.wrapPolygon(o(e))));for(const e in r){if(void 0===r[e])continue;const i=[];s.forEach(t=>{void 0!==t[e]&&i.push(t[e])}),t.push([r[e],...i])}},t.wrapGeoLineString=function(e,t){const{left:i,middle:n,right:s}=r.wrapLineString(o(e));for(const e of[i,n,s])void 0!==e&&e.forEach(e=>{t.push(e.map(e=>e.toGeoPoint()))})},t.isCrossingAntimeridian=function(e){return e instanceof H.geo.LineString?e.getDBCs()>0:e.getExterior().getDBCs()>0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapPolygon=void 0;const n=i(2),r=i(1),s=i(0),o=i(172);class a extends o.ClippingEdge{constructor(e,t,i){super(),this.isInside=i,this.p0=(new s.Vector2).fromArray(e),this.p1=(new s.Vector2).fromArray(t)}inside(e,t){return this.isInside(e)}computeIntersection(e,t,i){const n=new s.Vector2;return r.Math2D.intersectLines(e.x,e.y,t.x,t.y,this.p0.x,this.p0.y,this.p1.x,this.p1.y,n),n}}const l=n.EarthConstants.EQUATORIAL_CIRCUMFERENCE,c=.05*l,h=[new a([0-c,l],[0-c,0],e=>e.x>0-c),new a([l+c,0],[l+c,l],e=>e.x<l+c)],u=[new a([-l-c,l],[-l-c,0],e=>e.x>-l-c),new a([0+c,0],[0+c,l],e=>e.x<0+c)],d=[new a([l-c,l],[l-c,0],e=>e.x>l-c),new a([2*l+c,0],[2*l+c,l],e=>e.x<2*l+c)];function m(e,t,i){for(const i of t)e=i.clipPolygon(e,0);const r=new s.Vector3,o=e.map(({x:e,y:t})=>{r.set(e,t,0);const s=n.webMercatorProjection.unprojectPoint(r);return s.longitude+=i,s});return o.length>0?o:void 0}t.wrapPolygon=function(e){const t=new s.Vector3,i=e.map(e=>{const{x:i,y:r}=n.webMercatorProjection.projectPoint(e,t);return new s.Vector2(i,r)});return{left:m(i,u,360),middle:m(i,h,0),right:m(i,d,-360)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(173);Object.defineProperty(t,"wrapLineString",{enumerable:!0,get:function(){return n.wrapLineString}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconLoader=void 0;t.IconLoader=class{constructor(e){this.mapView=e,this.m_textureReferenceCounts=new Map,this.m_tilesWithRefs=new Set}setImageReferences(e,t=[]){this.m_textureReferenceCounts.forEach((i,n)=>{if(t.includes(n))return;i.delete(e)&&0===i.size&&(this.mapView.userImageCache.removeImage(n),this.m_textureReferenceCounts.delete(n))}),t.forEach(t=>{const i=this.m_textureReferenceCounts.get(t);void 0!==i?i.add(e):this.m_textureReferenceCounts.set(t,new Set([e]))}),t.length?this.m_tilesWithRefs.add(e):this.m_tilesWithRefs.delete(e)}releaseImageReferences(e){this.m_tilesWithRefs.has(e)&&this.setImageReferences(e)}dispose(){this.m_textureReferenceCounts.forEach((e,t)=>{this.mapView.userImageCache.removeImage(t)}),this.m_textureReferenceCounts.clear()}load(e,t){void 0===this.mapView.userImageCache.findImageByName(e)&&this.mapView.userImageCache.addImage(e,t.getBitmap())}}},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(355),t),r(i(356),t),r(i(357),t),r(i(52),t),r(i(358),t),r(i(176),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemedTileDecoder=void 0;const n=i(48),r=i(1).LoggerManager.instance.create("ThemedTileDecoder");t.ThemedTileDecoder=class{constructor(){this.m_storageLevelOffset=0}dispose(){}decodeTile(e,t,i){return void 0===this.m_styleSetEvaluator?(r.info("cannot decode tile, as there is not style available"),Promise.resolve(void 0)):this.decodeThemedTile(e,t,this.m_styleSetEvaluator,i)}getTileInfo(e,t,i){return Promise.resolve(void 0)}configure(e,t){void 0!==(null==e?void 0:e.styleSet)&&(this.m_styleSetEvaluator=new n.StyleSetEvaluator(e)),void 0!==(null==e?void 0:e.languages)&&(this.languages=e.languages),void 0!==t&&void 0!==t.storageLevelOffset&&(this.m_storageLevelOffset=t.storageLevelOffset)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDecoderService=void 0;const n=i(3),r=i(2),s=i(1),o=i(52),a=s.LoggerManager.instance.create("TileDecoderService");class l extends o.WorkerService{constructor(e,t){super(e),this.serviceId=e,this.m_decoder=t,this.m_decoder.connect()}static start(e,t){return new l(e,t)}handleRequest(e){return n.WorkerDecoderProtocol.isDecodeTileRequest(e)?this.handleDecodeTileRequest(e):n.WorkerDecoderProtocol.isTileInfoRequest(e)?this.handleTileInfoRequest(e):super.handleRequest(e)}handleMessage(e){n.WorkerDecoderProtocol.isConfigurationMessage(e)?this.handleConfigurationMessage(e):a.error(`[${this.serviceId}]: invalid message ${e.type}`)}async handleDecodeTileRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey),i=n.getProjection(e.projection),s=await this.m_decoder.decodeTile(e.data,t,i),o=[],a=e=>{void 0!==e&&e.buffer.byteLength>0&&!o.includes(e.buffer)&&o.push(e.buffer)};return null==s||s.geometries.forEach(e=>{var t,i,n;if(null===(t=e.vertexAttributes)||void 0===t||t.forEach(e=>a(e)),null===(i=e.interleavedVertexAttributes)||void 0===i||i.forEach(e=>a(e)),a(e.index),a(e.edgeIndex),Array.isArray(e.objInfos)&&1===e.objInfos.length&&"object"==typeof e.objInfos[0]&&(null===(n=e.objInfos[0])||void 0===n?void 0:n.hasOwnProperty("displacementMap"))){const t=e.objInfos[0];a(t.displacementMap)}Array.isArray(e.attachments)&&e.attachments.forEach(e=>{a(e.index),a(e.edgeIndex)})}),null==s||s.techniques.forEach(e=>{n.addBuffersToTransferList(e,o)}),{response:s,transferList:o}}handleTileInfoRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey),i=n.getProjection(e.projection);return this.m_decoder.getTileInfo(e.data,t,i).then(e=>({response:e,transferList:void 0!==e&&void 0!==e.transferList?e.transferList:[]}))}handleConfigurationMessage(e){this.m_decoder.configure(e,e.options)}}t.TileDecoderService=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilerService=void 0;const n=i(3),r=i(2),s=i(176),o=i(52);class a extends o.WorkerService{constructor(e){super(e),this.serviceId=e,this.tiler=new s.GeoJsonTiler}static start(e){return new a(e)}handleRequest(e){return n.WorkerTilerProtocol.isRegisterIndexRequest(e)?this.handleRegisterIndexRequest(e):n.WorkerTilerProtocol.isUpdateIndexRequest(e)?this.handleUpdateIndexRequest(e):n.WorkerTilerProtocol.isTileRequest(e)?this.handleTileRequest(e):super.handleRequest(e)}async handleTileRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey);return{response:await this.tiler.getTile(e.index,t)||{}}}async handleRegisterIndexRequest(e){const t="string"==typeof e.input?new URL(e.input):e.input;return await this.tiler.registerIndex(e.id,t),{response:{}}}async handleUpdateIndexRequest(e){const t="string"==typeof e.input?new URL(e.input):e.input;return this.tiler.updateIndex(e.id,t),{response:{}}}}t.TilerService=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerServiceManager=void 0;const n=i(3),r=i(52);class s extends r.WorkerService{constructor(e=n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID){super(e),this.m_factories=new Map,this.m_services=new Map}static getInstance(){return void 0===this.m_service&&(this.m_service=new s(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)),this.m_service}register(e){this.m_factories.set(e.serviceType,e.factory)}handleRequest(e){if(e.type===n.WorkerServiceProtocol.Requests.CreateService){if(void 0!==this.m_services.get(e.targetServiceId))throw Error(`error - service with targetServiceId='${e.targetServiceId}' already running, ignoring CreateService request`);const t=this.m_factories.get(e.targetServiceType);if(void 0===t)throw Error(`unknown targetServiceType requested: '${e.targetServiceType}'`);const i=t(e.targetServiceId);this.m_services.set(e.targetServiceId,i)}if(e.type===n.WorkerServiceProtocol.Requests.DestroyService){const t=this.m_services.get(e.targetServiceId);if(void 0===t)throw Error(`unknown targetServiceId '${e.targetServiceId}'`);t.destroy(),this.m_services.delete(e.targetServiceId)}return Promise.resolve({response:{}})}}t.WorkerServiceManager=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonVtDataAdapter=void 0;const n=i(2),r=i(0),s=i(53);var o;!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(o||(o={}));const a=new r.Vector3;t.GeoJsonVtDataAdapter=class{canProcess(e){if(s.isArrayBufferLike(e))return!1;const t=e;return void 0!==t.features&&void 0!==t.source&&void 0!==t.x&&void 0!==t.y&&void 0!==t.z}process(e,t,i){for(const l of e.features)switch(l.type){case o.Point:for(const t of l.geometry){const n=t[0],s=t[1],o=new r.Vector3(n,s,0);i.processPointFeature(e.layer,4096,[o],l.tags,l.id)}break;case o.LineString:{const o=l.geometry;let c;const h=[];o.forEach(e=>{const t=null==c?void 0:c.positions[c.positions.length-1],[i,n]=e[0];if((null==t?void 0:t.x)===i&&(null==t?void 0:t.y)===n)for(let t=1;t<e.length;++t){const[i,n]=e[t];null==c||c.positions.push(new r.Vector2(i,n))}else{const t=e.map(([e,t])=>new r.Vector2(e,t));h.push({positions:t}),c=h[h.length-1]}}),h.forEach(e=>{e.untiledPositions=e.positions.map(e=>(s.tile2world(4096,t,e,!1,a),n.webMercatorProjection.unprojectPoint(a)))}),i.processLineFeature(e.layer,4096,h,l.tags,l.id);break}case o.Polygon:{const t=[];let n;for(const e of l.geometry){const i=[];for(const[t,n]of e){const e=new r.Vector2(t,n);i.push(e)}r.ShapeUtils.area(i)>0&&(n={rings:[]},t.push(n)),null==n||n.rings.push(i)}i.processPolygonFeature(e.layer,4096,t,l.tags,l.id);break}case o.Unknown:}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDataAdapter=t.asGeometryType=void 0;const n=i(48),r=i(1),s=i(361),o=i(0),a=i(166),l=i(28),c=i(362),h=i(53),u=i(363),d=i(364),m=i(178),p=["stringValue","floatValue","doubleValue","intValue","uintValue","sintValue","boolValue"],f=r.LoggerManager.instance.create("OmvDataAdapter",{enabled:!1});function g(e,t,i){if(void 0!==t.id&&null!==t.id)return t.id;if(e.hasOwnProperty("id")){const t=e.id;if("number"==typeof t)return t;if(t)return void 0!==i&&t.greaterThan(Number.MAX_SAFE_INTEGER)&&i.error("Invalid ID: Larger than largest available Number in feature: ",e),t.toNumber()}}function v(e,t){const i=new d.FeatureAttributes,n={};return i.accept(e,t,{visitAttribute:(e,t)=>(n[e]=function(e){const t=Object.prototype.hasOwnProperty;for(const i of p)if(t.call(e,i)){const t=e[i];if(void 0===t)throw new Error("unpexted undefined value");return s.isLong(t)?t.toNumber():t}throw new Error("not happening")}(t),!0)}),n}function y(e){if(void 0===e)return l.OmvGeometryType.UNKNOWN;switch(e.type){case m.com.mapbox.pb.Tile.GeomType.UNKNOWN:return l.OmvGeometryType.UNKNOWN;case m.com.mapbox.pb.Tile.GeomType.POINT:return l.OmvGeometryType.POINT;case m.com.mapbox.pb.Tile.GeomType.LINESTRING:return l.OmvGeometryType.LINESTRING;case m.com.mapbox.pb.Tile.GeomType.POLYGON:return l.OmvGeometryType.POLYGON;default:return l.OmvGeometryType.UNKNOWN}}function _(e,t){e.forEach(e=>{e.x===t-1&&(e.x=t)})}function x(e,t){switch(t){case l.FeatureModifierId.default:return new a.OmvGenericFeatureModifier(e);default:return r.assert(!1),new a.OmvGenericFeatureModifier(e)}}t.asGeometryType=y;t.OmvDataAdapter=class{constructor(){this.m_geometryCommands=new d.GeometryCommands,this.m_roundUpCoordinatesIfNeeded=!1}get dataFilter(){return this.m_dataFilter}configure(e,t){var i;if(void 0!==e.filterDescription){if(null!==e.filterDescription){const t=e.filterDescription,i=e.featureModifiers;this.m_dataFilter=new a.OmvGenericFeatureFilter(t);const n=[];void 0!==i?i.forEach(e=>{n.push(x(t,e))}):n.push(x(t,l.FeatureModifierId.default)),this.m_featureModifiers=n}else this.m_dataFilter=void 0,this.m_featureModifiers=void 0;const i=new u.StyleSetDataFilter(t);this.m_dataFilter=this.m_dataFilter?new a.ComposedDataFilter([i,this.m_dataFilter]):i}if(void 0!==e.politicalView){const t=e.politicalView;let i=this.m_featureModifiers;if(i&&(i=i.filter(e=>!(e instanceof c.OmvPoliticalViewFeatureModifier))),0!==t.length){r.assert(2===t.length,"The political view must be specified as two letters ISO 3166-1 standard!");const e=new c.OmvPoliticalViewFeatureModifier(t);i?i.push(e):i=[e]}this.m_featureModifiers=i&&i.length>0?i:void 0}this.m_roundUpCoordinatesIfNeeded=null!==(i=e.roundUpCoordinatesIfNeeded)&&void 0!==i&&i}canProcess(e){return h.isArrayBufferLike(e)}process(e,t,i){const{tileKey:n}=t,r=new Uint8Array(e),s=m.com.mapbox.pb.Tile.decode(r);this.m_tileKey=n,this.m_processor=i,d.visitOmv(s,this)}visitLayer(e){this.m_layer=e;const t=this.m_tileKey.level,i=e.name;return!(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsLayer(i,t))}visitPointFeature(e){var t,i,n;if(void 0===e.geometry)return;const r=null===(t=this.m_featureModifiers)||void 0===t?void 0:t[0].doProcessPointFeature,s=this.filterAndModifyFeature(e,null===(i=this.m_dataFilter)||void 0===i?void 0:i.wantsPointFeature,r);if(!s)return;const a=this.m_layer.name,l=null!==(n=this.m_layer.extent)&&void 0!==n?n:4096,c=[];this.m_geometryCommands.accept(e.geometry,{type:"Point",visitCommand:e=>{d.isMoveToCommand(e)&&c.push(new o.Vector3(e.position.x,e.position.y,0))}}),0!==c.length&&this.m_processor.processPointFeature(a,l,c,s,g(e,s,f))}visitLineFeature(e){var t,i,n;if(void 0===e.geometry)return;const r=null===(t=this.m_featureModifiers)||void 0===t?void 0:t[0].doProcessLineFeature,s=this.filterAndModifyFeature(e,null===(i=this.m_dataFilter)||void 0===i?void 0:i.wantsLineFeature,r);if(!s)return;const o=this.m_layer.name,a=null!==(n=this.m_layer.extent)&&void 0!==n?n:4096,l=[];let c;this.m_geometryCommands.accept(e.geometry,{type:"Line",visitCommand:e=>{d.isMoveToCommand(e)?(c=[e.position],l.push({positions:c})):d.isLineToCommand(e)&&c.push(e.position)}}),0!==l.length&&(this.mustRoundUpCoordinates&&function(e,t){e.forEach(e=>_(e.positions,t))}(l,a),this.m_processor.processLineFeature(o,a,l,s,g(e,s,f)))}visitPolygonFeature(e){var t,i,n;if(void 0===e.geometry)return;const r=null===(t=this.m_featureModifiers)||void 0===t?void 0:t[0].doProcessPolygonFeature,s=this.filterAndModifyFeature(e,null===(i=this.m_dataFilter)||void 0===i?void 0:i.wantsPolygonFeature,r);if(!s)return;const a=this.m_layer.name,l=null!==(n=this.m_layer.extent)&&void 0!==n?n:4096,c=[];let h,u,m;this.m_geometryCommands.accept(e.geometry,{type:"Polygon",visitCommand:e=>{if(d.isMoveToCommand(e))u=[e.position];else if(d.isLineToCommand(e))u.push(e.position);else if(d.isClosePathCommand(e)&&void 0!==u&&u.length>0){const e=Math.sign(o.ShapeUtils.area(u));void 0===m&&(m=e),e===m&&(h={rings:[]},c.push(h)),u.push(u[0].clone()),null==h||h.rings.push(u)}}}),0!==c.length&&(this.mustRoundUpCoordinates&&function(e,t){e.forEach(e=>e.rings.forEach(e=>_(e,t)))}(c,l),function(e){const t=e[0];if(void 0===t||0===t.rings.length)return;if(!(o.ShapeUtils.area(t.rings[0])>0))for(const t of e)for(const e of t.rings)e.reverse()}(c),this.m_processor.processPolygonFeature(a,l,c,s,g(e,s,f)))}filterAndModifyFeature(e,t,i){var s;const o=this.m_tileKey.level,a=this.m_layer.name,l=y(e);if(this.m_dataFilter&&!1===t.apply(this.m_dataFilter,[a,l,o]))return;const c=v(this.m_layer,e),h=new n.MapEnv(c);return void 0===(null===(s=this.m_featureModifiers)||void 0===s?void 0:s.find(e=>(r.assert(void 0!==i),!i.apply(e,[a,h,this.m_tileKey.level]))))?c:void 0}get mustRoundUpCoordinates(){return this.m_roundUpCoordinatesIfNeeded&&this.m_tileKey.level<5&&this.m_tileKey.column===this.m_tileKey.columnCount()-1}}},function(e,t){e.exports=n;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var s={},o={};function a(e,t){var i,n,r;return t?(r=0<=(e>>>=0)&&e<256)&&(n=o[e])?n:(i=c(e,(0|e)<0?-1:0,!0),r&&(o[e]=i),i):(r=-128<=(e|=0)&&e<128)&&(n=s[e])?n:(i=c(e,e<0?-1:0,!1),r&&(s[e]=i),i)}function l(e,t){if(isNaN(e))return t?y:v;if(t){if(e<0)return y;if(e>=p)return M}else{if(e<=-f)return T;if(e+1>=f)return b}return e<0?l(-e,t).neg():c(e%m|0,e/m|0,t)}function c(e,t,i){return new n(e,t,i)}n.fromInt=a,n.fromNumber=l,n.fromBits=c;var h=Math.pow;function u(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return v;if("number"==typeof t?(i=t,t=!1):t=!!t,(i=i||10)<2||36<i)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return u(e.substring(1),t,i).neg();for(var r=l(h(i,8)),s=v,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+a),i);if(a<8){var d=l(h(i,a));s=s.mul(d).add(l(c))}else s=(s=s.mul(r)).add(l(c))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?u(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=u,n.fromValue=d;var m=4294967296,p=m*m,f=p/2,g=a(1<<24),v=a(0);n.ZERO=v;var y=a(0,!0);n.UZERO=y;var _=a(1);n.ONE=_;var x=a(1,!0);n.UONE=x;var w=a(-1);n.NEG_ONE=w;var b=c(-1,2147483647,!1);n.MAX_VALUE=b;var M=c(-1,-1,!0);n.MAX_UNSIGNED_VALUE=M;var T=c(0,-2147483648,!1);n.MIN_VALUE=T;var S=n.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*m+(this.low>>>0):this.high*m+(this.low>>>0)},S.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var t=l(e),i=this.div(t),n=i.mul(t).sub(this);return i.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=l(h(e,6),this.unsigned),s=this,o="";;){var a=s.div(r),c=(s.sub(a.mul(r)).toInt()>>>0).toString(e);if((s=a).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1==(1&this.low)},S.isEven=function(){return 0==(1&this.low)},S.equals=function(e){return r(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(r(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(_)},S.neg=S.negate,S.add=function(e){r(e)||(e=d(e));var t=this.high>>>16,i=65535&this.high,n=this.low>>>16,s=65535&this.low,o=e.high>>>16,a=65535&e.high,l=e.low>>>16,h=0,u=0,m=0,p=0;return m+=(p+=s+(65535&e.low))>>>16,u+=(m+=n+l)>>>16,h+=(u+=i+a)>>>16,h+=t+o,c((m&=65535)<<16|(p&=65535),(h&=65535)<<16|(u&=65535),this.unsigned)},S.subtract=function(e){return r(e)||(e=d(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return v;if(r(e)||(e=d(e)),i)return c(i.mul(this.low,this.high,e.low,e.high),i.get_high(),this.unsigned);if(e.isZero())return v;if(this.eq(T))return e.isOdd()?T:v;if(e.eq(T))return this.isOdd()?T:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,s=this.low>>>16,o=65535&this.low,a=e.high>>>16,h=65535&e.high,u=e.low>>>16,m=65535&e.low,p=0,f=0,y=0,_=0;return y+=(_+=o*m)>>>16,f+=(y+=s*m)>>>16,y&=65535,f+=(y+=o*u)>>>16,p+=(f+=n*m)>>>16,f&=65535,p+=(f+=s*u)>>>16,f&=65535,p+=(f+=o*h)>>>16,p+=t*m+n*u+s*h+o*a,c((y&=65535)<<16|(_&=65535),(p&=65535)<<16|(f&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(r(e)||(e=d(e)),e.isZero())throw Error("division by zero");var t,n,s;if(i)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?i.div_u:i.div_s)(this.low,this.high,e.low,e.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:v;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return x;s=y}else{if(this.eq(T))return e.eq(_)||e.eq(w)?T:e.eq(T)?_:(t=this.shr(1).div(e).shl(1)).eq(v)?e.isNegative()?_:w:(n=this.sub(e.mul(t)),s=t.add(n.div(e)));if(e.eq(T))return this.unsigned?y:v;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=v}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),a=o<=48?1:h(2,o-48),u=l(t),m=u.mul(e);m.isNegative()||m.gt(n);)m=(u=l(t-=a,this.unsigned)).mul(e);u.isZero()&&(u=_),s=s.add(u),n=n.sub(m)}return s},S.div=S.divide,S.modulo=function(e){return r(e)||(e=d(e)),i?c((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,e.low,e.high),i.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return c(~this.low,~this.high,this.unsigned)},S.and=function(e){return r(e)||(e=d(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return r(e)||(e=d(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return r(e)||(e=d(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,i){return i?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvPoliticalViewFeatureModifier=void 0;const n=i(1).LoggerManager.instance.create("OmvPoliticalViewFeatureModifier");t.OmvPoliticalViewFeatureModifier=class{constructor(e){this.m_countryCode=e}doProcessPointFeature(e,t,i){return!0}doProcessLineFeature(e,t,i){return this.rewriteEnvironment(e,t),!0}doProcessPolygonFeature(e,t,i){return!0}rewriteEnvironment(e,t){this.isPoliticalViewLayer(e)&&this.updateEnvironment(t,this.m_countryCode,"kind")}updateEnvironment(e,t,i){const n=this.getAlternativePov(e,t,i);void 0!==n&&(e.entries[i]=n)}getAlternativePov(e,t,i){n.log("Get alternate POV: ",JSON.stringify(e));const r=t,s=e.lookup(`${i}:${r}`);return n.log("Lookup POV: ",`${i}:${r}`,s),"string"==typeof s&&s.length>0?(n.log("Found POV: ",`${i}:${r}`,s),s):void 0}isPoliticalViewLayer(e){return"boundaries"===e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyleSetDataFilter=void 0;t.StyleSetDataFilter=class{constructor(e){this.styleSetEvaluator=e,this.hasKindFilter=!1}wantsLayer(e,t){return this.styleSetEvaluator.wantsLayer(e)}wantsPointFeature(e){return this.styleSetEvaluator.wantsFeature(e,"point")}wantsLineFeature(e){return this.styleSetEvaluator.wantsFeature(e,"line")}wantsPolygonFeature(e){return this.styleSetEvaluator.wantsFeature(e,"polygon")}wantsKind(){return!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryCommands=t.FeatureAttributes=t.visitOmvLayer=t.visitOmv=t.isClosePathCommand=t.isLineToCommand=t.isMoveToCommand=t.CommandKind=void 0;const n=i(0),r=i(178);var s;function o(e,t){if((!t.visitLayer||t.visitLayer(e))&&e.features)for(const i of e.features)switch(i.type){case r.com.mapbox.pb.Tile.GeomType.UNKNOWN:break;case r.com.mapbox.pb.Tile.GeomType.POINT:t.visitPointFeature&&t.visitPointFeature(i);break;case r.com.mapbox.pb.Tile.GeomType.LINESTRING:t.visitLineFeature&&t.visitLineFeature(i);break;case r.com.mapbox.pb.Tile.GeomType.POLYGON:t.visitPolygonFeature&&t.visitPolygonFeature(i)}t.endVisitLayer&&t.endVisitLayer(e)}!function(e){e[e.MoveTo=1]="MoveTo",e[e.LineTo=2]="LineTo",e[e.ClosePath=7]="ClosePath"}(s=t.CommandKind||(t.CommandKind={})),t.isMoveToCommand=function(e){return e.kind===s.MoveTo},t.isLineToCommand=function(e){return e.kind===s.LineTo},t.isClosePathCommand=function(e){return e.kind===s.ClosePath},t.visitOmv=function(e,t){if(e.layers)for(const i of e.layers)t.visitLayer&&!t.visitLayer(i)||o(i,t),t.endVisitLayer&&t.endVisitLayer(i)},t.visitOmvLayer=o;t.FeatureAttributes=class{accept(e,t,i){const{keys:n,values:r}=e,s=t.tags;if(s&&n&&r)for(let e=0;e<s.length;e+=2){const t=n[s[e]],o=r[s[e+1]];if(!i.visitAttribute(t,o))break}}};t.GeometryCommands=class{accept(e,t){if(!e)return;const i=e.length;let r=0,o=0;const a=[],l=[],c=[];for(let h=0;h<i;){const i=7&e[h],u=e[h]>>3;if(++h,i===s.MoveTo||i===s.LineTo)for(let s=0;s<u;++s){const s=e[h++],u=e[h++];r+=s>>1^-(1&s),o+=u>>1^-(1&u),"Polygon"===t.type&&(a.push(r),l.push(o));const d=new n.Vector2(r,o);c.push({kind:i,position:d})}else{for(const e of c)t.visitCommand(e);t.visitCommand({kind:i}),a.length=0,l.length=0,c.length=0}}if(c.length>0)for(const e of c)t.visitCommand(e)}}},function(e,t,i){"use strict";e.exports=i(366)},function(e,t,i){"use strict";var n=t;function r(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=i(179),n.BufferWriter=i(376),n.Reader=i(180),n.BufferReader=i(377),n.util=i(19),n.rpc=i(378),n.roots=i(380),n.configure=r,r()},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";e.exports=function(e,t){var i=new Array(arguments.length-1),n=0,r=2,s=!0;for(;r<arguments.length;)i[n++]=arguments[r++];return new Promise((function(r,o){i[n]=function(e){if(s)if(s=!1,e)o(e);else{for(var t=new Array(arguments.length-1),i=0;i<t.length;)t[i++]=arguments[i];r.apply(null,t)}};try{e.apply(t||null,i)}catch(e){s&&(s=!1,o(e))}}))}},function(e,t,i){"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&"="===e.charAt(t);)++i;return Math.ceil(3*e.length)/4-i};for(var r=new Array(64),s=new Array(123),o=0;o<64;)s[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;n.encode=function(e,t,i){for(var n,s=null,o=[],a=0,l=0;t<i;){var c=e[t++];switch(l){case 0:o[a++]=r[c>>2],n=(3&c)<<4,l=1;break;case 1:o[a++]=r[n|c>>4],n=(15&c)<<2,l=2;break;case 2:o[a++]=r[n|c>>6],o[a++]=r[63&c],l=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return l&&(o[a++]=r[n],o[a++]=61,1===l&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};n.decode=function(e,t,i){for(var n,r=i,o=0,a=0;a<e.length;){var l=e.charCodeAt(a++);if(61===l&&o>1)break;if(void 0===(l=s[l]))throw Error("invalid encoding");switch(o){case 0:n=l,o=1;break;case 1:t[i++]=n<<2|(48&l)>>4,n=l,o=2;break;case 2:t[i++]=(15&n)<<4|(60&l)>>2,n=l,o=3;break;case 3:t[i++]=(3&n)<<6|l,o=0}}if(1===o)throw Error("invalid encoding");return i-r},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,i){"use strict";function n(){this._listeners={}}e.exports=n,n.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var i=this._listeners[e],n=0;n<i.length;)i[n].fn===t?i.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],n=1;n<arguments.length;)i.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,i)}return this}},function(e,t,i){"use strict";function n(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),i=new Uint8Array(t.buffer),n=128===i[3];function r(e,n,r){t[0]=e,n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=i[3]}function s(e,n,r){t[0]=e,n[r]=i[3],n[r+1]=i[2],n[r+2]=i[1],n[r+3]=i[0]}function o(e,n){return i[0]=e[n],i[1]=e[n+1],i[2]=e[n+2],i[3]=e[n+3],t[0]}function a(e,n){return i[3]=e[n],i[2]=e[n+1],i[1]=e[n+2],i[0]=e[n+3],t[0]}e.writeFloatLE=n?r:s,e.writeFloatBE=n?s:r,e.readFloatLE=n?o:a,e.readFloatBE=n?a:o}():function(){function t(e,t,i,n){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,i,n);else if(isNaN(t))e(2143289344,i,n);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,i,n);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,i,n);else{var s=Math.floor(Math.log(t)/Math.LN2);e((r<<31|s+127<<23|8388607&Math.round(t*Math.pow(2,-s)*8388608))>>>0,i,n)}}function i(e,t,i){var n=e(t,i),r=2*(n>>31)+1,s=n>>>23&255,o=8388607&n;return 255===s?o?NaN:r*(1/0):0===s?1401298464324817e-60*r*o:r*Math.pow(2,s-150)*(o+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,s),e.readFloatLE=i.bind(null,o),e.readFloatBE=i.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),i=new Uint8Array(t.buffer),n=128===i[7];function r(e,n,r){t[0]=e,n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=i[3],n[r+4]=i[4],n[r+5]=i[5],n[r+6]=i[6],n[r+7]=i[7]}function s(e,n,r){t[0]=e,n[r]=i[7],n[r+1]=i[6],n[r+2]=i[5],n[r+3]=i[4],n[r+4]=i[3],n[r+5]=i[2],n[r+6]=i[1],n[r+7]=i[0]}function o(e,n){return i[0]=e[n],i[1]=e[n+1],i[2]=e[n+2],i[3]=e[n+3],i[4]=e[n+4],i[5]=e[n+5],i[6]=e[n+6],i[7]=e[n+7],t[0]}function a(e,n){return i[7]=e[n],i[6]=e[n+1],i[5]=e[n+2],i[4]=e[n+3],i[3]=e[n+4],i[2]=e[n+5],i[1]=e[n+6],i[0]=e[n+7],t[0]}e.writeDoubleLE=n?r:s,e.writeDoubleBE=n?s:r,e.readDoubleLE=n?o:a,e.readDoubleBE=n?a:o}():function(){function t(e,t,i,n,r,s){var o=n<0?1:0;if(o&&(n=-n),0===n)e(0,r,s+t),e(1/n>0?0:2147483648,r,s+i);else if(isNaN(n))e(0,r,s+t),e(2146959360,r,s+i);else if(n>17976931348623157e292)e(0,r,s+t),e((o<<31|2146435072)>>>0,r,s+i);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,r,s+t),e((o<<31|a/4294967296)>>>0,r,s+i);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=n*Math.pow(2,-l))>>>0,r,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,r,s+i)}}}function i(e,t,i,n,r){var s=e(n,r+t),o=e(n,r+i),a=2*(o>>31)+1,l=o>>>20&2047,c=4294967296*(1048575&o)+s;return 2047===l?c?NaN:a*(1/0):0===l?5e-324*a*c:a*Math.pow(2,l-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,s,4,0),e.readDoubleLE=i.bind(null,o,0,4),e.readDoubleBE=i.bind(null,a,4,0)}(),e}function r(e,t,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24}function s(e,t,i){t[i]=e>>>24,t[i+1]=e>>>16&255,t[i+2]=e>>>8&255,t[i+3]=255&e}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=n(n)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,i){"use strict";var n=t;n.length=function(e){for(var t=0,i=0,n=0;n<e.length;++n)(i=e.charCodeAt(n))<128?t+=1:i<2048?t+=2:55296==(64512&i)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},n.read=function(e,t,i){if(i-t<1)return"";for(var n,r=null,s=[],o=0;t<i;)(n=e[t++])<128?s[o++]=n:n>191&&n<224?s[o++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(n>>10),s[o++]=56320+(1023&n)):s[o++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))},n.write=function(e,t,i){for(var n,r,s=i,o=0;o<e.length;++o)(n=e.charCodeAt(o))<128?t[i++]=n:n<2048?(t[i++]=n>>6|192,t[i++]=63&n|128):55296==(64512&n)&&56320==(64512&(r=e.charCodeAt(o+1)))?(n=65536+((1023&n)<<10)+(1023&r),++o,t[i++]=n>>18|240,t[i++]=n>>12&63|128,t[i++]=n>>6&63|128,t[i++]=63&n|128):(t[i++]=n>>12|224,t[i++]=n>>6&63|128,t[i++]=63&n|128);return i-s}},function(e,t,i){"use strict";e.exports=function(e,t,i){var n=i||8192,r=n>>>1,s=null,o=n;return function(i){if(i<1||i>r)return e(i);o+i>n&&(s=e(n),o=0);var a=t.call(s,o,o+=i);return 7&o&&(o=1+(7|o)),a}}},function(e,t,i){"use strict";e.exports=r;var n=i(19);function r(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=r.zero=new r(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=r.zeroHash="\0\0\0\0\0\0\0\0";r.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var i=e>>>0,n=(e-i)/4294967296>>>0;return t&&(n=~n>>>0,i=~i>>>0,++i>4294967295&&(i=0,++n>4294967295&&(n=0))),new r(i,n)},r.from=function(e){if("number"==typeof e)return r.fromNumber(e);if(n.isString(e)){if(!n.Long)return r.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new r(e.low>>>0,e.high>>>0):s},r.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+4294967296*i)}return this.lo+4294967296*this.hi},r.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;r.fromHash=function(e){return e===o?s:new r((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},r.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},r.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0===i?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}},function(e,t,i){"use strict";e.exports=s;var n=i(179);(s.prototype=Object.create(n.prototype)).constructor=s;var r=i(19);function s(){n.call(this)}function o(e,t,i){e.length<40?r.utf8.write(e,t,i):t.utf8Write?t.utf8Write(e,i):t.write(e,i)}s._configure=function(){s.alloc=r._Buffer_allocUnsafe,s.writeBytesBuffer=r.Buffer&&r.Buffer.prototype instanceof Uint8Array&&"set"===r.Buffer.prototype.set.name?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var n=0;n<e.length;)t[i++]=e[n++]}},s.prototype.bytes=function(e){r.isString(e)&&(e=r._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=r.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},s._configure()},function(e,t,i){"use strict";e.exports=s;var n=i(180);(s.prototype=Object.create(n.prototype)).constructor=s;var r=i(19);function s(e){n.call(this,e)}s._configure=function(){r.Buffer&&(s.prototype._slice=r.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},function(e,t,i){"use strict";t.Service=i(379)},function(e,t,i){"use strict";e.exports=r;var n=i(19);function r(e,t,i){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(i)}(r.prototype=Object.create(n.EventEmitter.prototype)).constructor=r,r.prototype.rpcCall=function e(t,i,r,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return n.asPromise(e,a,t,i,r,s);if(a.rpcImpl)try{return a.rpcImpl(t,i[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),(function(e,i){if(e)return a.emit("error",e,t),o(e);if(null!==i){if(!(i instanceof r))try{i=r[a.responseDelimited?"decodeDelimited":"decode"](i)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",i,t),o(null,i)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},r.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,i){"use strict";e.exports={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DecodeInfo=void 0;const n=i(2),r=i(0);t.DecodeInfo=class{constructor(e,t,i=0){this.targetProjection=e,this.tileKey=t,this.storageLevelOffset=i,this.projectedBoundingBox=new n.OrientedBox3,this.tileBounds=new r.Box3,this.tileSize=new r.Vector3,this.center=new r.Vector3,this.geoBox=this.tilingScheme.getGeoBox(t),this.targetProjection.projectBox(this.geoBox,this.projectedBoundingBox),this.projectedBoundingBox.getCenter(this.center),this.tilingScheme.getWorldBox(t,this.tileBounds),this.tileBounds.getSize(this.tileSize),this.tileSizeOnScreen=256*Math.pow(2,-this.storageLevelOffset),this.columnCount=n.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionX(this.tileKey.level),this.rowCount=n.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionY(this.tileKey.level)}get tilingScheme(){return n.webMercatorTilingScheme}get sourceProjection(){return this.tilingScheme.projection}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDataEmitter=void 0;const n=i(3),r=i(108),s=i(172),o=i(116),a=i(118),l=i(2),c=i(162),h=i(82),u=i(31),d=i(1),m=i(383),p=i(0),f=i(53),g=i(384),v=d.LoggerManager.instance.create("OmvDecodedTileEmitter"),y=new p.Vector3,_=new p.Vector3,x=new p.Vector3,w=new p.Vector3,b=new p.Vector2,M=new p.Vector2,T=new p.Vector3,S=new p.Vector3,E=new p.Vector3,P=new p.Vector2,A=new p.Vector2,C=new p.Vector2,L=new p.Vector3,R=new p.Vector3,D=new p.Vector3,O=new p.Vector3,I=new p.Vector3,F=new p.Line3,V=Math.PI/8;function U(e,t,i="index"){const n=t>65535?"uint32":"uint16";return{itemCount:1,name:i,buffer:("uint32"===n?new Uint32Array(e):new Uint16Array(e)).buffer,type:n}}class N{constructor(e){this.type=e,this.positions=[],this.normals=[],this.textureCoordinates=[],this.colors=[],this.extrusionAxis=[],this.indices=[],this.edgeIndices=[],this.groups=[],this.texts=[],this.pathLengths=[],this.stringCatalog=[],this.imageTextures=[],this.featureStarts=[],this.edgeFeatureStarts=[],this.objInfos=[],this.offsetDirections=[]}addText(e){let t=this.stringCatalog.indexOf(e);return t<0&&(t=this.stringCatalog.length,this.stringCatalog.push(e)),t}}var B;!function(e){e[e.Simple=0]="Simple",e[e.Complex=1]="Complex"}(B||(B={}));const k=new p.Color;t.VectorTileDataEmitter=class{constructor(e,t,i={}){var n,r,s;this.m_decodeInfo=e,this.m_styleSetEvaluator=t,this.m_options=i,this.m_meshBuffers=new Map,this.m_geometries=[],this.m_textGeometries=[],this.m_textPathGeometries=[],this.m_pathGeometries=[],this.m_poiGeometries=[],this.m_simpleLines=[],this.m_solidLines=[],this.m_sources=[],this.m_maxGeometryHeight=0,this.m_minGeometryHeight=0,this.m_options.gatherFeatureAttributes=null!==(n=i.gatherFeatureAttributes)&&void 0!==n&&n,this.m_options.skipShortLabels=null===(r=i.skipShortLabels)||void 0===r||r,this.m_options.enableElevationOverlay=null!==(s=i.enableElevationOverlay)&&void 0!==s&&s}get projection(){return this.m_decodeInfo.targetProjection}get center(){return this.m_decodeInfo.center}processPointFeature(e,t,i,s,o){var a;const c=s.env;this.processFeatureCommon(c);const{tileKey:h,columnCount:u,rowCount:d}=this.m_decodeInfo,m=h.column+1<u?t-1:t,p=h.row+1<d?t-1:t,g=i.filter(e=>e.x>=0&&e.x<=m&&e.y>=0&&e.y<=p);if(0!==g.length)for(const e of o){if(void 0===e)continue;const i=e._index,o=this.findOrCreateMeshBuffers(i,n.GeometryType.Point);if(void 0===o)continue;const{positions:h,texts:u,imageTextures:d,objInfos:m,offsetDirections:p}=o,v=n.isTextTechnique(e)||n.isPoiTechnique(e);let y;const _=n.isPoiTechnique(e);if(_){const t=e;if(y=r.evaluateTechniqueAttr(s,t.imageTexture),void 0!==t.poiName)y=r.evaluateTechniqueAttr(s,t.poiName);else if("string"==typeof t.poiNameField){y=c.lookup(t.poiNameField)}else if("string"==typeof t.imageTextureField){const e=c.lookup(t.imageTextureField);y=n.composeTechniqueTextureName(e,t)}}const x=n.scaleHeight(s,e,this.m_decodeInfo.tileKey.level),w=n.getFeatureId(c.entries);for(const i of g){if(v){const t=e,i=n.getFeatureText(s,t,this.m_options.languages);void 0!==i&&i.length>0?u.push(o.addText(i)):u.push(-1)}v?f.webMercatorTile2TargetWorld(t,this.m_decodeInfo,i,T,x):f.webMercatorTile2TargetTile(t,this.m_decodeInfo,i,T,x);const r=this.projection.type===l.ProjectionType.Planar?T.z:i.z;r>this.m_maxGeometryHeight?this.m_maxGeometryHeight=r:r<this.m_minGeometryHeight&&(this.m_minGeometryHeight=r),h.push(T.x,T.y,T.z),m.push(this.m_options.gatherFeatureAttributes?c.entries:w),p.push(null!==(a=c.lookup("offset_direction"))&&void 0!==a?a:0),_&&(void 0===y?d.push(-1):d.push(o.addText(y)))}}}processLineFeature(e,t,i,s,o){const a=s.env;this.processFeatureCommon(a);const l=[],c=[],u=[],m=[],g=this.m_decodeInfo.projectedBoundingBox;let y;const _=2*g.extents.x,x=2*g.extents.y,w=Math.max(_,x);let b,M;const P=void 0!==i[0].untiledPositions;let A=!1,C=!1;for(const e of o)if(void 0!==e){if(b){const t=this.getTextureCoordinateType(e);d.assert(void 0===t||M===t)}else b=this.getComputeTexCoordsFunc(e),M=this.getTextureCoordinateType(e);A=A||n.isSpecialDashesLineTechnique(e),C=C||!A}for(const e of i){const i=[];let n=0;if(P&&(this.m_decodeInfo.targetProjection.projectPoint(e.untiledPositions[0],S),e.untiledPositions.forEach(e=>{this.m_decodeInfo.targetProjection.projectPoint(e,T),n+=T.distanceTo(S),S.copy(T),this.m_decodeInfo.targetProjection.projectPoint(e.normalized(),T),i.push(T.x,T.y,T.z,n)})),A){y=[];let r=0;const s=e.positions.length;if(s>1){let o=0;for(let a=0;a<s-1;a++){const s=[],l=[],h=[],d=[],p=e.positions[a],g=e.positions[a+1];if(f.webMercatorTile2TargetWorld(t,this.m_decodeInfo,p,T,!1),l.push(T.x,T.y,T.z),f.webMercatorTile2TargetWorld(t,this.m_decodeInfo,g,E,!1),l.push(E.x,E.y,E.z),b&&(b(p,t).toArray(h,h.length),b(g,t).toArray(h,h.length)),P){let e=this.findRelativePositionInLine(T,i)/n;d.push(e),e=this.findRelativePositionInLine(E,i)/n,d.push(e)}else{d.push(o);const e=T.distanceTo(E);r+=e,o+=e,d.push(o)}T.sub(this.m_decodeInfo.center),s.push(T.x,T.y,T.z),E.sub(this.m_decodeInfo.center),s.push(E.x,E.y,E.z),y.push(s),c.push(l),u.push(h),m.push(d)}}if(!P&&r>0)for(const e of m)e.forEach((t,i)=>{e[i]=t/r})}if(C){const r=[],s=[],o=[],a=[];e.positions.forEach(e=>{if(f.webMercatorTile2TargetWorld(t,this.m_decodeInfo,e,T,!1),s.push(T.x,T.y,T.z),b&&b(e,t).toArray(o,o.length),P){const e=this.findRelativePositionInLine(T,i)/n;a.push(e)}T.sub(this.m_decodeInfo.center),r.push(T.x,T.y,T.z)}),l.push(r),c.push(s),u.push(o),m.push(a)}}const L=this.m_decodeInfo.tileKey.level>=11;for(const e of o){if(void 0===e)continue;const t=e._index,i=e.name;if(n.isLineTechnique(e)||n.isSolidLineTechnique(e)){const i=n.isLineTechnique(e)?this.m_simpleLines:this.m_solidLines,r=n.isLineTechnique(e)?B.Simple:B.Complex;A&&(d.assert(void 0!==y,"OmvDecodedTileEmitter#processLineFeature: Internal error - No localLineSegments"),this.applyLineTechnique(i,e,t,r,a.entries,y,s,this.getTextureCoordinateType(e)?u:void 0,m)),l.length>0&&this.applyLineTechnique(i,e,t,r,a.entries,l,s,this.getTextureCoordinateType(e)?u:void 0,P?m:void 0)}else if(n.isTextTechnique(e)||n.isPoiTechnique(e)||n.isLineMarkerTechnique(e)){const i=e,o=n.getFeatureText(s,i,this.m_options.languages);if(void 0===o||0===o.length)continue;let l=[];if(this.m_options.skipShortLabels){const e=w/this.m_decodeInfo.tileSizeOnScreen,t=5*o.length*e*.5,i=t*t;l=this.splitJaggyLines(c,i,V)}else l=c;if(0===l.length)continue;if(n.isTextTechnique(e)){if(void 0===o)continue;for(const e of l){const i=d.Math2D.computeSquaredLineLength(e);this.m_textPathGeometries.push({technique:t,path:e,pathLengthSqr:i,text:String(o),objInfos:this.m_options.gatherFeatureAttributes?a.entries:n.getFeatureId(a.entries)})}}else{const i=e;let c=r.evaluateTechniqueAttr(s,i.imageTexture);if("string"==typeof i.imageTextureField){c=a.lookup(i.imageTextureField),"string"==typeof i.imageTexturePrefix&&(c=i.imageTexturePrefix+c),"string"==typeof i.imageTexturePostfix&&(c+=i.imageTexturePostfix)}for(const e of l)this.m_poiGeometries.push({technique:t,positions:{name:"position",type:"float",buffer:new Float64Array(e).buffer,itemCount:3},texts:[0],stringCatalog:[o,c],imageTextures:[1],objInfos:this.m_options.gatherFeatureAttributes?[a.entries]:[n.getFeatureId(a.entries)]})}}else if(n.isLabelRejectionLineTechnique(e))for(const e of c){const t=[];for(let i=0;i<e.length;i+=3)t.push((new p.Vector3).fromArray(e,i));this.m_pathGeometries.push({path:t})}else if(n.isExtrudedLineTechnique(e)){const i=this.findOrCreateMeshBuffers(t,n.GeometryType.ExtrudedLine);if(void 0===i)continue;const{positions:o,indices:c,groups:u,featureStarts:d,objInfos:m}=i,p=c.length,f=r.evaluateTechniqueAttr(s,e.lineWidth);if(void 0===f)continue;const g=r.evaluateTechniqueAttr(s,e.caps,"Circle"),v=L&&"Circle"===g;l.forEach(e=>{h.triangulateLine(e,f,o,c,v),d.push(p),m.push(this.m_options.gatherFeatureAttributes?a.entries:n.getFeatureId(a.entries))});const y=c.length-p;u.push({start:p,count:y,technique:t})}else v.warn(`OmvDecodedTileEmitter#processLineFeature: Invalid line technique\n                     ${i} for layer: ${a.entries.$layer} `)}}processPolygonFeature(e,t,i,r,o){const a=r.env;this.processFeatureCommon(a);o.forEach(e=>{if(void 0===e)return;const o=e._index;if(void 0===o)throw new Error("OmvDecodedTileEmitter#processPolygonFeature: Internal error - No technique index");let c;const h=a.lookup("bbox");if(Array.isArray(h)){const[e,t,i,n]=h,r=new l.GeoBox(new l.GeoCoordinates(t,e),new l.GeoCoordinates(n,i));c=new p.Box3,l.webMercatorProjection.projectBox(r,c)}const u=[],d=n.isExtrudedPolygonTechnique(e),m=n.isFillTechnique(e),v=n.isStandardTechnique(e),y=d||m||v||n.isShaderTechnique(e)&&"mesh"===e.primitive,_=this.getComputeTexCoordsFunc(e,c),x=y&&!d;for(const e of i){const i=[];for(let n=0;n<e.rings.length;n++){const r=0===n;let o=e.rings[n];if(x){o.some(e=>e.x<0||e.x>t||e.y<0||e.y>t)&&(o=s.clipPolygon(o,t))}const a=p.ShapeUtils.area(o);if(r&&0===a)break;if(0!==a){let e;void 0!==_&&(e=o.map(e=>_(e,t))),i.push(new g.Ring(o,e,t,x))}}i.length>0&&u.push(i)}const w=n.isSolidLineTechnique(e)||n.isLineTechnique(e);if(y)this.applyPolygonTechnique(u,e,o,r,t);else if(w){const i="line"===e.name?this.m_simpleLines:this.m_solidLines,s="line"===e.name?B.Simple:B.Complex,l=n.isSpecialDashesLineTechnique(e);u.forEach(n=>{const c=[],h=l?[]:void 0;n.forEach(e=>{const i=e.points.length;let n=[],r=0,s=0,o=l?[]:void 0;for(let a=0;a<i;++a){l&&n.length>0&&(n=[],o=[]);const u=(a+1)%i,d=e.points[a],m=e.points[u],p=e.isProperEdge(a);if(p||0===n.length){if(p&&0===n.length&&(f.webMercatorTile2TargetTile(t,this.m_decodeInfo,b.copy(d),T,!1),n.push(T.x,T.y,T.z),l)){f.webMercatorTile2TargetTile(t,this.m_decodeInfo,b.copy(m),E,!1),n.push(E.x,E.y,E.z),o.push(s);const e=T.distanceTo(E);r+=e,s+=e,o.push(s)}}else c.push(n),n=[];p&&!l&&(f.webMercatorTile2TargetTile(t,this.m_decodeInfo,b.copy(m),T,!1),n.push(T.x,T.y,T.z)),l&&n.length>0&&r>0&&(o.forEach((e,t)=>{o[t]=e/r}),c.push(n),h.push(o))}!l&&n.length>0&&c.push(n)}),0!==c.length&&this.applyLineTechnique(i,e,o,s,a.entries,c,r,void 0,h)})}})}getDecodedTile(){this.createGeometries(),this.processSimpleLines(this.m_simpleLines),this.processLines(this.m_solidLines);const e={techniques:this.m_styleSetEvaluator.decodedTechniques,geometries:this.m_geometries,decodeTime:void 0};return this.m_textGeometries.length>0&&(e.textGeometries=this.m_textGeometries),this.m_poiGeometries.length>0&&(e.poiGeometries=this.m_poiGeometries),this.m_textPathGeometries.length>0&&(e.textPathGeometries=this.m_textPathGeometries),this.m_pathGeometries.length>0&&(e.pathGeometries=this.m_pathGeometries),0!==this.m_sources.length&&(e.copyrightHolderIds=this.m_sources),e.maxGeometryHeight=this.m_maxGeometryHeight,e.minGeometryHeight=this.m_minGeometryHeight,e}splitJaggyLines(e,t,i){const n=[],r=(e,t,i)=>{let n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(let a=t;a<i;a+=3){const t=e[a],i=e[a+1];t<n&&(n=t),t>r&&(r=t),i<s&&(s=i),i>o&&(o=i)}return(r-n)*(r-n)+(o-s)*(o-s)},s=e.slice();for(;s.length>0;){const e=s.pop();if(void 0===e||e.length<6)continue;let o=-1;for(let t=0;t<e.length-3;t+=3){P.set(e[t],e[t+1]),A.set(e[t+3],e[t+4]);const n=A.sub(P).normalize();if(t>0){const e=Math.atan2(C.x*n.y-n.x*C.y,n.dot(C));if(Math.abs(e)>i){o=t;break}}C.set(n.x,n.y)}if(o>0){const i=r(e,0,o+3),a=r(e,o,e.length);i>t&&n.push(e.slice(0,o+3)),a>t&&s.push(e.slice(o))}else{r(e,0,e.length)>t&&n.push(e)}}return n}getTextureCoordinateType(e){return(n.isFillTechnique(e)||n.isSolidLineTechnique(e)||n.isExtrudedPolygonTechnique(e))&&this.m_options.enableElevationOverlay?n.TextureCoordinateType.TileSpace:n.textureCoordinateType(e)}getComputeTexCoordsFunc(e,t){switch(this.getTextureCoordinateType(e)){case n.TextureCoordinateType.TileSpace:return(e,t)=>{const i=e.clone().divideScalar(t);return i.y=1-i.y,i};case n.TextureCoordinateType.EquirectangularSpace:return(e,t)=>{const i=f.tile2world(t,this.m_decodeInfo,e,!1,S),n=l.normalizedEquirectangularProjection.reprojectPoint(l.webMercatorProjection,i);return new p.Vector2(n.x,n.y)};case n.TextureCoordinateType.FeatureSpace:if(!t)return;return(e,i)=>{const n=f.tile2world(i,this.m_decodeInfo,e,!1,S),r=new p.Vector2(n.x,n.y);return t&&(r.x-=t.min.x,r.y-=t.min.y,r.x/=t.max.x-t.min.x,r.y/=t.max.y-t.min.y),r.y=1-r.y,r};default:return}}applyLineTechnique(e,t,i,r=B.Complex,s,o,a,l,h){let u;const d=e.find(e=>e.technique===i),m=void 0!==l;if(void 0===d){u=new c.LineGroup(m,void 0,r===B.Simple);const t={type:r===B.Complex?n.GeometryType.SolidLine:n.GeometryType.Line,technique:i,lines:u};this.m_options.gatherFeatureAttributes&&(t.objInfos=[s],t.featureStarts=[0]),e.push(t)}else u=d.lines,this.m_options.gatherFeatureAttributes&&d.objInfos&&d.featureStarts&&(d.objInfos.push(s),d.featureStarts.push(u.indices.length));let p=0;o.forEach(e=>{u.add(this.m_decodeInfo.center,e,this.projection,h?h[p]:void 0,l?l[p]:void 0),p++})}applyPolygonTechnique(e,t,i,s,c){var h,g;if(0===e.length)return;const E=n.isExtrudedPolygonTechnique(t),P=E?n.GeometryType.ExtrudedPolygon:n.GeometryType.Polygon,A=this.findOrCreateMeshBuffers(i,P);if(void 0===A)return;const C=t,L=t,R=!0===C.boundaryWalls,D=n.isFillTechnique(t),O=this.getTextureCoordinateType(t);let I=r.evaluateTechniqueAttr(s,C.height),F=r.evaluateTechniqueAttr(s,C.floorHeight);if(void 0===I){const e=s.env.lookup("height"),t=r.evaluateTechniqueAttr(s,C.defaultHeight);I=void 0!==e?e:void 0!==t?t:0}if(void 0===F){const e=s.env.lookup("min_height");F=void 0===e||D?0:e}I=Math.max(F+u.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT,I);const V=this.m_decodeInfo.tileKey.level,N=E&&n.scaleHeight(s,C,V);this.m_decodeInfo.tileBounds.getCenter(y);const{positions:B,normals:z,textureCoordinates:G,colors:j,extrusionAxis:H,indices:W,edgeIndices:q,groups:X}=A,Z=this.m_decodeInfo.targetProjection.type===l.ProjectionType.Spherical,K=E?null!==(h=C.lineWidth)&&void 0!==h?h:0:D&&null!==(g=L.lineWidth)&&void 0!==g?g:0,Y="number"!=typeof K||K>0;let $;if(n.isExtrudedPolygonTechnique(t)&&d.getOptionValue(t.vertexColors,!1)){let e=r.evaluateTechniqueAttr(s,t.color);if(void 0===e){const t=s.env.lookup("color");this.isColorStringValid(t)&&(e=String(t))}void 0===e&&(e=r.evaluateTechniqueAttr(s,t.defaultColor,0)),void 0===e&&(e=0),k.set(e),$=k}for(const t of e){const e=W.length,n=q.length,r=[],h=B.length/3,u=t[0],d=u.vertexStride,g=d+2;for(let e=0;e<u.points.length;++e){const t=u.points[e];r.push(t.x,-t.y),void 0!==u.textureCoords&&r.push(u.textureCoords[e].x,u.textureCoords[e].y);const i=(e+1)%u.points.length,n=u.isProperEdge(e);r.push(n?i:-1,R||n?i:-1)}const y=[];let P=1;for(;P<t.length;){const e=r.length/g;y.push(e);const i=t[P++];for(let t=0;t<i.points.length;++t){const n=(t+1)%i.points.length,s=i.points[t];r.push(s.x,-s.y),void 0!==i.textureCoords&&r.push(i.textureCoords[t].x,i.textureCoords[t].y);const o=i.isProperEdge(t);r.push(o?e+n:-1,R||o?e+n:-1)}}try{const e=m.default(r,y,g),t=r.length/g;if(Z){const t=new p.BufferGeometry,i=[],n=[],s=[],h=[];for(let e=0;e<r.length;e+=g){const t=f.tile2world(c,this.m_decodeInfo,b.set(r[e],r[e+1]),!0,S);i.push(t.x,t.y,0),void 0!==O&&n.push(r[e+2],r[e+3]),s.push(r[e+d]),h.push(r[e+d+1])}const u=new p.BufferAttribute(new Float32Array(i),3);let m;t.setAttribute("position",u),void 0!==O&&(m=new p.BufferAttribute(new Float32Array(n),2),t.setAttribute("uv",m));const v=new p.BufferAttribute(new Float32Array(s),1);t.setAttribute("edge",v);const y=new p.BufferAttribute(new Float32Array(h),1);t.setAttribute("wall",v);const _=U(e,u.count-1),x="uint32"===_.type?new p.Uint32BufferAttribute(_.buffer,1):new p.Uint16BufferAttribute(_.buffer,1);t.setIndex(x);const w=this.m_decodeInfo.tileKey.level;if(w>=3&&w<9){const e=Math.pow(2,9-w),{geoBox:i}=this.m_decodeInfo;new o.EdgeLengthGeometrySubdivisionModifier(e,i,o.SubdivisionMode.NoDiagonals,l.webMercatorProjection).modify(t)}new a.SphericalGeometrySubdivisionModifier(p.MathUtils.degToRad(10),l.webMercatorProjection).modify(t),r.length=0,e.length=0;for(let e=0;e<u.array.length;e+=3){const t=f.world2tile(c,this.m_decodeInfo,T.set(u.array[e],u.array[e+1],0),!0,M);r.push(t.x,t.y),void 0!==O&&(r.push(m.array[e/3*2]),r.push(m.array[e/3*2+1])),r.push(v.array[e/3]),r.push(y.array[e/3])}const E=t.getIndex();null!==E&&e.push(...E.array)}_.set(0,0,1);for(let e=0;e<r.length;e+=g){f.webMercatorTile2TargetWorld(c,this.m_decodeInfo,b.set(r[e],r[e+1]),T,!1,!0);const t=N?this.m_decodeInfo.targetProjection.getScaleFactor(T):1;this.m_maxGeometryHeight=Math.max(this.m_maxGeometryHeight,t*I),this.m_minGeometryHeight=Math.min(this.m_minGeometryHeight,t*I),Z&&_.set(T.x,T.y,T.z).normalize(),T.sub(this.center),x.copy(_).multiplyScalar(F*t),B.push(T.x+x.x,T.y+x.y,T.z+x.z),void 0!==O&&G.push(r[e+2],r[e+3]),this.m_options.enableElevationOverlay&&z.push(..._.toArray()),E&&(w.copy(_).multiplyScalar(I*t),B.push(T.x+w.x,T.y+w.y,T.z+w.z),H.push(0,0,0,0,w.x-x.x,w.y-x.y,w.z-x.z,1),void 0!==O&&G.push(r[e+2],r[e+3]),this.m_options.enableElevationOverlay&&z.push(..._.toArray()),void 0!==$&&j.push($.r,$.g,$.b,$.r,$.g,$.b))}for(let t=0;t<e.length;t+=3)if(E){const i=h+2*e[t+0]+1,n=h+2*e[t+1]+1,r=h+2*e[t+2]+1;W.push(i,n,r)}else{const i=h+e[t+0],n=h+e[t+1],r=h+e[t+2];W.push(i,n,r)}Y&&this.addEdges(h,t,g,d,B,r,q,E,C.footprint,C.maxSlope),E&&this.addWalls(h,t,g,d,r,W)}catch(e){v.error("cannot triangulate geometry",e)}this.m_options.gatherFeatureAttributes&&(A.objInfos.push(s.env.entries),A.featureStarts.push(e),A.edgeFeatureStarts.push(n));const L=W.length-e;L>0&&X.push({start:e,count:L,technique:i})}}createGeometries(){this.m_meshBuffers.forEach((e,t)=>{if(0===e.positions.length)return;if(!this.m_styleSetEvaluator.techniques||this.m_styleSetEvaluator.techniques.length<=t)throw new Error("Invalid technique index");const i=this.m_styleSetEvaluator.techniques[t];if(void 0===i)return;if(e.texts.length>0){const r={positions:{name:"position",type:"float",buffer:new Float64Array(e.positions).buffer,itemCount:3},texts:e.texts,technique:t,stringCatalog:e.stringCatalog,objInfos:e.objInfos};if(n.isTextTechnique(i))this.m_textGeometries.push(r);else{d.assert(n.isPoiTechnique(i));const t=r;t.imageTextures=e.imageTextures,t.offsetDirections=e.offsetDirections,this.m_poiGeometries.push(t)}return}const r=new Float32Array(e.positions);0===e.groups.length&&e.groups.push({start:0,count:r.length/3,technique:t});const s=[{name:"position",buffer:r.buffer,itemCount:3,type:"float"}],o={type:e.type,vertexAttributes:s,groups:e.groups};if(e.normals.length>0){const t=new Float32Array(e.normals);d.assert(t.length===r.length,"length of normals buffer is different than the length of the position buffer"),s.push({name:"normal",buffer:t.buffer,itemCount:3,type:"float"})}if(e.colors.length>0){const t=new Float32Array(e.colors);d.assert(t.length===r.length,"length of colors buffer is different than the length of the position buffer"),s.push({name:"color",buffer:t.buffer,itemCount:3,type:"float"})}const a=e.positions.length/3;if(e.textureCoordinates.length>0){const t=e.textureCoordinates.length/2;d.assert(t===a,"length of textureCoordinates buffer is different than the length of theposition buffer");const i=new Float32Array(e.textureCoordinates);s.push({name:"uv",buffer:i.buffer,itemCount:2,type:"float"})}if(e.extrusionAxis.length>0){const t=new Float32Array(e.extrusionAxis);d.assert(t.length/4==r.length/3,"length of extrusionAxis buffer is different than the length of the position buffer"),s.push({name:"extrusionAxis",buffer:t.buffer,itemCount:4,type:"float"})}e.indices.length>0&&(o.index=U(e.indices,a-1)),e.edgeIndices.length>0&&(o.edgeIndex=U(e.edgeIndices,a-1,"edgeIndex")),o.featureStarts=e.featureStarts,o.edgeFeatureStarts=e.edgeFeatureStarts,o.objInfos=e.objInfos,this.m_geometries.push(o)})}processLines(e){e.forEach(e=>{const{vertices:t,indices:i}=e.lines,r=e.technique,s=new Float32Array(t).buffer,o=U(i,t.length/e.lines.stride-1),a={type:"float",stride:e.lines.stride,buffer:s,attributes:e.lines.vertexAttributes},l={type:n.GeometryType.SolidLine,index:o,interleavedVertexAttributes:[a],groups:[{start:0,count:i.length,technique:r}],vertexAttributes:[],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(l)})}processSimpleLines(e){e.forEach(e=>{const{vertices:t,indices:i}=e.lines,r=e.technique,s={buffer:new Float32Array(t).buffer,itemCount:3,type:"float",name:"position"},o={type:n.GeometryType.Line,index:U(i,t.length/s.itemCount-1),vertexAttributes:[s],groups:[{start:0,count:i.length,technique:r}],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(o)})}findOrCreateMeshBuffers(e,t){let i=this.m_meshBuffers.get(e);return void 0!==i?i.type!==t?void v.error(`MeshBuffer has been created with wrong type "${n.GeometryType[t]}"\n                instead of "${n.GeometryType[i.type]}"`):i:(i=new N(t),this.m_meshBuffers.set(e,i),i)}processFeatureCommon(e){const t=e.lookup("source");"string"==typeof t&&""!==t&&(this.m_sources.includes(t)||this.m_sources.push(t))}isColorStringValid(e){return"string"==typeof e&&e.length>0}addEdges(e,t,i,n,r,s,o,a,l,c){const h=new p.Vector3,u=new p.Vector3;let d,m,f=0,g=0;for(;f<t;){for(;f!==d;){void 0===d&&(d=f),f<t&&(g=Math.max(g,f));const p=s[f*i+n];if(p<0)break;if(a)if(!0===l&&o.push(e+2*f,e+2*p),o.push(e+2*f+1,e+2*p+1),void 0!==c){if(void 0!==m){const t=3*(e+2*m),i=3*(e+2*f),n=3*(e+2*p);h.set(r[i]-r[t],r[i+1]-r[t+1],r[i+2]-r[t+2]).normalize(),u.set(r[n]-r[i],r[n+1]-r[i+1],r[n+2]-r[i+2]).normalize(),h.dot(u)<=c&&o.push(e+2*f,e+2*f+1)}}else o.push(e+2*f,e+2*f+1);else o.push(e+f,e+p);m=f,f=p}f=g+1,d=void 0,m=void 0}}addWalls(e,t,i,n,r,s){let o,a=0,l=0;for(;a<t;){for(;a!==o;){void 0===o&&(o=a),a<t&&(l=Math.max(l,a));const c=r[a*i+n+1];if(c<0)break;s.push(e+2*a,e+2*a+1,e+2*c+1,e+2*c+1,e+2*c,e+2*a),a=c}a=l+1,o=void 0}}findRelativePositionInLine(e,t){let i=1/0,n=0;for(let r=0;r<t.length;r+=4){F.set(L.set(t[r],t[r+1],t[r+2]),R.set(t[r+4],t[r+5],t[r+6])),F.closestPointToPoint(e,!0,D);const s=D.distanceTo(e);s<i&&(O.copy(D),I.copy(L),i=s,n=t[r+3])}return n+O.distanceTo(I)}}},function(e,t,i){"use strict";function n(e,t,i){i=i||2;var n,a,l,c,h,m,p,g=t&&t.length,v=g?t[0]*i:e.length,y=r(e,0,v,i,!0),_=[];if(!y||y.next===y.prev)return _;if(g&&(y=function(e,t,i,n){var o,a,l,c,h,m=[];for(o=0,a=t.length;o<a;o++)l=t[o]*n,c=o<a-1?t[o+1]*n:e.length,(h=r(e,l,c,n,!1))===h.next&&(h.steiner=!0),m.push(f(h));for(m.sort(u),o=0;o<m.length;o++)d(m[o],i),i=s(i,i.next);return i}(e,t,y,i)),e.length>80*i){n=l=e[0],a=c=e[1];for(var x=i;x<v;x+=i)(h=e[x])<n&&(n=h),(m=e[x+1])<a&&(a=m),h>l&&(l=h),m>c&&(c=m);p=0!==(p=Math.max(l-n,c-a))?1/p:0}return o(y,_,i,n,a,p),_}function r(e,t,i,n,r){var s,o;if(r===A(e,t,i,n)>0)for(s=t;s<i;s+=n)o=S(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=S(s,e[s],e[s+1],o);return o&&_(o,o.next)&&(E(o),o=o.next),o}function s(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!_(n,n.next)&&0!==y(n.prev,n,n.next))n=n.next;else{if(E(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function o(e,t,i,n,r,u,d){if(e){!d&&u&&function(e,t,i,n){var r=e;do{null===r.z&&(r.z=p(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(e,n,r,u);for(var m,f,g=e;e.prev!==e.next;)if(m=e.prev,f=e.next,u?l(e,n,r,u):a(e))t.push(m.i/i),t.push(e.i/i),t.push(f.i/i),E(e),e=f.next,g=f.next;else if((e=f)===g){d?1===d?o(e=c(s(e),t,i),t,i,n,r,u,2):2===d&&h(e,t,i,n,r,u):o(s(e),t,i,n,r,u,1);break}}}function a(e){var t=e.prev,i=e,n=e.next;if(y(t,i,n)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(g(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&y(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(e,t,i,n){var r=e.prev,s=e,o=e.next;if(y(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,h=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=p(a,l,t,i,n),d=p(c,h,t,i,n),m=e.prevZ,f=e.nextZ;m&&m.z>=u&&f&&f.z<=d;){if(m!==e.prev&&m!==e.next&&g(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,f!==e.prev&&f!==e.next&&g(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;m&&m.z>=u;){if(m!==e.prev&&m!==e.next&&g(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&g(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function c(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!_(r,o)&&x(r,n,n.next,o)&&M(r,o)&&M(o,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(o.i/i),E(n),E(n.next),n=e=o),n=n.next}while(n!==e);return s(n)}function h(e,t,i,n,r,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&v(l,c)){var h=T(l,c);return l=s(l,l.next),h=s(h,h.next),o(l,t,i,n,r,a),void o(h,t,i,n,r,a)}c=c.next}l=l.next}while(l!==e)}function u(e,t){return e.x-t.x}function d(e,t){if(t=function(e,t){var i,n=t,r=e.x,s=e.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(r===o)return i;var l,c=i,h=i.x,u=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=h&&r!==n.x&&g(s<u?r:o,s,h,u,s<u?o:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),M(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&m(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(e,t)){var i=T(t,e);s(t,t.next),s(i,i.next)}}function m(e,t){return y(e.prev,e,t.prev)<0&&y(t.next,e,e.next)<0}function p(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function g(e,t,i,n,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&x(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(M(e,t)&&M(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(y(e.prev,e,t.prev)||y(e,t.prev,t))||_(e,t)&&y(e.prev,e,e.next)>0&&y(t.prev,t,t.next)>0)}function y(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,i,n){var r=b(y(e,t,i)),s=b(y(e,t,n)),o=b(y(i,n,e)),a=b(y(i,n,t));return r!==s&&o!==a||(!(0!==r||!w(e,i,t))||(!(0!==s||!w(e,n,t))||(!(0!==o||!w(i,e,n))||!(0!==a||!w(i,t,n)))))}function w(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function b(e){return e>0?1:e<0?-1:0}function M(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function T(e,t){var i=new P(e.i,e.x,e.y),n=new P(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function S(e,t,i,n){var r=new P(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function P(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,i,n){for(var r=0,s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}e.exports=n,e.exports.default=n,n.deviation=function(e,t,i,n){var r=t&&t.length,s=r?t[0]*i:e.length,o=Math.abs(A(e,0,s,i));if(r)for(var a=0,l=t.length;a<l;a++){var c=t[a]*i,h=a<l-1?t[a+1]*i:e.length;o-=Math.abs(A(e,c,h,i))}var u=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,m=n[a+1]*i,p=n[a+2]*i;u+=Math.abs((e[d]-e[p])*(e[m+1]-e[d+1])-(e[d]-e[m])*(e[p+1]-e[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},n.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var o=0;o<t;o++)i.vertices.push(e[r][s][o]);r>0&&(n+=e[r-1].length,i.holes.push(n))}return i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ring=void 0;const n=i(0);t.Ring=class{constructor(e,t,i=4096,r=!1){if(this.points=e,this.textureCoords=t,this.extents=i,this.hasClipInfo=r,void 0!==t&&t.length!==e.length)throw new Error("the array of texture coordinates must have the same number of elements of the array of points");this.vertexStride=2,void 0!==t&&(this.vertexStride=this.vertexStride+2),this.area=n.ShapeUtils.area(this.points),this.winding=this.area<0}toArray(e=[],t=0){var i;return this.points.forEach((i,n)=>i.toArray(e,t+this.vertexStride*n)),null===(i=this.textureCoords)||void 0===i||i.forEach((i,n)=>i.toArray(e,t+this.vertexStride*n+2)),e}isProperEdge(e){const t=this.extents,i=(e+1)%this.points.length,n=this.points[e],r=this.points[i];if(this.hasClipInfo){if(n.x!==r.x&&n.y!==r.y)return!0;if(!(n.x%this.extents==0||n.y%this.extents==0))return!0;if(!(r.x%this.extents==0||r.y%this.extents==0))return!0;const e=!0===n.isClipped,t=!0===r.isClipped;return!e&&!t}return!(n.x<=0&&r.x<=0||n.x>=t&&r.x>=t||n.y<=0&&r.y<=0||n.y>=t&&r.y>=t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectTileDataSource=void 0;const n=i(88),r=i(386),s=i(50),o=i(24),a=i(51),l=i(387),c=i(389);class h extends n.ObjectDataSource{constructor(e,t){super(u(Object.assign(Object.assign({},e),{addGroundPlane:!1,gatherFeatureAttributes:!0,dataProvider:new r.ObjectTileDataProvider(t)}),t),t),this.provider=t}ready(){return super.ready()&&this.provider.getStyleInternal().getState()===H.map.render.Style.State.READY}invalidateTiles(){this.mapView.markTilesDirty(this,({tileKey:e})=>{const t=this.provider.requestTile(e.column,e.row,e.level,!0);return void 0!==t&&!t.valid})}onProviderUpdate(e){var t;if(this.isDetached())return;if(e.target===this.provider)return void this.mapView.markTilesDirty(this);const i=e.target;(i instanceof H.map.Marker&&(null===(t=i.getIcon())||void 0===t?void 0:t.getState())===H.map.Icon.State.READY||i instanceof H.map.Spatial)&&this.invalidateTilesWithDelay()}}t.ObjectTileDataSource=h;const u=(e,t)=>{if(t.providesMarkers())e.tileFactory=new s.TileFactory(n.ObjectTile),e.decoder=new a.VectorTileDecoder;else if(t.providesSpatials())e.tileFactory=new s.TileFactory(o.Tile),e.decoder=new l.SpatialObjectTileDecoder;else{if(!t.providesGeoJSON())throw Error('At least one of these provider\'s methods should return "true":\n      providesMarkers(), providesSpatials(), providesGeoJSON()');e.tileFactory=new s.TileFactory(n.ObjectTile),e.decoder=new c.LayeredGeoJsonTileDecoder}return e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectTileDataProvider=void 0;const n=i(174),r=i(87);class s extends n.ObjectDataProvider{constructor(e){super(e),this.provider=e,void 0!==H.service&&e instanceof H.service.extension.TileProvider&&e.setTileCanvasRendering(!1)}async getTile(e,t){if(void 0!==t&&t.addEventListener("abort",()=>{this.provider.cancelTile(e.column,e.row,e.level)}),this.provider.providesMarkers()){const t=this.getIconLoader();return await new Promise((i,n)=>{this.provider.requestTileAsPromise(e.column,e.row,e.level).then(n=>{const s={},o=[],a=n.data,l=[];a.forEach(t=>{const i=r.getMarkerProperties(t,s);null!==i&&(i.tileKey=e,l.push({type:"Feature",properties:i,geometry:t.getGeometry().toGeoJSON()}))});for(const e in s)o.push(e),t.load(e,s[e]);t.setImageReferences(e,o),i({type:"FeatureCollection",features:l})},n)})}return this.provider.requestTileAsPromise(e.column,e.row,e.level)}}t.ObjectTileDataProvider=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpatialObjectTileDecoder=void 0;const n=i(51),r=i(388);class s extends n.VectorTileDecoder{getDataAdapter(e){return s.dataAdapter}}t.SpatialObjectTileDecoder=s,s.dataAdapter=new r.SpatialObjectDataAdapter},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpatialObjectDataAdapter=void 0;const n=i(0),r=i(87);t.SpatialObjectDataAdapter=class{canProcess(e){return!0}process(e,t,i){var n;const l=e.getObjects(),c=null!==(n=e.getTileSize())&&void 0!==n?n:s;l.forEach(t=>{const n=t.getGeometriesForTile(e);if(void 0!==n&&n.length>0){const e=t.getId();let s;const l=r.getSpatialProperties(t),h=t.isClosed();if(h?(s=function(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i],r=n.paths,s=r.length,o=n.interiorsIndex,l=n.outlinesIndex;let c,h=Math.min(o,l,s);const u=[];for(let e=0;e<h;e++)c=[r[e].map(a)],u.push({rings:c});if(1===h){h=Math.min(l,s);for(let e=o;e<h;e++)c.push(r[e].map(a))}t.push(u)}return t}(n),l.height=0):s=o(n,!1),s.length>0)if(h){const t=Object.assign(Object.assign({},l),{lineWidth:0});s.forEach(n=>{i.processPolygonFeature("extensionSpatial",c,n,t,e)})}else i.processLineFeature("extensionSpatial",c,s,l,e);s=o(n,!0),s.length>0&&i.processLineFeature("extensionSpatial",c,s,l,e)}})}};const s=256;function o(e,t){const i=[];for(let n=0;n<e.length;n++){const r=e[n],s=t?r.outlinesIndex:0,o=t?r.paths.length:Math.min(r.interiorsIndex,r.outlinesIndex,r.paths.length);for(let e=s;e<o;e++)i.push({positions:r.paths[e].map(a)})}return i}function a(e){return new n.Vector2(e.x,e.y)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayeredGeoJsonTileDecoder=void 0;const n=i(51),r=i(390);class s extends n.VectorTileDecoder{getDataAdapter(e){return s.dataAdapter}}t.LayeredGeoJsonTileDecoder=s,s.dataAdapter=new r.LayeredGeoJsonDataAdapter},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayeredGeoJsonDataAdapter=void 0;const n=i(177);t.LayeredGeoJsonDataAdapter=class{constructor(){this.m_geoJsonDataAdapter=new n.GeoJsonDataAdapter}canProcess(e){return!0}process(e,t,i){"FeatureCollection"===e.data.type&&(e.data={geojson:e.data});const n=e.data;for(const e in n){const r=n[e];this.m_geoJsonDataAdapter.canProcess(r)&&this.m_geoJsonDataAdapter.process(r,t,i,e)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDataProvider=void 0;const n=i(84);class r extends n.DataProvider{constructor(e){super(),this.provider=e}async getTile(e,t){return void 0!==t&&t.addEventListener("abort",()=>{this.provider.cancelTile(e.column,e.row,e.level)}),await new Promise((t,i)=>{this.provider.requestTileAsPromise(e.column,e.row,e.level).then(({data:e})=>{e instanceof ArrayBuffer&&t(e.slice(0,e.byteLength))},i)})}ready(){return!0}async connect(){return await Promise.resolve()}dispose(){}}t.VectorTileDataProvider=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileDataProvider=void 0;const n=i(0),r=[];t.WebTileDataProvider=class{constructor(e){this.provider=e}async getTexture(e,t){return void 0!==t&&t.addEventListener("abort",()=>{this.provider.cancelTile(e.tileKey.column,e.tileKey.row,e.tileKey.level)}),await new Promise((t,i)=>{this.provider.requestTileAsPromise(e.tileKey.column,e.tileKey.row,e.tileKey.level).then(({data:e})=>{null===e&&t();const i=new n.Texture(e);i.needsUpdate=!0,t([i,r])},i)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lights=void 0,t.lights=[{name:"ambientLight",color:"#ffffff",intensity:.8,type:"ambient"},{direction:{x:-.3535533524,y:.3535534098,z:.8660254115},name:"light1",color:"#ffffff",intensity:.4,type:"directional"},{direction:{x:-.2548870499,y:-.9512512293,z:.1736481802},name:"light2",color:"#ffffff",intensity:.3,type:"directional"},{direction:{x:.6830126975,y:.1830126865,z:.7071067893},name:"light3",color:"#ffffff",intensity:.25,type:"directional"}]},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LookAtManipulator=t.adjustHeading=void 0;const n=i(112),r=i(2),s=i(5),o=i(89),a=i(0),l=i(49),c=i(395);function h(e){return(180+e)%360}t.adjustHeading=h;class u{constructor(e,t){this.m_mapView=e,this.m_viewPort=t,this.camera=this.m_mapView.camera.clone()}update(){const{width:e,height:t,padding:i}=this.m_viewPort,n=this.m_mapView.camera,r=e-i.left-i.right,o=t-i.top-i.bottom;this.camera.copy(n),this.camera.aspect=r/o,s.CameraUtils.setPrincipalPoint(this.camera,{x:0,y:0});const l=c.calculateNormalizedDeviceCoordinates(i.left,i.top,e,t),h=new a.Vector3(l.x,l.y,-1).applyMatrix4(n.projectionMatrixInverse),u=2*Math.atan2(h.y,n.near);s.CameraUtils.setVerticalFov(this.camera,u,o),this.camera.updateProjectionMatrix()}get projection(){return this.m_mapView.projection}get tileWrappingEnabled(){return this.m_mapView.tileWrappingEnabled}}t.LookAtManipulator=class{constructor(e,t){this.mapView=e,this.m_viewPort=t,this.m_localTangentSpace={position:new a.Vector3,xAxis:new a.Vector3,yAxis:new a.Vector3,zAxis:new a.Vector3},this.m_boundsGenerator=new n.BoundsGenerator(this.mapView),this.m_paddedBoundsGenerator=this.m_boundsGenerator,this.setZoomConstraints(o.default.lookAt.zoom.min,o.default.lookAt.zoom.max),t.addEventListener("update",this.onViewPortUpdate,void 0,this),this.onViewPortUpdate()}getLookAtData(e=!1,t=!1){return(e||void 0===this.m_viewBounds)&&this.updateViewBounds(),{position:this.mapView.target.toLatLng(),zoom:this.mapView.zoomLevel,heading:h(this.mapView.heading),tilt:this.mapView.tilt,bounds:t?this.m_paddedViewBounds:this.m_viewBounds,incline:0}}setZoomConstraints(e,t){this.m_layerMinZoom=e,this.m_layerMaxZoom=t,this.mapView.minZoomLevel=e,this.mapView.maxZoomLevel=t,this.invalidateViewBounds()}clampValues(e){const{heading:t,tilt:i}=o.default.lookAt;if(void 0!==e.zoom&&(e.zoom=this.clampZoom(e.zoom)),void 0!==e.tilt&&(e.tilt=a.MathUtils.clamp(e.tilt,i.min,i.max)),void 0!==e.heading){const i=(e.heading%360+360)%360;e.heading=a.MathUtils.clamp(i,t.min,t.max)}}clampZoom(e){const{zoom:t}=o.default.lookAt;return a.MathUtils.clamp(e,Math.max(t.min,this.m_layerMinZoom),Math.min(t.max,this.m_layerMaxZoom))}lookAt(e){this.mapView.lookAt(e),this.invalidateViewBounds()}applyLookAtDelta(e,t,i,n,r){const l=this.mapView;if(n||r){const e=a.MathUtils.degToRad(o.default.lookAt.tilt.max);s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaTilt:a.MathUtils.degToRad(n),maxTiltAngle:e}),s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaAzimuth:a.MathUtils.degToRad(r),maxTiltAngle:e,center:t})}0!==i&&this.zoomAt(l.zoomLevel+i,t),this.moveLookAtByOffset(e.x,e.y),this.invalidateViewBounds()}moveLookAtByOffset(e,t){if(0===e&&0===t)return;const i=this.mapView.camera,n=this.mapView.projection,o=a.MathUtils.degToRad(this.mapView.heading),l=this.mapView.pixelToWorld,c=Math.cos(-o),h=Math.sin(-o),u=(e*c+t*h)*l,d=(t*c-e*h)*l;if(n.type===r.ProjectionType.Planar)i.position.x+=u,i.position.y-=d,this.clampCameraPosition();else{const e=s.MapViewUtils.getWorldTargetFromCamera(i,n);if(null===e)return;n.localTangentSpace(e,this.m_localTangentSpace);const t=this.m_localTangentSpace.xAxis,r=this.m_localTangentSpace.yAxis,o=e.clone();t.multiplyScalar(u),o.sub(t),r.multiplyScalar(d),o.add(r),s.MapViewUtils.panCameraAroundGlobe(this.mapView,e,o)}this.invalidateViewBounds()}setAngles(e,t){const i=o.default.lookAt.tilt;e=a.MathUtils.clamp(e,i.min,i.max);const{target:n,distance:r}=s.MapViewUtils.getTargetAndDistance(this.mapView.projection,this.mapView.camera,this.mapView.elevationProvider),l=this.mapView.projection.unprojectPoint(n);s.MapViewUtils.getCameraRotationAtTarget(this.mapView.projection,l,-t,e,this.mapView.camera.quaternion),s.MapViewUtils.getCameraPositionFromTargetCoordinates(this.mapView.target,r,-t,e,this.mapView.projection,this.mapView.camera.position),this.invalidateViewBounds()}zoomAt(e,t){const i=this.clampZoom(e);this.mapView.zoomLevel!==i&&(s.MapViewUtils.zoomOnTargetPosition(this.mapView,t.x,t.y,i),this.invalidateViewBounds())}clampCameraPosition(){if(this.mapView.projection.type===r.ProjectionType.Spherical)return;const{target:e}=s.MapViewUtils.getTargetAndDistance(this.mapView.projection,this.mapView.camera,this.mapView.elevationProvider),t=this.mapView.projection.unprojectPoint(e),i=this.mapView.projection.projectPoint(t),n=i.x-e.x,o=i.y-e.y;this.mapView.camera.position.x+=n,this.mapView.camera.position.y+=o,this.invalidateViewBounds()}invalidateViewBounds(){this.m_viewBounds=void 0,this.m_paddedViewBounds=void 0}updateViewBounds(){var e;null===(e=this.m_paddedView)||void 0===e||e.update(),this.m_viewBounds=l.harpToHGeoPolygon(this.m_boundsGenerator.generate()),this.m_paddedViewBounds=this.m_paddedBoundsGenerator===this.m_boundsGenerator?this.m_viewBounds:l.harpToHGeoPolygon(this.m_paddedBoundsGenerator.generate())}onViewPortUpdate(){const e=this.m_viewPort.padding;if(e.top||e.left||e.bottom||e.right){const e=this.m_viewPort.center,t=this.mapView.getNormalizedScreenCoordinates(e.x,e.y);s.CameraUtils.setPrincipalPoint(this.mapView.camera,t),this.m_paddedBoundsGenerator===this.m_boundsGenerator&&(this.m_paddedView=new u(this.mapView,this.m_viewPort),this.m_paddedBoundsGenerator=new n.BoundsGenerator(this.m_paddedView))}else this.m_paddedBoundsGenerator!==this.m_boundsGenerator&&(s.CameraUtils.setPrincipalPoint(this.mapView.camera,{x:0,y:0}),this.m_paddedBoundsGenerator=this.m_boundsGenerator,this.m_paddedView=void 0);this.invalidateViewBounds()}}},function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(86),t),r(i(171),t),r(i(396),t),r(i(170),t),r(i(397),t),r(i(54),t),r(i(164),t)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LongPressHandler=void 0;t.LongPressHandler=class{constructor(e,t,i){this.element=e,this.onLongPress=t,this.onTap=i,this.timeout=500,this.moveThreshold=5,this.buttonId=0,this.m_pressEvent=void 0,this.m_timerId=void 0,this.m_moveHandlerRegistered=!1,this.m_boundPointerMoveHandler=this.onPointerMove.bind(this),this.m_boundMouseDownHandler=this.onMouseDown.bind(this),this.m_boundTouchStartHandler=this.onTouchStart.bind(this),this.m_boundMouseUpHandler=this.onMouseUp.bind(this),this.m_boundTouchEndHandler=this.onTouchEnd.bind(this),this.element.addEventListener("mousedown",this.m_boundMouseDownHandler),this.element.addEventListener("touchstart",this.m_boundTouchStartHandler),this.element.addEventListener("mouseup",this.m_boundMouseUpHandler),this.element.addEventListener("touchend",this.m_boundTouchEndHandler)}dispose(){this.cancel(),this.element.removeEventListener("mousedown",this.m_boundMouseDownHandler),this.element.removeEventListener("touchstart",this.m_boundTouchStartHandler),this.element.removeEventListener("mouseup",this.m_boundMouseUpHandler),this.element.removeEventListener("touchend",this.m_boundTouchEndHandler)}startPress(e){var t,i;this.cancelTimer(),this.m_pressEvent=null!==(i=null===(t=e.changedTouches)||void 0===t?void 0:t[0])&&void 0!==i?i:e,this.m_timerId=setTimeout(()=>this.onTimeout(),this.timeout),this.addPointerMoveHandler()}onMouseDown(e){e.button===this.buttonId&&this.startPress(e)}onTouchStart(e){this.m_pressEvent?this.cancel():1===e.changedTouches.length&&this.startPress(e)}onMouseUp(e){var t;this.m_pressEvent&&e.button===this.buttonId&&(this.cancel(),null===(t=this.onTap)||void 0===t||t.call(this,e))}onTouchEnd(e){var t;1===e.changedTouches.length&&e.changedTouches[0].identifier===this.m_pressEvent.identifier&&(this.cancel(),null===(t=this.onTap)||void 0===t||t.call(this,e.changedTouches[0]))}onPointerMove(e){var t,i;if(void 0===this.m_pressEvent)return;const{clientX:n,clientY:r}=null!==(i=null===(t=e.changedTouches)||void 0===t?void 0:t[0])&&void 0!==i?i:e;Math.abs(n-this.m_pressEvent.clientX)+Math.abs(r-this.m_pressEvent.clientY)>this.moveThreshold&&this.cancel()}cancel(){this.m_pressEvent=void 0,this.cancelTimer(),this.removePointerMoveHandler()}cancelTimer(){void 0!==this.m_timerId&&(clearTimeout(this.m_timerId),this.m_timerId=void 0)}addPointerMoveHandler(){this.m_moveHandlerRegistered||(this.element.addEventListener("mousemove",this.m_boundPointerMoveHandler),this.element.addEventListener("touchmove",this.m_boundPointerMoveHandler),this.m_moveHandlerRegistered=!0)}removePointerMoveHandler(){this.m_moveHandlerRegistered&&(this.element.removeEventListener("mousemove",this.m_boundPointerMoveHandler),this.element.removeEventListener("touchmove",this.m_boundPointerMoveHandler),this.m_moveHandlerRegistered=!1)}onTimeout(){const e=this.m_pressEvent;this.m_timerId=void 0,this.cancel(),void 0!==e&&this.onLongPress(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraPanAnimation=t.CameraRotationAnimation=t.CameraAnimation=t.InterpolationFunction=t.EasingFunction=void 0;const n=i(2),r=i(1),s=i(398),o=i(0),a=i(86);var l,c;!function(e){e[e.Linear=0]="Linear",e[e.QuadraticIn=1]="QuadraticIn",e[e.QuadraticOut=2]="QuadraticOut",e[e.QuadraticInOut=3]="QuadraticInOut",e[e.CubicIn=4]="CubicIn",e[e.CubicOut=5]="CubicOut",e[e.CubicInOut=6]="CubicInOut",e[e.QuarticIn=7]="QuarticIn",e[e.QuarticOut=8]="QuarticOut",e[e.QuarticInOut=9]="QuarticInOut",e[e.QuinticIn=10]="QuinticIn",e[e.QuinticOut=11]="QuinticOut",e[e.QuinticInOut=12]="QuinticInOut",e[e.SinusoidalIn=13]="SinusoidalIn",e[e.SinusoidalOut=14]="SinusoidalOut",e[e.SinusoidalInOut=15]="SinusoidalInOut",e[e.ExponentialIn=16]="ExponentialIn",e[e.ExponentialOut=17]="ExponentialOut",e[e.ExponentialInOut=18]="ExponentialInOut",e[e.CircularIn=19]="CircularIn",e[e.CircularOut=20]="CircularOut",e[e.CircularInOut=21]="CircularInOut",e[e.ElasticIn=22]="ElasticIn",e[e.ElasticOut=23]="ElasticOut",e[e.ElasticInOut=24]="ElasticInOut",e[e.BackIn=25]="BackIn",e[e.BackOut=26]="BackOut",e[e.BackInOut=27]="BackInOut",e[e.BounceIn=28]="BounceIn",e[e.BounceOut=29]="BounceOut",e[e.BounceInOut=30]="BounceInOut"}(l=t.EasingFunction||(t.EasingFunction={})),function(e){e[e.Linear=0]="Linear",e[e.Bezier=1]="Bezier",e[e.CatmullRom=2]="CatmullRom"}(c=t.InterpolationFunction||(t.InterpolationFunction={}));class h{constructor(e,t){this.mapView=e,this.name=t,this.running=!1,this.stopped=!1,this.duration=1e4,this.repeat=0,this.easing=s.Easing.Linear.None,function(){if(void 0!==u)return;u=new Map,d=new Map,u.set(l.Linear,s.Easing.Linear.None),u.set(l.QuadraticIn,s.Easing.Quadratic.In),u.set(l.QuadraticOut,s.Easing.Quadratic.Out),u.set(l.QuadraticInOut,s.Easing.Quadratic.InOut),u.set(l.CubicIn,s.Easing.Cubic.In),u.set(l.CubicOut,s.Easing.Cubic.Out),u.set(l.CubicInOut,s.Easing.Cubic.InOut),u.set(l.QuarticIn,s.Easing.Quartic.In),u.set(l.QuarticOut,s.Easing.Quartic.Out),u.set(l.QuarticInOut,s.Easing.Quartic.InOut),u.set(l.QuinticIn,s.Easing.Quintic.In),u.set(l.QuinticOut,s.Easing.Quintic.Out),u.set(l.QuinticInOut,s.Easing.Quintic.InOut),u.set(l.SinusoidalIn,s.Easing.Sinusoidal.In),u.set(l.SinusoidalOut,s.Easing.Sinusoidal.Out),u.set(l.SinusoidalInOut,s.Easing.Sinusoidal.InOut),u.set(l.ExponentialIn,s.Easing.Exponential.In),u.set(l.ExponentialOut,s.Easing.Exponential.Out),u.set(l.ExponentialInOut,s.Easing.Exponential.InOut),u.set(l.CircularIn,s.Easing.Circular.In),u.set(l.CircularOut,s.Easing.Circular.Out),u.set(l.CircularOut,s.Easing.Circular.InOut),u.set(l.ElasticIn,s.Easing.Elastic.In),u.set(l.ElasticOut,s.Easing.Elastic.Out),u.set(l.ElasticInOut,s.Easing.Elastic.InOut),u.set(l.BackIn,s.Easing.Back.In),u.set(l.BackOut,s.Easing.Back.Out),u.set(l.BackInOut,s.Easing.Back.InOut),u.set(l.BounceIn,s.Easing.Bounce.In),u.set(l.BounceOut,s.Easing.Bounce.Out),u.set(l.BounceInOut,s.Easing.Bounce.InOut),d.set(c.Linear,s.Interpolation.Linear),d.set(c.Bezier,s.Interpolation.Bezier),d.set(c.CatmullRom,s.Interpolation.CatmullRom)}()}update(e){return!!this.tween&&this.tween.update(null!=e?e:r.PerformanceTimer.now())}get isRunning(){return this.running}}t.CameraAnimation=h;t.CameraRotationAnimation=class extends h{constructor(e,t,i,n){var r;super(e,n),this.m_mapControls=t,this.startAngle=0,this.endAngle=360,this.m_axis=new o.Vector3(0,0,1),this.beginInteractionListener=()=>{this.stopped||this.stopTween()},this.endInteractionListener=()=>{this.stopped||this.startTween()},void 0!==i.axis&&(this.m_axis=i.axis),void 0!==i.startAngle&&(this.startAngle=i.startAngle),void 0!==i.endAngle&&(this.endAngle=i.endAngle),void 0!==i.duration&&(this.duration=i.duration),void 0!==i.repeat&&(this.repeat=i.repeat),void 0!==i.easing&&(this.easing="function"==typeof i.easing?i.easing:null!==(r=u.get(i.easing))&&void 0!==r?r:s.Easing.Linear.None),this.m_lastRotationValue=this.startAngle}start(e,t){if(this.running)throw new Error("Animation already running"+this.name!==void 0?this.name:"");this.running=!0,this.onFinished=t,this.stopped=!1,this.m_mapControls&&(this.m_mapControls.addEventListener(a.EventNames.BeginInteraction,this.beginInteractionListener),this.m_mapControls.addEventListener(a.EventNames.EndInteraction,this.endInteractionListener)),this.startTween(e),this.mapView.beginAnimation()}stop(){if(!this.running)throw new Error("Animation not running"+this.name!==void 0?this.name:"");this.running=!1,this.stopped=!0,this.mapView.endAnimation(),this.tween&&this.tween.stop(),this.m_mapControls&&(this.m_mapControls.removeEventListener(a.EventNames.BeginInteraction,this.beginInteractionListener),this.m_mapControls.removeEventListener(a.EventNames.EndInteraction,this.endInteractionListener))}startTween(e){const t=new o.Quaternion;this.m_userCamerRotation=new o.Quaternion,this.mapView.camera.getWorldQuaternion(this.m_userCamerRotation),this.tween=new s.Tween({rotation:0}).to({rotation:this.endAngle-this.m_lastRotationValue},this.duration).onComplete(()=>{this.stop(),this.onFinished&&this.onFinished()}).onUpdate(({rotation:e})=>{this.m_lastRotationValue=e,t.setFromEuler(new o.Euler(0,0,o.MathUtils.degToRad(e))),void 0!==this.m_userCamerRotation&&t.multiply(this.m_userCamerRotation),this.mapView.camera.quaternion.copy(t)}),this.tween.repeat(this.repeat),this.tween.easing(this.easing),this.tween.start(e)}stopTween(){this.tween&&this.tween.stop()}};let u,d;t.CameraPanAnimation=class extends h{constructor(e,t,i){var n,r;super(e,i),this.name=i,this.interpolation=s.Interpolation.CatmullRom,void 0!==t.duration&&(this.duration=t.duration),void 0!==t.repeat&&(this.repeat=t.repeat),void 0!==t.easing&&(this.easing="function"==typeof t.easing?t.easing:null!==(n=u.get(t.easing))&&void 0!==n?n:s.Easing.Linear.None),void 0!==t.interpolation&&(this.interpolation="function"==typeof t.interpolation?t.interpolation:null!==(r=d.get(t.interpolation))&&void 0!==r?r:s.Interpolation.Linear),this.m_geoCoordinates=void 0!==t.geoCoordinates?t.geoCoordinates:[]}addPosition(e){this.m_geoCoordinates.push(e)}start(e,t){var i;if(this.running)throw new Error("Animation already running"+this.name!==void 0?this.name:"");this.onFinished=t,this.running=!0;const r=new n.GeoCoordinates(this.mapView.geoCenter.latitude,this.mapView.geoCenter.longitude,this.mapView.camera.position.z),o={latitude:new Array,longitude:new Array,altitude:new Array};for(const e of this.m_geoCoordinates)o.latitude.push(e.latitude),o.longitude.push(e.longitude),o.altitude.push(null!==(i=e.altitude)&&void 0!==i?i:this.mapView.camera.position.z);this.tween=new s.Tween(r).to(o,this.duration).onComplete(()=>{this.stop(),this.onFinished&&this.onFinished()}).onUpdate(({latitude:e,longitude:t,altitude:i})=>{this.mapView.geoCenter=new n.GeoCoordinates(e,t,i),this.mapView.camera.position.z=null!=i?i:0}),this.tween.repeat(this.repeat),this.tween.easing(this.easing),this.tween.interpolation(this.interpolation),this.tween.start(e),this.mapView.beginAnimation()}stop(){if(!this.running)throw new Error("Animation not running"+this.name!==void 0?this.name:"");this.running=!1,this.mapView.endAnimation(),this.tween&&this.tween.stop()}get isRunning(){return this.running}}},function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"Easing",(function(){return r})),i.d(t,"Group",(function(){return o})),i.d(t,"Interpolation",(function(){return a})),i.d(t,"Sequence",(function(){return l})),i.d(t,"Tween",(function(){return h})),i.d(t,"VERSION",(function(){return u})),i.d(t,"add",(function(){return g})),i.d(t,"getAll",(function(){return p})),i.d(t,"nextId",(function(){return d})),i.d(t,"now",(function(){return s})),i.d(t,"remove",(function(){return v})),i.d(t,"removeAll",(function(){return f})),i.d(t,"update",(function(){return y}));var n,r={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-r.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*r.Bounce.In(2*e):.5*r.Bounce.Out(2*e-1)+.5}}},s="undefined"==typeof self&&void 0!==e&&e.hrtime?function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},o=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map((function(t){return e._tweens[t]}))},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=s()),void 0===t&&(t=!1);var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++){var r=this._tweens[i[n]],o=!t;r&&!1===r.update(e,o)&&!t&&delete this._tweens[i[n]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),a={Linear:function(e,t){var i=e.length-1,n=i*t,r=Math.floor(n),s=a.Utils.Linear;return t<0?s(e[0],e[1],n):t>1?s(e[i],e[i-1],i-n):s(e[r],e[r+1>i?i:r+1],n-r)},Bezier:function(e,t){for(var i=0,n=e.length-1,r=Math.pow,s=a.Utils.Bernstein,o=0;o<=n;o++)i+=r(1-t,n-o)*r(t,o)*e[o]*s(n,o);return i},CatmullRom:function(e,t){var i=e.length-1,n=i*t,r=Math.floor(n),s=a.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(r=Math.floor(n=i*(1+t))),s(e[(r-1+i)%i],e[r],e[(r+1)%i],e[(r+2)%i],n-r)):t<0?e[0]-(s(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[i]-(s(e[i],e[i],e[i-1],e[i-1],n-i)-e[i]):s(e[r?r-1:0],e[r],e[i<r+1?i:r+1],e[i<r+2?i:r+2],n-r)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=a.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:(n=[1],function(e){var t=1;if(n[e])return n[e];for(var i=e;i>1;i--)t*=i;return n[e]=t,t}),CatmullRom:function(e,t,i,n,r){var s=.5*(i-e),o=.5*(n-t),a=r*r;return(2*t-2*i+s+o)*(r*a)+(-3*t+3*i-2*s-o)*a+s*r+t}}},l=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),c=new o,h=function(){function e(e,t){void 0===t&&(t=c),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=r.Linear.None,this._interpolationFunction=a.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=l.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==e?"string"==typeof e?s()+parseFloat(e):e:s(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,i,n){for(var r in i){var s=e[r],o=Array.isArray(s),a=o?"array":typeof s,l=!o&&Array.isArray(i[r]);if("undefined"!==a&&"function"!==a){if(l){var c=i[r];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,s)),i[r]=[s].concat(c)}if("object"!==a&&!o||!s||l)void 0===t[r]&&(t[r]=s),o||(t[r]*=1),n[r]=l?i[r].slice().reverse():t[r]||0;else{for(var h in t[r]=o?[]:{},s)t[r][h]=s[h];n[r]=o?[]:{},this._setupProperties(s,t[r],i[r],n[r])}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=s()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=s()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return this._group=e,this},e.prototype.delay=function(e){return this._delayTime=e,this},e.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return this._yoyo=e,this},e.prototype.easing=function(e){return this._easingFunction=e,this},e.prototype.interpolation=function(e){return this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){if(void 0===e&&(e=s()),void 0===t&&(t=!0),this._isPaused)return!0;var i,n,r=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>r)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||n>1?1:n;var o=this._easingFunction(n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,l=this._chainedTweens.length;a<l;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,i,n){for(var r in i)if(void 0!==t[r]){var s=t[r]||0,o=i[r],a=Array.isArray(e[r]),l=Array.isArray(o);!a&&l?e[r]=this._interpolationFunction(o,n):"object"==typeof o&&o?this._updateProperties(e[r],s,o,n):"number"==typeof(o=this._handleRelativeValue(s,o))&&(e[r]=s+(o-s)*n)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];this._valuesStartRepeat[e]="string"==typeof i?this._valuesStartRepeat[e]+parseFloat(i):this._valuesEnd[e],this._valuesEnd[e]=t},e}(),u="18.6.4",d=l.nextId,m=c,p=m.getAll.bind(m),f=m.removeAll.bind(m),g=m.add.bind(m),v=m.remove.bind(m),y=m.update.bind(m),_={Easing:r,Group:o,Interpolation:a,now:s,Sequence:l,nextId:d,Tween:h,VERSION:u,getAll:p,removeAll:f,add:g,remove:v,update:y};t.default=_}.call(this,i(399))},function(e,t){var i,n,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,c=[],h=!1,u=-1;function d(){h&&l&&(h=!1,l.length?c=l.concat(c):u=-1,c.length&&m())}function m(){if(!h){var e=a(d);h=!0;for(var t=c.length;t;){for(l=c,c=[];++u<t;)l&&l[u].run();u=-1,t=c.length}l=null,h=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new p(e,t)),1!==c.length||h||a(m)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickingHandlerComposite=void 0;t.PickingHandlerComposite=class{constructor(e){this.getPickingHandlers=e}async getObjectsAt(e,t,i){let n=[];const r=this.getPickingHandlers();for(const s of r){const r=await s.getObjectsAt(e,t,i);if(i&&r.length>0)return[r[0]];n=n.concat(r)}return n}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t,i,n){this.m_canvas=this.createElement(e.ownerDocument),e.appendChild(this.m_canvas),this.m_pixelRatio=n,this.setSize(t,i)}createElement(e){const t=e.createElement("canvas");return t.style.position="absolute",t.style.top=t.style.left="0",t}setSize(e,t){const i=this.m_pixelRatio;this.m_canvas.width=Math.max(e*i,1),this.m_canvas.height=Math.max(e*i,1),this.m_canvas.style.width=e+"px",this.m_canvas.style.height=t+"px"}getElement(){return this.m_canvas}}},function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewPickHandlerAdapter=t.getPickData=void 0;const r=i(165),s=i(403),o=i(404),a=i(1),l=i(77),c=i(38);var h=H.map.provider.PickingMode;function u(e,t){var i;const r=e.userData,{$id:s,$layer:o,$zoom:a,$level:l,$geometryType:c}=r,h=n(r,["$id","$layer","$zoom","$level","$geometryType"]),u={};u.properties=h;const d=h.kind;u.id=e.featureId>0?e.featureId:h.id,u.layers=[`${t}_${o}:${d}`],u.source_layer=o,u.source_name=t,u.geometry_type=c,u.technique=e.technique;const m=null!==(i=e.tileKey)&&void 0!==i?i:e.userData.tileKey;if(null!=m){const{row:e,column:t,level:i}=m;u.tile={coords:{x:t,y:e,z:i,key:`${t}/${e}/${i}`}}}return u}t.getPickData=u;t.MapViewPickHandlerAdapter=class{constructor(e,t){this.pickHandler=e,this.geoToScreen=t,this.m_featureCache=new l.LRUCache(100)}async getObjectsAt(e,t,i){const n=this.pickHandler.intersectMapObjects(e,t),l=[];for(const d of n){if(void 0===d.userData)continue;const n=this.pickHandler.mapView.getDataSourceByName(d.dataSourceName);if(!(n instanceof c.TileDataSource)){a.assert(!1,"Pick supported only for TileDataSource instances");continue}const m=n.dataProvider();if(!o.isProviderAdapter(m))continue;const p=m.provider;switch(p.getPickingMode()){case h.SOURCE:{if(!(n instanceof r.LocalObjectDataSource)){a.assert(!1,"Cannot use 'SOURCE' pick mode for source without 'getMapObjectById'");continue}const i=n.getMapObjectById(d.userData.id);!l.includes(i)&&(i instanceof H.map.GeoShape||i instanceof H.map.Overlay||i instanceof H.map.Marker&&s.default(e,t,i,this.geoToScreen))&&l.push(i);break}case h.FEATURE:l.push(this.getFeature(d,n.name,p));break;case h.PROVIDER:if(!(p instanceof H.map.provider.RemoteTileProvider)){a.assert(!1,"'PROVIDER' picking mode support only for RemoteTileProvider");continue}await p.requestObjectAsPromise(u(d,n.name),!1).then(i=>{i instanceof H.map.Marker&&!s.default(e,t,i,this.geoToScreen)||l.push(i)})}if(i&&l.length>0)break}return l}getFeature(e,t,i){let n=this.m_featureCache.get(e.userData);return void 0===n&&(n=new H.map.Feature(u(e,t)),n.setParentEventTarget(i),this.m_featureCache.set(e.userData,n)),n}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i,n){const r=i.getIcon(),s=r.getHitArea();if(null===s)return!0;const o=r.getAnchor();e+=o.x,t+=o.y;const a=i.getGeometry();let l=!1;if(a instanceof H.geo.MultiPoint){const i=a.getGeometries();let r=i.length;for(;r--&&!l;){const o=n(i[r]);l=s.hitTest(e-o.x,t-o.y,0)!==H.math.CoverType.NONE}}else{const i=n(a);l=s.hitTest(e-i.x,t-i.y,0)!==H.math.CoverType.NONE}return l}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isProviderAdapter=void 0,t.isProviderAdapter=function(e){return null!=e&&e.provider instanceof H.map.provider.Provider}},function(e,t,i){"use strict";function n(e,t,i,n,r,s){var o=r-i,a=s-n;if(0!==o||0!==a){var l=((e-i)*o+(t-n)*a)/(o*o+a*a);l>1?(i=r,n=s):l>0&&(i+=o*l,n+=a*l)}return(o=e-i)*o+(a=t-n)*a}function r(e,t,i,n){var r={id:void 0===e?null:e,type:t,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)s(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<t.length;n++)s(e,t[n]);else if("MultiPolygon"===i)for(n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)s(e,t[n][r])}(r),r}function s(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function o(e,t,i,n){if(t.geometry){var s=t.geometry.coordinates,h=t.geometry.type,u=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),d=[],m=t.id;if(i.promoteId?m=t.properties[i.promoteId]:i.generateId&&(m=n||0),"Point"===h)a(s,d);else if("MultiPoint"===h)for(var p=0;p<s.length;p++)a(s[p],d);else if("LineString"===h)l(s,d,u,!1);else if("MultiLineString"===h){if(i.lineMetrics){for(p=0;p<s.length;p++)d=[],l(s[p],d,u,!1),e.push(r(m,"LineString",d,t.properties));return}c(s,d,u,!1)}else if("Polygon"===h)c(s,d,u,!0);else{if("MultiPolygon"!==h){if("GeometryCollection"===h){for(p=0;p<t.geometry.geometries.length;p++)o(e,{id:m,geometry:t.geometry.geometries[p],properties:t.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(p=0;p<s.length;p++){var f=[];c(s[p],f,u,!0),d.push(f)}}e.push(r(m,h,d,t.properties))}}function a(e,t){t.push(h(e[0])),t.push(u(e[1])),t.push(0)}function l(e,t,i,r){for(var s,o,a=0,l=0;l<e.length;l++){var c=h(e[l][0]),d=u(e[l][1]);t.push(c),t.push(d),t.push(0),l>0&&(a+=r?(s*d-c*o)/2:Math.sqrt(Math.pow(c-s,2)+Math.pow(d-o,2))),s=c,o=d}var m=t.length-3;t[2]=1,function e(t,i,r,s){for(var o,a=s,l=r-i>>1,c=r-i,h=t[i],u=t[i+1],d=t[r],m=t[r+1],p=i+3;p<r;p+=3){var f=n(t[p],t[p+1],h,u,d,m);if(f>a)o=p,a=f;else if(f===a){var g=Math.abs(p-l);g<c&&(o=p,c=g)}}a>s&&(o-i>3&&e(t,i,o,s),t[o+2]=a,r-o>3&&e(t,o,r,s))}(t,0,m,i),t[m+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function c(e,t,i,n){for(var r=0;r<e.length;r++){var s=[];l(e[r],s,i,n),t.push(s)}}function h(e){return e/360+.5}function u(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function d(e,t,i,n,s,o,a,l){if(n/=t,o>=(i/=t)&&a<n)return e;if(a<i||o>=n)return null;for(var c=[],h=0;h<e.length;h++){var u=e[h],d=u.geometry,f=u.type,v=0===s?u.minX:u.minY,y=0===s?u.maxX:u.maxY;if(v>=i&&y<n)c.push(u);else if(!(y<i||v>=n)){var _=[];if("Point"===f||"MultiPoint"===f)m(d,_,i,n,s);else if("LineString"===f)p(d,_,i,n,s,!1,l.lineMetrics);else if("MultiLineString"===f)g(d,_,i,n,s,!1);else if("Polygon"===f)g(d,_,i,n,s,!0);else if("MultiPolygon"===f)for(var x=0;x<d.length;x++){var w=[];g(d[x],w,i,n,s,!0),w.length&&_.push(w)}if(_.length){if(l.lineMetrics&&"LineString"===f){for(x=0;x<_.length;x++)c.push(r(u.id,f,_[x],u.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===_.length?(f="LineString",_=_[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===_.length?"Point":"MultiPoint"),c.push(r(u.id,f,_,u.tags))}}}return c.length?c:null}function m(e,t,i,n,r){for(var s=0;s<e.length;s+=3){var o=e[s+r];o>=i&&o<=n&&(t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]))}}function p(e,t,i,n,r,s,o){for(var a,l,c=f(e),h=0===r?y:_,u=e.start,d=0;d<e.length-3;d+=3){var m=e[d],p=e[d+1],g=e[d+2],x=e[d+3],w=e[d+4],b=0===r?m:p,M=0===r?x:w,T=!1;o&&(a=Math.sqrt(Math.pow(m-x,2)+Math.pow(p-w,2))),b<i?M>i&&(l=h(c,m,p,x,w,i),o&&(c.start=u+a*l)):b>n?M<n&&(l=h(c,m,p,x,w,n),o&&(c.start=u+a*l)):v(c,m,p,g),M<i&&b>=i&&(l=h(c,m,p,x,w,i),T=!0),M>n&&b<=n&&(l=h(c,m,p,x,w,n),T=!0),!s&&T&&(o&&(c.end=u+a*l),t.push(c),c=f(e)),o&&(u+=a)}var S=e.length-3;m=e[S],p=e[S+1],g=e[S+2],(b=0===r?m:p)>=i&&b<=n&&v(c,m,p,g),S=c.length-3,s&&S>=3&&(c[S]!==c[0]||c[S+1]!==c[1])&&v(c,c[0],c[1],c[2]),c.length&&t.push(c)}function f(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function g(e,t,i,n,r,s){for(var o=0;o<e.length;o++)p(e[o],t,i,n,r,s,!1)}function v(e,t,i,n){e.push(t),e.push(i),e.push(n)}function y(e,t,i,n,r,s){var o=(s-t)/(n-t);return e.push(s),e.push(i+(r-i)*o),e.push(1),o}function _(e,t,i,n,r,s){var o=(s-i)/(r-i);return e.push(t+(n-t)*o),e.push(s),e.push(1),o}function x(e,t){for(var i=[],n=0;n<e.length;n++){var s,o=e[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)s=w(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){s=[];for(var l=0;l<o.geometry.length;l++)s.push(w(o.geometry[l],t))}else if("MultiPolygon"===a)for(s=[],l=0;l<o.geometry.length;l++){for(var c=[],h=0;h<o.geometry[l].length;h++)c.push(w(o.geometry[l][h],t));s.push(c)}i.push(r(o.id,a,s,o.tags))}return i}function w(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var n=0;n<e.length;n+=3)i.push(e[n]+t,e[n+1],e[n+2]);return i}function b(e,t){if(e.transformed)return e;var i,n,r,s=1<<e.z,o=e.x,a=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,h=l.type;if(l.geometry=[],1===h)for(n=0;n<c.length;n+=2)l.geometry.push(M(c[n],c[n+1],t,s,o,a));else for(n=0;n<c.length;n++){var u=[];for(r=0;r<c[n].length;r+=2)u.push(M(c[n][r],c[n][r+1],t,s,o,a));l.geometry.push(u)}}return e.transformed=!0,e}function M(e,t,i,n,r,s){return[Math.round(i*(e*n-r)),Math.round(i*(t*n-s))]}function T(e,t,i,n,r){for(var s=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){o.numFeatures++,S(o,e[a],s,r);var l=e[a].minX,c=e[a].minY,h=e[a].maxX,u=e[a].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),h>o.maxX&&(o.maxX=h),u>o.maxY&&(o.maxY=u)}return o}function S(e,t,i,n){var r=t.geometry,s=t.type,o=[];if("Point"===s||"MultiPoint"===s)for(var a=0;a<r.length;a+=3)o.push(r[a]),o.push(r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===s)E(o,r,e,i,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(a=0;a<r.length;a++)E(o,r[a],e,i,"Polygon"===s,0===a);else if("MultiPolygon"===s)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)E(o,c[a],e,i,!0,0===a)}if(o.length){var h=t.tags||null;if("LineString"===s&&n.lineMetrics){for(var u in h={},t.tags)h[u]=t.tags[u];h.mapbox_clip_start=r.start/r.size,h.mapbox_clip_end=r.end/r.size}var d={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:h};null!==t.id&&(d.id=t.id),e.features.push(d)}}function E(e,t,i,n,r,s){var o=n*n;if(n>0&&t.size<(r?o:n))i.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>o)&&(i.numSimplified++,a.push(t[l]),a.push(t[l+1])),i.numPoints++;r&&function(e,t){for(var i=0,n=0,r=e.length,s=r-2;n<r;s=n,n+=2)i+=(e[n]-e[s])*(e[n+1]+e[s+1]);if(i>0===t)for(n=0,r=e.length;n<r/2;n+=2){var o=e[n],a=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=o,e[r-1-n]=a}}(a,s),e.push(a)}}function P(e,t){return new A(e,t)}function A(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)o(i,e.features[n],t,n);else"Feature"===e.type?o(i,e,t):o(i,{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(e,t){var i=t.buffer/t.extent,n=e,r=d(e,1,-1-i,i,0,-1,2,t),s=d(e,1,1-i,2+i,0,-1,2,t);return(r||s)&&(n=d(e,1,-i,1+i,0,-1,2,t)||[],r&&(n=x(r,1).concat(n)),s&&(n=n.concat(x(s,-1)))),n}(n,t)).length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function C(e,t,i){return 32*((1<<e)*i+t)+e}i.r(t),i.d(t,"default",(function(){return P})),A.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},A.prototype.splitTile=function(e,t,i,n,r,s,o){for(var a=[e,t,i,n],l=this.options,c=l.debug;a.length;){n=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();var h=1<<t,u=C(t,i,n),m=this.tiles[u];if(!m&&(c>1&&console.time("creation"),m=this.tiles[u]=T(e,t,i,n,l),this.tileCoords.push({z:t,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,n,m.numFeatures,m.numPoints,m.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(m.source=e,r){if(t===l.maxZoom||t===r)continue;var f=1<<r-t;if(i!==Math.floor(s/f)||n!==Math.floor(o/f))continue}else if(t===l.indexMaxZoom||m.numPoints<=l.indexMaxPoints)continue;if(m.source=null,0!==e.length){c>1&&console.time("clipping");var g,v,y,_,x,w,b=.5*l.buffer/l.extent,M=.5-b,S=.5+b,E=1+b;g=v=y=_=null,x=d(e,h,i-b,i+S,0,m.minX,m.maxX,l),w=d(e,h,i+M,i+E,0,m.minX,m.maxX,l),e=null,x&&(g=d(x,h,n-b,n+S,1,m.minY,m.maxY,l),v=d(x,h,n+M,n+E,1,m.minY,m.maxY,l),x=null),w&&(y=d(w,h,n-b,n+S,1,m.minY,m.maxY,l),_=d(w,h,n+M,n+E,1,m.minY,m.maxY,l),w=null),c>1&&console.timeEnd("clipping"),a.push(g||[],t+1,2*i,2*n),a.push(v||[],t+1,2*i,2*n+1),a.push(y||[],t+1,2*i+1,2*n),a.push(_||[],t+1,2*i+1,2*n+1)}}},A.prototype.getTile=function(e,t,i){var n=this.options,r=n.extent,s=n.debug;if(e<0||e>24)return null;var o=1<<e,a=C(e,t=(t%o+o)%o,i);if(this.tiles[a])return b(this.tiles[a],r);s>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,h=t,u=i;!l&&c>0;)c--,h=Math.floor(h/2),u=Math.floor(u/2),l=this.tiles[C(c,h,u)];return l&&l.source?(s>1&&console.log("found parent tile z%d-%d-%d",c,h,u),s>1&&console.time("drilling down"),this.splitTile(l.source,c,h,u,e,t,i),s>1&&console.timeEnd("drilling down"),this.tiles[a]?b(this.tiles[a],r):null):null}}]);}).call(self);
export default H;